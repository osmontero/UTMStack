<?xml version="1.0" encoding="utf-8"?>
<databaseChangeLog
    xmlns="http://www.liquibase.org/xml/ns/dbchangelog"
    xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
    xsi:schemaLocation="http://www.liquibase.org/xml/ns/dbchangelog http://www.liquibase.org/xml/ns/dbchangelog/dbchangelog-3.5.xsd">

    <changeSet id="20250630001" author="Manuel">

        <sql dbms="postgresql" splitStatements="true" stripComments="true">
        <![CDATA[
            UPDATE utm_visualization
            SET
                filters = REPLACE(
                        REPLACE(
                                REPLACE(
                                        REPLACE(
                                                REPLACE(
                                                        REPLACE(
                                                                REPLACE(
                                                                        REPLACE(
                                                                                REPLACE(filters, '"logx.', '"log.'),
                                                                                'wineventlog', 'winlog'),
                                                                        'source.ip.keyword', 'adversary.ip.keyword'),
                                                                'source.country.keyword', 'adversary.geolocation.country.keyword'),
                                                        'source.asn', 'adversary.geolocation.asn'),
                                                'destination.ip.keyword', 'target.ip.keyword'),
                                        'destination.country.keyword', 'target.geolocation.country.keyword'),
                                'source.city', 'adversary.geolocation.city'),
                        'destination.url', 'target.url'
                          )
            WHERE filters IS NOT NULL;

            UPDATE utm_visualization
            SET
                aggregation = REPLACE(
                        REPLACE(
                                REPLACE(
                                        REPLACE(
                                                REPLACE(
                                                        REPLACE(
                                                                REPLACE(
                                                                        REPLACE(
                                                                                REPLACE(aggregation, '"logx.', '"log.'),
                                                                                'wineventlog', 'winlog'),
                                                                        'source.ip.keyword', 'adversary.ip.keyword'),
                                                                'source.country.keyword', 'adversary.geolocation.country.keyword'),
                                                        'source.asn', 'adversary.geolocation.asn'),
                                                'destination.ip.keyword', 'target.ip.keyword'),
                                        'destination.country.keyword', 'target.geolocation.country.keyword'),
                                'source.city', 'adversary.geolocation.city'),
                        'destination.url', 'target.url'
                              )
            WHERE aggregation IS NOT NULL;

            ]]>
    </sql>
    </changeSet>
</databaseChangeLog>