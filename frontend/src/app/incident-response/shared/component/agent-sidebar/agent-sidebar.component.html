<div class="card h-100 d-flex flex-column agent-sidebar">
  <div class="card-header p-2">
    <label class="card-title d-flex align-items-center">
      <i class="icon-terminal mr-2 fs-4 text-blue-800"></i>
      Agents
    </label>
  </div>

  <div class="card-body d-flex flex-column p-0 flex-grow-1">
    <!-- search -->
    <div class="p-2">
      <app-utm-search-input (searchFor)="searchAgent($event)"
                            [searching]="searching"
                            placeholder="Search agent ..."></app-utm-search-input>
    </div>

    <div class="text-muted small px-3 mb-2">
      Select an agent to start the interactive console
    </div>

    <div class="d-flex px-2 flex-column h-100 m-h-0">
      <div infiniteScroll
           (scrolled)="onScroll()"
           [fromRoot]="true"
           [infiniteScrollDistance]="1"
           [infiniteScrollThrottle]="80"
           [scrollWindow]="false"
           class="px-1 pb-0 mb-1 overflow-auto flex-grow-1">
        <div *ngFor="let agent of agentSidebarService.agents$ | async; trackBy: trackByFn; let last = last"
             [ngClass]="!last ? 'mb-3' : 'mb-0'"
             class="card action-block shadow-sm cursor-pointer px-3 py-2"
             (click)="agentDetail(agent)">
          <div class="d-flex justify-content-between align-items-center">
            <div class="d-flex flex-column">
              <span class="fw-bold text-dark">{{ agent.assetName || 'Unnamed' }}</span>
              <small class="text-muted">{{ agent.assetIp || 'N/A' }}</small>
            </div>
            <div class="d-flex flex-column align-items-end text-end">
      <span class="badge"
            [ngClass]="agent.assetAlive ? 'bg-success' : 'bg-secondary'">
        {{ agent.assetAlive ? 'Online' : 'Offline' }}
      </span>
              <small class="text-muted mt-1">
                {{ (agent.assetOsPlatform === 'darwin' ? 'macos' : agent.assetOsPlatform) | titlecase }}
              </small>
            </div>
          </div>
        </div>


      </div>
      <app-utm-spinner *ngIf="agentSidebarService.loading$ | async as loading"
                       class="position-absolute top-50 right-35"
                       [loading]="loading" label="Loading actions...">
      </app-utm-spinner>

    </div>
  </div>
</div>
