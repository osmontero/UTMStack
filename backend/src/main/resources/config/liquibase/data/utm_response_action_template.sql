

INSERT INTO public.utm_response_action_template VALUES (32, 'Enable Windows Defender', 'Enables real-time protection in Windows Defender.', '"%ProgramFiles%\Windows Defender\MpCmdRun.exe" -Enable', true);
INSERT INTO public.utm_response_action_template VALUES (15, 'Disable Compromised User Account', 'Disable the user account associated with the anomalous process execution', 'usermod --expiredate 1 $(target.user)', true);
INSERT INTO public.utm_response_action_template VALUES (16, 'Linux Debian: Block Attacker IP via Firewall', 'Adds a firewall rule on the Linux host to block all incoming connections from the attacker''s IP address (extracted from the alert''s adversary.ip field) to prevent further access.', 'ufw deny from $(adversary.ip) to any', true);
INSERT INTO public.utm_response_action_template VALUES (112, 'Macos: Delete file', 'Delete file', 'rm -f $(adversary.path)', true);
INSERT INTO public.utm_response_action_template VALUES (113, 'Windows: Block server outbound network access', 'Block server outbound network access', 'powershell netsh advfirewall firewall add rule name="Block-Outbound-$(adversary.ip)" dir=out action=block remoteip="$(adversary.ip)"', true);
INSERT INTO public.utm_response_action_template VALUES (33, 'Enable Windows Defender', 'Enables real-time protection in Windows Defender.', '"powershell.exe -Command \"Set-MpPreference -DisableRealtimeMonitoring $false\""', true);
INSERT INTO public.utm_response_action_template VALUES (35, 'Enable Firewall Rules', 'Reactivates the firewall rules that were previously disabled to restore system protection.', 'netsh advfirewall set allprofiles state on
', true);
INSERT INTO public.utm_response_action_template VALUES (36, 'Remove Folder Exclusion', 'Removes folder or file exclusions added via PowerShell.', '''powershell.exe -Command "Remove-MpPreference -ExclusionPath \"$(log.message | regex_extract -pattern ''''-ExclusionPath\s+''''(.+?)'''')\""''', true);
INSERT INTO public.utm_response_action_template VALUES (37, 'Remove Process Exclusion', 'Removes process exclusions added via PowerShell.', '''powershell.exe -Command "Remove-MpPreference -ExclusionProcess \"$(log.message | regex_extract -pattern ''''-ExclusionProcess\s+''''(.+?)'''')\""''', true);
INSERT INTO public.utm_response_action_template VALUES (38, 'Remove Folder Exclusion', 'Removes folder or file exclusions added via PowerShell.', 'powershell.exe -Command "Remove-MpPreference -ExclusionPath \"$(log.message | regex_extract -pattern ''''-ExclusionPath\s+''''(.+?)'''')\""', true);
INSERT INTO public.utm_response_action_template VALUES (39, 'Remove Process Exclusion', 'Removes process exclusions added via PowerShell.', 'powershell.exe -Command "Remove-MpPreference -ExclusionProcess \"$(log.message | regex_extract -pattern ''''-ExclusionProcess\s+''''(.+?)'''')\""', true);
INSERT INTO public.utm_response_action_template VALUES (40, 'Remove Folder Exclusion', 'Removes folder or file exclusions added via PowerShell.', 'powershell.exe -Command Remove-MpPreference -ExclusionPath $(log.message | regex_extract -pattern ''-ExclusionPath\s+(.+?)'')
', true);
INSERT INTO public.utm_response_action_template VALUES (41, 'Remove Process Exclusion', 'Removes process exclusions added via PowerShell.', 'powershell.exe -Command Remove-MpPreference -ExclusionProcess $(log.message | regex_extract -pattern ''-ExclusionProcess\s+(.+?)'')
', true);
INSERT INTO public.utm_response_action_template VALUES (42, 'Delete Empire Artifact File', 'Deletes the malicious file (extracted from the alert''s target.file field) associated with PowerShell Empire activity from the compromised system.', 'Remove-Item -LiteralPath $(target.file) -Force -Recurse', true);
INSERT INTO public.utm_response_action_template VALUES (44, 'Kill suspicious keylogging process by PID', 'Terminate the  process using the detected PID in  log.winlogEventDataProcessId', 'taskkill /F /PID $(log.winlogEventDataProcessId)', true);
INSERT INTO public.utm_response_action_template VALUES (45, 'Kill suspicious keylogging process by name', 'Terminate the  process using the detected process name in  log.winlogEventDataProcessName', 'taskkill /F /IM $(log.winlogEventDataProcessName)', true);
INSERT INTO public.utm_response_action_template VALUES (48, 'Restore Real-time Monitoring', 'Re-enables real-time monitoring for Windows Defender.', 'powershell Set-MpPreference -DisableRealtimeMonitoring $(if ("$(log.message)" -match ''-DisableRealtimeMonitoring'') { $false } else { $true })', true);
INSERT INTO public.utm_response_action_template VALUES (49, 'Restore Behavior Monitoring', 'Re-enables behavior monitoring for Windows Defender.', 'powershell Set-MpPreference -DisableBehaviorMonitoring $(if ("$(log.message)" -match ''-DisableBehaviorMonitoring'') { $false } else { $true })', true);
INSERT INTO public.utm_response_action_template VALUES (50, 'Restore PUA Protection', 'Re-enables protection against Potentially Unwanted Applications ', 'powershell Set-MpPreference -PUAProtection $(if ("$(log.message)" -match ''-PUAProtection'') { ''"Enabled"'' } else { ''"Disabled"'' })', true);
INSERT INTO public.utm_response_action_template VALUES (51, 'Restore MAPS Reporting', 'Re-enables the MAPS (Microsoft Active Protection Service) reporting, which sends malware and suspicious file information to Microsoft for analysis.', 'powershell Set-MpPreference -MAPSReporting $(if ("$(log.message)" -match ''-MAPSReporting'') { 1 } else { 0 })', true);
INSERT INTO public.utm_response_action_template VALUES (52, 'Restore Cloud-based Protection', 'Re-enables cloud-based protection for Windows Defender.', 'powershell Set-MpPreference -CloudProtection $(if ("$(log.message)" -match ''CloudProtection'') { 1 } else { 0 })', true);
INSERT INTO public.utm_response_action_template VALUES (53, 'Remove Process Exclusion', 'Removes a process exclusion that was added to Windows Defender.', 'powershell Remove-MpPreference -ExclusionProcess $(if ("$(log.message)" -match ''-ExclusionProcess'') { ''"evil.exe"'' } else { ''"Not A Process"'' })', true);
INSERT INTO public.utm_response_action_template VALUES (58, 'Remove folder and process exclusion added via powershell', 'Remove folder and process exclusion added via powershell', 'if ("$(log.message)" -match ''-ExclusionProcess\s+([^\s]+)'') { Remove-MpPreference -ExclusionProcess $matches[1] }; if ("$(log.message)" -match ''-ExclusionPath\s+([^\s]+)'') { Remove-MpPreference -ExclusionPath $matches[1] }', true);
INSERT INTO public.utm_response_action_template VALUES (59, 'Remove exclusions via added powershell', 'Remove exclusions via added powershell', 'powershell if ("$(log.message)" -match ''-ExclusionProcess\s+(\S+)'') { Remove-MpPreference -ExclusionProcess $matches[1] }; if ("$(log.message)" -match ''-ExclusionPath\s+(\S+)'') { Remove-MpPreference -ExclusionPath $matches[1] }', true);
INSERT INTO public.utm_response_action_template VALUES (60, 'Disable RDP and remove rule in FW', 'Disable RDP and remove rule in FW', 'powershell Set-ItemProperty -Path ''HKLM:\System\CurrentControlSet\Control\Terminal Server'' -Name ''fDenyTSConnections'' -Value 1 -Force;if ("$(log.message)" -match ''name=([^''''"\s]+)'') { Remove-NetFirewallRule -DisplayName $matches[1] -ErrorAction SilentlyContinue }', true);
INSERT INTO public.utm_response_action_template VALUES (43, 'Windows Defender: Enable Windows Defender protection', 'Enable Windows Defender protection', 'powershell Set-MpPreference -DisableRealtimeMonitoring $false
', true);
INSERT INTO public.utm_response_action_template VALUES (115, 'Macos: Block server outbound network access', 'Block server outbound network access', 'echo "block out from any to $(adversary.ip)" | pfctl -f -', true);
INSERT INTO public.utm_response_action_template VALUES (114, 'Linux: Block server outbound network access', 'Block server outbound network access', 'iptables -A OUTPUT -d $(adversary.ip) -j DROP', true);
INSERT INTO public.utm_response_action_template VALUES (127, 'Macos: Disable adversary.user', 'Disable adversary.user', 'chsh -s /usr/bin/false $(adversary.user)', true);
INSERT INTO public.utm_response_action_template VALUES (96, 'Linux: Disable target.user', 'Disable target.user', 'usermod -s /sbin/nologin $(target.user)', true);
INSERT INTO public.utm_response_action_template VALUES (97, 'Macos: Disable target.user', 'Disable target.user', 'chsh -s /usr/bin/false $(target.user)', true);
INSERT INTO public.utm_response_action_template VALUES (67, 'Windows: Block Adversary IP', 'Block Adversary IP', 'powershell netsh advfirewall firewall add rule name="Block-Brute-Force-$(adversary.ip)" dir=in action=block remoteip="$(adversary.ip)" enable=yes', true);
INSERT INTO public.utm_response_action_template VALUES (70, 'Windows: Kill process', 'Kill process', 'powershell taskkill /F /IM (Split-Path -Path "$(adversary.process)" -Leaf)', true);
INSERT INTO public.utm_response_action_template VALUES (72, 'Windows: Delete file', 'Delete file', 'powershell Remove-Item -LiteralPath "$(adversary.path)" -Force -Recurse', true);
INSERT INTO public.utm_response_action_template VALUES (95, 'Windows: Disable target.user', 'Disable target.user', 'powershell net user $(target.user) /active:no', true);
INSERT INTO public.utm_response_action_template VALUES (110, 'Macos: Uninstall application', 'Uninstall application', 'brew uninstall --force "$(target.applicationname)" 2>/dev/null || find /Applications -iname "$(target.applicationname).app" -maxdepth 2 -type d -exec rm -rf {} + 2>/dev/null', true);
INSERT INTO public.utm_response_action_template VALUES (108, 'Linux Debian: Uninstall application', 'Uninstall application', 'apt-get remove -y "$(dpkg-query -W -f=''${Package}\n'' | grep -xi "^$(target.applicationname)$" | head -1)"', true);
INSERT INTO public.utm_response_action_template VALUES (64, 'Windows: Disable RDP and disable FW rule', 'Disable RDP and disable FW rule', 'powershell Set-ItemProperty -Path ''HKLM:\System\CurrentControlSet\Control\Terminal Server'' -Name ''fDenyTSConnections'' -Value 1 -Force; if ("$(log.message)" -match ''name=\"(.+?)\"'') { Remove-NetFirewallRule -DisplayName $matches[1] -ErrorAction SilentlyContinue }', true);
INSERT INTO public.utm_response_action_template VALUES (103, 'Windows: Stop Service', 'Stop Service', 'powershell Stop-Service -Name "$(adversary.windowsServiceDisplayName )" -Force ', true);
INSERT INTO public.utm_response_action_template VALUES (92, 'Windows: Isolate host ', 'Isolate host ', 'powershell Get-NetAdapter ^| Disable-NetAdapter -Confirm:$false', true);
INSERT INTO public.utm_response_action_template VALUES (106, 'Windows: Uninstall application', 'Uninstall application', 'powershell ForEach-Object {Start-Process -FilePath ($_.UninstallString -replace ''"([^"]*)".*'', ''$1'') -ArgumentList "/S" -Wait} -InputObject (Get-ItemProperty HKLM:\Software\Microsoft\Windows\CurrentVersion\Uninstall\*, HKLM:\Software\WOW6432Node\Microsoft\Windows\CurrentVersion\Uninstall\* | Where-Object {$_.DisplayName -like "*$($(target.applicactionname))*"})', true);
INSERT INTO public.utm_response_action_template VALUES (100, 'Linux OpenSUSE: Block Adversary IP', 'Block Adversary IP', 'firewall-cmd --zone=public --add-rich-rule=''rule family="ipv4" source address="$(adversary.ip)" drop'' --permanent && firewall-cmd --reload', true);
INSERT INTO public.utm_response_action_template VALUES (107, 'Linux RHEL: Uninstall application', 'Uninstall application', ' yum remove -y "$(rpm -qa --queryformat ''%{NAME}\n'' | grep -xi "^$(target.applicationname)$" | head -1)"', true);
INSERT INTO public.utm_response_action_template VALUES (102, 'Macos: Kill process', 'Kill process', 'pkill -9 $(basename "$(adversary.process)")', true);
INSERT INTO public.utm_response_action_template VALUES (94, 'Macos: Isolate host', 'Isolate host', 'for interface in $(networksetup -listallnetworkservices | grep -v "aster"); do networksetup -setnetworkserviceenabled "$interface" off; done', true);
INSERT INTO public.utm_response_action_template VALUES (104, 'Linux: Stop Service', 'Stop Service', 'systemctl stop "$(adversary.service)"', true);
INSERT INTO public.utm_response_action_template VALUES (93, 'Linux: Isolate host', 'Isolate host', 'for interface in $(ip link show | grep -E ''^[0-9]+:'' | grep -v ''lo:'' | awk -F: ''{print $2}'' | tr -d '' ''); do ip link set $interface down; done', true);
INSERT INTO public.utm_response_action_template VALUES (99, 'Linux Debian: Block Adversary IP', 'Block Adversary IP', 'iptables -A INPUT -s $(adversary.ip) -j DROP', true);
INSERT INTO public.utm_response_action_template VALUES (105, 'Macos: Stop Service', 'Stop Service', 'launchctl stop "$(adversary.service)"', true);
INSERT INTO public.utm_response_action_template VALUES (109, 'Linux OpenSUSE: Uninstall application', 'Uninstall application', 'zypper remove -y "$(rpm -qa --queryformat ''%{NAME}\n'' | grep -xi "^$(target.applicationname)$" | head -1)"', true);
INSERT INTO public.utm_response_action_template VALUES (101, 'Linux: Kill process', 'Kill process', 'pkill -9 $(basename "$(adversary.process)")', true);
INSERT INTO public.utm_response_action_template VALUES (54, 'Windows Defender: Auto Reenable Protections', 'Restore disabled settings', 'powershell if ("$(log.message)" -match ''DisableRealtimeMonitoring'') { Set-MpPreference -DisableRealtimeMonitoring $false }; if ("$(log.message)" -match ''DisableBehaviorMonitoring'') { Set-MpPreference -DisableBehaviorMonitoring $false }; if ("$(log.message)" -match ''DisableIOAVProtection'') { Set-MpPreference -DisableIOAVProtection $false }; if ("$(log.message)" -match ''DisableScriptScanning'') { Set-MpPreference -DisableScriptScanning $false }; if ("$(log.message)" -match ''DisableCloudProtection'') { Set-MpPreference -EnableNetworkProtection Enabled; Set-MpPreference -MAPSReporting Advanced }; if ("$(log.message)" -match ''Set-MpPreference\s+-ExclusionProcess\s+"?([a-zA-Z0-9\._-]+)"?'') { Remove-MpPreference -ExclusionProcess $matches[1] }', true);
INSERT INTO public.utm_response_action_template VALUES (118, 'Linux Debian: Block server inbound network access', 'Block server inbound network access', 'iptables -A INPUT -s $(adversary.ip) -j DROP', true);
INSERT INTO public.utm_response_action_template VALUES (47, 'Windows: Enable firewall rules previously disabled', 'Reactivates the firewall rules that were previously disabled to restore system protection.', 'powershell netsh advfirewall firewall set rule name=all new enable=yes', true);
INSERT INTO public.utm_response_action_template VALUES (91, 'Windows: Disable adversary.user', 'Disable adversary.user', 'powershell net user $(adversary.user) /active:no', true);
INSERT INTO public.utm_response_action_template VALUES (81, 'Linux: Disable adversary.user', 'Disable adversary.user', 'usermod -s /sbin/nologin $(adversary.user)', true);
INSERT INTO public.utm_response_action_template VALUES (78, 'Linux: Shutdown OS forced', 'Shutdown OS forced', 'shutdown -h now', true);
INSERT INTO public.utm_response_action_template VALUES (75, 'Linux: Kill session and logout user', 'Kill session and logout user', 'pkill -KILL -u $(target.user)', true);
INSERT INTO public.utm_response_action_template VALUES (73, 'Windows: Kill session and logout user', 'Kill session and logout user', 'logoff $(target.user)', true);
INSERT INTO public.utm_response_action_template VALUES (116, 'Windows: Block server inbound network access', 'Block server inbound network access', 'powershell netsh advfirewall firewall add rule name="Block-Inbound-$(adversary.ip)" dir=in action=block remoteip="$(adversary.ip)"', true);
INSERT INTO public.utm_response_action_template VALUES (121, 'Windows: Remove all permissions for a user', 'Remove all permissions for a user', 'powershell Get-LocalGroup ^| Where-Object { $_.Name -ne "Users" } ^| ForEach-Object { Remove-LocalGroupMember -Group $_.Name -Member "$(adversary.user)" -ErrorAction SilentlyContinue }', true);
INSERT INTO public.utm_response_action_template VALUES (120, 'Macos: Block server inbound network access', 'Block server inbound network access', 'echo "block in from $(adversary.ip) to any" | pfctl -f -', true);
INSERT INTO public.utm_response_action_template VALUES (126, 'Macos: Shutdown OS forced', 'Shutdown OS forced', 'shutdown -h now', true);
INSERT INTO public.utm_response_action_template VALUES (117, 'Linux RHEL: Block server inbound network access', 'Block server inbound network access', 'firewall-cmd --zone=public --add-rich-rule=''rule family="ipv4" source address="$(adversary.ip)" drop'' --permanent && firewall-cmd --reload', true);
INSERT INTO public.utm_response_action_template VALUES (128, 'Windows: Disable RPD', 'Disable RDP', 'powershell Set-ItemProperty -Path ''HKLM:\System\CurrentControlSet\Control\Terminal Server'' -Name ''fDenyTSConnections'' -Value 1 -Force', true);
INSERT INTO public.utm_response_action_template VALUES (111, 'Linux: Delete file', 'Delete file', 'rm -f $(adversary.path)', true);
INSERT INTO public.utm_response_action_template VALUES (98, 'Linux RHEL: Block Adversary IP', 'Block Adversary IP', 'firewall-cmd --zone=public --add-rich-rule=''rule family="ipv4" source address="$(adversary.ip)" drop'' --permanent && firewall-cmd --reload', true);
INSERT INTO public.utm_response_action_template VALUES (122, 'Linux: Remove all permissions for a user', 'Remove all permissions for a user', 'for grp in $(id -nG $(adversary.user) | tr '' '' ''\n'' | grep -v "^$(adversary.user)$"); do gpasswd -d $(adversary.user) "$grp"; done', true);
INSERT INTO public.utm_response_action_template VALUES (119, 'Linux OpenSUSE: Block server inbound network access', 'Block server inbound network access', 'firewall-cmd --zone=public --add-rich-rule=''rule family="ipv4" source address="$(adversary.ip)" drop'' --permanent && firewall-cmd --reload', true);
INSERT INTO public.utm_response_action_template VALUES (124, 'Macos: Kill session and logout user', 'Kill session and logout user', 'pkill -KILL -u $(target.user)', true);
INSERT INTO public.utm_response_action_template VALUES (123, 'Macos: Remove all permissions for a user', 'Remove all permissions for a user', 'for grp in $(id -nG $(adversary.user) | tr '' '' ''\n'' | grep -v -E "^($(adversary.user)|staff|everyone)$"); do dseditgroup -o edit -d $(adversary.user) -t user "$grp" 2>/dev/null; done', true);
INSERT INTO public.utm_response_action_template VALUES (125, 'Windows: Shutdown OS forced', 'Shutdown OS forced', 'shutdown /s /f /t 0', true);

