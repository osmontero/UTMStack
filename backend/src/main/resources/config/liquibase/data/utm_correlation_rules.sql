

INSERT INTO public.utm_correlation_rules VALUES (106, 'AWS EC2 Network Access Control List Deletion', 3, 2, 2, 'Impair Defenses', 'Defense Evasion', 'Identifies the deletion of an Amazon Elastic Compute Cloud (EC2) network access control list (ACL) or one of its ingress/egress entries', '["https://awscli.amazonaws.com/v2/documentation/api/latest/reference/ec2/delete-network-acl.html","https://docs.aws.amazon.com/AWSEC2/latest/APIReference/API_DeleteNetworkAcl.html","https://awscli.amazonaws.com/v2/documentation/api/latest/reference/ec2/delete-network-acl-entry.html","https://docs.aws.amazon.com/AWSEC2/latest/APIReference/API_DeleteNetworkAclEntry.html","https://attack.mitre.org/tactics/TA0005/","https://attack.mitre.org/techniques/T1562/"]', 'safe("log.eventSource", "") == ''ec2.amazonaws.com'' && (safe("log.eventName", "") == ''DeleteNetworkAcl'' || safe("log.eventName", "") == ''DeleteNetworkAclEntry'')', '2025-09-05 14:20:15.303074', true, false, 'origin', NULL, '[]');
INSERT INTO public.utm_correlation_rules VALUES (267, 'Azure Container Registry Critical Vulnerability Detected', 3, 3, 2, 'Initial Access', 'T1190 - Exploit Public-Facing Application', 'Detects critical or high severity vulnerabilities in container images within Azure Container Registry, including newly pushed images or recently scanned images with security issues.

Next Steps:
1. Review the vulnerability details and affected container image
2. Assess the impact and exploitability of the vulnerability
3. Update or patch the container image to address the vulnerability
4. Implement security scanning in CI/CD pipeline to prevent future issues
5. Consider quarantining affected images until patched
6. Monitor for any exploitation attempts against vulnerable containers
', '["https://learn.microsoft.com/en-us/azure/defender-for-cloud/defender-for-container-registries-introduction","https://attack.mitre.org/techniques/T1190/"]', 'safe("log.type", "") == "ContainerRegistryRepositoryEvents" && safe("log.OperationName", "").contains("Microsoft.ContainerRegistry") && (safe("log.ResultType", "") == "VulnerabilityFound" || safe("log.Category", "") == "SecurityAssessment") && (safe("log.Severity", "") == "Critical" || safe("log.Severity", "") == "High" || safe("log.statusCode", 0.0) >= double(400))', '2025-09-05 14:31:01.997598', true, false, 'origin', NULL, '[]');
INSERT INTO public.utm_correlation_rules VALUES (124, 'AWS Management Console Root Login', 3, 3, 3, 'Valid Accounts', 'Initial Access', 'Identifies a successful login to the AWS Management Console by the Root user.<br>Adversaries may obtain and abuse credentials of a cloud account as a means of gaining Initial Access, Persistence, Privilege Escalation, or Defense Evasion.<br>Compromised credentials for cloud accounts can be used to harvest sensitive data from online storage accounts and databases.<br><strong>Potential false positives</strong><br>Itâ€™s strongly recommended that the root user is not used for everyday tasks, including the administrative ones. Verify whether the IP address, location, and/or hostname should be logging in as root in your environment. Unfamiliar root logins should be investigated immediately. If known behavior is causing false positives, it can be exempted from the rule.', '["https://attack.mitre.org/tactics/TA0001/","https://attack.mitre.org/techniques/T1078/","https://docs.aws.amazon.com/IAM/latest/UserGuide/id_root-user.html"]', 'safe("log.eventSource", "") == "signin.amazonaws.com" && safe("log.eventName", "") == "ConsoleLogin" && safe("log.userIdentityType", "") == "root"', '2025-09-05 14:57:12.368894', true, false, 'target', NULL, '[]');
INSERT INTO public.utm_correlation_rules VALUES (148, 'Lambda Function Privilege Escalation', 3, 3, 2, 'Privilege Escalation, Defense Evasion', 'T1548 - Abuse Elevation Control Mechanism', 'Detects potential privilege escalation through Lambda functions when IAM policies are attached to roles or users that can be exploited. This may indicate an attacker attempting to escalate privileges by attaching administrative policies to Lambda execution roles.

Next Steps:
1. Verify if the policy attachment was authorized and follows change management procedures
2. Review the attached policy permissions, especially if AdministratorAccess or IAMFullAccess policies were attached
3. Check the Lambda function''s code and recent invocations for suspicious activity
4. Review CloudTrail logs for other IAM changes by the same user/role
5. Validate if the Lambda function legitimately requires the elevated permissions
6. Consider revoking the policy attachment if unauthorized and investigate the source of the change
7. Check for any unusual Lambda function executions following the policy attachment
8. Review the user/role history for previous privilege escalation attempts
', '["https://bishopfox.com/blog/privilege-escalation-in-aws","https://attack.mitre.org/techniques/T1548/"]', 'safe("log.eventSource", "") == "iam.amazonaws.com" && (safe("log.eventName", "") == "AttachRolePolicy" || safe("log.eventName", "") == "AttachUserPolicy") && safe("log.errorCode", "") == "" && (safe("log.requestParameters.roleArn", "").contains("lambda") || safe("log.userIdentity.arn", "").contains("lambda") || safe("log.requestParameters.policyArn", "").contains("AdministratorAccess")) || safe("log.requestParameters.policyArn", "").contains("IAMFullAccess")', '2025-09-05 16:19:06.100601', true, false, 'origin', NULL, '[]');
INSERT INTO public.utm_correlation_rules VALUES (1412, 'Windows: Outlook add-in was loaded by powershell, possible use for email collection', 3, 2, 1, 'Potentially Malicious Activity', 'Email Collection: Local Email Collection', 'Adversaries may target user email on local systems to collect sensitive information.  Files containing email data can be acquired from a user is local system, such as Outlook storage or cache files.', '["https://attack.mitre.org/techniques/T1114/001/"]', 'safe("log.message", "").contains("(Microsoft.Office.Interop.Outlook)")', '2025-09-04 20:57:05.797932', true, false, 'origin', NULL, '[]');
INSERT INTO public.utm_correlation_rules VALUES (118, 'AWS EC2 Encryption Disabled', 3, 2, 2, 'Data Manipulation', 'Impact', 'Identifies disabling of Amazon Elastic Block Store (EBS) encryption by default in the current region. Disabling encryption by default does not change the encryption status of your existing volumes', '["https://attack.mitre.org/tactics/TA0040/","https://attack.mitre.org/techniques/T1565/","https://docs.aws.amazon.com/AWSEC2/latest/UserGuide/EBSEncryption.html","https://awscli.amazonaws.com/v2/documentation/api/latest/reference/ec2/disable-ebs-encryption-by-default.html","https://docs.aws.amazon.com/AWSEC2/latest/APIReference/API_DisableEbsEncryptionByDefault.html"]', 'safe("log.eventSource", "") == "ec2.amazonaws.com" && safe("log.eventName", "") == "DisableEbsEncryptionByDefault"', '2025-09-03 12:27:56.05736', true, false, 'origin', NULL, '[]');
INSERT INTO public.utm_correlation_rules VALUES (139, 'AWS Config Compliance Violation', 2, 3, 2, 'Defense Evasion, Persistence, Privilege Escalation, Initial Access', 'T1078.004 - Valid Accounts: Cloud Accounts', 'Detects AWS Config compliance violations indicating resources that are non-compliant with defined configuration rules and security policies. These violations may indicate configuration drift, unauthorized changes, or potential security misconfigurations that could expose the organization to security risks.

Next Steps:
1. Review the specific AWS Config rule that was violated and identify the affected resource
2. Check if the violation was expected (e.g., planned maintenance or approved exception)
3. Examine the resource''s configuration history in AWS Config to identify when the violation occurred
4. Verify if multiple resources are showing similar compliance violations across accounts
5. Review CloudTrail logs for any configuration changes made to the affected resources
6. Assess the security impact of the non-compliant configuration
7. Remediate the non-compliant resources according to your organization''s security policies
8. Consider implementing auto-remediation for critical compliance rules
9. Update compliance rules if legitimate configuration changes require policy updates
10. Monitor for recurring violations that may indicate systemic configuration issues
', '["https://docs.aws.amazon.com/config/latest/developerguide/evaluate-config.html","https://attack.mitre.org/techniques/T1078/004/"]', 'safe("log.eventSource", "") == "config.amazonaws.com" && (safe("log.eventName", "") == "PutEvaluations" || safe("log.eventName", "") == "PutComplianceItems") && (safe("log.responseElements", "") == "NON_COMPLIANT" || safe("log.requestParameters", "") == "NON_COMPLIANT")', '2025-09-05 15:10:15.226045', true, false, 'origin', NULL, '[]');
INSERT INTO public.utm_correlation_rules VALUES (162, 'AWS VPC Flow Log Anomalies', 3, 2, 2, 'Discovery', 'T1046 - Network Service Discovery', 'Detects anomalies in VPC Flow Logs configuration that could indicate attempts to hide malicious network activity. Monitors for deletion or modification of flow log configurations.

Next Steps:
1. Verify if the flow log changes were authorized by reviewing the AWS CloudTrail logs for the userIdentityArn
2. Check if the source IP address belongs to known administrative systems or jump boxes
3. Review other activities from the same source IP and user identity in the past 24-48 hours
4. Examine the affected VPC and its resources to understand the impact of disabled flow logging
5. If unauthorized, immediately re-enable flow logs and investigate what network activity may have occurred while logging was disabled
6. Review IAM permissions for the user/role that made these changes to ensure least privilege
7. Consider implementing preventive controls using AWS Config rules or SCPs to prevent unauthorized flow log modifications
', '["https://docs.aws.amazon.com/vpc/latest/userguide/flow-logs.html","https://attack.mitre.org/techniques/T1046/"]', 'safe("log.eventSource", "") == "ec2.amazonaws.com" && safe("log.eventName", "") in ["DeleteFlowLogs", "CreateFlowLogs", "ModifyFlowLogsAttribute"] && safe("log.sourceIPAddress", "") != "" && safe("log.errorCode", "") == "" && ( safe("log.eventName", "") == "DeleteFlowLogs" || (safe("log.eventName", "") == "CreateFlowLogs" && safe("log.requestParameters.deliverLogsStatus", "").contains("FAILED")) || (safe("log.eventName", "") == "ModifyFlowLogsAttribute" && safe("log.requestParameters.deliverLogsStatus", "") == "INACTIVE") )', '2025-09-05 16:21:18.20793', true, false, 'origin', NULL, '[]');
INSERT INTO public.utm_correlation_rules VALUES (158, 'AWS Security Group Modifications', 2, 3, 2, 'Defense Evasion', 'T1562.007 - Impair Defenses: Disable or Modify Cloud Firewall', 'Detects modifications to AWS security groups that could weaken network security posture. Monitors for changes that add permissive rules or remove restrictive rules, particularly those allowing unrestricted access (0.0.0.0/0 or ::/0).

Next Steps:
1. Review the security group change details in CloudTrail logs
2. Verify if the change was authorized and follows security policies
3. Check the user/role that made the modification
4. Assess if the new rules expose sensitive resources
5. If unauthorized, immediately revert the changes
6. Review other recent activities from the same source IP or user
7. Consider implementing preventive controls via AWS Config rules or SCPs
', '["https://docs.aws.amazon.com/awscloudtrail/latest/userguide/cloudtrail-event-reference-record-contents.html","https://attack.mitre.org/techniques/T1562/007/"]', 'safe("log.eventSource", "") == "ec2.amazonaws.com" && safe("log.eventName", "") in ["AuthorizeSecurityGroupIngress", "AuthorizeSecurityGroupEgress", "RevokeSecurityGroupIngress", "RevokeSecurityGroupEgress", "CreateSecurityGroup", "DeleteSecurityGroup", "ModifySecurityGroupRules"] && safe("log.sourceIPAddress", "") != "" && safe("log.errorCode", "") == "" && (safe("log.requestParameters.ipPermissions.ipProtocol", "").contains("-1") || safe("log.requestParameters.ipPermissions.cidrIp", "").contains("0.0.0.0/0") || safe("log.requestParameters.ipPermissions.ipv6CidrIp", "").contains("::/0")) || safe("log.requestParameters.ipRanges.cidrIp", "").contains("0.0.0.0/0") || safe("log.requestParameters.ipv6Ranges.cidrIpv6", "").contains("::/0")', '2025-09-05 16:48:59.11058', true, false, 'origin', NULL, '[]');
INSERT INTO public.utm_correlation_rules VALUES (828, 'AppArmor Profile Changes Detected', 2, 3, 1, 'Defense Evasion', 'T1562.001 - Impair Defenses: Disable or Modify Tools', 'Detects AppArmor profile modifications, denials, or attempts to disable AppArmor security policies that could indicate attempts to bypass mandatory access controls. AppArmor is a Linux kernel security module that restricts programs'' capabilities with per-program profiles.

Next Steps:
1. Review the specific AppArmor event and determine if it was authorized
2. Check if the profile change was part of legitimate system administration
3. Verify the user account that triggered the change has appropriate privileges
4. Examine recent system activities on the affected host for signs of compromise
5. If unauthorized, restore the AppArmor profile and investigate potential security breach
', '["https://attack.mitre.org/techniques/T1562/001/","https://ubuntu.com/server/docs/apparmor"]', 'safe("action", "").contains("system") &&
  (
    safe("log.message", "").contains("apparmor") ||
    safe("log.message", "").contains("AppArmor")
  ) &&
  (
    safe("log.message", "").contains("DENIED") ||
    safe("log.message", "").contains("complain") ||
    safe("log.message", "").contains("enforce") ||
    safe("log.message", "").contains("audit") ||
    safe("log.message", "").contains("profile") ||
    safe("log.message", "").contains("aa-") ||
    safe("log.message", "").contains("apparmor_parser") ||
    safe("log.message", "").contains("teardown")
  )', '2025-09-05 17:28:10.624111', true, false, 'origin', '["origin.host"]', '[]');
INSERT INTO public.utm_correlation_rules VALUES (833, 'Network Configuration Changes Detected', 2, 3, 2, 'Discovery', 'T1016 - System Network Configuration Discovery', 'Detects changes to network configuration files or network interface settings that could indicate system compromise or preparation for data exfiltration. This rule monitors for modifications to critical network configuration files and commands that alter network settings.

Next Steps:
1. Verify if the network configuration changes were authorized and scheduled
2. Check if the changes align with legitimate administrative activities
3. Review the user account that made the changes and their privileges
4. Examine the timing of the changes for patterns that suggest malicious activity
5. Correlate with other security events from the same host
6. Validate current network configuration against baseline settings
7. Monitor for any unusual network traffic patterns following the changes
', '["https://attack.mitre.org/techniques/T1016/","https://www.elastic.co/guide/en/beats/filebeat/current/filebeat-module-system.html"]', 'safe("log.message", "") != "" &&
        (
          safe("log.message", "").contains("/etc/network/") ||
          safe("log.message", "").contains("/etc/sysconfig/network") ||
          safe("log.message", "").contains("ifconfig") ||
          safe("log.message", "").contains("ip addr") ||
          safe("log.message", "").contains("netplan") ||
          safe("log.message", "").contains("/etc/resolv.conf") ||
          safe("log.message", "").contains("/etc/hosts") ||
          safe("log.message", "").contains("iptables") ||
          safe("log.message", "").contains("route add") ||
          safe("log.message", "").contains("ip route")
        )', '2025-09-05 18:06:31.791605', true, false, 'origin', '["origin.host","log.message"]', '[{"indexPattern":"v11-log-linux-*","with":[{"field":"origin.host.keyword","operator":"filter_term","value":"{{.origin.host}}"}],"or":[],"within":"now-1h","count":5}]');
INSERT INTO public.utm_correlation_rules VALUES (829, 'Firewall Rule Modifications Detected', 2, 3, 2, 'Defense Evasion', 'T1562.004 - Impair Defenses: Disable or Modify System Firewall', 'Detects modifications to firewall rules including iptables, firewalld, or ufw that could indicate attempts to disable security controls or open backdoor access. This rule monitors system logs for firewall configuration changes that may compromise network security boundaries.

Next Steps:
1. Verify if the firewall modification was authorized and documented
2. Check who performed the modification and from which system
3. Review the specific rules that were added, deleted, or modified
4. Examine surrounding log entries for additional suspicious activity
5. Validate current firewall configuration against security baseline
6. If unauthorized, immediately review and restore proper firewall rules
7. Consider implementing change management controls for firewall modifications
', '["https://attack.mitre.org/techniques/T1562/004/","https://www.elastic.co/guide/en/beats/filebeat/current/filebeat-module-system.html"]', 'safe("action", "").contains("system") &&
      (
        safe("log.message", "").contains("iptables") ||
        safe("log.message", "").contains("ip6tables") ||
        safe("log.message", "").contains("firewall-cmd") ||
        safe("log.message", "").contains("ufw") ||
        safe("log.message", "").contains("nftables") ||
        safe("log.message", "").contains("ebtables")
      ) &&
      (
        safe("log.message", "").contains("ACCEPT") ||
        safe("log.message", "").contains("DROP") ||
        safe("log.message", "").contains("REJECT") ||
        safe("log.message", "").contains("flush") ||
        safe("log.message", "").contains("delete") ||
        safe("log.message", "").contains("insert") ||
        safe("log.message", "").contains("--dport") ||
        safe("log.message", "").contains("--sport")
      )', '2025-09-05 18:11:09.199185', true, false, 'origin', '["origin.host"]', '[]');
INSERT INTO public.utm_correlation_rules VALUES (835, 'PAM Configuration Changes Detected', 2, 3, 2, 'Credential Access, Defense Evasion, Persistence', 'T1556.003 - Modify Authentication Process: Pluggable Authentication Modules', 'Detects modifications to PAM (Pluggable Authentication Module) configuration files which could indicate an attempt to bypass authentication mechanisms or establish persistence. PAM configuration changes can allow attackers to weaken authentication requirements, add backdoor authentication methods, or bypass existing security controls.

Next Steps:
1. Verify the legitimacy of the PAM configuration change with system administrators
2. Review the specific PAM module that was modified and assess the security impact
3. Check for unauthorized access attempts before and after the configuration change
4. Examine system logs for other suspicious administrative activities
5. Validate that proper change management procedures were followed
6. Consider reverting the changes if they are unauthorized
7. Review user accounts and privileges that may have been affected
', '["https://attack.mitre.org/techniques/T1556/003/","https://www.elastic.co/guide/en/beats/filebeat/current/filebeat-module-system.html"]', 'safe("action", "") == "system.auth" && 
      safe("log.message", "").contains("pam") &&
      (
        safe("log.message", "").contains("/etc/pam.d/") ||
        safe("log.message", "").contains("pam.conf") ||
        (
          safe("log.message", "").contains("pam_") &&
          safe("log.message", "").contains("modified")
        )
      )', '2025-09-05 18:17:34.630353', true, false, 'origin', '["origin.host"]', '[]');
INSERT INTO public.utm_correlation_rules VALUES (837, 'SELinux Policy Violations Detected', 3, 3, 2, 'Defense Evasion', 'T1562.001 - Impair Defenses: Disable or Modify Tools', 'Detects SELinux policy violations, AVC denials, or attempts to disable SELinux that could indicate security bypass attempts or system compromise. SELinux violations may indicate malicious activity attempting to bypass mandatory access controls.

Next Steps:
1. Review the specific SELinux violation details and affected resources
2. Check if the violation is from legitimate application behavior or malicious activity
3. Examine system logs around the time of violation for additional suspicious activity
4. Verify SELinux policy configuration and ensure it hasn''t been tampered with
5. If violations are from legitimate applications, consider updating SELinux policies or application configurations
6. Monitor for repeated violations from the same process or user that may indicate persistent bypass attempts
', '["https://attack.mitre.org/techniques/T1562/001/","https://docs.redhat.com/en/documentation/red_hat_enterprise_linux/9/html-single/using_selinux/index"]', 'safe("action", "").contains("system") &&
      (
        safe("log.message", "").contains("avc:") ||
        safe("log.message", "").contains("selinux") ||
        safe("log.message", "").contains("SELinux")
      ) &&
      (
        safe("log.message", "").contains("denied") ||
        safe("log.message", "").contains("permissive") ||
        safe("log.message", "").contains("disabled") ||
        safe("log.message", "").contains("setenforce") ||
        safe("log.message", "").contains("setsebool") ||
        safe("log.message", "").contains("restorecon") ||
        safe("log.message", "").contains("audit2allow")
      )', '2025-09-05 18:18:47.422071', true, false, 'origin', NULL, '[]');
INSERT INTO public.utm_correlation_rules VALUES (840, 'System Boot Anomalies', 1, 3, 3, 'Persistence, Privilege Escalation', 'T1037 - Boot or Logon Initialization Scripts', 'Detects anomalous system boot patterns including unexpected reboots, boot failures, kernel panics, or unusual boot sequences that may indicate system compromise or hardware issues. This rule identifies critical system events that could signal attempts to tamper with the boot process or system initialization.

Next Steps:
1. Immediately verify the affected system''s current operational status
2. Check system logs around the time of the boot anomaly for additional context
3. Examine hardware status and recent system changes or updates
4. Verify integrity of boot components (bootloader, kernel, initramfs)
5. Check for signs of unauthorized modifications to system files
6. Review recent administrative activities and user access logs
7. Consider isolating the system if tampering is suspected
8. Document all findings for potential forensic analysis
', '["https://attack.mitre.org/techniques/T1037/","https://www.elastic.co/guide/en/beats/filebeat/current/filebeat-module-system.html"]', '(
      safe("log.message", "").matches("(?i)(kernel panic|unable to mount root|failed to start|boot failed|emergency mode|rescue mode)") ||
      safe("log.message", "").matches("(?i)(unexpected system reboot|power loss detected|fsck failed|filesystem errors detected)") ||
      (safe("action", "") == "system.syslog" && safe("log.message", "").matches("(?i)(kernel:.*oops|kernel:.*bug|kernel:.*call trace)")) ||
      (safe("log.program", "") == "systemd" && safe("log.message", "").matches("(?i)(failed to start|dependency failed|timeout|activating failed)")) ||
      safe("log.message", "").matches("(?i)(grub.*error|bootloader.*fail|initramfs.*error|dracut.*warning)")
    )', '2025-09-05 18:20:00.219508', true, false, 'origin', '["origin.host"]', '[{"indexPattern":"v11-log-linux-*","with":[{"field":"origin.host.keyword","operator":"filter_term","value":"{{.origin.host}}"}],"or":[],"within":"now-10m","count":3}]');
INSERT INTO public.utm_correlation_rules VALUES (836, 'Process Execution Anomalies', 3, 3, 2, 'Defense Evasion, Privilege Escalation', 'T1055 - Process Injection', 'Detects anomalous process behavior including unexpected terminations, segmentation faults, and suspicious process spawning patterns. This rule identifies processes that have crashed, been killed abnormally, or are exhibiting zombie/defunct behavior which could indicate malicious activity or system compromise.

Next Steps:
1. Investigate the affected host and identify the specific processes involved
2. Review system logs around the time of the anomalous process behavior
3. Check for signs of memory corruption, privilege escalation attempts, or malware injection
4. Examine parent-child process relationships for suspicious spawning patterns
5. Verify system integrity and check for unauthorized modifications
6. Monitor for additional process anomalies on the same host
', '["https://www.elastic.co/guide/en/beats/filebeat/current/filebeat-module-system.html","https://attack.mitre.org/techniques/T1055/"]', '(
      safe("log.message", "") != "" &&
      (
        safe("log.message", "").contains("segfault") ||
        safe("log.message", "").contains("core dumped") ||
        safe("log.message", "").contains("Killed process") ||
        (
          safe("log.message", "").contains("process") &&
          (
            safe("log.message", "").contains("abnormal") ||
            safe("log.message", "").contains("terminated") ||
            safe("log.message", "").contains("signal 9") ||
            safe("log.message", "").contains("signal 11") ||
            safe("log.message", "").contains("defunct") ||
            safe("log.message", "").contains("zombie")
          )
        )
      ) &&
      safe("origin.host", "") != ""
    )', '2025-09-05 18:37:07.345737', true, false, 'origin', '["origin.host"]', '[{"indexPattern":"v11-log-linux-*","with":[{"field":"origin.host.keyword","operator":"filter_term","value":"{{.origin.host}}"}],"or":[],"within":"now-30m","count":3}]');
INSERT INTO public.utm_correlation_rules VALUES (839, 'Sudo Privilege Escalation Attempts', 3, 3, 2, 'Privilege Escalation, Defense Evasion', 'T1548.003 - Abuse Elevation Control Mechanism: Sudo and Sudo Caching', 'Detects unauthorized sudo usage attempts and privilege escalation through sudo command execution. This rule identifies failed sudo attempts including users not in sudoers file, authentication failures, and command restrictions.

Next Steps:
1. Verify the legitimacy of the user attempting sudo access
2. Review the specific command that was attempted
3. Check if this is part of a broader privilege escalation campaign
4. Examine system logs for additional suspicious activity from this user/host
5. Consider implementing additional sudo restrictions if unauthorized access attempts persist
6. Correlate with other authentication events from the same user or host
', '["https://www.elastic.co/guide/en/beats/filebeat/current/filebeat-module-system.html","https://attack.mitre.org/techniques/T1548/003/"]', 'safe("log.message", "").contains("sudo") &&
      (
        safe("log.message", "").contains("NOT in sudoers") ||
        safe("log.message", "").contains("authentication failure") ||
        safe("log.message", "").contains("command not allowed")
      ) &&
      safe("origin.host", "") != ""', '2025-09-05 19:15:32.09205', true, false, 'origin', '["origin.host","origin.user"]', '[{"indexPattern":"v11-log-linux-*","with":[{"field":"origin.host.keyword","operator":"filter_term","value":"{{.origin.host}}"}],"or":[],"within":"now-10m","count":3}]');
INSERT INTO public.utm_correlation_rules VALUES (844, 'System Resource Exhaustion Detection', 1, 2, 3, 'Impact', 'Resource Hijacking', 'Detects potential system resource exhaustion including CPU, memory, or disk space issues that could lead to denial of service', '["https://www.elastic.co/guide/en/beats/filebeat/current/filebeat-module-system.html","https://attack.mitre.org/techniques/T1496/"]', 'safe("log.message", "") != "" && 
    (safe("log.message", "").contains("Out of memory") || 
     safe("log.message", "").contains("No space left on device") || 
     safe("log.message", "").contains("Cannot allocate memory") || 
     safe("log.message", "").contains("fork: retry: Resource temporarily unavailable") || 
     safe("log.message", "").contains("too many open files") || 
     safe("log.message", "").contains("cannot fork") || 
     safe("log.message", "").contains("malloc failed")) && 
    safe("origin.host", "") != ""', '2025-09-05 19:44:11.610032', true, false, 'origin', '["origin.host"]', '[{"indexPattern":"v11-log-linux-*","with":[{"field":"origin.host.keyword","operator":"filter_term","value":"{{.origin.host}}"}],"or":[],"within":"now-10m","count":10}]');
INSERT INTO public.utm_correlation_rules VALUES (85, 'Kernel-Level Threat Detection', 3, 3, 3, 'Privilege Escalation', 'T1068 - Exploitation for Privilege Escalation', 'Detects kernel-level threats including rootkits, kernel exploits, and malicious kernel drivers that attempt to gain elevated privileges or hide malicious activity at the kernel level.

Next Steps:
1. Immediately isolate the affected endpoint to prevent lateral movement
2. Capture memory dump and disk image for forensic analysis
3. Review process creation logs for suspicious parent-child relationships
4. Check for persistence mechanisms (scheduled tasks, services, registry keys)
5. Verify kernel driver signatures and compare against known good baselines
6. Investigate any network connections from kernel-level processes
7. Run deep endpoint scan with updated signatures
8. Contact security team for incident response procedures
', '["https://www.sentinelone.com/blog/decrypting-sentinelone-detection-the-behavioral-ai-engine-in-real-time-cwpp/","https://attack.mitre.org/techniques/T1068/"]', 'safe("log.eventDescription", "").contains("kernel") && (safe("log.confidencelevel", 0.0) >= double(80) || safe("log.dveventtype", "").contains("kernel") || safe("log.indicatorname", "").contains("kernel"))', '2025-09-05 19:56:21.624506', true, false, 'origin', NULL, '[]');
INSERT INTO public.utm_correlation_rules VALUES (924, 'RHEL-Specific Kernel Exploitation Attempt', 3, 3, 3, 'Privilege Escalation', 'Exploitation for Privilege Escalation', 'Detects potential exploitation attempts targeting RHEL-specific kernel vulnerabilities, including memory corruption, privilege escalation through kernel bugs, or attempts to bypass kernel security mechanisms like SELinux or kernel module protections.', '["https://access.redhat.com/security/vulnerabilities","https://attack.mitre.org/techniques/T1068/"]', '(safe("log.facility", "") == "kern" || safe("log.process", "") == "kernel") && 
    ((safe("log.message", "").contains("segfault") && (safe("log.message", "").contains("ip") || safe("log.message", "").contains("sp"))) || 
     safe("log.message", "").contains("kernel BUG") || 
     safe("log.message", "").contains("Oops:") || 
     safe("log.message", "").contains("kernel exploit") || 
     safe("log.message", "").contains("privilege escalation") || 
     (safe("log.message", "").contains("SELinux: avc:  denied") && safe("log.message", "").contains("capability")) || 
     safe("log.message", "").contains("KASLR bypass") || 
     (safe("log.message", "").contains("CVE-") && safe("log.message", "").contains("exploit")))', '2025-09-05 20:01:02.504489', true, false, 'origin', NULL, '[{"indexPattern":"v11-log-linux-*","with":[{"field":"origin.ip.keyword","operator":"filter_term","value":"{{.origin.ip}}"},{"field":"log.facility.keyword","operator":"filter_term","value":"kern"}],"or":[],"within":"now-5m","count":3}]');
INSERT INTO public.utm_correlation_rules VALUES (1481, 'Windows: Signed Proxy Execution via MS Work Folders', 1, 2, 3, 'Defense Evasion', 'System Binary Proxy Execution', 'Identifies the use of Windows Work Folders to execute a potentially masqueraded control.exe file in the current working directory. Misuse of Windows Work Folders could indicate malicious activity.', '["https://attack.mitre.org/tactics/TA0005/","https://attack.mitre.org/techniques/T1218/"]', 'safe("log.winlogEventDataProcessName", "").contains("control.exe") && safe("log.winlogEventDataParentProcessName", "").contains("workfolders.exe") && !safe("log.winlogEventDataProcessName", "").matches("(:\\Windows\\(System32|SysWOW64)\\control.exe)")', '2025-09-05 20:09:24.518358', true, false, 'origin', NULL, '[]');
INSERT INTO public.utm_correlation_rules VALUES (1343, 'Windows: Execution via MSSQL xp_cmdshell Stored Procedure', 3, 3, 2, 'Execution', 'Command and Scripting Interpreter', 'Identifies execution via MSSQL xp_cmdshell stored procedure. Malicious users may attempt to elevate their privileges by using xp_cmdshell, which is disabled by default, thus, it''s important to review the context of it''s use.', '["https://attack.mitre.org/tactics/TA0002/","https://attack.mitre.org/techniques/T1059/"]', 'safe("log.message", "") in [''diskfree'', ''rmdir'', ''mkdir'', ''dir'', ''del'', ''rename'', ''bcp'', ''XMLNAMESPACES''] &&
       safe("log.winlogEventDataProcessName", "").contains(''cmd.exe'') && safe("log.winlogEventDataParentProcessName", "").contains(''sqlservr.exe'')', '2025-09-05 20:13:56.074859', true, false, 'origin', NULL, '[]');
INSERT INTO public.utm_correlation_rules VALUES (1399, 'Windows: Microsoft Exchange Worker Spawning Suspicious Processes', 2, 3, 2, 'Initial Access', 'Exploit Public-Facing Application', 'Identifies suspicious processes being spawned by the Microsoft Exchange Server worker process (w3wp). This activity may indicate exploitation activity or access to an existing web shell backdoor.', '["https://attack.mitre.org/tactics/TA0001/","https://attack.mitre.org/techniques/T1190/"]', 'safe("log.winlogEventDataParentProcessName", "").contains("w3wp.exe") && safe("log.message", "").matches("(MSExchange(.+)AppPool)") &&
       safe("log.winlogEventDataProcessName", "").matches("(md.exe|powershell.exe|pwsh.dll|powershell_ise.exe)")', '2025-09-05 20:16:58.35805', true, false, 'origin', NULL, '[]');
INSERT INTO public.utm_correlation_rules VALUES (1400, 'Windows: Suspicious MS Office Child Process', 1, 2, 3, 'Initial Access', 'Spearphishing Attachment', 'Identifies suspicious child processes of frequently targeted Microsoft Office applications (Word, PowerPoint, Excel). These child processes are often launched during exploitation of Office applications or from documents with malicious macros.', '["https://attack.mitre.org/tactics/TA0001/","https://attack.mitre.org/techniques/T1566/001/"]', 'safe("log.winlogEventDataProcessName", "") in ["Microsoft.Workflow.Compiler.exe", "arp.exe", "atbroker.exe", "bginfo.exe", "bitsadmin.exe", "cdb.exe", "certutil.exe", "cmd.exe", "cmstp.exe", "control.exe", "cscript.exe", "csi.exe", "dnx.exe", "dsget.exe", "dsquery.exe", "forfiles.exe", "fsi.exe", "ftp.exe", "gpresult.exe", "hostname.exe", "ieexec.exe", "iexpress.exe", "installutil.exe", "ipconfig.exe", "mshta.exe", "msxsl.exe", "nbtstat.exe", "net.exe", "net1.exe", "netsh.exe", "netstat.exe", "nltest.exe", "odbcconf.exe", "ping.exe", "powershell.exe", "pwsh.exe", "qprocess.exe", "quser.exe", "qwinsta.exe", "rcsi.exe", "reg.exe", "regasm.exe", "regsvcs.exe", "regsvr32.exe", "sc.exe", "schtasks.exe", "systeminfo.exe", "tasklist.exe", "tracert.exe", "whoami.exe", "wmic.exe", "wscript.exe", "xwizard.exe", "explorer.exe", "rundll32.exe", "hh.exe", "msdt.exe"] &&
      safe("log.winlogEventDataParentProcessName", "") in ["eqnedt32.exe", "excel.exe", "fltldr.exe", "msaccess.exe", "mspub.exe", "powerpnt.exe", "winword.exe", "outlook.exe"]', '2025-09-05 20:17:59.318295', true, false, 'origin', NULL, '[]');
INSERT INTO public.utm_correlation_rules VALUES (961, 'System Linux: Namespace Manipulation Using Unshare', 3, 3, 2, 'Privilege Escalation', 'Create or Modify System Process', 'Identifies  suspicious usage of unshare to manipulate system namespaces. Unshare can be utilized to escalate privileges or escape container security boundaries. Threat actors have utilized this binary to allow themselves to escape to the host and access other resources or escalate privileges.', '["https://attack.mitre.org/tactics/TA0004/","https://attack.mitre.org/techniques/T1543/"]', 'safe("log.message", "").contains("unshare") && !safe("log.message", "").contains("/usr/bin/snap") && !safe("log.message", "").matches("(\\/usr\\/bin\\/udevadm|\\/lib\\/systemd\\/systemd-udevd|\\/usr\\/bin\\/unshare)")', '2025-09-05 20:29:55.79613', true, false, 'origin', NULL, '[]');
INSERT INTO public.utm_correlation_rules VALUES (952, 'System Linux: Modification of OpenSSH Binaries', 3, 3, 2, 'Persistence', 'Create or Modify System Process', 'Adversaries may modify SSH related binaries for persistence or credential access by patching sensitive functions to enable unauthorized access or by logging SSH credentials for exfiltration.', '["https://attack.mitre.org/tactics/TA0003/","https://attack.mitre.org/techniques/T1543/"]', 'safe("log.message", "").matches("libkeyutils.so") && !safe("log.message", "").matches("(dpkg|yum|dnf|dnf-automatic)") && safe("log.message", "").matches("(/usr/sbin/sshd|/usr/bin/ssh|/usr/bin/sftp|/usr/bin/scp)")', '2025-09-05 20:31:42.804147', true, false, 'origin', NULL, '[]');
INSERT INTO public.utm_correlation_rules VALUES (951, 'System Linux: System Log File Deletion', 3, 3, 3, 'Defense Evasion', 'Clear Linux or Mac System Logs', 'Identifies the deletion of sensitive Linux system logs. This may indicate an attempt to evade detection or destroy forensic evidence on a system.', '["https://attack.mitre.org/tactics/TA0005/","https://attack.mitre.org/techniques/T1070/002/"]', 'safe("log.message", "").matches("(/var/run/utmp|/var/log/wtmp|/var/log/btmp|/var/log/lastlog|/var/log/faillog|/var/log/syslog|/var/log/messages|/var/log/secure|/var/log/auth.log|/var/log/boot.log|/var/log/kern.log)") && !safe("log.message", "").contains("gzip") && safe("log.message", "").matches("(rm |shred -u)")', '2025-09-05 20:32:41.848549', true, false, 'origin', NULL, '[]');
INSERT INTO public.utm_correlation_rules VALUES (933, 'Critical System Configuration Changes in RHEL', 3, 3, 3, 'Persistence, Privilege Escalation', 'System Configuration Modification', 'Detects critical system configuration changes in RHEL including modifications to system services, SELinux settings, firewall rules, and other security-relevant configurations that could indicate unauthorized access or system compromise.

Next Steps:
1. Verify the legitimacy of the configuration change with the system administrator
2. Review the change details and determine if it aligns with authorized maintenance windows
3. Check if the user account making the change has proper authorization
4. Examine system logs for any suspicious activity preceding the configuration change
5. If unauthorized, immediately investigate for potential compromise and consider reverting changes
6. Review access logs and authentication events for the affected user account
', '["https://docs.redhat.com/en/documentation/red_hat_enterprise_linux/8/html/security_hardening/","https://attack.mitre.org/techniques/T1543/"]', '(safe("log.type", "") in ["CONFIG_CHANGE", "SYSCALL", "PATH"] &&
     (safe("log.path", "").matches("/etc/selinux|/etc/systemd|/etc/security|/etc/pam\\.d|/etc/sudoers|/etc/ssh") ||
      safe("log.name", "").matches("/etc/selinux|/etc/systemd|/etc/security|/etc/pam\\.d|/etc/sudoers|/etc/ssh"))) ||
    (safe("log.program", "") in ["systemctl", "semanage", "setsebool", "firewall-cmd", "authconfig"] &&
     safe("log.message", "").matches("changed|modified|updated|disabled|enabled")) ||
    (safe("log.message", "").matches("SELinux.*disabled|SELinux.*permissive|firewall.*stopped|service.*masked") &&
     safe("log.severity", "") in ["warning", "error", "critical"]) ||
    (safe("log.audit_type", "") == "CONFIG_CHANGE" &&
     safe("log.success", "") == "yes" &&
     safe("log.exe", "").matches("/usr/bin/yum|/usr/bin/dnf|/usr/bin/rpm"))', '2025-09-05 20:44:53.70031', true, false, 'origin', NULL, '[]');
INSERT INTO public.utm_correlation_rules VALUES (1252, 'AdminSDHolder Abuse Detection', 3, 3, 2, 'Persistence, Privilege Escalation', 'T1098 - Account Manipulation', 'Detects modifications to the AdminSDHolder object which can be used for persistence by granting elevated privileges. The SDProp process propagates these permissions to protected groups every 60 minutes, making this a critical security event.

Next Steps:
1. Immediately review the user account that performed the modification
2. Check if the modification was authorized and part of legitimate administrative activities
3. Examine the specific permissions that were changed on the AdminSDHolder object
4. Monitor for privilege escalation activities in the next 60 minutes (SDProp cycle)
5. Review all members of protected groups for unauthorized additions
6. Audit recent administrative activities by the same user account
7. Consider temporarily disabling the user account if unauthorized activity is suspected
', '["https://attack.mitre.org/techniques/T1098/","https://adsecurity.org/?p=1906","https://docs.microsoft.com/en-us/windows-server/identity/ad-ds/plan/security-best-practices/appendix-c--protected-accounts-and-groups-in-active-directory"]', 'safe("log.eventCode", 0.0) in [double(4662), double(5136), double(4670)] &&
    safe("log.winlogChannel", "") == "Security" &&
    (safe("log.winlogEventDataObjectName", "").matches(".*CN=AdminSDHolder,CN=System.*") ||
      safe("log.winlogEventDataObjectDN", "").matches(".*CN=AdminSDHolder,CN=System.*")) &&
    (safe("log.winlogEventDataOperationType", "") in ["Object Access", "Write Property"] ||
      safe("log.winlogEventDataAccessMask", "") in ["0x20000", "0x40000", "0x80000"] ||
      safe("log.action", "").matches(".*Permissions.*changed.*")) &&
    safe("log.winlogEventDataSubjectUserName", "") != "SYSTEM"', '2025-09-05 21:41:00.717062', true, false, 'origin', '["log.winlogEventDataSubjectUserName","log.winlogEventDataObjectName"]', '[]');
INSERT INTO public.utm_correlation_rules VALUES (1311, 'Windows Defender: Antimalware engine found malware or other potentially unwanted software', 1, 2, 3, 'Execution', 'Event Triggered Execution', 'This rule is triggered when the antimalware engine detects malware or potentially unwanted software on the system. This alert is critical to identify the presence of threats and unwanted software that may compromise system security and performance.', '["https://attack.mitre.org/tactics/TA0002/","https://attack.mitre.org/techniques/T1546/"]', 'safe("log.eventCode", 0.0) in [double(1006), double(1015), double(1116)] && safe("log.winlogProviderName", "") == ''SecurityCenter''', '2025-09-05 22:06:37.01159', true, false, 'target', NULL, '[]');
INSERT INTO public.utm_correlation_rules VALUES (1304, 'Windows: A user account was added to administration groups', 1, 2, 3, 'Privilege Escalation', 'Domain or Tenant Policy Modification', 'This alert is generated every time a user account is added to administrations groups.  This event generates on domain controllers, member servers, and workstations', '["https://attack.mitre.org/tactics/TA0004","https://attack.mitre.org/techniques/T1484/"]', 'safe("log.eventCode", 0.0) in [double(4732), double(4728)] && 
       (safe("log.winlogEventDataTargetUserSid","").endsWith(''-544'') || 
        safe("log.winlogEventDataTargetUserSid","").endsWith(''-512'') || 
        safe("log.winlogEventDataTargetUserSid","").endsWith(''-518'') || 
        safe("log.winlogEventDataTargetUserSid","").endsWith(''-519'') || 
        safe("log.winlogEventDataTargetUserSid","").endsWith(''-520'') || 
        safe("log.winlogEventDataTargetUserSid","").endsWith(''-500'') || 
        safe("log.winlogEventDataTargetUserSid","").endsWith(''-548'') || 
        safe("log.winlogEventDataTargetUserSid","").endsWith(''-549''))', '2025-09-05 22:26:54.876677', true, false, 'origin', NULL, '[]');
INSERT INTO public.utm_correlation_rules VALUES (1306, 'Windows: A user account was removed from administration groups', 1, 2, 3, 'Impact', 'Account Access Removal', 'When an alert is generated, it is essential to immediately investigate the removal of the user from the administrators group.  Verify if the action was authorized and performed by legitimate administrators.  If the deletion was unauthorized, immediately restore the user to the administrators group and assess any potential impact caused by this unwanted action.  Also, review and enforce the security of the environment to prevent unauthorized changes to the membership of the administrators group.', '["https://attack.mitre.org/tactics/TA0040/","https://attack.mitre.org/techniques/T1531/"]', 'safe("log.eventCode", 0.0) in [double(4733), double(4729)] && (safe("log.winlogEventDataTargetUserSid","").endsWith(''-544'') || safe("log.winlogEventDataTargetUserSid","").endsWith(''-512'') || safe("log.winlogEventDataTargetUserSid","").endsWith(''-518'') || safe("log.winlogEventDataTargetUserSid","").endsWith(''-519'') || safe("log.winlogEventDataTargetUserSid","").endsWith(''-520'') || safe("log.winlogEventDataTargetUserSid","").endsWith(''-500'') || safe("log.winlogEventDataTargetUserSid","").endsWith(''-548'') || safe("log.winlogEventDataTargetUserSid","").endsWith(''-549''))', '2025-09-05 22:05:07.288944', true, false, 'origin', NULL, '[]');
INSERT INTO public.utm_correlation_rules VALUES (1312, 'Windows Defender: Antimalware platform failed performing an action to protect you from potentially unwanted software', 1, 2, 3, 'Defense Evasion', 'Impair Defenses', 'This rule is triggered when the system detects that the antimalware platform has experienced a failure or error while trying to perform a protection action against potentially unwanted software. This alert is essential to identify situations where the system could not be adequately protected against unwanted software, which can increase the risk of infections and compromise system security.', '["https://attack.mitre.org/tactics/TA0005/","https://attack.mitre.org/techniques/T1562/"]', 'safe("log.eventCode", 0.0) in [double(1118), double(1119)] && safe("log.winlogProviderName", "") == "SecurityCenter"', '2025-09-05 22:07:14.821138', true, false, 'target', NULL, '[]');
INSERT INTO public.utm_correlation_rules VALUES (1313, 'Windows Defender: Protection Disabled', 1, 2, 3, 'Defense Evasion', 'Impair Defenses', 'This rule is triggered when it detects that Windows Defender protection has been turned off or disabled on the system. The alert is crucial to identify any unauthorized or malicious actions that may leave the system vulnerable to security threats.', '["https://attack.mitre.org/tactics/TA0005/","https://attack.mitre.org/techniques/T1562/"]', 'safe("log.eventCode", 0.0) in [double(5001), double(5012)]', '2025-09-05 22:07:51.368625', true, false, 'origin', NULL, '[]');
INSERT INTO public.utm_correlation_rules VALUES (1360, 'Windows: Microsoft security essentials - Virus detected', 3, 3, 2, 'Privilege Escalation', 'Process Injection', 'Detect the presence of a virus or malware on the system using Microsoft Security Essentials.  The rule correlates different threat detection events, represented by various Event IDs, to identify virus detection on the system.', '["https://attack.mitre.org/tactics/TA0004/","https://attack.mitre.org/techniques/T1055/"]', 'safe("log.eventCode", 0.0) in [double(1107), double(1117), double(1116), double(1118), double(1119)] && safe("log.winlogProviderName", "") == "Microsoft Antimalware"', '2025-09-05 22:08:55.011182', true, false, 'origin', NULL, '[]');
INSERT INTO public.utm_correlation_rules VALUES (1263, 'NTDS.dit Extraction Attempt', 3, 3, 1, 'Credential Access', 'T1003.003 - OS Credential Dumping: NTDS', 'Detects attempts to access or copy the Active Directory domain database (NTDS.dit) which contains password hashes for all domain users. This is a critical indicator of credential theft attempts and potential domain compromise.

Next Steps:
1. Immediately isolate the affected system to prevent further compromise
2. Review all recent activity from the source host and user account
3. Check for signs of lateral movement from this system
4. Verify integrity of domain controllers and examine recent administrative actions
5. Look for evidence of credential harvesting tools (ntdsutil, vssadmin, mimikatz)
6. Review privileged account usage and consider forcing password resets
7. Examine network traffic for data exfiltration attempts
8. Check backup systems and shadow copies for unauthorized access
9. Coordinate with incident response team for full forensic analysis
', '["https://attack.mitre.org/techniques/T1003/003/","https://learn.microsoft.com/en-us/previous-versions/windows/it-pro/windows-10/security/threat-protection/auditing/event-4663"]', '    safe("log.eventCode", 0.0) in [double(4663), double(4656)] &&
    safe("log.winlogChannel", "") == "Security" &&
    (safe("log.winlogEventDataObjectName", "").matches(".*\\\\ntds\\.dit") ||
      safe("log.winlogEventDataObjectName", "").matches(".*\\\\NTDS\\\\.*") ||
      safe("log.winlogEventDataProcessName", "").matches(".*\\\\ntdsutil\\.exe") ||
      safe("log.winlogEventDataProcessName", "").matches(".*\\\\vssadmin\\.exe")) &&
    safe("log.winlogEventDataAccessMask", "") != "0x0"', '2025-09-05 22:26:26.550879', true, false, 'origin', '["adversary.host"]', '[]');
INSERT INTO public.utm_correlation_rules VALUES (1410, 'Windows: User logged using Remote Desktop Connection from loopback address, possible exploit over reverse tunneling using stolen credentials', 3, 2, 1, 'Potentially Compromised System', 'Remote Services: Remote Desktop Protocol', 'Adversaries may use Valid Accounts to log into a computer using the Remote Desktop Protocol (RDP). The adversary may then perform actions as the logged-on user.', '["https://attack.mitre.org/techniques/T1021/001/"]', 'safe("log.eventData.logonType", "") == "10" && safe("log.origin.ips", "") in [''::1'',''127.0.0.1''] && safe("log.eventCode", 0.0) in [double(528), double(540), double(673), double(4624), double(4769)]', '2025-09-05 22:30:01.475187', true, false, 'origin', NULL, '[]');
INSERT INTO public.utm_correlation_rules VALUES (1489, 'Windows: A powered user account was created', 2, 2, 3, 'Privilege Escalation', 'Domain Policy Modification', 'This alert is generated every time a new powered account is created. This event generates on domain controllers, member servers, and workstations.', '["https://attack.mitre.org/tactics/TA0004","https://attack.mitre.org/techniques/T1484/","https://docs.microsoft.com/en-us/windows-server/identity/ad-ds/plan/appendix-l--events-to-monitor"]', 'safe("log.eventDataTargetSid", "").endsWith("-547") && safe("log.eventCode", 0.0) in [double(4732), double(4728), double(632), double(636)]', '2025-09-05 22:35:42.880566', true, false, 'origin', NULL, '[{"indexPattern":"v11-log-wineventlog-*","with":[{"field":"log.eventCode","operator":"filter_term","value":"4720"},{"field":"log.eventCode","operator":"filter_term","value":"624"}],"or":[],"within":"now-60s","count":1}]');
INSERT INTO public.utm_correlation_rules VALUES (1490, 'Windows: An administrative account was removed from power user group', 2, 3, 1, 'Impact', 'Account Access Removal', 'This alert is generated every time a user account is removed from power user groups. This event generates on domain controllers, member servers, and workstations', '["https://attack.mitre.org/tactics/TA0040/","https://attack.mitre.org/techniques/T1531/","https://docs.microsoft.com/en-us/windows-server/identity/ad-ds/plan/appendix-l--events-to-monitor"]', 'safe("log.eventCode", 0.0) in [double(4733), double(637), double(4729), double(633)] && safe("log.eventDataTargetSid", "").endsWith("-547")', '2025-09-05 22:36:04.037241', true, false, 'origin', NULL, '[]');
INSERT INTO public.utm_correlation_rules VALUES (1478, 'Windows Firewall rule has been added, modified or deleted to the Windows Defender Firewall exception list.', 3, 3, 2, 'Potentially Malicious Activity', 'Defense Evasion', 'Detects changes to the Windows Defender Firewall exception list, which may indicate an attempt to evade detection.', '["https://learn.microsoft.com/en-us/windows/security/threat-protection/windows-firewall/firewall-event-ids"]', 'safe("log.winlogEventDataLogName", "") == "Microsoft-Windows-Windows Firewall With Advanced Security/Firewall" &&  safe("log.eventCode", 0.0) in [double(2004), double(2005), double(2006)]', '2025-09-05 22:36:37.021315', true, false, 'origin', NULL, '[]');
INSERT INTO public.utm_correlation_rules VALUES (1268, 'SID History Injection Attempt', 3, 3, 1, 'Defense Evasion, Privilege Escalation', 'T1134.005 - Access Token Manipulation: SID-History Injection', 'Detects attempts to add SID History to an account, which can be used for privilege escalation. SID History injection allows attackers to inherit permissions from privileged accounts without being members of privileged groups. Both successful (4765) and failed (4766) attempts are monitored.

Next Steps:
1. Immediately investigate the target user account and verify if SID History modification was legitimate
2. Check if the user performing the action has proper administrative privileges for this operation
3. Review the source SID being added to understand what permissions are being inherited
4. Examine recent authentication logs for the target account to identify potential unauthorized access
5. Verify Active Directory configuration and check for signs of domain controller compromise
6. Consider resetting the target account password and removing unauthorized SID History entries
7. Review domain administrator accounts and privileged group memberships for anomalies
', '["https://attack.mitre.org/techniques/T1134/005/","https://learn.microsoft.com/en-us/windows/security/threat-protection/auditing/event-4765","https://learn.microsoft.com/en-us/windows/security/threat-protection/auditing/event-4766","https://www.ultimatewindowssecurity.com/securitylog/encyclopedia/event.aspx?eventid=4765"]', 'safe("log.eventCode", 0.0) in [double(4765), double(4766)] && safe("log.winlogChannel", "") == "Security"', '2025-09-05 22:41:12.679709', true, false, 'origin', '["target.user","target.host"]', '[]');
INSERT INTO public.utm_correlation_rules VALUES (1318, 'Clearing Windows Event Logs with wevtutil', 1, 2, 3, 'Defense Evasion', 'Clear Windows Event Logs', 'Identifies attempts to clear or disable Windows event log stores using Windows wevetutil command. This is often done by attackers in an attempt to evade detection or destroy forensic evidence on a system.', '["https://attack.mitre.org/tactics/TA0005/","https://attack.mitre.org/techniques/T1070/001/"]', 'safe("log.message", "").matches(''(/e:false|cl|clear-log|Clear-EventLog)'') && safe("log.winlogEventDataLogonProcessName", "").matches(''wevtutil.exe'')', '2025-09-05 22:59:17.588549', true, false, 'origin', NULL, '[]');
INSERT INTO public.utm_correlation_rules VALUES (1319, 'Windows: NTDS or SAM Database File Copied', 3, 3, 3, 'Credential Access', 'Security Account Manager', 'Identifies a copy operation of the Active Directory Domain Database or Security Account Manager (SAM) files. Those files contain sensitive information including hashed domain and local credentials.', '["https://attack.mitre.org/tactics/TA0006/","https://attack.mitre.org/techniques/T1003/","https://attack.mitre.org/techniques/T1003/002/"]', 'safe("log.winlogEventDataLogonProcessName", "").matches(''(Cmd.Exe|PowerShell.EXE|XCOPY.EXE|esentutl.exe|cmd.exe|powershell.exe)'') && 
       safe("log.message", "").matches(''(copy|xcopy|Copy-Item|move|cp|mv|/y|/vss|/d)'') && safe("log.message", "").matches(''(\\ntds.dit|\\config\\SAM|\\(.+)\\GLOBALROOT\\Device\\HarddiskVolumeShadowCopy(.+)\\|/system32/config/SAM)'')', '2025-09-05 23:15:49.443817', true, false, 'origin', NULL, '[]');
INSERT INTO public.utm_correlation_rules VALUES (1348, 'Windows: IIS HTTP Logging Disabled', 3, 2, 3, 'Defense Evasion', 'Disable Windows Event Logging', 'Identifies when Internet Information Services (IIS) HTTP Logging is disabled on a server. An attacker with IIS server access via a webshell or other mechanism can disable HTTP Logging as an effective anti-forensics measure.', '["https://attack.mitre.org/tactics/TA0005/","https://attack.mitre.org/techniques/T1562/002/"]', 'safe("log.winlogEventDataProcessName", "").contains(''appcmd.exe'') && safe("log.message", "").matches(''(/dontLog(.+):(.+)True)'') && !(safe("log.parentProcessName", "").contains(''iissetup.exe''))', '2025-09-05 23:50:32.415112', true, false, 'origin', NULL, '[]');
INSERT INTO public.utm_correlation_rules VALUES (1391, 'Windows: Suspicious Execution from mounted device', 1, 2, 3, 'Defense Evasion', 'Process Injection', 'Identifies suspicious process access events from an unknown memory region. Endpoint security solutions usually hook userland Windows APIs in order to decide if the code that is being executed is malicious or not. It''s possible to bypass hooked functions by writing malicious functions that call syscalls directly.', '["https://attack.mitre.org/tactics/TA0005/","https://attack.mitre.org/techniques/T1055/"]', 'safe("log.eventType", "") == ''start'' && safe("log.process.executable", "").matches("(^C:\\\\)") && safe("log.processWorkingDirectory", "").matches("((^\\w:\\\\)") && !safe("log.processWorkingDirectory", "").matches("(^C:\\\\)") &&
      safe("log.processParentName", "").contains("explorer.exe") && safe("log.processName", "") in [''rundll32.exe'', ''mshta.exe'', ''powershell.exe'', ''pwsh.exe'', ''cmd.exe'', ''regsvr32.exe'', ''cscript.exe'', ''wscript.exe'']', '2025-09-06 00:01:14.413568', true, false, 'origin', NULL, '[]');
INSERT INTO public.utm_correlation_rules VALUES (1416, 'Windows: Persistence via Update Orchestrator Service Hijack', 2, 3, 2, 'Persistence', 'Windows Service', 'Identifies potential hijacking of the Microsoft Update Orchestrator Service to establish persistence with an integrity level of SYSTEM.', '["https://attack.mitre.org/tactics/TA0003/","https://attack.mitre.org/techniques/T1543/003/"]', 'safe("log.message", "").contains("UsoSvc") && 
       safe("log.eventDataParentProcessName", "").matches("C:\\\\Windows\\\\System32\\\\svchost\\.exe") && 
       !safe("log.winlogEventDataProcessName", "").matches("MoUsoCoreWorker\\.exe|OfficeC2RClient\\.exe") && 
       !safe("log.winlogEventDataProcessName", "").matches("ProgramData\\\\Microsoft\\\\Windows\\\\UUS\\\\Packages\\\\.*\\\\amd64\\\\MoUsoCoreWorker\\.exe|Windows\\\\System32\\\\UsoClient\\.exe|Windows\\\\System32\\\\MusNotification\\.exe|Windows\\\\System32\\\\MusNotificationUx\\.exe|Windows\\\\System32\\\\MusNotifyIcon\\.exe|Windows\\\\System32\\\\WerFault\\.exe|Windows\\\\System32\\\\WerMgr\\.exe|Windows\\\\UUS\\\\amd64\\\\MoUsoCoreWorker\\.exe|Windows\\\\System32\\\\MoUsoCoreWorker\\.exe|Windows\\\\UUS\\\\amd64\\\\UsoCoreWorker\\.exe|Windows\\\\System32\\\\UsoCoreWorker\\.exe|Program Files\\\\Common Files\\\\microsoft shared\\\\ClickToRun\\\\OfficeC2RClient\\.exe")', '2025-09-06 00:25:27.423917', true, false, 'origin', NULL, '[]');
INSERT INTO public.utm_correlation_rules VALUES (1422, 'Windows: Suspicious PowerShell Engine ImageLoad', 1, 3, 2, 'Execution', 'Command and Scripting Interpreter', 'Identifies the PowerShell engine being invoked by unexpected processes. Rather than executing PowerShell functionality with powershell.exe, some attackers do this to operate more stealthily.', '["https://attack.mitre.org/tactics/TA0002/","https://attack.mitre.org/techniques/T1059/"]', '!(safe("log.winlogEventDataProcessName", "") in ["Altaro.SubAgent.exe", "AppV_Manage.exe", "azureadconnect.exe", "CcmExec.exe", "configsyncrun.exe", "choco.exe", "ctxappvservice.exe", "DVLS.Console.exe", "edgetransport.exe", "exsetup.exe", "forefrontactivedirectoryconnector.exe", "InstallUtil.exe", "JenkinsOnDesktop.exe", "Microsoft.EnterpriseManagement.ServiceManager.UI.Console.exe", "mmc.exe", "mscorsvw.exe", "msexchangedelivery.exe", "msexchangefrontendtransport.exe", "msexchangehmworker.exe", "msexchangesubmission.exe", "msiexec.exe", "MsiExec.exe", "noderunner.exe", "NServiceBus.Host.exe", "NServiceBus.Host32.exe", "NServiceBus.Hosting.Azure.HostProcess.exe", "OuiGui.WPF.exe", "powershell.exe", "powershell_ise.exe", "pwsh.exe", "SCCMCliCtrWPF.exe", "ScriptEditor.exe", "ScriptRunner.exe", "sdiagnhost.exe", "servermanager.exe", "setup100.exe", "ServiceHub.VSDetouredHost.exe", "SPCAF.Client.exe", "SPCAF.SettingsEditor.exe", "SQLPS.exe", "telemetryservice.exe", "UMWokerProcess.exe", "w3wp.exe", "wsmprovhost.exe"]) &&
        !(safe("log.winlogEventDataProcessName", "").matches(''(C:\\Windows\\System32\\RemoteFXvGPUDisablement.exe|C:\\Windows\\System32\\sdiagnhost.exe|C:\\Program Files( \\(x86\\))?\\(.+)\\.exe)'')) &&
        safe("log.message", "") in ["System.Management.Automation.ni.dll", "System.Management.Automation.dll"]', '2025-09-06 00:31:58.012388', true, false, 'origin', NULL, '[]');
INSERT INTO public.utm_correlation_rules VALUES (1432, 'Windows: SeDebugPrivilege Enabled by a Suspicious Process', 1, 3, 2, 'Privilege Escalation', 'Access Token Manipulation', 'Identifies the creation of a process running as SYSTEM and impersonating a Windows core binary privileges. Adversaries may create a new process with a different token to escalate privileges and bypass access controls.', '["https://attack.mitre.org/tactics/TA0004/","https://attack.mitre.org/techniques/T1134/"]', 'safe("log.action", "").matches(''(Token Right Adjusted Events)'') && safe("log.eventProvider", "").matches(''(Microsoft-Windows-Security-Auditing)'') &&
      safe("log.eventDataEnabledPrivilegeList", "").matches(''(SeDebugPrivilege)'') && !(safe("log.eventDataSubjectUserSid", "") in [''S-1-5-18'', ''S-1-5-19'', ''S-1-5-20'']) && !(safe("log.eventDataProcessName", "").matches(''(:\\Windows\\System32\\msiexec.exe|:\\Windows\\SysWOW64\\msiexec.exe|:\\Windows\\System32\\lsass.exe|:\\Windows\\WinSxS\\|:\\Program Files\\|:\\Program Files (x86)\\|:\\Windows\\System32\\MRT.exe|:\\Windows\\System32\\cleanmgr.exe|:\\Windows\\System32\\taskhostw.exe|:\\Windows\\System32\\mmc.exe|:\\Users\\(.+)\\AppData\\Local\\Temp\\(.+)-(.+)\\DismHost.exe|:\\Windows\\System32\\auditpol.exe|:\\Windows\\System32\\wbem\\WmiPrvSe.exe|:\\Windows\\SysWOW64\\wbem\\WmiPrvSe.exe)''))', '2025-09-06 00:57:58.530185', true, false, 'origin', NULL, '[]');
INSERT INTO public.utm_correlation_rules VALUES (1441, 'Windows: Bypass UAC via Sdclt', 3, 3, 2, 'Privilege Escalation', 'Abuse Elevation Control Mechanism: Bypass User Account Control', 'Identifies User Account Control (UAC) bypass via sdclt.exe. Attackers bypass UAC to stealthily execute code with elevated permissions.', '["https://attack.mitre.org/tactics/TA0004/","https://attack.mitre.org/techniques/T1548/002/"]', 'safe("log.winlogEventDataProcessName", "").contains("sdclt.exe") && safe("log.message", "").contains("/kickoffelev") &&
      safe("log.winlogEventDataParentProcessName", "").contains("sdclt.exe") && !safe("log.winlogEventDataProcessName", "").matches("(C:\\Windows\\System32\\sdclt.exe|C:\\Windows\\System32\\control.exe|C:\\Windows\\SysWOW64\\sdclt.exe|C:\\Windows\\SysWOW64\\control.exe)")', '2025-09-06 00:59:06.118034', true, false, 'origin', NULL, '[{"indexPattern":"v11-log-wineventlog-*","with":[{"field":"log.winlogEventDataProcessID.keyword","operator":"filter_term","value":"{{.log.winlogEventDataProcessID}}"}],"or":[],"within":"now-5m","count":3}]');
INSERT INTO public.utm_correlation_rules VALUES (1491, 'Windows: New ActiveSyncAllowedDeviceID Added via PowerShell', 3, 2, 1, 'Persistence', 'Additional Email Delegate Permissions', 'Identifies the use of the Exchange PowerShell cmdlet, Set-CASMailbox, to add a new ActiveSync allowed device. Adversaries may target user email to collect sensitive information.', '["https://attack.mitre.org/tactics/TA0003/","https://attack.mitre.org/techniques/T1098/002/"]', 'safe("log.eventDataProcessName", "") in ["powershell.exe", "pwsh.exe", "powershell_ise.exe"] && safe("log.message", "").matches(''(Set-CASMailbox(.+)ActiveSyncAllowedDeviceIDs)'')', '2025-09-06 11:41:32.264958', true, false, 'origin', NULL, '[]');
INSERT INTO public.utm_correlation_rules VALUES (1500, 'Windows: Possible ransomware attack detected. High Volume of File Deletion Events.', 1, 3, 3, 'Ransomware', 'Impact: Data Encrypted for Impact', 'Ransomware, is a type of malware that prevents users from accessing their system or  personal files and requires payment of a ransom in order to gain access to them again. Identifies  ransomware attempts. A high volume of file deletion events has been detected, potentially indicating ransomware activity.', '["https://attack.mitre.org/tactics/TA0040/"]', 'safe("log.eventCode", 0.0) == double(4660)', '2025-09-06 11:50:20.67611', true, false, 'origin', NULL, '[]');
INSERT INTO public.utm_correlation_rules VALUES (1503, 'Windows: Possible ransomware attack detected. Unexpected PowerShell Activity.', 2, 3, 2, 'Ransomware', 'Execution: Scripting', 'Ransomware, is a type of malware that prevents users from accessing their system or  personal files and requires payment of a ransom in order to gain access to them again. Identifies  ransomware attempts. An unexpected PowerShell execution has been detected, potentially indicating ransomware or other malicious activity.', '["https://attack.mitre.org/techniques/T1059/"]', ' safe("log.eventDataObjectName", "").contains(".ps1") && !(safe("log.winlogEventDataSubjectUserName", "") in [''SYSTEM'', ''NETWORK SERVICE'', ''LOCAL SERVICE'']) &&
      safe("log.winlogEventDataProcessName", "").matches(''(cmd.exe|powershell.exe|mmc.exe|regedit.exe)'') && (safe("log.eventCode", 0.0) == double(4688) || safe("log.eventCode", 0.0) == double(592))', '2025-09-06 12:02:26.06531', true, false, 'origin', NULL, '[]');
INSERT INTO public.utm_correlation_rules VALUES (119, 'AWS IAM Deactivation of MFA Device', 3, 2, 2, 'Account Access Removal', 'Impact', 'Identifies the deactivation of a specified multi-factor authentication (MFA) device and removes it from association with the user name for which it was originally enabled. In AWS Identity and Access Management (IAM), a device must be deactivated before it can be deleted', '["https://attack.mitre.org/tactics/TA0040/","https://attack.mitre.org/techniques/T1531/","https://awscli.amazonaws.com/v2/documentation/api/latest/reference/iam/deactivate-mfa-device.html","https://docs.aws.amazon.com/IAM/latest/APIReference/API_DeactivateMFADevice.html"]', 'safe("log.eventSource", "") == "iam.amazonaws.com" && (safe("log.eventName", "") == "DeactivateMFADevice" || safe("log.eventName", "") == "DeleteVirtualMFADevice")', '2025-09-03 12:27:56.855017', true, false, 'origin', NULL, '[]');
INSERT INTO public.utm_correlation_rules VALUES (120, 'AWS IAM Group Deletion', 3, 2, 2, 'Account Access Removal', 'Impact', 'Identifies the deletion of a specified AWS Identity and Access Management (IAM) resource group. Deleting a resource group does not delete resources that are members of the group; it only deletes the group structure', '["https://attack.mitre.org/tactics/TA0040/","https://attack.mitre.org/techniques/T1531/","https://awscli.amazonaws.com/v2/documentation/api/latest/reference/iam/delete-group.html","https://docs.aws.amazon.com/IAM/latest/APIReference/API_DeleteGroup.html"]', 'safe("log.eventSource", "") == "iam.amazonaws.com" && safe("log.eventName", "") == "DeleteGroup"', '2025-09-03 12:27:57.736381', true, false, 'origin', NULL, '[]');
INSERT INTO public.utm_correlation_rules VALUES (121, 'AWS RDS Cluster Deletion', 3, 2, 2, 'Data Destruction', 'Impact', 'Identifies the deletion of an Amazon Relational Database Service (RDS) Aurora database cluster or global database cluster', '["https://attack.mitre.org/tactics/TA0040/","https://attack.mitre.org/techniques/T1485/","https://awscli.amazonaws.com/v2/documentation/api/latest/reference/rds/delete-db-cluster.html","https://docs.aws.amazon.com/AmazonRDS/latest/APIReference/API_DeleteDBCluster.html","https://awscli.amazonaws.com/v2/documentation/api/latest/reference/rds/delete-global-cluster.html","https://docs.aws.amazon.com/AmazonRDS/latest/APIReference/API_DeleteGlobalCluster.html"]', 'safe("log.eventSource", "") == "rds.amazonaws.com" && safe("log.eventName", "") in ["DeleteDBCluster", "DeleteGlobalCluster"]', '2025-09-03 12:27:58.696605', true, false, 'origin', NULL, '[]');
INSERT INTO public.utm_correlation_rules VALUES (1497, 'Windows: Privilege Escalation via Rogue Named Pipe Impersonation', 1, 3, 2, 'Privilege Escalation', 'Access Token Manipulation', 'Identifies a privilege escalation attempt via rogue named pipe impersonation. An adversary may abuse this technique by masquerading as a known named pipe and manipulating a privileged process to connect to it.', '["https://attack.mitre.org/tactics/TA0004/","https://attack.mitre.org/techniques/T1134/"]', 'safe("log.winlogEventDataProcessName", "").matches("(\\(.+)\\Pipe\\)") && safe("log.action", "").contains("Pipe Created")', '2025-09-04 21:16:07.52374', true, false, 'origin', NULL, '[]');
INSERT INTO public.utm_correlation_rules VALUES (122, 'AWS RDS Security Group Deletion', 3, 2, 2, 'Account Access Removal', 'Impact', 'Identifies the deletion of an Amazon Relational Database Service (RDS) Security Group.<br>The adversary is trying to manipulate, interrupt, or destroy your systems and data.Adversaries may interrupt availability of system and network resources by inhibiting access to accounts utilized by legitimate users. Accounts may be deleted, locked, or manipulated (ex: changed credentials) to remove access to accounts<br><br><string>Potential false positive</string><br>A RDS security group deletion may be done by a system or network administrator. Verify whether the user identity, user agent, and/or hostname should be making changes in your environment. Security Group deletions from unfamiliar users or hosts should be investigated. If known behavior is causing false positives, it can be exempted from the rule.', '["https://attack.mitre.org/tactics/TA0040/","https://attack.mitre.org/techniques/T1531/","https://docs.aws.amazon.com/AmazonRDS/latest/APIReference/API_DeleteDBSecurityGroup.html"]', 'safe("log.eventSource", "") == "rds.amazonaws.com" && safe("log.eventName", "") == "DeleteDBSecurityGroup"', '2025-09-03 12:27:59.156665', true, false, 'origin', NULL, '[]');
INSERT INTO public.utm_correlation_rules VALUES (227, 'Meraki IDS High Priority Intrusion Alert', 3, 3, 2, 'Initial Access', 'T1190 - Exploit Public-Facing Application', 'Detects high and medium priority intrusion detection alerts from Meraki IDS/IPS system. These alerts indicate potential exploitation attempts, malicious traffic patterns, or known attack signatures detected by the Snort engine.

Next Steps:
1. Review the specific signature that triggered the alert and assess its severity
2. Investigate the source IP for additional malicious activity or reputation
3. Check if the destination system shows signs of compromise
4. Verify if this is part of a larger attack campaign by correlating with other security events
5. Consider blocking the source IP if confirmed malicious
6. Review firewall rules and IPS signatures for potential tuning
7. Document the incident and update threat intelligence feeds if applicable
', '["https://documentation.meraki.com/General_Administration/Monitoring_and_Reporting/Syslog_Event_Types_and_Log_Samples","https://attack.mitre.org/techniques/T1190/"]', 'safe("log.eventType", "") == "security_event" && safe("log.alertType", "") == "ids_alerted" && safe("log.priority", 99) <= 2 && safe("origin.ip", "") != "" && safe("target.ip", "") != ""', '2025-09-03 13:17:00.206776', true, false, 'origin', '["origin.ip","log.signature"]', '[]');
INSERT INTO public.utm_correlation_rules VALUES (109, 'AWS WAF Access Control List Deletion', 3, 2, 2, 'Indicator Removal on Host', 'Defense Evasion', 'Identifies the deletion of a specified AWS Web Application Firewall (WAF) access control list', '["https://attack.mitre.org/tactics/TA0005/","https://attack.mitre.org/techniques/T1562/","https://awscli.amazonaws.com/v2/documentation/api/latest/reference/waf-regional/delete-web-acl.html","https://docs.aws.amazon.com/waf/latest/APIReference/API_wafRegional_DeleteWebACL.html"]', 'safe("log.eventName", "") == ''DeleteWebACL''', '2025-09-03 12:27:12.183103', true, false, 'origin', NULL, '[]');
INSERT INTO public.utm_correlation_rules VALUES (132, 'AWS Root Login Without MFA', 3, 2, 2, 'Valid Accounts', 'Privilege Escalation', 'Identifies attempts to login to AWS as the root user without using multi-factor authentication (MFA). Amazon AWS best practices indicate that the root user should be protected by MFA', '["https://attack.mitre.org/tactics/TA0004/","https://attack.mitre.org/techniques/T1078/","https://docs.aws.amazon.com/IAM/latest/UserGuide/id_root-user.html"]', 'safe("log.eventSource", "") == "signin.amazonaws.com" && safe("log.eventName", "") == "ConsoleLogin" && safe("log.userIdentityType", "") == "root" && safe("log.additionalEventData.MFAUsed", "") == "no"', '2025-09-05 14:49:53.900309', true, false, 'origin', NULL, '[]');
INSERT INTO public.utm_correlation_rules VALUES (133, 'AWS IAM Assume Role Policy Update', 3, 2, 2, 'Valid Accounts', 'Privilege Escalation', 'Identifies attempts to modify an AWS IAM Assume Role Policy. An adversary may attempt to modify the AssumeRolePolicy of a misconfigured role in order to gain the privileges of that role', '["https://attack.mitre.org/tactics/TA0004/","https://attack.mitre.org/techniques/T1078/","https://labs.bishopfox.com/tech-blog/5-privesc-attack-vectors-in-aws"]', 'safe("log.eventSource", "") == "iam.amazonaws.com" && safe("log.eventName", "") == "UpdateAssumeRolePolicy"', '2025-09-03 12:39:16.922854', true, false, 'origin', NULL, '[]');
INSERT INTO public.utm_correlation_rules VALUES (303, 'Office 365 App Consent Grants Detected', 3, 3, 1, 'Persistence, Privilege Escalation', 'T1098.003 - Account Manipulation: Additional Cloud Credentials', 'Detects when OAuth consent is granted to an application in Office 365. Attackers may use malicious OAuth apps to gain persistent access to user data without requiring credentials. This technique allows attackers to maintain access even after password changes.

Next Steps:
1. Review the application that received consent and verify its legitimacy
2. Check the permissions granted to the application
3. Investigate the user who granted consent for suspicious activity
4. Review application audit logs for any unauthorized data access
5. If malicious, revoke the application consent and remove the app registration
6. Consider implementing application consent policies to prevent unauthorized app installations
', '["https://learn.microsoft.com/en-us/defender-office-365/detect-and-remediate-illicit-consent-grants","https://attack.mitre.org/techniques/T1098/003/"]', 'safe("action", "") == "Consent to application" && safe("actionResult", "") == "Success"', '2025-09-03 14:46:46.741549', true, false, 'origin', '["origin.user","log.appAccessContextClientAppId"]', '[]');
INSERT INTO public.utm_correlation_rules VALUES (1484, 'Windows: Probable spoofing attack', 2, 1, 3, 'Impact', 'IP address spoofing', 'IPsec dropped an inbound clear text packet that should have been secured. This is usually due to the remote  computer changing its IPsec policy without informing this computer. This could also be a spoofing attack attempt.', '["https://attack.mitre.org/tactics/TA0040","https://attack.mitre.org/techniques/T1499/","https://www.windows-security.org/windows-event-id/4963-ipsec-dropped-an-inbound-clear-text-packet-that-should-have-been-secured-this-is-usually-due-to-the"]', 'safe("log.eventCode", 0.0) in [double(4961), double(4649)]', '2025-09-05 22:32:56.803293', true, false, 'origin', NULL, '[]');
INSERT INTO public.utm_correlation_rules VALUES (110, 'AWS WAF Rule or Rule Group Deletion', 3, 2, 2, 'Impair Defenses', 'Defense Evasion', 'Identifies the deletion of a specified AWS Web Application Firewall (WAF) rule or rule group', '["https://attack.mitre.org/tactics/TA0005/","https://attack.mitre.org/techniques/T1562/","https://awscli.amazonaws.com/v2/documentation/api/latest/reference/waf/delete-rule-group.html","https://docs.aws.amazon.com/waf/latest/APIReference/API_waf_DeleteRuleGroup.html"]', 'safe("log.eventName", "") == ''DeleteRule'' || safe("log.eventName", "") == ''DeleteRuleGroup''', '2025-09-03 12:27:13.368517', true, false, 'origin', NULL, '[]');
INSERT INTO public.utm_correlation_rules VALUES (123, 'AWS RDS Instance/Cluster Stoppage', 3, 2, 2, 'Service Stop', 'Impact', 'Identifies that an Amazon Relational Database Service (RDS) cluster or instance has been stopped. Adversaries may stop or disable services on a system to render those services unavailable to legitimate users. Stopping critical services or processes can inhibit or stop response to an incident or aid in the adversary''s overall objectives to cause damage to the environment.<br><br><strong>Potential false positives</strong><br>Valid clusters or instances may be stopped by a system administrator. Verify whether the user identity, user agent, and/or hostname should be making changes in your environment. Cluster or instance stoppages from unfamiliar users or hosts should be investigated. If known behavior is causing false positives, it can be exempted from the rule.', '["https://attack.mitre.org/tactics/TA0040/","https://attack.mitre.org/techniques/T1489/","https://awscli.amazonaws.com/v2/documentation/api/latest/reference/rds/stop-db-cluster.html","https://docs.aws.amazon.com/AmazonRDS/latest/APIReference/API_StopDBCluster.html","https://awscli.amazonaws.com/v2/documentation/api/latest/reference/rds/stop-db-instance.html","https://docs.aws.amazon.com/AmazonRDS/latest/APIReference/API_StopDBInstance.html"]', 'safe("log.eventSource", "") == "rds.amazonaws.com" && safe("log.eventName", "") in ["StopDBCluster", "StopDBInstance"]', '2025-09-03 12:27:59.994174', true, false, 'origin', NULL, '[]');
INSERT INTO public.utm_correlation_rules VALUES (332, 'GCP probable hijacked account', 3, 3, 2, 'Collection', 'Archive Collected Data', 'A user''s account was disabled because Google has detected a suspicious activity  indicating it might have been compromised. Hijacked account can be used to perform other attacks like data collection and exfiltration', '["https://attack.mitre.org/tactics/TA0009/","https://attack.mitre.org/techniques/T1560"]', 'safe("log.protoPayload.methodName", "") == ''google.login.LoginService.accountDisabledHijacked''', '2025-09-03 14:59:31.226528', true, false, 'target', NULL, '[]');
INSERT INTO public.utm_correlation_rules VALUES (391, 'Probable Sophos initial access vulnerability', 2, 2, 1, 'Initial Access', 'Default Accounts', 'Sophos firewall has detected the Guest account activation', '["https://attack.mitre.org/tactics/TA0001/","https://attack.mitre.org/techniques/T1078/001/"]', 'safe("log.Id", "").endsWith("17925")', '2025-09-03 15:05:39.204904', true, false, 'origin', NULL, '[]');
INSERT INTO public.utm_correlation_rules VALUES (1339, 'Windows: Microsoft Build Engine Started by an Office Application', 3, 3, 1, 'Defense Evasion', 'MSBuild', 'An instance of MSBuild, the Microsoft Build Engine, was started by Excel or Word. This is unusual behavior for the Build Engine and could have been caused by an Excel or Word document executing a malicious script payload.', '["https://attack.mitre.org/tactics/TA0005/","https://attack.mitre.org/techniques/T1127/001/"]', 'safe("log.winlogEventDataProcessName", "").matches("MSBuild.exe") && safe("log.winlogEventDataParentProcessName", "").matches("(eqnedt32.exe|excel.exe|fltldr.exe|msaccess.exe|mspub.exe|outlook.exe|powerpnt.exe|winword.exe)")', '2025-09-04 20:23:55.61127', true, false, 'origin', NULL, '[]');
INSERT INTO public.utm_correlation_rules VALUES (1345, 'Windows: General account database change', 3, 3, 2, 'Potentially Malicious Activity', 'Account Manipulation', 'Adversaries may manipulate accounts to maintain access to victim systems.  Account manipulation may consist of any action that preserves adversary access to a compromised account,  such as modifying credentials or permission groups. ', '["https://attack.mitre.org/techniques/T1098/"]', 'safe("log.eventCode", 0.0) == double(640)', '2025-09-04 20:24:34.031996', true, false, 'origin', NULL, '[]');
INSERT INTO public.utm_correlation_rules VALUES (4, 'Bitdefender GravityZone High-Severity Threat Detection', 3, 3, 3, 'Execution', 'T1204 - User Execution', 'Detects high-severity threats identified by Bitdefender GravityZone including advanced malware, ransomware, and critical security incidents requiring immediate attention.

Next Steps:
1. Immediately isolate the affected endpoint to prevent lateral movement
2. Review the threat details in Bitdefender GravityZone console for threat type and actions taken
3. Check the process that triggered the alert (log.processPid) and terminate if still running
4. Investigate the origin IP (origin.ip) for suspicious network connections
5. Review recent file modifications and network activity on the affected host
6. If ransomware is detected, initiate incident response procedures immediately
7. Collect forensic data from the endpoint before remediation
8. Update endpoint protection signatures and run a full system scan
9. Document the incident and update security controls based on findings
10. Check if other endpoints have similar infections using the signature ID
', '["https://www.bitdefender.com/business/support/en/77212-237089-event-types.html","https://attack.mitre.org/tactics/TA0002/"]', '(safe("log.severity", "") == "10" || safe("log.severity", "") == "9" || safe("log.severity", "") == "8") && (safe("log.eventType", "") == "AntiMalware" || safe("log.eventType", "") == "HyperDetect Activity" || safe("log.eventType", "") == "Sandbox Analyzer Detection" || safe("log.eventType", "") == "Ransomware Detection" || safe("log.eventType", "") == "Exploit Mitigation")', '2025-09-03 11:53:39.009081', true, false, 'origin', '["log.hostId","log.signatureID"]', '[]');
INSERT INTO public.utm_correlation_rules VALUES (5, 'Crypto-Mining Detection', 3, 2, 3, 'Impact', 'T1496 - Resource Hijacking', 'Detects cryptocurrency mining activities including miners, coin miners, and cryptojacking attempts detected by Bitdefender GravityZone.

Next Steps:
- Review the affected endpoint details (hostname, IP) to identify the compromised system
- Check CPU and memory usage patterns on the affected system for unusual spikes
- Look for network connections to known mining pools or suspicious outbound traffic
- Search for related processes running with names like xmrig, minerd, cgminer, or bfgminer
- Review recent file downloads and installations on the affected system
- Check for persistence mechanisms (scheduled tasks, startup items, services)
- Isolate the affected system if active mining is confirmed
- Run a full system scan with updated definitions
- Consider reimaging the system if compromise is extensive', '["https://www.bitdefender.com/business/support/en/77212-237089-event-types.html","https://attack.mitre.org/techniques/T1496/"]', 'safe("log.productVendor", "") == "Bitdefender" && safe("log.product", "") == "GravityZone" && ( safe("log.eventType", "").lower().contains("miner") || safe("log.eventType", "").lower().contains("coin") || safe("log.eventType", "").lower().contains("crypto") || safe("log.requested", "").lower().contains("miner") || safe("log.requested", "").lower().contains("coin") || safe("log.requested", "").lower().contains("xmr") || safe("log.requested", "").lower().contains("monero") || safe("log.requested", "").lower().contains("bitcoin") || safe("log.requested", "").lower().contains("ethereum") || safe("log.requested", "").lower().contains("xmrig") || safe("log.requested", "").lower().contains("minerd") || safe("log.requested", "").lower().contains("cgminer") || safe("log.requested", "").lower().contains("bfgminer") || safe("log.requested", "").lower().contains("coinhive") || (safe("log.signatureID", "") != "" && (safe("log.eventType", "").contains("Application.CoinMiner")) )', '2025-09-03 11:53:39.819158', true, false, 'origin', '["origin.ip","origin.host"]', '[]');
INSERT INTO public.utm_correlation_rules VALUES (1485, 'Windows: Potential DNS Tunneling via NsLookup', 3, 2, 1, 'Command and Control', 'Application Layer Protocol', 'This rule identifies a large number of nslookup.exe executions with an explicit query type from the same host. This may indicate command and control activity utilizing the DNS protocol.', '["https://attack.mitre.org/tactics/TA0011/","https://attack.mitre.org/techniques/T1071/"]', 'safe("log.eventDataProcessName", "").contains("nslookup.exe") && safe("log.message", "").matches("(-querytype=|-qt=|-q=|-type=)")', '2025-09-04 21:15:03.944135', true, false, 'origin', NULL, '[]');
INSERT INTO public.utm_correlation_rules VALUES (955, 'System Linux: High Number of Process Terminations', 3, 2, 0, 'Impact', 'Service Stop', 'This rule identifies a high number (10) of process terminations via pkill from the same host within a short time period.', '["https://attack.mitre.org/tactics/TA0040/","https://attack.mitre.org/techniques/T1489/"]', 'safe("log.message", "").matches("pkill -f")', '2025-09-03 16:37:35.188039', true, false, 'origin', NULL, '[]');
INSERT INTO public.utm_correlation_rules VALUES (1359, 'Windows: Microsoft security essentials - Service failed', 3, 3, 2, 'Potentially Malicious Activity', 'Service Stop', 'Adversaries may stop or disable services on a system to render those services unavailable to legitimate users.  Stopping critical services or processes can inhibit or stop response to an incident  or aid in the adversarys overall objectives to cause damage to the environment', '["https://attack.mitre.org/techniques/T1489/"]', 'safe("log.eventCode", 0.0) == double(5008) && safe("log.winlogProviderName", "") == "Microsoft Antimalware"', '2025-09-04 20:25:26.892841', true, false, 'origin', NULL, '[]');
INSERT INTO public.utm_correlation_rules VALUES (6, 'Email-Based Threat Spreading', 3, 3, 2, 'Initial Access', 'T1566 - Phishing', 'Detects email-based malware spreading including phishing attempts, malicious attachments, and email-borne threats through Bitdefender''s Exchange protection. This rule triggers on Exchange-specific malware events and monitors for patterns of email-based threats.

Next Steps:
1. Investigate the affected email and sender:
   - Check the sender''s email address and domain reputation
   - Review email headers for spoofing indicators
   - Analyze attachment hash values if present in log.restData
   - Check log.severity for threat level assessment
2. Review related events:
   - Look for similar events from the same sender or to other recipients
   - Check if the email was delivered or blocked
   - Verify if any users clicked links or opened attachments
   - Search for the same signatureID across other hosts
3. Remediation actions:
   - If delivered, recall the email from all recipients immediately
   - Reset credentials if phishing was successful
   - Block sender domain/IP at email gateway
   - Update email security policies if needed
   - Scan affected endpoints for malware if attachments were opened
   - Update Bitdefender Exchange protection rules
4. Investigation commands:
   - Check host status: Verify log.hostId endpoint protection status
   - Review product version: Ensure log.productVersion is up to date
   - Analyze event patterns: Look for unusual log.eventType combinations
', '["https://attack.mitre.org/techniques/T1566/","https://www.bitdefender.com/business/support/en/77209-135324-event-types.html"]', 'safe("log.eventType", "") == "exchange-malware" || safe("log.eventType", "") == "exchange-user-credentials" || safe("log.eventType", "") == "exchange-organization-info" || (safe("log.eventType", "").contains("exchange") && safe("log.severity", "") == "High") || (safe("log.product", "").contains("Exchange") && (safe("log.eventType", "").contains("malware") || safe("log.eventType", "").contains("phishing")))', '2025-09-03 11:53:40.650608', true, false, 'origin', '["log.hostId","log.signatureID"]', '[]');
INSERT INTO public.utm_correlation_rules VALUES (112, 'AWS EC2 Snapshot Activity', 3, 2, 2, 'Transfer Data to Cloud Account', 'Exfiltration', 'An attempt was made to modify AWS EC2 snapshot attributes. Snapshots are sometimes shared by threat actors in order to exfiltrate bulk data from an EC2 fleet. If the permissions were modified, verify the snapshot was not shared with an unauthorized or unexpected AWS account', '["https://attack.mitre.org/tactics/TA0010/","https://attack.mitre.org/techniques/T1537/","https://awscli.amazonaws.com/v2/documentation/api/latest/reference/ec2/modify-snapshot-attribute.html","https://docs.aws.amazon.com/AWSEC2/latest/APIReference/API_ModifySnapshotAttribute.html"]', 'safe("log.eventSource", "") == ''ec2.amazonaws.com'' && safe("log.eventName", "") == ''ModifySnapshotAttribute''', '2025-09-03 12:27:15.292774', true, false, 'target', NULL, '[]');
INSERT INTO public.utm_correlation_rules VALUES (7, 'Failed Antivirus Updates Across Multiple Endpoints', 2, 3, 3, 'Defense Evasion', 'T1562.001 - Impair Defenses: Disable or Modify Tools', 'Detects when antivirus signature updates fail on endpoints. This could indicate network connectivity issues, update server problems, or potentially malicious interference with security updates.

Next Steps:
- Check network connectivity between affected endpoints and update servers
- Review update server logs for errors or performance issues
- Verify BitDefender GravityZone server status and disk space
- Check for any firewall or proxy configuration changes
- Look for signs of malicious activity attempting to disable security updates
- Consider manually triggering updates on affected endpoints
- Review system logs for any related errors during the update window
', '["https://www.bitdefender.com/business/support/en/77212-237089-event-types.html","https://attack.mitre.org/techniques/T1562/001/"]', 'safe("log.eventType", "") == "Update" && (safe("log.message", "").contains("failed") || safe("log.message", "").contains("error")) && safe("log.hostId", "") != ""', '2025-09-03 11:53:41.082004', true, false, 'origin', '["log.hostId"]', '[]');
INSERT INTO public.utm_correlation_rules VALUES (1473, 'Windows Defender: ERROR: REMOVE NOT SUPPORTED', 1, 2, 3, 'Potentially Compromised System', 'User Execution', 'Detects the ''REMOVE NOT SUPPORTED'' error event in Windows Defender, which may indicate that a removal operation is not supported for a specific threat.', '["https://learn.microsoft.com/en-us/windows/security/threat-protection/windows-defender-antivirus/troubleshoot"]', 'safe("log.winlogEventDataLogName", "") == "Microsoft-Windows-Windows Defender/Operational" &&  safe("log.winlogEventDataErrorCode", "") == "0x80508026"', '2025-09-04 21:12:14.013707', true, false, 'target', NULL, '[]');
INSERT INTO public.utm_correlation_rules VALUES (944, 'System Linux: Kernel module load via insmod', 3, 3, 3, 'Persistence', 'Kernel Modules and Extensions', 'Detects the use of the insmod binary to load a Linux kernel object file. Threat actors can use this binary, given they have root privileges,  to load a rootkit on a system providing them with complete control and the ability to hide from security products.  Manually loading a kernel module in this manner should not be at all common and can indicate suspcious or malicious behavior.', '["https://attack.mitre.org/tactics/TA0003/","https://attack.mitre.org/techniques/T1547/006/"]', 'safe("log.message", "").matches("(insmod (.+).ko)")', '2025-09-03 16:36:57.09112', true, false, 'origin', NULL, '[]');
INSERT INTO public.utm_correlation_rules VALUES (1409, 'Windows: Probable Dos Attack', 1, 2, 3, 'Impact', 'Denial of Service (DoS)', 'A Denial of Service (DoS) attack is an attempt to make a machine or network resource unavailable to the intended users. One common method of attack involves saturating the target machine with external communications requests so that it cannot respond to legitimate traffic or the machine responds so slowly that it is essentially useless.', '["https://attack.mitre.org/tactics/TA0040","https://attack.mitre.org/techniques/T1499/","https://docs.microsoft.com/en-us/windows/security/threat-protection/auditing/event-5149","https://docs.microsoft.com/en-us/windows/security/threat-protection/auditing/event-5148"]', 'safe("log.eventCode", 0.0) in [double(5148), double(5149), double(550)]', '2025-09-05 22:29:35.540502', true, false, 'origin', NULL, '[]');
INSERT INTO public.utm_correlation_rules VALUES (1411, 'Windows: Probable defense evasion attack, IPsec or Firewall not working', 2, 3, 1, 'Defense Evasion', 'Impair Defenses: Disable or Modify Tools', 'The adversary is trying to avoid being detected. Defense Evasion consists of techniques that adversaries use to avoid detection throughout their compromise.  Techniques used for defense evasion include uninstalling/disabling security software or obfuscating/encrypting data and scripts.  Adversaries also leverage and abuse trusted processes to hide and masquerade their malware. Other tacticsâ€™ techniques are cross-listed  here when those techniques include the added benefit of subverting defenses. Please see the logs attached to this alert for additional details.', '["https://attack.mitre.org/tactics/TA0005/","https://attack.mitre.org/techniques/T1562/001/"]', 'safe("log.eventCode", 0.0) in [double(4710), double(5479), double(5483), double(5484), double(5025), double(5030)]', '2025-09-05 22:30:23.156276', true, false, 'origin', NULL, '[]');
INSERT INTO public.utm_correlation_rules VALUES (8, 'Fileless Malware Detection', 2, 2, 3, 'Defense Evasion, Privilege Escalation', 'T1055 - Process Injection', 'Detects fileless malware attacks including PowerShell-based attacks, memory injection, and living-off-the-land techniques using Bitdefender GravityZone''s HyperDetect and Command-Line Scanner modules. These attacks execute malicious code directly in memory without writing to disk, making them harder to detect with traditional antivirus.

Next Steps:
- Isolate the affected endpoint immediately to prevent lateral movement
- Review process tree to identify the parent process and initial attack vector
- Check for PowerShell command history and script blocks (Event ID 4104)
- Look for suspicious WMI activity or unusual process spawning patterns
- Examine network connections from the affected process
- Collect memory dump if the process is still running
- Review user activity to determine if account is compromised
- Apply security patches if exploitation of vulnerability is suspected
', '["https://www.bitdefender.com/business/support/en/77212-237089-event-types.html","https://attack.mitre.org/techniques/T1055/","https://www.bitdefender.com/en-us/business/gravityzone-platform/fileless-attack-defense"]', 'safe("log.eventType", "") == "fileless_attack" || safe("log.eventType", "") == "hyperdetect_fileless" || safe("log.eventType", "") == "command_line_scanner" || ( safe("log.eventType", "") == "malware_detected" && ( safe("log.message", "").contains("fileless") || safe("log.message", "").contains("memory injection") || safe("log.message", "").contains("powershell") || safe("log.message", "").contains("wscript") || safe("log.message", "").contains("cscript") || safe("log.message", "").contains("mshta") || safe("log.message", "").contains("regsvr32") || safe("log.message", "").contains("rundll32") ) ) || ( safe("severity", "") in ["HIGH", "CRITICAL"] && safe("log.message", "").contains("code injection") )', '2025-09-03 11:53:41.648332', true, false, 'origin', '["log.hostId"]', '[]');
INSERT INTO public.utm_correlation_rules VALUES (9, 'Bitdefender GravityZone High Severity Threat Detection', 3, 3, 2, 'Execution', 'T1204.002 - User Execution: Malicious File', 'Detects high-severity malware threats identified by Bitdefender GravityZone that require immediate attention. This rule triggers on severity levels 8-10, which indicate critical threats such as trojans, ransomware, rootkits, or other advanced malware.

Next Steps:
1. Immediately isolate the affected endpoint(s) from the network to prevent lateral movement
2. Review the threat details in Bitdefender GravityZone console:
   - Check threat name and malware type from the event details
   - Verify the affected file path and process information
   - Review the action taken by Bitdefender (quarantine, delete, etc.)
3. Investigate the source of infection:
   - Check origin.ip and origin.path for the malware source
   - Review recent user activity and email attachments
   - Look for similar threats on other endpoints
4. Perform forensic analysis:
   - Collect memory dumps if rootkit or fileless malware is suspected
   - Check for persistence mechanisms (registry, scheduled tasks, services)
   - Review network connections from the affected host
5. Remediation actions:
   - Ensure Bitdefender has successfully cleaned/quarantined the threat
   - Run full system scan on affected and neighboring systems
   - Update antivirus signatures and security policies
   - Consider reimaging if system integrity is compromised
', '["https://www.bitdefender.com/business/support/en/77212-237089-event-types.html","https://attack.mitre.org/techniques/T1204/002/","https://attack.mitre.org/techniques/T1055/"]', 'safe("severity", "") in ["8", "9", "10"] && safe("log.eventType", "") in ["avc", "malware_detected", "av"]', '2025-09-03 11:53:42.382068', true, false, 'origin', '["log.syslogHostIP","log.signatureID"]', '[]');
INSERT INTO public.utm_correlation_rules VALUES (1452, 'Windows: User account locked out (multiple login errors)', 1, 2, 3, 'Credential Access', 'Brute Force', 'Adversaries may use brute force techniques to gain access to accounts when passwords are unknown or when password hashes are obtained.', '["https://attack.mitre.org/techniques/T1110/"]', 'safe("log.eventCode", 0.0) == double(644) || safe("log.eventCode", 0.0) == double(4740)', '2025-09-04 21:02:15.614565', true, false, 'origin', NULL, '[]');
INSERT INTO public.utm_correlation_rules VALUES (22, 'Bitdefender GravityZone Suspicious Exclusion Added', 3, 3, 1, 'Defense Evasion', 'T1562.001 - Impair Defenses: Disable or Modify Tools', 'Detects when exclusions are added to Bitdefender GravityZone that may allow malware to operate undetected. Attackers often add exclusions to antivirus software to prevent detection of their malicious tools and activities.

Next Steps:
1. Review the exclusion details to determine what files, folders, or processes were excluded
2. Verify if the exclusion was authorized by security team or IT administrators
3. Check if the excluded path contains any suspicious executables or scripts
4. Review recent activity from the user who added the exclusion
5. If unauthorized, immediately remove the exclusion and scan the excluded locations
6. Consider implementing a change control process for antivirus exclusions
', '["https://www.bitdefender.com/business/support/en/77212-237089-event-types.html","https://attack.mitre.org/techniques/T1562/001/"]', 'safe("log.eventType", "") == "exclusion_added" || (safe("log.eventType", "") == "policy_change" && safe("log.requested", "").contains("exclusion")) || (safe("log.eventType", "") == "configuration_change" && safe("log.requested", "").contains("exclusion"))', '2025-09-03 11:56:28.885195', true, false, 'origin', '["log.hostId"]', '[]');
INSERT INTO public.utm_correlation_rules VALUES (10, 'Bitdefender GravityZone License Expiration Alert', 1, 2, 3, 'Impact', 'T1489 - Service Stop', 'Detects license expiration events for Bitdefender GravityZone that could lead to protection gaps. License expiration can leave systems vulnerable to malware and other security threats due to lack of updates and real-time protection.

Next Steps:
1. Verify the license status in the Bitdefender GravityZone console
2. Check the exact expiration date and renewal status
3. Contact your licensing administrator or vendor for immediate renewal
4. Review all affected systems to ensure continued protection
5. Document the license renewal process to prevent future expirations
6. Set up proactive license monitoring alerts at 30, 15, and 7 days before expiration
7. Ensure backup security measures are in place during any protection gaps
8. Review system logs for any security events that occurred during the protection gap
9. Consider implementing a license management system for all security tools
', '["https://www.bitdefender.com/business/support/en/77212-237089-event-types.html","https://attack.mitre.org/techniques/T1489/"]', 'safe("log.eventType", "") == "license_expired" || safe("log.eventType", "") == "license_expiring" || safe("log.eventType", "") == "license_about_to_expire" || (safe("log.eventType", "") == "Product ModulesStatus" && safe("log.message", "").contains("license")) || (safe("severity", "") == "high" && safe("log.message", "").contains("license expir"))', '2025-09-03 11:53:42.932544', true, false, 'origin', '["log.hostId","log.productVersion"]', '[]');
INSERT INTO public.utm_correlation_rules VALUES (28, 'Deception API Call Tracking', 2, 2, 1, 'Execution', 'T1106 - Native API', 'Tracks suspicious API calls made to decoy services or endpoints. This behavior indicates an attacker is attempting to interact with what they believe are legitimate services but are actually deception assets.

Next Steps:
- Review the source IP address and check if it''s from a known legitimate source
- Examine the API endpoint accessed and the HTTP method used
- Look for other activity from the same IP address across all log sources
- Check if the source IP has accessed multiple decoy endpoints (indicating reconnaissance)
- Investigate any authentication tokens or credentials used in the API calls
- Consider blocking the source IP if malicious intent is confirmed
- Document the attack pattern for threat intelligence sharing
', '["https://attack.mitre.org/techniques/T1106/","https://deceptivebytes.com/solution/"]', 'safe("log.eventType", "") == "api_call" && safe("log.isDecoy", "") == "true" && safe("log.httpMethod", "") != "" && safe("origin.ip", "") != ""', '2025-09-03 12:01:37.207708', true, false, 'origin', '["origin.ip","log.apiEndpoint"]', '[]');
INSERT INTO public.utm_correlation_rules VALUES (11, 'Malware outbreak detection - multiple hosts infected', 3, 3, 3, 'Lateral Movement', 'T1570 - Lateral Tool Transfer', 'Detects when the same malware signature or threat is detected across multiple endpoints within a short time window, indicating a potential malware outbreak or worm propagation within the network.

Next Steps:
- Immediately isolate affected endpoints to prevent further spread
- Review the malware signature ID to identify the specific threat
- Check network shares and removable media that could facilitate spread
- Verify antivirus definitions are up-to-date on all endpoints
- Review user activities and email attachments from the initial infection time
- Consider running full system scans on potentially exposed systems
- Document the outbreak timeline and affected systems for incident response
', '["https://www.bitdefender.com/business/support/en/77212-237089-event-types.html","https://attack.mitre.org/techniques/T1570/"]', 'safe("log.hostId", "") != "" && safe("log.signatureID", "") != "" && ( safe("log.eventType", "").lower().contains("malware") || safe("log.eventType", "").lower().contains("virus") || safe("log.eventType", "").lower().contains("trojan") || safe("log.eventType", "").lower().contains("ransomware") || safe("log.eventType", "").lower().contains("infected") || safe("log.eventType", "").lower().contains("av") || safe("log.eventType", "").lower().contains("antimalware") ) && safe("severity", "") != "" && int(safe("severity", "0")) >= 7', '2025-09-03 11:55:43.997057', true, false, 'origin', '["adversary.host"]', '[]');
INSERT INTO public.utm_correlation_rules VALUES (131, 'AWS Route 53 Domain Transferred to Another Account', 3, 3, 3, 'Account Manipulation', 'Persistence', 'Identifies when a request has been made to transfer a Route 53 domain to another AWS account', '["https://attack.mitre.org/tactics/TA0003/","https://attack.mitre.org/techniques/T1098/","https://attack.mitre.org/tactics/TA0006/","https://docs.aws.amazon.com/Route53/latest/APIReference/API_Operations_Amazon_Route_53.html"]', 'safe("log.eventSource", "") == "route53.amazonaws.com" && safe("log.eventName", "") == "TransferDomainToAnotherAwsAccount"', '2025-09-03 12:39:15.515831', true, false, 'origin', NULL, '[]');
INSERT INTO public.utm_correlation_rules VALUES (1206, 'TCP Option Field Exploitation', 3, 3, 3, 'Command and Control', 'Protocol Manipulation', 'Detects exploitation attempts using TCP option fields including malformed options, unusual option combinations, or option field buffer overflows that could be used for reconnaissance, evasion, or system compromise.

Next Steps:
1. Analyze the source IP for known malicious activity or scanning behavior
2. Review the specific TCP options being used to understand the attack vector
3. Check if the target system shows signs of compromise or unusual behavior
4. Examine network traffic patterns from the source IP for additional reconnaissance attempts
5. Consider blocking the source IP if malicious intent is confirmed
6. Update firewall rules to filter malformed TCP options if appropriate
', '["https://datatracker.ietf.org/doc/html/rfc6587","https://attack.mitre.org/techniques/T1095/"]', '(safe("log.tcp_options_length", 0) > 40 ||
 safe("log.tcp_options_count", 0) > 10 ||
 safe("log.tcp_malformed_options", false) == true ||
 safe("log.tcp_option_nop_sled", false) == true) &&
((safe("log.tcp_option_mss", 0) > 0 && safe("log.tcp_option_mss", 0) < 536) ||
 safe("log.tcp_option_mss", 0) > 65535 ||
 safe("log.tcp_option_window_scale", 0) > 14)
', '2025-09-04 16:08:51.764178', true, false, 'origin', '["adversary.ip","target.ip","log.tcp_options_signature"]', '[{"indexPattern":"v11-log-syslog-*","with":[{"field":"origin.ip.keyword","operator":"filter_term","value":"{{.origin.ip}}"},{"field":"log.tcp_malformed_options","operator":"filter_term","value":"true"}],"or":null,"within":"now-30m","count":10}]');
INSERT INTO public.utm_correlation_rules VALUES (1502, 'Windows: Possible ransomware attack detected. Ransomware Note Creation.', 3, 3, 2, 'Ransomware', 'Impact: Data Encrypted for Impact', 'Ransomware, is a type of malware that prevents users from accessing their system or  personal files and requires payment of a ransom in order to gain access to them again. Identifies  ransomware attempts. A known ransomware note file has been detected, potentially indicating an active ransomware infection.', '["https://attack.mitre.org/tactics/TA0040/"]', 'safe("log.eventCode", 0.0) == double(4663) && safe("log.wineventlogEventDataFileName", "").matches("(README_TO_RESTORE_FILES|INSTRUCTION_TO_GET_FILES_BACK|HOW_TO_DECRYPT_FILES|DECRYPT_INSTRUCTION|RECOVER_INSTRUCTION|RESTORE_FILES|READ_ME_NOW|YOUR_FILES_ARE_ENCRYPTED|IMPORTANT_INSTRUCTIONS|NOTICE|DECRYPT_YOUR_FILES|HOW_TO_RESTORE_FILES|HELP_DECRYPT|RECOVERY_FILE|RECOVER-FILES|INSTRUCTION)\\.(txt|html|php)$")', '2025-09-05 20:10:43.209673', true, false, 'origin', NULL, '[{"indexPattern":"v11-log-wineventlog-*","with":[{"field":"log.eventCode","operator":"filter_term","value":"{{.log.eventCode}}"},{"field":"log.wineventlogEventDataFileName.keyword","operator":"filter_term","value":"{{.log.wineventlogEventDataFileName}}"}],"or":[],"within":"now-60s","count":5}]');
INSERT INTO public.utm_correlation_rules VALUES (1393, 'Windows: Suspicious WMI Image Load from MS Office', 1, 2, 3, 'Execution', 'Windows Management Instrumentation', 'Identifies a suspicious image load (wmiutils.dll) from Microsoft Office processes. This behavior may indicate adversarial activity where child processes are spawned via Windows Management Instrumentation (WMI). This technique can be used to execute code and evade traditional parent/child processes spawned from Microsoft Office products.', '["https://attack.mitre.org/tactics/TA0002/","https://attack.mitre.org/techniques/T1047/"]', 'safe("log.eventDataProcessName", "").matches("(WINWORD.EXE|EXCEL.EXE|POWERPNT.EXE|MSPUB.EXE|MSACCESS.EXE)") && safe("log.message", "").contains("wmiutils.dll")', '2025-09-04 20:46:19.103873', true, false, 'origin', NULL, '[]');
INSERT INTO public.utm_correlation_rules VALUES (12, 'Malware Outbreak Detection - Multiple Hosts Infected', 3, 3, 2, 'Command and Control', 'T1105 - Ingress Tool Transfer', 'Detects when the same malware signature or threat is detected on multiple endpoints within a short time window. This pattern indicates a potential malware outbreak spreading across the network environment.

Next Steps:
1. Immediately isolate affected endpoints to prevent further spread
2. Identify the malware signature ID and research its capabilities and impact
3. Check network logs for lateral movement patterns between infected hosts
4. Review the initial infection vector - check email logs, web proxy logs, and USB device usage
5. Verify antivirus definitions are up-to-date on all endpoints
6. Conduct memory and disk forensics on patient zero if identifiable
7. Check for persistence mechanisms on infected systems
8. Review domain controller and authentication logs for credential compromise
9. Document all affected systems and timeline for incident response
10. Consider engaging incident response team if outbreak involves critical systems
', '["https://www.bitdefender.com/business/support/en/77212-237089-event-types.html","https://attack.mitre.org/techniques/T1105/"]', 'safe("log.eventType", "") == "AntiMalware" && safe("log.severity", "") in ["4", "5"] && safe("log.signatureID", "") != "" && safe("log.syslogHostIP", "") != ""', '2025-09-03 11:55:44.95701', true, false, 'origin', '["log.signatureID","log.syslogHostIP"]', '[{"indexPattern":"v11-log-antivirus-bitdefender-gz-*","with":[{"field":"log.signatureID.keyword","operator":"filter_term","value":"{{.log.signatureID}}"},{"field":"log.eventType.keyword","operator":"filter_term","value":"AntiMalware"}],"or":null,"within":"now-2h","count":10}]');
INSERT INTO public.utm_correlation_rules VALUES (1324, 'Windows: Deleting Backup Catalogs with Wbadmin', 1, 2, 3, 'Impact', 'Inhibit System Recovery', 'Identifies use of the wbadmin.exe to delete the backup catalog. Ransomware and other malware may do this to prevent system recovery.', '["https://attack.mitre.org/tactics/TA0040/","https://attack.mitre.org/techniques/T1490/"]', 'safe("log.message", "").matches(''(delete(.+)catalog|catalog(.+)delete)'') && safe("log.winlogEventDataProcessName", "").matches(''(wbadmin.exe|WBADMIN.EXE)'')', '2025-09-04 20:23:16.232', true, false, 'origin', NULL, '[]');
INSERT INTO public.utm_correlation_rules VALUES (1488, 'Windows: A user account was added to power user groups', 2, 3, 1, 'Privilege Escalation', 'Domain Policy Modification', 'This alert is generated every time a user account is added to power user groups. This event generates on domain controllers, member servers, and workstations', '["https://attack.mitre.org/tactics/TA0004","https://attack.mitre.org/techniques/T1484/","https://docs.microsoft.com/en-us/windows-server/identity/ad-ds/plan/appendix-l--events-to-monitor"]', 'safe("log.eventCode", 0.0) in [double(4732), double(4728), double(632), double(636)] && safe("log.eventDataTargetSid", "").endsWith("-547")', '2025-09-05 22:33:18.158334', true, false, 'origin', NULL, '[]');
INSERT INTO public.utm_correlation_rules VALUES (13, 'Memory-Based Threat Detection', 3, 3, 2, 'Defense Evasion, Privilege Escalation', 'T1055 - Process Injection', 'Detects memory-based threats including process injection, memory manipulation, and fileless malware executing in memory based on Bitdefender GravityZone event types.

Next Steps:
1. Identify the affected process and host using log.hostId and origin.path fields
2. Check if the process is legitimate or if it shows signs of compromise
3. Review the process tree to identify parent-child relationships
4. Look for other suspicious activities on the same host in the last hour
5. Collect memory dump if the process is still running
6. Analyze network connections from the affected process
7. Check for persistence mechanisms on the affected system
8. Isolate the host if active malicious behavior is confirmed
', '["https://attack.mitre.org/techniques/T1055/","https://www.bitdefender.com/business/support/en/77209-135324-event-types.html"]', '(safe("log.eventType", "") == "aph" || safe("log.eventType", "") == "antiexploit" || safe("log.eventType", "") == "hd" || safe("origin.path", "").contains("memory")))', '2025-09-03 11:55:45.77058', true, false, 'origin', '["log.hostId","origin.path"]', '[]');
INSERT INTO public.utm_correlation_rules VALUES (14, 'Multiple Malware Detections from Single Source', 3, 3, 2, 'Command and Control', 'T1105 - Ingress Tool Transfer', 'Detects when multiple malware threats are detected originating from a single source IP address within a short time period. This could indicate a compromised system actively spreading malware or an attacker launching multiple malware variants.

Next Steps:
1. Investigate the source IP address:
   - Check if it''s an internal or external IP
   - Identify the system/user associated with the IP
   - Review network traffic logs from this IP
2. Analyze the detected malware:
   - Review the malware types and names detected
   - Check file paths and processes involved
   - Determine if malware was successfully quarantined
3. Check for lateral movement:
   - Look for connections from the source IP to other internal systems
   - Review authentication logs for suspicious activity
   - Check for file share access patterns
4. Remediation actions:
   - Isolate the affected system if confirmed compromised
   - Run full system scans on potentially affected systems
   - Update antivirus signatures and definitions
   - Consider reimaging if system is severely compromised
', '["https://www.bitdefender.com/business/support/en/77212-237089-event-types.html","https://attack.mitre.org/techniques/T1105/"]', 'safe("origin.ip", "") != "" && int(safe("log.severity", "0")) >= 4 && ( safe("log.eventType", "") == "AntiMalware" || safe("log.signatureID", "") == "70000" || safe("log.signatureID", "") == "70001" || safe("log.eventType", "").lowe().contains("malware") || safe("log.eventType", "").lowe().contains("virus") || safe("log.eventType", "").lowe().contains("trojan") || safe("log.eventType", "").lowe().contains("ransomware") || safe("log.eventType", "").lowe().contains("infected") )', '2025-09-03 11:55:46.414372', true, false, 'origin', '["origin.ip"]', '[{"indexPattern":"v11-log-antivirus-bitdefender-gz-*","with":[{"field":"origin.ip.keyword","operator":"filter_term","value":"{{.origin.ip}}"},{"field":"log.severity","operator":"filter_term","value":"4"}],"or":null,"within":"now-1h","count":5}]');
INSERT INTO public.utm_correlation_rules VALUES (1482, 'Windows: Printer driver failed to load, possible remote code execution using PrinterNightmare exploit: CVE-2021-34527', 3, 2, 1, 'Potentially Compromised System', 'Exploitation of Remote Services', 'Adversaries may exploit remote services to gain unauthorized access to internal systems once inside of a network.  Exploitation of a software vulnerability occurs when an adversary takes advantage of a programming error in a program,  service, or within the operating system software or kernel itself to execute adversary-controlled code.  A common goal for post-compromise exploitation of remote services is for lateral movement to enable access to a remote system.', '["https://attack.mitre.org/techniques/T1210/"]', 'safe("log.eventCode", 0.0) == double(808) && safe("log.severityLabel", "") in [''Error'', ''error'']', '2025-09-04 21:15:01.684678', true, false, 'origin', NULL, '[]');
INSERT INTO public.utm_correlation_rules VALUES (15, 'Multiple Malware Detections from Single Source', 3, 3, 2, 'Command and Control', 'T1105 - Ingress Tool Transfer', 'Detects when multiple malware threats are detected on a single host within a short time period. This could indicate a compromised system actively spreading malware or an attacker launching multiple malware variants.

Next Steps:
1. Investigate the affected host:
   - Identify the system using the hostId field
   - Check if it''s a critical system or server
   - Review recent user activity on the host
2. Analyze the detected malware:
   - Review the malware types and names detected (signatureID field)
   - Check file paths and processes involved
   - Determine if malware was successfully quarantined
3. Check for lateral movement:
   - Look for connections from the affected host to other internal systems
   - Review authentication logs for suspicious activity
   - Check for file share access patterns
4. Remediation actions:
   - Isolate the affected system if confirmed compromised
   - Run full system scans on potentially affected systems
   - Update antivirus signatures and definitions
   - Consider reimaging if system is severely compromised
', '["https://www.bitdefender.com/business/support/en/77212-237089-event-types.html","https://attack.mitre.org/techniques/T1105/"]', 'safe("log.eventType", "") == "AntiMalware" && safe("log.severity", "") in ["4", "5"] && safe("log.hostId", "") != ""', '2025-09-03 11:55:47.423098', true, false, 'origin', '["log.hostId"]', '[{"indexPattern":"v11-log-antivirus-bitdefender-gz-*","with":[{"field":"log.hostId.keyword","operator":"filter_term","value":"{{.log.hostId}}"},{"field":"log.eventType.keyword","operator":"filter_term","value":"AntiMalware"}],"or":null,"within":"now-1h","count":5}]');
INSERT INTO public.utm_correlation_rules VALUES (24, 'Bitdefender GravityZone Zero-Day Malware Detection', 3, 3, 2, 'Execution', 'T1203 - Exploitation for Client Execution', 'Detects potential zero-day malware identified by Bitdefender''s advanced threat detection capabilities including HyperDetect and Sandbox Analyzer. These detection methods use behavioral analysis and machine learning to identify previously unknown threats.

Next Steps:
1. Immediately isolate the affected system from the network to prevent lateral movement
2. Review the detection details including file path, process information, and threat indicators
3. Check if similar detections occurred on other systems in the environment
4. Collect the suspicious file/process for further analysis in a sandbox environment
5. Review system logs for any suspicious activities before and after the detection
6. Update security policies to block similar threats across the organization
7. Consider submitting the sample to Bitdefender for further analysis
', '["https://www.bitdefender.com/business/support/en/77212-237089-event-types.html","https://attack.mitre.org/techniques/T1203/"]', 'safe("log.eventType", "") == "HyperDetect Activity" || safe("log.eventType", "") == "Sandbox Analyzer Detection" || safe("log.eventType", "") == "hyperdetect" || (safe("log.eventType", "") == "avc" && safe("log.severity", "") == "High")', '2025-09-03 11:56:30.171314', true, false, 'origin', '["log.syslogHostIP","log.hostId"]', '[]');
INSERT INTO public.utm_correlation_rules VALUES (116, 'AWS CloudWatch Log Group Deletion', 3, 2, 2, 'Data Destruction', 'Defense Evasion', 'Identifies the deletion of a specified AWS CloudWatch log group. When a log group is deleted, all the archived log events associated with the log group are also permanently deleted', '["https://attack.mitre.org/tactics/TA0040/","https://attack.mitre.org/techniques/T1485/","https://attack.mitre.org/tactics/TA0005/","https://attack.mitre.org/techniques/T1562/","https://awscli.amazonaws.com/v2/documentation/api/latest/reference/logs/delete-log-group.html","https://docs.aws.amazon.com/AmazonCloudWatchLogs/latest/APIReference/API_DeleteLogGroup.html"]', 'safe("log.eventSource", "") == "logs.amazonaws.com" && safe("log.eventName", "") == "DeleteLogGroup"', '2025-09-03 12:27:54.634642', true, false, 'origin', NULL, '[]');
INSERT INTO public.utm_correlation_rules VALUES (1443, 'Windows: Unusual Child Process of dns.exe', 1, 3, 2, 'Initial Access', 'External Remote Services', 'Identifies an unexpected process spawning from dns.exe, the process responsible for Windows DNS server services, which may indicate activity related to remote code execution or other forms of exploitation.', '["https://attack.mitre.org/tactics/TA0001/","https://attack.mitre.org/techniques/T1133/"]', 'safe("log.eventData.ProcessName", "").contains("dns.exe") && !safe("log.eventData.ParentProcessName", "").contains("conhost.exe")', '2025-09-04 21:01:33.858242', true, false, 'origin', NULL, '[]');
INSERT INTO public.utm_correlation_rules VALUES (1444, 'Windows: Unusual File Modification by dns.exe', 1, 3, 2, 'Initial Access', 'External Remote Services', 'Identifies an unexpected file being modified by dns.exe, the process responsible for Windows DNS Server services, which may indicate activity related to remote code execution or other forms of exploitation.', '["https://attack.mitre.org/tactics/TA0001/","https://attack.mitre.org/techniques/T1133/"]', 'safe("log.eventDataProcessName", "").contains("dns.exe") && !safe("log.eventDataFileName", "").contains("dns.log")', '2025-09-04 21:01:34.423741', true, false, 'origin', NULL, '[]');
INSERT INTO public.utm_correlation_rules VALUES (16, 'Network-Based Threat Detection', 3, 2, 3, 'Command and Control', 'T1071 - Application Layer Protocol: Command and Control', 'Detects network-based threats including C2 communications, malicious network activity, and suspicious network connections identified by Bitdefender GravityZone.

Next Steps:
1. Identify the affected host using log.hostId and check for other security events from this system
2. Review origin.ip to determine if it''s a known malicious IP or C2 server
3. Check firewall logs for any blocked or allowed connections to/from the suspicious IP
4. Investigate running processes on the affected host for signs of malware
5. Review network traffic patterns for data exfiltration attempts
6. If ransomware is detected, immediately isolate the affected system
7. Collect network packet captures if available for deeper analysis
8. Check if other hosts have communicated with the same external IP address
9. Submit suspicious IPs to threat intelligence platforms for reputation checking
10. Document findings and update firewall rules to block confirmed malicious IPs
', '["https://attack.mitre.org/techniques/T1071/","https://www.bitdefender.com/business/support/en/77209-135324-event-types.html"]', 'safe("log.eventType", "") == "network-sandboxing" || safe("log.eventType", "") == "fw" || (safe("origin.ip", "") != "" && safe("log.eventType", "").contains("network")) || (safe("log.message", "").contains("network") || safe("log.message", "").contains("connection") || safe("log.message", "").contains("c2") || safe("log.message", "").contains("command")) || safe("log.severity", "") == "critical" || safe("log.product", "").contains("network")', '2025-09-03 11:55:48.724992', true, false, 'origin', '["origin.ip","log.hostId"]', '[]');
INSERT INTO public.utm_correlation_rules VALUES (17, 'Bitdefender GravityZone Quarantine Failure Detection', 3, 3, 2, 'Defense Evasion', 'T1562.001 - Impair Defenses: Disable or Modify Tools', 'Detects when Bitdefender GravityZone fails to quarantine detected malware. This could indicate that the malware is actively resisting remediation attempts or that there are permission issues preventing proper quarantine.

Next Steps:
- Immediately isolate the affected system from the network
- Check if the malware process is still running and attempt manual termination
- Verify antivirus permissions and ensure it has necessary privileges
- Review system logs for signs of privilege escalation or rootkit activity
- Consider reimaging the system if quarantine continues to fail
- Check for similar failures on other systems in the environment
- Investigate the specific malware detected and research its capabilities
- Review quarantine configuration and storage capacity
', '["https://www.bitdefender.com/business/support/en/77212-237089-event-types.html","https://attack.mitre.org/techniques/T1562/001/"]', 'safe("log.eventType", "") == "quarantine_failed" || safe("log.eventType", "") == "quarantine_failure" || (safe("log.eventType", "") == "AntiMalware" && ( safe("log.requested", "").contains("quarantine") && safe("log.requested", "").contains("fail") )) || (safe("log.eventType", "") == "AntiMalware" && ( safe("log.message", "").contains("quarantine failed") || safe("log.message", "").contains("unable to quarantine") || safe("log.message", "").contains("failed to quarantine") )) || (safe("log.eventType", "") == "AntiMalware" && safe("log.severity", "") == "failure" && safe("log.requested", "").contains("quarantine"))', '2025-09-03 11:55:49.559584', true, false, 'origin', '["target.host","target.file"]', '[]');
INSERT INTO public.utm_correlation_rules VALUES (18, 'Ransomware Behavior Detection', 3, 3, 3, 'Impact', 'T1486 - Data Encrypted for Impact', 'Detects ransomware behavior patterns including file encryption attempts, mass file modifications, and ransomware-specific malware types detected by Bitdefender GravityZone.

Next Steps:
1. Immediately isolate the affected system from the network to prevent spread
2. Check for recent backup availability and integrity
3. Review process execution history on the affected host
4. Look for suspicious file modifications or mass encryption activities
5. Check for ransomware notes or changed file extensions
6. Investigate the source of infection (email attachments, downloads, RDP compromise)
7. Scan other systems for similar indicators
8. Consider engaging incident response team for containment and recovery
', '["https://www.bitdefender.com/business/support/en/77212-237089-event-types.html","https://attack.mitre.org/techniques/T1486/"]', 'safe("log.message", "").contains("ransomware") || safe("log.signatureID", "").contains("ransomware") || (safe("log.severity", "") == "10" && safe("log.eventType", "").contains("malware")) || safe("log.message", "").contains("ransom") || safe("log.message", "").contains("crypt") || safe("log.message", "").contains("locky") || safe("log.message", "").contains("cerber") || safe("log.message", "").contains("wannacry") || safe("log.message", "").contains("petya") || safe("log.message", "").contains("ryuk") || safe("log.message", "").contains("sodinokibi") || safe("log.message", "").contains("maze") || safe("log.message", "").contains("encrypt")) && safe("log.severity", "") != ""', '2025-09-03 11:55:50.382194', true, false, 'origin', '["log.hostId","log.signatureID"]', '[]');
INSERT INTO public.utm_correlation_rules VALUES (105, 'AWS EC2 Flow Log Deletion', 3, 2, 2, 'Impair Defenses', 'Defense Evasion', 'Identifies the deletion of one or more flow logs in AWS Elastic Compute Cloud (EC2). An adversary may delete flow logs in an attempt to evade defenses', '["https://awscli.amazonaws.com/v2/documentation/api/latest/reference/ec2/delete-flow-logs.html","https://docs.aws.amazon.com/AWSEC2/latest/APIReference/API_DeleteFlowLogs.html","https://attack.mitre.org/tactics/TA0005/","https://attack.mitre.org/techniques/T1562/"]', 'safe("log.eventSource", "") == ''ec2.amazonaws.com'' && safe("log.eventName", "") == ''DeleteFlowLogs''', '2025-09-03 12:22:08.094773', true, false, 'origin', NULL, '[]');
INSERT INTO public.utm_correlation_rules VALUES (19, 'Real-time Protection Disabled', 3, 3, 2, 'Defense Evasion', 'T1562.001 - Impair Defenses: Disable or Modify Tools', 'Detects when real-time protection features are disabled on an endpoint. This is a critical security event as it leaves the system vulnerable to malware infections and requires immediate investigation.

Next Steps:
1. Immediately investigate who disabled the real-time protection and why
2. Check if the action was authorized by IT security team
3. Review recent activity on the affected endpoint for signs of compromise
4. Re-enable real-time protection if the action was unauthorized
5. Check for any malware infections that may have occurred while protection was disabled
6. Review system logs for any suspicious activities during the protection downtime
7. Consider implementing additional controls to prevent unauthorized disabling of security tools
', '["https://www.bitdefender.com/business/support/en/77212-237089-event-types.html","https://attack.mitre.org/techniques/T1562/001/"]', 'safe("log.syslogHostIP", "") != "" && ( (safe("log.eventType", "") == "modules" && safe("log.product", "") == "av" && safe("log.message", "").contains("real-time") || (safe("log.eventType", "") == "Product ModulesStatus" && safe("log.severity", "") in ["4", "5"] && (safe("log.message", "").contains("protection disabled" || safe("log.message", "").contains("real-time scanning disabled")) )', '2025-09-03 11:55:51.322376', true, false, 'origin', '["log.syslogHostIP"]', '[]');
INSERT INTO public.utm_correlation_rules VALUES (251, 'Azure Active Directory High Risk Sign-in', 1, 2, 3, 'Valid Accounts', 'Initial Access', 'Identifies high risk Azure Active Directory (AD) sign-ins by leveraging Microsoft''s Identity Protection machine learning and heuristics. Identity Protection categorizes risk into three tiers: low, medium, and high. While Microsoft does not provide specific details about how risk is calculated, each level brings higher confidence that the user or sign-in is compromised.', '["https://attack.mitre.org/techniques/T1078/"]', 'safe("log.resourceProviderNameValue", "").contains("azure.activitylogs") && safe("log.level", "").contains("critical") && safe("log.statusValue", "").contains("Succeeded")', '2025-09-03 13:20:06.064827', true, false, 'origin', NULL, '[]');
INSERT INTO public.utm_correlation_rules VALUES (20, 'Rootkit Detection', 3, 3, 2, 'Defense Evasion', 'T1014 - Rootkit', 'Detects rootkit infections and kernel-level threats that attempt to hide malicious activity at the system level using Bitdefender GravityZone''s advanced detection capabilities.

Next Steps:
1. Immediately isolate the affected system from the network to prevent lateral movement
2. Capture a memory dump and disk image for forensic analysis
3. Check for signs of privilege escalation or kernel-level modifications
4. Review system logs for any suspicious driver installations or kernel module loading
5. Scan other systems in the same network segment for similar infections
6. Consider rebuilding the system from a known clean state as rootkits can be difficult to fully remove
7. Review how the rootkit was initially delivered (email attachment, exploit kit, etc.)
8. Update all security software and operating system patches
', '["https://www.bitdefender.com/business/support/en/77212-237089-event-types.html","https://attack.mitre.org/techniques/T1014/"]', 'safe("log.eventType", "") == "malware_detected" && (safe("log.severity", "") == "high" || safe("log.severity", "") == "critical") && ( safe("log.message", "").lowe().contains("rootkit") || safe("log.message", "").lowe().contains("kernel") || safe("log.message", "").lowe().contains("tdss") || safe("log.message", "").lowe().contains("zeroaccess") || safe("log.message", "").lowe().contains("necurs") || safe("log.message", "").lowe().contains("bootkit") || safe("log.message", "").lowe().contains("alureon") || safe("log.message", "").lowe().contains("rustock") || safe("log.message", "").lowe().contains("sinowal") || safe("log.requested", "").lowe().contains("rootkit") || safe("log.signatureID", "") == "rootkit" )', '2025-09-03 11:55:52.384483', true, false, 'origin', '["log.hostId","log.signatureID"]', '[]');
INSERT INTO public.utm_correlation_rules VALUES (21, 'Bitdefender GravityZone Suspicious Exclusions Added', 3, 3, 2, 'Defense Evasion', 'T1562.001 - Impair Defenses: Disable or Modify Tools', 'Detects when exclusions are added to Bitdefender GravityZone configuration. Attackers often add exclusions to prevent antivirus from scanning malicious files or directories.

Next Steps:
1. Identify what exclusions were added and the paths/processes being excluded
2. Verify if the exclusion was authorized through proper change management
3. Check if the excluded paths contain suspicious files or known malware locations
4. Review the user account that made the configuration change
5. Look for any malware detections before and after the exclusion was added
6. Consider removing unauthorized exclusions and scanning the previously excluded areas
', '["https://www.bitdefender.com/business/support/en/77212-237089-event-types.html","https://attack.mitre.org/techniques/T1562/001/"]', '(safe("log.eventType", "") == "configuration_change" && safe("log.message", "").contains("exclusion") || (safe("log.eventType", "") == "policy_change" && (safe("log.message", "").contains("exclusion" || safe("log.message", "").contains("whitelist")) || (safe("log.message", "").contains("exclusion_added" || safe("log.message", "").contains("whitelist_added")', '2025-09-03 11:56:27.998926', true, false, 'origin', '["log.hostId","log.deviceIps"]', '[]');
INSERT INTO public.utm_correlation_rules VALUES (25, 'Advanced Threat Tactic Identification', 3, 3, 3, 'Advanced Persistent Threat', 'Multiple Tactics', 'Detects advanced threat tactics including initial access, execution, and persistence techniques by monitoring deception environment interactions and behavioral patterns. This rule triggers when deceptive assets are accessed with high behavior scores indicating sophisticated attack patterns.

Next Steps:
1. Immediately isolate the affected endpoint(s) associated with the source IP
2. Review the specific tactic name to understand the attack phase (initial access, execution, persistence, etc.)
3. Check all deception assets that were triggered to map the attacker''s movement
4. Analyze the behavior score details to understand the sophistication level
5. Look for related alerts from the same source IP across different systems
6. Collect forensic data from the endpoint before any remediation
7. Review authentication logs for any credential abuse from this source
8. Check network logs for lateral movement attempts
9. Update security controls to block the identified tactics
10. Consider deploying additional deception assets in the path of the attacker
', '["https://attack.mitre.org/tactics/TA0001/","https://attack.mitre.org/tactics/TA0002/","https://attack.mitre.org/tactics/TA0003/"]', 'safe("log.eventType", "") == "advanced_threat_detected" && safe("log.threatLevel", "") == "critical" && (safe("log.tacticName", "") in ["initial_access", "execution", "persistence", "privilege_escalation", "defense_evasion"]) && safe("log.deceptionTriggered", false) == true && safe("log.behaviorScore", 0) >= 80', '2025-09-03 12:01:34.557234', true, false, 'origin', '["origin.ip","log.tacticName","log.threatLevel"]', '[]');
INSERT INTO public.utm_correlation_rules VALUES (26, 'Criminal Group Signatures', 3, 3, 2, 'Organized Crime Activity', 'Criminal Group TTPs', 'Identifies attack signatures and behavioral patterns associated with known criminal groups including ransomware operators, financial crime syndicates, and organized cybercrime operations. Deception technology detects malicious activity by monitoring interactions with decoy assets that should never be accessed in legitimate workflows.

Next Steps:
1. IMMEDIATE: Isolate the affected endpoint to prevent lateral movement
2. Verify the criminal group signature or toolset identified in the alert details
3. Check if the source IP/domain appears in threat intelligence feeds or previous incidents
4. Review all activity from the affected endpoint in the last 24-48 hours
5. Search for indicators of lateral movement or data staging activities
6. Scan other endpoints for similar patterns or IoCs
7. If ransomware indicators are present, activate ransomware response playbook
8. Collect forensic evidence: process creation logs, network connections, file modifications
9. Check for data exfiltration attempts to external IPs or cloud services
10. Review all user account activity associated with the endpoint for signs of compromise
11. Document all findings and coordinate with incident response team
12. Consider threat hunting across the environment for related criminal group activities
', '["https://attack.mitre.org/groups/","https://www.ic3.gov/Media/PDF/AnnualReport/2023_IC3Report.pdf","https://www.acalvio.com/cyber-deception/the-role-of-deception-technology-in-the-endpoint-security-reference-architecture/","https://www.cisa.gov/news-events/cybersecurity-advisories/aa23-320a"]', 'safe("log.eventType", "") in ["threat_detected", "deception_triggered", "malicious_activity"] && safe("log.threatType", "") in ["criminal_group", "ransomware", "organized_crime"] && (safe("log.signature", "") != "" || safe("log.toolset", "") != "" || safe("log.groupName", "") != "") && (safe("log.action", "") in ["blocked", "detected", "prevented"] || safe("log.severity", "") in ["high", "critical"]) && (safe("log.indicatorType", "") in ["ransomware", "financial_theft", "cryptomining", "data_exfiltration"] || safe("log.threatScore", 0) >= 70)', '2025-09-03 12:01:35.387215', true, false, 'origin', '["origin.host","log.groupName","log.signature"]', '[]');
INSERT INTO public.utm_correlation_rules VALUES (107, 'AWS GuardDuty Detector Deletion', 3, 2, 2, 'Impair Defenses', 'Defense Evasion', 'Identifies the deletion of an Amazon GuardDuty detector. Upon deletion, GuardDuty stops monitoring the environment and all existing findings are lost', '["https://attack.mitre.org/tactics/TA0005/","https://attack.mitre.org/techniques/T1562/","https://awscli.amazonaws.com/v2/documentation/api/latest/reference/guardduty/delete-detector.html","https://docs.aws.amazon.com/guardduty/latest/APIReference/API_DeleteDetector.html"]', 'safe("log.eventSource", "") == ''guardduty.amazonaws.com'' && safe("log.eventName", "") == ''DeleteDetector''', '2025-09-03 12:27:10.571731', true, false, 'origin', NULL, '[]');
INSERT INTO public.utm_correlation_rules VALUES (23, 'USB-Based Malware Propagation', 3, 3, 2, 'Lateral Movement, Initial Access', 'T1091 - Replication Through Removable Media', 'Detects USB-based malware propagation attempts including autorun infections, removable media threats, and device control violations. This rule monitors for device control events and removable media access patterns that may indicate malware attempting to spread via USB devices.

Next Steps:
1. Isolate the affected endpoint immediately to prevent further spread
2. Check device control logs for unauthorized USB device connections
3. Scan all removable media that were connected to the affected system
4. Review file creation/modification events on removable drives (especially autorun.inf)
5. Verify if similar events occurred on other endpoints in the network
6. Update device control policies to restrict USB usage if necessary
7. Consider implementing USB device whitelisting for critical systems
', '["https://attack.mitre.org/techniques/T1091/","https://www.bitdefender.com/business/support/en/77209-135324-event-types.html"]', 'safe("log.eventType", "") == "device-control" || safe("log.eventType", "") == "dp" || (safe("log.requested", "").contains("usb") || safe("log.requested", "").contains("removable") || safe("log.requested", "").contains("autorun") || safe("log.requested", "").contains("device"))', '2025-09-03 11:56:29.593126', true, false, 'origin', '["log.hostId"]', '[]');
INSERT INTO public.utm_correlation_rules VALUES (1231, 'Management Network Exposure Detection', 3, 3, 3, 'Discovery', 'T1046 - Network Service Scanning', 'Detects attempts to expose or access ESXi management interfaces from unauthorized networks, including suspicious SSH/HTTPS access attempts, management network misconfigurations, or attempts to bypass network segmentation.

Next Steps:
- Verify the source IP address attempting to access management interfaces
- Check if the access attempt is from an authorized management network
- Review firewall rules for management network segmentation
- Examine hostd.log and rhttpproxy.log for additional context
- Check for any recent configuration changes to management network settings
- Verify SSH and HTTPS access control lists are properly configured
- If unauthorized, block the source IP and investigate for potential compromise
', '["https://cloud.google.com/blog/topics/threat-intelligence/vmware-detection-containment-hardening","https://attack.mitre.org/techniques/T1046/"]', '(
  (safe("log.message", "").matches("(?i)management.*network.*access.*denied") ||
   safe("log.message", "").matches("(?i)ssh.*connection.*refused") ||
   safe("log.message", "").matches("(?i)https.*unauthorized.*access") ||
   safe("log.message", "").matches("(?i)management.*interface.*exposed") ||
   safe("log.message", "").matches("(?i)admin.*port.*scan") ||
   safe("log.message", "").matches("(?i)firewall.*rule.*bypass.*attempt") ||
   safe("log.message", "").matches("(?i)management.*vlan.*breach") ||
   safe("log.message", "").matches("(?i)esxi.*shell.*unauthorized") ||
   safe("log.message", "").matches("(?i)dcui.*access.*violation")) &&
  (safe("log.process", "").matches("(?i)hostd") ||
   safe("log.process", "").matches("(?i)vmkernel") ||
   safe("log.process", "").matches("(?i)sshd") ||
   safe("log.process", "").matches("(?i)rhttpproxy"))
) ||
(safe("severity", "") == "warning" &&
 safe("log.message", "").matches("(?i)management.*security"))
', '2025-09-04 19:00:04.324826', true, false, 'origin', '["origin.hostname"]', '[]');
INSERT INTO public.utm_correlation_rules VALUES (1232, 'Memory Ballooning Attack Detection', 2, 3, 3, 'Impact', 'T1496 - Resource Hijacking', 'Detects potential memory ballooning attacks where excessive memory reclamation is occurring, which could indicate resource exhaustion or denial of service attempts against virtual machines. Memory ballooning is a technique used by VMware to reclaim memory from VMs, but excessive ballooning can severely impact VM performance.

Next Steps:
1. Check the ESXi host''s memory usage and identify which VMs are experiencing ballooning
2. Review performance metrics for affected VMs to assess impact
3. Investigate if this is legitimate resource contention or a potential attack
4. Check for any recently deployed VMs or workloads that might be consuming excessive memory
5. Consider adjusting memory reservations or limits for critical VMs
6. Review ESXi host logs for any other suspicious activities around the same time
', '["https://www.vladan.fr/what-is-vmware-memory-ballooning/","https://attack.mitre.org/techniques/T1496/"]', 'safe("log.process", "") == "vmkernel" &&
safe("log.message", "") != "" &&
(safe("log.message", "").contains("balloon") || safe("log.message", "").contains("MCTLSZ")) &&
(safe("log.message", "").contains("excessive") || safe("log.message", "").contains("critical") || safe("log.message", "").contains("failed"))
', '2025-09-04 19:00:04.970549', true, false, 'origin', '["origin.hostname"]', '[]');
INSERT INTO public.utm_correlation_rules VALUES (1233, 'Suspicious OVF/OVA Deployment', 3, 3, 2, 'Resource Development', 'T1608.004 - Malicious Image Deployment', 'Detects potentially malicious OVF/OVA deployments that could introduce compromised virtual machines into the environment. Monitors for rapid deployments, deployments from unusual sources, or deployments with suspicious configurations.

Next Steps:
1. Review the source URL/path of the OVF/OVA deployment to verify it''s from a trusted source
2. Check the user account that initiated the deployment for legitimacy
3. Examine the VM configuration and resource allocation for anomalies
4. Verify if the deployment follows change management procedures
5. Scan the deployed VM for malware or suspicious configurations
6. Review network connections from the newly deployed VM
7. Check if similar deployments occurred around the same time on other hosts
', '["https://www.nakivo.com/blog/vmware-logs-analysis-for-troubleshooting/","https://attack.mitre.org/techniques/T1608/004/"]', '(safe("log.message", "").contains("ImportVApp") ||
 safe("log.message", "").contains("DeployOvf") ||
 safe("log.message", "").contains("ovftool") ||
 safe("log.message", "").contains(".ovf") ||
 safe("log.message", "").contains(".ova")) &&
(safe("log.message", "").contains("http://") ||
 safe("log.message", "").contains("https://") ||
 safe("log.message", "").contains("ftp://") ||
 safe("log.process", "") == "hostd" ||
 safe("severity", "") == "warning" ||
 safe("severity", "") == "error")
', '2025-09-04 19:00:05.571301', true, false, 'origin', '["origin.hostname"]', '[{"indexPattern":"v11-log-vmware-esxi-*","with":[{"field":"origin.hostname.keyword","operator":"filter_term","value":"{{.origin.hostname}}"},{"field":"log.message","operator":"filter_match","value":"ovf"}],"or":null,"within":"now-1h","count":2}]');
INSERT INTO public.utm_correlation_rules VALUES (27, 'Data Theft Attempt on Decoy Files', 3, 2, 1, 'Collection', 'T1005 - Data from Local System', 'Detects attempts to access, copy, or exfiltrate deceptive decoy files and honeypot data, indicating potential data theft activities by an attacker. This rule triggers when an attacker interacts with high-sensitivity decoy files planted by Deceptive Bytes.

Next Steps:
- Immediately isolate the affected endpoint to prevent lateral movement
- Review the source IP and user account for suspicious activity patterns
- Check for other decoy interactions from the same source in the past 24 hours
- Examine network traffic logs for potential data exfiltration attempts
- Verify if the user account has been compromised or if this is insider threat activity
- Consider resetting credentials for the affected user account
- Document all decoy files accessed for forensic analysis
', '["https://attack.mitre.org/techniques/T1005/","https://attack.mitre.org/techniques/T1567/","https://deceptivebytes.com/solution/"]', 'safe("log.event_type", "") == "decoy_accessed" && (safe("action", "") == "file_read" || safe("action", "") == "file_copy" || safe("action", "") == "file_download") && safe("log.decoy_sensitivity", "") == "high"', '2025-09-03 12:01:36.499899', true, false, 'origin', '["origin.ip","origin.user","log.decoy_file"]', '[]');
INSERT INTO public.utm_correlation_rules VALUES (36, 'Nation-State Tactic Detection', 3, 3, 1, 'Advanced Persistent Threat', 'T1595 - Active Scanning / Nation-State Attack Patterns', 'Detects sophisticated attack patterns and techniques commonly associated with nation-state actors including advanced persistence mechanisms, custom tooling, and strategic lateral movement.

Next Steps:
1) Immediately isolate affected systems and preserve forensic evidence
2) Review all decoy interactions and identify compromised credentials
3) Check for lateral movement attempts from the source IP across all systems
4) Analyze custom tools or malware samples if detected
5) Engage incident response team for potential APT activity
6) Review network traffic for command & control communications
7) Implement enhanced monitoring on high-value targets identified in the attack
', '["https://attack.mitre.org/groups/","https://www.cisa.gov/topics/cyber-threats-and-advisories/advanced-persistent-threats"]', 'safe("log.eventType", "") in ["decoy_interaction", "honeypot_access", "deception_triggered"] && safe("log.threat_level", "") == "critical" && (safe("log.attackSophistication", "") == "advanced" || safe("log.threatScore", 0) >= 85) && (safe("log.aptIndicators", false) == true || safe("log.customMalware", false) == true || safe("log.advancedTtps", false) == true || safe("log.targetedDecoys", 0) > 1 || safe("log.persistenceAttempt", false) == true)', '2025-09-03 12:03:58.692616', true, false, 'origin', NULL, '[]');
INSERT INTO public.utm_correlation_rules VALUES (29, 'Deception Token Access Patterns', 3, 3, 1, 'Defense Evasion, Persistence, Privilege Escalation, Initial Access', 'T1078 - Valid Accounts: Credential Access', 'Detects when deception tokens or honeytokens are accessed, indicating potential unauthorized activity or insider threat. Multiple token accesses from the same source within a short timeframe suggest systematic reconnaissance or data harvesting attempts. Honeytokens are fake credentials or access tokens planted as traps to detect unauthorized access.

Next Steps:
1. Identify the source IP and user account associated with the token access
2. Review access logs to determine if this is legitimate testing or actual malicious activity
3. Check for lateral movement from the same source IP across the network
4. Investigate any data access or exfiltration attempts following the token access
5. Consider immediately blocking the source IP if confirmed malicious
6. Review and rotate any potentially compromised credentials in the environment
7. Alert security team immediately as honeytoken access is a high-confidence indicator of compromise
8. Document the incident and update detection rules based on observed attack patterns
9. Verify the integrity of the deception infrastructure to ensure it wasn''t compromised
', '["https://attack.mitre.org/techniques/T1078/","https://deceptivebytes.com/"]', 'safe("log.eventType", "") == "token_access" && safe("log.deceptionType", "") == "honeytoken" && safe("origin.ip", "") != "" && safe("severity", "") in ["high", "critical"]', '2025-09-03 12:01:38.443297', true, false, 'origin', '["origin.ip","log.tokenId"]', '[]');
INSERT INTO public.utm_correlation_rules VALUES (30, 'Decoy Share Access Monitoring', 3, 2, 1, 'Discovery', 'T1135 - Network Share Discovery', 'Detects when an attacker attempts to access decoy network shares set up by Deceptive Bytes. This indicates potential lateral movement or reconnaissance activity within the network. Any interaction with decoy shares is a high-confidence indicator of malicious activity since legitimate users should never access these resources.

Next Steps:
- Immediately investigate the source IP and verify if it belongs to an authorized user or system
- Check for other suspicious activities from the same source IP in the last 24-48 hours
- Review authentication logs to identify any compromised credentials associated with this IP
- Look for lateral movement attempts or privilege escalation from the same source
- Consider isolating the source system if it shows signs of compromise
- Document all accessed decoy resources for threat intelligence purposes
- Update security controls to block or monitor the attacker''s techniques
', '["https://attack.mitre.org/techniques/T1135/","https://deceptivebytes.com/solution/"]', 'safe("log.eventType", "") == "decoy_access" && safe("log.resourceType", "") == "network_share" && safe("origin.ip", "") != ""', '2025-09-03 12:01:39.67965', true, false, 'origin', '["origin.ip"]', '[]');
INSERT INTO public.utm_correlation_rules VALUES (31, 'Decoy System Enumeration', 3, 2, 1, 'Discovery', 'T1082 - System Information Discovery', 'Detects when an attacker performs system enumeration activities on decoy systems or services. This includes port scanning, service discovery, or system information gathering on deception assets.

Next Steps:
- Immediately investigate the source IP address for other suspicious activities
- Check if the source IP has attempted to access other decoy or real systems
- Review network logs for lateral movement attempts from this source
- Consider blocking the source IP if malicious intent is confirmed
- Document the attack pattern for threat intelligence sharing
- Verify if the attacker has discovered any real assets alongside decoys
', '["https://attack.mitre.org/techniques/T1082/","https://deceptivebytes.com/solution/"]', 'safe("log.eventType", "") == "system_enumeration" && (safe("log.isDecoy", false) == true || safe("log.isDecoy", "") == "true") && safe("log.action", "") in ["port_scan", "service_discovery", "system_info"] && safe("origin.ip", "") != ""', '2025-09-03 12:01:40.545876', true, false, 'origin', NULL, '[]');
INSERT INTO public.utm_correlation_rules VALUES (32, 'Fake User Authentication Attempts', 3, 3, 1, 'Credential Access', 'T1110 - Brute Force', 'Detects authentication attempts using decoy user accounts created by Deceptive Bytes. This indicates an attacker has obtained what they believe are valid credentials and is attempting to use them.

Next Steps:
- Immediately investigate the source IP address for other suspicious activities
- Check if the same IP has triggered other deception alerts or security events
- Review how the attacker obtained the decoy credentials (phishing, credential dumping, insider threat)
- Examine network logs for lateral movement attempts from this IP
- Consider blocking the source IP if confirmed malicious
- Check for any legitimate user accounts that may have been compromised
- Review authentication logs for attempts using real credentials from the same source
- Notify the security team for potential active breach investigation
', '["https://attack.mitre.org/techniques/T1110/","https://deceptivebytes.com/solution/"]', 'safe("log.eventType", "") == "authentication" && safe("log.isDecoyUser", false) == true && safe("log.authResult", "") != "" && safe("origin.ip", "") != ""', '2025-09-03 12:01:41.498645', true, false, 'origin', '["adversary.ip","origin.username"]', '[]');
INSERT INTO public.utm_correlation_rules VALUES (33, 'Honey Table Query Detection', 3, 2, 1, 'Collection', 'T1005 - Data from Local System', 'Detects when an attacker queries honey tables or decoy database objects deployed by Deceptive Bytes. This indicates potential data exfiltration attempts or database reconnaissance. Honey tables are deliberately placed decoy data designed to attract and identify unauthorized access attempts.

Next Steps:
1. Identify the source IP and determine if it''s an internal or external address
2. Check if the source IP has accessed other decoy resources or legitimate database tables
3. Review the specific honey table(s) that were queried to understand attacker interest
4. Correlate with authentication logs to identify the user account used
5. Check for any data exfiltration patterns following the honey table access
6. Isolate the compromised system or account if malicious activity is confirmed
7. Review database access logs for unauthorized queries to legitimate tables
8. Consider blocking the source IP if it''s external and confirmed malicious
9. Document the incident and update security monitoring rules if needed
', '["https://attack.mitre.org/techniques/T1005/","https://deceptivebytes.com/solution/"]', 'safe("log.eventType", "") == "decoy_access" && safe("log.resourceType", "") == "database_table" && safe("log.action", "") == "query" && safe("origin.ip", "") != ""', '2025-09-03 12:01:42.017619', true, false, 'origin', NULL, '[]');
INSERT INTO public.utm_correlation_rules VALUES (34, 'Lateral Movement Trap Triggered', 3, 3, 2, 'Lateral Movement', 'T1021 - Remote Services', 'Detects when an attacker triggers a deceptive trap while attempting lateral movement across the network. This indicates potential compromise and active threat movement within the environment.

Next Steps:
1. Immediately isolate the source IP address to prevent further lateral movement
2. Review all activities from the source IP in the last 24-48 hours
3. Check if the source system shows signs of compromise (unusual processes, new services, etc.)
4. Identify what credentials or methods were used in the lateral movement attempt
5. Review network logs for any successful connections from this source to other systems
6. Initiate incident response procedures for potential active threat
7. Consider deploying additional deception tokens around critical assets
', '["https://attack.mitre.org/techniques/T1021/","https://deceptivebytes.com/solution/"]', 'safe("log.eventType", "") == "trap_triggered" && safe("log.trapType", "") == "lateral_movement" && safe("origin.ip", "") != ""', '2025-09-03 12:01:42.958687', true, false, 'origin', '["origin.ip"]', '[]');
INSERT INTO public.utm_correlation_rules VALUES (37, 'Privilege Escalation Bait Accessed', 3, 3, 2, 'Privilege Escalation', 'T1068 - Exploitation for Privilege Escalation', 'Detects when an attacker accesses deceptive privileged account baits or attempts to escalate privileges using trapped credentials, indicating active exploitation attempts. This is a high-priority alert as it indicates an active attacker who has progressed beyond initial access and is attempting to gain elevated privileges.

Next Steps:
- Immediately isolate the affected system to prevent lateral movement
- Review authentication logs for the source IP and user account to identify scope of compromise
- Check for other deception bait interactions from the same source in the past 24 hours
- Investigate any legitimate user activity that may have been compromised
- Collect forensic data from the endpoint including running processes and network connections
- Review SIEM/EDR alerts for related suspicious activities from the same source
- Document the attacker''s TTPs for threat intelligence sharing
- Consider resetting credentials for any accounts that may have been exposed
- Update firewall rules to block the attacker''s source IP if confirmed malicious
', '["https://attack.mitre.org/techniques/T1068/","https://attack.mitre.org/techniques/T1078/","https://www.checkpoint.com/cyber-hub/cyber-security/what-is-deception-technology/"]', 'safe("log.eventType", "") == "bait_accessed" && safe("log.baitType", "") == "privileged_account" && (safe("log.targetPrivilege", "") == "admin" || safe("log.targetPrivilege", "") == "system" || safe("log.targetPrivilege", "") == "administrator")', '2025-09-03 12:03:59.729454', true, false, 'origin', NULL, '[]');
INSERT INTO public.utm_correlation_rules VALUES (38, 'Ransomware Behavior Detected in Deception Environment', 3, 3, 3, 'Impact', 'T1486 - Data Encrypted for Impact', 'Detects ransomware-like behavior patterns when attackers interact with deceptive files, including rapid file enumeration, encryption attempts, and ransom note creation in the Deceptive Bytes deception environment.

Next Steps:
1. Immediately isolate the affected system from the network to prevent ransomware spread
2. Check the process name and path identified in the alert for known ransomware indicators
3. Review file system activity from the same process for encryption patterns
4. Check for shadow copy deletion attempts (vssadmin, wmic shadowcopy delete)
5. Look for network connections to potential C2 servers from the identified process
6. Preserve forensic evidence and memory dumps if possible
7. Verify if this is a deception environment interaction or production system compromise
8. Check for lateral movement attempts from the source IP address
9. Review backup integrity and availability before any restoration attempts
', '["https://attack.mitre.org/techniques/T1486/","https://attack.mitre.org/techniques/T1490/","https://deceptivebytes.com/solution/"]', 'safe("log.eventType", "") == "ransomware_behavior" && (safe("log.behaviorPattern", "") == "mass_encryption" || safe("log.behaviorPattern", "") == "file_enumeration" || safe("log.behaviorPattern", "") == "ransom_note_drop")', '2025-09-03 12:04:00.543745', true, false, 'origin', NULL, '[]');
INSERT INTO public.utm_correlation_rules VALUES (35, 'Living Off The Land Attack Using Deceptive Resources', 3, 3, 2, 'Defense Evasion', 'T1218 - Signed Binary Proxy Execution', 'Detects when attackers use legitimate system tools and binaries to interact with deceptive resources, indicating Living Off The Land (LOLBins) attack techniques. This is a high-confidence indicator of malicious activity as legitimate users should not be accessing deceptive resources with system binaries.

Next Steps:
1. Immediately isolate the affected system to prevent lateral movement
2. Review the process execution chain to identify the parent process and any child processes
3. Check if the user account is compromised by reviewing recent authentication logs
4. Examine command line arguments and scripts executed by the LOLBin
5. Search for other deceptive resource interactions from the same user or system
6. Collect memory dump if possible for forensic analysis
7. Review network connections made by the process for C2 communication
8. Check for persistence mechanisms (scheduled tasks, registry modifications, services)
', '["https://attack.mitre.org/techniques/T1218/","https://attack.mitre.org/techniques/T1053/","https://lolbas-project.github.io/","https://deceptivebytes.com/solution/"]', 'safe("log.eventType", "") == "lolbin_trap" && safe("log.processName", "") in ["powershell.exe", "cmd.exe", "wmic.exe", "mshta.exe", "rundll32.exe", "regsvr32.exe", "certutil.exe", "bitsadmin.exe"] && safe("log.deceptiveTarget", "") != ""', '2025-09-03 12:03:57.180221', true, false, 'origin', NULL, '[]');
INSERT INTO public.utm_correlation_rules VALUES (242, 'Azure Application Credential Modification', 1, 2, 3, 'Use_Alternate_Authentication_Material', 'Defense Evasion', 'Identifies when a new credential is added to an application in Azure An application may use a certificate or secret string to prove its identity when requesting a token. Multiple certificates and secrets can be added for an application and an adversary may abuse this by creating an additional authentication method to evade defenses or persist in an environment.', '["https://attack.mitre.org/techniques/T1550/","https://attack.mitre.org/tactics/TA0005/"]', 'safe("log.resourceProviderNameValue", "").contains("azure.activitylogs") && safe("log.operationNameLocalizedValue", "").contains("Update application - Certificates and secrets management") && safe("log.statusValue", "").contains("Succeeded")', '2025-09-03 13:19:29.306297', true, false, 'target', NULL, '[]');
INSERT INTO public.utm_correlation_rules VALUES (40, 'Zero-Day Behavior Patterns Detection', 3, 3, 3, 'Defense Evasion', 'T1211 - Exploitation for Defense Evasion', 'Identifies potential zero-day exploits and unknown malware through abnormal behavior patterns, deception interactions, and anomaly detection in endpoint activities.

Next Steps:
1. Immediately isolate the affected system from the network to prevent lateral movement
2. Capture memory dumps and process information for forensic analysis
3. Check for similar behavioral anomalies on other endpoints in the same network segment
4. Review the exploit technique and process chain to understand the attack vector
5. Submit samples to threat intelligence platforms for analysis
6. Update security controls based on the identified exploit patterns
7. Document all IOCs (file hashes, network connections, process behaviors) for threat hunting
', '["https://attack.mitre.org/techniques/T1211/","https://attack.mitre.org/techniques/T1055/","https://attack.mitre.org/techniques/T1620/"]', 'safe("log.eventType", "") in ["unknown_threat", "behavioral_anomaly", "zero_day_suspect"] && safe("log.threatSignature", "") == "unknown" && safe("log.deceptionEnvironment", false) == true && ( (safe("log.memoryAnomalyScore", 0) >= 90) || (safe("log.processChainAnomalyScore", 0) >= 85) || (safe("log.networkBehaviorScore", 0) >= 88) || (safe("log.fileSystemAnomalyScore", 0) >= 92) ) && safe("log.knownMalwareFamily", "") == "" && safe("log.exploitTechnique", "") != ""', '2025-09-03 12:04:01.586474', true, false, 'origin', NULL, '[]');
INSERT INTO public.utm_correlation_rules VALUES (43, 'Data Loss Prevention Alert', 3, 2, 1, 'Collection', 'T1005 - Data from Local System', 'Detects when sensitive data is being accessed or transferred in violation of data loss prevention policies, potentially indicating data exfiltration attempts. This rule monitors ESET DLP events that indicate blocked, quarantined, or policy violations.

Next Steps:
1. Identify the user and endpoint involved in the DLP violation
2. Review the specific data that triggered the DLP alert (check log.message for details)
3. Contact the user to understand the business justification for the action
4. Check for any patterns of similar violations from the same user or endpoint
5. Review DLP policies to ensure they are properly configured and not overly restrictive
6. If malicious intent is suspected, initiate incident response procedures
7. Consider additional monitoring of the user''s activities and data access patterns
8. Document the incident and any remediation actions taken
', '["https://attack.mitre.org/techniques/T1005/","https://help.eset.com/protect_admin/10.1/en-US/events-exported-to-json-format.html"]', 'safe("log.message", "").contains("DLP") && (safe("log.message", "").contains("blocked") || safe("log.message", "").contains("quarantined") || safe("log.message", "").contains("violation") || safe("log.message", "").contains("policy"))', '2025-09-03 12:06:00.973303', true, false, 'origin', NULL, '[]');
INSERT INTO public.utm_correlation_rules VALUES (44, 'Device Control Policy Violation', 3, 2, 1, 'Initial Access', 'T1200 - Hardware Additions', 'Detects when a user violates device control policies by attempting to use blocked devices such as USB drives, CD/DVD, or other external storage devices. This could indicate an attempt to introduce malware or exfiltrate data through removable media.

Next Steps:
- Identify the user who attempted to use the blocked device
- Review the device type that was blocked and the reason for the policy
- Check if this is a repeated violation from the same user or host
- Interview the user to understand the business justification
- Review if the device control policy needs adjustment for legitimate use cases
- Check for any successful device connections before/after this event
- Verify no data exfiltration occurred through other means
', '["https://attack.mitre.org/techniques/T1200/","https://help.eset.com/protect_admin/10.1/en-US/events-exported-to-json-format.html"]', 'safe("log.msgType", "") == "DeviceControl_Event" && safe("actionResult", "") == "blocked" && safe("target.host", "") != ""', '2025-09-03 12:06:01.841974', true, false, 'origin', NULL, '[]');
INSERT INTO public.utm_correlation_rules VALUES (45, 'ESET Exploit Detection Alert', 3, 3, 2, 'Privilege Escalation', 'T1068 - Exploitation for Privilege Escalation', 'Detects when ESET''s Exploit Blocker identifies and blocks exploitation attempts targeting vulnerabilities in commonly exploited applications such as browsers, document readers, email clients, Flash, and Java.

Next Steps:
1. Identify the affected host and the specific exploit attempt details
2. Check for any successful exploitation attempts on the same host
3. Review process execution logs for suspicious activity following the exploit attempt
4. Verify that the exploit was successfully blocked and no compromise occurred
5. Update the vulnerable application if a patch is available
6. Consider isolating the host if exploitation may have succeeded
', '["https://www.eset.com/us/about/technology/","https://attack.mitre.org/techniques/T1068/"]', 'safe("log.message", "").toLowerCase().contains("exploit") || safe("log.msgType", "") == "Exploit_Blocked" || safe("log.msgType", "") == "Exploit") && safe("actionResult", "") == "blocked" && safe("severity", "") in ["medium", "high"]', '2025-09-03 12:06:02.826918', true, false, 'origin', NULL, '[]');
INSERT INTO public.utm_correlation_rules VALUES (46, 'ESET Host Intrusion Prevention System Triggered', 3, 3, 2, 'Defense Evasion, Privilege Escalation', 'T1055 - Process Injection', 'Detects when ESET''s Host-based Intrusion Prevention System (HIPS) blocks suspicious behavior, including process manipulation, registry modifications, and file system changes that indicate potential malware activity. HIPS events indicate active attempts to compromise system integrity through various attack techniques.

Next Steps:
1. Review the blocked process or action details in the ESET console
2. Identify the source application attempting the blocked behavior
3. Check if the blocked action is from legitimate software (false positive)
4. If malicious, isolate the affected system and perform full malware scan
5. Review system logs for any successful compromise attempts before HIPS activation
6. Update HIPS rules if necessary to prevent similar attacks
7. Check for persistence mechanisms on the affected host
8. Review network connections from the suspicious process if applicable
', '["https://help.eset.com/ees/8/en-US/idh_hips_main.html","https://attack.mitre.org/techniques/T1055/"]', 'safe("actionResult", "") == "HIPS_Event" && safe("action", "") == "blocked" && safe("severity", "") in ["medium", "high"]', '2025-09-03 12:06:04.107796', true, false, 'origin', NULL, '[]');
INSERT INTO public.utm_correlation_rules VALUES (39, 'Threat Actor Attribution', 2, 2, 1, 'Threat Intelligence', 'T1583 - Acquire Infrastructure', 'Correlates observed attack patterns, tools, techniques, and infrastructure with known threat actor profiles to provide attribution intelligence and identify potential threat actors based on high-confidence indicators.

Next Steps:
1. Review the attributed threat actor profile and historical campaigns for context
2. Analyze the specific TTPs (Tactics, Techniques, and Procedures) that triggered the attribution
3. Check for related activity from the same actor across other systems or time periods
4. Correlate with threat intelligence feeds to validate attribution confidence
5. Document observed infrastructure and tooling for future threat hunting
6. Consider implementing specific detections for this actor''s known techniques
7. Share attribution indicators with security teams for enhanced monitoring
8. Escalate to incident response team if high-profile threat actor is identified
', '["https://attack.mitre.org/groups/","https://malpedia.caad.fkie.fraunhofer.de/"]', 'safe("log.eventType", "") == "threat_attribution" && safe("log.attributionConfidence", 0) >= 70 && safe("log.actorProfile", "") != "" && safe("log.deceptionTriggered", false) == true && (safe("log.ttpsMatched", 0) >= 3 || safe("log.infrastructureMatch", false) == true || safe("log.toolingFingerprint", "") != "") && safe("log.historicalCampaignMatch", false) == true', '2025-09-03 12:04:00.982549', true, false, 'origin', NULL, '[]');
INSERT INTO public.utm_correlation_rules VALUES (48, 'ESET Network Attack Detection', 3, 2, 1, 'Initial Access', 'T1190 - Exploit Public-Facing Application', 'Detects network-based attacks and exploits blocked by ESET''s Network Attack Protection (IDS). This includes attempts to exploit known vulnerabilities in network services and protocols.

Next Steps:
1. Review the attack details in ESET console to identify the specific vulnerability or attack pattern
2. Check if the source IP is known malicious using threat intelligence sources
3. Verify if other systems received similar attacks from the same source
4. Review firewall logs for additional suspicious activity from the source IP
5. Consider blocking the source IP at the perimeter firewall if attacks persist
6. Update network security policies and ensure all systems are patched
', '["https://help.eset.com/ees/7/en-US/idh_config_epfw_network_attack_protection.html","https://attack.mitre.org/techniques/T1190/"]', 'safe("log.event_type", "") == "NetworkProtection_Event" && safe("action", "") == "blocked" && exists("origin.ip")', '2025-09-03 12:06:05.278904', true, false, 'origin', NULL, '[]');
INSERT INTO public.utm_correlation_rules VALUES (41, 'Advanced Heuristic Detection Triggers', 3, 3, 2, 'Defense Evasion, Privilege Escalation', 'T1055 - Process Injection', 'Detects when ESET''s advanced heuristic engine identifies suspicious behavior patterns that may indicate novel malware or zero-day threats. These detections use DNA signatures and behavioral analysis.

Next Steps:
- Review the affected hostname and user context to understand the scope
- Check the process name (if available) that triggered the detection
- Verify if the action taken (cleaned/deleted/quarantined) was successful
- Look for related alerts from the same host within the past 24 hours
- If multiple hosts show similar detections, investigate potential lateral movement
- Consider isolating the affected system if threat persists
- Review ESET console link (if available) for detailed threat information
- Check file hash against threat intelligence databases if available
- Capture and analyze the malicious file sample if quarantined
- Review system logs for any unusual activities before and after detection
- Update ESET signatures and run a full system scan
', '["https://help.eset.com/eea/8/en-US/idh_config_threat_sense.html","https://attack.mitre.org/techniques/T1055/"]', '( safe("log.msgType", "") == "EnterpriseInspectorAlert_Event" || safe("log.msgType", "") == "threat_event" || safe("log.msgType", "") == "FirewallAggregatedAlert_Event" ) && ( safe("log.message", "").contains("heuristic") || safe("log.message", "").contains("NewHeur") || safe("log.message", "").contains("suspicious behavior") ) && ( safe("log.message", "").contains("cleaned") || safe("log.message", "").contains("deleted") || safe("log.message", "").contains("quarantined") || safe("log.message", "").contains("blocked") )', '2025-09-03 12:05:59.331554', true, false, 'origin', NULL, '[]');
INSERT INTO public.utm_correlation_rules VALUES (42, 'ESET Botnet Communication Detection', 3, 3, 2, 'Command and Control', 'T1071 - Application Layer Protocol', 'Detects attempts to communicate with known botnet command and control servers. ESET identifies typical communication patterns when a computer is infected and a bot is attempting to communicate with malicious C2 infrastructure.

Next Steps:
1. Immediately isolate the affected system from the network to prevent further C2 communication
2. Check the hostname (log.headHostname) to identify the affected system
3. Review the full log message content (log.jsonMessage) for additional threat details including target IPs and processes
4. Review process activity on the affected host to identify the malicious process
5. Scan the system with ESET for complete malware removal
6. Check other systems in the network for similar C2 communication attempts
7. Update firewall rules to block any identified C2 server IPs found in the logs
8. Consider reimaging the system if the infection persists
9. Review ESET logs for the time period around this detection to identify related malicious activity
', '["https://www.eset.com/us/botnet/","https://support.eset.com/en/kb7487-resolve-the-incomingattackgeneric-or-botnetcncgeneric-network-protection-alert","https://attack.mitre.org/techniques/T1071/"]', '(safe("log.message", "") contains "Botnet" || safe("log.message", "") contains "CnC.Generic" || safe("log.message", "") contains "botnet" || safe("log.message", "") contains "C&C" || safe("log.message", "") contains "command and control") && safe("log.headHostname", "") != ""', '2025-09-03 12:06:00.372901', true, false, 'origin', NULL, '[]');
INSERT INTO public.utm_correlation_rules VALUES (1234, 'PowerCLI Script Execution Detection', 3, 3, 2, 'Execution', 'T1059 - Command and Scripting Interpreter', 'Detects PowerCLI script execution on VMware ESXi hosts by monitoring for authentication events and command execution patterns associated with MS Web Services Client Protocol, which is unique to PowerCLI connections. PowerCLI is VMware''s powerful command-line tool that can be used by attackers to perform reconnaissance, lateral movement, or persistence on virtualized infrastructure.

Next Steps:
1. Verify if the PowerCLI activity is authorized by checking with the VMware administrators
2. Review the source IP address and user account to determine if they are legitimate
3. Check for any suspicious commands or configuration changes made through PowerCLI
4. Review ESXi audit logs for any unauthorized changes to VM configurations or host settings
5. If unauthorized, immediately revoke access and investigate the scope of potential compromise
6. Consider implementing stricter access controls and monitoring for PowerCLI usage
', '["https://attack.mitre.org/techniques/T1059/","https://blogs.vmware.com/vsphere/2013/07/capturing-logins-to-esxi-by-a-root-account.html"]', 'safe("log.message", "").matches("(?i)MS Web Services Client Protocol") ||
(safe("log.message", "").matches("(?i)authentication of user") && safe("log.message", "").matches("(?i)PowerCLI")) ||
(safe("log.process", "").matches("(?i)vimsvc") && safe("log.message", "").matches("(?i)Auth") && safe("log.message", "").matches("(?i)User")) ||
(safe("log.message", "").matches("(?i)Syslog\\.global\\.log") && safe("log.message", "").matches("(?i)Set-VMHost")) ||
safe("log.message", "").matches("(?i)Get-VMHostSysLogServer")
', '2025-09-04 19:00:06.725494', true, false, 'origin', '["origin.hostname"]', '[]');
INSERT INTO public.utm_correlation_rules VALUES (47, 'Machine Learning Detection Anomalies', 3, 3, 2, 'Execution', 'T1204.002 - User Execution: Malicious File', 'Identifies threats detected by ESET''s machine learning engine that analyzes file behavior patterns and characteristics to identify previously unknown malware variants. Machine learning detection indicates advanced malware that may evade signature-based detection methods.

Next Steps:
- Immediately investigate the affected host for signs of compromise
- Review the threat details in the log message to understand the malware type and behavior
- Check if the malware was successfully blocked or quarantined
- Look for similar detections across other hosts in your environment
- Consider isolating the affected system if the threat was not successfully contained
- Review process activity around the time of detection for suspicious behavior
- Collect and analyze the malware sample if available for threat intelligence
- Update security policies to prevent similar threats
- Check for any data exfiltration or lateral movement attempts from the affected host
', '["https://help.eset.com/protect_admin/11.0/en-US/events-exported-to-json-format.html","https://attack.mitre.org/techniques/T1204/002/"]', 'safe("log.message", "").contains("machine learning") && (safe("log.message", "").contains("threat") || safe("log.message", "").contains("detected") || safe("log.message", "").contains("found")) && safe("log.msgType", "") != "" && safe("log.headHostname", "") != ""', '2025-09-03 12:06:04.557174', true, false, 'origin', NULL, '[]');
INSERT INTO public.utm_correlation_rules VALUES (49, 'Registry Modification Attempts Blocked', 2, 3, 2, 'Defense Evasion, Persistence', 'T1112 - Modify Registry', 'Identifies attempts to modify critical Windows registry keys that were blocked by ESET, indicating potential persistence or system tampering attempts. Registry modifications are a common technique used by malware to establish persistence, disable security features, or alter system behavior.

Next Steps:
1. Review the blocked action details to understand what registry key was targeted
2. Investigate the source process and user account involved in the attempt
3. Check for other security events from the same host around the same time
4. Verify if this is legitimate administrative activity or potential malicious behavior
5. If suspicious, isolate the affected system and perform a full malware scan
6. Review system logs for any successful registry modifications before the block occurred
', '["https://help.eset.com/esmc_admin/70/en-US/events-exported-to-json-format.html","https://attack.mitre.org/techniques/T1112/"]', 'safe("log.message", "") != "" && safe("log.message", "").contains("registry") && safe("action", "") in ["blocked", "denied", "prevented"] && safe("severity", "") in ["high", "medium"]', '2025-09-03 12:06:06.597723', true, false, 'origin', '["target.host"]', '[]');
INSERT INTO public.utm_correlation_rules VALUES (50, 'Firewall Rule Violations', 2, 2, 3, 'Command and Control', 'T1071 - Application Layer Protocol', 'Detects firewall rule violations and suspicious network connection attempts blocked by ESET Firewall, including potential command and control communications or data exfiltration attempts. This rule triggers when ESET blocks network connections to suspicious ports or when high/medium severity events are detected.

Next Steps:
1. Review the blocked connection details including source IP, destination IP, and port
2. Check if the source IP is associated with any known compromised systems
3. Investigate the process that initiated the blocked connection
4. Review ESET logs for additional context about why the connection was blocked
5. If the blocked connection appears malicious, check for other indicators of compromise on the affected system
6. Consider adding permanent firewall rules to block persistent malicious connection attempts
', '["https://help.eset.com/protect_cloud/en-US/events-exported-to-json-format.html","https://attack.mitre.org/techniques/T1071/"]', 'safe("log.action", "") in ["blocked", "denied", "dropped"] && safe("origin.ip", "") != "" && safe("target.ip", "") != "" && ( safe("target.port", 0) in [22, 23, 445, 3389, 4444, 8080, 8443] || safe("severity", "") in ["high", "medium"] )', '2025-09-03 12:06:45.227595', true, false, 'origin', NULL, '[]');
INSERT INTO public.utm_correlation_rules VALUES (51, 'Suspicious Encrypted File Activity', 3, 3, 2, 'Impact', 'T1486 - Data Encrypted for Impact', 'Detects suspicious encrypted file activities that may indicate ransomware encryption attempts or unauthorized file encryption operations. This rule triggers when ESET detects ransomware-related threats or file encryption activities.

Next Steps:
1. Immediately isolate the affected system to prevent spread
2. Check if backup systems are accessible and uncompromised
3. Review the threat details in log.message for specific ransomware variant
4. Look for other systems showing similar encryption patterns
5. Preserve forensic evidence before remediation
6. Consider engaging incident response team for ransomware cases
7. Do not power off the system if encryption is in progress
', '["https://attack.mitre.org/techniques/T1486/","https://help.eset.com/protect_admin/10.1/en-US/events-exported-to-json-format.html"]', 'safe("log.msgType", "") == "Threat_Event" && (safe("log.message", "").contains("ransomware") || safe("log.message", "").contains("filecoder") || safe("log.message", "").contains("encrypted") || safe("log.message", "").contains(".encrypted"))', '2025-09-03 12:06:46.515352', true, false, 'origin', '["target.host"]', '[]');
INSERT INTO public.utm_correlation_rules VALUES (52, 'ESET Blocked Suspicious PowerShell Activity', 3, 3, 1, 'Execution', 'T1059.001 - Command and Scripting Interpreter: PowerShell', 'Detects when ESET blocks suspicious PowerShell commands or scripts that exhibit malicious behavior patterns, including obfuscated scripts, encoded commands, or attempts to bypass execution policies. This is a high-priority security event that indicates potential malicious activity was prevented.

Next Steps:
1. Review the blocked PowerShell command details in the log message
2. Identify the user account and process that attempted to execute PowerShell
3. Check if this is part of legitimate administrative activity or scripting
4. Investigate the source of the PowerShell execution (parent process, script location)
5. Look for other suspicious activities from the same host or user
6. Consider isolating the affected system if malicious intent is confirmed
7. Review and update PowerShell execution policies if needed
', '["https://help.eset.com/ees/8/en-US/idh_hips_main.html","https://attack.mitre.org/techniques/T1059/001/"]', 'safe("log.message", "").matches("(?i)(powershell|pwsh)") && safe("log.action", "") == "blocked" && safe("log.headHostname", "") != ""', '2025-09-03 12:06:47.254277', true, false, 'origin', NULL, '[]');
INSERT INTO public.utm_correlation_rules VALUES (53, 'Suspicious Process Behavior Detection', 3, 3, 2, 'Defense Evasion, Privilege Escalation', 'T1055 - Process Injection', 'Detects suspicious process behaviors including injection attempts, privilege escalation, and abnormal process creation patterns identified by ESET''s behavioral monitoring. This alert indicates potential malware activity or exploitation attempts on the affected system.

Next Steps:
1. Immediately review the alert details to identify:
   - Affected hostname (check log.headHostname)
   - Specific threat or behavior detected (check log.jsonMessage)
   - Process name and path if available
   - Time of detection (check log.deviceTime)
2. Investigate the process that triggered the alert:
   - Verify if it''s a legitimate application or unknown/suspicious
   - Check process creation chain and parent-child relationships
   - Review file hash against threat intelligence sources
3. Check for related security events:
   - Look for other ESET alerts from the same host
   - Search for network connections from the suspicious process
   - Review authentication events around the same timeframe
4. Containment actions if malicious:
   - Isolate the affected host from the network
   - Kill the suspicious process if still running
   - Preserve forensic evidence (memory dump, logs)
5. Remediation steps:
   - Run full antivirus scan on the affected system
   - Check for persistence mechanisms (registry, scheduled tasks)
   - Update ESET signatures and perform system hardening
6. Prevention measures:
   - Review and update application control policies
   - Ensure ESET real-time protection is enabled
   - Consider implementing application whitelisting
', '["https://help.eset.com/ees/12/en-US/idh_dialog_epfw_ids_alert.html","https://attack.mitre.org/techniques/T1055/"]', 'safe("log.msgType", "") in ["EnterpriseInspectorAlert_Event", "HIPS_Event"] && safe("log.message", "") != "" && ( safe("log.message", "").contains("Process injection") || safe("log.message", "").contains("Suspicious behavior") || safe("log.message", "").contains("Anomalous process") || safe("log.message", "").contains("blocked") || safe("log.message", "").contains("terminated") || safe("log.message", "").contains("prevented") )', '2025-09-03 12:06:48.331151', true, false, 'origin', NULL, '[]');
INSERT INTO public.utm_correlation_rules VALUES (111, 'AWS EC2 Full Network Packet Capture Detected', 3, 2, 2, 'Data Staged', 'Exfiltration', 'Identifies potential Traffic Mirroring in an Amazon Elastic Compute Cloud (EC2) instance. Traffic Mirroring is an Amazon VPC feature that you can use to copy network traffic from an elastic network interface. This feature can potentially be abused to exfiltrate sensitive data from unencrypted internal traffic', '["https://attack.mitre.org/tactics/TA0010/","https://attack.mitre.org/techniques/T1020/","https://attack.mitre.org/tactics/TA0009/","https://attack.mitre.org/techniques/T1074/","https://docs.aws.amazon.com/AWSEC2/latest/APIReference/API_TrafficMirrorFilter.html","https://github.com/easttimor/aws-incident-response"]', 'safe("log.eventSource", "") == ''ec2.amazonaws.com'' && (safe("log.eventName", "") == ''CreateTrafficMirrorFilter'' || safe("log.eventName", "") == ''CreateTrafficMirrorFilterRule'' || safe("log.eventName", "") == ''CreateTrafficMirrorSession'' || safe("log.eventName", "") == ''CreateTrafficMirrorTarget'')', '2025-09-03 12:27:14.512582', true, false, 'target', NULL, '[]');
INSERT INTO public.utm_correlation_rules VALUES (54, 'Webcam Access Violation', 3, 2, 1, 'Collection', 'T1123 - Audio Capture', 'Detects unauthorized or suspicious attempts to access the webcam, potentially indicating spyware or surveillance malware activity. ESET''s webcam protection feature blocks unauthorized applications from accessing the camera device.

Next Steps:
1. Investigate the process attempting to access the webcam - verify if it''s legitimate software
2. Check if the user intentionally installed the application
3. Review recent software installations on the affected host
4. Scan the system for additional malware indicators
5. Check for other privacy-related alerts (microphone access, screen recording)
6. If unauthorized, quarantine the process and perform a full system scan
7. Review ESET logs for additional context about the blocked application
8. Consider updating webcam protection policies if legitimate applications are being blocked
', '["https://attack.mitre.org/techniques/T1123/","https://help.eset.com/eis/16.2/en-US/idh_config_webcam.html"]', '(safe("log.message", "").lower().contains("webcam") || safe("log.message", "").lower().contains("webcam") || safe("log.restHead", "").lower().contains("webcam")) && (safe("actionResult", "").lower().contains("block") || safe("action", "").lower().contains("block") || safe("log.message", "").lower().contains("block"))', '2025-09-03 12:06:49.193739', true, false, 'origin', '["target.host"]', '[]');
INSERT INTO public.utm_correlation_rules VALUES (55, 'Kaspersky Certificate Validation Failures', 3, 3, 1, 'Defense Evasion', 'T1553.004 - Subvert Trust Controls: Install Root Certificate', 'Detects certificate validation failures that may indicate attempts to bypass security controls, man-in-the-middle attacks, or use of fraudulent certificates. This includes invalid SSL certificates, expired certificates, or suspicious certificate chains. Common Kaspersky events include "SSL connection with invalid certificate detected" and "Certificate verification problem detected".

Next Steps:
- Identify the source IP and destination URL/domain associated with the certificate failure
- Check if the certificate issue is widespread or isolated to specific connections
- Verify if the destination is a legitimate service with a known certificate issue
- Review proxy/firewall logs for related SSL/TLS interception attempts
- Check for any recent changes to certificate stores or trusted root CAs
- Investigate if malware is attempting to establish encrypted C2 channels
- Consider blocking the destination if it''s consistently presenting invalid certificates
', '["https://support.kaspersky.com/KATA/3.6/en-US/175942.htm","https://attack.mitre.org/techniques/T1553/","https://attack.mitre.org/techniques/T1553/004/"]', 'safe("log.signatureID", "") != "" && ( safe("log.msg", "").contains("certificate") || safe("log.msg", "").contains("SSL") || safe("log.msg", "").contains("TLS") || safe("log.cs1", "").contains("CERT_") || safe("log.cs4", "").contains("Certificate") || safe("log.msg", "").contains("certificate validation") || safe("log.msg", "").contains("invalid cert") || safe("log.msg", "").contains("SSL connection with invalid certificate") || safe("log.msg", "").contains("Certificate verification problem") ) && ( safe("log.msg", "").contains("invalid") || safe("log.msg", "").contains("expired") || safe("log.msg", "").contains("suspicious") || safe("log.msg", "").contains("failed") || safe("log.msg", "").contains("untrusted") || safe("log.msg", "").contains("verification problem") || safe("log.cs1", "").contains("FAIL") )', '2025-09-03 12:11:17.368048', true, false, 'origin', '["origin.host","target.host","log.dst"]', '[]');
INSERT INTO public.utm_correlation_rules VALUES (56, 'Code Injection Attempt Detection', 3, 3, 2, 'Defense Evasion, Privilege Escalation', 'T1055 - Process Injection', 'Detects attempts to inject malicious code into legitimate processes. This technique is commonly used by malware to evade detection and gain elevated privileges by running within trusted processes.

Next Steps:
1. Immediately isolate the affected system to prevent lateral movement
2. Identify the source process that attempted the injection
3. Check if the malware was successfully quarantined or if manual removal is needed
4. Review system logs for any suspicious activities around the same timeframe
5. Scan the system with updated antivirus definitions
6. Check for persistence mechanisms (scheduled tasks, registry keys, services)
7. Review network connections from the affected host for C2 communications
8. Consider reimaging the system if critical processes were compromised
', '["https://attack.mitre.org/techniques/T1055/","https://support.kaspersky.com/KESWin/11/en-us/151065.htm"]', '(safe("log.signatureID", "") == "3" || safe("log.cs1", "") == "DETECT") && (safe("log.msg", "").matches("(?i).*(inject|injection|CreateRemoteThread|SetWindowsHookEx|WriteProcessMemory).*") || safe("log.cs4", "").matches("(?i).*(inject|hooking|trojan|backdoor).*") || safe("log.action", "").matches("(?i).*(terminate|delete|quarantine).*")) && (safe("log.msg", "").matches("(?i).*(lsass|csrss|winlogon|services|svchost|explorer).*") || safe("log.msg", "").contains("process"))', '2025-09-03 12:11:18.113463', true, false, 'origin', NULL, '[]');
INSERT INTO public.utm_correlation_rules VALUES (71, 'Kaspersky WMI Abuse Detection', 3, 3, 2, 'Execution', 'T1047 - Windows Management Instrumentation', 'Detects potential Windows Management Instrumentation (WMI) abuse identified by Kaspersky, including suspicious WMI queries, event subscriptions, or process creation via WMI. WMI is a legitimate Windows component often abused by attackers for lateral movement, persistence, and code execution.

Next Steps:
1. Identify the affected host and user account involved in the WMI activity
2. Review the specific WMI commands or queries that triggered the alert
3. Check for any unauthorized scheduled tasks or startup items created via WMI
4. Look for other indicators of compromise on the affected system
5. Verify if this is legitimate administrative activity or potential malicious behavior
6. If confirmed malicious, isolate the system and perform incident response procedures
', '["https://attack.mitre.org/techniques/T1047/","https://support.kaspersky.com/KLMS/8.2/en-US/151684.htm"]', '(safe("log.msg", "").contains("WMI") || safe("log.msg", "").contains("wmi") || safe("log.msg", "").contains("wmic") || safe("log.msg", "").contains("winmgmt") || safe("log.msg", "").contains("scrcons.exe") || safe("log.msg", "").contains("WMI")) && (safe("log.cefDeviceSeverity", 0) >= 3 || safe("log.cat", "") == "blocked")', '2025-09-03 12:13:05.765806', true, false, 'origin', NULL, '[]');
INSERT INTO public.utm_correlation_rules VALUES (57, 'Kaspersky Command and Control Communication Detection', 3, 3, 2, 'Command and Control', 'T1071 - Application Layer Protocol', 'Detects potential command and control (C2) communication attempts identified by Kaspersky, including suspicious outbound connections, malware callbacks, and botnet communication patterns. This rule triggers when Kaspersky identifies network threats related to botnet activity, C2 communications, or malware beaconing that was not successfully blocked.

Next Steps:
1. Immediately isolate the affected system from the network to prevent further C2 communication
2. Review the target IP address against threat intelligence feeds to confirm malicious activity
3. Check if other systems have communicated with the same C2 server
4. Analyze the process or malware that initiated the connection
5. Review Kaspersky logs for additional context about the threat
6. Perform a full system scan and forensic analysis on the affected machine
7. Update antivirus signatures and ensure real-time protection is enabled
8. Consider reimaging the system if compromise is confirmed
', '["https://attack.mitre.org/techniques/T1071/","https://support.kaspersky.com/KLMS/8.2/en-US/151504.htm"]', '(safe("log.cs2", "").matches(".*[Bb]ot.*") || safe("log.cs2", "").matches(".*C2.*") || safe("log.cs2", "").matches(".*[Cc]ommand.*[Cc]ontrol.*") || safe("log.msg", "").matches(".*callback.*") || safe("log.msg", "").matches()".*beacon.*") || safe("log.cat", "") == "NetworkThreat") && safe("target.ip", "") != "" && safe("action", "") != "blocked"', '2025-09-03 12:11:18.618793', true, false, 'origin', NULL, '[]');
INSERT INTO public.utm_correlation_rules VALUES (58, 'Kaspersky Critical Object Detection', 3, 3, 2, 'Execution', 'T1204 - User Execution: Malicious File', 'Detects when Kaspersky identifies critical threats including malware, trojans, or other dangerous objects that require immediate attention. High severity detections often indicate active threats.

Next Steps:
1. Immediately isolate the affected system from the network to prevent lateral movement
2. Identify the malware name/signature from log.cs1, log.cs2, or log.cs4 fields
3. Check if Kaspersky successfully quarantined or removed the threat
4. Scan other systems in the same network segment for similar infections
5. Review recent user activity and email attachments that could be the infection vector
6. Collect and preserve forensic artifacts if needed for incident response
7. Update antivirus signatures and run a full system scan
8. Consider reimaging the system if the infection is severe or persistent
', '["https://support.kaspersky.com/ScanEngine/1.0/en-US/186767.htm","https://attack.mitre.org/techniques/T1204/"]', 'safe("log.signatureID", "") != "" && safe("log.cefDeviceSeverity", "") == "High" && (contains(safe("log.cs1", ""), "INFECTED") || contains(safe("log.cs1", ""), "MALWARE") || contains(safe("log.cs1", ""), "TROJAN") || contains(safe("log.cs2", ""), "Trojan") || contains(safe("log.cs4", ""), "Trojan") || contains(safe("log.message", ""), "infected") || contains(safe("log.message", ""), "malicious"))', '2025-09-03 12:11:19.491508', true, false, 'origin', NULL, '[]');
INSERT INTO public.utm_correlation_rules VALUES (59, 'Kaspersky Data Exfiltration Attempts Detection', 3, 2, 1, 'Exfiltration', 'T1048 - Exfiltration Over Alternative Protocol', 'Detects potential data exfiltration attempts identified by Kaspersky through suspicious network traffic patterns, large data transfers, or connections to suspicious external destinations. This rule monitors for network threats, trojan/backdoor detections, and suspicious data transfer patterns that may indicate data exfiltration.

Next Steps:
1. Immediately identify the source host (origin.ip) and any associated user accounts on the affected system
2. Check if the destination IP (target.ip) is known malicious using threat intelligence sources
3. Review the volume and frequency of data transfers to this destination in the last 24-48 hours
4. Search for any other malware detections (especially Trojans/Backdoors) on the same host
5. Analyze network traffic logs for unusual patterns or protocols from the source IP
6. Check if other hosts in your network have connected to the same destination
7. If confirmed malicious:
   - Block the destination IP at firewall/proxy level
   - Isolate the affected system from network
   - Initiate full incident response procedures
   - Preserve evidence for forensic analysis
8. Document all findings and actions taken for compliance and future reference
', '["https://attack.mitre.org/techniques/T1048/","https://support.kaspersky.com/KLMS/8.2/en-US/151684.htm"]', '(safe("log.cat", "") == "NetworkThreat" || safe("log.cs2", "").matches("(?i).*(trojan|backdoor).*") || safe("log.msg", "").matches("(?i).*(data.*transfer|exfiltrat|upload.*suspicious|unauthorized.*transfer).*") || safe("log.msg", "").matches("(?i).*(data.*exfiltration|suspicious.*upload|unauthorized.*transfer).*")) && safe("target.ip", "") != "" && int(safe("log.cefDeviceSeverity", "0")) >= 3', '2025-09-03 12:11:20.454124', true, false, 'origin', NULL, '[]');
INSERT INTO public.utm_correlation_rules VALUES (60, 'Lateral Movement Indicators Detection', 3, 3, 2, 'Lateral Movement', 'T1021 - Remote Services', 'Detects indicators of lateral movement attempts within the network through Kaspersky antivirus logs. 
Attackers use various techniques including PSExec, WMI, RDP, SMB shares, and exploitation tools to move 
from one compromised system to others, expanding their access and control across the network. This rule 
identifies blocked or detected activities that may indicate lateral movement attempts.

Next Steps:
1. Investigate the source IP and hostname for signs of compromise
2. Review authentication logs for the same time period to identify potential credential theft
3. Check if the detected tools (PSExec, WMI, RDP) are authorized for use in your environment
4. Examine network traffic between the source and destination systems
5. Look for other suspicious activities from the same source host
6. Consider isolating affected systems if lateral movement is confirmed
7. Review similar patterns from the same source within the detection window
', '["https://attack.mitre.org/tactics/TA0008/","https://support.kaspersky.com/KESWin/11/en-us/151065.htm"]', '(safe("log.cn1", "") == "3" || safe("log.cs1", "") == "DETECT" || safe("log.act", "") == "blocked") && (safe("log.msg", "").contains("psexec") || safe("log.msg", "").contains("wmi") || safe("log.msg", "").contains("rdp") || safe("log.msg", "").contains("smb") || safe("log.msg", "").contains("admin$") || safe("log.msg", "").contains("ipc$") || safe("log.msg", "").contains("c$") || safe("log.msg", "").contains("remote") || safe("log.msg", "").contains("lateral") || safe("log.msg", "").contains("pivot") || safe("log.cs4", "").contains("exploit") || safe("log.cs4", "").contains("mimikatz") || safe("log.cs4", "").contains("bloodhound") || safe("log.cs4", "").contains("sharphound") || safe("log.cs4", "").contains("propagat")) && safe("log.dst", "") != "" && safe("log.src", "") != "" && safe("log.src", "") != safe("log.dst", "")', '2025-09-03 12:11:21.594142', true, false, 'origin', NULL, '[]');
INSERT INTO public.utm_correlation_rules VALUES (76, 'SentinelOne Cloud Workload Protection Alert', 3, 3, 2, 'Defense Evasion, Persistence, Privilege Escalation, Initial Access', 'T1078.004 - Valid Accounts: Cloud Accounts', 'Detects cloud workload protection alerts including suspicious cloud API calls, unauthorized cloud resource access, cloud account compromise, or cloud-native threat detection.

Next Steps:
1. Review the specific cloud workload alert details in the SentinelOne console
2. Identify the affected cloud resources (AWS, Azure, GCP) and account involved
3. Check for any unauthorized changes to cloud configurations or resources
4. Review cloud provider logs for the time period around the alert
5. Verify if the activity was authorized or part of legitimate operations
6. If suspicious, immediately revoke any compromised credentials or access keys
7. Enable additional cloud security monitoring and alerts if not already configured
8. Document findings and update incident response procedures as needed
', '["https://www.sentinelone.com/platform/singularity-cloud-workload-security/","https://attack.mitre.org/techniques/T1078/004/"]', 'safe("log.eventDescription", "") != "" && ( safe("log.eventDescription", "").lower().contains("cloud") || safe("log.eventDescription", "").lower().contains("aws") || safe("log.eventDescription", "").lower().contains("azure") || safe("log.eventDescription", "").lower().contains("gcp") || safe("log.eventDescription", "").lower().contains("lambda") || safe("log.eventDescription", "").lower().contains("s3") || safe("log.eventDescription", "").lower().contains("ec2") || safe("log.eventDescription", "").lower().contains("workload") ) && ( safe("log.eventDescription", "").lower().contains("suspicious") || safe("log.eventDescription", "").lower().contains("unauthorized") || safe("log.eventDescription", "").lower().contains("anomaly") || safe("log.eventDescription", "").lower().contains("threat") || safe("log.eventDescription", "").lower().contains("compromise") || safe("log.eventDescription", "").lower().contains("breach") || safe("log.eventDescription", "").lower().contains("attack") || safe("log.eventDescription", "").lower().contains("malicious") )', '2025-09-03 12:17:01.899317', true, false, 'origin', NULL, '[]');
INSERT INTO public.utm_correlation_rules VALUES (62, 'Kaspersky Application Privilege Escalation Detection', 3, 3, 2, 'Defense Evasion, Privilege Escalation', 'T1055/T1134 - Process Injection and Access Token Manipulation', 'Detects attempts to escalate privileges through application manipulation, process injection, or unauthorized elevation of permissions monitored by Kaspersky endpoint protection. These techniques are commonly used by attackers to gain higher-level permissions on compromised systems.

Next Steps:
1. Immediately isolate the affected system to prevent lateral movement
2. Review the process that triggered the alert and its parent process chain
3. Check if the source process is legitimate or potentially malicious
4. Look for other suspicious activities on the same host in the last hour
5. Collect memory dumps if possible for forensic analysis
6. Review user account permissions and recent changes
7. Check for any unauthorized scheduled tasks or services
8. Update Kaspersky signatures and run a full system scan
', '["https://support.kaspersky.com/KLMS/8.2/en-US/151684.htm","https://attack.mitre.org/techniques/T1055/","https://attack.mitre.org/techniques/T1134/"]', 'safe("log.signatureID", "") != "" && safe("log.action", "") != "Allowed" && ( safe("log.msg", "").contains("privilege") || safe("log.msg", "").contains("elevation") || safe("log.msg", "").contains("EXPLOIT") || safe("log.msg", "").contains("Exploit") || safe("log.msg", "").contains("process injection") || safe("log.msg", "").contains("token manipulation") || safe("log.cs1", "").contains("EXPLOIT") || safe("log.cs2", "").contains("Exploit") || safe("log.cs4", "").contains("Exploit") )', '2025-09-03 12:11:24.154411', true, false, 'origin', NULL, '[]');
INSERT INTO public.utm_correlation_rules VALUES (61, 'Living Off the Land Binaries (LOLBins) Abuse Detection', 3, 3, 2, 'Defense Evasion', 'T1218 - System Binary Proxy Execution', 'Detects the malicious use of legitimate Windows system binaries (LOLBins) to execute malicious code. Attackers abuse these trusted tools to bypass security controls and maintain persistence. LOLBins are particularly dangerous because they are signed Microsoft binaries that are trusted by most security products.

Next Steps:
1. Immediately isolate the affected system from the network to prevent lateral movement
2. Review the full context of the detection including command line parameters and parent processes
3. Check for any network connections or file downloads initiated by the LOLBin process
4. Look for persistence mechanisms (scheduled tasks, registry keys, services) created around the same time
5. Scan for additional indicators of compromise on the affected system
6. Review user account activity for signs of compromise or privilege escalation
7. Consider reimaging the system if fileless malware is confirmed
', '["https://attack.mitre.org/techniques/T1218/","https://lolbas-project.github.io/","https://www.kaspersky.com/enterprise-security/wiki-section/products/fileless-threats-protection"]', '(safe("log.signatureID", "") == "3" || safe("log.cs1", "") == "DETECT") && (safe("log.msg", "").matches("(?i).*(rundll32|regsvr32|mshta|certutil|bitsadmin|powershell|wmic|cscript|wscript|msiexec|installutil|regasm|regsvcs|msxsl|odbcconf|xwizard|ftp|dfsvc|syncappvpublishingserver|presentationhost|wab|atbroker|pcalua|forfiles).*") || safe("log.cs4", "").matches("(?i).*(fileless|living.{0,10}land|LOLBin|LOLBas).*")) && (safe("log.msg", "").matches("(?i).*(download|execute|bypass|encoded|obfuscat|hidden|malicious).*") || safe("actionResult", "") != "")', '2025-09-03 12:11:23.039934', true, false, 'origin', NULL, '[]');
INSERT INTO public.utm_correlation_rules VALUES (1235, 'Resource Pool Abuse Detection', 2, 2, 3, 'Impact', 'T1496 - Resource Hijacking', 'Detects potential abuse of VMware resource pools including unauthorized modifications, excessive resource consumption, and attempts to monopolize computing resources. Monitors for abnormal resource allocation patterns and policy violations.

**Next Steps:**
1. Investigate the ESXi host generating the alerts and verify the resource pool configuration
2. Check who made recent changes to resource pool settings and validate their authorization
3. Review CPU and memory utilization patterns on affected VMs and resource pools
4. Examine vCenter Server audit logs for unauthorized administrative actions
5. Verify that resource limits and reservations align with organizational policies
6. Check for signs of VM sprawl or unauthorized VM creation consuming excessive resources
7. Review performance charts in vSphere Client to identify resource contention patterns
8. Validate that resource pool hierarchies haven''t been modified without approval
9. Consider implementing resource pool alarms and DRS rules to prevent future abuse
10. Document findings and update resource governance policies if needed
', '["https://www.site24x7.com/help/virtualization-metrics/vmware-resourcepool-monitor.html","https://www.datadoghq.com/blog/vsphere-metrics/","https://attack.mitre.org/techniques/T1496/"]', 'safe("log.message", "").contains("Resource pool") ||
safe("log.message", "").contains("CPU limit exceeded") ||
safe("log.message", "").contains("Memory limit exceeded") ||
safe("log.message", "").contains("Resource reservation") ||
safe("log.message", "").contains("Resource shares modified") ||
safe("log.message", "").contains("Resource pool created") ||
safe("log.message", "").contains("Resource pool deleted") ||
safe("log.message", "").contains("Resource allocation failed") ||
safe("log.message", "").contains("Resource contention") ||
safe("log.message", "").contains("overuse resources") ||
(safe("log.process", "") == "hostd" && safe("log.message", "").contains("ResourcePool")) ||
(safe("log.process", "") == "vpxa" && safe("log.message", "").contains("Resource")) &&
safe("origin.hostname", "") != ""
', '2025-09-04 19:00:07.527785', true, false, 'origin', '["origin.hostname"]', '[]');
INSERT INTO public.utm_correlation_rules VALUES (1236, 'Suspicious Snapshot Manipulation', 3, 3, 2, 'Defense Evasion', 'T1578.001 - Create or Modify System Process: Snapshot', 'Detects suspicious snapshot manipulation activities that could indicate ransomware preparation, unauthorized access, or data exfiltration attempts. Monitors for rapid snapshot operations and unusual snapshot file access patterns.

Next Steps:
1. Verify the legitimacy of snapshot operations with the system administrator
2. Check for any scheduled backup or maintenance activities
3. Review user permissions for snapshot management
4. Examine concurrent file system activities on the affected virtual machines
5. Look for additional signs of ransomware activity or unauthorized access
6. Monitor for unusual network traffic patterns from the affected ESXi host
', '["https://blogs.vmware.com/security/2022/09/esxi-targeting-ransomware-the-threats-that-are-after-your-virtual-machines-part-1.html","https://attack.mitre.org/techniques/T1578/001/"]', '(safe("log.message", "").contains("CreateSnapshot") ||
 safe("log.message", "").contains("RemoveSnapshot") ||
 safe("log.message", "").contains("RevertToSnapshot")) &&
(safe("log.message", "").contains(".vmsn") ||
 safe("log.message", "").contains(".vmdk") ||
 safe("log.message", "").contains("snapshot") ||
 safe("log.process", "") == "hostd" ||
 safe("log.process", "").contains("vmx"))
', '2025-09-04 19:00:08.168938', true, false, 'origin', '["origin.hostname"]', '[{"indexPattern":"v11-log-vmware-esxi-*","with":[{"field":"origin.hostname.keyword","operator":"filter_term","value":"{{.origin.hostname}}"},{"field":"log.message","operator":"filter_match","value":"snapshot"}],"or":null,"within":"now-10m","count":3}]');
INSERT INTO public.utm_correlation_rules VALUES (1237, 'SSO Authentication Bypass Detection', 3, 3, 2, 'Defense Evasion, Persistence, Privilege Escalation, Initial Access', 'T1078.003 - Valid Accounts: Cloud Accounts', 'Detects potential SSO (Single Sign-On) authentication bypass attempts, failed SSO operations, or suspicious authentication patterns that could indicate unauthorized access attempts in VMware ESXi environments.

Next Steps:
1. Review the specific authentication error message and context
2. Verify the legitimacy of the source hostname attempting authentication
3. Check for concurrent failed authentication attempts from the same source
4. Review VMware vCenter and ESXi authentication logs for additional context
5. Verify SSO configuration and certificate validity
6. Check for any recent changes to authentication policies or SSO configuration
7. If confirmed malicious, block the source IP and reset affected user credentials
', '["https://docs.vmware.com/en/VMware-vSphere/8.0/vsphere-authentication/GUID-8B25F241-E123-4342-B34A-0F86104D3866.html","https://attack.mitre.org/techniques/T1078/003/"]', 'safe("log.message", "") != "" && 
(safe("log.message", "").contains("SSO") || safe("log.message", "").contains("Single Sign-On") || 
 safe("log.message", "").contains("authentication") || safe("log.message", "").contains("identity")) &&
(safe("log.message", "").contains("bypass") || safe("log.message", "").contains("failed") || safe("log.message", "").contains("denied") || 
 safe("log.message", "").contains("unauthorized") || safe("log.message", "").contains("invalid") || safe("log.message", "").contains("error") ||
 safe("log.message", "").contains("attempt") || safe("log.message", "").contains("violation"))
', '2025-09-04 19:00:08.784145', true, false, 'origin', '["origin.hostname"]', '[]');
INSERT INTO public.utm_correlation_rules VALUES (1451, 'Windows: User account created', 2, 3, 1, 'Persistence', 'Account Manipulation', 'Adversaries can manipulate accounts to maintain access to victim systems. These actions could also include account activity designed to subvert policies such as performing iterative password updates to bypass policies password lifetime and preserve the life of compromised credentials.', '["https://attack.mitre.org/tactics/TA0003/","https://attack.mitre.org/techniques/T1098/"]', 'safe("log.eventName", "").contains("A user account was created")', '2025-09-04 21:02:15.056146', true, false, 'origin', NULL, '[]');
INSERT INTO public.utm_correlation_rules VALUES (63, 'Process Hollowing Detection', 3, 3, 2, 'Defense Evasion, Privilege Escalation', 'T1055.012 - Process Injection: Process Hollowing', 'Detects process hollowing attempts where malware creates a new process in suspended state, unmaps its memory, and replaces it with malicious code. This advanced technique is used to evade detection by hiding malicious code within legitimate processes.

Next Steps:
1. Immediately isolate the affected system to prevent lateral movement
2. Identify the parent process that initiated the hollowing attempt
3. Check for persistence mechanisms on the affected host
4. Review process creation events around the same timeframe
5. Collect memory dumps for forensic analysis
6. Search for similar patterns across other endpoints
7. Update endpoint protection policies to block the identified threat
Solution:
1. Quarantine the affected process and any related files
2. Perform full system scan with updated antivirus signatures
3. Review and update application whitelisting policies
4. Implement additional process monitoring and behavioral analysis
5. Consider deploying endpoint detection and response (EDR) solutions
6. Update incident response procedures for process injection attacks
', '["https://attack.mitre.org/techniques/T1055/012/","https://www.kaspersky.com/enterprise-security/wiki-section/products/behavior-based-protection"]', '(safe("log.signatureID", "") == "3" || safe("log.cs1", "") == "DETECT") && (safe("log.msg", "").contains("hollow") || safe("log.msg", "").contains("RunPE") || safe("log.msg", "").contains("suspend") || safe("log.msg", "").contains("NtUnmapViewOfSection") || safe("log.msg", "").contains("ZwUnmapViewOfSection") || safe("log.cs4", "").contains("hollow") || safe("log.cs4", "").contains("RunPE") || safe("log.cs4", "").contains("replace") || safe("log.msg", "").contains("hollow") || safe("log.msg", "").contains("suspended") || safe("log.msg", "").contains("unmap")) && int(safe("log.cefDeviceSeverity", "0")) >= 3', '2025-09-03 12:11:24.873851', true, false, 'origin', '["origin.host","log.cs5"]', '[]');
INSERT INTO public.utm_correlation_rules VALUES (64, 'Kaspersky Sandbox Evasion Attempts Detection', 3, 3, 2, 'Defense Evasion, Discovery', 'T1497 - Virtualization/Sandbox Evasion', 'Identifies malware attempting to detect and evade sandbox environments. This includes time-based evasion, environment checks, anti-VM techniques, and other behaviors designed to avoid analysis in controlled environments.

Next Steps:
1. Immediately isolate the affected system to prevent potential malware spread
2. Review the process that triggered the sandbox evasion detection
3. Check for any suspicious parent processes or child processes
4. Collect memory dumps and samples for deeper analysis
5. Review recent file downloads and email attachments on the affected system
6. Check if similar detection occurred on other systems in the network
7. Consider submitting the sample to Kaspersky for further analysis
', '["https://www.kaspersky.com/enterprise-security/malware-sandbox","https://attack.mitre.org/techniques/T1497/","https://attack.mitre.org/techniques/T1497/001/"]', 'safe("log.signatureID", "") != "" && ( safe("log.msg", "").contains("sandbox") || safe("log.msg", "").contains("evasion") || safe("log.msg", "").contains("anti-VM") || safe("log.msg", "").contains("virtualization") || safe("log.msg", "").contains("sandbox") || safe("log.msg", "").contains("evasion") || safe("log.cs1", "").contains("SANDBOX_") || safe("log.cs4", "").contains("Evasion") || safe("log.cs4", "").contains("AntiVM") || safe("log.cs4", "").contains("environment check") || safe("log.cs4", "").contains("time delay") || safe("log.cs4", "").contains("VM detection") || (safe("log.cat", "") == "Behavior Detection" && (safe("log.msg", "").contains("delay") || safe("log.msg", "").contains("sleep"))) )', '2025-09-03 12:11:25.582423', true, false, 'origin', NULL, '[]');
INSERT INTO public.utm_correlation_rules VALUES (65, 'Kaspersky Suspicious Network Activity Detection', 3, 2, 2, 'Command and Control', 'T1071 - Application Layer Protocol', 'Detects suspicious network activities including unusual connections, potential C2 communications, or network-based attacks identified by Kaspersky security monitoring. This rule triggers when Kaspersky blocks network connections that match suspicious patterns and multiple similar events occur from the same host.

Next Steps:
1. Review the source and destination IP addresses for known malicious indicators using threat intelligence feeds
2. Check if the blocked connection was attempting to reach known C2 servers or suspicious domains
3. Examine the process that initiated the network connection (check log.processName or log.filePath if available)
4. Review other security events from the same host within the last hour for additional IOCs
5. Verify if multiple hosts are exhibiting similar network behavior (potential lateral movement or outbreak)
6. Check firewall logs for any successful connections to the same destination that may have bypassed Kaspersky
7. Consider isolating the affected system if C2 communication is confirmed
8. Run a full system scan on the affected host and check for persistence mechanisms
9. Review network traffic logs for data exfiltration attempts to the same destination
10. Document the incident and update block lists with confirmed malicious IPs/domains
', '["https://support.kaspersky.com/kwts/6.1/267200","https://attack.mitre.org/techniques/T1071/","https://attack.mitre.org/techniques/T1043/"]', 'safe("log.signatureID", "") != "" && ( safe("log.msg", "").contains("suspicious connection") || safe("log.msg", "").contains("network attack") || safe("log.msg", "").contains("network") || safe("log.cs1", "").contains("NETWORK") || safe("log.cs2", "").contains("Net-Worm") || safe("log.cs4", "").contains("Net-Worm") || safe("log.msg", "").contains("port scan") || safe("log.msg", "").contains("unusual traffic") || (safe("log.dstIP", "") != "" && safe("log.dpt", "") != "") ) && safe("action", "") == "Blocked"', '2025-09-03 12:12:59.709673', true, false, 'origin', NULL, '[]');
INSERT INTO public.utm_correlation_rules VALUES (101, 'AWS CloudTrail Log Suspended', 3, 2, 2, 'Impair Defenses', 'Defense Evasion', 'Identifies suspending the recording of AWS API calls and log file delivery for the specified trail. An adversary may suspend trails in an attempt to evade defenses', '["https://attack.mitre.org/tactics/TA0005/","https://attack.mitre.org/techniques/T1562/","https://docs.aws.amazon.com/awscloudtrail/latest/APIReference/API_StopLogging.html","https://awscli.amazonaws.com/v2/documentation/api/latest/reference/cloudtrail/stop-logging.html"]', 'safe("log.eventSource", "") == ''cloudtrail.amazonaws.com'' && safe("log.eventName", "") == ''StopLogging''', '2025-09-03 12:22:04.982731', true, false, 'origin', NULL, '[]');
INSERT INTO public.utm_correlation_rules VALUES (66, 'Suspicious Packed Executable Detection', 3, 3, 2, 'Defense Evasion', 'T1027.002 - Obfuscated Files or Information: Software Packing', 'Detects when Kaspersky identifies suspicious packed executables, which are often used by malware to evade detection and analysis. Packed executables use compression or encryption to hide their true content and make reverse engineering more difficult.

Next Steps:
1. Identify the affected system from origin.hostname and origin.ip fields
2. Review the detected threat details from log.msg and log.msg fields
3. Check the action taken by the antivirus (blocked/detected) in the action field
4. Verify if the file is legitimate software that uses packing for protection
5. If malicious, isolate the affected system immediately
6. Perform a full system scan to identify additional threats
7. Review process execution logs for suspicious child processes spawned by packed executables
8. Check network connections initiated by the suspicious executable
9. Submit the sample to Kaspersky or third-party sandbox for detailed analysis
10. Update antivirus signatures and ensure real-time protection is enabled
', '["https://www.kaspersky.com/resource-center/threats/suspicious-packers","https://attack.mitre.org/techniques/T1027/002/"]', '(safe("action", "") == "blocked" || safe("action", "") == "detected") && (safe("log.msg", "").contains("Packed") || safe("log.msg", "").contains("packer") || safe("log.msg", "").matches("(?i).*(NSAnti|Themida|VMProtect|ASPack|UPX|PECompact|Enigma|Armadillo|PESpin|MEW|FSG|Petite).*") || safe("log.msg", "").matches("(?i).*(NSAnti|Themida|VMProtect|ASPack|UPX|PECompact|Enigma|Armadillo|PESpin|MEW|FSG|Petite).*") || safe("log.cat", "").contains("Trojan.Packed") || safe("log.cat", "").contains("Packed"))', '2025-09-03 12:13:00.61469', true, false, 'origin', NULL, '[]');
INSERT INTO public.utm_correlation_rules VALUES (68, 'Kaspersky Suspicious Service Installation Detection', 2, 2, 2, 'Persistence, Privilege Escalation', 'T1543.003 - Create or Modify System Process: Windows Service', 'Detects suspicious Windows service installation or modification attempts identified by Kaspersky, which could indicate malware persistence mechanisms or privilege escalation attempts. Service manipulation is a common technique used by malware to maintain persistence on compromised systems.

Next Steps:
1. Identify the service name and executable path from the alert details
2. Verify if the service installation was authorized and legitimate
3. Check the digital signature and reputation of the service executable
4. Review parent process that initiated the service installation
5. Look for other suspicious activities on the affected host around the same time
6. If confirmed malicious, stop and remove the service, quarantine associated files
7. Perform full system scan and check for additional compromise indicators
', '["https://attack.mitre.org/techniques/T1543/003/","https://support.kaspersky.com/ScanEngine/2.1/en-US/186767.htm"]', '(safe("log.msg", "").contains("Service") && safe("log.msg", "").contains("install") || safe("log.msg", "").contains("sc.exe") && safe("log.msg", "").contains("create") || safe("log.msg", "").contains("New") && safe("log.msg", "").contains("Service") || safe("log.fname", "").contains("\\services.exe") || safe("log.cs2", "").contains("Service")) && (safe("log.cs1", "") == "infected" || safe("log.cs1", "") == "suspicious" || safe("log.cefDeviceSeverity", 0) >= 3)', '2025-09-03 12:13:03.061324', true, false, 'origin', NULL, '[]');
INSERT INTO public.utm_correlation_rules VALUES (69, 'Kaspersky System File Tampering Detection', 2, 3, 1, 'Defense Evasion', 'T1562.001 - Impair Defenses: Disable or Modify Tools', 'Detects attempts to tamper with critical system files, Windows services, or protected system components. This includes unauthorized modifications to system binaries, service configurations, or attempts to manipulate security-critical files.

Next Steps:
1. Identify the affected system file or component from the log details
2. Check if the modification was authorized (planned maintenance, legitimate software update)
3. Review process information to identify the source of the tampering attempt
4. Look for additional indicators of compromise on the affected system
5. Investigate any parent processes or scripts that initiated the modification
6. Check for persistence mechanisms that may have been established
7. Consider isolating the system if unauthorized tampering is confirmed
', '["https://support.kaspersky.com/kwts/6.1/267200","https://attack.mitre.org/techniques/T1562/001/","https://attack.mitre.org/techniques/T1036/"]', 'safe("log.signatureID", "") != "" && ( safe("log.msg", "").contains("system file") || safe("log.msg", "").contains("critical file") || safe("log.msg", "").contains("protected file") || safe("log.msg", "").contains("service tamper") || safe("log.cs1", "").contains("SYSTEM_MOD") || safe("log.cs4", "").contains("SystemFile") || safe("log.msg", "").contains("system modification") || safe("log.msg", "").contains("unauthorized change") || (safe("log.cat", "") == "Behavior Detection" && safe("log.msg", "").contains("modify")) )', '2025-09-03 12:13:04.194639', true, false, 'origin', NULL, '[]');
INSERT INTO public.utm_correlation_rules VALUES (70, 'Kaspersky Trusted Application Compromise Detection', 3, 3, 2, 'Defense Evasion', 'T1218 - Signed Binary Proxy Execution', 'Identifies when legitimate or trusted applications exhibit malicious behavior, potentially indicating compromise or exploitation. This includes detecting when signed binaries are used for malicious purposes or when trusted processes perform suspicious activities. This is a critical security event that indicates an attacker may be using living-off-the-land techniques to evade detection.

Next Steps:
1. Immediately isolate the affected system to prevent lateral movement
2. Identify the compromised trusted application and its process chain
3. Review recent system changes and user activities on the affected host
4. Check for persistence mechanisms (scheduled tasks, services, registry keys)
5. Analyze network connections from the compromised application
6. Look for data exfiltration indicators from the affected system
7. Consider reimaging the system if compromise is confirmed
8. Update security policies to monitor the exploited application more closely
', '["https://www.kaspersky.com/enterprise-security/wiki-section/products/kaspersky-anti-targeted-attack-platform","https://attack.mitre.org/techniques/T1218/","https://attack.mitre.org/techniques/T1574/"]', 'safe("log.signatureID", "") != "" && ( (safe("log.msg", "").contains("trusted application") || (safe("log.msg", "").contains("signed binary") || (safe("log.msg", "").contains("legitimate program") || (safe("log.cs1", "").contains("TRUSTED_COMP") || (safe("log.cs4", "").contains("TrustedApp") || (safe("log.msg", "").contains("whitelisted") || (safe("log.cat", "") == "Exploit Prevention" && (safe("log.msg", "").contains("exploit")) || ((safe("log.msg", "").contains("behavior") && (safe("log.msg", "").contains("trusted")) ) && (safe("severity", "") == "high" || safe("severity", "") == "medium")', '2025-09-03 12:13:04.581737', true, false, 'origin', NULL, '[]');
INSERT INTO public.utm_correlation_rules VALUES (102, 'AWS CloudWatch Alarm Deletion', 3, 2, 2, 'Impair Defenses', 'Defense Evasion', 'Identifies the deletion of an AWS CloudWatch alarm. An adversary may delete alarms in an attempt to evade defenses', '["https://attack.mitre.org/tactics/TA0005/","https://attack.mitre.org/techniques/T1562/","https://awscli.amazonaws.com/v2/documentation/api/latest/reference/cloudwatch/delete-alarms.html","https://docs.aws.amazon.com/AmazonCloudWatch/latest/APIReference/API_DeleteAlarms.html"]', 'safe("log.eventSource", "") == ''monitoring.amazonaws.com'' && safe("log.eventName", "") == ''DeleteAlarms''', '2025-09-03 12:22:06.746954', true, false, 'origin', NULL, '[]');
INSERT INTO public.utm_correlation_rules VALUES (67, 'Kaspersky Suspicious Scheduled Tasks Detection', 3, 3, 2, 'Execution, Persistence, Privilege Escalation', 'T1053 - Scheduled Task/Job', 'Detects suspicious scheduled task creation or modification identified by Kaspersky, which could indicate persistence mechanisms used by malware or attackers. Scheduled tasks are commonly abused by attackers to maintain persistence, execute malicious code at specific times, or escalate privileges.

Next Steps:
1. Review the scheduled task details in log.msg, log.fname, and log.descMsg fields
2. Check the specific threat signature in log.signatureID to understand the detection
3. Examine log.cs1 and log.cs2 fields for additional threat context and classification
4. Verify if the task creation was part of legitimate administrative activity
5. Check the affected host (origin.host) for other persistence mechanisms:
   - Registry run keys
   - Startup folder items
   - Services
   - WMI event subscriptions
6. Review log.deviceTime for timeline analysis and correlate with other security events
7. If confirmed malicious:
   - Disable or remove the scheduled task immediately
   - Scan the system for additional malware components
   - Check if the malware has spread to other systems
   - Preserve evidence and initiate incident response procedures
', '["https://attack.mitre.org/techniques/T1053/","https://support.kaspersky.com/ScanEngine/1.0/en-US/186767.htm"]', '(safe("log.msg", "").lower().contains("scheduled") && safe("log.msg", "").lower().contains("task")) || safe("log.msg", "").lower().contains("schtasks") || safe("log.msg", "").lower().contains("schedule") || safe("log.msg", "").lower().contains("scheduled") || safe("log.msg", "").lower().contains("task") || safe("log.cs2", "").lower().contains("persist") || safe("log.fname", "").contains("\\Tasks\\") || safe("log.cat", "").lower().contains("persistence") && (safe("log.signatureID", "") != "" || safe("log.cs1", "").lower() == "infected" || safe("log.cs1", "").lower() == "suspicious" || safe("log.cefDeviceSeverity", "") != "")', '2025-09-03 12:13:01.435947', true, false, 'origin', NULL, '[]');
INSERT INTO public.utm_correlation_rules VALUES (72, 'SentinelOne Agent Tampering Attempts', 3, 3, 3, 'Defense Evasion', 'T1562.001 - Impair Defenses: Disable or Modify Tools', 'Detects attempts to tamper with, disable, or modify the SentinelOne agent. This is a critical security event as attackers often try to disable security tools before launching their main attack. Immediate response required.

Next Steps:
1. Immediately isolate the affected endpoint to prevent further damage
2. Review the user account associated with the tampering attempt
3. Check system logs for any suspicious activities before and after the tampering attempt
4. Verify if the SentinelOne agent is still functioning properly
5. Look for any malware or unauthorized software that may have been installed
6. Review network connections from the affected host for command and control activity
7. If tampering was successful, consider reimaging the system after forensic analysis
', '["https://support.sentinelone.com/hc/en-us/articles/360001089343-Protecting-the-SentinelOne-Agent","https://attack.mitre.org/techniques/T1562/001/"]', 'safe("log.eventDescription", "").matches(".*(tamper|disable|stop|uninstall|modify).*agent.*") || safe("log.eventDescription", "").matches(".*agent.*(tamper|disable|stop|uninstall|modify).*") || safe("log.activityType", "").matches("agent_(uninstall|disable|tamper)") || safe("log.eventType", "") == "AgentTamperingAttempt" || (safe("log.processName", "").matches(".*(sentinelone|sentinel).*") && safe("action", "").matches("(kill|terminate|stop|disable)"))', '2025-09-03 12:16:59.067808', true, false, 'origin', NULL, '[]');
INSERT INTO public.utm_correlation_rules VALUES (73, 'SentinelOne AI-Based Threat Hunting Alerts', 3, 3, 2, 'Defense Evasion, Privilege Escalation', 'T1055 - Process Injection', 'Detects threats identified by SentinelOne''s AI and machine learning threat hunting capabilities, including zero-day exploits, fileless attacks, and previously unknown malware variants.

Next Steps:
1. Immediately isolate the affected system to prevent lateral movement
2. Review the threat details in SentinelOne console for threat classification and confidence score
3. Check if the AI detection correlates with any unusual process behavior or network activity
4. Examine memory dumps if available for fileless attack indicators
5. Search for similar AI detections across other endpoints in the environment
6. If confirmed as a zero-day or new variant, submit samples to threat intelligence teams
7. Update security policies based on the AI detection patterns observed
', '["https://www.sentinelone.com/platform/ai-powered-prevention/","https://attack.mitre.org/tactics/TA0043/","https://attack.mitre.org/techniques/T1055/"]', 'safe("log.eventDescription", "").matches("(?i)(ai detected|machine learning|ml detection|threat hunt|hunting alert|ai threat|automated detection)") && ( safe("log.eventDescription", "").matches("(?i)(zero.?day|unknown malware|new variant|fileless|in.?memory)") || safe("log.eventDescToParse", "").matches("(?i)(threat hunting|ai engine|ml model|predictive|proactive detection)") ) && safe("log.endpointDeviceName", "") != ""', '2025-09-03 12:17:00.027418', true, false, 'origin', NULL, '[]');
INSERT INTO public.utm_correlation_rules VALUES (74, 'SentinelOne Behavioral Threat Detection', 3, 3, 2, 'Defense Evasion, Privilege Escalation', 'T1055 - Process Injection', 'Detects behavioral threat patterns identified by SentinelOne''s AI engine, including suspicious process behaviors, anomalous system calls, and deviations from normal endpoint activity patterns.

Next Steps:
1. Review the specific behavioral indicator that triggered the alert in log.eventDescription
2. Identify the affected host and user account from log.syslogHost and log.destinationUser
3. Check if the behavior is associated with legitimate software or administrative activity
4. Investigate other recent activities from the same host for signs of compromise
5. If confirmed malicious, isolate the endpoint and initiate incident response procedures
6. Review SentinelOne console for additional threat details and recommended remediation actions
7. Collect memory dumps if process injection or in-memory threats are suspected
8. Check for persistence mechanisms that may have been established
', '["https://www.sentinelone.com/platform/behavioral-ai/","https://attack.mitre.org/techniques/T1055/"]', '(safe("log.eventDescription", "").matches("(?i)(behavioral|anomaly|suspicious behavior|abnormal|pattern detected|threat behavior|malicious activity)") || safe("log.eventDescription", "").matches("(?i)(process injection|code injection|memory manipulation|hollowing)")) && safe("log.syslogHost", "") != "" && safe("log.eventDescription", "") != ""', '2025-09-03 12:17:00.715426', true, false, 'origin', NULL, '[]');
INSERT INTO public.utm_correlation_rules VALUES (75, 'SentinelOne Advanced Behavioral Threat Patterns', 3, 3, 2, 'Defense Evasion, Privilege Escalation', 'T1055 - Process Injection', 'Detects advanced behavioral threat patterns including process injection, privilege escalation attempts, lateral movement patterns, and sophisticated malware behaviors identified by SentinelOne''s behavioral AI engine.

Next Steps:
1. Immediately isolate the affected endpoint using SentinelOne console
2. Review the specific behavioral pattern detected and associated processes
3. Check for any parent-child process relationships that may indicate injection or escalation
4. Investigate any network connections from the suspicious processes
5. Collect forensic data from the endpoint if available
6. Review user activity logs for the associated account
7. Check if similar behavioral patterns have been detected on other endpoints
8. Consider threat hunting for related IOCs across the environment
', '["https://www.sentinelone.com/platform/behavioral-ai/","https://attack.mitre.org/tactics/TA0002/","https://attack.mitre.org/techniques/T1055/"]', 'safe("log.eventDescription", "").matches("(?i)(behavioral|behavior detected|anomalous behavior|suspicious activity|threat behavior|malicious behavior)") && (safe("log.eventDescription", "").matches("(?i)(injection|escalation|lateral|persistence|evasion|defense bypass)") || safe("log.msg", "").matches("(?i)(process injection|privilege escalation|lateral movement|persistence mechanism)")) && safe("log.endpointDeviceName", "") != ""', '2025-09-03 12:17:01.486963', true, false, 'origin', NULL, '[]');
INSERT INTO public.utm_correlation_rules VALUES (79, 'Deep Visibility Threat Indicators', 3, 3, 2, 'Deep Visibility', 'T1055.001 - Process Injection: Dynamic-link Library Injection', 'Detects threat indicators from SentinelOne''s deep visibility feature, including suspicious process activities, endpoint anomalies, and potential compromise indicators based on event descriptions and endpoint device information.

Next Steps:
1. Review the specific threat indicator details in the event description to understand the nature of the threat
2. Investigate the affected endpoint device and associated user accounts for signs of compromise
3. Check if similar indicators have been detected on other hosts in the environment using the same source IPs or MAC addresses
4. Verify if the detected activity is part of authorized software or administrative actions
5. If confirmed malicious, initiate incident response procedures including containment and remediation
6. Update security policies and endpoint protection configurations based on findings
', '["https://www.sentinelone.com/platform/deep-visibility/","https://attack.mitre.org/tactics/TA0009/"]', 'safe("log.eventDescription", "").matches("(?i)(deep visibility|visibility alert|threat indicator|ioc match|suspicious|malicious|anomaly|threat detected)") && (safe("log.endpointDeviceName", "") != "" || safe("log.sourceUser", "") != "" || safe("log.destinationUser", "") != "" || safe("log.sourceIps", "") != "" || safe("log.sourceMacs", "") != "")', '2025-09-03 12:17:05.248107', true, false, 'origin', NULL, '[]');
INSERT INTO public.utm_correlation_rules VALUES (77, 'SentinelOne Container Security Alert', 3, 3, 2, 'Defense Evasion, Execution', 'T1610 - Deploy Container', 'Detects container-related security events including container drift, unauthorized container deployment, cryptominers in containers, or suspicious container behavior.

Next Steps:
1. Identify the affected container and host system from the alert details
2. Review the container runtime logs for additional context
3. Check if the container is running authorized images from trusted registries
4. Investigate any network connections or processes spawned by the container
5. If unauthorized activity is confirmed, isolate the container and host
6. Review container deployment policies and runtime security configurations
7. Check for similar alerts across other container environments
', '["https://www.sentinelone.com/platform/singularity-cloud-workload-security/","https://www.sentinelone.com/resources/cloud-workload-security-for-containers/","https://attack.mitre.org/techniques/T1610/"]', 'safe("log.eventDescription", "") != "" && ( safe("log.eventDescription", "").lower().contains("container") || safe("log.eventDescription", "").lower().contains("kubernetes") || safe("log.eventDescription", "").lower().contains("k8s") || safe("log.eventDescription", "").lower().contains("docker") || safe("log.eventDescription", "").lower().contains("pod") || safe("log.eventDescription", "").lower().contains("cluster") ) && ( safe("log.eventDescription", "").lower().contains("drift") || safe("log.eventDescription", "").lower().contains("unauthorized") || safe("log.eventDescription", "").lower().contains("cryptominer") || safe("log.eventDescription", "").lower().contains("malicious") || safe("log.eventDescription", "").lower().contains("anomaly") || safe("log.eventDescription", "").lower().contains("suspicious") || safe("log.eventDescription", "").lower().contains("breach") || safe("log.eventDescription", "").lower().contains("violation") )', '2025-09-03 12:17:03.196555', true, false, 'origin', NULL, '[]');
INSERT INTO public.utm_correlation_rules VALUES (78, 'Custom Detection Rule Triggers', 3, 3, 2, 'Execution', 'T1059 - Command and Scripting Interpreter', 'Detects when custom detection rules configured in SentinelOne trigger, indicating organization-specific threat patterns or policy violations have been identified. Custom rules are tailored to detect specific behaviors or patterns unique to the organization''s security requirements.

Next Steps:
1. Review the specific custom rule that triggered and understand its purpose
2. Investigate the affected endpoint (log.syslogHost) for additional suspicious activity
3. Check if the same custom rule has triggered on other endpoints
4. Verify if the detection is a false positive based on the custom rule''s logic
5. If legitimate threat activity, initiate incident response procedures
6. Consider updating the custom rule if false positives are frequent
', '["https://docs.sentinelone.com/","https://attack.mitre.org/techniques/T1059/"]', 'safe("log.eventDescription", "").contains("custom rule") || safe("log.eventDescription", "").contains("custom detection") || safe("log.eventDescription", "").contains("Custom Rules")', '2025-09-03 12:17:04.017213', true, false, 'origin', '["log.syslogHost","log.eventDescription"]', '[]');
INSERT INTO public.utm_correlation_rules VALUES (92, 'SentinelOne Storyline Correlation Events', 3, 3, 2, 'Defense Evasion, Privilege Escalation', 'T1055 - Process Injection', 'Detects correlated threat events using SentinelOne''s Storyline technology which tracks and links related malicious activities across processes, files, and network connections to identify complex attack chains. This rule triggers when storyline correlation events are detected, when multiple alerts are associated with a single process, or when correlation-type events are logged.

Next Steps:
1. Review the Storyline timeline in SentinelOne console for the affected endpoint
2. Investigate all processes and network connections linked in the attack chain
3. Check if similar patterns exist on other endpoints in your environment
4. Isolate the affected endpoint if active malicious behavior is confirmed
5. Collect forensic data from the endpoint for deeper analysis
6. Review and update endpoint protection policies based on findings
7. Consider threat hunting for similar TTPs across the environment
', '["https://www.sentinelone.com/blog/rapid-threat-hunting-with-deep-visibility-feature-spotlight/","https://attack.mitre.org/techniques/T1055/","https://docs.sentinelone.com/storyline/"]', 'safe("log.eventDescription", "").contains("storyline") || safe("log.dveventtype", "").contains("correlation") || (safe("log.alertscounter", 0) > 3 && safe("log.alertprocessname", "") != "")', '2025-09-03 12:20:21.665218', true, false, 'origin', NULL, '[]');
INSERT INTO public.utm_correlation_rules VALUES (93, 'Suspicious Process Tree Analysis', 3, 3, 1, 'Defense Evasion, Privilege Escalation', 'T1055 - Process Injection', 'Detects suspicious process tree patterns identified by SentinelOne, including unusual parent-child relationships, process hollowing, and malicious process chains commonly used in attacks.

Next Steps:
1. Review the process tree details in the SentinelOne console to understand the parent-child relationships
2. Identify the affected host from log.syslogHost and the user account from log.destinationUser
3. Check if the process chain is associated with legitimate software or administrative activity
4. Look for indicators of process injection, hollowing, or other malicious techniques
5. Investigate other recent process creation events on the same host
6. If confirmed malicious, isolate the endpoint and terminate the suspicious processes
7. Review the threat storyline in SentinelOne for full attack context
8. Collect memory dumps if advanced analysis is required
', '["https://attack.mitre.org/techniques/T1055/","https://attack.mitre.org/techniques/T1057/"]', '(safe("log.eventDescription", "").contains("process tree") || safe("log.eventDescription", "").contains("parent") || safe("log.eventDescription", "").contains("process chain") || safe("log.eventDescription", "").contains("process spawn") || safe("log.eventDescription", "").contains("suspicious process") || safe("log.eventDescription", "").contains("abnormal process") || safe("log.eventDescription", "").contains("process anomaly") || safe("log.threatName", "").contains("process") || safe("log.threatName", "").contains("injection") || safe("log.threatName", "").contains("hollow") || safe("log.mitigationMode", "").contains("process")) && safe("log.syslogHost", "") != ""', '2025-09-03 12:20:22.454272', true, false, 'origin', NULL, '[]');
INSERT INTO public.utm_correlation_rules VALUES (103, 'AWS Config Service Tampering', 3, 2, 2, 'Impair Defenses', 'Defense Evasion', 'Identifies attempts to delete an AWS Config Service resource. An adversary may tamper with Config services in order to reduce visibility into the security posture of an account and / or its workload instances', '["https://attack.mitre.org/tactics/TA0005/","https://attack.mitre.org/techniques/T1562/","https://docs.aws.amazon.com/config/latest/developerguide/how-does-config-work.html","https://docs.aws.amazon.com/config/latest/APIReference/API_Operations.html"]', 'safe("log.eventSource", "") == ''config.amazonaws.com'' && (safe("log.eventName", "") == ''DeleteConfigRule'' || safe("log.eventName", "") == ''DeleteOrganizationConfigRule'' || safe("log.eventName", "") == ''DeleteConfigurationAggregator'' || safe("log.eventName", "") == ''DeleteConfigurationRecorder'' || safe("log.eventName", "") == ''DeleteConformancePack'' || safe("log.eventName", "") == ''DeleteOrganizationConformancePack'' || safe("log.eventName", "") == ''DeleteDeliveryChannel'' || safe("log.eventName", "") == ''DeleteRemediationConfiguration'' || safe("log.eventName", "") == ''DeleteRetentionConfiguration'')', '2025-09-03 12:22:07.251455', true, false, 'origin', NULL, '[]');
INSERT INTO public.utm_correlation_rules VALUES (80, 'Deep Visibility Threat Indicators', 3, 3, 2, 'Defense Evasion', 'T1070 - Indicator Removal on Host', 'Detects advanced threat indicators through SentinelOne''s deep visibility monitoring. This rule triggers when specific threat-related events are detected in the SentinelOne logs.

Next Steps:
1. Review the event description to understand the specific threat indicator
2. Check the affected host (syslogHost) for signs of compromise
3. Investigate any associated user accounts (sourceUser, destinationUser)
4. Review source IP addresses for suspicious origins
5. Check if this is part of a larger attack campaign
6. Consider isolating the affected endpoint if threat is confirmed
', '["https://www.sentinelone.com/blog/rapid-threat-hunting-with-deep-visibility-feature-spotlight/","https://attack.mitre.org/techniques/T1070/"]', 'safe("log.eventDescription", "") != "" && (safe("log.eventDescription", "").contains("threat") || safe("log.eventDescription", "").contains("malware") || safe("log.eventDescription", "").contains("suspicious") || safe("log.eventDescription", "").contains("malicious"))', '2025-09-03 12:17:06.272857', true, false, 'origin', NULL, '[]');
INSERT INTO public.utm_correlation_rules VALUES (81, 'SentinelOne EDR Alert', 3, 3, 2, 'Persistence, Privilege Escalation', 'T1543 - Create or Modify System Process', 'Detects endpoint detection and response alerts from SentinelOne, including process injection, credential dumping, lateral movement attempts, and persistence mechanisms.

Next Steps:
1. Review the alert details to understand the specific threat detected
2. Check the affected endpoint''s current status and isolation state
3. Investigate the process or file that triggered the alert
4. Review recent user activity on the affected endpoint
5. Check for similar alerts on other endpoints in the same network segment
6. If confirmed malicious, initiate incident response procedures
7. Consider updating endpoint policies based on the detected threat
', '["https://www.sentinelone.com/platform/endpoint-detection-response/","https://attack.mitre.org/techniques/T1543/"]', '(safe("log.eventDescription", "").contains("edr") || safe("log.eventDescription", "").contains("endpoint detection") || safe("log.eventDescription", "").contains("endpoint response") || safe("log.eventDescription", "").contains("endpoint alert") || safe("log.eventDescription", "").contains("threat detected") || safe("log.eventDescription", "").contains("malicious") || safe("log.eventDescription", "").contains("suspicious")) && safe("log.endpointDeviceName", "") != ""', '2025-09-03 12:17:06.813362', true, false, 'origin', NULL, '[]');
INSERT INTO public.utm_correlation_rules VALUES (82, 'SentinelOne Endpoint Detection and Response (EDR) Alerts', 3, 3, 2, 'Execution', 'T1059 - Command and Scripting Interpreter', 'Critical EDR alerts from SentinelOne including suspicious endpoint activities, unauthorized system changes, malicious command execution, and advanced persistent threat (APT) indicators. These alerts indicate potential security incidents that require immediate investigation.

Next Steps:
1. Identify the affected endpoint(s) and user accounts involved
2. Review the specific threat details and indicators of compromise (IoCs)
3. Check for any lateral movement or persistence mechanisms
4. Isolate the affected endpoint(s) if necessary
5. Collect forensic data and memory dumps if required
6. Review related security events from the same host in the last 24-48 hours
7. Verify if the detected activity is legitimate or false positive
8. If confirmed malicious, initiate incident response procedures
9. Update security controls and detection rules based on findings
10. Document the incident and lessons learned
', '["https://www.sentinelone.com/platform/edr/","https://attack.mitre.org/techniques/T1059/","https://attack.mitre.org/techniques/T1547/"]', '( safe("log.eventDescription", "").matches("(?i)(edr|endpoint detection|endpoint alert|endpoint threat|endpoint incident|suspicious endpoint|compromised endpoint|endpoint breach|endpoint attack)") || safe("log.message", "").matches("(?i)(edr alert|endpoint response|incident response|threat response)") ) && ( safe("log.eventDescription", "").matches("(?i)(critical|high|severe|malicious|unauthorized|breach)") || safe("log.destinationUser", "") != "" || safe("log.endpointDeviceName", "") != "" ) && safe("log.syslogHost", "") != ""', '2025-09-03 12:19:12.319454', true, false, 'origin', NULL, '[]');
INSERT INTO public.utm_correlation_rules VALUES (83, 'SentinelOne IoT Device Compromise Indicator', 3, 3, 2, 'Execution', 'T1203 - Exploitation for Client Execution', 'Detects indicators of IoT device compromise including unauthorized firmware modifications, suspicious network behavior from IoT devices, or anomalous IoT device activity patterns detected by SentinelOne''s Singularity Ranger. This rule triggers when IoT-related threats are identified including compromised embedded systems, firmware backdoors, industrial control system attacks, or SCADA system compromises.

Next Steps:
1. Isolate the affected IoT device immediately to prevent lateral movement
2. Review device logs and network traffic to identify the initial compromise vector
3. Check for firmware modifications or unauthorized configuration changes
4. Verify if other IoT devices on the same network segment show similar indicators
5. Update device firmware to latest secure version if available
6. Consider factory reset and reconfiguration if compromise is confirmed
7. Review network segmentation to ensure IoT devices are properly isolated
8. Implement additional monitoring for IoT device communications
', '["https://www.sentinelone.com/platform/singularity-ranger/","https://attack.mitre.org/techniques/T1203/"]', 'safe("log.eventDescription", "") != "" && ( safe("log.eventDescription", "").lower().contains("iot") || safe("log.eventDescription", "").lower().contains("embedded") || safe("log.eventDescription", "").lower().contains("firmware") || safe("log.eventDescription", "").lower().contains("smart device") || safe("log.eventDescription", "").lower().contains("industrial") || safe("log.eventDescription", "").lower().contains("scada") || safe("log.eventDescription", "").lower().contains("ics") || safe("log.eventDescription", "").lower().contains("operational technology") || safe("log.eventDescription", "").lower().contains("hmi") || safe("log.eventDescription", "").lower().contains("plc") ) && ( safe("log.eventDescription", "").lower().contains("compromise") || safe("log.eventDescription", "").lower().contains("unauthorized") || safe("log.eventDescription", "").lower().contains("malicious") || safe("log.eventDescription", "").lower().contains("anomaly") || safe("log.eventDescription", "").lower().contains("suspicious") || safe("log.eventDescription", "").lower().contains("backdoor") || safe("log.eventDescription", "").lower().contains("botnet") || safe("log.eventDescription", "").lower().contains("exploit") || safe("log.eventDescription", "").lower().contains("infection") || safe("log.eventDescription", "").lower().contains("threat") )', '2025-09-03 12:19:13.335447', true, false, 'origin', NULL, '[]');
INSERT INTO public.utm_correlation_rules VALUES (1453, 'Windows: Volume Shadow Copy Deleted or Resized via VssAdmin', 1, 2, 3, 'Impact', 'Inhibit System Recovery', 'Identifies use of vssadmin.exe for shadow copy deletion or resizing on endpoints. This commonly occurs in tandem with ransomware or other destructive attacks.', '["https://attack.mitre.org/tactics/TA0040/","https://attack.mitre.org/techniques/T1490/"]', 'safe("log.message", "").matches("((delete|resize)(.+)shadows|shadows(.+)(delete|resize))") && safe("log.eventDataProcessName", "").contains("vssadmin.exe")', '2025-09-04 21:02:16.147511', true, false, 'origin', NULL, '[]');
INSERT INTO public.utm_correlation_rules VALUES (86, 'SentinelOne Mass Deployment Anomalies', 2, 2, 1, 'Resource Development', 'T1608.002 - Deploy: Upload Tool', 'Detects anomalous mass deployment activities in SentinelOne, including rapid agent installations, bulk policy changes, or mass updates that could indicate unauthorized deployment, supply chain attack, or insider threat activity.

Next Steps:
1. Verify if the mass deployment was authorized and scheduled
2. Check the source user account for signs of compromise or unauthorized access
3. Review the specific deployment details (number of agents, target systems, deployment method)
4. Compare deployment patterns with historical baseline for this account
5. Investigate any unusual deployment configurations or policy changes
6. Check for any failed deployments or errors during the mass operation
7. Verify the integrity of the deployed agents or updates
8. Contact the account owner to confirm the legitimacy of the activity
9. Review SentinelOne console logs for additional deployment context
10. Check for concurrent suspicious activities across affected endpoints
', '["https://support.sentinelone.com/hc/en-us/articles/360052967133-Deploy-Windows-Agents","https://attack.mitre.org/techniques/T1608/002/"]', 'safe("log.eventDescription", "").matches(".*(?i)(mass|bulk|batch).*(deploy|install|update).*") || safe("log.eventDescription", "").matches(".*(?i)(deploy|install).*(multiple|many|bulk).*") || safe("log.eventDescription", "").matches(".*(?i)(agent|endpoint).*(bulk|mass).*") || safe("log.sourceGpName", "").matches(".*(?i)(deploy|install|bulk|mass).*")', '2025-09-03 12:19:16.016505', true, false, 'origin', '["log.accName","log.sourceGpName"]', '[]');
INSERT INTO public.utm_correlation_rules VALUES (87, 'Memory Injection Detection', 3, 3, 3, 'Defense Evasion, Privilege Escalation', 'T1055 - Process Injection', 'Detects memory injection attempts including DLL injection, process hollowing, reflective DLL injection, and other in-memory attack techniques detected by SentinelOne.

Next Steps:
1. Immediately isolate the affected system to prevent lateral movement
2. Identify the injected process and the target process from the alert details
3. Check for persistence mechanisms on the affected system
4. Review SentinelOne console for additional threat indicators and related events
5. Collect memory dump if possible for forensic analysis
6. Check if the injection technique matches known threat actor TTPs
7. Review network connections from the affected system for C2 communication
8. Ensure SentinelOne remediation actions have been applied successfully
', '["https://attack.mitre.org/techniques/T1055/","https://attack.mitre.org/techniques/T1055/001/"]', 'safe("log.eventDescription", "").matches("(?i)(memory.injection|dll.injection|process.injection|reflective.dll|process.hollow|code.injection|thread.hijack|injection.detected|malicious.injection)") || safe("log.eventDescToParse", "").matches("(?i)(memory.injection|dll.injection|process.injection|reflective.dll|process.hollow|code.injection|thread.hijack|injection.detected|malicious.injection)")', '2025-09-03 12:19:16.555669', true, false, 'origin', NULL, '[]');
INSERT INTO public.utm_correlation_rules VALUES (88, 'SentinelOne Offline Agent Detection Patterns', 1, 1, 3, 'Impact', 'T1529 - System Shutdown/Reboot', 'Detects patterns of SentinelOne agents going offline, which could indicate network issues, deliberate disconnection to evade monitoring, or system compromise. Multiple agents offline simultaneously may indicate coordinated attack or infrastructure issues.

Next Steps:
1. Verify the affected endpoint(s) network connectivity and power status
2. Check if the offline event corresponds to scheduled maintenance or known system reboots
3. Review recent endpoint activity logs for suspicious processes or commands before disconnection
4. Investigate if multiple agents went offline simultaneously (potential infrastructure issue)
5. Check for any tampering attempts on the SentinelOne agent service
6. Verify agent version and ensure it''s not outdated or corrupted
7. Contact the endpoint user to confirm if the system is physically accessible
8. If suspicious, isolate the endpoint and perform forensic analysis
', '["https://support.sentinelone.com/hc/en-us/articles/360057987594-Agent-Connectivity-and-Network-Requirements","https://attack.mitre.org/techniques/T1529/"]', 'safe("log.eventDescription", "").matches(".*(agent|endpoint).*(offline|disconnect|unreachable).*") || safe("log.sourceGpName", "").matches(".*(offline|disconnected).*") || (safe("log.endpointDeviceName", "") != "" && safe("log.eventDescription", "").matches(".*(connection lost|not responding|unavailable).*"))', '2025-09-03 12:19:17.334248', true, false, 'origin', '["log.endpointDeviceName"]', '[]');
INSERT INTO public.utm_correlation_rules VALUES (104, 'AWS Configuration Recorder Stopped', 3, 2, 2, 'Impair Defenses', 'Defense Evasion', 'Identifies an AWS configuration change to stop recording a designated set of resources', '["https://awscli.amazonaws.com/v2/documentation/api/latest/reference/configservice/stop-configuration-recorder.html","https://docs.aws.amazon.com/config/latest/APIReference/API_StopConfigurationRecorder.html","https://attack.mitre.org/tactics/TA0005/","https://attack.mitre.org/techniques/T1562/"]', 'safe("log.eventSource", "") == ''config.amazonaws.com'' && safe("log.eventName", "") == ''StopConfigurationRecorder''', '2025-09-03 12:22:07.58643', true, false, 'origin', NULL, '[]');
INSERT INTO public.utm_correlation_rules VALUES (108, 'AWS S3 Bucket Configuration Deletion', 3, 2, 2, 'Indicator Removal on Host', 'Defense Evasion', 'Identifies the deletion of various Amazon Simple Storage Service (S3) bucket configuration components', '["https://attack.mitre.org/techniques/T1070/","https://attack.mitre.org/tactics/TA0005/","https://docs.aws.amazon.com/AmazonS3/latest/API/API_DeleteBucketPolicy.html","https://docs.aws.amazon.com/AmazonS3/latest/API/API_DeleteBucketReplication.html","https://docs.aws.amazon.com/AmazonS3/latest/API/API_DeleteBucketCors.html","https://docs.aws.amazon.com/AmazonS3/latest/API/API_DeleteBucketEncryption.html","https://docs.aws.amazon.com/AmazonS3/latest/API/API_DeleteBucketLifecycle.html"]', 'safe("log.eventSource", "") == ''s3.amazonaws.com'' && (safe("log.eventName", "") == ''DeleteBucketPolicy'' || safe("log.eventName", "") == ''DeleteBucketReplication'' || safe("log.eventName", "") == ''DeleteBucketCors'' || safe("log.eventName", "") == ''DeleteBucketEncryption'' || safe("log.eventName", "") == ''DeleteBucketLifecycle'')', '2025-09-03 12:27:11.012958', true, false, 'origin', NULL, '[]');
INSERT INTO public.utm_correlation_rules VALUES (89, 'SentinelOne Policy Violation Detected', 2, 3, 1, 'Defense Evasion, Persistence, Privilege Escalation, Initial Access', 'T1078 - Valid Accounts', 'Detects policy violations in SentinelOne including unauthorized access attempts, prohibited application usage, or configuration changes that violate security policies.

Next Steps:
1. Review the specific policy violation details in the log.eventDescription field
2. Identify the user account involved (log.destinationUser) and verify if this was authorized activity
3. Check the affected endpoint (log.endpointDeviceName) for any additional suspicious activity
4. Review the user''s recent activity history for patterns of policy violations
5. If unauthorized, disable the user account and initiate incident response procedures
6. Update security policies if this was a legitimate action that needs to be allowed
7. Consider implementing additional controls or training if this is a recurring issue
', '["https://www.sentinelone.com/platform/singularity-cloud-workload-security/","https://attack.mitre.org/techniques/T1078/"]', 'safe("log.eventDescription", "") != "" && ( safe("log.eventDescription", "")).lower().contains("policy violation") || safe("log.eventDescription", "")).lower().contains("policy breach") || safe("log.eventDescription", "")).lower().contains("unauthorized access") || safe("log.eventDescription", "")).lower().contains("prohibited") || safe("log.eventDescription", "")).lower().contains("compliance violation") || safe("log.eventDescription", "")).lower().contains("configuration change") ) && safe("log.destinationUser", "") != ""', '2025-09-03 12:19:18.073908', true, false, 'origin', NULL, '[]');
INSERT INTO public.utm_correlation_rules VALUES (90, 'SentinelOne Rollback Operation Patterns Detection', 2, 3, 3, 'Impact', 'T1490 - Inhibit System Recovery', 'Detects rollback operations in SentinelOne that may indicate ransomware recovery attempts or suspicious rollback activity. Rollback operations are critical system recovery events that should be monitored for both legitimate recovery and potential abuse scenarios.

Next Steps:
1. Verify if the rollback operation was authorized by checking with the system administrator
2. Check if there were any ransomware or malware detections on the affected system prior to the rollback
3. Review the system logs to understand what changes were rolled back
4. Confirm the identity of the user who initiated the rollback operation
5. If unauthorized, investigate potential system compromise and consider isolating the affected endpoint
6. Document the rollback operation and its justification for compliance purposes
', '["https://www.cybervigilance.uk/insights/sentinelone-how-does-rollback-work","https://attack.mitre.org/techniques/T1490/"]', 'safe("log.eventDescription", "").matches(".*[Rr]ollback.*") && (safe("log.activityType", "") == "rollback" || safe("log.rollbackStatus", "") != "" || safe("log.cat", "") == "SystemEvent")', '2025-09-03 12:19:18.852796', true, false, 'origin', NULL, '[]');
INSERT INTO public.utm_correlation_rules VALUES (91, 'Storyline Correlation Event', 3, 3, 2, 'Attack Chain Detection', 'Attack Chain Analysis', 'Detects correlated attack patterns identified by SentinelOne''s Storyline feature, which connects related events to reveal complete attack chains and multi-stage threats.

Next Steps:
1. Review the complete attack chain in the SentinelOne console''s Storyline view
2. Identify all affected endpoints and users involved in the attack chain
3. Check for lateral movement or persistence mechanisms across the related events
4. Isolate affected endpoints if active threats are detected
5. Collect forensic data from all systems identified in the storyline
6. Review and update security policies based on the attack patterns observed
7. Analyze the attack timeline and identify any gaps in detection
8. Coordinate with incident response team for threat hunting activities
', '["https://www.sentinelone.com/platform/storyline-active-response/","https://attack.mitre.org/tactics/enterprise/"]', 'safe("log.eventDescription", "").matches("(?i)(storyline|attack chain|correlated|multi.?stage|campaign)") && safe("log.message", "").matches("(?i)(threat|attack|compromise|breach)")', '2025-09-03 12:19:19.496518', true, false, 'origin', NULL, '[]');
INSERT INTO public.utm_correlation_rules VALUES (1238, 'Storage vMotion Anomalies Detection', 2, 3, 3, 'Virtualization Security', 'Storage Migration Tampering', 'Detects anomalous Storage vMotion operations including unauthorized datastore migrations, suspicious disk movements, or storage migration failures that could indicate data exfiltration attempts, storage corruption, or malicious VM manipulation.

Storage vMotion allows migration of virtual machine disk files between datastores without downtime. Anomalous operations may indicate:
- Unauthorized attempts to move sensitive VM data
- Storage corruption or integrity violations
- Failed migrations that could impact availability
- Malicious attempts to relocate VMs for data access

Next Steps:
1. Verify the legitimacy of the storage migration operation
2. Check if the operation was authorized by VMware administrators
3. Review datastore permissions and access controls
4. Examine the source and destination datastores for any suspicious activity
5. Validate VM disk integrity and check for data corruption
6. Review recent user activities and authentication logs
7. Monitor for any subsequent VM performance issues or data loss
', '["https://docs.vmware.com/en/VMware-vSphere/7.0/com.vmware.vsphere.vcenterhost.doc/GUID-AB266895-BAA4-4BF3-894E-47F99DC7B77F.html","https://www.nakivo.com/blog/vmware-logs-analysis-for-troubleshooting/"]', '(safe("log.message", "").matches("(?i)storage.*vmotion") && safe("log.message", "").matches("(?i)(failed|error|abort|timeout)")) ||
(safe("log.message", "").matches("(?i)(vmdk|datastore)") && safe("log.message", "").matches("(?i)(move|migrate|copy)") && safe("log.message", "").matches("(?i)(unauthorized|denied|invalid)")) ||
(safe("log.message", "").matches("(?i)storage.*migration") && safe("log.message", "").matches("(?i)(corrupt|integrity|checksum|mismatch)")) ||
(safe("log.process", "").matches("(?i)(vmkfstools|esxcli)") && safe("log.message", "").matches("(?i)storage") && safe("log.message", "").matches("(?i)(error|failed|violation)")) ||
(safe("log.eventInfo", "").matches("(?i)(relocate|storage.*move)") && safe("severity", "").matches("(?i)(error|critical)"))
', '2025-09-04 19:00:09.620209', true, false, 'origin', '["origin.hostname"]', '[]');
INSERT INTO public.utm_correlation_rules VALUES (1239, 'VM Template Tampering Detection', 2, 3, 2, 'Resource Development', 'T1608 - Stage Capabilities: Upload Malware', 'Detects unauthorized modifications to VM templates that could lead to deployment of compromised virtual machines. 
Monitors for template conversion operations and template file modifications including ConvertToTemplate, 
MarkAsTemplate, MarkAsVirtualMachine, and template clone operations, as well as direct modifications to .vmtx files.

Next Steps:
1. Verify the legitimacy of the template modification with the administrator who performed the action
2. Check if the modification was part of scheduled maintenance or approved change management
3. Examine the template contents for unauthorized software, backdoors, or malicious configurations
4. Review who has access to modify templates and validate their permissions
5. Check for any VMs deployed from the modified template and scan them for compromise
6. Review vCenter logs for additional suspicious activities around the same timeframe
7. Consider temporarily disabling the template until security validation is complete
', '["https://docs.vmware.com/en/VMware-vSphere/8.0/vsphere-security/GUID-F35D7005-58EB-48AC-99D5-B9942EB2A8EF.html","https://attack.mitre.org/techniques/T1608/"]', 'safe("log.message", "").contains("ConvertToTemplate") ||
safe("log.message", "").contains("MarkAsTemplate") ||
safe("log.message", "").contains("MarkAsVirtualMachine") ||
(safe("log.message", "").contains("CloneVM_Task") && safe("log.message", "").contains("template")) ||
(safe("log.message", "").contains(".vmtx") &&
 (safe("log.message", "").contains("modify") ||
  safe("log.message", "").contains("change") ||
  safe("log.message", "").contains("delete") ||
  safe("log.message", "").contains("edit")))
', '2025-09-04 19:00:10.722811', true, false, 'origin', '["origin.hostname","origin.user"]', '[]');
INSERT INTO public.utm_correlation_rules VALUES (114, 'AWS RDS Snapshot Export', 3, 2, 2, 'Transfer Data to Cloud Account', 'Exfiltration', 'Identifies the export of an Amazon Relational Database Service (RDS) Aurora database snapshot', '["https://attack.mitre.org/tactics/TA0010/","https://docs.aws.amazon.com/AmazonRDS/latest/APIReference/API_StartExportTask.html"]', 'safe("log.eventSource", "") == "rds.amazonaws.com" && safe("log.eventName", "") == "StartExportTask"', '2025-09-03 12:27:16.834425', true, false, 'target', NULL, '[]');
INSERT INTO public.utm_correlation_rules VALUES (937, 'System Linux: Attempt to Disable Syslog Service', 1, 2, 3, 'Defense Evasion', 'Disable or Modify Tools', 'Adversaries may attempt to disable the syslog service in an attempt to an attempt to disrupt event logging and evade detection by security controls.', '["https://attack.mitre.org/tactics/TA0005/","https://attack.mitre.org/techniques/T1562/001/"]', 'safe("log.message", "").matches("((service|chkconfig) (syslog|rsyslog|syslog-ng) (stop|disable|off|kill))|((systemctl) (stop|disable|off|kill) (syslog|rsyslog|syslog-ng))")', '2025-09-03 16:36:53.658026', true, false, 'origin', NULL, '[]');
INSERT INTO public.utm_correlation_rules VALUES (94, 'SentinelOne Suspicious Script Execution Detected', 3, 3, 2, 'Execution', 'T1059 - Command and Scripting Interpreter', 'Detects suspicious script execution activities including PowerShell, Python, Bash, or other scripting interpreters that may indicate malicious activity or fileless attacks. SentinelOne''s behavioral detection engine identifies these patterns as potential threats that could compromise system integrity.

Next Steps:
1. Review the specific script or command that triggered the alert in the SentinelOne console
2. Check if the script execution is authorized and part of normal operations
3. Investigate the process tree to understand the parent process and execution chain
4. Look for encoded or obfuscated commands within the script content
5. Check for persistence mechanisms or scheduled tasks created by the script
6. Review network connections initiated by the script process
7. If confirmed malicious, isolate the affected endpoint and perform threat hunting across the environment
', '["https://www.sentinelone.com/platform/singularity-cloud-workload-security/","https://attack.mitre.org/techniques/T1059/"]', 'safe("log.eventDescription", "") != "" && ( safe("log.eventDescription", "")).lower().contains("script execution") || safe("log.eventDescription", "")).lower().contains("powershell") || safe("log.eventDescription", "")).lower().contains("python") || safe("log.eventDescription", "")).lower().contains("bash") || safe("log.eventDescription", "")).lower().contains("cmd.exe") || safe("log.eventDescription", "")).lower().contains("fileless") || safe("log.eventDescription", "")).lower().contains("interpreter") || safe("log.eventDescription", "")).lower().contains("suspicious process") || safe("log.eventDescription", "")).lower().contains("malicious script") ) && (safe("log.endpointDeviceName", "") != "" || safe("log.sourceIps", "") != "")', '2025-09-03 12:20:22.893089', true, false, 'origin', NULL, '[]');
INSERT INTO public.utm_correlation_rules VALUES (95, 'SentinelOne Threat Mitigation Failures', 2, 3, 2, 'Defense Evasion', 'T1562.001 - Impair Defenses: Disable or Modify Tools', 'Detects failed threat mitigation attempts in SentinelOne, which could indicate advanced malware evading remediation, system compromise preventing cleanup, or configuration issues. Failed mitigations require immediate investigation.

Next Steps:
1. Immediately isolate the affected endpoint to prevent potential spread
2. Review the specific threat details and mitigation failure reason in SentinelOne console
3. Check if the agent has the latest version and policies are up to date
4. Verify system integrity - check for rootkits or system-level compromise
5. Consider manual remediation using SentinelOne''s threat hunting capabilities
6. If persistent failures occur, engage incident response team for deep forensic analysis
7. Document the threat indicators for future detection improvements
', '["https://support.sentinelone.com/hc/en-us/articles/360004195934-Threat-Mitigation-Status","https://attack.mitre.org/techniques/T1562/"]', '(safe("log.eventDescription", "").contains("mitigation") && safe("log.eventDescription", "").contains("fail")) || (safe("log.eventDescription", "").contains("remediation") && safe("log.eventDescription", "").contains("fail")) || safe("log.mitigationStatus", "").contains("fail") || safe("log.threatStatus", "") == "mitigation_failed" || (safe("log.activityType", "") == "mitigation" && safe("log.status", "") == "failed")', '2025-09-03 12:20:23.694136', true, false, 'origin', NULL, '[]');
INSERT INTO public.utm_correlation_rules VALUES (96, 'Threat Intelligence Matches', 2, 2, 1, 'Execution', 'T1203 - Exploitation for Client Execution', 'Detects matches against threat intelligence feeds including known malicious hashes, IPs, domains, and behavioral patterns associated with APT groups and cybercrime campaigns. This indicates that SentinelOne has identified a file, behavior, or network connection that matches known threat indicators.

Next Steps:
1. Immediately isolate the affected endpoint to prevent lateral movement
2. Review the threat intelligence match details to understand the specific indicator that was matched
3. Check if the same hash or threat indicator has been seen on other endpoints
4. Investigate the process tree and parent processes that led to this detection
5. Review network connections from the affected host for potential C2 communications
6. If a file hash match, search for the same hash across all endpoints
7. Contact threat intelligence team for additional context on the matched indicator
8. Preserve forensic evidence before remediation
9. Review file reputation scores and threat classification details
10. Analyze the timeline of events leading to the threat intelligence match
11. Check for any related indicators of compromise (IoCs) in the environment
12. Verify if this is a false positive by cross-referencing with other security tools
', '["https://www.sentinelone.com/blog/decrypting-sentinelone-cloud-detection-the-threat-intelligence-engine-in-real-time-cwpp/","https://attack.mitre.org/techniques/T1203/"]', 'safe("log.externalthreatvalue", "") != "" || (safe("log.filecontenthash", "") != "" && safe("log.confidencelevel", 0) >= 90) || safe("log.dveventtype", "").contains("threat_intel") || safe("log.eventDescription", "").contains("reputation")', '2025-09-03 12:20:40.016059', true, false, 'origin', NULL, '[]');
INSERT INTO public.utm_correlation_rules VALUES (97, 'AWS IAM User Addition to Group', 2, 3, 1, 'Account Manipulation', 'Credential Access', 'Identifies the addition of a user to a specified group in AWS Identity and Access Management (IAM)', '["https://attack.mitre.org/tactics/TA0006/","https://attack.mitre.org/tactics/TA0003/","https://attack.mitre.org/techniques/T1098/","https://docs.aws.amazon.com/IAM/latest/APIReference/API_AddUserToGroup.html"]', 'safe("log.eventSource", "") == ''iam.amazonaws.com'' && safe("log.eventName", "") == ''AddUserToGroup''', '2025-09-03 12:22:01.488918', true, false, 'origin', NULL, '[]');
INSERT INTO public.utm_correlation_rules VALUES (1457, 'Windows Web Shell Detection: Script Process Child of Common Web Processes', 1, 3, 2, 'Persistence', 'Server Software Component: Web Shell', 'Identifies suspicious commands executed via a web server, which may suggest a vulnerability and remote shell access.', '["https://attack.mitre.org/tactics/TA0003/","https://attack.mitre.org/techniques/T1505/003/"]', 'safe("log.eventDataProcessName", "").matches("(cmd.exe|cscript.exe|powershell.exe|pwsh.exe|powershell_ise.exe|wmic.exe|wscript.exe)") && safe("log.eventDataParentProcessName", "").matches("(w3wp.exe|httpd.exe|nginx.exe|php.exe|php-cgi.exe|tomcat.exe)")', '2025-09-04 21:02:18.378032', true, false, 'origin', NULL, '[]');
INSERT INTO public.utm_correlation_rules VALUES (98, 'AWS Management Console Brute Force of Root User Identity', 3, 2, 1, 'Brute Force', 'Credential Access', 'Identifies a high number of failed authentication attempts to the AWS management console for the Root user identity. An adversary may attempt to brute force the password for the Root user identity, as it has complete access to all services and resources for the AWS account', '["https://attack.mitre.org/tactics/TA0006/","https://attack.mitre.org/techniques/T1110/","https://docs.aws.amazon.com/IAM/latest/UserGuide/id_root-user.html"]', 'safe("log.eventSource", "") == ''signin.amazonaws.com'' && safe("log.eventName", "") == ''ConsoleLogin'' && safe("log.userIdentityType", "") == ''root'' && (safe("log.errorCode", "") != "" || safe("log.errorMessage", "") != "")', '2025-09-03 12:22:02.123025', true, false, 'origin', NULL, '[]');
INSERT INTO public.utm_correlation_rules VALUES (99, 'AWS Access Secret in Secrets Manager', 3, 2, 1, 'Steal Application Access Token', 'Credential Access', 'An adversary may attempt to access the secrets in secrets manager to steal certificates, credentials, or other sensitive material', '["https://attack.mitre.org/tactics/TA0006/","https://attack.mitre.org/techniques/T1528/","https://docs.aws.amazon.com/secretsmanager/latest/apireference/API_GetSecretValue.html","http://detectioninthe.cloud/credential_access/access_secret_in_secrets_manager/"]', 'safe("log.eventSource", "") == ''secretsmanager.amazonaws.com'' && safe("log.eventName", "") == ''GetSecretValue''', '2025-09-03 12:22:03.363807', true, false, 'origin', NULL, '[]');
INSERT INTO public.utm_correlation_rules VALUES (100, 'AWS CloudTrail Log Deleted', 2, 3, 2, 'Impair Defenses', 'Defense Evasion', 'Identifies the deletion of an AWS log trail. An adversary may delete trails in an attempt to evade defenses', '["https://attack.mitre.org/tactics/TA0005/","https://attack.mitre.org/techniques/T1562/","https://docs.aws.amazon.com/awscloudtrail/latest/APIReference/API_DeleteTrail.html","https://awscli.amazonaws.com/v2/documentation/api/latest/reference/cloudtrail/delete-trail.html"]', 'safe("log.eventSource", "") == ''cloudtrail.amazonaws.com'' && safe("log.eventName", "") == ''DeleteTrail''', '2025-09-03 12:22:04.453323', true, false, 'origin', NULL, '[]');
INSERT INTO public.utm_correlation_rules VALUES (125, 'AWS IAM Password Recovery Requested', 3, 2, 2, 'Valid Accounts', 'Initial Access', 'Identifies AWS IAM password recovery requests. An adversary may attempt to gain unauthorized AWS access by abusing password recovery mechanisms.<br><strong>Potential false positives</strong><br>Verify whether the user identity, user agent, and/or hostname should be requesting changes in your environment. Password reset attempts from unfamiliar users should be investigated. If known behavior is causing false positives, it can be exempted from the rule.', '["https://attack.mitre.org/tactics/TA0001/","https://attack.mitre.org/techniques/T1078/","https://www.cadosecurity.com/2020/06/11/an-ongoing-aws-phishing-campaign/"]', 'safe("log.eventSource", "") == "signin.amazonaws.com" && safe("log.eventName", "") == "PasswordRecoveryRequested"', '2025-09-03 12:28:01.642939', true, false, 'origin', NULL, '[]');
INSERT INTO public.utm_correlation_rules VALUES (126, 'AWS Execution via System Manager', 3, 2, 2, 'Phishing', 'Initial Access', 'Identifies the execution of commands and scripts via System Manager. Execution methods such as RunShellScript, RunPowerShellScript, and alike can be abused by an authenticated attacker to install a backdoor or to interact with a compromised instance via reverse-shell using system only commands<br><strong>Potential false positives</strong><br>Verify whether the user identity, user agent, and/or hostname should be making changes in your environment. Suspicious commands from unfamiliar users or hosts should be investigated. If known behavior is causing false positives, it can be exempted from the rule.', '["https://attack.mitre.org/tactics/TA0001/","https://attack.mitre.org/techniques/T1566/","https://docs.aws.amazon.com/systems-manager/latest/userguide/ssm-plugins.html"]', 'safe("log.eventSource", "") == "ssm.amazonaws.com" && safe("log.eventName", "") == "SendCommand"', '2025-09-03 12:39:11.54231', true, false, 'origin', NULL, '[]');
INSERT INTO public.utm_correlation_rules VALUES (127, 'AWS EC2 Network Access Control List Creation', 3, 2, 2, 'External Remote Services', 'Persistence', 'Identifies the creation of an AWS Elastic Compute Cloud (EC2) network access control list (ACL) or an entry in a network ACL with a specified rule number<br><strong>Potential false positives</strong><br>Network ACLâ€™s may be created by a network administrator. Verify whether the user identity, user agent, and/or hostname should be making changes in your environment. Network ACL creations from unfamiliar users or hosts should be investigated. If known behavior is causing false positives, it can be exempted from the rule.', '["https://attack.mitre.org/tactics/TA0003/","https://attack.mitre.org/techniques/T1133/","https://docs.aws.amazon.com/AWSEC2/latest/APIReference/API_CreateNetworkAclEntry.html","https://awscli.amazonaws.com/v2/documentation/api/latest/reference/ec2/create-network-acl-entry.html","https://docs.aws.amazon.com/AWSEC2/latest/APIReference/API_CreateNetworkAcl.html","https://awscli.amazonaws.com/v2/documentation/api/latest/reference/ec2/create-network-acl.html"]', 'safe("log.eventSource", "") == "ec2.amazonaws.com" && safe("log.eventName", "") in [ "CreateNetworkAcl", "CreateNetworkAclEntry"]', '2025-09-03 12:39:12.256317', true, false, 'origin', NULL, '[]');
INSERT INTO public.utm_correlation_rules VALUES (243, 'Azure Diagnostic Settings Deletion', 1, 2, 3, 'Impair Defenses', 'Defense Evasion', 'Identifies the deletion of diagnostic settings in Azure, which send platform logs and metrics to different destinations. An adversary may delete diagnostic settings in an attempt to evade defenses.', '["https://attack.mitre.org/techniques/T1562/","https://attack.mitre.org/techniques/T1562/001/"]', 'safe("log.resourceProviderNameValue", "").contains("azure.activitylogs") && safe("log.operationNameValue", "").contains("MICROSOFT.INSIGHTS/DIAGNOSTICSETTINGS/DELETE") && safe("log.statusValue", "").contains("Succeeded")', '2025-09-03 13:19:30.125212', true, false, 'target', NULL, '[]');
INSERT INTO public.utm_correlation_rules VALUES (128, 'AWS IAM Group Creation', 3, 2, 2, 'Create Account', 'Persistence', 'Identifies the creation of a group in AWS Identity and Access Management (IAM). Groups specify permissions for multiple users. Any user in a group automatically has the permissions that are assigned to the group.<br><strong>Potential false positives</strong><br>A group may be created by a system or network administrator. Verify whether the user identity, user agent, and/or hostname should be making changes in your environment. Group creations from unfamiliar users or hosts should be investigated. If known behavior is causing false positives, it can be exempted from the rule.', '["https://attack.mitre.org/tactics/TA0003/","https://attack.mitre.org/techniques/T1136/","https://docs.aws.amazon.com/IAM/latest/APIReference/API_CreateGroup.html","https://awscli.amazonaws.com/v2/documentation/api/latest/reference/iam/create-group.html"]', 'safe("log.eventSource", "") == "iam.amazonaws.com" && safe("log.eventName", "") == "CreateGroup"', '2025-09-03 12:39:13.075616', true, false, 'origin', NULL, '[]');
INSERT INTO public.utm_correlation_rules VALUES (130, 'AWS Route 53 Domain Transfer Lock Disabled', 3, 2, 2, 'Account Manipulation', 'Persistence', 'Identifies when a transfer lock was removed from a Route 53 domain. It is recommended to refrain from performing this action unless intending to transfer the domain to a different registrar', '["https://attack.mitre.org/tactics/TA0003/","https://attack.mitre.org/techniques/T1098/","https://attack.mitre.org/tactics/TA0006/","https://docs.aws.amazon.com/Route53/latest/APIReference/API_Operations_Amazon_Route_53.html","https://docs.aws.amazon.com/Route53/latest/APIReference/API_domains_DisableDomainTransferLock.html"]', 'safe("log.eventSource", "") == "route53.amazonaws.com" && safe("log.eventName", "") == "DisableDomainTransferLock"', '2025-09-03 12:39:14.398167', true, false, 'origin', NULL, '[]');
INSERT INTO public.utm_correlation_rules VALUES (134, 'AWS SSO Suspicious Activities', 3, 3, 1, 'Credential Access, Defense Evasion, Persistence', 'T1556.006 - Modify Authentication Process: Multi-Factor Authentication', 'Detects suspicious AWS SSO activities including multiple failed login attempts, unusual permission set assignments, or SSO configuration changes that could indicate an attempt to compromise single sign-on authentication mechanisms.

Next Steps:
1. Review the source IP address and user identity associated with the suspicious SSO activity
2. Check if the user''s credentials may have been compromised
3. Verify if the permission set changes or role assumptions were authorized
4. Review CloudTrail logs for other suspicious activities from the same IP or user
5. If unauthorized, immediately revoke the affected SSO sessions and reset user credentials
6. Consider implementing additional MFA requirements for SSO administrative actions
', '["https://docs.aws.amazon.com/singlesignon/latest/userguide/what-is.html","https://attack.mitre.org/techniques/T1556/006/"]', 'safe("log.eventSource", "") == "sso.amazonaws.com" && ( safe("log.eventName", "") in ["AssumeRoleWithSAML", "CreatePermissionSet", "AttachManagedPolicyToPermissionSet", "DeletePermissionSet", "PutInlinePolicyToPermissionSet"] || safe("log.errorCode", "") != "" )', '2025-09-03 12:42:54.255751', true, false, 'origin', NULL, '[]');
INSERT INTO public.utm_correlation_rules VALUES (135, 'AWS Billing Alarm Triggers', 2, 2, 3, 'Impact', 'T1496 - Resource Hijacking', 'Detects when AWS billing alarms transition to ALARM state, which may indicate unexpected cost increases due to resource hijacking, cryptomining, or other unauthorized activities that cause abnormal resource consumption.

Next Steps:
1. Review the alarm details to understand which cost threshold was exceeded
2. Check recent AWS usage and cost reports to identify the services causing the spike
3. Look for recently created or modified resources, especially compute instances (EC2, Lambda, ECS)
4. Review CloudTrail logs for unauthorized API calls or unusual activity patterns
5. Check for cryptomining indicators on compute resources
6. Verify the alarm configuration and threshold values are appropriate
7. If unauthorized activity is found, immediately terminate suspicious resources and rotate credentials
8. Consider implementing additional cost controls and monitoring
', '["https://docs.aws.amazon.com/AmazonCloudWatch/latest/monitoring/monitor_estimated_charges_with_cloudwatch.html","https://attack.mitre.org/techniques/T1496/"]', 'safe("log.eventSource", "") == "monitoring.amazonaws.com" && safe("log.eventName", "") == "StateUpdate" && safe("log.requestParameters", "") != "" && safe("log.requestParameters", "").contains("ALARM") && safe("log.requestParameters", "").contains("EstimatedCharges")', '2025-09-03 12:42:54.974348', true, false, 'origin', NULL, '[]');
INSERT INTO public.utm_correlation_rules VALUES (244, 'Azure Service Principal Addition', 1, 2, 3, 'Use Alternate Authentication Material', 'Defense Evasion', 'Identifies when a new service principal is added in Azure. An application, hosted service, or automated tool that accesses or modifies resources needs an identity created. This identity is known as a service principal. For security reasons, it''s always recommended to use service principals with automated tools rather than allowing them to log in with a user identity.', '["https://attack.mitre.org/techniques/T1550/","https://attack.mitre.org/tactics/TA0005/"]', 'safe("log.resourceProviderNameValue", "").contains("azure.activitylogs") && safe("log.operationNameValue", "").contains("Add service principal") && safe("log.statusValue", "").contains("Succeeded")', '2025-09-03 13:19:30.685746', true, false, 'target', NULL, '[]');
INSERT INTO public.utm_correlation_rules VALUES (136, 'AWS CloudFormation Stack Deletion', 1, 3, 3, 'Impact', 'T1485 - Data Destruction', 'Detects deletion of CloudFormation stacks which could indicate destructive actions by an attacker or unauthorized infrastructure changes. This rule monitors for DeleteStack operations that could result in loss of critical infrastructure. Multiple stack deletions from the same user within a short time frame may indicate malicious activity.

Next Steps:
1. Verify if the stack deletion was authorized and part of planned maintenance
2. Check the user identity who performed the deletion and validate if they should have this permission
3. Review CloudTrail logs for other destructive actions by the same user
4. Examine what resources were contained in the deleted stack
5. If unauthorized, immediately revoke the user''s permissions and investigate for other compromise indicators
6. Consider enabling stack termination protection on critical stacks
7. Review and implement least privilege access policies for CloudFormation operations
', '["https://docs.aws.amazon.com/AWSCloudFormation/latest/UserGuide/logging-cloudformation-api-calls.html","https://attack.mitre.org/techniques/T1485/"]', 'safe("log.eventSource", "") == "cloudformation.amazonaws.com" && safe("log.eventName", "") == "DeleteStack" && safe("log.errorCode", "") == ""', '2025-09-03 12:42:55.631382', true, false, 'origin', NULL, '[]');
INSERT INTO public.utm_correlation_rules VALUES (137, 'AWS CloudTrail Logging Disabled', 3, 3, 2, 'Defense Evasion', 'T1562.008 - Impair Defenses: Disable Cloud Logs', 'Detects attempts to disable CloudTrail logging which could be used to hide malicious activities and evade detection. CloudTrail provides audit logs of all AWS API calls and is critical for security monitoring and compliance.

Next Steps:
1. Immediately verify if the CloudTrail modification was authorized
2. Check the user identity ({{log.userIdentityArn}}) and source IP ({{log.sourceIPAddress}}) for legitimacy
3. Review CloudTrail configuration to ensure logging is re-enabled for all regions
4. Check for any suspicious API calls made around the time of this event
5. If unauthorized, investigate what activities may have occurred while logging was disabled
6. Consider implementing SCPs or IAM policies to prevent CloudTrail modifications
7. Verify if the trail was configured for multi-region logging
8. Check if compliance requirements have been violated
9. Review AWS Config rules for CloudTrail compliance
10. Enable CloudTrail Insights for anomaly detection
', '["https://docs.aws.amazon.com/awscloudtrail/latest/userguide/cloudtrail-concepts.html","https://attack.mitre.org/techniques/T1562/008/"]', 'safe("log.eventSource", "") == "cloudtrail.amazonaws.com" && (safe("log.eventName", "") == "StopLogging" || safe("log.eventName", "") == "DeleteTrail" || (safe("log.eventName", "") == "UpdateTrail" && (safe("log.requestParameters.isLogging", true) == false || safe("log.requestParameters.includeGlobalServiceEvents", true) == false))) && safe("log.errorCode", "") == ""', '2025-09-03 12:42:56.136884', true, false, 'origin', NULL, '[]');
INSERT INTO public.utm_correlation_rules VALUES (138, 'AWS CloudWatch Alarm Deletion', 1, 3, 3, 'Defense Evasion', 'T1562.001 - Impair Defenses: Disable or Modify Tools', 'Detects deletion of CloudWatch alarms which could indicate attempts to disable monitoring and alerting mechanisms before conducting malicious activities. Attackers may delete alarms to prevent detection of subsequent unauthorized actions.

Next Steps:
1. Identify the user account that deleted the alarm(s) and verify if this was authorized
2. Review the deleted alarm configurations to understand what monitoring was disabled
3. Check for any suspicious activities immediately following the alarm deletion
4. Review CloudTrail logs for other API calls made by the same user/role around the same time
5. Verify if the alarm deletion was part of legitimate maintenance or infrastructure changes
6. Consider implementing preventive controls using SCPs or IAM policies to restrict alarm deletion
', '["https://docs.aws.amazon.com/AmazonCloudWatch/latest/APIReference/API_DeleteAlarms.html","https://attack.mitre.org/techniques/T1562/001/"]', 'safe("log.eventSource", "") == "monitoring.amazonaws.com" && safe("log.eventName", "") == "DeleteAlarms" && safe("log.errorCode", "") == ""', '2025-09-03 12:42:56.613871', true, false, 'origin', NULL, '[]');
INSERT INTO public.utm_correlation_rules VALUES (1448, 'Windows: Unusual Service Host Child Process - Childless Service', 1, 3, 2, 'Privilege Escalation', 'Process Injection', 'Identifies unusual child processes of Service Host (svchost.exe) that traditionally do not spawn any child processes. This may indicate a code injection or an equivalent form of exploitation.', '["https://attack.mitre.org/tactics/TA0004/","https://attack.mitre.org/techniques/T1055/"]', 'safe("log.eventDataParentProcessName", "").contains("svchost.exe") && safe("log.message", "").matches("(WdiSystemHost|LicenseManager|StorSvc|CDPSvc|cdbhsvc|BthAvctpSvc|SstpSvc|WdiServiceHost|imgsvc|TrkWks|WpnService|IKEEXT|PolicyAgent|CryptSvc|netprofm|ProfSvc|StateRepository|camsvc|LanmanWorkstation|NlaSvc|EventLog|hidserv|DisplayEnhancementService|ShellHWDetection|AppHostSvc|fhsvc|CscService|PushToInstall)") && !safe("log.eventDataProcessName", "").matches("(WerFault.exe|WerFaultSecure.exe|wermgr.exe|rundll32.exe)") && !safe("log.eventDataProcessName", "").matches("(:\\Windows\\System32\\RelPost.exe|:\\Program Files\\|:\\Program Files (x86)\\|:\\Windows\\System32\\Kodak\\kds_i4x50\\lib\\lexexe.exe)") && !safe("log.message", "").matches("(WdiSystemHost|WdiServiceHost|imgsvc)") && !safe("log.message", "").matches("(:\\WINDOWS\\System32\\winethc.dll,ForceProxyDetectionOnNextRun)")', '2025-09-04 21:01:36.54519', true, false, 'origin', NULL, '[]');
INSERT INTO public.utm_correlation_rules VALUES (140, 'AWS Control Tower Guardrail Violations', 3, 3, 2, 'Defense Evasion', 'T1562.001 - Impair Defenses: Disable or Modify Tools', 'Detects violations of AWS Control Tower guardrails which are preventive or detective controls that help govern resources and monitor compliance across AWS accounts. This includes attempts to disable guardrails or violations detected by AWS Config rules.

Next Steps:
1. Identify the specific guardrail that was violated or disabled by examining the event details
2. Review the account and user identity that triggered the violation
3. Check if this was an authorized change or potential security bypass
4. Verify the current state of Control Tower guardrails in the affected account
5. Review CloudTrail logs for any related suspicious activities by the same user
6. If unauthorized, re-enable the guardrail and investigate the root cause
7. Consider implementing additional preventive controls to protect guardrails
', '["https://docs.aws.amazon.com/controltower/latest/userguide/guardrails.html","https://attack.mitre.org/techniques/T1562/001/"]', 'safe("log.eventSource", "") == "controltower.amazonaws.com" && (safe("log.eventName", "").contains("GuardrailViolation") || safe("log.eventName", "") == "DisableGuardrail" || safe("log.eventName", "") == "UpdateEnabledControl" || (safe("log.eventSource", "") == "config.amazonaws.com" && safe("log.configRuleName", "").startsWith("AWSControlTower") && safe("log.messageType", "") == "ComplianceChangeNotification"))', '2025-09-05 15:22:03.860577', true, false, 'origin', NULL, '[]');
INSERT INTO public.utm_correlation_rules VALUES (141, 'AWS Cost Anomaly - Unusual Resource Creation', 1, 2, 3, 'Resource Development', 'T1583.006 - Web Services', 'Detects potential cost anomalies through unusual creation of expensive resources. This rule monitors for multiple EC2 instance launches or other high-cost resource creation that could indicate cryptomining or resource abuse.

Next Steps:
1. Review the CloudTrail events to identify the specific instances created and their types
2. Check the instance types launched - look for high-performance GPU or compute-optimized instances
3. Verify if the user account that created these resources is legitimate
4. Review billing dashboard for unexpected cost spikes
5. Check if the instances are running cryptomining software or other unauthorized workloads
6. Consider terminating unauthorized instances immediately
7. Review and strengthen IAM policies to prevent unauthorized resource creation
8. Enable AWS Budget alerts if not already configured
', '["https://docs.aws.amazon.com/awscloudtrail/latest/userguide/cloudtrail-event-reference.html","https://attack.mitre.org/techniques/T1583/006/"]', 'safe("log.eventSource", "") == "ec2.amazonaws.com" && (safe("log.eventName", "") == "RunInstances" || safe("log.eventName", "") == "RequestSpotInstances") && safe("log.errorCode", "") == ""', '2025-09-03 12:42:58.959761', true, false, 'origin', NULL, '[]');
INSERT INTO public.utm_correlation_rules VALUES (143, 'EBS Snapshot Sharing Violations', 3, 2, 1, 'Exfiltration', 'T1537 - Transfer Data to Cloud Account', 'Detects potential data exfiltration through EBS snapshot sharing. Monitors for CreateSnapshot followed by ModifySnapshotAttribute events that could indicate an attacker creating snapshots and sharing them with external accounts or making them public.

Next Steps:
1. Identify the affected snapshot ID and volume ID from the event details
2. Review the account or group the snapshot was shared with in requestParameters
3. Verify if the sharing was authorized by checking with the account owner
4. If unauthorized, immediately revoke the snapshot sharing permissions
5. Review CloudTrail logs for other suspicious activities by the same user/role
6. Check if the source volume contains sensitive data
7. Consider implementing preventive controls using IAM policies or SCPs to restrict snapshot sharing
', '["https://securitylabs.datadoghq.com/cloud-security-atlas/attacks/sharing-ebs-snapshot/","https://attack.mitre.org/techniques/T1537/"]', 'safe("log.eventSource", "") == "ec2.amazonaws.com" && safe("log.eventName", "") == "ModifySnapshotAttribute" && safe("log.errorCode", "") == "" && ( safe("log.requestParameters", "").contains("CREATE_VOLUME_PERMISSION") || safe("log.requestParameters", "").contains("createVolumePermission") || (safe("log.requestParameters", "").contains("group") && safe("log.requestParameters", "").contains("all")) )', '2025-09-03 12:43:00.65438', true, false, 'origin', NULL, '[]');
INSERT INTO public.utm_correlation_rules VALUES (245, 'Azure Event Hub Deletion', 1, 2, 3, 'Impair Defenses', 'Defense Evasion', 'Identifies an Event Hub deletion in Azure. An Event Hub is an event processing service that ingests and processes large volumes of events and data. An adversary may delete an Event Hub in an attempt to evade detection.', '["https://attack.mitre.org/techniques/T1562/","https://attack.mitre.org/tactics/TA0005/"]', 'safe("log.resourceProviderNameValue", "").contains("azure.activitylogs") && safe("log.operationNameValue", "").contains("MICROSOFT.EVENTHUB/NAMESPACES/EVENTHUBS/DELETE") && safe("log.statusValue", "").contains("Succeeded")', '2025-09-03 13:19:31.353676', true, false, 'origin', NULL, '[]');
INSERT INTO public.utm_correlation_rules VALUES (144, 'EC2 Instance Metadata Abuse', 3, 2, 1, 'Credential Access', 'T1552.005 - Unsecured Credentials: Cloud Instance Metadata API', 'Detects potential abuse of EC2 instance metadata service (IMDS) which could indicate SSRF exploitation or credential theft. Monitors for unusual API calls using credentials with IMDSv1 role delivery or suspicious patterns of EC2 metadata access.

Next Steps:
1. Identify the EC2 instance and application making the metadata requests
2. Check if the instance has IMDSv2 enforced (HttpTokens set to "required")
3. Review the instance''s IAM role permissions and recent API activity
4. Investigate any web applications running on the instance for SSRF vulnerabilities
5. Check CloudTrail logs for unusual API calls using the instance profile credentials
6. If unauthorized access is confirmed, rotate the instance profile credentials and enforce IMDSv2
', '["https://hackingthe.cloud/aws/exploitation/ec2-metadata-ssrf/","https://attack.mitre.org/techniques/T1552/005/"]', 'safe("log.userAgent", "").contains("169.254.169.254") || safe("log.sourceIPAddress", "").contains("169.254.169.254") || (safe("log.requestParameters", "") != "" && safe("log.requestParameters", "").contains("ec2:RoleDelivery:1.0")) || (safe("log.eventSource", "") == "ec2.amazonaws.com" && safe("log.eventName", "") == "ModifyInstanceMetadataOptions" && (safe("log.requestParameters", "").contains("HttpTokens:optional") || safe("log.requestParameters", "").contains("HttpPutResponseHopLimit") && !safe("log.requestParameters", "").contains("HttpPutResponseHopLimit:1")))', '2025-09-05 15:56:03.245743', true, false, 'origin', NULL, '[]');
INSERT INTO public.utm_correlation_rules VALUES (145, 'AWS GuardDuty High-Severity Finding', 3, 3, 2, 'Defense Evasion, Persistence, Privilege Escalation, Initial Access', 'T1078 - Valid Accounts', 'Detects high-severity findings from AWS GuardDuty indicating potential security threats such as malicious activity, unauthorized access, or compromised instances. GuardDuty analyzes CloudTrail events, VPC Flow Logs, and DNS logs to identify threats.

Next Steps:
1. Review the specific GuardDuty finding details including the threat type and affected resources
2. Check the affected AWS account and region for any unauthorized changes
3. Investigate the source IP addresses and user activities associated with the finding
4. Review CloudTrail logs for suspicious API calls around the time of the finding
5. If compromise is confirmed, rotate credentials and review IAM permissions
6. Enable AWS CloudTrail logging if not already enabled
7. Consider implementing AWS Security Hub for centralized security findings
', '["https://docs.aws.amazon.com/guardduty/latest/ug/guardduty_findings.html","https://attack.mitre.org/techniques/T1078/"]', 'safe("log.eventSource", "") == "guardduty.amazonaws.com" && safe("log.severity", 0.0) >= double(7)', '2025-09-05 16:04:09.438961', true, false, 'origin', NULL, '[]');
INSERT INTO public.utm_correlation_rules VALUES (146, 'AWS IAM Backdoor Creation Attempts', 3, 3, 2, 'Persistence', 'T1136.003 - Create Account: Cloud Account', 'Detects potential IAM backdoor creation attempts through suspicious IAM user creation, access key generation, or policy attachment activities that could provide persistent access.

Next Steps:
1. Review the source IP address and user identity performing these actions
2. Verify if the IAM user creation and policy attachments are authorized
3. Check CloudTrail logs for the complete sequence of IAM actions from this source
4. Review the policies attached to determine if they grant excessive permissions
5. If unauthorized, immediately disable the created user and revoke access keys
6. Investigate other activities from the same source IP or user identity
', '["https://docs.aws.amazon.com/IAM/latest/UserGuide/access_policies_manage.html","https://attack.mitre.org/techniques/T1136/003/"]', 'safe("log.eventSource", "") == "iam.amazonaws.com" && safe("log.eventName", "") in ["CreateUser", "CreateAccessKey", "AttachUserPolicy", "PutUserPolicy", "CreateLoginProfile"] && safe("log.errorCode", "") == ""', '2025-09-03 12:44:59.92634', true, false, 'origin', NULL, '[]');
INSERT INTO public.utm_correlation_rules VALUES (147, 'AWS KMS Key Policy Modification', 3, 3, 2, 'Credential Access', 'T1552 - Unsecured Credentials', 'Detects modifications to AWS KMS key policies which could allow unauthorized access to encrypted data or enable data exfiltration. KMS key policy changes can grant new principals access to decrypt data, create grants for temporary access, or schedule keys for deletion.

Next Steps:
1. Review the CloudTrail event details to identify the principal who made the change
2. Examine the new key policy to understand what permissions were granted or modified
3. Verify if the change was authorized and follows your organization''s change management process
4. Check for any recent unusual activity from the user account that made the change
5. Review access logs for the affected KMS key to identify any unauthorized usage
6. If unauthorized, immediately revert the key policy changes and rotate affected credentials
7. Consider enabling MFA for KMS key policy modifications if not already enabled
8. Correlate with other CloudTrail events to identify potential attack patterns
9. Review IAM policies for the user/role that made the change to ensure least privilege
10. Document the incident and update security policies if necessary
', '["https://docs.aws.amazon.com/kms/latest/developerguide/key-policies.html","https://attack.mitre.org/techniques/T1552/"]', 'safe("log.eventSource", "") == "kms.amazonaws.com" && (safe("log.eventName", "") == "PutKeyPolicy" || safe("log.eventName", "") == "CreateGrant" || safe("log.eventName", "") == "ScheduleKeyDeletion") && safe("log.errorCode", "") == ""', '2025-09-03 12:45:00.685455', true, false, 'origin', NULL, '[]');
INSERT INTO public.utm_correlation_rules VALUES (149, 'AWS Macie Sensitive Data Exposure', 3, 1, 1, 'Collection', 'T1530 - Data from Cloud Storage Object', 'Detects when Amazon Macie identifies sensitive data exposure such as personally identifiable information (PII), financial data, or credentials in S3 buckets.

Next Steps:
1. Review the Macie finding details to identify the type and severity of sensitive data exposed
2. Identify the affected S3 bucket and object containing the sensitive data
3. Review S3 bucket permissions and access logs to determine who has accessed the data
4. Check if the bucket is publicly accessible or shared with unauthorized accounts
5. Review CloudTrail logs for recent access to the affected objects
6. Consider encrypting or removing the sensitive data if inappropriately stored
7. Update bucket policies and access controls to prevent future exposures
8. Enable S3 Block Public Access if not already configured
9. Review and update data classification and handling procedures
', '["https://docs.aws.amazon.com/macie/latest/user/findings.html","https://attack.mitre.org/techniques/T1530/"]', 'safe("log.eventSource", "") == "macie2.amazonaws.com" && (safe("log.eventName", "").startsWith("CreateFinding") || safe("log.eventName", "").startsWith("UpdateFinding")) && safe("log.errorCode", "") == ""', '2025-09-03 12:45:01.975238', true, false, 'origin', NULL, '[]');
INSERT INTO public.utm_correlation_rules VALUES (241, 'Azure Storage Account Key Regenerated', 1, 2, 3, 'Application Access Token', 'Credential Access', 'Identifies a rotation to storage account access keys in Azure. Regenerating access keys can affect any applications or Azure services that are dependent on the storage account key. Adversaries may regenerate a key as a means of acquiring credentials to access systems and resources. ', '["https://attack.mitre.org/techniques/T1528/","https://attack.mitre.org/tactics/TA0006/"]', 'safe("log.resourceProviderNameValue", "").contains("azure.activitylogs") && safe("log.operationNameValue", "").contains("MICROSOFT.STORAGE/STORAGEACCOUNTS/REGENERATEKEY/ACTION") && safe("log.statusValue", "").contains("Succeeded")', '2025-09-03 13:19:28.585222', true, false, 'target', NULL, '[]');
INSERT INTO public.utm_correlation_rules VALUES (150, 'AWS Mass Resource Deletion', 1, 3, 3, 'Impact', 'T1485 - Data Destruction', 'Detects mass deletion of AWS resources which could indicate destructive attack or insider threat. Monitors for multiple delete operations across various AWS services within a 10-minute window.

Next Steps:
1. Immediately identify the user/role performing the deletions through the userIdentity.arn field
2. Review CloudTrail logs to determine the scope and specific resources being deleted
3. Contact the user to verify if these actions are authorized
4. If unauthorized, immediately revoke the user''s AWS credentials and permissions
5. Enable MFA delete protection on critical resources if not already enabled
6. Consider implementing SCPs (Service Control Policies) to prevent mass deletions
7. Review and restore deleted resources from backups if necessary
8. Document the incident and update IAM policies to prevent future occurrences
', '["https://docs.aws.amazon.com/awscloudtrail/latest/userguide/cloudtrail-concepts.html","https://attack.mitre.org/techniques/T1485/"]', '(safe("log.eventName", "").contains("Delete") || safe("log.eventName", "").contains("Terminate") || safe("log.eventName", "").contains("Remove")) && safe("log.errorCode", "") == "" && safe("log.eventSource", "") != "s3.amazonaws.com"', '2025-09-05 16:35:08.326306', true, false, 'origin', NULL, '[]');
INSERT INTO public.utm_correlation_rules VALUES (151, 'AWS Network ACL Changes', 2, 3, 2, 'Defense Evasion', 'T1562.007 - Impair Defenses: Disable or Modify Cloud Firewall', 'Detects changes to AWS Network ACLs that could compromise network security. Network ACLs act as a virtual firewall for controlling traffic in and out of subnets. This rule monitors for creation, modification, or deletion of network ACL rules that may allow unauthorized access or disrupt network connectivity.

Next Steps:
1. Review the CloudTrail logs to identify what specific changes were made to the Network ACL
2. Verify if the user/role making the changes has legitimate authorization for network configuration
3. Check the modified ACL rules to ensure they don''t expose sensitive resources or violate security policies
4. Review the source IP address to confirm it matches expected administrative access patterns
5. If changes are unauthorized, immediately revert the Network ACL modifications
6. Consider implementing preventive controls using AWS Config rules or SCPs to restrict Network ACL changes
7. Document the incident and update network security procedures if needed
', '["https://docs.aws.amazon.com/awscloudtrail/latest/userguide/cloudtrail-event-reference-record-contents.html","https://attack.mitre.org/techniques/T1562/007/"]', 'safe("log.eventSource", "") == "ec2.amazonaws.com" && safe("log.eventName", "") in ["CreateNetworkAcl", "DeleteNetworkAcl", "CreateNetworkAclEntry", "DeleteNetworkAclEntry", "ReplaceNetworkAclEntry", "ReplaceNetworkAclAssociation"] && safe("log.sourceIPAddress", "") != "" && safe("log.errorCode", "") == "" && safe("log.userIdentityType", "") != "AWSService"', '2025-09-03 12:45:03.705744', true, false, 'origin', '["log.sourceIPAddress","log.userIdentityArn","log.awsRegion"]', '[]');
INSERT INTO public.utm_correlation_rules VALUES (1486, 'Windows: Potential Credential Access via DuplicateHandle in LSASS', 3, 1, 2, 'Credential Access', 'OS Credential Dumping', 'Identifies suspicious access to an LSASS handle via DuplicateHandle. This may indicate an attempt to bypass the NtOpenProcess API to evade detection and dump LSASS memory for credential access.', '["https://attack.mitre.org/tactics/TA0006/","https://attack.mitre.org/techniques/T1003/"]', 'safe("log.eventCode", 0.0) == double(10) && safe("log.eventDataProcessName", "").contains("lsass.exe") && safe("log.eventDataGrantedAccess", "") == "0x40" && safe("log.eventDataCallTrace", "").matches("(UNKNOWN)")', '2025-09-04 21:15:04.566706', true, false, 'origin', NULL, '[]');
INSERT INTO public.utm_correlation_rules VALUES (152, 'RDS Security Group Changes', 3, 2, 2, 'Defense Evasion', 'T1562.007 - Impair Defenses: Disable or Modify Cloud Firewall', 'Detects modifications to RDS database security groups that could expose databases to unauthorized access. This includes adding new ingress rules or modifying existing security group configurations that may compromise database security.

Next Steps:
1. Review the security group changes to determine if they were authorized
2. Check if the changes expose RDS instances to public internet (0.0.0.0/0)
3. Verify the identity of the user who made the changes and confirm authorization
4. Review CloudTrail logs for additional suspicious activities by the same user
5. If unauthorized, immediately revert the security group changes
6. Consider implementing preventive controls using AWS Config rules or SCPs
7. Document the incident and update change management procedures if needed
', '["https://docs.aws.amazon.com/AmazonRDS/latest/UserGuide/logging-using-cloudtrail.html","https://attack.mitre.org/techniques/T1562/007/"]', 'safe("log.eventSource", "") == "rds.amazonaws.com" && ( safe("log.eventName", "") == "AuthorizeDBSecurityGroupIngress" || safe("log.eventName", "") == "CreateDBSecurityGroup" || safe("log.eventName", "") == "DeleteDBSecurityGroup" || safe("log.eventName", "") == "RevokeDBSecurityGroupIngress" || safe("log.eventName", "") == "ModifyDBInstance" || safe("log.eventName", "") == "ModifyDBCluster" ) && safe("log.errorCode", "") == "" && ( safe("log.requestParameters", "").contains("0.0.0.0/0") || safe("log.requestParameters", "").contains("securityGroup") || safe("log.requestParameters", "").contains("vpcSecurityGroupIds") )', '2025-09-03 12:45:04.167236', true, false, 'origin', '["log.userIdentityArn","log.eventName"]', '[]');
INSERT INTO public.utm_correlation_rules VALUES (153, 'AWS Reserved Instance Modifications', 1, 3, 1, 'Defense Evasion, Persistence, Privilege Escalation, Initial Access', 'T1078 - Valid Accounts', 'Detects modifications to AWS Reserved Instances which could indicate unauthorized changes to cost optimization settings or attempts to manipulate billing. Reserved instances provide significant cost savings, and unauthorized modifications could lead to increased costs or reduced availability.

Next Steps:
1. Verify if the modification was authorized by checking with the AWS account owner or finance team
2. Review the specific changes made to the reserved instances in the CloudTrail logs
3. Check if the user who made the modification has legitimate access to manage reserved instances
4. Look for any patterns of unusual modifications across multiple reserved instances
5. Verify if the modifications align with your organization''s cost optimization policies
6. Consider implementing additional IAM policies to restrict reserved instance modifications
7. Review the reserved instance configuration changes for any financial impact
8. Check if similar modifications occurred from the same user identity recently
', '["https://docs.aws.amazon.com/AWSEC2/latest/UserGuide/ri-modifying.html","https://attack.mitre.org/techniques/T1078/"]', 'safe("log.eventSource", "") == "ec2.amazonaws.com" && safe("log.eventName", "") == "ModifyReservedInstances"', '2025-09-03 12:45:04.586363', true, false, 'origin', '["log.userIdentityArn","log.awsRegion"]', '[]');
INSERT INTO public.utm_correlation_rules VALUES (154, 'AWS Root Account Usage Without MFA', 3, 3, 2, 'Defense Evasion, Persistence, Privilege Escalation, Initial Access', 'T1078.004 - Valid Accounts: Cloud Accounts', 'Detects usage of AWS root account without Multi-Factor Authentication (MFA). Root account usage should be avoided for daily operations and must always use MFA when necessary. This is a critical security violation as the root account has unrestricted access to all AWS resources.

Next Steps:
1. Immediately verify if this root account activity is authorized
2. Check the source IP address and user agent for suspicious patterns
3. Review all actions performed by the root account during this session
4. Enable MFA for the root account if not already enabled
5. Investigate why MFA was not used (possible bypass or configuration issue)
6. Consider implementing SCPs to restrict root account usage
7. Audit all recent root account activities for potential compromise
8. Review AWS CloudTrail logs for complete session details
9. Check for any privilege escalation attempts or unusual API calls
10. Implement additional monitoring for root account activities
', '["https://docs.aws.amazon.com/IAM/latest/UserGuide/id_root-user.html","https://attack.mitre.org/techniques/T1078/004/"]', 'safe("log.userIdentityType", "") == "Root" && safe("log.userIdentitySessionContextAttributesMfaAuthenticated", "") != "true" && safe("log.errorCode", "") == ""', '2025-09-03 12:45:58.604804', true, false, 'origin', '["log.userIdentityAccountId","log.sourceIPAddress"]', '[]');
INSERT INTO public.utm_correlation_rules VALUES (155, 'AWS Route 53 DNS Hijacking Attempt', 3, 3, 3, 'Resource Development', 'T1584.002 - Compromise Infrastructure: DNS Server', 'Detects potential DNS hijacking attempts through unauthorized changes to Route 53 DNS records. This rule monitors for ChangeResourceRecordSets operations that could indicate an attacker modifying DNS entries to redirect traffic.

Next Steps:
1. Review the CloudTrail logs to identify what DNS records were modified and the specific changes made
2. Verify if the user identity making the changes is authorized to modify Route 53 records
3. Check if the source IP address is from a known and trusted location
4. Review the modified DNS records to ensure they point to legitimate resources
5. If unauthorized, immediately revert the DNS changes and rotate the compromised credentials
6. Enable MFA for all users with Route 53 permissions
7. Consider implementing AWS Config rules to monitor Route 53 changes
8. Review and restrict IAM policies for Route 53 access
', '["https://docs.aws.amazon.com/Route53/latest/DeveloperGuide/logging-using-cloudtrail.html","https://attack.mitre.org/techniques/T1584/002/"]', 'safe("log.eventSource", "") == "route53.amazonaws.com" && safe("log.eventName", "") == "ChangeResourceRecordSets" && safe("log.errorCode", "") == ""', '2025-09-03 12:45:59.402386', true, false, 'origin', NULL, '[]');
INSERT INTO public.utm_correlation_rules VALUES (156, 'AWS S3 Bucket Public Exposure', 3, 2, 1, 'Collection', 'T1530 - Data from Cloud Storage Object', 'Detects S3 bucket configuration changes that expose buckets to public access, including ACL modifications and public access block removal. This can lead to unauthorized data exposure and potential data breach.

Next Steps:
1. Immediately review the affected S3 bucket permissions and revert unauthorized changes
2. Check CloudTrail logs for the source of the configuration change
3. Verify if the change was authorized by examining change management tickets
4. Review bucket contents to determine sensitivity of potentially exposed data
5. Enable S3 Block Public Access at the account level to prevent future exposures
6. Implement bucket policies that restrict public access
7. Enable S3 access logging for the affected bucket
8. Consider implementing AWS Config rules to monitor S3 bucket permissions
', '["https://docs.aws.amazon.com/AmazonS3/latest/userguide/access-control-block-public-access.html","https://attack.mitre.org/techniques/T1530/"]', 'safe("log.eventSource", "") == "s3.amazonaws.com" && (safe("log.eventName", "") == "PutBucketAcl" || safe("log.eventName", "") == "PutBucketPublicAccessBlock" || safe("log.eventName", "") == "DeleteBucketPublicAccessBlock" || safe("log.eventName", "") == "PutObjectAcl") && safe("log.errorCode", "") == "" && (safe("log.requestParameters.x-amz-acl", "") == "public-read" || safe("log.requestParameters.x-amz-acl", "") == "public-read-write" || safe("log.requestParameters.acl", "").contains("AllUsers") || safe("log.requestParameters.publicAccessBlockConfiguration.BlockPublicAcls", true) == false || safe("log.requestParameters.publicAccessBlockConfiguration.BlockPublicPolicy", true) == false)', '2025-09-03 12:46:00.430588', true, false, 'origin', NULL, '[]');
INSERT INTO public.utm_correlation_rules VALUES (157, 'AWS Secrets Manager Suspicious Access Pattern', 3, 2, 1, 'Credential Access', 'T1552.004 - Private Keys', 'Detects unusual access patterns to AWS Secrets Manager that could indicate credential theft or unauthorized access attempts. This rule monitors for multiple GetSecretValue or BatchGetSecretValue operations from the same source within a short time window, which may indicate an attacker attempting to harvest credentials.

Next Steps:
1. Review the CloudTrail logs for the identified user/role to understand which secrets were accessed
2. Check if the accessing identity has legitimate business need for these secrets
3. Verify if the access pattern matches normal usage for this identity
4. Review the source IP addresses and locations for anomalies
5. If unauthorized, immediately rotate the accessed secrets and review IAM permissions
6. Check for any subsequent API calls using potentially compromised credentials
', '["https://docs.aws.amazon.com/secretsmanager/latest/userguide/monitoring-cloudtrail.html","https://attack.mitre.org/techniques/T1552/004/"]', 'safe("log.eventSource", "") == "secretsmanager.amazonaws.com" && (safe("log.eventName", "") == "GetSecretValue" || safe("log.eventName", "") == "BatchGetSecretValue") && safe("log.errorCode", "") == ""', '2025-09-03 12:46:00.825764', true, false, 'origin', NULL, '[]');
INSERT INTO public.utm_correlation_rules VALUES (159, 'AWS STS Token Abuse Detection', 3, 3, 1, 'Defense Evasion, Persistence, Privilege Escalation, Initial Access', 'T1078.004 - Cloud Accounts', 'Detects potential abuse of AWS STS AssumeRole operations. This rule identifies when roles are assumed from unusual IP addresses or when there are multiple role assumptions in a short time period, which could indicate lateral movement or privilege escalation. The rule specifically flags AssumeRole operations performed without MFA authentication.

Next Steps:
1. Verify if the source IP address belongs to your organization''s known IP ranges
2. Check if the assumed role is appropriate for the user or service that initiated the request
3. Review the user identity and verify if this is expected behavior for this account
4. Examine CloudTrail logs for other suspicious activities from the same source IP or user identity
5. If unauthorized, immediately revoke the temporary credentials and review IAM policies
6. Consider implementing MFA requirements for sensitive role assumptions
7. Review and potentially restrict the trust policy for the assumed role
', '["https://docs.aws.amazon.com/IAM/latest/UserGuide/cloudtrail-integration.html","https://attack.mitre.org/techniques/T1078/004/","https://www.elastic.co/security-labs/exploring-aws-sts-assumeroot"]', 'safe("log.eventSource", "") == "sts.amazonaws.com" && safe("log.eventName", "") == "AssumeRole" && safe("log.errorCode", "") == "" && safe("log.userIdentitySessionContextAttributesMfaAuthenticated", "") != "true"', '2025-09-03 12:46:02.168983', true, false, 'origin', NULL, '[]');
INSERT INTO public.utm_correlation_rules VALUES (160, 'AWS Support Case Anomalies', 2, 2, 2, 'Defense Evasion, Persistence, Privilege Escalation, Initial Access', 'Support Resource Abuse', 'Detects unusual support case activities such as multiple cases opened in short time, which could indicate an attacker trying to social engineer AWS support or gather information about the AWS environment.

Next Steps:
1. Review the content of all support cases created by the user in question
2. Contact the user to verify if they initiated the support cases
3. Check CloudTrail logs for other suspicious activities by the same user identity
4. Review the IAM permissions of the user account for any recent changes
5. If unauthorized, immediately disable the compromised credentials
6. Document all support case details for potential incident response
', '["https://docs.aws.amazon.com/awssupport/latest/user/case-management.html","https://attack.mitre.org/techniques/T1078/004/"]', 'safe("log.eventSource", "") == "support.amazonaws.com" && (safe("log.eventName", "") == "CreateCase" || safe("log.eventName", "") == "AddCommunicationToCase")', '2025-09-03 12:46:02.826418', true, false, 'origin', NULL, '[]');
INSERT INTO public.utm_correlation_rules VALUES (163, 'Access Control List (ACL) Modifications', 3, 3, 2, 'Defense Evasion', 'T1562.001 - Impair Defenses: Disable or Modify Tools', 'Detects modifications to Access Control Lists (ACLs) on Cisco ASA devices. Unauthorized ACL changes can open security holes, allow malicious traffic, or block legitimate communications. Monitors for access-list, access-group commands and related syslog messages.

Next Steps:
1. Verify if the user who made the ACL changes is authorized to modify firewall rules
2. Review the specific ACL changes made - look for rules that allow broad access or bypass security controls
3. Check if the changes were made during approved change windows
4. Review the commands executed to understand the scope of modifications
5. If unauthorized, immediately review current ACLs and consider reverting suspicious changes
6. Check for any unusual network traffic patterns following the ACL modifications
', '["https://www.cisco.com/c/en/us/td/docs/security/asa/syslog/b_syslog.html","https://attack.mitre.org/techniques/T1562/001/"]', '(safe("log.commandName", "").matches("^access-(list|group).*") && safe("action", "") == "configuration_change") || (safe("log.message", "").matches(".*access-list.*") && safe("log.message", "").matches(".*(added|removed|modified|applied|deleted).*")) || safe("log.messageId", "") in ["106001", "106002", "106006", "106007", "106018", "335005"]', '2025-09-03 12:54:17.207847', true, false, 'origin', NULL, '[]');
INSERT INTO public.utm_correlation_rules VALUES (164, 'AnyConnect Client Connection Anomalies', 2, 2, 3, 'Command and Control', 'T1071 - Application Layer Protocol', 'Detects AnyConnect VPN client anomalies including connection failures, session drops, IPv6 assignment issues, and suspicious reconnection patterns that may indicate compromised credentials or network attacks.

Next Steps:
1. Review the affected user account for any signs of compromise or unauthorized access
2. Check the source IP address reputation and geolocation for anomalies
3. Examine authentication logs around the same timeframe for failed login attempts
4. Verify if the user reported any connectivity issues or if this is unexpected behavior
5. Review VPN server logs for any configuration changes or system issues
6. Consider resetting the user''s VPN credentials if suspicious activity is confirmed
7. Check for any other alerts or incidents associated with the same user or IP address
8. Monitor for repeated anomalies from the same user/IP combination
', '["https://attack.mitre.org/techniques/T1071/","https://www.cisco.com/c/en/us/td/docs/security/asa/syslog/b_syslog/syslogs9.html"]', '(safe("log.messageId", "").matches("^722") || safe("log.messageId", "") == "716058") && safe("log.message", "").matches("(?i)(anyconnect.*lost.*connection|no.*ipv6.*address.*available|svc.*connection.*fail|anyconnect.*session.*inactive|ssl.*tunnel.*drop)")', '2025-09-03 12:54:18.096241', true, false, 'origin', '["origin.user","origin.ip"]', '[{"indexPattern":"v11-log-cisco-asa-*","with":[{"field":"origin.user.keyword","operator":"filter_term","value":"{{.origin.user}}"},{"field":"origin.ip.keyword","operator":"filter_term","value":"{{.origin.ip}}"}],"or":null,"within":"now-4h","count":5}]');
INSERT INTO public.utm_correlation_rules VALUES (161, 'AWS Unusual API Call Patterns', 3, 2, 1, 'Execution', 'T1106 - Execution through API', 'Detects unusual API call patterns in AWS that may indicate unauthorized access or reconnaissance activities. This rule triggers when multiple sensitive API calls are made from the same source IP within a short time window, suggesting potential enumeration or discovery activities by attackers.

Next Steps:
- Review the source IP address and determine if it''s authorized for AWS API access
- Check if the user identity associated with these calls is legitimate and expected
- Examine the specific API calls made to understand the reconnaissance pattern and scope
- Review CloudTrail logs for the full session to identify any successful exploitation attempts
- Check if any resources were modified or accessed following the reconnaissance activities
- Verify if the API calls originated from expected geographical locations
- Consider blocking the source IP if unauthorized activity is confirmed
- Implement additional monitoring for the affected account and resources
', '["https://docs.aws.amazon.com/awscloudtrail/latest/userguide/cloudtrail-event-reference-record-contents.html","https://attack.mitre.org/techniques/T1106/"]', 'safe("log.eventSource", "") != "" && 
safe("log.sourceIPAddress", "") != "" &&
safe("log.eventName", "") != "" &&
(
  safe("log.eventName", "") in ["DescribeSecurityGroups", "DescribeNetworkAcls", "DescribeVpcs", "DescribeSubnets", "DescribeRouteTables", "DescribeInstances", "DescribeSnapshots", "DescribeVolumes", "DescribeImages", "DescribeKeyPairs", "ListBuckets", "GetBucketAcl", "GetBucketPolicy", "ListAccessKeys", "ListUsers", "ListRoles", "ListPolicies", "GetAccountAuthorizationDetails", "GenerateCredentialReport", "GetCredentialReport"]
) &&
safe("log.errorCode", "") == ""
', '2025-09-05 17:14:33.114619', true, false, 'origin', '["log.eventName","log.eventSource"]', '[]');
INSERT INTO public.utm_correlation_rules VALUES (250, 'Azure Resource Group Deletion', 1, 2, 3, 'Data Destruction', 'Impact', 'Identifies the deletion of a resource group in Azure, which includes all resources within the group. Deletion is permanent and irreversible. An adversary may delete a resource group in an attempt to evade defenses or intentionally destroy data. ', '["https://attack.mitre.org/techniques/T1485/","https://attack.mitre.org/tactics/TA0040/"]', 'safe("log.resourceProviderNameValue", "").contains("azure.activitylogs") && safe("log.operationNameValue", "").contains("MICROSOFT.RESOURCES/SUBSCRIPTIONS/RESOURCEGROUPS/DELETE") && safe("log.statusValue", "").contains("Succeeded")', '2025-09-03 13:20:05.164603', true, false, 'origin', NULL, '[]');
INSERT INTO public.utm_correlation_rules VALUES (334, 'GCP account is probably used for spamming', 1, 2, 3, 'Initial Access', 'Phishing', 'A user''s account was disabled because Google has become aware that it was used to engage in spamming. Usually, spamming is used to perform other attacks like phishing or spread malware.', '["https://attack.mitre.org/tactics/TA0001","https://attack.mitre.org/techniques/T1566/"]', 'safe("log.protoPayload.methodName ", "") == ''google.login.LoginService.accountDisabledSpamming'' || safe("log.protoPayload.methodName ", "") == ''google.login.LoginService.accountDisabledSpammingThroughRelay''', '2025-09-03 14:59:32.20314', true, false, 'origin', NULL, '[]');
INSERT INTO public.utm_correlation_rules VALUES (165, 'Botnet Command and Control Traffic Detected', 3, 2, 1, 'Command and Control', 'T1071 - Application Layer Protocol', 'Detects botnet command and control traffic identified by Cisco ASA''s dynamic filter/botnet database. Message IDs 338001-338002 indicate blacklisted traffic from/to malicious addresses. This could indicate compromised hosts communicating with known botnet infrastructure.

Next Steps:
1. Immediately isolate the affected host(s) to prevent further communication with C2 infrastructure
2. Review the source IP address (origin.ip) to identify the compromised internal host
3. Check the destination IP/domain against threat intelligence sources to confirm malicious nature
4. Examine other logs from the affected host for signs of initial compromise or lateral movement
5. Run full antivirus/anti-malware scans on the affected system
6. Review DNS logs for additional suspicious queries from the same host
7. Check for any data exfiltration attempts or unusual outbound traffic patterns
8. Consider reimaging the affected system if compromise is confirmed
', '["https://www.cisco.com/c/en/us/td/docs/security/asa/special/botnet/asa-botnet.pdf","https://attack.mitre.org/techniques/T1071/"]', 'safe("log.messageId", "") in ["338001", "338002"] || (safe("log.message", "").matches(".*botnet.*(detected|blocked|dropped).*")) || (safe("log.message", "").matches(".*dynamic.*filter.*blacklisted.*") )|| (safe("log.message", "").matches(".*malicious.*address.*"))', '2025-09-03 12:54:18.615011', true, false, 'origin', NULL, '[]');
INSERT INTO public.utm_correlation_rules VALUES (166, 'Certificate Expiration and Validation Warnings', 1, 2, 2, 'Credential Access', 'T1552.004 - Unsecured Credentials: Private Keys', 'Detects certificate expiration warnings and validation failures on Cisco ASA devices. Expired or invalid certificates can disrupt VPN services and may indicate attempts to bypass authentication or use of compromised certificates.

Next Steps:
1. Identify the affected certificate and trustpoint from the alert details
2. Check the certificate expiration date and validity status
3. Review recent authentication logs for failed attempts using this certificate
4. Verify if this is a legitimate certificate that needs renewal or a potential security issue
5. Check for any unauthorized certificate installations or modifications
6. If legitimate, plan certificate renewal before expiration to prevent service disruption
7. Monitor for repeated validation failures which may indicate attack attempts
8. Review certificate chain and CA trust relationships
', '["https://attack.mitre.org/techniques/T1552/004/","https://www.cisco.com/c/en/us/td/docs/security/asa/syslog/b_syslog/syslogs7.html"]', '(safe("log.messageId", "").matches("^717") || safe("log.messageId", "") == "751006") && safe("log.message", "").matches("(?i)(certificate.*expir|cert.*invalid|certificate.*fail|crl.*fail|certificate.*revoked|cert.*validation.*error)")', '2025-09-03 12:54:19.111087', true, false, 'origin', '["log.trustpoint","log.certificate_subject"]', '[]');
INSERT INTO public.utm_correlation_rules VALUES (167, 'ASA Clustering Anomalies Detected', 1, 2, 3, 'Impact', 'T1489 - Service Stop', 'Detects anomalies in ASA clustering operations including replication failures, health check failures, and cluster member state changes. These could indicate network issues, hardware problems, or potential attacks on cluster infrastructure.

Next Steps:
1. Check cluster member status using ''show cluster info'' and ''show cluster history'' commands
2. Review cluster health metrics and interface statistics for all members
3. Verify network connectivity between cluster members (cluster control link and data interfaces)
4. Check for hardware issues on affected cluster members (CPU, memory, interface errors)
5. Review recent configuration changes that might impact clustering
6. Examine logs for signs of DoS attacks or resource exhaustion
7. If persistent issues, consider failing over to a healthy member and investigating the problematic unit
8. Document the incident and update monitoring thresholds if needed
', '["https://www.cisco.com/c/en/us/td/docs/security/asa/syslog/b_syslog.html","https://attack.mitre.org/techniques/T1489/"]', 'safe("dataType", "") == "asa" && ( safe("log.messageId", "") in ["747001", "747009", "747010", "747011", "747012", "747013", "747014", "747018", "747021", "747022", "747039", "747040"] || (safe("severity", "") <= "hight" && ((safe("log.message", "").contains("cluster") && safe("log.message", "").contains("fail")) || (safe("log.message", "").contains("cluster") && safe("log.message", "").contains("error")) || (safe("log.message", "").contains("cluster") && safe("log.message", "").contains("quit")) || safe("log.message", "").contains("health check fail"))) )', '2025-09-03 12:54:19.616644', true, false, 'origin', NULL, '[]');
INSERT INTO public.utm_correlation_rules VALUES (168, 'Configuration Changes Outside Maintenance Window', 2, 3, 2, 'Defense Evasion', 'T1070: Indicator Removal', 'Detects configuration changes made to ASA devices outside of normal business hours or maintenance windows. This could indicate unauthorized configuration modifications or insider threat activity.

Next Steps:
1. Verify if the user making changes is authorized for out-of-hours configuration modifications
2. Check if there was an approved emergency change request or maintenance window
3. Review the specific configuration commands executed (check log.command field)
4. Contact the user to confirm if the activity was legitimate
5. If unauthorized, immediately review all configuration changes made and assess impact
6. Check for any other suspicious activities from the same user or IP address
7. Consider revoking access if the activity cannot be verified as legitimate
', '["https://attack.mitre.org/techniques/T1070/","https://www.cisco.com/c/en/us/td/docs/security/asa/syslog/b_syslog/syslogs1.html"]', 'safe("log.messageId", "") == "111008" && safe("origin.user", "") != "" && (safe("log.command", "").contains("config") || safe("log.command", "").contains("write") || safe("log.command", "").contains("copy") || safe("log.command", "").contains("delete") || safe("log.command", "").contains("clear") || safe("log.command", "").contains("no ") || safe("log.message", "").contains("configuration") || safe("log.message", "").contains("config") && safe("log.message", "").contains("changed")) && (int(safe("log.timestamp", "").split("T")[1].split(":")[0]) < 6 || int(safe("log.timestamp", "").split("T")[1].split(":")[0]) > 22)', '2025-09-03 12:54:20.224724', true, false, 'origin', NULL, '[]');
INSERT INTO public.utm_correlation_rules VALUES (174, 'Object Group Configuration Modifications', 2, 3, 1, 'Persistence, Privilege Escalation', 'T1098 - Account Manipulation', 'Detects modifications to ASA object groups which could indicate unauthorized configuration changes or potential security policy alterations. Object groups are used to define security policies and their modification should be closely monitored.

Next Steps:
1. Verify if the user making the change is authorized to modify object groups
2. Review the specific object group modified and understand its purpose
3. Check if the change was made during an approved maintenance window
4. Compare the configuration change with your change management records
5. Review related firewall rules that use the modified object group
6. Cross-reference with recent access logs to identify potential insider threats
7. If unauthorized, immediately revert the change and investigate the user''s activities
8. Document the change in your security incident tracking system
9. Review object group membership changes for privilege escalation indicators
', '["https://www.cisco.com/c/en/us/td/docs/security/asa/syslog/b_syslog.html","https://attack.mitre.org/techniques/T1098/"]', 'safe("dataType", "") == "asa" && safe("log.messageId", "") in ["111009", "111010"] && (safe("log.message", "").matches(".*object-group.*") || safe("log.message", "").matches(".*object group.*") || safe("log.command", "").matches(".*object-group.*"))', '2025-09-03 12:55:13.066499', true, false, 'origin', '["origin.host","origin.user"]', '[]');
INSERT INTO public.utm_correlation_rules VALUES (1498, 'Windows: The process was terminated due to an unhandled exception', 3, 3, 2, 'Potentially Malicious Activity', 'Service Stop', 'Adversaries may stop or disable services on a system to render those services unavailable to legitimate users.  Stopping critical services or processes can inhibit or stop response to an incident or aid in the adversary is overall objectives to cause damage to the environment', '["https://attack.mitre.org/techniques/T1489/"]', 'safe("log.wineventlogEventDataProviderName", "") == ".NET Runtime" && safe("log.eventCode", 0.0) == double(1026)', '2025-09-04 21:16:07.923607', true, false, 'origin', NULL, '[]');
INSERT INTO public.utm_correlation_rules VALUES (169, 'High CPU/Memory Utilization on Cisco ASA', 1, 2, 3, 'Impact', 'T1499 - Endpoint Denial of Service: Resource Exhaustion', 'Detects high CPU or memory utilization on Cisco ASA devices which could indicate a DoS attack, resource exhaustion, or system malfunction. High resource usage can impact firewall performance and availability, potentially affecting network security and connectivity.

Next Steps:
1. Check current CPU and memory usage on the affected ASA device using ''show cpu usage'' and ''show memory'' commands
2. Review recent configuration changes that might have increased resource usage
3. Examine traffic patterns for potential DoS attacks or traffic spikes
4. Check for any running processes consuming excessive resources using ''show processes cpu-usage sorted''
5. Review ASA logs for any errors or warnings related to resource constraints
6. Consider implementing rate limiting or traffic shaping if legitimate traffic is causing the issue
7. If malicious activity is suspected, identify and block the source IP addresses
8. Monitor the device closely and consider scheduling a maintenance window if a restart is needed
', '["https://www.cisco.com/c/en/us/td/docs/security/asa/syslog/b_syslog/syslogs2.html","https://attack.mitre.org/techniques/T1499/"]', 'safe("dataType", "") == "asa" && ( (safe("log.messageId", "") == "211001" && safe("log.message", "").contains("Memory allocation Error") || (safe("log.messageId", "") == "211003" && safe("log.message", "").contains("Error in computed percentage CPU usage value") || (safe("log.message", "").contains("CPU usage") && safe("log.message", "").matches(".*([8-9][0-9]|100)%.*")) || (safe("log.message", "").contains("memory usage") && safe("log.message", "").matches(".*([8-9][0-9]|100)%.*")) )', '2025-09-03 12:54:20.705687', true, false, 'target', '["target.host"]', '[]');
INSERT INTO public.utm_correlation_rules VALUES (170, 'Interface Flapping Patterns', 1, 2, 3, 'Impact', 'T1489 - Service Stop', 'Detects interface flapping on Cisco ASA devices which could indicate hardware problems, cable issues, or a potential DoS attack. Rapid link state changes can cause network instability and service disruptions.

Next Steps:
1. Check the physical connection integrity for the affected interface
2. Review interface statistics for errors, drops, or CRC failures
3. Verify cable quality and connections on both ends
4. Check for environmental factors (temperature, power fluctuations)
5. Review recent configuration changes that might affect the interface
6. Monitor for patterns - is it happening at specific times or intervals?
7. Consider implementing interface dampening if flapping persists
8. Check for potential DoS attacks targeting the interface
', '["https://www.cisco.com/c/en/us/td/docs/security/asa/syslog/b_syslog/syslogs4.html","https://attack.mitre.org/techniques/T1489/"]', 'safe("dataType", "") == "asa" && ( (safe("log.messageId", "") == "411001" && safe("log.message", "").contains("changed state to up")) || (safe("log.messageId", "") == "411002" && safe("log.message", "").contains("changed state to down")) )', '2025-09-03 12:54:21.347804', true, false, 'origin', NULL, '[]');
INSERT INTO public.utm_correlation_rules VALUES (171, 'IPS Signature Match - Malicious Pattern Detected', 3, 3, 2, 'Initial Access', 'T1190 - Exploit Public-Facing Application', 'Detects when ASA IPS features identify malicious patterns in network traffic. Message ID 108003 indicates ESMTP/SMTP connections terminated due to malicious patterns. Also monitors for general IPS/IDS signature matches and threat intelligence hits.

Next Steps:
1. Review the specific IPS signature that was triggered and understand its severity
2. Investigate the source IP address for reputation and previous malicious activity
3. Check if the target system shows any signs of compromise
4. Review firewall logs for any successful connections from the same source
5. Consider blocking the source IP if multiple signatures are triggered
6. Verify that IPS signatures are up-to-date
7. Document the incident and any actions taken
', '["https://www.cisco.com/c/en/us/td/docs/security/asa/syslog/b_syslog.html","https://attack.mitre.org/techniques/T1190/"]', 'safe("log.messageId", "") == "108003" || (safe("log.message", "").matches(".*malicious.*pattern.*") && safe("log.message", "").matches(".*(detected|terminated|blocked).*")) || (safe("log.message", "").matches(".*IPS.*signature.*") && safe("log.message", "").matches(".*(matched|triggered|detected).*")) || (safe("action", "") in ["ips_alert", "ids_alert", "threat_detected"])', '2025-09-03 12:54:21.965921', true, false, 'origin', NULL, '[]');
INSERT INTO public.utm_correlation_rules VALUES (172, 'Multiple Failed VPN Authentication Attempts', 3, 2, 1, 'Credential Access', 'T1110 - Brute Force', 'Detects multiple failed VPN authentication attempts from the same source IP address, which could indicate a brute force attack or password guessing attempt against VPN credentials.

Next Steps:
- Review the source IP address and check if it is known or authorized
- Check for successful authentication attempts from the same IP after failed attempts
- Verify if the targeted user accounts exist and are active
- Consider temporarily blocking the source IP if attack continues
- Review VPN access logs for any unusual patterns or other indicators
- Contact the user if the IP is associated with a legitimate user to verify activity
', '["https://attack.mitre.org/techniques/T1110/","https://www.cisco.com/c/en/us/td/docs/security/asa/syslog/b_syslog/syslogs1.html"]', '(safe("log.messageId", "") == "113015" || safe("log.messageId", "") == "113021" || safe("log.messageId", "") == "109034" || safe("log.messageId", "") == "611102") && safe("origin.ip", "") != "" && (safe("log.reason", "") .matches("(?i)(invalid|failed|rejected|authentication)") || safe("log.message", "") .matches("(?i)(authentication.*failed|invalid.*password)"))', '2025-09-03 12:54:22.605346', true, false, 'origin', '["origin.ip","origin.user"]', '[]');
INSERT INTO public.utm_correlation_rules VALUES (173, 'NAT Rule Configuration Changes', 2, 3, 1, 'Defense Evasion', 'T1599.001 - Network Boundary Bridging: Network Address Translation Traversal', 'Detects NAT rule configuration changes on Cisco ASA devices. NAT rule modifications can be used to redirect traffic, bypass security controls, or establish unauthorized access paths. Message ID 305006 indicates NAT configuration errors or changes.

Next Steps:
- Verify if the configuration change was authorized and part of scheduled maintenance
- Review the specific NAT rules that were modified and their potential impact
- Check the user account that made the changes for legitimacy
- Look for any suspicious network traffic patterns following the NAT rule changes
- Document the change in your change management system if legitimate
- Review other recent configuration changes from the same source IP or user
- Correlate with any recent security incidents or unusual network behavior
- Validate that proper change control procedures were followed
- Check if the change aligns with your organization''s security policies
- Review access logs to ensure the change was made from an authorized location
', '["https://www.cisco.com/c/en/us/td/docs/security/asa/syslog/b_syslog.html","https://attack.mitre.org/techniques/T1599/001/"]', 'safe("log.messageId", "") == "305006" || (safe("log.message", "").contains("NAT") && (safe("log.message", "").contains("added") || safe("log.message", "").contains("removed") || safe("log.message", "").contains("modified") || safe("log.message", "").contains("changed"))) || (safe("log.commandName", "").startsWith("nat") || safe("log.commandName", "").startsWith("global") || safe("log.commandName", "").startsWith("static")) && safe("action", "") == "configuration_change"', '2025-09-03 12:55:12.166141', true, false, 'origin', NULL, '[]');
INSERT INTO public.utm_correlation_rules VALUES (175, 'Privilege Escalation via Enable Mode', 3, 3, 1, 'Defense Evasion, Persistence, Privilege Escalation, Initial Access', 'T1078.003 - Valid Accounts: Local Accounts', 'Detects when users attempt to escalate privileges using the enable command on ASA devices. This could indicate unauthorized attempts to gain administrative access or legitimate administrators accessing privileged mode.

Next Steps:
1. Verify if the user attempting enable mode access is authorized for administrative privileges
2. Check the source IP address to confirm it belongs to an authorized administrator workstation
3. Review recent configuration changes made after the privilege escalation
4. Look for any suspicious commands executed in enable mode following this event
5. Verify with the user if this was a legitimate administrative action
6. If unauthorized, immediately disable the user account and review all actions taken during the session
7. Check for any persistence mechanisms or backdoors that may have been created
', '["https://attack.mitre.org/techniques/T1078/003/","https://www.cisco.com/c/en/us/td/docs/security/asa/syslog/b_syslog.html"]', 'safe("log.messageId", "") == "111008" && (safe("log.command", "").matches("^enable") || safe("origin.user", "") == "enable_15" || safe("log.message", "").matches("(?i)enable.*command")) && safe("origin.ip", "") != ""', '2025-09-03 12:55:13.585278', true, false, 'origin', NULL, '[]');
INSERT INTO public.utm_correlation_rules VALUES (176, 'Security Context Configuration Changes', 2, 3, 1, 'Defense Evasion', 'T1562.001 - Impair Defenses: Disable or Modify Tools', 'Detects changes to ASA security contexts which could indicate attempts to modify security boundaries or isolate administrative domains. Security context changes can affect the entire security posture of the device by potentially allowing an attacker to move between different security domains or bypass security controls.

Next Steps:
1. Verify if the context change was authorized by checking change management records
2. Review the user account that made the change for suspicious activity
3. Check for any other configuration changes made around the same time
4. Examine the specific context changes made and their potential security impact
5. Review access logs for the source IP to identify any anomalous patterns
6. Consider temporarily increasing monitoring on the affected security contexts
', '["https://www.cisco.com/c/en/us/td/docs/security/asa/syslog/b_syslog.html","https://attack.mitre.org/techniques/T1562/001/"]', 'safe("dataType", "") == "asa" && ( safe("log.messageId", "") in ["111009", "111010"] && (contains(safe("log.message", ""), "context") || contains(safe("log.message", ""), "changeto") || contains(safe("log.command", ""), "context") || contains(safe("log.command", ""), "changeto")) )', '2025-09-03 12:55:14.404967', true, false, 'origin', NULL, '[]');
INSERT INTO public.utm_correlation_rules VALUES (177, 'Site-to-Site VPN Connection Failures', 2, 2, 3, 'Impact', 'T1498 - Network Denial of Service', 'Detects multiple site-to-site VPN connection failures which could indicate network issues, misconfigurations, or potential denial of service attacks. Monitors Phase 1 and Phase 2 IPSec failures.

Next Steps:
1. Check the ASA logs for specific error messages to identify the root cause (authentication failures, network connectivity issues, or configuration mismatches)
2. Verify IPSec configuration on both endpoints (pre-shared keys, encryption settings, lifetime values)
3. Check network connectivity between the VPN endpoints using ping and traceroute
4. Review recent configuration changes on the ASA or peer devices
5. Monitor CPU and memory usage on the ASA to rule out resource exhaustion
6. Check for any ongoing DDoS attacks targeting the VPN service
7. Verify that the peer IP addresses are correct and haven''t changed
8. Review firewall rules to ensure IPSec traffic (UDP 500, 4500, ESP) is allowed
', '["https://www.cisco.com/c/en/us/td/docs/security/asa/syslog/b_syslog.html","https://attack.mitre.org/techniques/T1498/"]', 'safe("dataType", "") == "asa" && ( safe("log.messageId", "") in ["713061", "713062", "713063", "713065", "713081", "713082", "713086"] || safe("log.messageId", "") in ["751002", "751004", "751010", "751011", "750011", "717037", "717052"] || (contains(safe("log.message", ""), "Tunnel rejected") || contains(safe("log.message", ""), "IKE") && contains(safe("log.message", ""), "fail") || contains(safe("log.message", ""), "IPSec") && contains(safe("log.message", ""), "fail") || contains(safe("log.message", ""), "Phase 1") && contains(safe("log.message", ""), "fail") || contains(safe("log.message", ""), "Phase 2") && contains(safe("log.message", ""), "fail")) )', '2025-09-03 12:55:15.706613', true, false, 'origin', '["origin.ip","target.ip","log.messageId"]', '[]');
INSERT INTO public.utm_correlation_rules VALUES (178, 'Syslog Server Configuration Modifications', 2, 3, 2, 'Defense Evasion', 'T1562.001 - Impair Defenses: Disable or Modify Tools', 'Detects modifications to syslog server configuration on Cisco ASA devices. Attackers may attempt to disable or redirect syslog to hide their activities, prevent security monitoring, or exfiltrate logs to attacker-controlled servers.

Next Steps:
1. Verify if the configuration change was authorized by checking change management records
2. Review the specific syslog commands executed to understand the nature of the change
3. Check if syslog forwarding was disabled, redirected to a new server, or logging levels were reduced
4. Investigate other activities by the same user around the time of the change
5. Verify that critical logs are still being collected and forwarded to the SIEM
6. If unauthorized, immediately restore proper syslog configuration
7. Consider implementing configuration change alerts and approval workflows
', '["https://attack.mitre.org/techniques/T1562/001/","https://www.cisco.com/c/en/us/td/docs/security/asa/syslog/b_syslog/syslogs1.html"]', 'safe("log.messageId", "") == "111008" && safe("origin.user", "") != "" && safe("log.message", "").matches("(?i)(logging host|no logging|logging trap|logging facility|logging level|syslog server)")', '2025-09-03 12:55:16.60885', true, false, 'origin', '["origin.user","origin.ip"]', '[]');
INSERT INTO public.utm_correlation_rules VALUES (179, 'Threat Detection Triggered - Potential DDoS/Scanning Attack', 1, 2, 3, 'Impact', 'Network Denial of Service', 'Detects when ASA threat detection features are triggered, indicating potential DDoS attacks, port scanning, or other malicious activities. Monitors message IDs 733100-733105 which indicate various threat detection triggers including scanning and rate-based attacks.

Next Steps:
1. Review the specific threat detection message ID to understand the type of attack detected
2. Check ASA logs for the source IP address to identify patterns of malicious behavior
3. Verify if the source IP is known to be malicious using threat intelligence feeds
4. Consider implementing rate limiting or blocking rules for confirmed malicious sources
5. Review ASA threat detection thresholds to ensure they are appropriately tuned for your environment
6. Check for any service degradation or availability issues on protected resources
', '["https://www.cisco.com/c/en/us/td/docs/security/asa/asa920/configuration/firewall/asa-920-firewall-config/conns-threat.html","https://attack.mitre.org/techniques/T1498/"]', 'safe("log.messageId", "") in ["733100", "733101", "733102", "733104", "733105"] || (safe("log.message", "").matches(".*threat.*detection.*") && safe("log.message", "").matches(".*(triggered|exceeded|detected).*")) || (safe("log.message", "").matches(".*scanning.*threat.*") || safe("log.message", "").matches(".*rate.*exceeded.*"))', '2025-09-03 12:55:16.924699', true, false, 'origin', NULL, '[]');
INSERT INTO public.utm_correlation_rules VALUES (180, 'NTP Time Synchronization Failures', 1, 3, 2, 'Defense Evasion', 'T1070.006 - Timestomping: Timestomp', 'Detects NTP time synchronization failures on ASA devices. Time sync issues can indicate network problems, misconfiguration, or attempts to manipulate timestamps for evasion. Accurate time synchronization is critical for log correlation, security event analysis, and compliance requirements.

Next Steps:
1. Verify NTP server connectivity from the ASA device using ''show ntp associations'' and ''show ntp status''
2. Check if the configured NTP servers are reachable and responding (ping/traceroute from ASA)
3. Review NTP authentication settings if configured - verify pre-shared keys match on both sides
4. Examine firewall rules to ensure UDP port 123 is allowed to NTP servers
5. Check for recent configuration changes to NTP settings in the ASA audit logs
6. Verify the ASA system clock drift isn''t excessive using ''show clock detail''
7. Consider if this could be part of a timestomping attack to evade detection
8. Review other security events around the same timeframe for suspicious activity
', '["https://attack.mitre.org/techniques/T1070/006/","https://www.cisco.com/c/en/us/td/docs/security/asa/syslog/b_syslog/syslogs6.html"]', '(safe("log.messageId", "") == "610001" || safe("log.messageId", "") == "610002" || safe("log.messageId", "") == "610101") && safe("log.message", "").matches("(?i)(ntp.*denied|ntp.*authentication.*failed|time.*sync.*fail|clock.*unsynchronized|peer.*unreachable|stratum.*invalid)")', '2025-09-03 12:55:17.737126', true, false, 'origin', '["origin.ip"]', '[]');
INSERT INTO public.utm_correlation_rules VALUES (181, 'Transparent Firewall Mode Configuration Changes', 2, 3, 2, 'Defense Evasion', 'T1562.001 - Impair Defenses: Disable or Modify Tools', 'Detects changes to transparent firewall mode configuration or issues with transparent mode operation. Mode changes can significantly alter the security behavior of the firewall and should be closely monitored. Transparent mode makes the firewall act as a Layer 2 bridge rather than a Layer 3 router, which can impact network segmentation and security controls.

Next Steps:
1. Verify if the configuration change was authorized and scheduled
2. Review the user account that made the change to ensure it''s legitimate
3. Check if the change aligns with approved change requests
4. Examine other recent configuration changes by the same user
5. Verify the new firewall mode configuration is appropriate for the network design
6. Review bridge group configurations if transparent mode was enabled
7. Test network connectivity and security policies after the change
8. Document the change if legitimate or revert if unauthorized
', '["https://www.cisco.com/c/en/us/td/docs/security/asa/syslog/b_syslog.html","https://attack.mitre.org/techniques/T1562/001/"]', 'safe("dataType", "") == "asa" && ( (safe("log.messageId", "") in ["111009", "111010"] && (safe("log.message", "").contains("firewall") && safe("log.message", "").contains("transparent")) || (safe("log.command", "").contains("firewall") && safe("log.command", "").contains("transparent")) || (safe("log.message", "").contains("bridge") && safe("log.message", "").contains("group")) || (safe("log.command", "").contains("bridge") && safe("log.command", "").contains("group"))) || safe("log.messageId", "") in ["322004", "412001"] || (safe("log.message", "").contains("transparent") && safe("log.message", "").contains("firewall")) || (safe("log.message", "").contains("MAC") && safe("log.message", "").contains("moved") && safe("log.message", "").contains("interface")) )', '2025-09-03 12:55:18.425724', true, false, 'origin', '["origin.user","origin.host"]', '[]');
INSERT INTO public.utm_correlation_rules VALUES (182, 'VPN Geographic Impossibility Travel', 3, 2, 1, 'Defense Evasion, Persistence, Privilege Escalation, Initial Access', 'T1078 - Valid Accounts', 'Detects when a user authenticates from two geographically distant locations within a short time frame, which is physically impossible. This could indicate compromised VPN credentials being used by an attacker from a different location while the legitimate user is still active.

Next Steps:
1. Verify the legitimacy of both VPN connections by contacting the user directly
2. Check the geographic locations of both IP addresses to confirm impossibility of travel
3. Calculate the physical distance and time between connections to verify impossibility
4. Review the user''s recent authentication history for other anomalies
5. If confirmed suspicious, immediately disable the user''s VPN access
6. Reset the user''s credentials and enforce multi-factor authentication
7. Check for any data access or exfiltration during the suspicious sessions
8. Review logs for lateral movement attempts from the suspicious sessions
9. Analyze the legitimacy of both source IP addresses and their reputation
10. Document the incident and update security awareness training if needed
', '["https://attack.mitre.org/techniques/T1078/","https://www.cisco.com/c/en/us/td/docs/security/asa/syslog/b_syslog.html"]', 'safe("log.messageId", "") == "113039" && safe("origin.user", "") != "" && safe("origin.ip", "") != "" && safe("action", "") == "connected"', '2025-09-03 12:55:18.96687', true, false, 'origin', NULL, '[]');
INSERT INTO public.utm_correlation_rules VALUES (183, 'WebVPN Suspicious Activities and Session Anomalies', 3, 2, 3, 'Lateral Movement', 'T1021 - Remote Services', 'Detects suspicious WebVPN activities including failed sessions, resource exhaustion, and abnormal session patterns that may indicate unauthorized access attempts or denial of service attacks against the Cisco ASA WebVPN service.

Next Steps:
- Review the source IP address for reputation and geolocation anomalies
- Check if the origin.user (if available) is a valid user account
- Examine concurrent WebVPN sessions from the same IP or user
- Look for patterns of failed authentication attempts before successful connections
- Verify if resource exhaustion messages correlate with legitimate high usage periods
- Check ASA performance metrics and VPN license utilization
- Review WebVPN access logs for unusual file access or application usage patterns
', '["https://attack.mitre.org/techniques/T1021/","https://www.cisco.com/c/en/us/td/docs/security/asa/syslog/b_syslog/syslogs8.html"]', 'safe("log.messageId", "").matches("^716") && (safe("log.messageId", "") == "716007" || safe("log.message", "").matches("(?i)(webvpn.*unable.*create|session.*limit.*reached|webvpn.*fail|maximum.*login.*reached|webvpn.*error)"))', '2025-09-03 12:55:35.706757', true, false, 'origin', '["origin.ip","origin.user"]', '[]');
INSERT INTO public.utm_correlation_rules VALUES (184, '802.1X Authentication Failures Detection', 2, 2, 1, 'Credential Access', 'T1110 - Brute Force', 'Detects multiple 802.1X authentication failures from the same MAC address or interface, which could indicate unauthorized access attempts or misconfigured supplicants.

Next Steps:
1. Check the source MAC address and interface for any known devices
2. Review the switch configuration to ensure 802.1X is properly configured
3. Verify if the supplicant device has the correct credentials configured
4. Check for any recent changes to the network authentication infrastructure
5. Consider temporarily blocking the MAC address if the attempts continue
6. Review RADIUS server logs for additional authentication failure details
', '["https://www.cisco.com/c/en/us/td/docs/switches/lan/catalyst9300/software/release/16-6/configuration_guide/sec/b_166_sec_9300_cg/configuring_ieee_802_1x_port_based_authentication.html","https://attack.mitre.org/techniques/T1110/"]', 'safe("log.facility", "") == "DOT1X" && safe("log.severity", 0) >= 5 && safe("log.mnemonic", "") == "FAIL" && safe("log.message", "").contains("authentication") && safe("origin.mac", "") != ""', '2025-09-03 13:02:45.593343', true, false, 'origin', '["origin.mac","origin.interface"]', '[{"indexPattern":"v11-log-cisco-switch-*","with":[{"field":"origin.mac.keyword","operator":"filter_term","value":"{{.origin.mac}}"},{"field":"log.facility.keyword","operator":"filter_term","value":"DOT1X"},{"field":"log.mnemonic.keyword","operator":"filter_term","value":"FAIL"}],"or":null,"within":"now-10m","count":5}]');
INSERT INTO public.utm_correlation_rules VALUES (185, 'ARP Poisoning Attack Detection', 3, 3, 2, 'Credential Access, Collection', 'T1557.002 - Adversary-in-the-Middle: ARP Cache Poisoning', 'Detects potential ARP poisoning attacks by monitoring for invalid ARP packets, DHCP snooping violations, and gratuitous ARP abuse. These attacks can enable man-in-the-middle attacks by corrupting the ARP cache of network devices and redirecting network traffic through an attacker-controlled system.

Next Steps:
1. Identify the source MAC and IP addresses involved in the suspicious ARP activity
2. Check if the source device is authorized to be on the network segment
3. Review DHCP snooping and dynamic ARP inspection logs for additional violations
4. Verify if legitimate network changes (new devices, IP changes) may have triggered the alert
5. If confirmed malicious, immediately isolate the affected switch port and investigate the compromised device
6. Review network traffic for signs of data interception, credential harvesting, or traffic redirection
7. Update switch security configurations (enable port security, DHCP snooping, DAI if not already enabled)
8. Consider implementing additional network segmentation to limit attack impact
', '["https://www.cisco.com/c/en/us/td/docs/switches/lan/catalyst4500/12-2/25ew/configuration/guide/conf/dynarp.html","https://attack.mitre.org/techniques/T1557/002/"]', '(safe("log.facility", "") == "SW_DAI" && safe("log.mnemonic", "") in ["INVALID_ARP", "DHCP_SNOOPING_DENY", "ACL_DENY"]) || (safe("log.facility", "") == "IP" && safe("log.mnemonic", "") in ["DUPADDR", "SOURCEGUARD"]) || (safe("log.message", "").contains("invalid arp") || safe("log.message", "").contains("arp inspection drop") || safe("log.message", "").contains("dhcp snooping deny")) || (safe("log.message", "").contains("gratuitous arp") || safe("log.message", "").contains("arp reply not request") || safe("log.message", "").contains("duplicate ip address")) || (safe("log.message", "").contains("IP source guard deny") || safe("log.message", "").contains("arp packet validation failed")) || (safe("log.severity", 0) <= 3 && (safe("log.message", "").contains("arp spoofing") || safe("log.message", "").contains("arp poison") || safe("log.message", "").contains("man in the middle")))', '2025-09-03 13:02:46.192768', true, false, 'origin', NULL, '[]');
INSERT INTO public.utm_correlation_rules VALUES (186, 'Configuration Rollback Event Detected', 2, 3, 3, 'Defense Evasion', 'T1562.001 - Impair Defenses: Disable or Modify Tools', 'Detects configuration rollback events on Cisco switches which may indicate unauthorized changes being reverted or system recovery actions. Configuration rollbacks can be a sign of an attacker trying to cover their tracks or legitimate administrators restoring from a compromised state.

Next Steps:
1. Verify if the rollback was authorized by checking the change management system
2. Review the configuration changes that were rolled back to identify any unauthorized modifications
3. Check authentication logs to identify who initiated the rollback
4. Review switch logs before and after the rollback to understand the context
5. If unauthorized, investigate for signs of compromise and review access controls
6. Document the incident and update configuration backup procedures if needed
', '["https://www.cisco.com/c/en/us/td/docs/switches/lan/catalyst9400/software/release/17-13/configuration_guide/sys_mgmt/b_1713_sys_mgmt_9400_cg/configuring_system_message_logs.html","https://attack.mitre.org/techniques/T1562/001/"]', '(safe("log.facility", "") == "SYS" || safe("log.facility", "") == "CONFIG") && (safe("log.mnemonic", "") == "CONFIG_I" || safe("log.mnemonic", "") == "ROLLBACK" || safe("log.message", "").contains("configuration rollback") || safe("log.message", "").contains("config reverted") || safe("log.message", "").contains("startup-config replaced") || safe("log.message", "").contains("configuration restored"))', '2025-09-03 13:02:46.831709', true, false, 'origin', NULL, '[]');
INSERT INTO public.utm_correlation_rules VALUES (187, 'DHCP Snooping Violation Detected', 3, 3, 2, 'Credential Access, Collection', 'T1557.003 - Adversary-in-the-Middle: DHCP Spoofing', 'Detects DHCP snooping violations which may indicate attempts to perform DHCP spoofing attacks. DHCP snooping is a security feature that acts like a firewall between untrusted hosts and trusted DHCP servers. These violations could indicate malicious DHCP servers attempting to redirect network traffic or perform man-in-the-middle attacks.

Next Steps:
1. Identify the source MAC address and switch port associated with the violation
2. Check if the source is a legitimate DHCP server that needs to be added to the trusted list
3. Review DHCP bindings table to identify any rogue DHCP offers
4. Examine network traffic from the violating source for other suspicious activities
5. If confirmed malicious, block the port and investigate the physical location of the device
6. Review DHCP snooping configuration to ensure proper trusted ports are configured
', '["https://www.cisco.com/c/en/us/td/docs/switches/lan/catalyst6500/ios/15-0SY/configuration/guide/15_0_sy_swcg/dhcp_snooping.html","https://attack.mitre.org/techniques/T1557/003/"]', 'safe("log.eventType", "") == "DHCP_SNOOPING" && (safe("log.action", "") == "denied" || safe("log.action", "") == "dropped" || safe("log.violation", "") == "true" || safe("log.message", "").contains("DHCP_SNOOPING") && (safe("log.message", "").contains("dropped") || safe("log.message", "").contains("violation") || safe("log.message", "").contains("untrusted")))', '2025-09-03 13:02:47.892393', true, false, 'origin', NULL, '[]');
INSERT INTO public.utm_correlation_rules VALUES (188, 'Dynamic ARP Inspection Failure', 3, 2, 2, 'Credential Access, Collection', 'T1557.002 - ARP Cache Poisoning', 'Detects Dynamic ARP Inspection (DAI) failures which may indicate ARP spoofing attempts. DAI validates ARP packets to prevent man-in-the-middle attacks by verifying that the IP-to-MAC address bindings in ARP packets are valid.

Next Steps:
1. Identify the source MAC address and switch port associated with the failed ARP packets
2. Check if the source is a legitimate device that may have incorrect network configuration
3. Review DHCP snooping binding table to verify expected IP-MAC mappings
4. Examine switch logs for other suspicious activities from the same source
5. If malicious activity is confirmed, isolate the affected port and investigate the connected device
6. Consider implementing port security to restrict MAC addresses on the affected port
', '["https://www.cisco.com/c/en/us/td/docs/switches/lan/catalyst6500/ios/15-0SY/configuration/guide/15_0_sy_swcg/dynamic_arp_inspection.html","https://attack.mitre.org/techniques/T1557/002/"]', '(safe("log.eventType", "") == "DAI" || safe("log.eventType", "") == "ARP_INSPECTION") && (safe("log.action", "") == "drop" || safe("log.action", "") == "deny" || safe("log.result", "") == "failed" || (safe("log.message", "").contains("ARP Inspection") && (safe("log.message", "").contains("drop") || safe("log.message", "").contains("invalid") || safe("log.message", "").contains("mismatch"))))', '2025-09-03 13:02:48.552654', true, false, 'origin', NULL, '[]');
INSERT INTO public.utm_correlation_rules VALUES (205, 'Firepower Custom Detection Rule Match', 3, 3, 2, 'Threat Detection', 'Custom Rule Detection', 'Detects when Firepower custom security rules are triggered, indicating potential malicious activity that matches predefined threat patterns. These alerts represent security events that matched custom detection rules configured in the Firepower Management Center.

Next Steps:
1. Review the specific rule ID and message to understand what threat pattern was detected
2. Investigate the source IP address for additional suspicious activity
3. Check if the same source has triggered other security rules recently
4. Examine network traffic logs from the source to identify the full scope of activity
5. If confirmed malicious, consider blocking the source IP at the firewall level
6. Review and update custom detection rules if false positives are frequent
7. Correlate with other security events from the same time frame
8. Check threat intelligence feeds for known malicious indicators
', '["https://www.cisco.com/c/en/us/td/docs/security/firepower/Syslogs/b_fptd_syslog_guide/security-event-syslog-messages.html","https://attack.mitre.org/tactics/TA0001/"]', 'safe("log.message", "").contains("RULE_MESSAGE") && safe("severity", "") in ["low", "medium", "hight"] && safe("origin.ip", "") != "" && safe("log.ruleId", "") != ""', '2025-09-03 13:12:45.747192', true, false, 'origin', NULL, '[]');
INSERT INTO public.utm_correlation_rules VALUES (189, 'High Error Rate Detected on Switch', 1, 2, 3, 'Impact', 'T1498 - Network Denial of Service', 'Detects high error rates on Cisco switches which may indicate network issues, hardware problems, or potential denial of service conditions.

Next Steps:
1. Check the affected switch interface for physical connectivity issues (loose cables, damaged ports)
2. Review interface statistics (show interface [interface-name]) for CRC errors, collisions, or other anomalies
3. Verify duplex and speed settings match on both ends of the connection
4. Check for recent configuration changes on the affected interface
5. Monitor CPU and memory utilization on the switch (show processes cpu, show memory)
6. Review switch logs for additional error messages or patterns
7. If errors persist, consider temporarily disabling the interface to prevent cascading failures
8. Check for potential DoS attacks or abnormal traffic patterns targeting the switch
', '["https://www.cisco.com/c/en/us/td/docs/switches/lan/catalyst9200/software/release/17-16/configuration_guide/sys_mgmt/b_1716_sys_mgmt_9200_cg/configuring_system_message_logs.html","https://attack.mitre.org/techniques/T1498/"]', 'safe("log.severity", 0) <= 3 && (contains(safe("log.message", ""), "error rate exceed") || contains(safe("log.message", ""), "excessive errors") || contains(safe("log.message", ""), "error threshold") || safe("log.mnemonic", "") == "EXCESSIVE_ERRORS" || safe("log.mnemonic", "") == "ERR_THRESHOLD" || (safe("log.facility", "") == "LINEPROTO" && safe("log.message", "").contains("error")))', '2025-09-03 13:02:49.252806', true, false, 'origin', NULL, '[]');
INSERT INTO public.utm_correlation_rules VALUES (190, 'Interface CRC Errors Detected', 1, 3, 3, 'Impact', 'T1499 - Endpoint Denial of Service', 'Detects CRC errors on switch interfaces which may indicate cable issues, duplex mismatches, hardware failures, or physical layer attacks. CRC (Cyclic Redundancy Check) errors occur when data frames are corrupted during transmission.

Next Steps:
1. Identify the affected interface and check physical connectivity (cables, connectors, transceivers)
2. Verify duplex and speed settings match on both ends of the connection
3. Check interface statistics for other error types (collisions, giants, runts)
4. Review environmental factors (temperature, electromagnetic interference)
5. Consider replacing cables or hardware if errors persist
6. Monitor for patterns suggesting intentional disruption or attack
7. Document findings and escalate if hardware replacement is needed
', '["https://pitstop.manageengine.com/portal/en/community/topic/crc-errors-on-cisco-interfaces","https://attack.mitre.org/techniques/T1499/"]', '(safe("log.facility", "") == "LINEPROTO" || safe("log.facility", "") == "LINK" || safe("log.facility", "") == "IF") && (safe("log.message", "").contains("CRC error") || safe("log.message", "").contains("cyclic redundancy check") || safe("log.message", "").contains("input errors") || safe("log.message", "").contains("frame errors") || safe("log.mnemonic", "") == "RCVD_CRC_ERR" || safe("log.mnemonic", "") == "EXCESSIVE_CRC")', '2025-09-03 13:02:50.073429', true, false, 'target', NULL, '[]');
INSERT INTO public.utm_correlation_rules VALUES (191, 'IP Source Guard Violation', 2, 3, 1, 'Credential Access, Collection', 'T1557.002 - Adversary-in-the-Middle: ARP Cache Poisoning', 'Detects IP Source Guard violations which may indicate IP spoofing attempts. IP Source Guard provides security by filtering traffic based on DHCP snooping binding database.

Next Steps:
1. Investigate the source IP address and MAC address associated with the violation
2. Check DHCP snooping binding database for legitimate entries
3. Review recent DHCP requests from the affected interface
4. Examine switch logs for other security violations from the same source
5. Consider blocking the source MAC address if malicious activity is confirmed
6. Verify IP Source Guard configuration on the affected interface
', '["https://www.cisco.com/c/en/us/td/docs/switches/lan/catalyst6500/ios/15-0SY/configuration/guide/15_0_sy_swcg/ip_source_guard.html","https://attack.mitre.org/techniques/T1557/002/"]', '(safe("log.eventType", "") == "IPSG" || safe("log.eventType", "") == "IP_SOURCE_GUARD") && (safe("log.action", "") == "deny" || safe("log.action", "") == "drop" || safe("log.violation", "") == "true" || (safe("log.message", "").contains("IP Source Guard") && (safe("log.message", "").contains("deny") || safe("log.message", "").contains("violation") || safe("log.message", "").contains("filtered"))))', '2025-09-03 13:02:50.713274', true, false, 'origin', NULL, '[]');
INSERT INTO public.utm_correlation_rules VALUES (192, 'MAC Address Spoofing Detection', 2, 3, 1, 'Initial Access', 'MAC Spoofing', 'Detects potential MAC address spoofing attempts by monitoring for MAC address flapping between ports, duplicate MAC addresses, or MAC addresses appearing on unexpected ports. This could indicate an attacker attempting to impersonate legitimate devices.

Next Steps:
1. Identify the affected MAC address and ports involved in the flapping
2. Check if the MAC address belongs to a legitimate device that may be moving between ports
3. Review switch logs for any unauthorized configuration changes
4. Verify if port security or dynamic ARP inspection is properly configured
5. Investigate the source device and check for signs of ARP spoofing tools
6. Consider implementing port security to limit MAC addresses per port
7. Enable DHCP snooping and dynamic ARP inspection if not already configured
', '["https://www.cisco.com/c/en/us/support/docs/switches/catalyst-3750-series-switches/72846-layer2-secftrs-catl3fixed.html","https://attack.mitre.org/techniques/T1200/"]', '(safe("log.facility", "") == "SW_MATM" && safe("log.mnemonic", "") == "MACFLAP_NOTIF") || (safe("log.facility", "") == "SW_DAI" && safe("log.mnemonic", "") in ["INVALID_ARP", "DHCP_SNOOPING_DENY"]) || safe("log.message", "").matches("(?i)(mac.*flap|duplicate.*mac|mac.*move.*between.*port)") || safe("log.message", "").matches("(?i)(Host [0-9a-fA-F:.]+.*is flapping between port)") || (safe("log.severity", 0) <= 4 && safe("log.message", "").matches("(?i)(mac.*address.*conflict|duplicate.*address.*detected)"))', '2025-09-03 13:02:51.61264', true, false, 'origin', NULL, '[]');
INSERT INTO public.utm_correlation_rules VALUES (193, 'MAC Authentication Bypass Suspicious Attempts', 2, 3, 1, 'Defense Evasion, Persistence, Privilege Escalation, Initial Access', 'T1078 - Valid Accounts', 'Detects suspicious MAC Authentication Bypass (MAB) attempts including rapid authentication requests or unusual patterns that could indicate MAC spoofing or unauthorized device connection attempts. MAB allows network access based on MAC addresses when 802.1X authentication is not available, making it a potential attack vector.

Next Steps:
1. Verify if the MAC address is legitimate and belongs to an authorized device in your asset inventory
2. Check if the interface should have MAB enabled or if it''s misconfigured - review port configuration
3. Review historical authentication logs for the same MAC address to identify patterns of suspicious behavior
4. Compare the MAC address against known device inventory and approved MAC address whitelist
5. If unauthorized, immediately block the MAC address at the switch level and investigate physical port location
6. Look for other authentication attempts from the same interface or MAC address across different switches in the network
7. Consider implementing 802.1X authentication as a more secure alternative to MAB for this interface
8. Review DHCP logs to see if this MAC has been assigned an IP address recently
9. Check for concurrent authentication attempts from multiple interfaces which may indicate MAC spoofing attacks
', '["https://www.cisco.com/c/en/us/td/docs/switches/lan/catalyst9300/software/release/16-6/configuration_guide/sec/b_166_sec_9300_cg/configuring_ieee_802_1x_port_based_authentication.html","https://attack.mitre.org/techniques/T1078/"]', '(safe("log.facility", "") == "MAB" || safe("log.facility", "") == "AUTHMGR") && safe("log.mnemonic", "").contains("START") && safe("log.message", "").contains("mab") && safe("origin.mac", "") != "" && safe("target.host", "") != ""', '2025-09-03 13:02:52.333202', true, false, 'origin', NULL, '[{"indexPattern":"v11-log-cisco-switch-*","with":[{"field":"target.host.keyword","operator":"filter_term","value":"{{.target.host}}"}],"or":null,"within":"now-5m","count":10}]');
INSERT INTO public.utm_correlation_rules VALUES (194, 'Port Mirroring Configuration Change', 2, 2, 1, 'Credential Access, Discovery', 'T1040 - Network Sniffing', 'Detects port mirroring (SPAN/RSPAN) configuration changes which could indicate unauthorized network monitoring or data exfiltration attempts. Port mirroring allows traffic from one or more switch ports to be copied to another port, potentially enabling an attacker to capture sensitive network traffic.

Next Steps:
1. Verify if the configuration change was authorized by reviewing change management tickets
2. Identify the user account that made the change and confirm their authorization
3. Review the specific SPAN/RSPAN configuration to understand which ports are being monitored
4. Check if sensitive network segments are being mirrored
5. Look for any unusual data transfers from the destination port
6. Review other configuration changes made by the same account in the past 24 hours
7. If unauthorized, immediately remove the port mirroring configuration
', '["https://www.cisco.com/c/en/us/td/docs/switches/lan/catalyst6500/ios/15-0SY/configuration/guide/15_0_sy_swcg/span.html","https://attack.mitre.org/techniques/T1040/"]', '(safe("log.eventType", "") == "CONFIG" || safe("log.eventType", "") == "SPAN" || safe("log.facility", "") == "SYS") && (contains(safe("log.command", ""), "monitor session") || contains(safe("log.command", ""), "span") || contains(safe("log.command", ""), "rspan") || contains(safe("log.message", ""), "SPAN") && (contains(safe("log.message", ""), "configured") || contains(safe("log.message", ""), "created") || contains(safe("log.message", ""), "modified")))', '2025-09-03 13:06:22.633264', true, false, 'origin', '["origin.user","target.host"]', '[]');
INSERT INTO public.utm_correlation_rules VALUES (1240, 'VMware vCenter Server Attack Indicators', 3, 3, 3, 'Initial Access', 'T1190 - Exploit Public-Facing Application', 'Detects potential attacks targeting vCenter Server including authentication anomalies, privilege escalation attempts, and suspicious command execution. Monitors for indicators of compromise such as unusual SSH enablement, service modifications, and administrative group changes.

Next Steps:
1. Immediately isolate the affected vCenter Server from the network
2. Review authentication logs for suspicious login attempts
3. Check for unauthorized SSH access or administrative privilege escalations
4. Verify integrity of ESXi configurations and VIB installations
5. Scan for indicators of ransomware or malware deployment
6. Review network traffic for lateral movement attempts
7. Implement emergency access controls and change administrative passwords
8. Contact VMware security team if vulnerability exploitation is suspected
', '["https://us-cert.cisa.gov/ncas/alerts/aa22-138b","https://blogs.vmware.com/security/2022/09/esxi-targeting-ransomware-the-threats-that-are-after-your-virtual-machines-part-1.html","https://attack.mitre.org/techniques/T1190/"]', '(safe("log.message", "").contains("SSH enabled") ||
 safe("log.message", "").contains("esxcli") ||
 safe("log.message", "").contains("openssl enc") ||
 safe("log.message", "").contains("VMware admins") ||
 safe("log.message", "").contains("ESX admins") ||
 safe("log.message", "").contains("virtualization admins") ||
 safe("log.message", "").contains("storage admins") ||
 safe("log.message", "").contains("password reset") ||
 safe("log.message", "").contains("VIB install") ||
 safe("log.message", "").contains("authentication failed") ||
 (safe("log.process", "") == "vpxd" && safe("severity", "") == "error")) &&
safe("origin.hostname", "") != ""
', '2025-09-04 19:00:11.364655', true, false, 'origin', '["origin.hostname"]', '[]');
INSERT INTO public.utm_correlation_rules VALUES (1241, 'Virtual Hardware Manipulation Attack', 3, 3, 3, 'Impact', 'Data Manipulation', 'Detects attempts to manipulate virtual hardware configurations including VM snapshots, disk modifications, and configuration file tampering often associated with ransomware preparation or data destruction attacks.

Next Steps:
1. Immediately investigate the affected ESXi host and verify VM integrity
2. Check for unauthorized configuration changes using ''esxcli vm process list'' and review VM configuration files
3. Examine snapshot activity and verify if deletions were authorized
4. Review vmware.log files for signs of tampering or unauthorized modifications
5. Validate backup integrity and ensure clean recovery points are available
6. Check for signs of ransomware activity including encrypted files or ransom notes
7. Review authentication logs for unauthorized access to vSphere/ESXi management interfaces
8. Isolate affected VMs if malicious activity is confirmed
9. Implement additional monitoring for VM configuration changes
10. Consider enabling VM encryption and signed VM images for enhanced protection
', '["https://attack.mitre.org/techniques/T1565/","https://www.forescout.com/blog/vmware-esxi-servers-a-major-attack-vector-for-ransomware/","https://blogs.vmware.com/security/2022/09/esxi-targeting-ransomware-the-threats-that-are-after-your-virtual-machines-part-1.html"]', '(safe("log.message", "").matches("(?i)esxcli") && safe("log.message", "").matches("(?i)vm process kill")) ||
(safe("log.message", "").matches("(?i)\\.vmdk") && safe("log.message", "").matches("(?i)append.*1\\.vmdk")) ||
(safe("log.message", "").matches("(?i)\\.vswp") && safe("log.message", "").matches("(?i)append.*1\\.vswp")) ||
safe("log.message", "").matches("(?i)VM.*unexpectedly.*shut down") ||
(safe("log.message", "").matches("(?i)snapshot") && safe("log.message", "").matches("(?i)delete|remove")) ||
(safe("log.message", "").matches("(?i)vmware\\.log") && safe("log.message", "").matches("(?i)tamper|modify")) ||
(safe("log.message", "").matches("(?i)configuration file") && safe("log.message", "").matches("(?i)modified")) ||
safe("log.message", "").matches("(?i)esxcli.*vm.*config") ||
(safe("log.message", "").matches("(?i)timestomp") && safe("log.process", "").matches("(?i)vmkwarning"))
', '2025-09-04 19:00:46.571087', true, false, 'origin', '["origin.hostname"]', '[{"indexPattern":"v11-log-vmware-esxi-*","with":[{"field":"origin.hostname.keyword","operator":"filter_term","value":"{{.origin.hostname}}"},{"field":"log.message","operator":"filter_match","value":"esxcli"}],"or":null,"within":"now-1h","count":3}]');
INSERT INTO public.utm_correlation_rules VALUES (1242, 'Virtual Machine Sprawl Detection', 2, 1, 3, 'Impact', 'T1496 - Resource Hijacking', 'Detects potential virtual machine sprawl by monitoring rapid VM creation, excessive resource allocation, and abnormal VM lifecycle patterns. Identifies VMs that may be consuming resources without legitimate purpose or management oversight.

Next Steps:
1. Review VM creation logs and identify the user/service account responsible for VM creation
2. Verify if VM creation follows change management procedures
3. Check resource utilization patterns for newly created VMs
4. Investigate if VMs are being used for legitimate business purposes
5. Review VM naming conventions and tagging for proper classification
6. Assess overall infrastructure capacity and resource allocation policies
7. Consider implementing VM lifecycle management policies if not present
', '["https://www.manageengine.com/network-monitoring/tech-topics/how-to-prevent-vm-sprawl.html","https://www.vmware.com/docs/vsphere-esxi-vcenter-server-80-performance-best-practices","https://attack.mitre.org/techniques/T1496/"]', '(safe("log.message", "").contains("VM created") ||
 safe("log.message", "").contains("VM cloned") ||
 safe("log.message", "").contains("VM deployed") ||
 safe("log.message", "").contains("Resource allocation") ||
 safe("log.message", "").contains("Memory overcommit") ||
 safe("log.message", "").contains("CPU overcommit") ||
 safe("log.message", "").contains("Storage allocation exceeded") ||
 safe("log.message", "").contains("VM power on") ||
 (safe("log.process", "") == "hostd" && safe("log.message", "").contains("CreateVM")) ||
 (safe("log.process", "") == "vpxa" && safe("log.message", "").contains("CloneVM"))) &&
safe("origin.hostname", "") != ""
', '2025-09-04 19:00:47.241955', true, false, 'origin', '["origin.hostname"]', '[{"indexPattern":"v11-log-vmware-esxi-*","with":[{"field":"origin.hostname.keyword","operator":"filter_term","value":"{{.origin.hostname}}"},{"field":"log.message","operator":"filter_match","value":"VM created"}],"or":null,"within":"now-2h","count":10}]');
INSERT INTO public.utm_correlation_rules VALUES (1330, 'Windows: Domain controllers group changed', 3, 3, 3, 'Privilege Escalation', 'Domain Policy Modification', 'Adversaries may modify the configuration settings of a domain to evade defenses and/or escalate privileges in domain environments.  Domains provide a centralized means of managing how computer resources (ex: computers, user accounts) can act, and interact with each other, on a network.  The policy of the domain also includes configuration settings that may apply between domains in a multi-domain/forest environment.  Modifications to domain settings may include altering domain Group Policy Objects (GPOs) or changing trust settings for domains, including federation trusts.', '["https://attack.mitre.org/tactics/TA0004/","https://attack.mitre.org/techniques/T1484/"]', 'safe("log.eventDataTargetSid", "").matches("(^%{S-1-5-21(.+)-516}$|^S-1-5-21(.+)-516$)")', '2025-09-04 20:23:18.691201', true, false, 'origin', NULL, '[]');
INSERT INTO public.utm_correlation_rules VALUES (195, 'Power over Ethernet Anomaly Detected', 1, 2, 3, 'Impact', 'T1529 - System Shutdown/Reboot', 'Detects Power over Ethernet (PoE) anomalies including power budget exceeded, device power faults, or unusual power consumption patterns that may indicate hardware issues or malicious devices attempting to disrupt network operations.

Next Steps:
1. Identify the affected interface and connected device from the alert details
2. Check the switch''s current power budget utilization (show power inline)
3. Verify if the connected device is legitimate and authorized
4. Review recent power consumption trends on the affected interface
5. Investigate if multiple interfaces are experiencing similar issues (potential hardware failure)
6. Check for any recently connected devices that may be drawing excessive power
7. Consider temporarily disabling PoE on the affected interface if the issue persists
8. Document the incident and update the power budget if legitimate devices require more power
', '["https://www.cisco.com/c/en/us/td/docs/switches/lan/catalyst9300/software/release/17-16/configuration_guide/sys_mgmt/b_1716_sys_mgmt_9300_cg/configuring_system_message_logs.html","https://attack.mitre.org/techniques/T1529/"]', '(safe("log.facility", "") == "ILPOWER" || safe("log.facility", "") == "POE" || safe("log.facility", "") == "POWER") && (safe("log.message", "").contains("power budget exceeded") || safe("log.message", "").contains("power denied") || safe("log.message", "").contains("power fault") || safe("log.message", "").contains("overload condition") || safe("log.message", "").contains("PoE fault") || safe("log.message", "").contains("inline power") || safe("log.mnemonic", "") == "POWER_BUDGET_EXCEEDED" || safe("log.mnemonic", "") == "POWER_DENIED" || safe("log.mnemonic", "") == "FAULT_DETECT" || safe("log.mnemonic", "") == "OVERLOAD")', '2025-09-03 13:06:23.47291', true, false, 'target', NULL, '[]');
INSERT INTO public.utm_correlation_rules VALUES (196, 'Spanning Tree Protocol Attack Detection', 1, 2, 3, 'Impact', 'T1498 - Network Denial of Service', 'Detects potential Spanning Tree Protocol (STP) attacks including root bridge takeover attempts, BPDU spoofing, and topology change attacks. These attacks can cause network loops, denial of service, or allow traffic interception.

Next Steps:
1. Immediately identify the affected switch interface and connected device
2. Review switch logs to determine the type of STP violation (BPDU Guard, Root Guard, Loop Guard)
3. Physically trace the interface to identify the connected device
4. If BPDU Guard violation: Check if a switch/bridge was connected to an access port
5. If Root Guard violation: Investigate potential root bridge takeover attempt
6. Consider temporarily shutting down the interface if attack is ongoing
7. Review STP configuration and ensure proper security features are enabled (BPDU Guard on access ports, Root Guard on uplinks)
8. Check for any network instability or loops that may have occurred
9. Document the incident and update network diagrams if unauthorized devices were found
', '["https://www.cisco.com/c/en/us/support/docs/lan-switching/spanning-tree-protocol/10556-16.html","https://attack.mitre.org/techniques/T1498/"]', '(safe("log.facility", "") == "SPANTREE" && safe("log.mnemonic", "") in ["BLOCK_BPDUGUARD", "RECV_1Q_NON_TRUNK", "ROOTGUARD_BLOCK", "LOOPGUARD_BLOCK"]) || (safe("log.facility", "") == "SPANTREE" && safe("log.mnemonic", "") in ["INCONSISTENCY", "PVID_MISMATCH", "TYPE_MISMATCH"]) || (safe("log.message", "").matches("(?i)(bpdu.*guard.*violation|received.*bpdu.*on.*bpduguard.*enabled)")) || (safe("log.message", "").matches("(?i)(root.*guard.*blocking|topology.*change.*notification|inferior.*bpdu.*received)")) || (safe("log.message", "").matches("(?i)(spanning.*tree.*loop|stp.*inconsistent|port.*type.*inconsistent)")) || (safe("log.severity", 0) <= 3 && safe("log.message", "").matches("(?i)(stp.*attack|bpdu.*flood|root.*bridge.*change)"))', '2025-09-03 13:06:24.372254', true, false, 'origin', NULL, '[]');
INSERT INTO public.utm_correlation_rules VALUES (197, 'Stack Member Failures Detection', 1, 2, 3, 'Impact', 'T1489 - Service Stop', 'Detects failures in Cisco switch stack members, which could indicate hardware issues, configuration problems, or potential denial of service conditions affecting network availability.

Next Steps:
1. Verify the current stack status by logging into the affected switch and running "show switch" command
2. Check the physical connections between stack members for loose or damaged cables
3. Review recent configuration changes that might have affected stack operations
4. Examine system logs for hardware errors or power supply issues
5. If a member is consistently failing, consider replacing the hardware or stack cables
6. Document the incident and any remediation steps taken for future reference
', '["https://www.cisco.com/c/en/us/td/docs/switches/lan/catalyst3750/software/release/12-2_58_se/configuration/guide/3750scg/swstack.html","https://attack.mitre.org/techniques/T1489/"]', 'safe("log.facility", "") == "STACKMGR" && (safe("log.message", "").contains("stack member") && (safe("log.message", "").contains("fail") || safe("log.message", "").contains("down") || safe("log.message", "").contains("removed") || safe("log.message", "").contains("lost"))) || (safe("log.severity", 0) <= 3 && safe("log.message", "").contains("STACKMGR"))', '2025-09-03 13:06:25.113175', true, false, 'origin', '["origin.hostname","log.facility"]', '[]');
INSERT INTO public.utm_correlation_rules VALUES (198, 'Storm Control Triggered', 1, 2, 3, 'Impact', 'T1498 - Network Denial of Service', 'Detects storm control triggers which may indicate broadcast, multicast, or unicast storms that could be part of a DoS attack or network misconfiguration.

Next Steps:
1. Identify the affected interface and storm type from the alert details
2. Review current storm control thresholds on the affected interface
3. Check interface statistics for abnormal traffic patterns or packet counts
4. Investigate the source of the storm (broadcast, multicast, or unicast)
5. Review recent configuration changes on the switch or connected devices
6. Check for malfunctioning network cards or misconfigured devices
7. Consider temporarily increasing storm control thresholds if legitimate traffic is being blocked
8. Document the incident and update storm control policies if necessary
', '["https://www.cisco.com/c/en/us/td/docs/switches/lan/catalyst6500/ios/15-0SY/configuration/guide/15_0_sy_swcg/storm_control.html","https://attack.mitre.org/techniques/T1498/"]', '(safe("log.eventType", "") == "STORM_CONTROL" || safe("log.facility", "").contains("STORM")) && (safe("action", "") == "shutdown" || safe("action", "") == "trap" || safe("log.status", "") == "exceeded" || (safe("log.message", "").contains("storm control") && (safe("log.message", "").contains("exceeded") || safe("log.message", "").contains("shutdown") || safe("log.message", "").contains("threshold"))))', '2025-09-03 13:06:25.613429', true, false, 'origin', '["log.interface","log.stormType"]', '[]');
INSERT INTO public.utm_correlation_rules VALUES (199, 'Unauthorized SNMP Access Attempt', 3, 2, 1, 'Credential Access', 'T1110 - Brute Force', 'Detects unauthorized SNMP access attempts on Cisco switches by monitoring for authentication failures or invalid community string usage. This could indicate an attacker attempting to gain unauthorized access to network device configuration and monitoring capabilities.

Next Steps:
1. Verify if the source IP address is authorized to access SNMP on this device
2. Check SNMP configuration to ensure strong community strings are in use
3. Review switch logs for any successful SNMP connections from the same source
4. Consider implementing SNMP v3 with proper authentication and encryption
5. If unauthorized, block the source IP at the network perimeter
6. Document the incident and update SNMP access control lists accordingly
', '["https://www.cisco.com/c/en/us/td/docs/ios-xml/ios/snmp/configuration/xe-16/snmp-xe-16-book/nm-snmp-cfg-snmp-support.html","https://attack.mitre.org/techniques/T1110/"]', 'safe("log.facility", "") == "SNMP" && (safe("log.mnemonic", "") == "AUTHFAIL" || safe("log.mnemonic", "") == "INPUT_QFULL_ERR" || safe("log.message", "").contains("authentication failure") || safe("log.message", "").contains("invalid community") || safe("log.message", "").contains("unauthorized SNMP"))', '2025-09-03 13:06:26.752897', true, false, 'origin', '["origin.ip"]', '[]');
INSERT INTO public.utm_correlation_rules VALUES (200, 'VLAN Hopping Attack Detection', 3, 3, 2, 'Defense Evasion', 'T1599 - Network Boundary Bridging', 'Detects potential VLAN hopping attacks through switch spoofing or double tagging. Monitors for DTP negotiation attempts, trunk port changes, or multiple VLAN tags that could indicate an attacker trying to gain unauthorized access to other VLANs.

Next Steps:
1. Immediately identify the affected switch port and connected device
2. Review switch configuration for DTP enabled ports and disable where not needed
3. Check trunk port configurations and ensure proper native VLAN settings
4. Verify VLAN access lists and ensure proper segmentation
5. Investigate the source MAC address for any previous suspicious activity
6. Review network topology to assess potential lateral movement paths
7. Consider implementing VLAN ACLs or private VLANs for additional protection
8. Document the incident and update switch hardening procedures
', '["https://www.cisco.com/c/en/us/support/docs/switches/catalyst-3750-series-switches/72846-layer2-secftrs-catl3fixed.html","https://attack.mitre.org/techniques/T1599/"]', '(safe("log.facility", "") == "SW_VLAN" && safe("log.mnemonic", "") in ["VLAN_INCONSISTENCY", "MACFLAP_NOTIF", "TRUNK_MODE_CHANGE"]) || (safe("log.facility", "") == "DTP" && safe("log.mnemonic", "") in ["NONTRUNKPORTON", "DOMAINMISMATCH", "TRUNKPORTON"]) || (safe("log.message", "").matches("(?i)(received 802.1Q BPDU on non trunk|native vlan mismatch|inconsistent vlan|double tag)")) || (safe("log.severity", 999) <= 4 && safe("log.message", "").matches("(?i)(vlan.*tag.*tag|switch.*spoofing|dtp.*negotiation)")))', '2025-09-03 13:06:27.993341', true, false, 'origin', NULL, '[]');
INSERT INTO public.utm_correlation_rules VALUES (201, 'VSS Split-Brain Detection', 1, 3, 3, 'Impact', 'T1529 - System Shutdown/Reboot', 'Detects Virtual Switching System (VSS) split-brain conditions where both switches in a VSS pair become active simultaneously, causing network instability and potential data corruption. This is a critical condition that can lead to network loops, broadcast storms, and service disruption.

Next Steps:
1. Immediately check the VSS status on both switches using ''show switch virtual'' command
2. Verify VSL (Virtual Switch Link) connectivity between the switches
3. Check for any physical VSL link failures or disconnections
4. Review recent configuration changes that might have affected VSS operation
5. If split-brain is confirmed, follow Cisco''s recovery procedure to restore proper VSS operation
6. Consider implementing dual-active detection mechanisms if not already configured
7. Document the incident and review VSS redundancy design for improvements
8. Monitor for additional related VSS events in the following minutes
9. Check network topology for any loops or broadcast storms that may have resulted
10. Validate that backup systems and failover mechanisms are functioning properly
', '["https://www.cisco.com/c/en/us/support/docs/switches/catalyst-6500-virtual-switching-system-1440/109638-vss-pf-tshoot.html","https://attack.mitre.org/techniques/T1529/"]', '(safe("log.facility", "") == "VSL" || safe("log.facility", "") == "VSS") && (safe("log.message", "").contains("split-brain") || safe("log.message", "").contains("dual-active") || safe("log.message", "").contains("both active") || (safe("log.message", "").contains("VSL") && safe("log.message", "").contains("down")) || (safe("log.message", "").contains("peer") && safe("log.message", "").contains("lost"))) && safe("log.severity", 0) <= 4', '2025-09-03 13:06:28.593036', true, false, 'origin', NULL, '[]');
INSERT INTO public.utm_correlation_rules VALUES (202, 'Advanced Malware Protection (AMP) Alert Detection', 3, 3, 2, 'Initial Access', 'T1566 - Phishing', 'Detects when Cisco Firepower Advanced Malware Protection (AMP) identifies malware or malicious files, including retrospective detections and high threat score files. This rule triggers on various malware dispositions including confirmed malware, custom detections, retrospective malware (files later identified as malicious), and files with high threat scores (>=70).

Next Steps:
1. Identify the affected host using the origin.ip and log.deviceName fields
2. Review the file hash (log.sha256) in threat intelligence databases
3. Check if the malware was successfully blocked or if remediation is needed
4. Look for lateral movement attempts from the affected host
5. Verify if other hosts accessed the same malicious file
6. Consider isolating the affected system if malware execution is confirmed
7. Review the file trajectory to understand the infection vector
8. Update endpoint protection rules to prevent similar infections
', '["https://www.cisco.com/c/en/us/td/docs/security/firepower/70/configuration/guide/fpmc-config-guide-v70/file_malware_events_and_network_file_trajectory.html","https://attack.mitre.org/techniques/T1566/"]', 'safe("log.eventType", "") == "MALWARE_EVENT" && (safe("log.disposition", "") == "MALWARE" || safe("log.disposition", "") == "CUSTOM_DETECTION" || safe("log.disposition", "") == "RETROSPECTIVE_MALWARE" || safe("log.threatScore", 0) >= 70)', '2025-09-03 13:12:42.967215', true, false, 'origin', NULL, '[]');
INSERT INTO public.utm_correlation_rules VALUES (203, 'Cloud Security Analytics Event Detection', 3, 2, 2, 'Discovery', 'T1526 - Cloud Service Discovery', 'Detects cloud security analytics events including suspicious cloud API usage, unauthorized cloud resource access, and cloud-based threat indicators from SecureX integration. This rule monitors for high-severity cloud security events, blocked actions, and alerts from Cisco''s cloud security services.

Next Steps:
1. Review the specific cloud service and API call that triggered the alert
2. Verify if the source IP and user account are authorized to perform the action
3. Check the cloud provider''s activity logs for additional context
4. If unauthorized, investigate potential compromise of cloud credentials
5. Review other activities from the same source IP or user in the past 24 hours
6. Consider blocking the source IP if malicious activity is confirmed
7. Update cloud security policies to prevent similar incidents
', '["https://www.cisco.com/c/en/us/products/security/securex.html","https://attack.mitre.org/techniques/T1526/"]', '(safe("log.eventType", "") == "CLOUD_SECURITY_EVENT" || safe("log.eventType", "") == "SECUREX_EVENT" || safe("log.source", "") contains "SecureX" || safe("log.source", "") contains "Umbrella" || safe("log.category", "") == "Cloud Security") && (safe("action", "") == "BLOCKED" || safe("action", "") == "ALERT" || safe("severity", "") in ["HIGH", "CRITICAL"] || safe("log.cloudProvider", "") != "" || safe("log.cloudService", "") != "" || safe("log.apiCall", "") != "")', '2025-09-03 13:12:44.006293', true, false, 'origin', NULL, '[]');
INSERT INTO public.utm_correlation_rules VALUES (204, 'Compliance Policy Violation Detection', 2, 3, 1, 'Defense Evasion, Persistence, Privilege Escalation, Initial Access', 'T1078 - Valid Accounts', 'Detects when hosts or users violate compliance policies including whitelist violations, unauthorized software installations, or configuration compliance failures on Cisco Firepower devices.

Next Steps:
1. Review the specific violation type and affected system in the alert details
2. Check if the violation is due to unauthorized software installation or configuration change
3. Verify if the system should be exempt from this policy
4. If legitimate, update compliance policies or whitelist; if not, remediate the violation
5. Review recent changes or activities on the affected system
6. Document the incident and remediation actions taken
', '["https://www.cisco.com/c/en/us/td/docs/security/firepower/60/configuration/guide/fpmc-config-guide-v60/Correlation_and_Compliance_Events.html","https://attack.mitre.org/techniques/T1078/"]', '(safe("log.eventType", "") == "COMPLIANCE_EVENT" || safe("log.eventType", "") == "WHITE_LIST_EVENT") && (safe("log.complianceStatus", "") == "NON_COMPLIANT" || safe("log.whiteListViolation", "") != "" || safe("action", "") == "VIOLATION") && safe("log.violationType", "") != ""', '2025-09-03 13:12:44.82641', true, false, 'origin', NULL, '[]');
INSERT INTO public.utm_correlation_rules VALUES (206, 'DNS Security Alert Detection', 3, 2, 1, 'Command and Control', 'T1071.004 - Application Layer Protocol: DNS', 'Detects DNS security alerts including DNS blocks, DNS query anomalies, DNS response mismatches, and suspicious DNS resolution attempts. These alerts may indicate command and control communication, DNS tunneling, or attempts to resolve known malicious domains.

Next Steps:
1. Review the blocked DNS query to determine if it''s attempting to resolve a known malicious domain
2. Check if the source IP is making repeated DNS queries to suspicious domains
3. Investigate the process or application making the DNS request on the source system
4. Review DNS query patterns from the source IP for signs of DNS tunneling (unusually long domain names, high frequency)
5. Cross-reference the queried domain with threat intelligence feeds
6. If confirmed malicious, isolate the affected system and perform a full security scan
7. Check for any established connections to the resolved IP addresses
8. Review firewall logs for any blocked or allowed traffic to the suspicious domain
', '["https://www.cisco.com/c/en/us/td/docs/security/firepower/Syslogs/b_fptd_syslog_guide/security-event-syslog-messages.html","https://attack.mitre.org/techniques/T1071/004/"]', '(safe("log.eventType", "") == "DNS_BLOCK" || safe("log.eventType", "") == "DNS_MONITOR" || safe("log.reason", "") == "DNS Monitor" || safe("log.reason", "") == "DNS Block") || (safe("log.message", "").contains("DNS lookup failed") || safe("log.message", "").contains("DNS responses with mis-matched id") || safe("log.message", "").contains("Deny inbound UDP") && safe("log.message", "").contains("DNS")) || (safe("log.DNSSICategory", "") != "" && (safe("log.DNSSICategory", "").contains("Block list") || safe("log.DNSSICategory", "").contains("Intelligence Feed") || safe("log.DNSSICategory", "").contains("TID category")))', '2025-09-03 13:12:46.446962', true, false, 'origin', NULL, '[]');
INSERT INTO public.utm_correlation_rules VALUES (207, 'Email Security Alert Detection', 3, 3, 2, 'Initial Access', 'T1566 - Phishing', 'Detects email security alerts including malicious attachments, phishing attempts, spam detection, and email-based malware distribution in Cisco Firepower logs. This rule triggers when email protocols (SMTP, POP3, IMAP) are used with malware or intrusion events detected.

Next Steps:
1. Identify the sender and recipient email addresses from the alert details
2. Check if the malicious email was delivered or blocked by reviewing the disposition field
3. Search for other emails from the same sender IP or with the same file hash
4. If malware was detected, identify the file hash and check if other users received similar attachments
5. Consider blocking the sender IP/domain at the email gateway if multiple incidents are confirmed
6. Review user mailboxes for any delivered malicious content and initiate remediation if needed
7. Update email security policies to prevent similar threats
', '["https://www.cisco.com/c/en/us/td/docs/security/firepower/640/configuration/guide/fpmc-config-guide-v64/file_malware_events_and_network_file_trajectory.html","https://attack.mitre.org/techniques/T1566/"]', '(safe("protocol", "") == "SMTP" || safe("protocol", "") == "POP3" || safe("protocol", "") == "IMAP") && (safe("log.disposition", "") == "MALWARE" || safe("log.disposition", "") == "CUSTOM_DETECTION" || safe("log.eventType", "") == "FILE_MALWARE_EVENT" || safe("log.eventType", "") == "INTRUSION_EVENT") && (safe("target.port", 0.0) == double(25) || safe("target.port", 0.0) == double(110) || safe("target.port", 0.0) == double(143) || safe("target.port", 0.0) == double(465) || safe("target.port", 0.0) == double(587) || safe("target.port", 0.0) == double(993) || safe("target.port", 0.0) == double(995))', '2025-09-03 13:12:47.147117', true, false, 'origin', NULL, '[]');
INSERT INTO public.utm_correlation_rules VALUES (208, 'Encrypted Visibility Engine (EVE) Malicious Traffic Detection', 3, 3, 2, 'Command and Control', 'T1573 - Encrypted Channel', 'Detects when Encrypted Visibility Engine identifies malicious encrypted traffic based on TLS fingerprinting, threat scores, and machine learning analysis without decryption.

Next Steps:
1. Review the TLS fingerprint and threat score details to understand the nature of the threat
2. Check if the source IP has been involved in other suspicious activities
3. Investigate the destination IP/domain reputation in threat intelligence sources
4. Review network flows to/from the affected host for additional indicators
5. If confirmed malicious, consider blocking the source IP and destination
6. Check for lateral movement or data exfiltration attempts from the source host
', '["https://secure.cisco.com/secure-firewall/docs/encrypted-visibility-engine","https://attack.mitre.org/techniques/T1573/"]', 'safe("log.eventType", "") == "EVE_EVENT" && (safe("log.eveThreatScore", 0) >= 70 || safe("log.eveDisposition", "") == "MALICIOUS" || safe("log.eveAction", "") == "BLOCK") && (safe("log.tlsFingerprint", "") != "" || safe("log.encryptedMalwareConfidence", 0) >= 80)', '2025-09-03 13:12:47.966454', true, false, 'origin', NULL, '[]');
INSERT INTO public.utm_correlation_rules VALUES (209, 'Endpoint Security Integration Event Detection', 3, 3, 2, 'Execution', 'T1204: User Execution', 'Detects endpoint security integration events from AMP for Endpoints including file execution alerts, process anomalies, and endpoint compromise indicators. These events indicate potential malware execution or system compromise on endpoints monitored by Cisco AMP integration with Firepower.

Next Steps:
1. Review the specific threat details including file hash, process name, and threat score
2. Check if the affected endpoint has other recent security events or anomalies
3. Verify if the file hash is known malware in threat intelligence databases
4. Isolate the affected endpoint if active malware is confirmed
5. Collect forensic data from the endpoint including process tree and network connections
6. Review user activity on the affected system around the time of detection
7. Check for lateral movement attempts from the compromised endpoint
8. Update endpoint protection policies if new threat patterns are identified
', '["https://www.cisco.com/c/en/us/td/docs/security/firepower/620/configuration/guide/fpmc-config-guide-v62/file_malware_events_and_network_file_trajectory.html","https://attack.mitre.org/techniques/T1204/"]', '(safe("log.eventType", "") == "AMP_EVENT" || safe("log.eventType", "") == "ENDPOINT_EVENT" || safe("log.eventSource", "").contains("AMP for Endpoints") || safe("log.detectionEngine", "") == "AMP") && (safe("log.disposition", "") == "MALWARE" || safe("log.disposition", "") == "CUSTOM_DETECTION" || safe("log.disposition", "") == "RETROSPECTIVE_MALWARE" || safe("log.eventSubtype", "") == "THREAT_DETECTED" || safe("log.eventSubtype", "") == "THREAT_QUARANTINED" || safe("log.eventSubtype", "") == "BLOCKED_EXECUTION" || safe("log.threatScore", 0) >= 70)', '2025-09-03 13:12:48.806391', true, false, 'origin', NULL, '[]');
INSERT INTO public.utm_correlation_rules VALUES (239, 'Azure Event Hub Authorization Rule Created or Updated', 1, 2, 3, 'Cloud Storage Object', 'Collection', 'Identifies when an Event Hub Authorization Rule is created or updated in Azure.  An authorization rule is associated with specific rights, and carries a pair of cryptographic keys.  When you create an Event Hubs namespace, a policy rule named RootManageSharedAccessKey is created for the namespace.  This has manage permissions for the entire namespace and it''s recommended that you treat this rule like an  administrative root account and don''''t use it in your application.', '["https://attack.mitre.org/tactics/TA0009/","https://attack.mitre.org/techniques/T1537/","https://attack.mitre.org/tactics/TA0010/"]', 'safe("log.resourceProviderNameValue", "").contains("azure.activitylogs") && safe("log.operationNameValue", "").contains("MICROSOFT.EVENTHUB/NAMESPACES/AUTHORIZATIONRULES/WRITE") && safe("log.statusValue", "").contains("Succeeded")', '2025-09-03 13:19:27.046866', true, false, 'target', NULL, '[]');
INSERT INTO public.utm_correlation_rules VALUES (210, 'File Policy Violations and Suspicious File Transfers', 3, 2, 1, 'Exfiltration', 'T1048 - Exfiltration Over Alternative Protocol', 'Detects file policy violations including blocked file types, oversized files, or attempts to transfer prohibited content that may indicate data exfiltration or policy bypass attempts.

Next Steps:
1. Identify the source IP and user attempting the file transfer
2. Review the blocked file types and sizes to determine if legitimate business need exists
3. Check for patterns of repeated attempts from the same source
4. Investigate if the file transfers are to external destinations
5. Review file hashes (SHA256) against threat intelligence sources
6. Check if the source system shows signs of compromise
7. Verify if the user has legitimate access to the attempted files
', '["https://www.cisco.com/c/en/us/td/docs/security/firepower/640/configuration/guide/fpmc-config-guide-v64/file_policies_and_advanced_malware_protection.html","https://attack.mitre.org/techniques/T1048/"]', 'safe("log.eventType", "") == "FILE_EVENT" && (safe("log.fileAction", "") == "BLOCK" || safe("log.fileAction", "") == "RESET_BOTH" || (safe("log.fileType", "") in ["EXECUTABLE", "ARCHIVE", "ENCRYPTED"] && safe("log.fileSize", 0) > 10485760) || safe("log.fileStorageStatus", "") == "POLICY_VIOLATION")', '2025-09-03 13:12:49.626946', true, false, 'origin', NULL, '[]');
INSERT INTO public.utm_correlation_rules VALUES (211, 'Intrusion Prevention System High Priority Events', 3, 3, 3, 'Execution', 'T1203 - Exploitation for Client Execution', 'Detects high priority IPS events from Cisco Firepower indicating potential exploitation attempts, zero-day attacks, or critical vulnerabilities being targeted. These events represent immediate threats that require urgent investigation.

Next Steps:
1. Immediately isolate the affected system if the attack was successful
2. Review the specific signature ID and classification to understand the attack vector
3. Check if the target system shows signs of compromise (unusual processes, network connections, file modifications)
4. Analyze firewall logs to determine if the attack was blocked or if any malicious traffic passed through
5. Search for similar attempts from the same source IP across other systems
6. Update IPS signatures and ensure all systems are patched against the exploited vulnerability
7. Consider blocking the source IP if it shows persistent malicious behavior
8. Document the incident and update security controls based on findings
', '["https://www.cisco.com/c/en/us/td/docs/security/secure-firewall/management-center/device-config/710/management-center-device-config-71/intrusion-overview.html","https://attack.mitre.org/techniques/T1203/"]', 'safe("log.eventType", "") == "IPS_EVENT" && (safe("log.priority", 0.0) == double(1) || safe("log.severity", 0) <= 2 || safe("log.impact", "") == "HIGH" || safe("log.classification", "").contains("attempted-admin") || safe("log.classification", "").contains("attempted-user") || safe("log.classification", "").contains("web-application-attack") || safe("log.classification", "").contains("exploit-kit"))', '2025-09-03 13:12:50.466781', true, false, 'origin', NULL, '[]');
INSERT INTO public.utm_correlation_rules VALUES (212, 'Firepower IOC (Indicator of Compromise) Detection', 3, 3, 2, 'Initial Access', 'T1566 - Phishing', 'Detects when Firepower identifies an Indicator of Compromise (IOC), indicating a host may be infected with malware or compromised. IOCs can include file hashes, malware signatures, or behavioral patterns that suggest malicious activity.

Next Steps:
1. Immediately isolate the affected host from the network to prevent lateral movement
2. Review the specific IOC details including threat name, SHA256 hash, and file path
3. Search for the same IOC across other endpoints in your environment
4. Check if the affected host has made any suspicious network connections recently
5. Collect memory dumps and disk images for forensic analysis if required
6. Review user activity logs to identify potential initial compromise vector
7. Update antivirus signatures and threat intelligence feeds with new IOC data
8. Perform deep scan of the affected system and related network segments
9. Consider reimaging the affected system after complete evidence collection
10. Update security controls to prevent similar future compromises
', '["https://www.cisco.com/c/en/us/td/docs/security/firepower/70/configuration/guide/fpmc-config-guide-v70/file_malware_events_and_network_file_trajectory.html","https://attack.mitre.org/tactics/TA0040/","https://attack.mitre.org/techniques/T1566/"]', '(safe("log.eventType", "") == "AMP_IOC" || safe("log.eventType", "") == "IOC_DETECTED" || safe("log.message", "").contains("indication of compromise") || safe("log.message", "").contains("IOC")) && safe("origin.ip", "") != "" && (safe("log.threatName", "") != "" || safe("log.sha256", "") != "" || safe("log.fileName", "") != "")', '2025-09-03 13:13:32.747471', true, false, 'origin', NULL, '[]');
INSERT INTO public.utm_correlation_rules VALUES (213, 'Network Behavior Anomaly Detection', 2, 2, 1, 'Discovery', 'T1046 - Network Service Discovery', 'Detects network behavior anomalies including unusual traffic patterns, protocol anomalies, suspicious connection rates, or deviations from baseline network behavior. This rule identifies potential reconnaissance activities and abnormal network usage patterns.

Next Steps:
1. Review the specific anomaly type and score to understand the nature of the deviation
2. Check if the source IP has any legitimate business reason for the unusual behavior
3. Investigate the destination systems targeted by the anomalous traffic
4. Correlate with threat intelligence feeds to check if the source IP is known malicious
5. Review firewall logs for any blocked connection attempts from the same source
6. Examine network flow data to understand the scope and pattern of the anomalous behavior
7. Check for signs of lateral movement or data exfiltration following the anomaly
8. Consider implementing rate limiting or blocking the source IP if malicious activity is confirmed
9. Update network baselines if the behavior is determined to be legitimate business activity
10. Monitor for similar patterns from other sources that might indicate a coordinated attack
', '["https://www.cisco.com/c/en/us/td/docs/security/firepower/640/fdm/fptd-fdm-config-guide-640/fptd-fdm-intrusion.html","https://attack.mitre.org/techniques/T1046/"]', '(safe("log.eventType", "") == "ANOMALY_EVENT" || safe("log.eventType", "") == "NBA_EVENT") && (safe("log.anomalyScore", 0) >= 70 || safe("log.deviationFromBaseline", 0) >= 3.0 || safe("log.connectionRate", 0) > safe("log.baselineConnectionRate", 0) * 5) && (safe("log.anomalyType", "") != "" || safe("log.protocolAnomaly", false) == true)', '2025-09-03 13:13:33.565931', true, false, 'origin', NULL, '[]');
INSERT INTO public.utm_correlation_rules VALUES (214, 'Network Discovery Anomalies Detection', 2, 1, 1, 'Discovery', 'T1046 - Network Service Discovery', 'Detects unusual network discovery activities including rapid host scanning, service enumeration, or abnormal discovery patterns that may indicate reconnaissance activities on Cisco Firepower devices.

Next Steps:
1. Review the source IP address to determine if it belongs to authorized security scanners or IT systems
2. Check if the scanning activity correlates with scheduled network discovery or vulnerability assessments
3. Examine the targeted networks and services to identify what information the scanner may have gathered
4. Look for subsequent exploitation attempts from the same source IP within the next 24-48 hours
5. Review firewall logs for any blocked connection attempts or policy violations from the scanning IP
6. If unauthorized, consider implementing temporary IP blocking and investigate potential compromise of the scanning system
7. Document the discovery pattern for threat hunting across other network segments and similar timeframes
8. Correlate with endpoint detection systems to identify any internal systems that may be compromised
9. Review network topology changes that might have triggered legitimate discovery events
', '["https://www.cisco.com/c/en/us/td/docs/security/firepower/70/configuration/guide/fpmc-config-guide-v70/correlation_and_compliance_events.html","https://attack.mitre.org/techniques/T1046/"]', '(safe("log.eventType", "") == "DISCOVERY_EVENT" || safe("log.eventType", "") == "HOST_DISCOVERY" || safe("log.eventType", "") == "NEW_HOST" || safe("log.eventType", "") == "NEW_SUBNET") && (safe("log.discoveryType", "") == "SCAN" || safe("log.discoveryType", "") == "PORT_SCAN" || safe("log.discoveryType", "") == "SERVICE_SCAN" || safe("log.scanRate", 0) > 100)', '2025-09-03 13:13:34.414684', true, false, 'origin', NULL, '[]');
INSERT INTO public.utm_correlation_rules VALUES (215, 'Firepower Retrospective Malware Detection', 3, 3, 2, 'Defense Evasion, Privilege Escalation', 'T1055 - Process Injection', 'Detects when Firepower identifies a file retrospectively as malware after disposition change, indicating delayed threat identification. This occurs when a file initially deemed safe is later determined to be malicious based on updated threat intelligence.

Next Steps:
1. Immediately isolate the affected host(s) where the file was detected
2. Search for all occurrences of the SHA256 hash across the network
3. Review the file trajectory to identify:
   - Initial download/transfer source
   - All hosts that received or executed the file
   - Time elapsed between initial detection and retrospective identification
4. Check if the file has been executed on any systems
5. Initiate incident response procedures if execution is confirmed
6. Update security controls to block the identified hash
7. Review why initial detection failed and adjust policies if needed
8. Search for similar files or variants using fuzzy hashing
', '["https://www.cisco.com/c/en/us/td/docs/security/firepower/70/configuration/guide/fpmc-config-guide-v70/file_malware_events_and_network_file_trajectory.html","https://attack.mitre.org/techniques/T1055/"]', '(safe("log.eventType", "") == "RETROSPECTIVE_MALWARE" || safe("log.eventType", "") == "MALWARE_DISPOSITION_CHANGED" || safe("log.message", "") contains "retrospective" || safe("log.message", "") contains "disposition changed") && (safe("log.disposition", "") in ["MALWARE", "MALICIOUS"] || safe("log.newDisposition", "") in ["MALWARE", "MALICIOUS"]) && safe("log.origin.ip", "") != "" && safe("log.sha256", "") != ""', '2025-09-03 13:13:34.986685', true, false, 'origin', NULL, '[]');
INSERT INTO public.utm_correlation_rules VALUES (216, 'SSL/TLS Decryption Policy Bypass Attempts', 3, 3, 1, 'Command and Control', 'T1573 - Encrypted Channel', 'Detects attempts to bypass SSL/TLS decryption policies, including certificate validation failures, untrusted certificates, or connections that could not be decrypted. This may indicate malicious actors attempting to hide their communications or evade security monitoring.

Next Steps:
1. Investigate the source IP address for reputation and previous malicious activity
2. Review the destination IP/domain to determine if it''s a known malicious or suspicious site
3. Check the SSL certificate details (fingerprint, issuer, CN) for indicators of compromise
4. Analyze the decryption failure reason to understand if this is a configuration issue or intentional evasion
5. Look for other SSL/TLS anomalies from the same source in recent timeframe
6. If self-signed or invalid certificates are detected, verify if they''re expected for internal applications
7. Consider implementing stricter SSL/TLS policies for suspicious certificate characteristics
8. Document the incident and update SSL decryption policies if necessary
', '["https://www.cisco.com/c/en/us/td/docs/security/firepower/70/configuration/guide/fpmc-config-guide-v70/ssl_tls_decryption.html","https://attack.mitre.org/techniques/T1573/"]', 'safe("log.eventType", "") == "SSL_EVENT" && ((safe("log.sslAction", "") == "DO_NOT_DECRYPT" && safe("log.sslReason", "") != "POLICY_MATCH") || (safe("log.sslCertStatus", "").contains("INVALID") || safe("log.sslCertStatus", "").contains("EXPIRED") || safe("log.sslCertStatus", "").contains("SELF_SIGNED") || safe("log.sslCertStatus", "").contains("UNTRUSTED")) || safe("log.sslFailureReason", "") != "" || safe("log.sslFlowStatus", "") == "ERROR")', '2025-09-03 13:13:35.807082', true, false, 'origin', NULL, '[]');
INSERT INTO public.utm_correlation_rules VALUES (217, 'Threat Hunting Query Results Detection', 3, 3, 2, 'Discovery', 'T1057 - Process Discovery', 'Detects significant threat hunting query results including advanced correlation matches, multi-product threat indicators, and high-confidence IOC matches from Cisco Threat Response.

Next Steps:
1. Review the specific threat indicators or IOCs that triggered the alert
2. Check the correlation rule name and confidence score to understand the threat type
3. Investigate the source IP address for other suspicious activities
4. If multi-product matches are present, correlate findings across all affected systems
5. Examine related events within the same time window for additional context
6. Consider blocking the IOC if confidence is high and impact is significant
7. Document the threat hunting findings for future reference
', '["https://blogs.cisco.com/security/with-cisco-threat-response-the-best-things-in-threat-hunting-are-free","https://attack.mitre.org/techniques/T1057/"]', '(safe("log.eventType", "") == "THREAT_HUNTING_RESULT" || safe("log.eventType", "") == "CORRELATION_EVENT" || safe("log.eventType", "") == "THREAT_RESPONSE_EVENT" || safe("log.source", "").contains("Threat Response") || safe("log.correlationRule", "") != "") && (safe("log.threatConfidence", 0) >= 75 || safe("log.correlationCount", 0) >= 3 || safe("log.iocMatch", false) == true || safe("log.multiProductMatch", false) == true || safe("log.matchedProducts", "").size() >= 2))', '2025-09-03 13:13:36.626482', true, false, 'origin', NULL, '[]');
INSERT INTO public.utm_correlation_rules VALUES (240, 'Azure Key Vault Modified', 3, 3, 2, 'Unsecured Credentials', 'Credential Access', 'Identifies modifications to a Key Vault in Azure. The Key Vault is a service that safeguards encryption keys and secrets like certificates,  connection strings, and passwords. Because this data is sensitive and business critical, access to key vaults should be secured to allow  only authorized applications and users.', '["https://attack.mitre.org/techniques/T1552/","https://attack.mitre.org/tactics/TA0006/"]', 'safe("log.resourceProviderNameValue", "").contains("azure.activitylogs") && safe("log.operationNameValue", "").contains("MICROSOFT.KEYVAULT/VAULTS/WRITE") && safe("log.statusValue", "").contains("Succeeded")', '2025-09-03 13:19:27.86583', true, false, 'target', NULL, '[]');
INSERT INTO public.utm_correlation_rules VALUES (218, 'Threat Intelligence Director (TID) Alert Detection', 3, 3, 2, 'Command and Control', 'T1071.001 - Application Layer Protocol: Web Protocols', 'Detects when Cisco Firepower Threat Intelligence Director identifies connections to known malicious indicators including IPs, domains, URLs, and SHA256 hashes from threat feeds. This rule triggers when TID blocks or would block connections based on threat intelligence matches with high confidence scores.

Next Steps:
- Immediately isolate the affected system if the connection was not blocked
- Review the specific threat indicator (IP/domain/URL/hash) that triggered the alert
- Check the threat category and score to understand the severity
- Investigate all recent network activity from the source IP address
- Search for similar indicators across other systems in the network
- Review endpoint logs for signs of malware or suspicious processes
- If a file hash triggered the alert, locate and quarantine the file
- Check if other systems have communicated with the same malicious indicator
- Update firewall rules to ensure the indicator is blocked network-wide
- Report the incident to the security team for further investigation
', '["https://www.cisco.com/c/en/us/td/docs/security/firepower/70/configuration/guide/fpmc-config-guide-v70/tid_overview.html","https://attack.mitre.org/techniques/T1071/"]', 'safe("log.eventType", "") == "TID_EVENT" && (safe("log.action", "") == "BLOCK" || safe("log.action", "") == "WOULD_BLOCK" || safe("log.tidIndicatorType", "") != "") && (safe("log.tidCategory", "") != "" || safe("log.threatScore", 0) >= 80)', '2025-09-03 13:13:37.107354', true, false, 'origin', NULL, '[]');
INSERT INTO public.utm_correlation_rules VALUES (219, 'URL Filtering Policy Violations', 3, 2, 1, 'Command and Control', 'T1102 - Web Service', 'Detects attempts to access blocked or restricted URLs, including malicious sites, phishing domains, or policy-violating content categories. This may indicate users attempting to access prohibited content, malware callbacks, or data exfiltration attempts.

Next Steps:
1. Review the blocked URL and category to determine if this is a legitimate business need or potential threat
2. Check the source IP and user to identify if this is a repeat offender or targeted activity
3. Examine network logs for any successful connections to similar domains before the block was implemented
4. If malware/phishing category, investigate the endpoint for potential compromise indicators
5. Review user''s recent web activity for patterns of policy violations or suspicious behavior
6. Consider updating web filtering policies if legitimate business sites are being blocked
7. Document the incident and notify the user''s manager if policy violations are confirmed
', '["https://www.cisco.com/c/en/us/td/docs/security/firepower/623/configuration/guide/fpmc-config-guide-v623/url_filtering.html","https://attack.mitre.org/techniques/T1102/"]', 'safe("log.eventType", "") == "URL_EVENT" && (safe("log.action", "") == "BLOCKED" || safe("log.action", "") == "RESET_BOTH" || safe("log.urlCategory", "").contains("malware") || safe("log.urlCategory", "").contains("phishing") || safe("log.urlCategory", "").contains("spam") || safe("log.urlCategory", "").contains("botnets") || safe("log.urlCategory", "").contains("spyware") || safe("log.urlCategory", "").contains("adult") || safe("log.urlCategory", "").contains("gambling") || safe("log.urlCategory", "").contains("illegal") || safe("log.urlCategory", "").contains("proxy-avoidance"))', '2025-09-03 13:13:37.5885', true, false, 'origin', NULL, '[]');
INSERT INTO public.utm_correlation_rules VALUES (220, 'User Identity Mapping Failures', 3, 3, 1, 'Discovery', 'T1087 - Account Discovery', 'Detects failures in user identity mapping including authentication failures, identity source connection issues, and user-to-IP mapping inconsistencies that may indicate credential attacks or identity spoofing.

Next Steps:
1. Review the specific failure reason and authentication method used
2. Check if the identity source is experiencing connectivity issues
3. Verify if this is part of a pattern of authentication failures from the same user or IP
4. Investigate if the user account has been compromised or if there are credential stuffing attempts
5. Review network connectivity to identity sources (Active Directory, LDAP, etc.)
6. Check for any recent changes to identity policies or user permissions
7. Correlate with other authentication logs to identify potential attack patterns
', '["https://www.cisco.com/c/en/us/td/docs/security/secure-firewall/management-center/device-config/710/management-center-device-config-71/identity-policies.html","https://attack.mitre.org/techniques/T1087/"]', '(safe("log.eventType", "") == "USER_IDENTITY_FAILURE" || safe("log.eventType", "") == "IDENTITY_MAPPING_FAILURE" || safe("log.eventType", "") == "AUTH_FAILURE" || safe("log.eventType", "") == "CAPTIVE_PORTAL_FAILURE") && (safe("log.failureReason", "") != "" || safe("log.authMethod", "") == "FAILED" || safe("log.identitySource", "") contains "ERROR" || safe("log.mappingStatus", "") == "FAILED")', '2025-09-03 13:13:38.366498', true, false, 'origin', '["origin.ip","origin.user"]', '[]');
INSERT INTO public.utm_correlation_rules VALUES (221, 'Vulnerability Assessment High Risk Finding Detection', 3, 3, 2, 'Execution', 'T1203 - Exploitation for Client Execution', 'Detects high-risk vulnerabilities identified by Firepower vulnerability assessment scans, including critical CVEs and exploitable services. This rule triggers when vulnerabilities with CRITICAL or HIGH severity are discovered, or when the CVSS score is 7.0 or higher, especially if exploits are available or the vulnerability is newly discovered.

Next Steps:
1. Review the affected host (origin.ip) and identify the specific vulnerability (log.cve)
2. Check if the vulnerability has known exploits available (log.exploitAvailable)
3. Assess the criticality of the affected system and its exposure to potential attackers
4. Prioritize patching based on CVSS score, exploit availability, and system criticality
5. If immediate patching is not possible, consider implementing compensating controls
6. Monitor for any exploitation attempts targeting this vulnerability
7. Document the remediation timeline and any temporary mitigations applied
', '["https://www.cisco.com/c/en/us/td/docs/security/firepower/70/configuration/guide/fpmc-config-guide-v70/host_identity_sources.html","https://attack.mitre.org/techniques/T1203/"]', 'safe("log.eventType", "") == "VULNERABILITY_EVENT" && (safe("log.vulnerabilitySeverity", "") == "CRITICAL" || safe("log.vulnerabilitySeverity", "") == "HIGH" || safe("log.cvssScore", 0.0) >= 7.0) && (safe("log.exploitAvailable", false) == true || safe("log.vulnerabilityStatus", "") == "NEW")', '2025-09-03 13:13:39.188315', true, false, 'origin', NULL, '[]');
INSERT INTO public.utm_correlation_rules VALUES (233, 'SD-WAN Path Selection Anomalies', 1, 2, 3, 'Discovery', 'T1046 - Network Service Discovery', 'Detects anomalies in SD-WAN path selection that could indicate network issues, misconfigurations, or potential attacks attempting to manipulate traffic routing. This rule triggers when excessive path changes occur due to jitter, packet loss, path failures, or unknown reasons.

Next Steps:
1. Review the affected device''s network connectivity and performance metrics
2. Check for any recent configuration changes to SD-WAN policies
3. Analyze network traffic patterns to identify potential DDoS or interference
4. Verify WAN link health and ISP connectivity status
5. Review Meraki dashboard for additional network health indicators
6. Consider implementing additional monitoring for the affected network paths
', '["https://documentation.meraki.com/MX/Monitoring_and_Reporting/SD-WAN_Path_Selection","https://attack.mitre.org/techniques/T1046/"]', 'safe("log.eventType", "") == "sdwan_path_change" && safe("log.pathChangeReason", "") in ["excessive_jitter", "excessive_packet_loss", "path_failure", "unknown"] && safe("log.pathChangeCount", 0) > 10', '2025-09-03 13:17:56.325214', true, false, 'origin', '["origin.ip","log.deviceName"]', '[]');
INSERT INTO public.utm_correlation_rules VALUES (222, 'Meraki Advanced Malware Protection Alert', 3, 3, 2, 'Execution', 'T1204.002 - User Execution: Malicious File', 'Detects when Meraki Advanced Malware Protection (AMP) identifies malicious files being downloaded or executed on the network. This includes retrospective alerts where files previously considered safe are later identified as malicious.

Next Steps:
1. Immediately isolate the affected system(s) from the network to prevent lateral movement
2. Review the malware details including file hash, name, and threat severity in the Meraki dashboard
3. Check if the malicious file was executed or only downloaded
4. Scan other systems for the same file hash to identify additional infections
5. Review network traffic logs from the affected IP for suspicious communications
6. If file was executed, perform full system scan and consider reimaging the affected device
7. Update endpoint protection signatures and ensure all systems are patched
8. Document the incident and update security policies if needed
', '["https://documentation.meraki.com/MX/Content_Filtering_and_Threat_Protection/Advanced_Malware_Protection_(AMP)","https://attack.mitre.org/techniques/T1204/002/"]', 'safe("log.eventType", "") == "security_event" && (safe("log.message", "").contains("malware") || safe("log.message", "").contains("AMP") || safe("log.message", "").contains("malicious") || safe("log.action", "") == "malware_blocked" || safe("log.eventName", "").contains("Advanced Malware Protection")) && safe("origin.ip", "") != ""', '2025-09-03 13:16:56.723567', true, false, 'origin', NULL, '[]');
INSERT INTO public.utm_correlation_rules VALUES (223, 'Air Marshal Rogue Access Point Detection', 3, 3, 2, 'Initial Access', 'T1200 - Hardware Additions', 'Detects when Meraki Air Marshal identifies rogue access points or unauthorized SSIDs in the wireless environment. This could indicate malicious wireless infrastructure attempting to intercept traffic or perform man-in-the-middle attacks.

Next Steps:
1. Verify if the detected BSSID and SSID are known legitimate access points that may not be properly registered
2. Check the RSSI value to determine proximity - higher values indicate the rogue AP is closer to your infrastructure
3. Use wireless scanning tools to physically locate the rogue access point using the BSSID
4. Review network traffic logs for any suspicious connections to unknown wireless networks
5. Check if any sensitive data might have been exposed through connections to the rogue AP
6. Consider implementing MAC address filtering or 802.1X authentication to prevent unauthorized connections
7. Document the incident and update the wireless security policy if needed
', '["https://documentation.meraki.com/MR/Monitoring_and_Reporting/Air_Marshal","https://attack.mitre.org/techniques/T1200/"]', 'safe("log.eventType", "") == "airmarshal_events" && safe("log.type", "") == "rogue_ssid_detected" && safe("log.bssid", "") != "" && safe("log.rssi", 0) >= -50', '2025-09-03 13:16:57.545347', true, false, 'origin', '["log.bssid","log.ssid"]', '[]');
INSERT INTO public.utm_correlation_rules VALUES (224, 'API Access Anomalies', 3, 3, 1, 'Defense Evasion, Persistence, Privilege Escalation, Initial Access', 'T1078 - Valid Accounts', 'Detects anomalous API access patterns that could indicate compromised API keys, unauthorized automation, or reconnaissance activities. This rule identifies excessive API request rates, high error rates, access to unusual endpoints, or bulk operations using destructive methods.

Next Steps:
1. Verify if the source IP and API key are authorized for API access
2. Check if the API request patterns match expected automation or administrative activities
3. Review the specific endpoints being accessed and the operations being performed
4. Contact the API key owner to verify if the activity is legitimate
5. If unauthorized, immediately revoke the compromised API key
6. Review audit logs for any configuration changes made through the API
7. Implement API rate limiting and monitoring for the affected endpoints
8. Check for any lateral movement or privilege escalation attempts
9. Review network logs for suspicious traffic patterns from the same source
', '["https://documentation.meraki.com/General_Administration/Other_Topics/Cisco_Meraki_Dashboard_API","https://attack.mitre.org/techniques/T1078/"]', 'safe("log.eventType", "") in ["api_request", "api_error", "api_rate_limit"] && (safe("log.apiRequestRate", 0) > 100 || safe("log.apiErrorRate", 0) > 0.5 || safe("log.unusualEndpoint", false) == true || safe("log.requestMethod", "") in ["DELETE", "PUT"] && safe("log.bulkOperation", false) == true)', '2025-09-03 13:16:58.145516', true, false, 'origin', NULL, '[]');
INSERT INTO public.utm_correlation_rules VALUES (225, 'Bluetooth Beacon Anomaly Detection', 3, 2, 1, 'Initial Access', 'T1200 - Hardware Additions', 'Detects anomalous Bluetooth beacon activity that could indicate rogue beacons, beacon spoofing, or unauthorized tracking devices in the environment. Monitors for unexpected beacon appearances, signal strength anomalies, or suspicious beacon identifiers.

Next Steps:
1. Investigate the physical location of the detected beacon using RSSI measurements
2. Cross-reference beacon UUID with authorized device inventory
3. Check for unauthorized personnel in the area during the detection timeframe
4. Verify if the beacon is part of legitimate IoT deployments or guest services
5. Consider implementing beacon allowlisting and monitoring policies
6. Review physical security controls around detected beacon locations
', '["https://documentation.meraki.com/MR/Bluetooth/Bluetooth_Low_Energy_(BLE)","https://attack.mitre.org/techniques/T1200/"]', 'safe("log.eventType", "").contains("bluetooth") && (safe("log.beacon_uuid", "") != "" || safe("log.beacon_major", "") != "" || safe("log.beacon_minor", "") != "") && (safe("log.rssi", 0) <= -70 || safe("log.message", "").contains("anomaly") || safe("log.message", "").contains("unexpected"))', '2025-09-03 13:16:58.588098', true, false, 'origin', '["log.beacon_uuid","log.device_mac"]', '[]');
INSERT INTO public.utm_correlation_rules VALUES (226, 'Dashboard Authentication Failures', 3, 2, 1, 'Credential Access', 'T1110 - Brute Force', 'Detects multiple dashboard authentication failures that could indicate brute force attempts, credential stuffing, or unauthorized access attempts to the Meraki dashboard.

Next Steps:
1. Review the source IP address and check if it''s from a known location or VPN
2. Verify if the targeted user accounts exist and check their recent activity
3. Look for any successful logins from the same IP following the failures
4. Check if multiple user accounts are being targeted from the same source
5. Consider blocking the source IP if the activity appears malicious
6. Review and strengthen authentication policies (enforce MFA, account lockout policies)
7. Contact the legitimate user to verify if they were experiencing login issues
', '["https://documentation.meraki.com/General_Administration/Managing_Dashboard_Access/Managing_Dashboard_Administrators_and_Permissions","https://attack.mitre.org/techniques/T1110/"]', 'safe("log.eventType", "") in ["login_failure", "auth_failed", "invalid_credentials"] && safe("log.application", "") in ["meraki_dashboard", "dashboard", "web_ui"] && (safe("log.failureReason", "") in ["invalid_password", "invalid_username", "account_locked", "mfa_failed"] || safe("log.suspiciousActivity", false) == true)', '2025-09-03 13:16:59.125924', true, false, 'origin', '["origin.ip","origin.user"]', '[{"indexPattern":"v11-log-firewall-meraki-*","with":[{"field":"origin.ip.keyword","operator":"filter_term","value":"{{.origin.ip}}"},{"field":"log.eventType.keyword","operator":"filter_match","value":"{{.log.eventType}}"},{"field":"log.application.keyword","operator":"filter_match","value":"{{.log.application}}"}],"or":null,"within":"now-1m","count":5}]');
INSERT INTO public.utm_correlation_rules VALUES (228, 'Location Analytics Anomaly Detection', 2, 1, 1, 'Lateral Movement', 'T1428 - Location Tracking', 'Detects anomalous patterns in location analytics data that could indicate unauthorized physical access, device spoofing, or abnormal movement patterns. Monitors for devices appearing in unexpected locations or exhibiting suspicious movement behavior.

Next Steps:
1. Verify the client MAC address and associated device identity
2. Review physical access logs for the affected location
3. Check if the device should have legitimate access to the detected location
4. Investigate the dwell time and movement patterns for abnormal behavior
5. Correlate with badge access systems if available
6. Consider device fingerprinting to detect potential MAC spoofing
7. Review network segmentation policies for the affected zone
8. Check for patterns of multiple devices exhibiting similar anomalous behavior
9. Validate Meraki access point configurations and coverage areas
', '["https://documentation.meraki.com/MR/Monitoring_and_Reporting/Location_Analytics","https://attack.mitre.org/techniques/T1428/"]', 'safe("log.eventType", "").contains("location") && safe("log.client_mac", "") != "" && (safe("log.message", "").contains("anomaly") || safe("log.zone_violation", false) == true || safe("log.unexpected_location", false) == true || (safe("log.dwell_time", 0) > 14400 && safe("log.location", "").contains("restricted")))', '2025-09-03 13:17:00.685533', true, false, 'origin', '["log.client_mac","log.location"]', '[]');
INSERT INTO public.utm_correlation_rules VALUES (229, 'MDM Policy Violations', 3, 3, 2, 'Defense Evasion, Persistence, Privilege Escalation, Initial Access', 'T1078.003 - Valid Accounts: Local Accounts', 'Detects violations of MDM policies including jailbroken devices, unauthorized app installations, or attempts to bypass mobile device management controls. This rule identifies devices that are not compliant with organizational security policies and may pose security risks.

Next Steps:
1. Immediately quarantine or restrict the affected device
2. Review the specific policy violation details and device compliance status
3. Check if the device shows signs of jailbreaking or rooting
4. Verify if unauthorized applications have been installed
5. Review user activity on the device for suspicious behavior
6. Update MDM policies if needed to prevent similar violations
7. Consider device reimaging if compromise is suspected
', '["https://documentation.meraki.com/SM/Monitoring_and_Reporting/MDM_Commands_in_Systems_Manager","https://attack.mitre.org/techniques/T1078/003/"]', 'safe("log.eventType", "") == "mdm_policy_violation" || safe("log.eventType", "") == "mdm_jailbreak_detected" || safe("log.eventType", "") == "mdm_unauthorized_app" || (safe("log.message", "").matches(".*MDM.*policy.*violation.*")) || (safe("log.eventType", "") == "mdm_command" && safe("log.status", "") == "failed" && safe("log.reason", "").matches(".*(policy|compliance).*"))', '2025-09-03 13:17:01.427389', true, false, 'origin', NULL, '[]');
INSERT INTO public.utm_correlation_rules VALUES (230, 'Network Topology Changes', 2, 3, 3, 'Discovery', 'T1046 - Network Service Discovery', 'Detects significant changes to network topology including VLAN modifications, routing changes, or network segmentation alterations that could impact security posture. These changes can indicate configuration drift, unauthorized modifications, or potential network reconnaissance activities.

Next Steps:
1. Verify if the topology change was authorized through change management procedures
2. Review the specific changes made and assess impact on network security
3. Check if the changes align with documented network architecture
4. Validate that proper authentication and authorization was used for the changes
5. Monitor for any subsequent suspicious network activity following the topology changes
6. Review access logs to identify who made the changes and from what location
', '["https://documentation.meraki.com/General_Administration/Cross-Platform_Content/Meraki_Event_Log","https://attack.mitre.org/techniques/T1046/"]', 'safe("log.eventType", "") == "topology_change" || safe("log.eventType", "") == "vlan_modified" || safe("log.eventType", "") == "routing_table_changed" || safe("log.eventType", "") == "network_added" || safe("log.eventType", "") == "network_deleted" || safe("log.eventType", "") == "subnet_modified" || (safe("log.message", "").contains("topology") && safe("log.message", "").contains("change")) || (safe("log.message", "").contains("VLAN") && safe("log.message", "").contains("change")) || (safe("log.message", "").contains("routing") && safe("log.message", "").contains("change")) || (safe("log.message", "").contains("network") && safe("log.message", "").contains("change")) || (safe("log.eventType", "") == "configuration_change" && (safe("log.details", "").contains("network") || safe("log.details", "").contains("topology") || safe("log.details", "").contains("vlan")))', '2025-09-03 13:17:02.44965', true, false, 'origin', '["log.networkId","log.changeType"]', '[]');
INSERT INTO public.utm_correlation_rules VALUES (231, 'Meraki Organization Admin Changes', 2, 3, 1, 'Persistence, Privilege Escalation', 'T1098 - Account Manipulation', 'Detects administrative changes made to Meraki organization settings including user account modifications, permission changes, and organization-wide configuration updates. These changes could indicate unauthorized access or insider threats attempting to maintain persistence or escalate privileges.

Next Steps:
1. Verify the legitimacy of the administrative change with the user account involved
2. Review the specific changes made to organization settings or user permissions
3. Check if the change was made during normal business hours and from expected locations
4. Examine recent authentication logs for the admin account for signs of compromise
5. Review other administrative actions performed by the same user account in the time period
6. If unauthorized, immediately review and revoke any suspicious permission changes
', '["https://documentation.meraki.com/General_Administration/Cross-Platform_Content/Meraki_Event_Log","https://attack.mitre.org/techniques/T1098/"]', 'safe("dataType", "") == "meraki" && safe("log.eventType", "") == "api_request" && ( safe("log.message", "").contains("admin") || safe("log.message", "").contains("organization") || safe("log.message", "").contains("permission") || safe("log.message", "").contains("role") || safe("log.message", "").contains("user added") || safe("log.message", "").contains("user removed") || safe("log.message", "").contains("user modified") || safe("log.message", "").contains("org_") || safe("log.application", "") == "dashboard" )', '2025-09-03 13:17:54.576339', true, false, 'origin', NULL, '[]');
INSERT INTO public.utm_correlation_rules VALUES (232, 'Rogue SSID Detection', 3, 3, 2, 'Initial Access', 'T1200 - Hardware Additions', 'Detects when a rogue SSID is identified in the wireless environment. This could indicate an evil twin attack or unauthorized access point deployment attempting to intercept wireless traffic or credentials.

Next Steps:
1. Immediately investigate the rogue access point''s physical location using the MAC address
2. Check if the rogue SSID name matches legitimate corporate SSIDs (potential evil twin attack)
3. Verify if the rogue AP is broadcasting from an unauthorized location
4. Review wireless client connection logs for any devices that may have connected to the rogue SSID
5. Consider performing a physical sweep of the area to locate and remove the unauthorized device
6. Update wireless intrusion detection policies if needed
7. Notify security team and facilities management for potential physical security breach
', '["https://documentation.meraki.com/General_Administration/Monitoring_and_Reporting/Syslog_Event_Types_and_Log_Samples","https://attack.mitre.org/techniques/T1200/"]', 'safe("log.eventType", "") == "rogue_ssid_detected" || (safe("log.type", "") == "airmarshal_events" && safe("log.subtype", "") == "rogue_ssid_detected") || (safe("log.message", "").contains("rogue") && safe("log.message", "").contains("SSID"))', '2025-09-03 13:17:55.505318', true, false, 'origin', '["origin.mac","log.ssid"]', '[]');
INSERT INTO public.utm_correlation_rules VALUES (234, 'Security Appliance Critical Events', 3, 3, 2, 'Defense Evasion', 'T1211 - Exploitation for Defense Evasion', 'Detects critical security events from Meraki security appliances including IDS/IPS alerts, content filtering violations, and advanced threat protection triggers. These events indicate potential security threats that require immediate attention.

Next Steps:
1. Review the specific event type and signature to understand the nature of the threat
2. Investigate the source IP address for additional suspicious activity
3. Check if this is part of a larger attack pattern by reviewing recent logs
4. Verify if the blocked content or detected threat bypassed other security controls
5. Consider blocking the source IP if malicious activity is confirmed
6. Review and update security policies if necessary to prevent similar incidents
', '["https://documentation.meraki.com/General_Administration/Monitoring_and_Reporting/Syslog_Event_Types_and_Log_Samples","https://attack.mitre.org/techniques/T1211/"]', 'safe("log.priority", 0) <= 2 || safe("log.eventType", "") == "ids_alert" || safe("log.eventType", "") == "security_event" || safe("log.eventType", "") == "content_filtering_block" || safe("log.eventType", "") == "threat_detected" || safe("log.eventType", "") == "malware_detected" || safe("log.eventType", "") == "amp_alert" || matches(safe("log.message", ""), ".*(security|threat|malware|attack|exploit).*detected.*") || (safe("log.eventType", "") == "urls" && safe("log.action", "") == "blocked" && matches(safe("log.category", ""), ".*(malware|phishing|botnet).*"))', '2025-09-03 13:17:57.345439', true, false, 'origin', NULL, '[]');
INSERT INTO public.utm_correlation_rules VALUES (235, 'Switch Port Anomalies', 3, 3, 3, 'Initial Access', 'T1200 - Hardware Additions', 'Detects anomalous switch port behavior including excessive link state changes, unauthorized device connections, or potential port security violations.

Next Steps:
1. Verify the affected switch port and device MAC address from the alert details
2. Check physical access to the network switch and inspect for unauthorized devices
3. Review switch port configuration and security policies
4. Examine network topology changes and device connection patterns
5. Investigate if the anomaly correlates with known maintenance activities
6. Consider disabling the affected port temporarily if unauthorized access is suspected
7. Review access logs and security camera footage for physical security incidents
8. Update port security configurations if necessary to prevent future violations
', '["https://documentation.meraki.com/General_Administration/Monitoring_and_Reporting/Syslog_Event_Types_and_Log_Samples","https://attack.mitre.org/techniques/T1200/"]', 'safe("log.eventType", "") == "port_flapping" || safe("log.eventType", "") == "port_security_violation" || safe("log.eventType", "") == "unauthorized_device_connected" || safe("log.eventType", "") == "port_down" || safe("log.eventType", "") == "excessive_errors" || matches(safe("log.message", ""), ".*port.*(flap|security|violation|anomaly).*") || (safe("log.eventType", "") == "switch_event" && safe("log.portErrors", 0) > 1000) || (safe("log.eventType", "") == "link_state_change" && safe("log.changeCount", 0) > 10)', '2025-09-03 13:17:58.625854', true, false, 'origin', '["log.device.mac","log.switch.port"]', '[]');
INSERT INTO public.utm_correlation_rules VALUES (236, 'Systems Manager Compliance Violations', 3, 3, 2, 'Defense Evasion, Persistence, Privilege Escalation, Initial Access', 'Policy Violation', 'Detects when devices violate Systems Manager security policies, which could indicate non-compliance with organizational security requirements or potential security risks from unmanaged or compromised devices.

Next Steps:
1. Investigate the specific device triggering compliance violations
2. Review the Systems Manager security policies that were violated
3. Check if the device has been compromised or if legitimate policy changes are needed
4. Verify if the device belongs to the organization or is a rogue device
5. Review device configuration and installed applications for policy violations
6. Consider quarantining the device if multiple violations occur
7. Update security policies if legitimate business needs require policy adjustments
', '["https://documentation.meraki.com/SM/Tags_and_Policies/Security_Policies_in_Systems_Manager","https://attack.mitre.org/techniques/T1078/"]', 'safe("log.eventType", "") == "sm_compliance_violation" || (safe("log.eventType", "") == "sm_security_policy" && safe("log.status", "") == "violating") || (safe("log.message", "").contains("compliance") && safe("log.message", "").contains("violation") && safe("log.deviceType", "") == "systems_manager")', '2025-09-03 13:17:59.465865', true, false, 'origin', NULL, '[]');
INSERT INTO public.utm_correlation_rules VALUES (237, 'Traffic Shaping Policy Violations', 2, 2, 3, 'Impact', 'T1496 - Resource Hijacking', 'Detects violations of traffic shaping policies that could indicate bandwidth abuse, DDoS attempts, or compromised devices consuming excessive resources. This rule identifies events where bandwidth usage exceeds 95%, violation counts exceed 5, or blocked connections exceed 100.

Next Steps:
1. Identify the source device/user causing the policy violations
2. Check if the device shows signs of compromise (malware, unauthorized software)
3. Review network traffic patterns and destination endpoints
4. Verify if the bandwidth usage is legitimate business activity
5. Check for signs of DDoS participation or data exfiltration
6. Review and adjust traffic shaping policies if needed
7. Consider isolating the device if malicious activity is confirmed
8. Update security controls to prevent future violations
', '["https://documentation.meraki.com/MX/Firewall_and_Traffic_Shaping/Traffic_Shaping","https://attack.mitre.org/techniques/T1496/"]', 'safe("log.eventType", "") in ["traffic_shaping_exceeded", "bandwidth_limit_reached", "qos_violation"] && (safe("log.bandwidthUsagePercent", 0) > 95 || safe("log.violationCount", 0) > 5 || safe("log.blockedConnections", 0) > 100)', '2025-09-03 13:18:00.225683', true, false, 'origin', '["origin.ip","log.clientMac","log.policyName"]', '[{"indexPattern":"v11-log-firewall-meraki-*","with":[{"field":"origin.ip.keyword","operator":"filter_term","value":"{{.origin.ip}}"},{"field":"log.clientMac.keyword","operator":"filter_term","value":"{{.log.clientMac}}"}],"or":null,"within":"now-30m","count":5}]');
INSERT INTO public.utm_correlation_rules VALUES (238, 'Wireless Intrusion Attempts', 3, 3, 2, 'Reconnaissance', 'T1595.002 - Active Scanning: Vulnerability Scanning', 'Detects wireless intrusion attempts including deauthentication attacks, association floods, and other wireless-specific attack patterns that could compromise the wireless network integrity.

Next Steps:
1. Review the wireless access point logs for the affected device
2. Identify the source MAC address and physical location if possible
3. Check for unauthorized devices or rogue access points in the vicinity
4. Verify wireless security configurations and update if necessary
5. Consider implementing additional wireless monitoring and detection capabilities
6. Document the incident and update security policies if needed
', '["https://documentation.meraki.com/General_Administration/Monitoring_and_Reporting/Syslog_Event_Types_and_Log_Samples","https://attack.mitre.org/techniques/T1595/002/"]', 'safe("log.eventType", "") == "ids_alerted" || safe("log.eventType", "") == "wids_alerted" || (safe("log.type", "") == "airmarshal_events" && (safe("log.subtype", "").contains("attack") || safe("log.subtype", "").contains("flood") || safe("log.subtype", "").contains("deauth")) || (safe("log.message", "").contains("deauthentication attack") || safe("log.message", "").contains("association flood") || safe("log.message", "").contains("wireless intrusion"))', '2025-09-03 13:18:00.705112', true, false, 'origin', NULL, '[]');
INSERT INTO public.utm_correlation_rules VALUES (1243, 'VLAN Trunk Attack Detection', 3, 3, 2, 'Defense Evasion', 'T1599.001 - Network Boundary Bridging: Network Address Translation Traversal', 'Detects potential VLAN trunk attacks including attempts to configure trunk mode (VLAN 4095), unexpected VLAN tagging changes, or double-tagging attempts that could lead to VLAN hopping. These attacks can allow unauthorized network access and traffic interception.

Next Steps:
1. Immediately review the affected ESXi host''s network configuration and port groups
2. Check virtual switch VLAN settings and verify proper VLAN isolation
3. Examine recent network configuration changes and identify who made them
4. Review VM network adapter configurations for unauthorized VLAN assignments
5. Monitor network traffic for signs of VLAN hopping or unauthorized network access
6. Verify that trunk ports are properly configured with allowed VLAN lists
7. Consider implementing additional network segmentation controls
', '["https://docs.vmware.com/en/VMware-vSphere/7.0/com.vmware.vsphere.security.doc/GUID-A7E76D9B-92B4-4AD9-BB77-C3C59BDE37C1.html","https://attack.mitre.org/techniques/T1599/001/"]', '(
  (safe("log.message", "").matches("(?i)vlan.*4095") ||
   safe("log.message", "").matches("(?i)trunk.*mode.*set") ||
   safe("log.message", "").matches("(?i)vlan.*tag.*mismatch") ||
   safe("log.message", "").matches("(?i)double.*tag") ||
   safe("log.message", "").matches("(?i)unexpected.*tagged.*frame") ||
   safe("log.message", "").matches("(?i)vlan.*hopping") ||
   safe("log.message", "").matches("(?i)native.*vlan.*change") ||
   safe("log.message", "").matches("(?i)port.*group.*vlan.*modified")) &&
  (safe("log.process", "").matches("(?i)vmkernel") ||
   safe("log.process", "").matches("(?i)netcpa") ||
   safe("log.process", "").matches("(?i)hostd"))
)
', '2025-09-04 19:00:48.205744', true, false, 'origin', '["origin.hostname"]', '[]');
INSERT INTO public.utm_correlation_rules VALUES (1244, 'VMCI/VMHGFS Exploitation Attempt', 3, 3, 3, 'Lateral Movement', 'T1210 - Exploitation of Remote Services', 'Detects potential exploitation of VMCI (Virtual Machine Communication Interface) or VMHGFS vulnerabilities including CVE-2025-22224 TOCTOU race condition attacks, backdoor deployments, and suspicious inter-VM communications. This rule identifies error conditions, heap overflows, race conditions, and malicious binary deployments that may indicate active exploitation of VMware virtualization infrastructure components.

Next Steps:
1. Immediately isolate the affected ESXi host from the network to prevent lateral movement
2. Review all virtual machines on the affected host for signs of compromise
3. Check VMware logs for additional VMCI/VMHGFS related errors or anomalies
4. Verify the integrity of VM configuration files and look for unauthorized changes
5. Scan for presence of suspicious files like /bin/rdt or python backdoors
6. Apply latest VMware security patches and updates
7. Monitor inter-VM communications for unusual patterns
8. Review user access logs for unauthorized administrative activities
', '["https://attack.mitre.org/techniques/T1210/","https://cloud.google.com/blog/topics/threat-intelligence/vmware-detection-containment-hardening","https://support.broadcom.com/web/ecx/support-content-notification/-/external/content/SecurityAdvisories/0/25390"]', '(safe("log.message", "").contains("VMCI") && safe("log.message", "").contains("heap")) ||
(safe("log.message", "").contains("VMCI") && safe("log.message", "").contains("overflow")) ||
(safe("log.message", "").contains("VMCI") && safe("log.message", "").contains("race condition")) ||
(safe("log.message", "").contains("VMHGFS") && safe("severity", "") == "error") ||
(safe("log.message", "").contains("sysclog") && safe("log.process", "").contains("VMCI")) ||
(safe("log.message", "").contains("/bin/rdt") && safe("log.message", "").contains("python")) ||
safe("log.message", "").contains("VIRTUALPITA") ||
safe("log.message", "").contains("VIRTUALPIE") ||
(safe("log.message", "").contains("VMCI") && safe("log.message", "").contains("backdoor")) ||
safe("log.message", "").contains("write operations by the VMCI component") ||
(safe("log.message", "").contains("TOCTOU") && safe("log.process", "").contains("vmx"))
', '2025-09-04 19:00:49.130652', true, false, 'origin', '["origin.hostname","log.pid"]', '[{"indexPattern":"v11-log-vmware-esxi-*","with":[{"field":"origin.hostname.keyword","operator":"filter_term","value":"{{.origin.hostname}}"},{"field":"log.message","operator":"filter_match","value":"VMCI"}],"or":null,"within":"now-30m","count":2}]');
INSERT INTO public.utm_correlation_rules VALUES (1331, 'Windows: Domain guests group changed', 1, 1, 1, 'Privilege Escalation', 'Domain Policy Modification', 'Adversaries may modify the configuration settings of a domain to evade defenses and/or escalate privileges in domain environments.  Domains provide a centralized means of managing how computer resources (ex: computers, user accounts) can act, and interact with each other, on a network.  The policy of the domain also includes configuration settings that may apply between domains in a multi-domain/forest environment.  Modifications to domain settings may include altering domain Group Policy Objects (GPOs) or changing trust settings for domains, including federation trusts.', '["https://attack.mitre.org/tactics/TA0004/","https://attack.mitre.org/techniques/T1484/"]', 'safe("log.eventDataTargetSid", "").matches("(^%{S-1-5-21(.+)-514}$|^S-1-5-21(.+)-514$)")', '2025-09-04 20:23:52.313617', true, false, 'origin', NULL, '[]');
INSERT INTO public.utm_correlation_rules VALUES (246, 'Azure Firewall Policy Deletion', 1, 2, 3, 'Impair Defenses', 'Defense Evasion', 'Identifies the deletion of a firewall policy in Azure. An adversary may delete a firewall policy in an attempt to evade defenses and/or to eliminate barriers in carrying out their initiative.', '["https://attack.mitre.org/techniques/T1562/","https://attack.mitre.org/tactics/TA0005/"]', 'safe("log.resourceProviderNameValue", "").contains("azure.activitylogs") && safe("log.operationNameValue", "").contains("MICROSOFT.NETWORK/FIREWALLPOLICIES/DELETE") && safe("log.statusValue", "").contains("Succeeded")', '2025-09-03 13:19:32.371082', true, false, 'origin', NULL, '[]');
INSERT INTO public.utm_correlation_rules VALUES (247, 'Azure Network Watcher Deletion', 1, 2, 3, 'Impair Defenses', 'Defense Evasion', 'Identifies the deletion of a Network Watcher in Azure. Network Watchers are used to monitor, diagnose, view metrics, and enable or disable logs for resources in an Azure virtual network. An adversary may delete a Network Watcher in an attempt to evade defenses.', '["https://attack.mitre.org/techniques/T1562/","https://attack.mitre.org/tactics/TA0005/"]', 'safe("log.resourceProviderNameValue", "").contains("azure.activitylogs") && safe("log.operationNameValue", "").contains("MICROSOFT.NETWORK/NETWORKWATCHERS/DELETE") && safe("log.statusValue", "").contains("Succeeded")', '2025-09-03 13:19:33.604189', true, false, 'origin', NULL, '[]');
INSERT INTO public.utm_correlation_rules VALUES (248, 'Azure Blob Container Access Level Modification', 1, 2, 3, 'Cloud Service Discovery', 'Discovery', 'Identifies changes to container access levels in Azure. Anonymous public read access to containers and blobs in Azure is a way to share data broadly, but can present a security risk if access to sensitive data is not managed judiciously.', '["https://attack.mitre.org/tactics/TA0007/"]', 'safe("log.resourceProviderNameValue", "").contains("azure.activitylogs") && safe("log.operationNameValue", "").contains("MICROSOFT.STORAGE/STORAGEACCOUNTS/BLOBSERVICES/CONTAINERS/WRITE") && safe("log.statusValue", "").contains("Succeeded")', '2025-09-03 13:19:34.415133', true, false, 'target', NULL, '[]');
INSERT INTO public.utm_correlation_rules VALUES (249, 'Azure Service Principal Credentials Added', 1, 2, 3, 'Resource Hijacking', 'Impact', 'Identifies when new Service Principal credentials have been added in Azure. In most organizations, credentials will be added to service principals infrequently. Hijacking an application (by adding a rogue secret or certificate) with granted permissions will allow the attacker to access data that is normally protected by MFA requirements.', '["https://attack.mitre.org/techniques/T1496/"]', 'safe("log.resourceProviderNameValue", "").contains("azure.activitylogs") && safe("log.operationNameLocalizedValue", "").contains("Add service principal credential") && safe("log.statusValue", "").contains("Succeeded")', '2025-09-03 13:20:04.605004', true, false, 'target', NULL, '[]');
INSERT INTO public.utm_correlation_rules VALUES (252, 'Azure Active Directory PowerShell Sign-in', 1, 2, 3, 'Valid Accounts', 'Initial Access', 'Identifies a sign-in using the Azure Active Directory PowerShell module. PowerShell for Azure Active Directory allows for managing settings from the command line, which is intended for users who are members of an admin role.', '["https://attack.mitre.org/techniques/T1078/"]', 'safe("log.resourceProviderNameValue", "").contains("azure.signinlogs") && safe("log.level", "").contains("critical") && safe("log.propertiesTitle", "").contains("Azure Active Directory PowerShell") && safe("log.propertiesService", "").contains("AzureAD") && safe("log.statusValue", "").contains("Succeeded")', '2025-09-03 13:20:06.745057', true, false, 'origin', NULL, '[]');
INSERT INTO public.utm_correlation_rules VALUES (255, 'Azure Automation Account Created', 1, 2, 3, 'Valid Accounts', 'Persistence', 'Identifies when an Azure Automation account is created. Azure Automation accounts can be used to automate management tasks and orchestrate actions across systems. An adversary may create an Automation account in order to maintain persistence in their target''s environment.', '["https://attack.mitre.org/techniques/T1078/"]', 'safe("log.resourceProviderName.value", "") == "azure.activitylogs" && safe("log.operationNameLocalizedValue", "").contains("MICROSOFT.AUTOMATION/AUTOMATIONACCOUNTS/WRITE") && safe("log.statusValue", "") == "Succeeded"', '2025-09-05 14:21:44.887934', true, false, 'origin', NULL, '[]');
INSERT INTO public.utm_correlation_rules VALUES (254, 'Azure External Guest User Invitation', 1, 2, 3, 'Valid Accounts', 'Initial Access', 'Identifies an invitation to an external user in Azure Active Directory(AD). Azure AD is extended to include collaboration, allowing you to invite people from outside your organization to be guest users in your cloud account. Unless there is a business need to provision guest access, it is best practice avoid creating guest users. Guest users could potentially be overlooked indefinitely leading to a potential vulnerability.', '["https://attack.mitre.org/techniques/T1078/"]', 'safe("log.operationNameLocalizedValue", "") == "Consent to application" && safe("log.statusValue", "") == "Succeeded" && safe("log.caller", "") == "guest" && (safe("log.resourceProviderNameValue", "") == "azure.activitylogs" || safe("log.resourceProviderNameValue", "") == "azure.auditlogs")', '2025-09-03 13:20:07.86474', true, false, 'target', NULL, '[]');
INSERT INTO public.utm_correlation_rules VALUES (1332, 'Windows: Credential Acquisition via Registry Hive Dumping', 3, 1, 1, 'Credential Access', 'Security Account Manager', 'Identifies attempts to export a registry hive which may contain credentials using the Windows reg.exe tool.', '["https://attack.mitre.org/tactics/TA0006/","https://attack.mitre.org/techniques/T1003/","https://attack.mitre.org/techniques/T1003/002/"]', 'safe("log.winlogEventDataProcessName", "").matches(''reg.exe'') && safe("log.message", "").matches(''(save|export)'') && safe("log.message", "").matches(''(hklm\\sam|hklm\\security)'')', '2025-09-04 20:23:52.589404', true, false, 'origin', NULL, '[]');
INSERT INTO public.utm_correlation_rules VALUES (256, 'Azure Automation Runbook Created or Modified', 1, 2, 3, 'Malicious code', 'Persistence', 'Identifies when an Azure Automation runbook is created or modified. An adversary may create or modify an Azure Automation runbook to execute malicious code and maintain persistence in their target''s environment.', '["https://azure.microsoft.com/en-in/blog/azure-automation-runbook-management/"]', 'safe("log.resourceProviderNameValue", "") == "azure.activitylogs" && safe("log.statusValue", "") == "Succeeded" && (safe("log.operationNameLocalizedValue", "").contains("MICROSOFT.AUTOMATION/AUTOMATIONACCOUNTS/RUNBOOKS/DRAFT/WRITE") || safe("log.operationNameLocalizedValue", "").contains("MICROSOFT.AUTOMATION/AUTOMATIONACCOUNTS/RUNBOOKS/WRITE") || safe("log.operationNameLocalizedValue", "").contains("MICROSOFT.AUTOMATION/AUTOMATIONACCOUNTS/RUNBOOKS/PUBLISH/ACTION"))', '2025-09-03 13:20:09.287172', true, false, 'origin', NULL, '[]');
INSERT INTO public.utm_correlation_rules VALUES (257, 'Azure Automation Webhook Created', 1, 2, 3, 'Malicious code', 'Persistence', 'Identifies when an Azure Automation webhook is created. Azure Automation runbooks can be configured to execute via a webhook. A webhook uses a custom URL passed to Azure Automation along with a data payload specific to the runbook. An adversary may create a webhook in order to trigger a runbook that contains malicious code.', '["https://powerzure.readthedocs.io/en/latest/Functions/operational.html#create-backdoor","https://github.com/hausec/PowerZure","https://posts.specterops.io/attacking-azure-azure-ad-and-introducing-powerzure-ca70b330511a","https://www.ciraltos.com/webhooks-and-azure-automation-runbooks/"]', 'safe("log.resourceProviderNameValue", "") == "azure.activitylogs" && safe("log.statusValue", "") == "Succeeded" && (safe("log.operationName.value", "").contains("MICROSOFT.AUTOMATION/AUTOMATIONACCOUNTS/WEBHOOKS/ACTION") || safe("log.operationName.value", "").contains("MICROSOFT.AUTOMATION/AUTOMATIONACCOUNTS/WEBHOOKS/WRITE"))', '2025-09-03 13:20:09.848957', true, false, 'origin', NULL, '[]');
INSERT INTO public.utm_correlation_rules VALUES (258, 'Azure Conditional Access Policy Modified', 1, 2, 3, 'Account Manipulation', 'Persistence', 'Identifies when an Azure Conditional Access policy is modified. Azure Conditional Access policies control access to resources via if-then statements. For example, if a user wants to access a resource, then they must complete an action such as using multi-factor authentication to access it. An adversary may modify a Conditional Access policy in order to weaken their target''s security controls.', '["https://attack.mitre.org/techniques/T1098/"]', 'safe("log.statusValue", "") == "Succeeded" && safe("log.operationNameValue", "").contains("Update policy") && safe("log.resourceProviderNameValue", "").contains("azure.activitylogs")', '2025-09-03 13:20:10.463727', true, false, 'origin', NULL, '[]');
INSERT INTO public.utm_correlation_rules VALUES (259, 'Azure Privilege Identity Management Role Modified', 1, 2, 3, 'Valid Accounts', 'Persistence', 'Azure Active Directory (AD) Privileged Identity Management (PIM) is a service that enables you to manage, control, and monitor access to important resources in an organization. PIM can be used to manage the built-in Azure resource roles such as Global Administrator and Application Administrator. An adversary may add a user to a PIM role in order to maintain persistence in their target''s environment or modify a PIM role to weaken their target''s security controls.', '["https://attack.mitre.org/techniques/T1098/"]', 'safe("log.resourceProviderNameValue", "") == "azure.activitylogs" && safe("log.statusValue", "") == "Succeeded" && safe("log.operationNameValue", "").contains("Update role setting in PIM")', '2025-09-03 13:20:33.824414', true, false, 'target', NULL, '[]');
INSERT INTO public.utm_correlation_rules VALUES (355, 'Potentially Unwanted Application detected in Sophos Central', 2, 2, 1, 'Impact', 'Data Manipulation', 'Potentially unsafe applications is the classification used for commercial, legitimate software.  This classification includes programs such as remote access tools, password-cracking applications,  and keyloggers (a program that records each keystroke a user types).', '["https://attack.mitre.org/tactics/TA0040/","https://attack.mitre.org/techniques/T1565/"]', 'safe("log.type", "").matches("Event::Endpoint::(HomePuaRemnants|CorePua|HmpaPuaDetected)|Event::Endpoint::Threat::Pua")', '2025-09-03 15:00:55.405978', true, false, 'origin', NULL, '[]');
INSERT INTO public.utm_correlation_rules VALUES (260, 'Multi-Factor Authentication Disabled for an Azure User', 1, 2, 3, 'Account Manipulation', 'Persistence', 'Azure Active Directory (AD) Privileged Identity Management (PIM) is a service that enables you to manage, control, and monitor access to important resources in an organization. PIM can be used to manage the built-in Azure resource roles such as Global Administrator and Application Administrator. An adversary may add a user to a PIM role in order to maintain persistence in their target''s environment or modify a PIM role to weaken their target''s security controls.', '["https://attack.mitre.org/techniques/T1098/"]', 'safe("log.resourceProviderNameValue", "") == "azure.activitylogs" && safe("log.statusValue", "") == "Succeeded" && safe("log.operationNameValue", "").contains("Disable Strong Authentication")', '2025-09-03 13:20:34.647559', true, false, 'target', NULL, '[]');
INSERT INTO public.utm_correlation_rules VALUES (261, 'User Added as Owner for Azure Application', 1, 2, 3, 'Account Manipulation', 'Persistence', 'Identifies when a user is added as an owner for an Azure application. An adversary may add a user account as an owner for an Azure application in order to grant additional permissions and modify the application''s configuration using another account. ', '["https://attack.mitre.org/techniques/T1098/"]', 'safe("log.resourceProviderNameValue", "") == "azure.activitylogs" && safe("log.statusValue", "") == "Succeeded" && safe("log.operationNameValue", "").contains("Add owner to application")', '2025-09-03 13:20:35.824774', true, false, 'target', NULL, '[]');
INSERT INTO public.utm_correlation_rules VALUES (262, 'User Added as Owner for Azure Service Principal', 1, 2, 3, 'Account Manipulation', 'Persistence', 'Identifies when a user is added as an owner for an Azure service principal. The service principal object defines what the application can do in the specific tenant, who can access the application, and what resources the app can access. A service principal object is created when an application is given permission to access resources in a tenant. An adversary may add a user account as an owner for a service principal and use that account in order to define what an application can do in the Azure AD tenant.', '["https://attack.mitre.org/techniques/T1098/"]', 'safe("log.resourceProviderNameValue", "") == "azure.activitylogs" && safe("log.statusValue", "") == "Succeeded" && safe("log.operationNameValue", "").contains("Add owner to service principal")', '2025-09-03 13:20:36.467714', true, false, 'target', NULL, '[]');
INSERT INTO public.utm_correlation_rules VALUES (263, 'API Management Security Events', 3, 3, 2, 'Defense Evasion, Persistence, Privilege Escalation, Initial Access', 'T1078 - Valid Accounts', 'Detects suspicious API Management activities including authentication failures, unauthorized access attempts, or API policy violations in Azure API Management services.

Next Steps:
1. Review the specific API endpoint and operation that triggered the alert
2. Investigate the source IP address and user identity associated with the request
3. Check for patterns of failed authentication attempts from the same source
4. Verify if the API access request aligns with legitimate business needs
5. Review API Management policies and access controls
6. Check for any recent changes to API permissions or policies
7. Consider implementing additional rate limiting or IP restrictions if needed
', '["https://learn.microsoft.com/en-us/azure/api-management/api-management-howto-use-azure-monitor","https://attack.mitre.org/techniques/T1078/"]', '(safe("log.operationName", "").contains("Microsoft.ApiManagement") || safe("log.type", "") == "ApiManagementGatewayLogs") && (safe("log.statusCode", 0.0) == double(401) || safe("log.statusCode", 0.0) == double(403) || safe("log.responseCode", 0.0) == double(401) || safe("log.responseCode", 0.0) == double(403) || safe("log.actionResult", "") == "denied" || safe("log.lastError", "") != "" || safe("log.errors", "") != "")', '2025-09-03 13:23:57.563328', true, false, 'origin', '["origin.ip","log.aadClientId"]', '[]');
INSERT INTO public.utm_correlation_rules VALUES (264, 'Application Gateway WAF Security Alerts', 3, 3, 2, 'Initial Access', 'T1190 - Exploit Public-Facing Application', 'Detects Web Application Firewall alerts from Azure Application Gateway indicating potential web attacks or malicious activity. This rule triggers when WAF blocks or detects suspicious requests that match security rules.

**Next Steps:**
1. Review the specific WAF rule ID and message details to understand the attack type
2. Analyze the source IP address for reputation and geographic location
3. Examine the request URL, headers, and payload for attack indicators
4. Check for additional requests from the same source IP within the time window
5. Verify if this is a legitimate application behavior or actual attack attempt
6. Consider implementing additional WAF rules or IP blocking if confirmed malicious
7. Review application logs for any successful bypass attempts
', '["https://learn.microsoft.com/en-us/azure/web-application-firewall/ag/web-application-firewall-logs","https://attack.mitre.org/techniques/T1190/"]', '(safe("log.operationName", "") == "ApplicationGatewayFirewallLog" || safe("log.type", "") == "ApplicationGatewayFirewallLog") && (safe("log.ruleId", "") != "" || safe("log.action", "") == "Blocked" || safe("log.message", "").contains("attack") || safe("log.message", "").contains("malicious") || safe("log.message", "").contains("blocked"))', '2025-09-03 13:23:58.022899', true, false, 'origin', NULL, '[]');
INSERT INTO public.utm_correlation_rules VALUES (265, 'Azure Sentinel High/Critical Alert Pattern Detection', 3, 3, 2, 'Defense Evasion', 'T1562.001 - Impair Defenses: Disable or Modify Tools', 'Detects high-severity or critical alerts from Azure Sentinel that may indicate coordinated attack activity or serious security incidents requiring immediate investigation. This rule identifies new alerts with High or Critical severity levels from Microsoft Sentinel that could represent active threats.

Next Steps:
1. Review the alert details and affected resources immediately
2. Correlate with other security events in the environment
3. Check for signs of lateral movement or privilege escalation
4. Verify if the alert represents a true positive through manual investigation
5. Implement containment measures if attack activity is confirmed
6. Document findings and update incident response procedures
', '["https://learn.microsoft.com/en-us/azure/sentinel/security-alert-schema","https://attack.mitre.org/techniques/T1562/"]', 'safe("log.AlertSeverity", "") in ["High", "Critical"] && safe("log.VendorName", "") == "Microsoft Sentinel" && safe("log.Status", "") == "New"', '2025-09-03 13:23:58.584618', true, false, 'origin', NULL, '[]');
INSERT INTO public.utm_correlation_rules VALUES (269, 'ExpressRoute Configuration Changes', 2, 3, 3, 'Discovery', 'T1046 - Network Service Discovery', 'Detects configuration changes to Azure ExpressRoute circuits which could indicate unauthorized network modifications or attempts to bypass security controls. ExpressRoute circuits provide private connectivity between Azure and on-premises infrastructure, making unauthorized changes particularly concerning for network security.

Next Steps:
1. Verify the change was authorized and performed by legitimate administrators
2. Review the specific configuration changes made to the ExpressRoute circuit
3. Check if the change aligns with documented change management procedures
4. Investigate the source IP and user account that performed the change
5. Validate that no unauthorized access to critical network segments occurred
6. Review related network logs for any suspicious activity following the change
', '["https://learn.microsoft.com/en-us/azure/expressroute/monitor-expressroute","https://attack.mitre.org/techniques/T1046/"]', 'safe("log.operationName", "") == "Microsoft.Network/expressRouteCircuits/write" || safe("log.operationName", "") == "Microsoft.Network/expressRouteCircuits/delete" || (safe("log.resourceId", "").contains("/expressRouteCircuits/") && safe("log.operationName", "").contains("write"))', '2025-09-03 13:24:01.103559', true, false, 'origin', '["log.resourceId"]', '[]');
INSERT INTO public.utm_correlation_rules VALUES (273, 'Network Security Group Modifications', 3, 3, 2, 'Defense Evasion', 'T1562.007 - Impair Defenses: Disable or Modify Cloud Firewall', 'Detects modifications to Azure Network Security Groups which could indicate attempts to bypass network security controls or create backdoor access. Network Security Groups control traffic flow to Azure resources and unauthorized changes could expose critical infrastructure.

Next Steps:
1. Verify the legitimacy of the NSG modification with the responsible administrator
2. Review the specific security rules that were added, modified, or deleted
3. Check if the modification aligns with approved change management processes
4. Investigate the source IP and user account that performed the change
5. Review other recent Azure activity from the same user or IP address
6. Validate that the NSG changes don''t expose critical resources to unauthorized access
7. Check if the changes affect production workloads or sensitive environments
', '["https://learn.microsoft.com/en-us/azure/virtual-network/virtual-network-nsg-manage-log","https://attack.mitre.org/techniques/T1562/007/"]', 'safe("log.operationName", "").contains("Microsoft.Network/networkSecurityGroups") && (safe("log.operationName", "").contains("/write") || safe("log.operationName", "").contains("/delete") || safe("log.operationName", "").contains("/securityRules/write")) && safe("log.category", "") == "Administrative" && safe("log.resultType", "") == "Success"', '2025-09-03 13:25:40.383535', true, false, 'origin', '["origin.ip","log.resourceId"]', '[]');
INSERT INTO public.utm_correlation_rules VALUES (274, 'Azure AD Privilege Escalation Attempt Detected', 3, 3, 1, 'Defense Evasion, Persistence, Privilege Escalation, Initial Access', 'T1078 - Valid Accounts', 'Detects attempts to escalate privileges in Azure AD through role assignments. Monitors for the Microsoft.Authorization/roleAssignments/write operation which indicates a user or service principal is being granted additional permissions.

Next Steps:
1. Verify the legitimacy of the role assignment by checking with the requesting user or administrator
2. Review the specific role being assigned and ensure it follows the principle of least privilege
3. Check if this is part of a scheduled maintenance or approved change request
4. Investigate the source IP address and user context for any suspicious patterns
5. Review Azure AD audit logs for any other suspicious activities from the same user or IP
6. If unauthorized, immediately revoke the role assignment and investigate potential account compromise
', '["https://learn.microsoft.com/en-us/azure/role-based-access-control/role-assignments-alert","https://attack.mitre.org/techniques/T1078/"]', 'safe("log.operationName", "") == "Microsoft.Authorization/roleAssignments/write" && safe("log.categoryValue", "") == "Administrative"', '2025-09-03 13:25:40.927589', true, false, 'origin', NULL, '[]');
INSERT INTO public.utm_correlation_rules VALUES (287, 'Microsoft 365 Exchange Malware Filter Policy Deletion', 3, 3, 2, 'Impair Defenses', 'Defense Evasion', 'Defense Evasion consists of techniques that adversaries use to avoid detection throughout their compromise. Techniques used for defense evasion include uninstalling/disabling security software or obfuscating/encrypting data and scripts. Adversaries also leverage and abuse trusted processes to hide and masquerade their malware. Other tacticsâ€™ techniques are cross-listed here when those techniques include the added benefit of subverting defenses.<br> Identifies when a malware filter policy has been deleted in Microsoft 365. A malware filter policy is used to alert administrators that an internal user sent a message that contained malware. This may indicate an account or machine compromise that would need to be investigated. Deletion of a malware filter policy may be done to evade detection.', '["https://attack.mitre.org/techniques/T1562/","https://attack.mitre.org/tactics/TA0005/"]', 'safe("log.workLoad", "") == ''Exchange'' && safe("action", "") == ''Remove-MalwareFilterPolicy'' && safe("actionResult", "") in [''Success'',''PartiallySucceeded'',''True'']', '2025-09-03 14:45:38.159737', true, false, 'origin', NULL, '[]');
INSERT INTO public.utm_correlation_rules VALUES (266, 'Azure AD Conditional Access Policy Bypass Attempt', 3, 3, 1, 'Defense Evasion, Persistence, Privilege Escalation, Initial Access', 'T1078 - Valid Accounts', 'Detects potential attempts to bypass Azure AD Conditional Access policies through policy tampering or unauthorized modifications. Monitors for policy updates that could weaken security controls.

Next Steps:
1. Immediately review the conditional access policy changes made and document all modifications
2. Verify the identity and authorization of the user who made the changes, including verifying they have legitimate administrative access
3. Check if the policy modifications align with approved change management processes and security approval workflows
4. Review Azure AD sign-in logs for any unusual authentication patterns or successful logins following the policy change
5. Assess if the modified policy creates security gaps, weakens access controls, or allows unauthorized access paths
6. Cross-reference the timing of policy changes with any recent security incidents or suspicious activities
7. Consider immediately reverting unauthorized changes and implementing stronger approval workflows for future policy modifications
8. Audit all other conditional access policies for similar unauthorized modifications
', '["https://danielchronlund.com/2022/01/07/the-attackers-guide-to-azure-ad-conditional-access/","https://attack.mitre.org/techniques/T1078/"]', '(safe("log.operationName", "") == "Update policy" || safe("log.operationName", "") == "Delete conditional access policy") && safe("log.service", "") == "Conditional Access"', '2025-09-03 13:23:59.119341', true, false, 'origin', NULL, '[]');
INSERT INTO public.utm_correlation_rules VALUES (1337, 'Windows: Enterprise read-only domain controllers group changed', 3, 3, 3, 'Potentially Compromised System', 'Domain Policy Modification', 'Adversaries may modify the configuration settings of a domain to evade defenses and/or escalate privileges in domain environments.  Domains provide a centralized means of managing how computer resources (ex: computers, user accounts) can act, and interact with each other, on a network.  The policy of the domain also includes configuration settings that may apply between domains in a multi-domain/forest environment.  Modifications to domain settings may include altering domain Group Policy Objects (GPOs) or changing trust settings for domains, including federation trusts.', '["https://attack.mitre.org/techniques/T1484"]', 'safe("log.eventDataTargetSid", "").matches("(^%{S-1-5-21(.+)-498}$|^S-1-5-21(.+)-498$)")', '2025-09-04 20:23:54.931448', true, false, 'origin', NULL, '[]');
INSERT INTO public.utm_correlation_rules VALUES (268, 'Azure Defender for Cloud Critical Security Alert', 3, 3, 2, 'Intrusion Detection', 'T1001 - Initial Access', 'Detects critical severity alerts from Azure Defender for Cloud indicating potential active threats, malware infections, or successful breach attempts that require immediate response.

Next Steps:
1. Review the full alert details in Azure Defender for Cloud portal
2. Verify the affected resource and assess the scope of potential compromise
3. Check for related suspicious activities on the affected resource
4. Implement immediate containment measures if threat is confirmed
5. Review security policies and configurations for the affected resource
6. Document the incident and update security procedures as needed
', '["https://learn.microsoft.com/en-us/azure/defender-for-cloud/alerts-overview","https://learn.microsoft.com/en-us/azure/defender-for-cloud/alerts-schemas","https://attack.mitre.org/tactics/TA0001/"]', '(safe("log.eventName", "") == "Microsoft.Security/locations/alerts/Activate/action" || safe("log.operationName", "").contains("Microsoft.Security")) && safe("log.category", "") == "Security" && safe("log.level", "") in ["Critical", "High", "Error"] && (safe("log.properties.severity", "") == "High" || safe("log.properties.alertSeverity", "") == "High")', '2025-09-03 13:24:00.546017', true, false, 'origin', NULL, '[]');
INSERT INTO public.utm_correlation_rules VALUES (270, 'Azure Function App Security Alert', 3, 3, 2, 'Credential Access', 'T1212 - Exploitation for Credential Access', 'Detects security-related errors and warnings in Azure Function Apps, including authentication failures, authorization denials, and suspicious execution patterns. This rule identifies potential security incidents in Azure Function Apps that may indicate credential access attempts or other malicious activities.

Next Steps:
1. Review the specific error details and operation name in the Function App logs
2. Investigate the source IP address and check for suspicious geographic locations
3. Examine the frequency of similar events from the same origin
4. Verify legitimate business justification for the operations being performed
5. Check for any unauthorized code deployments or configuration changes
6. Review authentication and authorization settings for the affected Function App
7. Correlate with other Azure security events and alerts in the timeframe
', '["https://learn.microsoft.com/en-us/azure/azure-functions/monitor-functions","https://attack.mitre.org/techniques/T1212/"]', 'safe("log.type", "") == "FunctionAppLogs" && (safe("log.Category", "") == "Host.Results" || safe("log.Category", "") == "Function") && (safe("log.Level", "") == "Error" || safe("log.Level", "") == "Warning") && (safe("log.OperationName", "").contains("Authentication") || safe("log.OperationName", "").contains("Authorization") || safe("log.ResultType", "") == "Failed" || safe("log.ResultType", "") == "Unauthorized")', '2025-09-03 13:24:01.884949', true, false, 'origin', NULL, '[]');
INSERT INTO public.utm_correlation_rules VALUES (271, 'Azure Key Vault Excessive Access Detected', 3, 2, 1, 'Collection', 'T1530 - Data from Cloud Storage Object', 'Detects unusual spikes in Azure Key Vault access patterns. Monitors for multiple secret retrieval operations from the same source, which could indicate credential harvesting or data exfiltration attempts.

Next Steps:
1. Investigate the source IP address and verify if it''s a legitimate system or user
2. Review the specific secrets/keys being accessed and their criticality
3. Check for any recent changes to Key Vault access policies
4. Correlate with user authentication logs to identify the account responsible
5. Verify if the access pattern aligns with normal business operations
6. Consider implementing additional access controls or monitoring if suspicious activity is confirmed
', '["https://learn.microsoft.com/en-us/azure/key-vault/general/logging","https://attack.mitre.org/techniques/T1530/"]', 'safe("log.category", "") == "AuditEvent" && (safe("log.operationName", "") == "SecretGet" || safe("log.operationName", "") == "SecretList" || safe("log.operationName", "") == "KeyGet")', '2025-09-03 13:24:02.446099', true, false, 'origin', '["origin.ip","log.resourceId"]', '[{"indexPattern":"v11-log-azure-*","with":[{"field":"origin.ip.keyword","operator":"filter_term","value":"{{.origin.ip}}"},{"field":"log.category.keyword","operator":"filter_term","value":"AuditEvent"}],"or":null,"within":"now-10m","count":20}]');
INSERT INTO public.utm_correlation_rules VALUES (396, 'Probable use of Medium-risk applications', 1, 2, 2, 'Lateral Movement', 'Application Layer Protocol', 'The Sophos firewall device has detected a use of medium risked applications in enterprise environment like <strong>NetFlix</strong>. Please see the logs attached to this alert for additional details.', '["https://attack.mitre.org/tactics/TA0008/"]', '!(safe("log.subType", "") in ["Deny", "deny", "Drop", "drop", "Denied", "denied", "Dropped", "dropped"]) && safe("log.application", "").matches("(Avast Antivirus|NetFlix|McAfee Antivirus|AVG Antivirus)") ||
safe("log.applicationName", "").matches("(Avast Antivirus|NetFlix|McAfee Antivirus|AVG Antivirus)")
', '2025-09-03 15:06:06.467183', true, false, 'origin', NULL, '[]');
INSERT INTO public.utm_correlation_rules VALUES (272, 'MFA Disabled for Privileged Azure AD User', 3, 3, 1, 'Credential Access, Defense Evasion, Persistence', 'T1556 - Modify Authentication Process', 'Detects when Multi-Factor Authentication (MFA) is disabled for privileged users in Azure AD. This could indicate an attempt to weaken security controls for unauthorized access.

Next Steps:
1. Verify if the MFA disable action was authorized and legitimate
2. Check who initiated the change and from which IP address
3. Review the user''s recent login activity and permissions
4. Ensure the user account has not been compromised
5. Re-enable MFA if the change was unauthorized
6. Consider implementing conditional access policies to prevent unauthorized MFA changes
', '["https://learn.microsoft.com/en-us/entra/identity/authentication/howto-mfa-reporting","https://attack.mitre.org/techniques/T1556/"]', '(safe("log.operationName", "") == "Disable Strong Authentication" || safe("log.operationName", "") == "Update user") && safe("log.service", "") == "Authentication Methods" && (safe("log.targetUserPrincipalName", "").contains("admin") || safe("log.targetUserPrincipalName", "").contains("globaladmin") || safe("log.targetDisplayName", "").contains("Administrator"))', '2025-09-03 13:24:03.429539', true, false, 'origin', '["log.targetUserPrincipalName","log.correlationId"]', '[]');
INSERT INTO public.utm_correlation_rules VALUES (282, 'Microsoft 365 New Inbox Rule Created', 3, 2, 1, 'Email Collection', 'Collection', 'Credential Access consists of techniques for stealing credentials like account names and passwords. Techniques used to get credentials include keylogging or credential dumping. Using legitimate credentials can give adversaries access to systems, make them harder to detect, and provide the opportunity to create more accounts to help achieve their goals.<br> Identifies when a new Inbox rule is created in Microsoft 365. Inbox rules process messages in the Inbox based on conditions and take actions, such as moving a message to a specified folder or deleting a message. Adequate permissions are required on the mailbox to create an Inbox rule.', '["https://docs.microsoft.com/en-us/microsoft-365/security/office-365-security/responding-to-a-compromised-email-account?view=o365-worldwide","https://docs.microsoft.com/en-us/powershell/module/exchange/new-inboxrule?view=exchange-ps","https://docs.microsoft.com/en-us/microsoft-365/security/office-365-security/detect-and-remediate-outlook-rules-forms-attack?view=o365-worldwide","https://attack.mitre.org/techniques/T1114/","https://attack.mitre.org/techniques/T1114/003/","https://attack.mitre.org/tactics/TA0009/"]', 'safe("log.workLoad", "") == ''Exchange'' && safe("action", "") == ''New-InboxRule'' && safe("actionResult", "") in [''Success'',''PartiallySucceeded'',''True'']', '2025-09-03 14:45:33.648782', true, false, 'origin', NULL, '[]');
INSERT INTO public.utm_correlation_rules VALUES (1245, 'Virtual Machine Escape Detection', 3, 3, 3, 'Privilege Escalation', 'T1611 - Escape to Host', 'Detects VM escape attempts through abnormal guest operations, suspicious VMware Tools activity, or attempts to access host resources from guest VMs. VM escape is a critical security event where an attacker breaks out of virtual machine containment to access the hypervisor or host system.

Next Steps:
1. Immediately isolate the affected virtual machine from the network
2. Review VMware ESXi host logs for additional suspicious activities
3. Check for unauthorized VIB installations or modifications
4. Verify VMware Tools integrity and version on affected VMs
5. Scan the VM for malware and examine running processes
6. Review VM configuration files for unauthorized changes
7. Update VMware ESXi to latest security patches
8. Consider forensic analysis of the VM if compromise is confirmed
', '["https://attack.mitre.org/techniques/T1611/","https://www.csoonline.com/article/3837874/vmware-esxi-gets-critical-patches-for-in-the-wild-virtual-machine-escape-attack.html","https://blogs.vmware.com/security/2022/09/esxi-targeting-ransomware-the-threats-that-are-after-your-virtual-machines-part-1.html"]', '(safe("log.message", "").matches("(?i)guest.*(operation|ops)") && safe("log.message", "").matches("(?i)(failed|denied|error|unauthorized)")) ||
(safe("log.message", "").matches("(?i)vmware.*tools") && safe("log.message", "").matches("(?i)(exploit|malicious|unauthorized|abnormal)")) ||
(safe("log.message", "").matches("(?i)(vmdk|vswp)") && safe("log.message", "").matches("(?i)(modify|rename|delete)") && !safe("log.process", "").matches("(?i)(vmware|esxcli)")) ||
(safe("log.message", "").matches("(?i)vib.*install") && safe("log.message", "").matches("(?i)(malicious|unsigned|failed)")) ||
safe("log.eventInfo", "").matches("(?i)(vm.*escape|breakout|containment.*breach)")
', '2025-09-04 19:00:49.925128', true, false, 'origin', '["origin.hostname","log.process"]', '[]');
INSERT INTO public.utm_correlation_rules VALUES (1246, 'VMFS Corruption Detection', 1, 3, 3, 'Impact', 'Data Corruption', 'Detects potential VMFS corruption attempts or errors that could indicate malicious activity or system failures. Monitors for disk I/O errors, medium errors, and uncorrectable read errors in VMkernel logs. VMFS corruption can lead to data loss, virtual machine unavailability, and potential security incidents if caused by malicious activity.

Next Steps:
1. Immediately verify the health of the affected ESXi host and storage infrastructure
2. Check vCenter Server and ESXi logs for related storage errors or hardware failures
3. Examine storage array logs and hardware monitoring systems for disk failures
4. Verify VMFS datastore integrity using vSphere Client or PowerCLI commands
5. Review recent configuration changes, maintenance activities, or user access to the environment
6. Check for signs of ransomware or malicious activity targeting the storage infrastructure
7. Consider isolating affected datastores if corruption is widespread
8. Implement backup restoration procedures if data integrity is compromised
9. Document findings and coordinate with storage and virtualization teams for remediation
', '["https://docs.vmware.com/en/VMware-vSphere/7.0/com.vmware.vsphere.monitoring.doc/GUID-832A2618-6B11-4A28-9672-93296DA931D0.html","https://attack.mitre.org/techniques/T1485/"]', 'safe("log.message", "").contains("Device I/O error") ||
safe("log.message", "").contains("Medium Error Detected") ||
safe("log.message", "").contains("Uncorrectable error in data") ||
safe("log.message", "").contains("Redo log corrupted") ||
safe("log.message", "").contains("Storage Error: Device") ||
safe("log.message", "").contains("Unrecovered read error") ||
(safe("log.message", "").contains("VMFS") && (safe("log.message", "").contains("corrupt") || safe("log.message", "").contains("invalid") || safe("log.message", "").contains("missing")))
', '2025-09-04 19:00:50.885007', true, false, 'origin', '["origin.hostname"]', '[]');
INSERT INTO public.utm_correlation_rules VALUES (1247, 'VMkernel Interface Abuse Detection', 3, 3, 2, 'Lateral Movement', 'T1210 - Exploitation of Remote Services', 'Detects suspicious activities on VMkernel interfaces including unauthorized configuration changes, abnormal traffic patterns, or attempts to abuse management, vMotion, or vSAN interfaces. VMkernel interfaces are critical for ESXi host communication and management, making them high-value targets for attackers seeking to compromise virtualized infrastructure.

Next Steps:
1. Verify the legitimacy of any VMkernel interface configuration changes by checking with system administrators
2. Review ESXi host logs for additional suspicious activities around the time of the alert
3. Check for unauthorized access to vCenter Server or ESXi management interfaces
4. Examine network traffic patterns on affected VMkernel interfaces
5. Validate that only authorized users have access to modify VMkernel interface configurations
6. Consider implementing additional monitoring on critical VMkernel interfaces
7. Review vMotion and vSAN traffic for anomalies if those services are affected
', '["https://docs.vmware.com/en/VMware-vSphere/8.0/vsphere-security/GUID-F35D7005-58EB-48AC-99D5-B9942EB2A8EF.html","https://attack.mitre.org/techniques/T1210/"]', '(
  (safe("log.message", "").matches("(?i)vmk[0-9]+.*config.*change") ||
   safe("log.message", "").matches("(?i)vmkernel.*interface.*add") ||
   safe("log.message", "").matches("(?i)vmkernel.*interface.*remove") ||
   safe("log.message", "").matches("(?i)vmk.*ip.*address.*change") ||
   safe("log.message", "").matches("(?i)vmkernel.*port.*fail") ||
   safe("log.message", "").matches("(?i)vmk.*unauthorized.*access") ||
   safe("log.message", "").matches("(?i)management.*traffic.*vmk") ||
   safe("log.message", "").matches("(?i)vmotion.*interface.*abuse") ||
   safe("log.message", "").matches("(?i)vsan.*interface.*tamper")) &&
  safe("log.process", "") == "vmkernel"
) ||
(safe("log.eventInfo", "").matches("(?i)vmk.*security.*violation"))
', '2025-09-04 19:00:51.404043', true, false, 'origin', '["origin.hostname"]', '[]');
INSERT INTO public.utm_correlation_rules VALUES (1333, 'Windows: Detection of Exchange mail exported through PowerShell', 3, 1, 1, 'Collection', 'Data from Local System', 'This rule identifies the use of an Exchange PowerShell cmdlet, which is used to export the contents of a core file. mailbox or archive to a .pst file. Adversaries can target user email to collect sensitive information.', '["https://attack.mitre.org/tactics/TA0009/","https://attack.mitre.org/techniques/T1005/","https://attack.mitre.org/techniques/T1114/","https://attack.mitre.org/techniques/T1114/002/"]', 'safe("log.winlogEventDataProcessName", "").matches(''(powershell.exe|pwsh.exe|powershell_ise.exe)'') && safe("log.message", "").matches(''(New-MailboxExportRequest)'')', '2025-09-04 20:23:53.29133', true, false, 'origin', NULL, '[]');
INSERT INTO public.utm_correlation_rules VALUES (275, 'Resource Group Mass Modifications', 2, 3, 3, 'Impact', 'T1496 - Resource Hijacking', 'Detects mass modifications to Azure resource groups which could indicate unauthorized infrastructure changes or resource hijacking attempts. This rule triggers when multiple resource group write or delete operations are performed by the same user from the same IP address within a 15-minute window.

Next Steps:
1. Investigate the user account (log.aadObjectId) performing the modifications
2. Review the specific resource groups being modified
3. Check if the operations align with scheduled maintenance or legitimate business activities
4. Verify the source IP address and geolocation for suspicious activity
5. Review Azure Activity Logs for the full scope of changes made
6. Check for any privilege escalation or unauthorized access to the account
7. If malicious, immediately revoke access and assess impact on affected resources
', '["https://learn.microsoft.com/en-us/azure/azure-monitor/essentials/activity-log-schema","https://attack.mitre.org/techniques/T1496/"]', 'safe("log.operationName", "").contains("Microsoft.Resources/subscriptions/resourceGroups") && (safe("log.operationName", "").contains("/write") || safe("log.operationName", "").contains("/delete")) && safe("log.category", "") == "Administrative" && safe("log.resultSignature", "") == "Succeeded"', '2025-09-03 13:25:42.243933', true, false, 'origin', NULL, '[]');
INSERT INTO public.utm_correlation_rules VALUES (276, 'Suspicious Service Principal Activity Detected', 3, 3, 2, 'Persistence, Privilege Escalation', 'T1098 - Account Manipulation', 'Detects potential abuse of service principals by monitoring for unusual sign-in patterns, permission changes, or suspicious API calls. This could indicate compromised service principal credentials or malicious usage.

Next Steps:
1. Investigate the service principal identity (Application ID) and its legitimate use cases
2. Review recent permission changes or role assignments for the service principal
3. Check for any unauthorized API calls or unusual access patterns from this service principal
4. Verify the legitimacy of the source IP address and geolocation
5. Examine authentication logs for any other suspicious activities related to this service principal
6. Review the service principal''s assigned roles and permissions for privilege escalation
7. Consider rotating service principal credentials if compromise is suspected
8. Check if the service principal is being used from unexpected locations or applications
9. Validate that the service principal''s usage aligns with its intended purpose
', '["https://www.cloud-architekt.net/auditing-of-msi-and-service-principals/","https://attack.mitre.org/techniques/T1098/"]', 'safe("log.category", "") == "ServicePrincipal" && (safe("log.operationName", "").contains("ServicePrincipal") || safe("log.loggedByService", "") == "Core Directory") && (safe("log.resultType", "") != "0" || safe("log.result", "") == "failure" || safe("log.operationName", "").contains("role") || safe("log.operationName", "").contains("permission"))', '2025-09-03 13:25:42.904262', true, false, 'origin', '["log.servicePrincipalId","origin.ip"]', '[{"indexPattern":"v11-log-azure-*","with":[{"field":"log.servicePrincipalId.keyword","operator":"filter_term","value":"{{.safe(\"log.servicePrincipalId\", \"\")}}"},{"field":"origin.ip.keyword","operator":"filter_term","value":"{{.origin.ip}}"}],"or":null,"within":"now-2h","count":5}]');
INSERT INTO public.utm_correlation_rules VALUES (277, 'SQL Database Firewall Rule Modifications', 3, 2, 1, 'Lateral Movement', 'Remote Services', 'Detects modifications to Azure SQL Database firewall rules which could allow unauthorized access to sensitive data. This includes both creation and deletion of firewall rules that control network access to SQL databases.

Next Steps:
1. Verify the legitimacy of the firewall rule modification
2. Check if the change was authorized and documented
3. Review the source IP and user making the modification
4. Assess if the new firewall rule creates security risks
5. Monitor for subsequent database access attempts from newly allowed IPs
6. Review Azure Activity Logs for related database activities
', '["https://learn.microsoft.com/en-us/azure/azure-monitor/essentials/activity-log-schema","https://attack.mitre.org/techniques/T1021/"]', 'safe("log.operationName", "").contains("Microsoft.Sql/servers") && (safe("log.operationName", "").contains("/firewallRules/write") || safe("log.operationName", "").contains("/firewallRules/delete")) && safe("log.category", "") == "Administrative" && actionResult == "accepted"', '2025-09-03 13:25:43.589591', true, false, 'origin', '["origin.ip","log.resourceId"]', '[]');
INSERT INTO public.utm_correlation_rules VALUES (278, 'Storage Account Public Access Enabled', 3, 2, 1, 'Collection', 'T1530 - Data from Cloud Storage Object', 'Detects when public access is enabled on Azure Storage Accounts which could lead to unauthorized data exposure. 
This configuration change creates a significant security risk as it allows anonymous access to stored data.

Next Steps:
1. Immediately review the affected storage account configuration
2. Verify if public access was intentionally enabled and properly authorized
3. Check if any sensitive data is stored in the account
4. Review access logs for any unauthorized access attempts
5. Consider disabling public access if not required for business operations
6. Implement network restrictions and access policies if public access is necessary
7. Monitor for any data exfiltration activities
', '["https://learn.microsoft.com/en-us/azure/azure-monitor/essentials/activity-log-schema","https://attack.mitre.org/techniques/T1530/"]', 'safe("log.operationName", "").contains("Microsoft.Storage/storageAccounts") && (safe("log.operationName", "").contains("/write") || safe("log.operationName", "").contains("/blobServices/write")) && safe("log.category", "") == "Administrative" && safe("log.actionResult", "") == "accepted" && (safe("log.properties", "").contains("allowBlobPublicAccess") || safe("log.properties", "").contains("publicAccess"))', '2025-09-03 13:25:44.284085', true, false, 'origin', '["log.resourceId","log.aadObjectId"]', '[]');
INSERT INTO public.utm_correlation_rules VALUES (279, 'Azure Subscription Ownership Transfer Detected', 3, 3, 2, 'Defense Evasion, Persistence, Privilege Escalation, Initial Access', 'T1078 - Valid Accounts', 'Detects when ownership of an Azure subscription is transferred by monitoring role assignment changes at the subscription level. This could indicate unauthorized access or insider threat activity.

Next Steps:
1. Verify the legitimacy of the ownership transfer with the subscription administrator
2. Check if the user performing the transfer is authorized for this action
3. Review the timing and context of the transfer (business hours, planned change)
4. Examine other recent activities by the same user or from the same source IP
5. Validate that proper change management procedures were followed
6. Check for any unusual activity following the ownership transfer
7. If unauthorized, immediately revoke the new owner''s access and escalate to security team
', '["https://learn.microsoft.com/en-us/azure/role-based-access-control/change-history-report","https://attack.mitre.org/techniques/T1078/"]', 'safe("log.operationName", "") == "Microsoft.Authorization/roleAssignments/write" && safe("log.properties", "").contains("Owner") && safe("log.category", "") == "Administrative" && safe("log.resourceId", "").contains("/subscriptions/") && !safe("log.resourceId", "").contains("/resourceGroups/")', '2025-09-03 13:25:45.203114', true, false, 'origin', NULL, '[]');
INSERT INTO public.utm_correlation_rules VALUES (280, 'Virtual Machine Suspicious Activities', 2, 2, 3, 'Defense Evasion', 'T1578 - Modify Cloud Compute Infrastructure', 'Detects suspicious activities on Azure Virtual Machines including rapid creation, deletion, or configuration changes that could indicate compromise or abuse. This rule triggers when multiple VM operations are performed from the same IP address within a short timeframe.

Next Steps:
1. Review the specific VM operations performed and verify if they are legitimate business activities
2. Check the user account and IP address associated with the activities for any signs of compromise
3. Examine the timing and frequency of operations to determine if they follow normal usage patterns
4. Verify if the operations were performed during expected business hours
5. Check for any associated alerts or anomalies in authentication logs
6. Review VM configurations and access logs for any unauthorized changes
7. Contact the resource owner to confirm if the activities were authorized
', '["https://learn.microsoft.com/en-us/azure/azure-monitor/essentials/activity-log-schema","https://attack.mitre.org/techniques/T1578/"]', 'safe("log.operationName", "").contains("Microsoft.Compute/virtualMachines") && (safe("log.operationName", "").contains("/write") || safe("log.operationName", "").contains("/delete") || safe("log.operationName", "").contains("/restart/action") || safe("log.operationName", "").contains("/powerOff/action")) && safe("log.category", "") == "Administrative" && safe("log.resultSignature", "") == "Succeeded"', '2025-09-03 13:25:45.924832', true, false, 'origin', '["origin.ip","safe(\"log.correlationId\", \"\")"]', '[{"indexPattern":"v11-log-azure-*","with":[{"field":"origin.ip.keyword","operator":"filter_term","value":"{{.origin.ip}}"}],"or":null,"within":"now-10m","count":8}]');
INSERT INTO public.utm_correlation_rules VALUES (283, 'Attempts to Brute Force a Microsoft 365 User Account', 3, 3, 3, 'Brute Force', 'Credential Access', 'Credential Access consists of techniques for stealing credentials like account names and passwords. Techniques used to get credentials include keylogging or credential dumping. Using legitimate credentials can give adversaries access to systems, make them harder to detect, and provide the opportunity to create more accounts to help achieve their goals.<br> Identifies attempts to brute force a Microsoft 365 user account. An adversary may attempt a brute force attack to obtain unauthorized access to user accounts.', '["https://attack.mitre.org/techniques/T1110/","https://attack.mitre.org/tactics/TA0006/"]', 'safe("log.workLoad", "") in [''Exchange'', ''AzureActiveDirectory''] && safe("action", "") in [''UserLoginFailed'', ''PasswordLogonInitialAuthUsingPassword''] && safe("actionResult", "") in [''Failed'', ''False'']', '2025-09-03 14:45:34.863393', true, false, 'origin', NULL, '[{"indexPattern":"v11-log-o365-*","with":[{"field":"origin.user.keyword","operator":"filter_term","value":"{{origin.user}}"}],"or":null,"within":"now-60s","count":5}]');
INSERT INTO public.utm_correlation_rules VALUES (284, 'Potential Password Spraying of Microsoft 365 User Accounts', 3, 2, 2, 'Brute Force', 'Credential Access', 'Credential Access consists of techniques for stealing credentials like account names and passwords. Techniques used to get credentials include keylogging or credential dumping. Using legitimate credentials can give adversaries access to systems, make them harder to detect, and provide the opportunity to create more accounts to help achieve their goals.<br> Identifies a high number (25) of failed Microsoft 365 user authentication attempts from a single IP address within 30 minutes, which could be indicative of a password spraying attack. An adversary may attempt a password spraying attack to obtain unauthorized access to user accounts.', '["https://attack.mitre.org/techniques/T1110/","https://attack.mitre.org/tactics/TA0006/"]', 'safe("log.workLoad", "") in [''Exchange'', ''AzureActiveDirectory''] && safe("action", "") in [''UserLoginFailed'', ''PasswordLogonInitialAuthUsingPassword''] && safe("actionResult", "") in [''Failed'', ''False'']', '2025-09-03 14:45:36.106718', true, false, 'origin', NULL, '[{"indexPattern":"v11-log-o365-*","with":[{"field":"origin.ip.keyword","operator":"filter_term","value":"{{origin.ip}}"}],"or":null,"within":"now-60s","count":5}]');
INSERT INTO public.utm_correlation_rules VALUES (285, 'O365 Excessive Single Sign-On Logon Errors', 2, 3, 2, 'Brute Force', 'Credential Access', 'Credential Access consists of techniques for stealing credentials like account names and passwords. Techniques used to get credentials include keylogging or credential dumping. Using legitimate credentials can give adversaries access to systems, make them harder to detect, and provide the opportunity to create more accounts to help achieve their goals.<br> Identifies accounts with a high number of single sign-on (SSO) logon errors. Excessive logon errors may indicate an attempt to brute force a password or SSO token.', '["https://attack.mitre.org/techniques/T1110/","https://attack.mitre.org/tactics/TA0006/"]', 'safe("log.workLoad", "") == ''AzureActiveDirectory'' && safe("log.LogonError", "") == ''SsoArtifactInvalidOrExpired''', '2025-09-03 14:45:36.824641', true, false, 'origin', NULL, '[]');
INSERT INTO public.utm_correlation_rules VALUES (286, 'Microsoft 365 Exchange DLP Policy Removed', 3, 3, 2, 'Impair Defenses', 'Defense Evasion', 'Defense Evasion consists of techniques that adversaries use to avoid detection throughout their compromise. Techniques used for defense evasion include uninstalling/disabling security software or obfuscating/encrypting data and scripts. Adversaries also leverage and abuse trusted processes to hide and masquerade their malware. Other tacticsâ€™ techniques are cross-listed here when those techniques include the added benefit of subverting defenses.<br> Identifies when a Data Loss Prevention (DLP) policy is removed in Microsoft 365. An adversary may remove a DLP policy to evade existing DLP monitoring.', '["https://docs.microsoft.com/en-us/microsoft-365/compliance/data-loss-prevention-policies?view=o365-worldwide","https://attack.mitre.org/techniques/T1562/","https://attack.mitre.org/tactics/TA0005/"]', 'safe("log.workLoad", "") == ''Exchange'' && safe("action", "") == ''Remove-DlpPolicy'' && safe("actionResult", "") in [''Success'',''PartiallySucceeded'',''True'']', '2025-09-03 14:45:37.635397', true, false, 'origin', NULL, '[]');
INSERT INTO public.utm_correlation_rules VALUES (288, 'Microsoft 365 Exchange Malware Filter Rule Modification', 3, 3, 2, 'Impair Defenses', 'Defense Evasion', 'Defense Evasion consists of techniques that adversaries use to avoid detection throughout their compromise. Techniques used for defense evasion include uninstalling/disabling security software or obfuscating/encrypting data and scripts. Adversaries also leverage and abuse trusted processes to hide and masquerade their malware. Other tacticsâ€™ techniques are cross-listed here when those techniques include the added benefit of subverting defenses.<br> Identifies when a malware filter rule has been deleted or disabled in Microsoft 365. An adversary or insider threat may want to modify a malware filter rule to evade detection.', '["https://attack.mitre.org/techniques/T1562/","https://attack.mitre.org/tactics/TA0005/"]', 'safe("log.workLoad", "") == ''Exchange'' && safe("action", "") in [''Remove-MalwareFilterRule'',''Disable-MalwareFilterRule''] && safe("actionResult", "") in [''Success'',''PartiallySucceeded'',''True'']', '2025-09-03 14:45:38.802841', true, false, 'origin', NULL, '[]');
INSERT INTO public.utm_correlation_rules VALUES (289, 'Microsoft 365 Exchange Safe Attachment Rule Disabled', 3, 3, 2, 'Impair Defenses', 'Defense Evasion', 'Defense Evasion consists of techniques that adversaries use to avoid detection throughout their compromise. Techniques used for defense evasion include uninstalling/disabling security software or obfuscating/encrypting data and scripts. Adversaries also leverage and abuse trusted processes to hide and masquerade their malware. Other tacticsâ€™ techniques are cross-listed here when those techniques include the added benefit of subverting defenses.<br> Identifies when a safe attachment rule is disabled in Microsoft 365. Safe attachment rules can extend malware protections to include routing all messages and attachments without a known malware signature to a special hypervisor environment. An adversary or insider threat may disable a safe attachment rule to exfiltrate data or evade defenses.', '["https://attack.mitre.org/techniques/T1562/","https://attack.mitre.org/tactics/TA0005/"]', 'safe("log.workLoad", "") = ''Exchange'' && safe("action", "") == ''Disable-SafeAttachmentRule'' && safe("actionResult", "") in [''Success'',''PartiallySucceeded'',''True'']', '2025-09-03 14:45:39.482655', true, false, 'origin', NULL, '[]');
INSERT INTO public.utm_correlation_rules VALUES (290, 'Microsoft 365 Detection of a connection to a .onion domain', 3, 2, 2, 'Software', 'Command and Control', 'Tor is a software suite and network that provides increased anonymity on the Internet.  It creates a multi-hop proxy network and utilizes multilayer encryption to  protect both the message and routing information. Tor utilizes Onion Routing,  in which messages are encrypted with multiple layers of encryption; at each step in the proxy network,  the topmost layer is decrypted and the contents forwarded on to the next node until it reaches its destination.', '["https://attack.mitre.org/software/S0183/","https://attack.mitre.org/software/"]', 'safe("log.siteUrl", "").contains(".onion")', '2025-09-03 14:45:40.18758', true, false, 'target', NULL, '[]');
INSERT INTO public.utm_correlation_rules VALUES (347, 'Possible expiration detected in Sophos Central', 2, 2, 2, 'Expiration', 'Obtain Capabilities', 'Your installed certificate, license or token will expire in the next few days', '["https://support.sophos.com/support/s/article/KB-000037006?language=en_US"]', 'safe("log.type", "").matches("Event::Task::(RenewLicense|RenewApiToken|RenewApnsCertificate)|Event(.|::)Firewall::ReportingXgsLicenseNotification|Event::Smc::Renew|Event::Endpoint::Smc::RenewInstalledCertificate::")', '2025-09-03 15:00:16.644582', true, false, 'origin', NULL, '[]');
INSERT INTO public.utm_correlation_rules VALUES (291, 'Microsoft 365 Exchange Transport Rule Creation', 3, 2, 1, 'Transfer Data to Cloud Account', 'Exfiltration', 'Exfiltration consists of techniques that adversaries may use to steal data from your network. Once theyâ€™ve collected data, adversaries often package it to avoid detection while removing it. This can include compression and encryption. Techniques for getting data out of a target network typically include transferring it over their command and control channel or an alternate channel and may also include putting size limits on the transmission.<br> Identifies a transport rule creation in Microsoft 365. Exchange Online mail transport rules should be set to not forward email to domains outside of your organization as a best practice. An adversary may create transport rules to exfiltrate data.', '["https://docs.microsoft.com/en-us/exchange/security-and-compliance/mail-flow-rules/mail-flow-rules","https://attack.mitre.org/techniques/T1537/","https://attack.mitre.org/tactics/TA0010/"]', 'safe("log.workLoad", "") == ''Exchange'' && safe("action", "") == ''New-TransportRule'' && safe("actionResult", "") in [''Success'',''PartiallySucceeded'',''True'']', '2025-09-03 14:45:41.104795', true, false, 'origin', NULL, '[]');
INSERT INTO public.utm_correlation_rules VALUES (312, 'Exchange Admin Configuration Changes', 3, 3, 2, 'Persistence, Privilege Escalation', 'T1098 - Account Manipulation', 'Detects changes to Exchange administrative configuration that could impact security settings, user permissions, or mail flow policies. This rule monitors for successful execution of critical Exchange administrative cmdlets that can affect organizational security posture.

Next Steps:
1. Review the specific administrative action performed and verify it was authorized
2. Check if the user performing the action has appropriate privileges
3. Examine the timing and frequency of administrative changes
4. Validate configuration changes against change management policies
5. Review any related audit logs for the time period around the change
6. Confirm the source IP and location of the administrative session
7. If unauthorized, immediately review affected configurations and revert if necessary
', '["https://docs.microsoft.com/en-us/exchange/security-and-compliance/exchange-auditing-reports/view-administrator-audit-log","https://attack.mitre.org/techniques/T1098/"]', 'safe("action", "") in ["Set-AdminAuditLogConfig", "Set-TransportRule", "Set-MalwareFilterPolicy", "Set-HostedContentFilterPolicy", "Set-DkimSigningConfig", "Set-OrganizationConfig", "Set-RoleGroup", "Add-RoleGroupMember", "Remove-RoleGroupMember", "New-ManagementRoleAssignment", "Remove-ManagementRoleAssignment"] && 
safe("actionResult", "") == "Succeeded"
', '2025-09-03 14:48:59.997012', true, false, 'origin', '["origin.user","action"]', '[]');
INSERT INTO public.utm_correlation_rules VALUES (317, 'License Assignment Anomalies', 3, 3, 2, 'Defense Evasion, Persistence, Privilege Escalation, Initial Access', 'Valid Accounts', 'Detects anomalous license assignment activities including bulk assignments, unusual timing, or assignments of high-privilege licenses that could indicate unauthorized privilege escalation', '["https://learn.microsoft.com/en-us/azure/active-directory/reports-monitoring/concept-audit-logs","https://attack.mitre.org/techniques/T1078/004/"]', '(safe("action", "") in ["Change user license", "Update user", "Set-MsolUserLicense", "Add-MsolRoleMember", "Set-AzureADUserLicense"] ||
(safe("action", "").contains("license") && safe("action", "").contains("assign")) ||
(safe("log.ModifiedProperties", "").contains("AssignedLicense") ||
(safe("log.TargetResources", "").contains("license")) &&
safe("origin.user", "") != "" &&
safe("actionResult", "") == "Succeeded" &&
(safe("log.ModifiedProperties", "").contains("E5") || safe("log.ModifiedProperties", "").contains("E3") || safe("log.Parameters", "").contains("GlobalAdmin")
', '2025-09-03 14:49:03.862796', true, false, 'origin', '["origin.user","log.Target"]', '[{"indexPattern":"v11-log-*","with":[{"field":"origin.user.keyword","operator":"filter_term","value":"{{.origin.user}}"},{"field":"action.keyword","operator":"filter_terms","value":["Change user license","Update user","Set-MsolUserLicense"]}],"or":null,"within":"now-1h","count":5}]');
INSERT INTO public.utm_correlation_rules VALUES (1334, 'Windows: Remote Desktop Enabled in Windows Firewall by Netsh', 3, 3, 1, 'Defense Evasion', 'Disable or Modify System Firewall', 'Identifies use of the network shell utility (netsh.exe) to enable inbound Remote Desktop Protocol (RDP) connections in the Windows Firewall.', '["https://attack.mitre.org/tactics/TA0005/","https://attack.mitre.org/techniques/T1562/004/"]', 'safe("log.winlogEventDataProcessName", "").matches("netsh.exe") && safe("log.message", "").matches("(action=allow|enable=Yes|enable)") && safe("log.message", "").matches("(localport=3389|RemoteDesktop|group=(.+)remote desktop(.+))")', '2025-09-04 20:23:53.71151', true, false, 'origin', NULL, '[]');
INSERT INTO public.utm_correlation_rules VALUES (292, 'Microsoft 365 Exchange Transport Rule Modification', 3, 2, 1, 'Transfer Data to Cloud Account', 'Exfiltration', 'Exfiltration consists of techniques that adversaries may use to steal data from your network. Once theyâ€™ve collected data, adversaries often package it to avoid detection while removing it. This can include compression and encryption. Techniques for getting data out of a target network typically include transferring it over their command and control channel or an alternate channel and may also include putting size limits on the transmission.<br> Identifies when a transport rule has been disabled or deleted in Microsoft 365. Mail flow rules (also known as transport rules) are used to identify and take action on messages that flow through your organization. An adversary or insider threat may modify a transport rule to exfiltrate data or evade defenses.', '["https://docs.microsoft.com/en-us/exchange/security-and-compliance/mail-flow-rules/mail-flow-rules","https://attack.mitre.org/techniques/T1537/","https://attack.mitre.org/tactics/TA0010/"]', 'safe("log.Workload", "") == "Exchange" && safe("action", "") in ["Remove-TransportRule","Disable-TransportRule"] && safe("actionResult", "") in ["Success","PartiallySucceeded","True"]', '2025-09-03 14:46:10.477978', true, false, 'origin', NULL, '[]');
INSERT INTO public.utm_correlation_rules VALUES (293, 'Microsoft 365 Exchange Anti-Phish Policy Deletion', 2, 3, 2, 'Phishing', 'Initial Access', 'Adversaries may send phishing messages to gain access to victim systems. All forms of phishing are electronically delivered social engineering. Phishing can be targeted, known as spearphishing. In spearphishing, a specific individual, company, or industry will be targeted by the adversary. More generally, adversaries can conduct non-targeted phishing, such as in mass malware spam campaigns.<br> Adversaries may send victims emails containing malicious attachments or links, typically to execute malicious code on victim systems. Phishing may also be conducted via third-party services, like social media platforms. Phishing may also involve social engineering techniques, such as posing as a trusted source.<br> Identifies the deletion of an anti-phishing policy in Microsoft 365. By default, Microsoft 365 includes built-in features that help protect users from phishing attacks. Anti-phishing polices increase this protection by refining settings to better detect and prevent attacks.', '["https://docs.microsoft.com/en-us/microsoft-365/security/office-365-security/set-up-anti-phishing-policies?view=o365-worldwide","https://attack.mitre.org/techniques/T1566/","https://attack.mitre.org/tactics/TA0001/"]', 'safe("log.Workload", "") == "Exchange" && safe("action", "") == "Remove-AntiPhishPolicy" && safe("actionResult", "") in ["Success","PartiallySucceeded","True"]', '2025-09-03 14:46:11.038109', true, false, 'origin', NULL, '[]');
INSERT INTO public.utm_correlation_rules VALUES (294, 'Microsoft 365 Exchange Anti-Phish Rule Modification', 2, 3, 2, 'Phishing', 'Initial Access', 'Adversaries may send phishing messages to gain access to victim systems. All forms of phishing are electronically delivered social engineering. Phishing can be targeted, known as spearphishing. In spearphishing, a specific individual, company, or industry will be targeted by the adversary. More generally, adversaries can conduct non-targeted phishing, such as in mass malware spam campaigns.<br> Adversaries may send victims emails containing malicious attachments or links, typically to execute malicious code on victim systems. Phishing may also be conducted via third-party services, like social media platforms. Phishing may also involve social engineering techniques, such as posing as a trusted source.<br> Identifies the modification of an anti-phishing rule in Microsoft 365. By default, Microsoft 365 includes built-in features that help protect users from phishing attacks. Anti-phishing rules increase this protection by refining settings to better detect and prevent attacks.', '["https://attack.mitre.org/techniques/T1566/","https://attack.mitre.org/tactics/TA0001/"]', 'safe("log.Workload", "") == "Exchange" && safe("action", "") in ["Remove-AntiPhishRule","Disable-AntiPhishRule"] && safe("actionResult", "") in ["Success","PartiallySucceeded","True"]', '2025-09-03 14:46:11.581726', true, false, 'origin', NULL, '[]');
INSERT INTO public.utm_correlation_rules VALUES (295, 'Microsoft 365 Exchange Safe Link Policy Disabled', 3, 2, 2, 'Phishing', 'Initial Access', 'When it comes to protecting its users, Microsoft takes the threat of phishing seriously. Spoofing is a common technique that''s  used by attackers. Spoofed messages appear to originate from someone or somewhere other than the actual source. This technique is often  used in phishing campaigns that are designed to obtain user credentials. The anti-spoofing technology in EOP specifically examines forgery of the From header in the message body (used to display the message sender in email clients). When EOP has high confidence that the From header is forged, the message is identified as spoofed.<br> Identifies when a Safe Link policy is disabled in Microsoft 365. Safe Link policies for Office applications extend phishing protection to documents that contain hyperlinks, even after they have been delivered to a user.', '["https://docs.microsoft.com/en-us/microsoft-365/security/office-365-security/atp-safe-links?view=o365-worldwide","https://attack.mitre.org/techniques/T1566/"]', 'safe("log.Workload", "") == "Exchange" && safe("action", "") == "Disable-SafeLinksRule" && safe("actionResult", "") in ["Success","PartiallySucceeded","True"]', '2025-09-03 14:46:12.07715', true, false, 'origin', NULL, '[]');
INSERT INTO public.utm_correlation_rules VALUES (296, 'Microsoft 365 Exchange DKIM Signing Configuration Disabled', 3, 3, 1, 'Phishing', 'Spoofing', 'When it comes to protecting its users, Microsoft takes the threat of phishing seriously. Spoofing is a common technique that''s  used by attackers. Spoofed messages appear to originate from someone or somewhere other than the actual source. This technique is often  used in phishing campaigns that are designed to obtain user credentials. The anti-spoofing technology in EOP specifically examines forgery of the From header in the message body (used to display the message sender in email clients). When EOP has high confidence that the From header is forged, the message is identified as spoofed.<br> Identifies when a DomainKeys Identified Mail (DKIM) signing configuration is disabled in Microsoft 365. With DKIM in Microsoft 365, messages that are sent from Exchange Online will be cryptographically signed. This will allow the receiving email system to validate that the messages were generated by a server that the organization authorized and not being spoofed.', '["https://docs.microsoft.com/en-us/microsoft-365/security/office-365-security/anti-spoofing-protection?view=o365-worldwide"]', 'safe("log.Workload", "") == "Exchange" && safe("action", "") == "Set-DkimSigningConfig" && safe("actionResult", "") in ["Success","PartiallySucceeded","True"]', '2025-09-03 14:46:13.293683', true, false, 'origin', NULL, '[]');
INSERT INTO public.utm_correlation_rules VALUES (297, 'Microsoft 365 Teams Custom Application Interaction Allowed', 2, 2, 2, 'Teams Configuration Management', 'Maintain access', 'Identifies when custom applications are allowed in Microsoft Teams. If an organization requires applications other than those available in the Teams app store, custom applications can be developed as packages and uploaded. An adversary may abuse this behavior to establish persistence in an environment.', '["https://docs.microsoft.com/en-us/microsoftteams/platform/concepts/deploy-and-publish/apps-upload"]', 'safe("log.Workload", "") == "Exchange" && safe("action", "") == "TeamsTenantSettingChanged" && safe("actionResult", "") in ["Success","PartiallySucceeded","True"]', '2025-09-03 14:46:13.757502', true, false, 'origin', NULL, '[]');
INSERT INTO public.utm_correlation_rules VALUES (298, 'Microsoft 365 Exchange Management Group Role Assignment', 2, 3, 2, 'Account Manipulation', 'Persistence', 'Adversaries may manipulate accounts to maintain access to victim systems. Account manipulation may consist of any action that preserves adversary access to a compromised account, such as modifying credentials or permission groups. These actions could also include account activity designed to subvert security policies,  such as performing iterative password updates to bypass password duration policies and preserve the life of compromised credentials. In order to create or  manipulate accounts, the adversary must already have sufficient permissions on systems or the domain.<br> Identifies when a new role is assigned to a management group in Microsoft 365. An adversary may attempt to add a role in order to maintain persistence in an environment.', '["https://docs.microsoft.com/en-us/microsoft-365/admin/add-users/about-admin-roles?view=o365-worldwide","https://attack.mitre.org/tactics/TA0003/","https://attack.mitre.org/techniques/T1098"]', 'safe("log.Workload", "") == "Exchange" && safe("action", "") == "New-ManagementRoleAssignment" && safe("actionResult", "") in ["Success","PartiallySucceeded","True"]', '2025-09-03 14:46:14.44419', true, false, 'origin', NULL, '[]');
INSERT INTO public.utm_correlation_rules VALUES (299, 'Microsoft 365 Teams External Access Enabled', 3, 2, 2, 'Account Manipulation', 'Persistence', 'Adversaries may manipulate accounts to maintain access to victim systems. Account manipulation may consist of any action that preserves adversary access to a compromised account, such as modifying credentials or permission groups. These actions could also include account activity designed to subvert security policies,  such as performing iterative password updates to bypass password duration policies and preserve the life of compromised credentials. In order to create or  manipulate accounts, the adversary must already have sufficient permissions on systems or the domain.<br> Identifies when external access is enabled in Microsoft Teams. External access lets Teams and Skype for Business users communicate with other users that are outside their organization. An adversary may enable external access or add an allowed domain to exfiltrate data or maintain persistence in an environment.', '["https://docs.microsoft.com/en-us/microsoftteams/manage-external-access","https://attack.mitre.org/tactics/TA0003/","https://attack.mitre.org/techniques/T1098"]', 'safe("log.Workload", "") in ["SkypeForBusiness","MicrosoftTeams"] && safe("action", "") == "Set-CsTenantFederationConfiguration" && safe("actionResult", "") in ["Success","PartiallySucceeded","True"]', '2025-09-03 14:46:15.52316', true, false, 'origin', NULL, '[]');
INSERT INTO public.utm_correlation_rules VALUES (300, 'Microsoft 365 Teams Guest Access Enabled', 3, 2, 2, 'Account Manipulation', 'Persistence', 'Adversaries may manipulate accounts to maintain access to victim systems. Account manipulation may consist of any action that preserves adversary access to a  compromised account, such as modifying credentials or permission groups. These actions could also include account activity designed to subvert security policies,  such as performing iterative password updates to bypass password duration policies and preserve the life of compromised credentials. In order to create or  manipulate accounts, the adversary must already have sufficient permissions on systems or the domain.<br> Identifies when guest access is enabled in Microsoft Teams. Guest access in Teams allows people outside the organization to access teams and channels. An adversary may enable guest access to maintain persistence in an environment. <br> The Microsoft 365 Fleet integration, Filebeat module, or similarly structured data is required to be compatible with this rule.', '["https://attack.mitre.org/tactics/TA0003/","https://attack.mitre.org/techniques/T1098"]', 'safe("log.Workload", "") in ["SkypeForBusiness","MicrosoftTeams"] && safe("action", "") == "New-ManagementRoleAssignment" && safe("actionResult", "") in ["Success","PartiallySucceeded","True"]', '2025-09-03 14:46:16.284184', true, false, 'origin', NULL, '[]');
INSERT INTO public.utm_correlation_rules VALUES (301, 'Microsoft 365 Possible Succesfull Password Guessing detected', 3, 2, 2, 'Credential Access', 'Brute Force: Password Guessing', 'Adversaries with no prior knowledge of legitimate credentials within the system or environment  may guess passwords to attempt access to accounts. Without knowledge of the password for an account,  an adversary may opt to systematically guess the password using a repetitive or iterative mechanism.  An adversary may guess login credentials without prior knowledge of system or environment passwords  during an operation by using a list of common passwords. Password guessing may or may not take into  account the target''s policies on password complexity or use policies that may lock accounts out after  a number of failed attempts.', '["https://attack.mitre.org/tactics/TA0006","https://attack.mitre.org/techniques/T1110/001/"]', 'safe("log.Workload", "") in ["Exchange","AzureActiveDirectory"] && safe("log.Operation", "") == "UserLoginFailed" && safe("log.ResultStatus", "") in ["Failed","False"]', '2025-09-03 14:46:16.868975', true, false, 'origin', NULL, '[{"indexPattern":"v11-log-o365-*","with":[{"field":"log.Workload.keyword","operator":"filter_term","value":"Exchange, AzureActiveDirectory"},{"field":"log.Operation.keyword","operator":"filter_term","value":"UserLoginFailed"},{"field":"log.ResultStatus.keyword","operator":"filter_term","value":"Failed,False"},{"field":"log.UserId.keyword","operator":"filter_term","value":"{{.log.UserId}}"},{"field":"log.ClientIp.keyword","operator":"filter_term","value":"{{.log.ClientIp}}"}],"or":null,"within":"now-1m","count":10}]');
INSERT INTO public.utm_correlation_rules VALUES (302, 'Office 365 Anti-Phishing Policy Bypass Detected', 3, 3, 1, 'Defense Evasion', 'T1562.001 - Impair Defenses: Disable or Modify Tools', 'Detects potential bypasses or modifications to anti-phishing policies including changes to safe sender lists, domain exclusions, or policy disabling that could allow phishing emails to reach users. This rule identifies successful administrative actions on anti-phishing configurations that could weaken email security defenses.

Next Steps:
1. Review the specific anti-phishing policy changes made by the user
2. Verify if the changes were authorized and documented in change management
3. Check if the user has legitimate administrative privileges for email security policies
4. Examine the timing and context of the changes (e.g., during business hours vs. off-hours)
5. Look for any subsequent phishing emails that may have bypassed detection
6. Consider rolling back unauthorized changes and implementing additional approval workflows
7. Monitor for any unusual email activity following the policy modifications
', '["https://learn.microsoft.com/en-us/defender-office-365/anti-phishing-policies-about","https://attack.mitre.org/techniques/T1562/001/"]', '(safe("action", "").contains("AntiPhish") || safe("action", "") == "Set-AntiPhishPolicy" || safe("action", "") == "Remove-AntiPhishPolicy" || safe("action", "") == "New-AntiPhishPolicy" || safe("action", "") == "Disable-AntiPhishRule" || safe("action", "").contains("SafeSender") || safe("action", "").contains("BypassedSender")) && safe("actionResult", "") == "Success"', '2025-09-03 14:46:46.067012', true, false, 'origin', NULL, '[{"indexPattern":"v11-log-o365-*","with":[{"field":"origin.user.keyword","operator":"filter_term","value":"{{.origin.user}}"},{"field":"log.Operation.keyword","operator":"filter_match","value":"AntiPhish"}],"or":null,"within":"now-4h","count":2}]');
INSERT INTO public.utm_correlation_rules VALUES (304, 'Audit Log Tampering Detection', 3, 3, 2, 'Defense Evasion', 'T1070.001 - Indicator Removal: Clear Windows Event Logs', 'Detects attempts to tamper with audit logs by disabling auditing, modifying audit configurations, or clearing audit data. This could indicate an attempt to hide malicious activities.

Next Steps:
1. Investigate the user account that performed the audit configuration changes
2. Review recent activities by this user to identify potential malicious actions
3. Check if the audit configuration was restored after being disabled
4. Correlate with other security events around the same timeframe
5. Verify if this was an authorized administrative action
6. Review any recent privilege escalation or account compromise indicators
', '["https://learn.microsoft.com/en-us/purview/audit-log-enable-disable","https://attack.mitre.org/techniques/T1070/001/"]', '(safe("action", "") in ["Set-AdminAuditLogConfig", "Remove-AdminAuditLogConfig", "Disable-OrganizationCustomization", "Set-OrganizationConfig"] ||
(safe("log.Workload", "") == "Exchange" && safe("log.ObjectId", "") contains "AdminAuditLog") ||
(safe("log.Parameters", "") contains "UnifiedAuditLogIngestionEnabled" && safe("log.Parameters", "") contains "false")) &&
safe("origin.user", "") != "" &&
safe("actionResult", "") == "Succeeded"
', '2025-09-03 14:46:47.245318', true, false, 'origin', NULL, '[{"indexPattern":"v11-log-o365-*","with":[{"field":"origin.user.keyword","operator":"filter_term","value":"{{.origin.user}}"},{"field":"action.keyword","operator":"filter_term","value":"Set-AdminAuditLogConfig"}],"or":[{"indexPattern":"v11-log-o365-*","with":[{"field":"origin.user.keyword","operator":"filter_term","value":"{{.origin.user}}"},{"field":"action.keyword","operator":"filter_term","value":"Remove-AdminAuditLogConfig"}],"or":null,"within":"now-24h","count":1}],"within":"now-24h","count":1}]');
INSERT INTO public.utm_correlation_rules VALUES (305, 'Azure AD Integration Suspicious Activity', 3, 3, 2, 'Persistence, Privilege Escalation', 'T1098 - Account Manipulation', 'Detects suspicious Azure Active Directory integration events including multiple failed authentication attempts, unusual role assignments, or bulk user modifications that could indicate an attempted compromise of identity management systems. This rule identifies patterns of authentication failures, privilege escalations, and bulk account modifications that may suggest malicious activity targeting the organization''s identity infrastructure.

Next Steps:
1. Review the specific Azure AD activity details and affected user accounts
2. Analyze the frequency and timing of the detected events for patterns
3. Verify the legitimacy of any role assignments or user modifications
4. Check for concurrent suspicious activities from the same IP address or user
5. Review Azure AD sign-in logs for additional context around failed authentications
6. Validate whether the activities align with known business processes or authorized administrative tasks
7. Consider implementing additional monitoring for the affected accounts
8. If malicious activity is confirmed, immediately review and revoke any unauthorized permissions or access
', '["https://learn.microsoft.com/en-us/purview/audit-log-activities","https://attack.mitre.org/techniques/T1098/"]', 'safe("log.Workload", "") == "AzureActiveDirectory" && 
(
  (safe("action", "") == "UserLoginFailed" && safe("actionResult", "") == "Failed") ||
  (safe("action", "") == "Add member to role" && safe("actionResult", "") == "Success") ||
  (safe("action", "") == "Update user" && safe("actionResult", "") == "Success") ||
  (safe("action", "") == "Delete user" && safe("actionResult", "") == "Success") ||
  (safe("action", "") == "Add service principal" && safe("actionResult", "") == "Success")
)
', '2025-09-03 14:46:47.743486', true, false, 'origin', '["origin.user","origin.ip"]', '[{"indexPattern":"v11-log-o365-*","with":[{"field":"origin.user.keyword","operator":"filter_term","value":"{{.origin.user}}"},{"field":"log.Workload.keyword","operator":"filter_term","value":"AzureActiveDirectory"}],"or":null,"within":"now-15m","count":10}]');
INSERT INTO public.utm_correlation_rules VALUES (306, 'Unauthorized Calendar Sharing Modification', 3, 2, 1, 'Collection', 'T1213 - Data from Information Repositories', 'Detects modifications to calendar sharing permissions that could expose sensitive scheduling information to unauthorized users. This rule identifies when users modify calendar delegation or folder permissions on calendar folders, which could indicate unauthorized access attempts or data exposure risks.

Next Steps:
1. Verify if the calendar sharing modification was authorized by the calendar owner
2. Review the specific permissions granted and recipient of the sharing permissions
3. Check if the user performing the action has legitimate business need for calendar access
4. Investigate any unusual patterns of calendar sharing modifications by the same user
5. Review related authentication logs for the user account
6. Consider implementing additional approval workflows for calendar sharing modifications
', '["https://docs.microsoft.com/en-us/microsoft-365/compliance/audit-log-activities","https://attack.mitre.org/techniques/T1213/"]', 'safe("action", "") in ["UpdateCalendarDelegation", "AddFolderPermissions", "ModifyFolderPermissions", "RemoveFolderPermissions", "Set-MailboxFolderPermission", "Add-MailboxFolderPermission"] && 
safe("actionResult", "") == "Success" &&
safe("log.Item_FolderPath", "").contains("Calendar")
', '2025-09-03 14:46:48.262432', true, false, 'origin', '["lastEvent.origin.user","log.Item_FolderPath"]', '[]');
INSERT INTO public.utm_correlation_rules VALUES (307, 'Communication Compliance Alert', 2, 2, 1, 'Discovery', 'Account Discovery', 'Detects communication compliance policy violations including potentially threatening, harassing, or discriminatory language in messages, sensitive information sharing, or regulatory compliance violations in communications.

Next Steps:
1. Review the specific compliance violation details and message content
2. Investigate the user''s recent communication patterns
3. Check if this is part of a pattern of policy violations
4. Escalate to HR or compliance team if inappropriate content is confirmed
5. Consider additional training or disciplinary action based on severity
6. Review and update communication policies if needed
', '["https://learn.microsoft.com/en-us/purview/communication-compliance","https://attack.mitre.org/techniques/T1087/"]', 'safe("action", "") == "CommunicationComplianceAlert" || (safe("log.ComplianceType", "") == "CommunicationCompliance" && safe("actionResult", "") == "PolicyMatch") || (safe("log.PolicyType", "") contains "Communication" && safe("log.Severity", "") in ["Medium", "High", "Critical"])', '2025-09-03 14:46:48.742974', true, false, 'origin', '["origin.user"]', '[]');
INSERT INTO public.utm_correlation_rules VALUES (308, 'Suspicious Compliance Alert Activity', 3, 3, 2, 'Defense Evasion', 'T1562.001 - Impair Defenses: Disable or Modify Tools', 'Detects suspicious patterns in compliance-related activities including alert suppression, policy modifications, or audit log tampering that could indicate attempts to evade security monitoring or hide malicious activities in Office 365 Security & Compliance Center.

Next Steps:
1. Review the specific compliance action performed and verify if it was authorized
2. Check if the user has legitimate administrative privileges for compliance operations
3. Analyze the timing and frequency of compliance changes - multiple rapid changes may indicate malicious activity
4. Examine what compliance policies, rules, or alerts were modified and assess the security impact
5. Review audit logs for any related suspicious activities before and after this event
6. Verify if the changes align with documented change management processes
7. Check for any correlation with other security alerts or unusual user behavior
8. If unauthorized, immediately review and restore appropriate compliance settings
9. Consider implementing additional monitoring on compliance configuration changes
10. Escalate to security team if evidence suggests malicious intent or privilege abuse
', '["https://learn.microsoft.com/en-us/purview/audit-log-activities","https://attack.mitre.org/techniques/T1562/001/"]', 'safe("log.Workload", "") == "SecurityComplianceCenter" &&
(
  safe("action", "") == "AlertTriggered" ||
  safe("action", "") == "AlertEntityGenerated" ||
  safe("action", "") == "AlertUpdated" ||
  safe("action", "") == "ComplianceSettingChanged" ||
  safe("action", "") == "Set-ComplianceSecurityFilter" ||
  safe("action", "") == "New-ComplianceSecurityFilter" ||
  safe("action", "") == "Remove-ComplianceSecurityFilter" ||
  safe("action", "") == "Set-AdminAuditLogConfig" ||
  safe("action", "") == "Set-OrganizationConfig" ||
  safe("action", "").contains("CompliancePolicy") ||
  safe("action", "").contains("ComplianceRule") ||
  safe("action", "").contains("ComplianceTag")
) &&
safe("actionResult", "") == "Success"
', '2025-09-03 14:46:49.246452', true, false, 'origin', '["origin.user","action","log.ObjectId"]', '[]');
INSERT INTO public.utm_correlation_rules VALUES (327, 'Safe Links Click Pattern Anomaly', 2, 3, 1, 'Execution', 'T1204.001 - User Execution: Malicious Link', 'Detects unusual patterns in Safe Links click behavior that may indicate phishing attempts or malicious URL access. This rule monitors for multiple clicks on suspicious URLs from the same user within a short timeframe, which could indicate either a persistent phishing campaign or user behavior that poses security risks.

Next Steps:
1. Review the user''s activity timeline to identify the source of the malicious links
2. Check email security logs for the original messages containing the blocked URLs
3. Verify if other users received similar phishing emails
4. Assess whether the user''s account has been compromised
5. Implement additional security awareness training for the affected user
6. Consider blocking the malicious domains at the network level
', '["https://learn.microsoft.com/en-us/defender-office-365/safe-links-about","https://attack.mitre.org/techniques/T1204/001/"]', 'safe("action", "") == "ClickedSafeLink" && safe("actionResult", "") == "Blocked" && safe("origin.user", "") != ""', '2025-09-03 14:49:41.542247', true, false, 'origin', '["origin.user"]', '[{"indexPattern":"v11-log-o365-*","with":[{"field":"origin.user.keyword","operator":"filter_term","value":"{{.origin.user}}"},{"field":"action.keyword","operator":"filter_term","value":"ClickedSafeLink"}],"or":null,"within":"now-30m","count":5}]');
INSERT INTO public.utm_correlation_rules VALUES (309, 'Conditional Access Bypass Detection', 3, 3, 2, 'Defense Evasion, Lateral Movement', 'T1550 - Use Alternate Authentication Material', 'Detects attempts to bypass conditional access policies through various methods including legacy authentication, trusted location manipulation, or session token abuse. This rule identifies when users successfully authenticate despite conditional access policy failures or use legacy authentication methods that may bypass modern security controls.

Next Steps:
1. Verify the legitimacy of the authentication attempt with the user
2. Review conditional access policy configuration and compliance
3. Check if the authentication method used is approved for the user''s role
4. Investigate the source IP address and device details
5. Review recent policy changes that might have caused legitimate bypass
6. Consider implementing stricter conditional access policies for high-risk users
7. Monitor for additional suspicious activities from the same user or IP
', '["https://learn.microsoft.com/en-us/azure/active-directory/conditional-access/overview","https://attack.mitre.org/techniques/T1550/"]', '(safe("action", "") in ["UserLoggedIn", "UserLoginFailed"] &&
 ((safe("log.ConditionalAccessStatus", "") in ["failure", "notApplied"] && safe("actionResult", "") == "Success") ||
  (safe("log.AuthenticationMethod", "") in ["Legacy Authentication", "Basic Authentication"]) ||
  (safe("log.ClientAppUsed", "") in ["Exchange ActiveSync", "IMAP4", "POP3", "SMTP Auth"]) ||
  (safe("log.DeviceDetail", "") == "{}" && safe("log.Location", "") contains "trusted") ||
  (safe("log.IsInteractive", "") == "false" && safe("log.appAccessContextClientAppId", "") == ""))) &&
safe("origin.user", "") != "" &&
safe("origin.ip", "") != ""
', '2025-09-03 14:46:49.774703', true, false, 'origin', '["origin.user","origin.ip"]', '[]');
INSERT INTO public.utm_correlation_rules VALUES (310, 'Data Loss Prevention Policy Violation', 3, 2, 1, 'Collection', 'T1213 - Data from Information Repositories', 'Detects violations of Data Loss Prevention (DLP) policies including attempts to share, access, or exfiltrate sensitive information such as credit card numbers, social security numbers, or confidential business data.

This rule triggers when Office 365 DLP policies detect unauthorized handling of sensitive data across Exchange, SharePoint, OneDrive, Teams, or Security Compliance Center workloads.

**Next Steps:**
1. **Immediate Response:** Review the specific DLP policy violation details and sensitive data types involved
2. **User Investigation:** Verify if the user action was intentional and authorized, check user''s role and data access permissions
3. **Data Assessment:** Determine what sensitive information was involved and potential exposure scope
4. **Policy Review:** Evaluate if DLP policy settings are appropriate or need adjustment
5. **Incident Documentation:** Record the violation details, investigation findings, and remediation actions taken
6. **User Training:** If unintentional, provide additional data handling training to the user
7. **System Monitoring:** Monitor for additional violations from the same user or similar patterns
', '["https://learn.microsoft.com/en-us/purview/dlp-learn-about-dlp","https://attack.mitre.org/techniques/T1213/"]', '(
  safe("action", "") == "DLPRuleMatch" ||
  safe("action", "") == "DlpPolicyMatch" ||
  safe("action", "") == "DLPRuleUndo" ||
  safe("log.PolicyDetails", "").contains("DLP") ||
  safe("log.ExceptionInfo", "").contains("DLP")
) &&
(
  safe("log.Workload", "") == "Exchange" ||
  safe("log.Workload", "") == "SharePoint" ||
  safe("log.Workload", "") == "OneDrive" ||
  safe("log.Workload", "") == "Teams" ||
  safe("log.Workload", "") == "SecurityComplianceCenter"
) &&
safe("actionResult", "") != "Failed"
', '2025-09-03 14:46:50.287311', true, false, 'origin', '["lastEvent.origin.user","log.PolicyId","log.SensitiveInfoTypeData"]', '[]');
INSERT INTO public.utm_correlation_rules VALUES (1492, 'Windows: Persistence via PowerShell profile', 2, 3, 1, 'Persistence', 'Additional Email Delegate Permissions', 'Identifies the creation or modification of a PowerShell profile. PowerShell profile is a script that is executed when PowerShell starts to customize the user environment, which can be abused by attackers to persist in a environment where PowerShell is common.', '["https://attack.mitre.org/tactics/TA0003/","https://attack.mitre.org/techniques/T1098/002/"]', 'safe("log.eventDataProcessName", "").matches("(:\\Users\\(.+)\\Documents\\WindowsPowerShell\\|:\\Users\\(.+)\\Documents\\PowerShell\\|:\\Windows\\System32\\WindowsPowerShell\\)") && safe("log.eventDataProcessName", "").matches("(profile.ps1|Microsoft.Powershell_profile.ps1)")', '2025-09-04 21:16:04.303573', true, false, 'origin', NULL, '[]');
INSERT INTO public.utm_correlation_rules VALUES (311, 'eDiscovery Abuse Detection', 3, 2, 1, 'Collection', 'T1074 - Data Staged', 'Detects potential abuse of eDiscovery features including excessive searches, exports, or unauthorized access to sensitive data through eDiscovery operations. This rule identifies users performing multiple eDiscovery actions within a short timeframe, which could indicate malicious data staging or exfiltration attempts.

Next Steps:
1. Review the user''s authorization and role assignments for eDiscovery operations
2. Examine the scope and content of the searches performed
3. Verify if the searches align with legitimate business requirements or ongoing legal matters
4. Check for unusual patterns in search queries or export activities
5. Investigate if sensitive data was accessed or exported without proper justification
6. Review data classification and sensitivity of accessed content
7. Correlate with other suspicious activities from the same user account
8. Consider implementing additional monitoring for the user if activity appears unauthorized
', '["https://learn.microsoft.com/en-us/purview/ediscovery-search-for-activities-in-the-audit-log","https://attack.mitre.org/techniques/T1074/"]', 'safe("action", "") in ["SearchStarted", "SearchExported", "SearchCreated", "CaseAdded", "HoldCreated", "SearchExportDownloaded", "SearchPreviewed", "SearchResultsPurged", "RemoveSearchResultsSentToZoom", "RemoveSearchExported", "RemoveSearchPreviewed", "RemoveSearchResultsPurged", "SearchResultsSentToZoom", "ViewedSearchExported", "ViewedSearchPreviewed"] &&
safe("origin.user", "") != "" &&
safe("actionResult", "") == "Succeeded"
', '2025-09-03 14:46:50.784233', true, false, 'origin', '["origin.user"]', '[{"indexPattern":"v11-log-o365-*","with":[{"field":"origin.user.keyword","operator":"filter_term","value":"{{.origin.user}}"},{"field":"log.action.keyword","operator":"filter_term","value":"{{.log.action}}"}],"or":null,"within":"now-1h","count":10}]');
INSERT INTO public.utm_correlation_rules VALUES (330, 'Suspicious Teams Message Export Activity', 3, 2, 1, 'Collection', 'T1114 - Email Collection', 'Detects when Teams messages are exported or accessed in bulk through API calls, which could indicate an attempt to exfiltrate chat history and shared files from Microsoft Teams.

Next Steps:
1. Review the user''s recent Teams activity and authentication events
2. Check if the export activity was authorized or part of legitimate business operations
3. Examine the volume and scope of data accessed or exported
4. Verify the user''s current permissions and access levels
5. Look for any concurrent suspicious activities from the same user account
6. Contact the user to confirm if they initiated these export operations
7. Review any third-party applications that may have access to Teams data
', '["https://learn.microsoft.com/en-us/purview/audit-teams-audit-log-events","https://attack.mitre.org/techniques/T1114/"]', 'safe("action", "") in ["MessagesListed", "MessagesExported", "RecordingExported", "TranscriptsExported"] && safe("origin.user", "") != "" && safe("log.Workload", "") == "MicrosoftTeams"', '2025-09-03 14:49:43.404282', true, false, 'origin', '["origin.user","log.appAccessContextClientAppId"]', '[{"indexPattern":"v11-log-o365-*","with":[{"field":"origin.user.keyword","operator":"filter_term","value":"{{.origin.user}}"},{"field":"log.Workload.keyword","operator":"filter_term","value":"MicrosoftTeams"}],"or":null,"within":"now-1h","count":20}]');
INSERT INTO public.utm_correlation_rules VALUES (313, 'Suspicious External Sharing Activity', 3, 2, 1, 'Exfiltration', 'T1567 - Exfiltration Over Web Service', 'Detects unauthorized or suspicious external sharing activities in SharePoint and OneDrive that could indicate data exfiltration attempts or policy violations when sharing sensitive content with external parties.

Next Steps:
1. Review the shared content and assess its sensitivity level
2. Verify if the external sharing was authorized by data owners
3. Check if the recipient has legitimate business need for access
4. Validate against organizational data sharing policies
5. Examine user''s recent activity for other suspicious sharing patterns
6. Consider revoking access if sharing was unauthorized
7. Update DLP policies if needed to prevent future violations
8. Document findings and coordinate with data protection team
', '["https://learn.microsoft.com/en-us/purview/audit-log-activities","https://attack.mitre.org/techniques/T1567/"]', '(safe("log.Workload", "") == "SharePoint" || safe("log.Workload", "") == "OneDrive") &&
(
  safe("action", "") == "SharingInvitationCreated" ||
  safe("action", "") == "AnonymousLinkCreated" ||
  safe("action", "") == "AnonymousLinkUsed" ||
  safe("action", "") == "SecureLinkCreated" ||
  safe("action", "") == "SharingSet" ||
  safe("action", "") == "CompanyLinkCreated" ||
  safe("action", "") == "AddedToSecureLink"
) &&
safe("actionResult", "") == "Success" &&
(
  safe("log.TargetUserOrGroupType", "") == "Guest" ||
  safe("log.SiteUrl", "").contains("external") ||
  safe("log.EventData", "").contains("AllowExternalSharing")
)
', '2025-09-03 14:49:00.525605', true, false, 'origin', '["origin.user","log.ObjectId"]', '[]');
INSERT INTO public.utm_correlation_rules VALUES (333, 'GCP detected account with password leak', 3, 3, 2, 'Initial Access', 'Valid Accounts', 'A user''s account was disabled because a password leak was detected by google.', '["https://attack.mitre.org/tactics/TA0001/","https://attack.mitre.org/techniques/T1078"]', 'safe("log.protoPayload.methodName", "") == ''google.login.LoginService.accountDisabledPasswordLeak''', '2025-09-03 14:59:31.734975', true, false, 'origin', NULL, '[]');
INSERT INTO public.utm_correlation_rules VALUES (314, 'Abnormal Guest User Invitation Activity', 3, 2, 1, 'Persistence', 'Account Creation', 'Detects unusual spikes in guest user invitations which could indicate an attempt to establish persistence through external accounts or potential data exfiltration preparation by adding unauthorized external collaborators.

Next Steps:
1. Review the user account initiating the invitations for any signs of compromise
2. Verify the legitimacy of the invited external users and their business justification
3. Check if the inviting user has appropriate permissions for guest invitations
4. Examine the invited users'' email domains for suspicious or unexpected organizations
5. Review any subsequent activity by the invited guest users
6. Validate that the invitation frequency aligns with normal business processes
7. Consider implementing additional approval workflows for guest user invitations
', '["https://learn.microsoft.com/en-us/purview/audit-log-activities","https://attack.mitre.org/techniques/T1136/"]', 'safe("log.Workload", "") == "AzureActiveDirectory" && 
(
  safe("action", "") == "Invite external user" ||
  safe("action", "") == "InviteGuest" ||
  safe("action", "") == "Add guest to group" ||
  safe("action", "") == "Guest user invite redeemed"
) &&
safe("actionResult", "") == "Success"
', '2025-09-03 14:49:01.506814', true, false, 'origin', '["origin.user"]', '[{"indexPattern":"v11-log-o365-*","with":[{"field":"origin.user.keyword","operator":"filter_term","value":"{{.origin.user}}"},{"field":"action.keyword","operator":"filter_term","value":"Invite external user"}],"or":null,"within":"now-1h","count":5}]');
INSERT INTO public.utm_correlation_rules VALUES (315, 'Information Barriers Policy Violation', 3, 2, 1, 'Defense Evasion, Persistence, Privilege Escalation, Initial Access', 'Valid Accounts', 'Detects violations of information barrier policies designed to prevent conflicts of interest by restricting communications and collaborations between specific groups or individuals within the organization. Information barriers are critical security controls that prevent unauthorized information sharing between different business units or roles.

Next Steps:
1. Review the specific information barrier policy that was violated and the users involved
2. Investigate whether the violation was intentional or accidental
3. Check if there are patterns of repeated violations by the same user or group
4. Review and update information barrier policies if necessary
5. Provide additional training to users if violations appear to be due to lack of awareness
6. Consider implementing additional technical controls to prevent future violations
', '["https://learn.microsoft.com/en-us/purview/information-barriers","https://attack.mitre.org/techniques/T1078/"]', 'safe("action", "") == "InformationBarrierPolicyViolation" || (safe("log.PolicyType", "") == "InformationBarrier" && safe("actionResult", "") == "Blocked") || (safe("log.ViolationType", "") == "InformationBarrier" && safe("action", "") == "CommunicationBlocked")', '2025-09-03 14:49:02.052708', true, false, 'origin', '["lastEvent.origin.user","log.TargetUser"]', '[{"indexPattern":"v11-log-o365-*","with":[{"field":"origin.user.keyword","operator":"filter_term","value":"{{.origin.user}}"},{"field":"log.PolicyType.keyword","operator":"filter_term","value":"InformationBarrier"}],"or":null,"within":"now-12h","count":3}]');
INSERT INTO public.utm_correlation_rules VALUES (316, 'Insider Risk Indicator Detection', 3, 3, 2, 'Collection', 'Data from Local System', 'Detects insider risk indicators such as unusual data access patterns, mass downloads, sensitive data exfiltration attempts, or policy violations that may indicate malicious insider activity or compromised accounts.

Next Steps:
1. Review the specific insider risk alert details and policy violated
2. Investigate the user''s recent activity patterns and data access history
3. Check if the user has legitimate business justification for the flagged activity
4. Review the user''s role, permissions, and access to sensitive resources
5. Correlate with HR records for any recent disciplinary actions or employment changes
6. Examine network logs for any unusual data transfer patterns or external communications
7. Consider implementing additional monitoring or access restrictions if suspicious activity is confirmed
8. Escalate to security team and HR if malicious intent is suspected
', '["https://learn.microsoft.com/en-us/purview/insider-risk-management","https://attack.mitre.org/techniques/T1005/"]', 'safe("action", "") == "InsiderRiskAlert" || (safe("log.PolicyName", "") contains "InsiderRisk" && safe("actionResult", "") == "PolicyViolation") || (safe("log.RiskLevel", "") in ["High", "Critical"] && safe("log.AlertSource", "") == "InsiderRiskManagement")', '2025-09-03 14:49:03.007008', true, false, 'origin', '["origin.user","log.PolicyName","log.RiskLevel"]', '[]');
INSERT INTO public.utm_correlation_rules VALUES (343, 'Application Hijacking prevented in Sophos Central', 3, 3, 3, 'Persistence', 'Hijack Execution Flow', 'Adversaries may execute their own malicious payloads by hijacking the way operating systems run programs.  Hijacking execution flow can be for the purposes of persistence, since this hijacked execution may reoccur over time.  Adversaries may also use these mechanisms to elevate privileges or evade defenses, such as application control or other restrictions on execution.', '["https://attack.mitre.org/tactics/TA0003/","https://attack.mitre.org/techniques/T1574/"]', 'safe("log.type", "") == ''Event::Endpoint::HmpaApplicationHijacking''', '2025-09-03 15:00:13.787305', true, false, 'origin', NULL, '[]');
INSERT INTO public.utm_correlation_rules VALUES (344, 'Blocked transfer detected in Sophos Central', 1, 2, 2, 'Execution', 'User Execution: Malicious Link', 'A blocked transfer action was taken.', '["https://attack.mitre.org/techniques/T1204/001/"]', 'safe("log.type", "") in [''Event::Endpoint::DataLossPreventionAutomaticallyBlocked'', ''Event::Endpoint::DataLossPreventionUserBlocked'']', '2025-09-03 15:00:14.907312', true, false, 'target', NULL, '[]');
INSERT INTO public.utm_correlation_rules VALUES (329, 'Suspicious Email Forwarding Rule Created', 3, 2, 1, 'Collection', 'T1114.003 - Email Collection: Email Forwarding Rule', 'Detects creation or modification of inbox rules that forward emails to external domains, which is a common technique used by attackers to exfiltrate emails and maintain persistence after compromising an account. Attackers often create these rules to automatically forward sensitive emails to external addresses under their control.

Next Steps:
1. Verify if the user creating the rule is legitimate and authorized
2. Check the destination email address in the forwarding rule for external domains
3. Review recent authentication logs for the affected user account
4. Examine other administrative actions performed by this user recently
5. Check for any other suspicious inbox rules created by the same user
6. Validate if the forwarding address belongs to a legitimate business contact
7. Consider temporarily disabling the forwarding rule pending investigation
8. Review email logs to see what emails may have already been forwarded
', '["https://redcanary.com/blog/threat-detection/email-forwarding-rules/","https://attack.mitre.org/techniques/T1114/003/"]', 'safe("action", "") in ["New-InboxRule", "Set-InboxRule"] && safe("origin.user", "") != "" && (safe("log.Parameters", "") contains "ForwardTo" || safe("log.Parameters", "") contains "RedirectTo" || safe("log.Parameters", "") contains "ForwardAsAttachmentTo")', '2025-09-03 14:49:42.637073', true, false, 'origin', '["origin.user"]', '[]');
INSERT INTO public.utm_correlation_rules VALUES (318, 'Office 365 Mail Flow Rule Modified', 3, 3, 2, 'Defense Evasion', 'T1564.008 - Hide Artifacts: Email Hiding Rules', 'Detects modifications to mail flow rules (transport rules) in Office 365. Attackers may create or modify mail flow rules to redirect, delete, or hide emails, bypassing security controls or exfiltrating data. Mail flow rules can be used to automatically delete emails containing specific keywords, forward sensitive emails to external addresses, or modify email content.

Next Steps:
1. Review the specific mail flow rule that was modified, including its conditions and actions
2. Verify if the change was authorized and performed by a legitimate administrator
3. Check if the rule involves email forwarding to external domains or deletion of emails
4. Examine recent email traffic to identify any emails that may have been affected by the rule
5. Review mailbox audit logs for the affected user accounts
6. Check for other administrative changes made by the same user around the same time
7. If unauthorized, disable the malicious rule immediately and investigate the compromised account
', '["https://admindroid.com/how-to-audit-transport-rule-changes-report-in-microsoft-365","https://attack.mitre.org/techniques/T1564/008/"]', '(safe("action", "").contains("TransportRule") || safe("action", "") == "New-TransportRule" || safe("action", "") == "Set-TransportRule" || safe("action", "") == "Remove-TransportRule" || safe("action", "") == "Enable-TransportRule" || safe("action", "") == "Disable-TransportRule") && safe("actionResult", "") == "Succeeded"', '2025-09-03 14:49:05.024939', true, false, 'origin', '["origin.user","log.action"]', '[]');
INSERT INTO public.utm_correlation_rules VALUES (319, 'Suspicious Mail Forwarding Rule Creation', 3, 2, 1, 'Collection', 'T1114.001 - Email Collection: Local Email Collection', 'Detects creation or modification of inbox rules that forward emails to external recipients, which could indicate data exfiltration attempts. This rule monitors for the creation of new inbox rules or modifications to existing rules that contain forwarding parameters.

Next Steps:
1. Review the specific forwarding parameters in the log.Parameters field to identify the destination email address
2. Verify if the forwarding destination is a legitimate business email or an external/suspicious address
3. Check if the user who created the rule has legitimate business justification for email forwarding
4. Review recent authentication logs for the affected user account for signs of compromise
5. Examine the timing of the rule creation - if created outside business hours or immediately after login, investigate further
6. Check for other suspicious activities by the same user account around the same timeframe
7. If malicious, disable the forwarding rule and reset user credentials
', '["https://docs.microsoft.com/en-us/microsoft-365/compliance/auditing-troubleshooting-scenarios","https://attack.mitre.org/techniques/T1114/001/"]', 'safe("action", "") in ["NewInboxRule", "Set-InboxRule", "UpdateInboxRules"] && 
safe("actionResult", "") == "Succeeded" &&
(safe("log.Parameters", "").contains("ForwardTo") || safe("log.Parameters", "").contains("ForwardAsAttachmentTo") || safe("log.Parameters", "").contains("RedirectTo"))
', '2025-09-03 14:49:05.942642', true, false, 'origin', '["origin.user","origin.ip"]', '[]');
INSERT INTO public.utm_correlation_rules VALUES (320, 'Mass Email Deletion Detected', 2, 3, 2, 'Collection', 'T1114 - Email Collection', 'Detects when a user performs mass deletion of emails which could indicate data destruction, covering tracks, or malicious insider activity. Monitors for multiple HardDelete or SoftDelete operations within a short time window.

Next Steps:
1. Verify the legitimacy of the user performing the deletions
2. Check if this aligns with any scheduled maintenance or cleanup activities
3. Investigate the content and importance of deleted emails if possible
4. Review user''s recent access patterns and behavior
5. Check for any concurrent suspicious activities from the same user
6. Validate if the user has appropriate permissions for bulk email operations
7. Consider temporarily restricting the user''s access pending investigation
', '["https://learn.microsoft.com/en-us/purview/audit-mailboxes","https://attack.mitre.org/techniques/T1114/"]', 'safe("action", "") in ["HardDelete", "SoftDelete"] && safe("origin.user", "") != "" && safe("origin.ip", "") != ""', '2025-09-03 14:49:07.085237', true, false, 'origin', '["origin.user"]', '[{"indexPattern":"v11-log-o365-*","with":[{"field":"origin.user.keyword","operator":"filter_term","value":"{{.origin.user}}"},{"field":"action.keyword","operator":"filter_term","value":"HardDelete"}],"or":[{"indexPattern":"v11-log-o365-*","with":[{"field":"origin.user.keyword","operator":"filter_term","value":"{{.origin.user}}"},{"field":"action.keyword","operator":"filter_term","value":"SoftDelete"}],"or":null,"within":"now-15m","count":25}],"within":"now-15m","count":25}]');
INSERT INTO public.utm_correlation_rules VALUES (1248, 'vMotion Security Events Detection', 3, 2, 3, 'Virtualization Security', 'Migration Security', 'Detects suspicious vMotion activities including unauthorized migrations, failed vMotion attempts, or vMotion operations from untrusted sources. vMotion is a critical VMware feature that allows live migration of virtual machines between ESXi hosts, and security events related to this process could indicate potential attacks on the virtualization infrastructure.

Next Steps:
1. Identify the specific VM and ESXi hosts involved in the suspicious vMotion activity
2. Verify the legitimacy of the migration request and the user/process that initiated it
3. Check vCenter Server logs for corresponding authentication and authorization events
4. Review network configuration and ensure vMotion network is properly secured
5. Examine the destination host for any signs of compromise or unauthorized access
6. Validate that vMotion operations are following established change management procedures
7. Monitor for any subsequent suspicious activities on the affected VMs or hosts
8. Review vMotion network traffic for any anomalies or unauthorized connections
9. Check for privilege escalation attempts around the time of the failed vMotion
10. Consider isolating affected VMs if security breach is suspected
', '["https://docs.vmware.com/en/VMware-vSphere/7.0/com.vmware.vsphere.vcenterhost.doc/GUID-3B41119A-1276-404B-8BFB-A32409052449.html","https://lantern.splunk.com/Splunk_Platform/UCE/IT_Modernization/Infrastructure_Monitoring/Monitoring_VMware_virtualization_infrastructure/VMotion_events_for_a_specific_virtual_machine"]', '(safe("log.message", "").matches("(?i)vmotion") && safe("log.message", "").matches("(?i)(failed|error|denied|unauthorized)")) ||
(safe("log.eventInfo", "").matches("(?i)VmMigratedEvent") && safe("severity", "").matches("(?i)(error|critical)")) ||
(safe("log.message", "").matches("(?i)(migrate|migration)") && safe("log.message", "").matches("(?i)(abort|timeout|invalid|unauthorized)")) ||
(safe("log.process", "").matches("(?i)(vpxa|hostd)") && safe("log.message", "").matches("(?i)vmotion") && safe("log.message", "").matches("(?i)(security|violation|breach)")) ||
(safe("log.message", "").matches("(?i)vmotion.*network") && safe("log.message", "").matches("(?i)(untrusted|insecure|compromise)"))
', '2025-09-04 19:00:52.325423', true, false, 'origin', '["origin.hostname"]', '[]');
INSERT INTO public.utm_correlation_rules VALUES (321, 'Multi-Geo Data Violations', 3, 2, 1, 'Exfiltration', 'T1030 - Data Transfer Size Limits', 'Detects violations of multi-geo data residency policies including unauthorized data movements between regions, cross-geo access violations, or attempts to bypass geo-restrictions. This rule identifies activities such as site geo moves, cross-geo file operations, and data location parameter modifications that may indicate unauthorized data transfer or policy violations.

Next Steps:
1. Review the user''s authorization level for multi-geo operations
2. Verify if the geo movement was approved through proper change management
3. Check data classification and residency requirements for affected content
4. Examine the source and destination locations for compliance violations
5. Review audit logs for related suspicious activities by the same user
6. Validate that the operation aligns with organizational data governance policies
', '["https://learn.microsoft.com/en-us/microsoft-365/enterprise/microsoft-365-multi-geo","https://attack.mitre.org/techniques/T1030/"]', '(safe("action", "") in ["SiteGeoMoveScheduled", "SiteGeoMoveCompleted", "SiteGeoMoveCancelled", "AllowedDataLocationAdded", "GeoQuotaAllocated", "MigrationJobCompleted"] ||
(safe("log.Workload", "") == "OneDrive" && safe("log.ItemName", "") contains "cross-geo") ||
(safe("log.SourceFileName", "") != "" && safe("log.DestinationFileName", "") != "" && safe("log.SourceRelativeUrl", "") contains "geo" && safe("log.DestinationRelativeUrl", "") contains "geo") ||
(safe("log.Parameters", "") contains "DataLocation" || safe("log.Parameters", "") contains "PreferredDataLocation")) &&
safe("origin.user", "") != "" &&
safe("actionResult", "") == "Succeeded" &&
safe("origin.ip", "") != ""
', '2025-09-03 14:49:07.762676', true, false, 'origin', '["origin.user","origin.ip"]', '[]');
INSERT INTO public.utm_correlation_rules VALUES (337, 'GCP probable Defense Evasion, Firewall Rule Modification', 1, 2, 2, 'Defense Evasion', 'Impair Defenses', 'Defense Evasion consists of techniques that adversaries use to avoid detection throughout their compromise.  Techniques used for defense evasion include uninstalling/disabling security software or  obfuscating/encrypting data and scripts. Adversaries also leverage and abuse trusted processes  to hide and masquerade their malware. Other tactics are cross-listed here when those techniques  include the added benefit of subverting defenses. <br>  Identifies when a firewall rule is modified in Google Cloud Platform (GCP). Virtual Private Cloud (VPC) firewall rules can be configured to allow or deny connections to or from virtual machine (VM) instances. An adversary may modify a firewall rule in order to weaken their target''s security controls.', '["https://cloud.google.com/vpc/docs/firewalls","https://attack.mitre.org/techniques/T1562/","https://attack.mitre.org/tactics/TA0005/"]', 'safe("log.protoPayload.methodName ", "").matches("((.+)?v(\\w+)(\\.compute\\.firewalls\\.patch)|(.+)?(compute\\.v(\\w+)\\.firewalls\\.patch)|(.+)?beta(\\w+)?(\\.compute\\.firewalls\\.patch)|(.+)?(compute\\.beta(\\w+)?\\.firewalls\\.patch))")', '2025-09-03 14:59:33.391863', true, false, 'origin', NULL, '[]');
INSERT INTO public.utm_correlation_rules VALUES (326, 'Office 365 Safe Attachment Policy Violation', 3, 3, 2, 'Initial Access', 'T1566.001 - Phishing: Spearphishing Attachment', 'Detects violations of Safe Attachment policies including malicious files blocked during detonation, policy modifications that reduce protection, or attempts to bypass attachment scanning that could lead to malware delivery. This rule identifies when Safe Attachment policies are modified, disabled, or when malicious attachments are detected and blocked by Office 365 security controls.

Next Steps:
1. Review the specific Safe Attachment policy change or violation that occurred
2. Verify if the policy modification was authorized and legitimate
3. Check if any malicious attachments were successfully blocked or if any bypassed controls
4. Investigate the user account that performed the action for signs of compromise
5. Review email logs for any related suspicious email activity
6. Validate current Safe Attachment policy configurations are properly restrictive
7. Consider implementing additional email security controls if gaps are identified
', '["https://learn.microsoft.com/en-us/defender-office-365/safe-attachments-about","https://attack.mitre.org/techniques/T1566/001/"]', '(safe("action", "").contains("SafeAttachment") || safe("action", "") == "Set-SafeAttachmentPolicy" || safe("action", "") == "Remove-SafeAttachmentPolicy" || safe("action", "") == "Disable-SafeAttachmentRule" || safe("action", "").contains("MalwareDetected") || safe("action", "").contains("AttachmentBlocked") || safe("action", "").contains("DetonationBlock")) && safe("actionResult", "") == "Succeeded"', '2025-09-03 14:49:40.763641', true, false, 'origin', '["origin.user","category"]', '[]');
INSERT INTO public.utm_correlation_rules VALUES (322, 'Office 365 OAuth Application Anomalous Activity', 3, 3, 2, 'Credential Access', 'T1528 - Steal Application Access Token', 'Detects anomalous OAuth application activities including suspicious consent patterns, high-privilege permission grants, or rapid consent events from a single user which may indicate compromised accounts or malicious OAuth apps. This rule identifies when users consent to OAuth applications with high-risk permissions such as Mail access, Files access, or User.ReadWrite permissions, followed by multiple consent events from the same IP address.

Next Steps:
- Review the OAuth application details and permissions granted
- Verify if the user intentionally consented to the application
- Check for any suspicious activities from the user account after consent
- Investigate the OAuth application''s reputation and publisher
- Consider revoking application permissions if deemed malicious
- Review other users who may have consented to the same application
- Implement conditional access policies to restrict high-risk OAuth consents
', '["https://office365itpros.com/2023/12/15/oauth-apps-security/","https://attack.mitre.org/techniques/T1528/"]', 'safe("action", "") == "Consent to application" && safe("actionResult", "") == "Success" && (safe("log.Scope", "").contains("Mail.") || safe("log.Scope", "").contains("Files.") || safe("log.Scope", "").contains("User.ReadWrite") || safe("log.Scope", "").contains(".All"))', '2025-09-03 14:49:38.719081', true, false, 'origin', '["origin.ip","log.appAccessContextClientAppId"]', '[{"indexPattern":"v11-log-o365-*","with":[{"field":"origin.ip.keyword","operator":"filter_term","value":"{{.origin.ip}}"},{"field":"action.keyword","operator":"filter_term","value":"Consent to application"}],"or":null,"within":"now-1h","count":5}]');
INSERT INTO public.utm_correlation_rules VALUES (1336, 'Windows: Enterprise domain controllers group changed.', 3, 3, 3, 'Potentially Compromised System', 'Domain Policy Modification', 'Adversaries may modify the configuration settings of a domain to evade defenses and/or escalate privileges in domain environments.  Domains provide a centralized means of managing how computer resources (ex: computers, user accounts) can act, and interact with each other, on a network.  The policy of the domain also includes configuration settings that may apply between domains in a multi-domain/forest environment.  Modifications to domain settings may include altering domain Group Policy Objects (GPOs) or changing trust settings for domains, including federation trusts.', '["https://attack.mitre.org/techniques/T1484"]', 'safe("log.eventDataTargetSid", "").matches("(^%{S-1-5-9(.+)}$|^S-1-5-9(.+))")', '2025-09-04 20:23:54.531913', true, false, 'origin', NULL, '[]');
INSERT INTO public.utm_correlation_rules VALUES (323, 'OneDrive Mass File Access Detected', 3, 1, 2, 'Collection', 'T1530 - Data from Cloud Storage Object', 'Detects when a user accesses an abnormally high number of files in OneDrive within a short time period (200+ files in 30 minutes), which could indicate automated data collection, reconnaissance, or preparation for data exfiltration. This behavior is often associated with insider threats, compromised accounts, or malicious scripts designed to harvest sensitive data from cloud storage.

Next Steps:
1. Immediately verify the legitimacy of the user account and check for signs of compromise
2. Review the specific files accessed to determine sensitivity and business impact
3. Check for concurrent suspicious activities like bulk downloads or external sharing
4. Examine authentication logs for unusual login patterns or locations
5. Verify if the access pattern aligns with the user''s normal work responsibilities
6. Consider temporarily restricting the user''s OneDrive access pending investigation
7. Review OneDrive sharing permissions and external access configurations
8. Check for any automated tools or scripts that might be accessing the files
9. Correlate with other security events from the same user or IP address
10. Document findings and escalate to incident response team if malicious activity is confirmed
', '["https://o365reports.com/2024/01/30/audit-file-access-in-sharepoint-online-using-powershell/","https://attack.mitre.org/techniques/T1530/"]', 'safe("action", "") in ["FileAccessed", "FileAccessedExtended", "FilePreviewed"] && safe("origin.user", "") != "" && safe("log.Workload", "") == "OneDrive"', '2025-09-03 14:49:39.215634', true, false, 'origin', '["origin.user","origin.ip"]', '[{"indexPattern":"v11-log-o365-*","with":[{"field":"origin.user.keyword","operator":"filter_term","value":"{{.origin.user}}"},{"field":"action.keyword","operator":"filter_term","value":"FileAccessed"},{"field":"log.Workload.keyword","operator":"filter_term","value":"OneDrive"}],"or":[{"indexPattern":"v11-log-o365-*","with":[{"field":"origin.user.keyword","operator":"filter_term","value":"{{.origin.user}}"},{"field":"action.keyword","operator":"filter_term","value":"FileAccessedExtended"},{"field":"log.Workload.keyword","operator":"filter_term","value":"OneDrive"}],"or":null,"within":"now-30m","count":67},{"indexPattern":"v11-log-o365-*","with":[{"field":"origin.user.keyword","operator":"filter_term","value":"{{.origin.user}}"},{"field":"action.keyword","operator":"filter_term","value":"FilePreviewed"},{"field":"log.Workload.keyword","operator":"filter_term","value":"OneDrive"}],"or":null,"within":"now-30m","count":67}],"within":"now-30m","count":67}]');
INSERT INTO public.utm_correlation_rules VALUES (324, 'Power Apps Data Connector Suspicious Activity', 3, 2, 1, 'Collection', 'T1530 - Data from Cloud Storage Object', 'Detects creation or modification of Power Apps data connectors that could lead to unauthorized data access or exfiltration from corporate data sources. This rule identifies suspicious Power Apps activities including app creation/modification, data connection changes, and data export/import operations that may indicate an attempt to access or exfiltrate sensitive organizational data.

Next Steps:
1. Review the specific Power Apps activity and determine if it was authorized
2. Verify the user''s role and permissions for Power Apps and data connectors
3. Examine the data sources being connected to and assess their sensitivity
4. Check for any recent data exports or unusual data access patterns
5. Review the user''s recent activity for other suspicious behavior
6. Validate the legitimacy of any new apps or data connections created
7. Consider implementing additional monitoring for the affected user account
8. If unauthorized, immediately revoke access and investigate potential data compromise
', '["https://docs.microsoft.com/en-us/power-platform/admin/audit-data-user-activity","https://attack.mitre.org/techniques/T1530/"]', 'safe("action", "") in ["CreateApp", "EditApp", "DeleteApp", "ShareApp", "UnshareApp", "CreateDataConnection", "UpdateDataConnection", "DeleteDataConnection", "ExportData", "ImportData"] && 
safe("actionResult", "") == "Success" &&
safe("log.Workload", "") == "PowerApps"
', '2025-09-03 14:49:39.727994', true, false, 'origin', '["origin.user","origin.ip"]', '[]');
INSERT INTO public.utm_correlation_rules VALUES (325, 'Suspicious Power Automate Flow Activity', 3, 3, 2, 'Collection', 'Automated Collection', 'Detects creation or modification of Power Automate flows that could be used for automated data exfiltration or unauthorized process automation. This rule identifies suspicious Power Automate activity including flow creation, modification, sharing, and connection management that may indicate malicious automation attempts.

Next Steps:
1. Investigate the user account performing the Power Automate actions - verify if this is legitimate business activity
2. Review the specific flows created or modified - analyze their triggers, actions, and data access patterns
3. Check if the flows are accessing sensitive data sources (SharePoint, OneDrive, databases, external APIs)
4. Examine flow sharing patterns - verify if flows are being shared with unauthorized users or external accounts
5. Review connection creation/deletion activities - check for connections to suspicious external services
6. Correlate with other Office 365 audit logs to identify broader attack patterns
7. If malicious, immediately disable the flows and revoke user permissions
8. Consider implementing Power Platform DLP policies to prevent future abuse
', '["https://docs.microsoft.com/en-us/power-platform/admin/audit-data-user-activity","https://attack.mitre.org/techniques/T1119/"]', 'safe("action", "") in ["CreateFlow", "EditFlow", "DeleteFlow", "EnableFlow", "DisableFlow", "ShareFlow", "UnshareFlow", "CreateConnection", "DeleteConnection"] && 
safe("actionResult", "") == "Success" &&
safe("log.Workload", "") == "PowerAutomate"
', '2025-09-03 14:49:40.241183', true, false, 'origin', '["origin.user","action"]', '[]');
INSERT INTO public.utm_correlation_rules VALUES (1335, 'Windows: Enable Host Network Discovery via Netsh', 2, 3, 1, 'Defense Evasion', 'Impair Defenses', 'Identifies use of the netsh.exe program to enable host discovery via the network. Attackers can use this command-line tool to weaken the host firewall settings.', '["https://attack.mitre.org/tactics/TA0005/","https://attack.mitre.org/techniques/T1562/"]', 'safe("log.winlogEventDataProcessName", "").matches("netsh.exe") && safe("log.message", "").matches("(group=Network Discovery)") && safe("log.message", "").matches("(action=allow|enable=Yes|enable)")', '2025-09-04 20:23:54.112269', true, false, 'origin', NULL, '[]');
INSERT INTO public.utm_correlation_rules VALUES (328, 'SharePoint Mass File Download Detected', 3, 1, 2, 'Collection', 'T1213 - Data from Information Repositories', 'Detects when a user downloads an unusually large number of files from SharePoint or OneDrive within a short time period, which could indicate data exfiltration or insider threat activity. This rule triggers when a user downloads 100 or more files within 30 minutes.

**Next Steps:**
1. Review the user''s recent activity patterns and determine if the download volume is consistent with their role and responsibilities
2. Check if the user has legitimate business justification for downloading large amounts of data
3. Examine the types of files downloaded and their sensitivity levels
4. Verify the user''s location and device used for the downloads
5. Look for any concurrent suspicious activities such as unusual login times or access from new locations
6. Contact the user''s manager to validate the business need for the file downloads
7. Consider implementing additional monitoring or restrictions if the activity appears suspicious
8. Review data loss prevention (DLP) policies and ensure they are properly configured
', '["https://www.sharepointdiary.com/2020/10/how-to-track-document-downloads-using-audit-log-in-sharepoint-online.html","https://attack.mitre.org/techniques/T1213/"]', 'safe("action", "") == "FileDownloaded" && safe("origin.user", "") != "" && safe("log.Workload", "") in ["SharePoint", "OneDrive"]', '2025-09-03 14:49:42.143657', true, false, 'origin', '["origin.user","origin.ip"]', '[{"indexPattern":"v11-log-o365-*","with":[{"field":"origin.user.keyword","operator":"filter_term","value":"{{.origin.user}}"},{"field":"action.keyword","operator":"filter_term","value":"FileDownloaded"}],"or":null,"within":"now-30m","count":100}]');
INSERT INTO public.utm_correlation_rules VALUES (331, 'Threat Intelligence Alert Pattern', 3, 3, 2, 'Initial Access', 'Phishing', 'Detects threat intelligence alerts from Office 365 security services indicating known malicious activities, threat actor patterns, or indicators of compromise matching threat intelligence feeds. These alerts are generated when Microsoft''s threat intelligence systems identify suspicious activities, malicious file attachments, URLs, or communication patterns associated with known threat actors.

Next Steps:
1. Immediately review the alert details and associated threat intelligence indicators
2. Investigate the affected user account for any compromise indicators
3. Check email activity and file access patterns for the affected user
4. Verify if any malicious files were opened or downloaded
5. Review authentication logs for unusual sign-in patterns
6. Examine network connections and data transfer activities
7. Check for lateral movement attempts within the organization
8. Implement containment measures if compromise is confirmed
9. Update security policies and user training based on attack vectors
10. Report findings to incident response team and document lessons learned
', '["https://learn.microsoft.com/en-us/microsoft-365/security/defender/threat-analytics","https://attack.mitre.org/techniques/T1566/"]', 'safe("action", "") == "ThreatIntelligenceAlertTriggered" || (safe("log.AlertType", "") == "ThreatIntelligence" && safe("actionResult", "") != "Success")', '2025-09-03 14:49:44.211154', true, false, 'origin', '["origin.user","target.user"]', '[]');
INSERT INTO public.utm_correlation_rules VALUES (335, 'GCP probable Defense Evasion, Firewall Rule Creation', 1, 2, 3, 'Defense Evasion', 'Impair Defenses', 'Defense Evasion consists of techniques that adversaries use to avoid detection throughout their compromise.  Techniques used for defense evasion include uninstalling/disabling security software or  obfuscating/encrypting data and scripts. Adversaries also leverage and abuse trusted processes  to hide and masquerade their malware. Other tactics are cross-listed here when those techniques  include the added benefit of subverting defenses. <br>  Identifies when a firewall rule is created in Google Cloud Platform (GCP). Virtual Private Cloud (VPC) firewall  rules can be configured to allow or deny connections to or from virtual machine (VM) instances. An adversary may  create a new firewall rule in order to weaken their target''s security controls and allow more permissive ingress or  egress traffic flows for their benefit.', '["https://cloud.google.com/vpc/docs/firewalls","https://attack.mitre.org/techniques/T1562/","https://attack.mitre.org/tactics/TA0005/"]', 'safe("log.protoPayload.methodName ", "").matches("((.+)?v(\\w+)(\\.compute\\.firewalls\\.insert)|(.+)?(compute\\.v(\\w+)\\.firewalls\\.insert)|(.+)?beta(\\w+)?(\\.compute\\.firewalls\\.insert)|(.+)?(compute\\.beta(\\w+)?\\.firewalls\\.insert))")', '2025-09-03 14:59:32.587407', true, false, 'origin', NULL, '[]');
INSERT INTO public.utm_correlation_rules VALUES (336, 'GCP probable Defense Evasion, Firewall Rule Deletion', 1, 2, 3, 'Defense Evasion', 'Impair Defenses', 'Defense Evasion consists of techniques that adversaries use to avoid detection throughout their compromise.  Techniques used for defense evasion include uninstalling/disabling security software or  obfuscating/encrypting data and scripts. Adversaries also leverage and abuse trusted processes  to hide and masquerade their malware. Other tactics are cross-listed here when those techniques  include the added benefit of subverting defenses. <br>  Identifies when a firewall rule is deleted in Google Cloud Platform (GCP). Virtual Private Cloud (VPC) firewall  rules can be configured to allow or deny connections to or from virtual machine (VM) instances. An adversary may  delete a firewall rule in order to weaken their target''s security controls.', '["https://cloud.google.com/vpc/docs/firewalls","https://attack.mitre.org/techniques/T1562/","https://attack.mitre.org/tactics/TA0005/"]', 'safe("log.protoPayload.methodName ", "").matches("((.+)?v(\\w+)(\\.compute\\.firewalls\\.delete)|(.+)?(compute\\.v(\\w+)\\.firewalls\\.delete)|(.+)?beta(\\w+)?(\\.compute\\.firewalls\\.delete)|(.+)?(compute\\.beta(\\w+)?\\.firewalls\\.delete))")', '2025-09-03 14:59:32.947229', true, false, 'origin', NULL, '[]');
INSERT INTO public.utm_correlation_rules VALUES (1454, 'Windows: Volume Shadow Copy Deletion via PowerShell', 1, 2, 3, 'Impact', 'Inhibit System Recovery', 'Identifies the use of the Win32_ShadowCopy class and related cmdlets to achieve shadow copy deletion. This commonly occurs in tandem with ransomware or other destructive attacks.', '["https://attack.mitre.org/tactics/TA0040/","https://attack.mitre.org/techniques/T1490/"]', 'safe("log.eventDataProcessName", "").matches("(powershell.exe|pwsh.exe|powershell_ise.exe)") && safe("log.message", "").matches("(Get-WmiObject|gwmi|Get-CimInstance|gcim)") && safe("log.message", "").matches("(Win32_ShadowCopy)") && safe("log.message", "").matches("(\\.Delete\\(\\)|Remove-WmiObject|rwmi|Remove-CimInstance|rcim)")', '2025-09-04 21:02:16.667802', true, false, 'origin', NULL, '[]');
INSERT INTO public.utm_correlation_rules VALUES (338, 'GCP probable Defense Evasion, Logging Sink Deletion', 1, 2, 3, 'Defense Evasion', 'Impair Defenses', 'Defense Evasion consists of techniques that adversaries use to avoid detection throughout their compromise.  Techniques used for defense evasion include uninstalling/disabling security software or  obfuscating/encrypting data and scripts. Adversaries also leverage and abuse trusted processes  to hide and masquerade their malware. Other tactics are cross-listed here when those techniques  include the added benefit of subverting defenses. <br>  Identifies a Logging sink deletion in Google Cloud Platform (GCP). Every time a log entry arrives, Logging  compares the log entry to the sinks in that resource. Each sink whose filter matches the log entry writes a  copy of the log entry to the sink''s export destination. An adversary may delete a Logging sink to evade detection.', '["https://cloud.google.com/logging/docs/export","https://attack.mitre.org/techniques/T1562/","https://attack.mitre.org/tactics/TA0005/"]', 'safe("log.protoPayload.methodName ", "").matches("((.+)?sink(s)?\\.delete|(.+)?v(\\w+)\\.ConfigServiceV(\\w+)\\.DeleteSink)")', '2025-09-03 14:59:33.800903', true, false, 'origin', NULL, '[]');
INSERT INTO public.utm_correlation_rules VALUES (339, 'GCP probable Defense Evasion, Pub/Sub Subscription Deletion', 2, 3, 3, 'Defense Evasion', 'Impair Defenses', 'Defense Evasion consists of techniques that adversaries use to avoid detection throughout their compromise.  Techniques used for defense evasion include uninstalling/disabling security software or  obfuscating/encrypting data and scripts. Adversaries also leverage and abuse trusted processes  to hide and masquerade their malware. Other tactics are cross-listed here when those techniques  include the added benefit of subverting defenses. <br>  Identifies the deletion of a subscription in Google Cloud Platform (GCP). In GCP, the publisher-subscriber  relationship (Pub/Sub) is an asynchronous messaging service that decouples event-producing and event-processing  services. A subscription is a named resource representing the stream of messages to be delivered to the subscribing application.', '["https://cloud.google.com/pubsub/docs/overview","https://attack.mitre.org/techniques/T1562/","https://attack.mitre.org/tactics/TA0005/"]', 'safe("log.protoPayload.methodName ", "").matches("((.+)?subscription(s)?\\.delete|(.+)?v(\\w+)\\.Subscriber\\.DeleteSubscription)")', '2025-09-03 14:59:34.231328', true, false, 'origin', NULL, '[]');
INSERT INTO public.utm_correlation_rules VALUES (345, 'Credential Theft Attemp detected in Sophos Central', 3, 3, 3, 'Credential Access', 'Credential Dumping', 'The theft of access credentials to different pages or apps occurs due to the use  of insecure passwords, which are used in different accounts.  This data is often exposed as a result of leaks that arise from the exploitation of vulnerabilities in different platforms.', '["https://attack.mitre.org/tactics/TA0006/","https://attack.mitre.org/techniques/T1003/"]', 'safe("log.type", "").contains(''Event::Endpoint::HmpaCred'')', '2025-09-03 15:00:15.431915', true, false, 'target', NULL, '[]');
INSERT INTO public.utm_correlation_rules VALUES (1249, 'VMware Tools Vulnerability Exploitation', 3, 3, 2, 'Initial Access', 'T1190 - Exploit Public-Facing Application', 'Detects potential exploitation of VMware Tools vulnerabilities by monitoring for suspicious authentication events, command execution patterns, and error messages related to VMware Tools operations. VMware Tools vulnerabilities can be exploited to gain unauthorized access to virtual machines or escalate privileges within the virtualized environment.

Next Steps:
1. Immediately isolate the affected ESXi host or virtual machine
2. Check VMware Tools version and compare against known vulnerable versions
3. Review authentication logs for signs of unauthorized access attempts
4. Examine process execution logs around the time of the alert
5. Verify the integrity of VMware Tools installation and configuration
6. Update VMware Tools to the latest secure version if vulnerabilities are confirmed
7. Review network traffic to and from the affected system for indicators of compromise
8. Check for lateral movement attempts from the compromised system
', '["https://attack.mitre.org/techniques/T1190/","https://docs.vmware.com/en/VMware-vSphere/8.0/vsphere-security/GUID-F35D7005-58EB-48AC-99D5-B9942EB2A8EF.html"]', '(safe("log.message", "").matches("(?i)vmware tools") && safe("severity", "") == "error") ||
(safe("log.message", "").matches("(?i)authentication of user") && safe("log.message", "").matches("(?i)failed")) ||
safe("log.message", "").matches("(?i)LW_ERROR_PASSWORD_MISMATCH") ||
(safe("log.message", "").matches("(?i)Cannot login") && safe("log.process", "").matches("(?i)vmtoolsd")) ||
safe("log.message", "").matches("(?i)rejected password for user") ||
(safe("log.message", "").matches("(?i)vmtoolsd") && safe("log.message", "").matches("(?i)exploit"))
', '2025-09-04 19:00:53.25138', true, false, 'origin', '["origin.hostname"]', '[]');
INSERT INTO public.utm_correlation_rules VALUES (1340, 'Windows: Microsoft Build Engine Started by a Script Process', 3, 3, 2, 'Defense Evasion', 'MSBuild', 'An instance of MSBuild, the Microsoft Build Engine, was started by a script or the Windows command interpreter. This behavior is unusual and is sometimes used by malicious payloads.', '["https://attack.mitre.org/tactics/TA0005/","https://attack.mitre.org/techniques/T1127/001/"]', 'safe("log.winlogEventDataProcessName", "").matches("MSBuild.exe") && safe("log.winlogEventDataParentProcessName", "").matches("(cmd.exe|powershell.exe|wscript.exe|cscript.exe)")', '2025-09-04 20:23:56.172089', true, false, 'origin', NULL, '[]');
INSERT INTO public.utm_correlation_rules VALUES (1455, 'Windows: Volume Shadow Copy Deletion via WMIC', 1, 2, 3, 'Impact', 'Inhibit System Recovery', 'Identifies use of wmic.exe for shadow copy deletion on endpoints. This commonly occurs in tandem with ransomware or other destructive attacks.', '["https://attack.mitre.org/tactics/TA0040/","https://attack.mitre.org/techniques/T1490/"]', 'safe("log.message", "").matches("(delete(.+)shadowcopy|shadowcopy(.+)delete)") && safe("log.eventDataProcessName", "").contains("WMIC.exe")', '2025-09-04 21:02:17.191849', true, false, 'origin', NULL, '[]');
INSERT INTO public.utm_correlation_rules VALUES (340, 'GCP probable Defense Evasion, Pub/Sub Topic Deletion', 2, 3, 3, 'Defense Evasion', 'Impair Defenses', 'Defense Evasion consists of techniques that adversaries use to avoid detection throughout their compromise.  Techniques used for defense evasion include uninstalling/disabling security software or  obfuscating/encrypting data and scripts. Adversaries also leverage and abuse trusted processes  to hide and masquerade their malware. Other tactics are cross-listed here when those techniques  include the added benefit of subverting defenses. <br>  Identifies the deletion of a topic in Google Cloud Platform (GCP). In GCP, the publisher-subscriber relationship  (Pub/Sub) is an asynchronous messaging service that decouples event-producing and event-processing services. A publisher  application creates and sends messages to a topic. Deleting a topic can interrupt message flow in the Pub/Sub pipeline.', '["https://cloud.google.com/pubsub/docs/overview","https://attack.mitre.org/techniques/T1562/","https://attack.mitre.org/tactics/TA0005/"]', 'safe("log.protoPayload.methodName ", "").matches("((.+)?topic(s)?\\.delete|(.+)?v(\\w+)\\.Publisher\\.DeleteTopic)")', '2025-09-03 14:59:34.82448', true, false, 'origin', NULL, '[]');
INSERT INTO public.utm_correlation_rules VALUES (341, 'GCP probable Defense Evasion, Storage Bucket Configuration Modification', 1, 2, 3, 'Defense Evasion', 'Impair Defenses', 'Defense Evasion consists of techniques that adversaries use to avoid detection throughout their compromise.  Techniques used for defense evasion include uninstalling/disabling security software or  obfuscating/encrypting data and scripts. Adversaries also leverage and abuse trusted processes  to hide and masquerade their malware. Other tactics are cross-listed here when those techniques  include the added benefit of subverting defenses. <br>  Identifies when the configuration is modified for a storage bucket in Google Cloud Platform (GCP). An adversary may  modify the configuration of a storage bucket in order to weaken the security controls of their target''s environment.', '["https://cloud.google.com/logging/docs/buckets","https://attack.mitre.org/techniques/T1562/","https://attack.mitre.org/tactics/TA0005/"]', 'safe("log.protoPayload.methodName ", "").matches("((.+)?bucket(s)?\\.update|(.+)?bucket(s)?\\.patch)")', '2025-09-03 14:59:35.248158', true, false, 'origin', NULL, '[]');
INSERT INTO public.utm_correlation_rules VALUES (342, 'Restricted or blocked application detected in Sophos Central', 1, 2, 2, 'Impact', 'Data Manipulation', 'Potentially unsafe applications is the classification used for commercial, legitimate software.  This classification includes programs such as remote access tools, password-cracking applications,  and keyloggers (a program that records each keystroke a user types).', '["https://attack.mitre.org/tactics/TA0040/","https://attack.mitre.org/techniques/T1565/"]', 'safe("log.type", "") in [''Event::Endpoint::WindowsFirewall::Blocked'', ''Event::Endpoint::Application::Blocked'', ''Event::Endpoint::Application::Detected'']', '2025-09-03 15:00:12.801102', true, false, 'origin', NULL, '[]');
INSERT INTO public.utm_correlation_rules VALUES (357, 'Real Time Protection disabled in Sophos Central', 2, 2, 1, 'Real-time protection disabled', 'Data Manipulation', 'Real-time protection has been disabled, which can help malware and attacks go undetected', '["https://www.makeuseof.com/real-time-protection/"]', 'safe("log.type", "") == "Event::Endpoint::SavDisabled"', '2025-09-03 15:00:57.605207', true, false, 'origin', NULL, '[]');
INSERT INTO public.utm_correlation_rules VALUES (346, 'Potentially compromised or blocked device detected in Sophos Central', 3, 3, 3, 'Resource Development', 'Compromise Infrastructure', 'Adversaries may compromise third-party infrastructure that can be used during targeting', '["https://attack.mitre.org/techniques/T1584/"]', 'safe("log.type", "") in [''Event::Endpoint::Device::Blocked'', ''Event::UAV::PotentiallyCompromisedDevice'']', '2025-09-03 15:00:16.026521', true, false, 'origin', NULL, '[]');
INSERT INTO public.utm_correlation_rules VALUES (348, 'Probable attempt to exploit vulnerabilities detected in Sophos Central', 3, 3, 3, 'Credential Access', 'Exploitation for Credential Access', 'An exploit is a small program designed to exploit a particular bug in an operating system or program for various purposes.  Depending on the type of vulnerability, the exploit can have different purposes,  such as gaining administrator permissions on the system or bypassing security measures in order to carry out a deeper infection.', '["https://attack.mitre.org/tactics/TA0006/","https://attack.mitre.org/techniques/T1212/"]', 'safe("log.type", "").matches("Event::Endpoint::HmpaPrivGuard|Event::Endpoint::HmpaExploitPrevented")', '2025-09-03 15:00:17.120017', true, false, 'origin', NULL, '[]');
INSERT INTO public.utm_correlation_rules VALUES (392, 'Probable Sophos ip spoofing attack', 3, 3, 3, 'Impact', 'Endpoint Denial of Service', 'IP spoofing is the creation of Internet Protocol (IP) packets which have a modified source address in order to either hide  the identity of the sender, to impersonate another computer system, or both. It is a technique often used by bad actors to  invoke DDoS attacks against a target device or the surrounding infrastructure.', '["https://support.sophos.com/support/s/article/KB-000035616?language=en_US","https://docs.sophos.com/nsg/sophos-firewall/17.5/Help/en-us/webhelp/onlinehelp/nsg/sfos/concepts/DoSBypassRuleManage.html","https://attack.mitre.org/tactics/TA0040","https://attack.mitre.org/techniques/T1499/","https://www.cloudflare.com/learning/ddos/glossary/ip-spoofing/"]', 'safe("log.component", "") == "IP spoof"', '2025-09-03 15:05:40.265105', true, false, 'origin', NULL, '[]');
INSERT INTO public.utm_correlation_rules VALUES (350, 'Malware detected in Sophos Central', 3, 3, 3, 'Malware', 'Malware detected', 'A computer virus is a piece of malicious code that is prepended or appended to existing files on your computer.  Viruses are named after biological viruses because they use similar techniques to spread from one place to another.  Virus is often misused to refer to any threat. This usage is gradually being replaced with a more accurate term, malware (malicious software). Computer viruses primarly attack executable files and documents. In short, this is how a computer virus works:  after running the infected file, the malicious code is called and executed prior to the execution of the original application.  A virus can infect any files that the current user has write permissions for. Computer viruses can range in purpose and severity. Some of them are extremely dangerous because of their ability to delete files purposely from the hard drive.  On the other hand, some viruses do not cause any damage they only serve to annoy the user and demonstrate the technical skills of their authors.', '["https://www.mcafee.com/en-us/antivirus/malware.html"]', 'safe("log.type", "").matches("^Event::Endpoint::(CoreDetection|CoreRemoteDetection|CoreHmpaClean|CoreClean)$|Event::Endpoint::(HmpaMalware|CoreHmpaCleanFailed|CoreCleanFailed)|Event::SpamOrVirus::Alert|Event::Endpoint::Threat::(HIPS|Dismissed|CleanedUp)|Event::OutboundMalwareProtection::BlockedSender")', '2025-09-03 15:00:18.704757', true, false, 'origin', NULL, '[]');
INSERT INTO public.utm_correlation_rules VALUES (351, 'Man in the Middle Attack detected in Sophos Central', 3, 3, 3, 'Credential Access', 'Adversary-in-the-Middle', 'Adversaries may attempt to position themselves between two or more networked devices  using an adversary-in-the-middle technique to support follow-on behaviors such as Network Sniffing  or Transmitted Data Manipulation. By abusing features of common networking protocols that can determine  the flow of network traffic (e.g. ARP, DNS, LLMNR, etc.), adversaries may force a device to communicate  through an adversary controlled system so they can collect information or perform additional actions.', '["https://attack.mitre.org/tactics/TA0006/","https://attack.mitre.org/techniques/T1557/"]', 'safe("log.type", "").contains("Event::Smc::MitmAttackEvent")', '2025-09-03 15:00:19.324967', true, false, 'origin', NULL, '[]');
INSERT INTO public.utm_correlation_rules VALUES (352, 'Possible Botnet detected in Sophos Central', 3, 3, 3, 'Impact', 'Data Manipulation', 'A bot, or a web robot is an automated malware program that scans blocks of network addresses and infects vulnerable computers.  This allow hackers to take control of many computers at the same time and turn them into bots (also known as a zombie).  Hackers typically use bots to infect large numbers of computers, which form a network or a botnet.  Once the botnet is in your computer, it can be used in distributed denial of service (DDoS) attacks, proxy and also can be used to perform automated tasks over the Internet, without you knowing it  (for example sending spam, viruses or stealing personal and private information such as bank credentials or credit card numbers).', '["https://attack.mitre.org/tactics/TA0040/","https://attack.mitre.org/techniques/T1565/"]', 'safe("log.type", "") == "Event::Firewall::FirewallAdvancedThreatProtection"', '2025-09-03 15:00:53.593072', true, false, 'origin', NULL, '[]');
INSERT INTO public.utm_correlation_rules VALUES (353, 'Possible Brute Force Attack detected in Sophos Central', 3, 3, 3, 'Credential Access', 'Brute Force', 'Adversaries may use brute force techniques to gain access to accounts when passwords are unknown or when password hashes are obtained.  Without knowledge of the password for an account or set of accounts, an adversary may systematically guess the password using a repetitive or iterative mechanism.  Brute forcing passwords can take place via interaction with a service that will check the validity of those credentials or offline against previously acquired credential data, such as password hashes.', '["https://attack.mitre.org/tactics/TA0006/","https://attack.mitre.org/techniques/T1110/"]', 'safe("log.type", "") == "Event::ZTNA::ZTNAAuthenticationFailure"', '2025-09-03 15:00:54.125856', true, false, 'origin', NULL, '[{"indexPattern":"v11-log-sophos-central-*","with":[{"field":"log.type.keyword","operator":"filter_term","value":"Event::ZTNA::ZTNAAuthenticationFailure"},{"field":"log.source.keyword","operator":"filter_term","value":"{{.log.source}}"}],"or":null,"within":"now-1m","count":5}]');
INSERT INTO public.utm_correlation_rules VALUES (354, 'Potential Password Spraying Attack detected in Sophos Central', 1, 2, 2, 'Credential Access', 'Brute Force', 'Adversaries may use brute force techniques to gain access to accounts when passwords are unknown or when password hashes are obtained.  Without knowledge of the password for an account or set of accounts, an adversary may systematically guess the password using a repetitive or iterative mechanism.  Brute forcing passwords can take place via interaction with a service that will check the validity of those credentials or offline against previously acquired credential data, such as password hashes.', '["https://attack.mitre.org/tactics/TA0006/","https://attack.mitre.org/techniques/T1110/"]', 'safe("log.type", "") == "Event::ZTNA::ZTNAAuthenticationFailure"', '2025-09-03 15:00:54.784829', true, false, 'origin', NULL, '[{"indexPattern":"v11-log-sophos-central-*","with":[{"field":"log.type.keyword","operator":"filter_term","value":"Event::ZTNA::ZTNAAuthenticationFailure"},{"field":"log.source_info.ip.keyword","operator":"filter_term","value":"{{.log.source_info.ip}}"}],"or":null,"within":"now-1m","count":10}]');
INSERT INTO public.utm_correlation_rules VALUES (356, 'Possible Ransomware Attack detected in Sophos Central', 3, 3, 2, 'Impact', 'Data Manipulation', 'Ransomware, is a type of malware that prevents users from accessing their system or  personal files and requires payment of a ransom in order to gain access to them again. Identifies  ransomware attempts', '["https://attack.mitre.org/tactics/TA0040/","https://attack.mitre.org/techniques/T1565/"]', 'safe("log.type", "").matches("Event::Endpoint::(HmpaCryptoGuardSMBOrigin|HmpaCryptoGuardSMB)|^Event::Endpoint::HmpaCryptoGuard$")', '2025-09-03 15:00:56.365615', true, false, 'origin', NULL, '[]');
INSERT INTO public.utm_correlation_rules VALUES (358, 'Tracking Cookies deleted in Sophos Central', 2, 2, 1, 'Tracking Cookies', 'Data Manipulation', 'Tracking cookies can collect, process and share all types of personal (and sometimes sensitive)  data from your websites end users, such as their search and browsing history, IP addresses,  behavior on the site, previous purchases or web searches. Google, and are often used to display  targeted advertising to end users as they move across the Internet.', '["https://https://www.mcafee.com/blogs/privacy-identity-protection/what-are-browser-cookies-and-how-do-i-manage-them/"]', 'safe("log.type", "") == "Event::Endpoint::HmpaCookiesDeleted"', '2025-09-03 15:00:58.267082', true, false, 'origin', NULL, '[]');
INSERT INTO public.utm_correlation_rules VALUES (1493, 'Windows Firewall Disabled via PowerShell', 1, 2, 3, 'Defense Evasion', 'Disable or Modify System Firewall', 'Identifies when the Windows Firewall is disabled using PowerShell cmdlets, which can help attackers evade network constraints, like internet and network lateral communication restrictions.', '["https://attack.mitre.org/tactics/TA0005/","https://attack.mitre.org/techniques/T1562/004/"]', 'safe("log.message", "").matches("(-All|Public|Domain|Private)") && safe("log.message", "").contains("False") && safe("log.message", "").contains("-Enabled") && safe("log.message", "").contains("Set-NetFirewallProfile") && safe("log.processName", "").matches("(powershell.exe|pwsh.exe|powershell_ise.exe)")', '2025-09-04 21:16:05.186396', true, false, 'origin', NULL, '[]');
INSERT INTO public.utm_correlation_rules VALUES (359, 'Unknown Threat detected in Sophos Central', 3, 3, 2, 'Malware', 'Data Manipulation', 'A computer virus is a piece of malicious code that is prepended or appended to existing files on your computer.  Viruses are named after biological viruses because they use similar techniques to spread from one place to another.  Virus is often misused to refer to any threat. This usage is gradually being replaced with a more accurate term, malware (malicious software). Computer viruses primarly attack executable files and documents. In short, this is how a computer virus works:  after running the infected file, the malicious code is called and executed prior to the execution of the original application.  A virus can infect any files that the current user has write permissions for. Computer viruses can range in purpose and severity. Some of them are extremely dangerous because of their ability to delete files purposely from the hard drive.  On the other hand, some viruses do not cause any damage they only serve to annoy the user and demonstrate the technical skills of their authors.', '["https://www.mcafee.com/en-us/antivirus/malware.html"]', 'safe("log.type", "").matches("Event::Endpoint::(CoreIps|HomeThreatRemnants|HmpaBehaviourPrevented|HmpaThreat|HmpaSafeBrowsing|CoreAmsi|CoreOutbreak)|Event::Endpoint::Threat::(CleanupFailed::|Ips|CommandAndControl)")', '2025-09-03 15:00:58.864337', true, false, 'origin', NULL, '[]');
INSERT INTO public.utm_correlation_rules VALUES (360, 'Blocked website detected in Sophos Central', 3, 3, 2, 'Execution', 'Malicious Link', 'A malicious link is an apparently trustworthy link that, when clicked, redirects to a fake website that mimics being a legitimate official website. Once the user believes they are browsing a trusted website, they could enter personal data such as their email, passwords and even bank details. Malicious links are often received in email messages asking the user to click on a link. With this method, on many occasions, instead of asking for personal data from the user, they get the victim to install some type of malware on their device.', '["https://attack.mitre.org/tactics/TA0002/","https://attack.mitre.org/techniques/T1204/001/"]', 'safe("log.type", "").matches("Event::Endpoint::((Smc::)?WebFiltering::BLOCKED|WebControlViolation|WebFilteringBlocked)")', '2025-09-03 15:00:59.546178', true, false, 'origin', NULL, '[]');
INSERT INTO public.utm_correlation_rules VALUES (369, 'Endpoint Threat Detection', 3, 3, 2, 'Defense Evasion, Privilege Escalation', 'T1055 - Process Injection', 'Detects threats identified on endpoints by Sophos Central, including malware, PUAs (Potentially Unwanted Applications), and suspicious behavior. This rule triggers when Sophos Central identifies threats such as process injection, malware execution, or other malicious activities on managed endpoints.

Next Steps:
1. Immediately isolate the affected endpoint from the network to prevent lateral movement
2. Review the threat details including threat name, file path, and detection method
3. Examine the endpoint''s recent activity logs for signs of compromise
4. Check if the threat was successfully quarantined or requires manual intervention
5. Verify if other endpoints in the environment show similar threat indicators
6. Review user activity on the affected endpoint around the time of detection
7. Perform forensic analysis of the affected files and processes if needed
8. Update security policies and endpoint configurations if gaps are identified
9. Conduct threat hunting across the environment for similar indicators of compromise
', '["https://developer.sophos.com/docs/endpoint-v1/1/routes/events/get","https://attack.mitre.org/techniques/T1055/"]', 'safe("log.type", "") in ["Event::Endpoint::Threat::Detected", "Event::Endpoint::Threat::HIPSDetected", "Event::Endpoint::Threat::PuaDetected"] || (safe("log.severity", "") in ["high", "critical"] && safe("log.category", "") == "threat")', '2025-09-03 15:01:32.411738', true, false, 'origin', '["log.endpointId","log.threatName"]', '[]');
INSERT INTO public.utm_correlation_rules VALUES (381, 'Sophos Central Tamper Protection Alert', 2, 3, 2, 'Defense Evasion', 'T1562.001 - Impair Defenses: Disable or Modify Tools', 'Detects when tamper protection is triggered, indicating an attempt to disable or modify Sophos security components. This could indicate malware or an attacker attempting to bypass security controls.

Next Steps:
1. Immediately investigate the affected endpoint to determine the source of the tamper protection trigger
2. Check if the endpoint shows signs of malware infection or unauthorized software installation
3. Review recent user activity and process execution on the affected system
4. Verify the integrity of Sophos security components and ensure they are functioning properly
5. Scan the endpoint for threats and malware using full system scans
6. If malicious activity is confirmed, isolate the endpoint and perform incident response procedures
7. Review security policies and user permissions to prevent future tamper attempts
8. Consider implementing additional endpoint monitoring for systems with tamper protection alerts
', '["https://developer.sophos.com/siem-api-schemas","https://attack.mitre.org/techniques/T1562/001/"]', 'safe("log.type", "") == "Event::Endpoint::Threat::TamperProtection" ||
(safe("log.name", "") == "Tamper protection" && safe("log.severity", "") == "high") ||
(safe("log.type", "") == "Event::Endpoint::TamperProtection" && safe("log.action", "") == "blocked")
', '2025-09-03 15:02:42.042005', true, false, 'origin', '["lastEvent.target.host","lastEvent.target.ip"]', '[]');
INSERT INTO public.utm_correlation_rules VALUES (394, 'Probable use of High-risk applications', 3, 3, 2, 'Lateral Movement', 'Application Layer Protocol', 'The Sophos firewall device has detected a use of potential risked applications in enterprise environment like <strong>Torrent Clients P2P</strong>. Please see the logs attached to this alert for additional details', '["https://attack.mitre.org/tactics/TA0008/"]', 'safe("log.application", "").matches("(Torrent|Proxy|EXE File Download|eMule P2P|Ares P2P)") || safe("log.applicationName", "").matches("(Torrent|Proxy|EXE File Download|eMule P2P|Ares P2P)")', '2025-09-03 15:05:41.765149', true, false, 'origin', NULL, '[]');
INSERT INTO public.utm_correlation_rules VALUES (382, 'Active Threat Investigation Case', 3, 3, 2, 'Defense Evasion, Privilege Escalation', 'T1055 - Process Injection', 'Detects when threat cases are opened for investigation indicating potential security incidents requiring analysis, particularly focusing on cases with multiple related detections or high-risk indicators. This rule identifies active threat investigation cases that suggest advanced persistent threats or coordinated attacks.

Next Steps:
1. Review the threat case details and associated detections in Sophos Central console
2. Examine the timeline of events leading to the case creation
3. Check for lateral movement indicators across the network
4. Validate if the threat has been contained or requires additional response
5. Correlate with other security tools and threat intelligence feeds
6. Document findings and update incident response procedures if needed
', '["https://docs.sophos.com/central/customer/help/en-us/ManageYourProducts/ThreatAnalysisCenter/Detections/index.html","https://attack.mitre.org/tactics/TA0008/","https://attack.mitre.org/techniques/T1055/"]', 'safe("log.type", "") == "threat_case" &&
safe("log.case_status", "") in ["open", "investigating"] &&
(safe("log.related_detections", 0) >= 3 ||
 safe("log.mitre_tactics", "").contains("persistence") ||
 safe("log.mitre_tactics", "").contains("lateral_movement") ||
 safe("log.threat_score", 0) >= 70)
', '2025-09-03 15:02:42.329053', true, false, 'origin', '["adversary.host","target.host"]', '[]');
INSERT INTO public.utm_correlation_rules VALUES (393, 'Probable password guessing in Sophos Administrator account', 3, 3, 2, 'Credential Access', 'Brute Force: Password Guessing', 'Adversaries with no prior knowledge of legitimate credentials within the system or environment  may guess passwords to attempt access to accounts. Without knowledge of the password for an account,  an adversary may opt to systematically guess the password using a repetitive or iterative mechanism.  An adversary may guess login credentials without prior knowledge of system or environment passwords  during an operation by using a list of common passwords. Password guessing may or may not take into  account the target''s policies on password complexity or use policies that may lock accounts out after  a number of failed attempts.', '["https://support.sophos.com/support/s/article/KB-000034986?language=en_US","https://attack.mitre.org/tactics/TA0006","https://attack.mitre.org/techniques/T1110/001/"]', 'safe("log.id", "").endWiths("17913")', '2025-09-03 15:05:40.88549', true, false, 'origin', NULL, '[]');
INSERT INTO public.utm_correlation_rules VALUES (361, 'Sophos Central Admin Activity Anomaly', 3, 3, 2, 'Persistence, Privilege Escalation', 'T1098 - Account Manipulation', 'Detects anomalous administrative activities in Sophos Central including unusual configuration changes, mass policy modifications, or admin actions outside normal hours that could indicate compromised admin accounts.

Next Steps:
1. Verify the admin user''s identity and confirm if the action was authorized
2. Review the specific administrative action performed and assess its impact
3. Check if the admin user''s credentials may have been compromised
4. Examine the source IP and location of the administrative activity
5. Review recent login activities for the admin account
6. Validate that the policy or configuration changes align with organizational security policies
7. Consider temporarily disabling the admin account if compromise is suspected
8. Review audit logs for other suspicious activities by the same admin user
9. Implement additional MFA controls for admin accounts if not already in place
', '["https://docs.sophos.com/central/customer/help/en-us/ManageYourProducts/GlobalSettings/ApiTokenManagement/index.html","https://attack.mitre.org/techniques/T1098/"]', '(safe("log.type", "") in ["admin_action", "configuration_change", "policy_modification"] ||
 safe("log.event", "").matches("(?i)(admin|administrator|privilege|role.*change)")) &&
(safe("log.userId", "") != "" || safe("log.admin_user", "") != "" || safe("log.modified_by", "") != "") &&
(safe("log.action", "").matches("(?i)(delete.*policy|disable.*protection|remove.*user|grant.*admin|modify.*setting)") ||
 safe("log.message", "").matches("(?i)(mass.*change|bulk.*modif|disable.*all|delete.*all)"))
', '2025-09-03 15:01:26.965119', true, false, 'origin', '["log.userId","log.action"]', '[]');
INSERT INTO public.utm_correlation_rules VALUES (362, 'Sophos Central API Security Event', 3, 3, 2, 'Credential Access', 'T1110 - Brute Force', 'Detects suspicious API access patterns, authentication failures, or potential abuse of Sophos Central API endpoints that could indicate unauthorized access attempts or API key compromise.

Next Steps:
1. Identify the source IP address and geolocation of the suspicious API requests
2. Review API access logs for patterns of failed authentication or rate limiting
3. Check if the API key or credentials associated with the requests are legitimate
4. Verify if the API endpoints being accessed are authorized for the requesting user/service
5. Look for any successful API calls from the same source after failed attempts
6. Consider implementing additional API rate limiting or blocking the source IP
7. Review API key management and rotation policies
8. Correlate with other security events from the same source or user account
', '["https://developer.sophos.com/apis","https://attack.mitre.org/techniques/T1110/"]', '(safe("log.type", "") in ["api_auth_failure", "api_rate_limit", "api_unauthorized"] ||
 safe("log.event", "").matches("(?i)(api.*auth.*fail|api.*unauthoriz|api.*forbidden)")) &&
(safe("log.api_endpoint", "") != "" ||
 safe("log.path", "").matches("(?i)/api/") ||
 safe("log.request_path", "").matches("(?i)/api/")) &&
(safe("log.status_code", 0) in [401, 403, 429] ||
 safe("log.response_code", 0) in [401, 403, 429] ||
 safe("log.error", "").matches("(?i)(unauthorized|forbidden|rate.?limit)"))
', '2025-09-03 15:01:27.52098', true, false, 'origin', '["origin.ip","target.host"]', '[{"indexPattern":"v11-log-sophos-central-*","with":[{"field":"origin.ip.keyword","operator":"filter_term","value":"{{.origin.ip}}"}],"or":null,"within":"now-15m","count":10}]');
INSERT INTO public.utm_correlation_rules VALUES (1220, 'Medium level Suricata alert', 2, 2, 2, 'Medium level Suricata alert category', 'Network Scanning', 'Suricata has detected a medium severity alert that may indicate reconnaissance or scanning attempts. This could include port scanning, protocol anomalies, or suspicious network patterns that warrant investigation but may not represent an immediate threat.', '["https://suricata.readthedocs.io/en/latest/"]', 'safe("log.eventType", "") == "alert" && safe("severity", "") == "medium"', '2025-09-05 23:19:29.873771', true, false, 'target', NULL, '[]');
INSERT INTO public.utm_correlation_rules VALUES (363, 'Application Control Block Event', 2, 3, 2, 'Execution', 'T1204 - User Execution', 'Detects when Sophos Central blocks an application from running based on application control policies. This may indicate attempted execution of unauthorized or potentially malicious applications.

Next Steps:
1. Review the blocked application details to determine if it''s legitimate software
2. Check if the application is on the approved software list
3. Investigate the user who attempted to run the blocked application
4. Verify if similar blocking events occurred on other endpoints
5. Consider updating application control policies if legitimate software was blocked
6. If malicious, perform full endpoint scan and threat hunting
', '["https://docs.sophos.com/central/customer/help/en-us/ManageYourProducts/EndpointProtection/ApplicationControl/index.html","https://attack.mitre.org/techniques/T1204/"]', 'safe("log.type", "") == "Event::Endpoint::Application::Blocked" || (safe("log.type", "") == "Event::Endpoint::Application::AlertedOnly" && safe("log.action", "") == "blocked")', '2025-09-03 15:01:28.140683', true, false, 'origin', '["log.endpointId","log.application"]', '[]');
INSERT INTO public.utm_correlation_rules VALUES (395, 'Probable use of Low-risk applications', 1, 2, 2, 'Lateral Movement', 'Application Layer Protocol', 'The Sophos firewall device has detected a use of low risked applications in enterprise environment like <strong>Xbox LIVE</strong>. Please see the logs attached to this alert for additional details.', '["https://attack.mitre.org/tactics/TA0008/"]', '!(safe("log.subType", "") in ["Deny", "deny", "Drop", "drop", "Denied", "denied", "Dropped", "dropped"]) && safe("log.application", "").matches("(ISAKMP VPN|WeTransfer Base|Xbox LIVE|OSC_AMU)") ||
safe("log.applicationName", "").matches("(ISAKMP VPN|WeTransfer Base|Xbox LIVE|OSC_AMU)")
', '2025-09-03 15:05:42.100327', true, false, 'origin', NULL, '[]');
INSERT INTO public.utm_correlation_rules VALUES (364, 'Sophos Central Behavioral Analysis Alert', 3, 3, 2, 'Defense Evasion, Privilege Escalation', 'T1055 - Process Injection', 'Detects suspicious behavior patterns identified by Sophos behavioral analysis engine, including process injection attempts, privilege escalation, and other anomalous activities that indicate potential compromise.

Next Steps:
1. Review the specific behavioral detection details in the Sophos Central console
2. Examine the affected endpoint for signs of compromise
3. Check process execution history and parent-child relationships
4. Investigate network connections from the affected endpoint
5. Review file system changes and registry modifications
6. Consider isolating the endpoint if malicious activity is confirmed
7. Update endpoint security policies based on findings
', '["https://developer.sophos.com/siem-api-schemas","https://attack.mitre.org/techniques/T1055/"]', 'safe("log.type", "") == "Event::Endpoint::Threat::BehavioralDetection" ||
safe("log.type", "") == "Event::Endpoint::BehaviorDetected" ||
safe("log.detectionMethod", "") in ["Behavioral", "HIPS"] ||
(safe("log.name", "").contains("Behavioral") && safe("log.severity", "") in ["medium", "high", "critical"]) ||
(safe("log.description", "").contains("suspicious behavior") || safe("log.description", "").contains("behavioral detection") || safe("log.description", "").contains("process injection"))
', '2025-09-03 15:01:29.24441', true, false, 'origin', '["target.host","log.processPath"]', '[]');
INSERT INTO public.utm_correlation_rules VALUES (366, 'Data Loss Prevention Policy Triggered', 3, 2, 1, 'Exfiltration', 'T1567 - Exfiltration Over Web Service', 'Detects when data loss prevention (DLP) policies are triggered, indicating potential attempts to transfer sensitive data outside of authorized channels or violations of data handling policies. This could represent data exfiltration attempts, policy violations, or insider threats.

Next Steps:
1. Review the specific DLP rule that was triggered and the data involved
2. Investigate the user account and endpoint involved in the incident
3. Analyze the attempted transfer method and destination
4. Verify if the data transfer was authorized and legitimate
5. Check for additional DLP violations from the same user or endpoint
6. Review file access logs and user activity around the time of the incident
7. Consider implementing additional monitoring for the affected user/endpoint
', '["https://docs.sophos.com/central/customer/help/en-us/ManageYourProducts/LogsReports/Logs/datalosspreventionevents/index.html","https://attack.mitre.org/techniques/T1567/"]', 'safe("log.type", "") == "Event::Endpoint::DataLossPrevention" || safe("log.category", "") == "DLP" || (safe("log.action", "") == "blocked" && safe("log.ruleName", "") != "")', '2025-09-03 15:01:30.48501', true, false, 'origin', '["lastEvent.host","log.ruleName"]', '[]');
INSERT INTO public.utm_correlation_rules VALUES (1461, 'Windows Defender: ERROR: ACTIVE THREATS', 1, 2, 3, 'Potentially Compromised System', 'User Execution', 'Detects the ''ACTIVE THREATS'' error event in Windows Defender, which may indicate ongoing threats or vulnerabilities on the system.', '["https://learn.microsoft.com/en-us/windows/security/threat-protection/windows-defender-antivirus/troubleshoot"]', 'safe("log.winlogEventDataLogName", "") == "Microsoft-Windows-Windows Defender/Operational" &&  safe("log.winlogEventDataErrorCode", "") == "0x80501003"', '2025-09-04 21:11:26.758227', true, false, 'target', NULL, '[]');
INSERT INTO public.utm_correlation_rules VALUES (365, 'Cloud Security Posture Management Alert', 3, 3, 2, 'Persistence, Privilege Escalation', 'T1098 - Account Manipulation', 'Detects cloud security posture management alerts indicating potential misconfigurations or compliance violations in cloud resources that could lead to security exposures. These alerts typically identify issues such as open security groups, unencrypted storage, excessive permissions, or other configuration drift that increases attack surface.

Next Steps:
1. Review the specific cloud resource and configuration that triggered the alert
2. Assess the compliance violation details and potential security impact
3. Verify if the configuration change was authorized and documented
4. Check for any recent changes to the affected cloud resource
5. Remediate the misconfiguration according to security best practices
6. Update security policies and baselines to prevent similar issues
7. Monitor for additional posture violations across the cloud environment
8. Consider implementing automated remediation for common misconfigurations
', '["https://docs.sophos.com/central/customer/help/en-us/ManageYourProducts/CloudSecurity/index.html","https://attack.mitre.org/techniques/T1098/"]', 'safe("log.type", "") == "cloud_posture" &&
safe("log.severity", "") in ["high", "critical"] &&
safe("log.compliance_status", "") == "failed"
', '2025-09-03 15:01:29.946501', true, false, 'origin', '["log.customerId","log.resource_id"]', '[]');
INSERT INTO public.utm_correlation_rules VALUES (370, 'Sophos Central Exploit Prevention Triggered', 3, 3, 2, 'Execution', 'T1203 - Exploitation for Client Execution', 'Detects when Sophos exploit prevention is triggered, indicating attempted exploitation of vulnerable applications. This includes shellcode protection, CTF protocol exploitation attempts, and process hijacking attempts.

Next Steps:
1. Immediately isolate the affected endpoint to prevent lateral movement
2. Review the exploit details including target application and attack vector
3. Check for additional suspicious activity on the affected host within the past 24 hours
4. Verify if the targeted application is up to date with security patches
5. Examine network connections from the affected host for C2 communication
6. Review user activity and authentication logs for the affected endpoint
7. Consider running additional endpoint scans for indicators of compromise
8. Update security policies if the exploit targeted a previously unknown vulnerability
', '["https://developer.sophos.com/siem-api-schemas","https://attack.mitre.org/techniques/T1203/"]', 'safe("log.type", "") == "Event::Endpoint::Threat::ExploitPrevented" ||
safe("log.type", "") == "Event::Endpoint::Exploit::Prevented" ||
(safe("log.name", "") == "Exploit prevented" && safe("log.severity", "") in ["high", "critical"]) ||
(safe("log.description", "").contains("shellcode") || safe("log.description", "").contains("CTF protocol") || safe("log.description", "").contains("process hijack"))
', '2025-09-03 15:01:33.446393', true, false, 'origin', '["adversary.host","log.name"]', '[{"indexPattern":"v11-log-sophos-central-*","with":[{"field":"log.endpointId.keyword","operator":"filter_term","value":"{{.log.endpointId}}"}],"or":null,"within":"now-30m","count":2}]');
INSERT INTO public.utm_correlation_rules VALUES (409, 'GCP probable Impact, Virtual Private Cloud Route Deletion', 1, 2, 3, 'Impact', 'Stop Service', 'Impact consists of techniques that adversaries use to disrupt availability or compromise integrity by manipulating business  and operational processes. Techniques used for impact can include destroying or tampering with data. In some cases, business  processes can look fine, but may have been altered to benefit the adversaries goals. These techniques might be used by  adversaries to follow through on their end goal or to provide cover for a confidentiality breach. <br>  Identifies when a virtual private cloud (VPC) route is deleted in Google Cloud Platform (GCP). Google Cloud routes  define the paths that network traffic takes from a virtual machine (VM) instance to other destinations. These  destinations can be inside a Google VPC network or outside it. An adversary may delete a route in order to impact the  flow of network traffic in their target''s cloud environment.', '["https://cloud.google.com/vpc/docs/routes","https://attack.mitre.org/tactics/TA0040/","https://attack.mitre.org/techniques/T1489"]', 'safe("log.protopayload.methodName", "").matches("^((.+)\\.)?route(s)?\\.delete$")', '2025-09-03 15:06:13.342709', true, false, 'origin', NULL, '[]');
INSERT INTO public.utm_correlation_rules VALUES (371, 'Sophos Central Integration Failure', 1, 2, 3, 'Discovery', 'T1087 - Account Discovery', 'Detects failures in Sophos Central integrations with third-party systems, SIEM connections, or API integrations that could impact security monitoring and response capabilities. Integration failures can indicate potential security monitoring blind spots or system compromise attempts.

Next Steps:
1. Review the specific integration that failed and check system logs for detailed error messages
2. Verify API credentials and authentication tokens are valid and not expired
3. Check network connectivity between Sophos Central and the target system
4. Examine the integration configuration for any misconfigurations
5. Monitor for repeated failures that could indicate deliberate interference
6. Validate that security monitoring coverage remains adequate during the outage
7. Consider implementing backup monitoring solutions for critical integrations
', '["https://community.sophos.com/kb/en-us/125169","https://attack.mitre.org/techniques/T1087/"]', 'safe("log.type", "") in ["integration_error", "api_failure", "connection_failed"] ||
safe("log.component", "").matches("(?i)(integration|api|connector)") ||
safe("log.event", "").matches("(?i)(integration.*fail|api.*error|connection.*timeout)") ||
safe("log.message", "").matches("(?i)(siem.*fail|integration.*error|api.*timeout|webhook.*fail)") ||
(safe("log.error_code", "") in ["401", "403", "500", "503"] && safe("log.api_endpoint", "") != "")
', '2025-09-03 15:02:05.805147', true, false, 'origin', '["log.api_endpoint","origin.host"]', '[]');
INSERT INTO public.utm_correlation_rules VALUES (372, 'Sophos Central License Compliance Violation', 1, 2, 3, 'Defense Evasion, Persistence, Privilege Escalation, Initial Access', 'T1078 - Valid Accounts', 'Detects license compliance issues in Sophos Central, including expired licenses, over-usage, or non-compliant endpoints that could lead to reduced protection or service disruption.

Next Steps:
1. Immediately verify the license status in Sophos Central dashboard
2. Check if endpoints are properly managed and licensed
3. Review license allocation and usage metrics
4. Contact Sophos support if license issues persist
5. Ensure all endpoints maintain proper protection coverage
6. Update license documentation and renewal schedules
', '["https://docs.sophos.com/central/customer/help/en-us/ManageYourProducts/Licensing/index.html","https://attack.mitre.org/techniques/T1078/"]', 'safe("log.type", "") in ["Event::Endpoint::NonCompliant", "license_violation", "license_expired"] ||
safe("log.name", "").matches("(?i)(license|compliance)") ||
safe("log.event", "").matches("(?i)(license.*expir|compliance.*violat|license.*exceed)") ||
safe("log.message", "").matches("(?i)(license.*limit|subscription.*expir|compliance.*fail)") ||
(safe("log.status", "") == "noncompliant" && safe("log.reason", "").matches("(?i)license"))
', '2025-09-03 15:02:06.627351', true, false, 'origin', '["log.customerId","log.endpointId"]', '[]');
INSERT INTO public.utm_correlation_rules VALUES (373, 'Sophos Central Machine Learning Threat Detection', 3, 3, 2, 'Defense Evasion', 'T1027 - Obfuscated Files or Information', 'Detects threats identified by Sophos machine learning models, including zero-day malware and previously unknown threats. These detections indicate sophisticated threats that evaded signature-based detection and may represent advanced persistent threats or novel attack techniques.

Next Steps:
1. Immediately isolate the affected endpoint to prevent lateral movement
2. Review the full file path and hash details for the detected threat
3. Check for related network connections and data exfiltration attempts
4. Examine recent user activity and process execution on the endpoint
5. Perform memory analysis and collect forensic artifacts
6. Review security logs for signs of privilege escalation or persistence mechanisms
7. Update threat intelligence feeds with IOCs discovered during investigation
8. Consider reimaging the affected system if contamination is confirmed
', '["https://developer.sophos.com/siem-api-schemas","https://attack.mitre.org/techniques/T1027/"]', 'safe("log.type", "") == "Event::Endpoint::Threat::MachineLearningDetection" ||
safe("log.type", "") == "Event::Endpoint::MLDetection" ||
safe("log.detectionMethod", "") in ["ML", "MachineLearning"] ||
(safe("log.name", "").contains("Machine Learning") && safe("log.severity", "") in ["high", "critical"]) ||
(safe("log.description", "").contains("ML detected") || safe("log.description", "").contains("machine learning"))
', '2025-09-03 15:02:07.085224', true, false, 'origin', '["target.host","target.hash"]', '[]');
INSERT INTO public.utm_correlation_rules VALUES (367, 'Device Control Policy Violation', 3, 2, 1, 'Collection', 'T1025 - Data from Removable Media', 'Detects violations of device control policies when unauthorized devices attempt to connect or transfer data. This could indicate potential data exfiltration attempts or use of unauthorized devices that violate organizational security policies.

Next Steps:
1. Verify the legitimacy of the device and user involved in the violation
2. Check if the device control policy configuration is appropriate for business needs
3. Review recent file access and transfer activities on the affected endpoint
4. Investigate whether similar violations have occurred from the same user or endpoint
5. Examine the device type and determine if it poses a security risk
6. Consider updating device control policies if legitimate business usage is being blocked
7. If malicious activity is suspected, isolate the endpoint and perform forensic analysis
8. Review user training on acceptable device usage policies
', '["https://docs.sophos.com/central/customer/help/en-us/ManageYourProducts/EndpointProtection/ConfigureDeviceControl/index.html","https://attack.mitre.org/techniques/T1025/"]', 'safe("log.type", "") == "Event::Endpoint::Device::Blocked" || (safe("log.type", "") == "Event::Endpoint::Device::AlertedOnly" && safe("log.action", "") == "blocked")', '2025-09-03 15:01:31.185085', true, false, 'origin', '["log.endpointId","log.deviceType"]', '[{"indexPattern":"v11-log-sophos-central-*","with":[{"field":"log.endpointId.keyword","operator":"filter_term","value":"{{.log.endpointId}}"},{"field":"log.type.keyword","operator":"filter_term","value":"Event::Endpoint::Device::Blocked"}],"or":null,"within":"now-2h","count":3}]');
INSERT INTO public.utm_correlation_rules VALUES (368, 'Email Protection Events', 3, 3, 2, 'Initial Access', 'T1566 - Phishing', 'Detects email-based threats identified by Sophos Central, including phishing attempts, malicious attachments, spam campaigns, and impersonation attacks. This rule triggers when Sophos Central identifies suspicious email activities that could indicate phishing campaigns, malware distribution, or other email-based attacks.

Next Steps:
1. Review the email details including sender, recipient, subject, and message content
2. Analyze any attachments or links for malicious indicators
3. Check if the sender address is legitimate or spoofed
4. Verify if similar emails were sent to other users in the organization
5. Consider quarantining the email and blocking the sender domain if confirmed malicious
6. Update email security policies if new attack patterns are identified
7. Notify affected users about the potential threat and provide security awareness guidance
', '["https://docs.sophos.com/central/customer/help/en-us/ManageYourProducts/EmailSecurity/index.html","https://attack.mitre.org/techniques/T1566/"]', 'safe("log.type", "") in ["Event::Email::Threat::Detected", "Event::Email::Phishing::Detected", "Event::Email::Malware::Detected", "Event::Email::Impersonation::Detected", "Event::Email::Spam::Detected"] || (safe("log.category", "") == "email" && safe("log.severity", "") in ["medium", "high", "critical"])', '2025-09-03 15:01:31.805371', true, false, 'origin', '["log.messageId","log.senderAddress"]', '[]');
INSERT INTO public.utm_correlation_rules VALUES (1250, 'vSphere API Abuse Detection', 3, 3, 2, 'Lateral Movement', 'T1210 - Exploitation of Remote Services', 'Detects potential vSphere API abuse including unauthorized access attempts, suspicious API calls, and exploitation attempts. Monitors for authentication failures, unusual vpxuser activity, and rapid API requests that could indicate compromise or abuse of VMware vSphere infrastructure.

Next Steps:
1. Investigate the source IP and hostname making the suspicious API calls
2. Review vCenter Server logs for additional context around the time of the alert
3. Check for any concurrent authentication events or privilege escalation attempts
4. Verify if the vpxuser account is being used inappropriately for shell access or commands
5. Examine network traffic patterns to identify potential automated attack tools
6. Review recent changes to vSphere permissions and user accounts
7. Check for any indicators of lateral movement or data exfiltration
8. Consider temporarily blocking the source IP if malicious activity is confirmed
', '["https://cloud.google.com/blog/topics/threat-intelligence/vmware-esxi-zero-day-bypass","https://attack.mitre.org/techniques/T1210/"]', '(safe("log.message", "").contains("authentication of user") &&
 (safe("log.message", "").contains("failed") ||
  safe("log.message", "").contains("denied"))) ||
(safe("log.message", "").contains("vpxuser") &&
 (safe("log.message", "").contains("shell") ||
  safe("log.message", "").contains("command"))) ||
(safe("log.process", "") == "vpxd" &&
 (safe("severity", "") == "error" ||
  safe("log.message", "").contains("unauthorized") ||
  safe("log.message", "").contains("permission denied"))) ||
(safe("log.message", "").contains("API") &&
 (safe("log.message", "").contains("abuse") ||
  safe("log.message", "").contains("flood") ||
  safe("log.message", "").contains("excessive")))
', '2025-09-04 19:00:53.957306', true, false, 'origin', '["origin.hostname","log.eventInfo"]', '[{"indexPattern":"v11-log-vmware-esxi-*","with":[{"field":"origin.hostname.keyword","operator":"filter_term","value":"{{.origin.hostname}}"},{"field":"log.message","operator":"filter_match","value":"authentication"}],"or":null,"within":"now-5m","count":5}]');
INSERT INTO public.utm_correlation_rules VALUES (374, 'Managed Threat Response Critical Alert', 3, 3, 3, 'Threat Detection', 'T1562 - Impair Defenses', 'Detects critical alerts from Sophos Managed Threat Response (MTR) service indicating active threats that require immediate investigation and response, including advanced persistent threats and sophisticated attack techniques.

Next Steps:
1. Review the MTR alert details in Sophos Central console
2. Examine the affected endpoint for signs of compromise
3. Check for lateral movement indicators on the network
4. Verify if the threat has been successfully contained
5. Update security policies based on threat intelligence from the alert
6. Document the incident and response actions taken
', '["https://docs.sophos.com/central/customer/help/en-us/ManageYourProducts/ThreatAnalysisCenter/index.html","https://attack.mitre.org/tactics/TA0005/"]', 'safe("log.type", "") in ["mtr_alert", "threat_detection"] &&
safe("log.severity", "") in ["critical", "high"] &&
safe("log.detection_type", "") in ["behavioral", "malware", "ransomware", "command_control"] &&
safe("log.confidence", 0) >= 80
', '2025-09-03 15:02:07.651787', true, false, 'origin', '["log.endpointId","log.threat_id"]', '[{"indexPattern":"v11-log-sophos-central-*","with":[{"field":"log.endpointId.keyword","operator":"filter_term","value":"{{.log.endpointId}}"},{"field":"log.severity.keyword","operator":"filter_term","value":"critical"}],"or":null,"within":"now-1h","count":3}]');
INSERT INTO public.utm_correlation_rules VALUES (375, 'Mobile Device Threats', 3, 3, 2, 'Initial Access', 'T1474 - Supply Chain Compromise', 'Detects security threats on mobile devices managed by Sophos Central, including malicious apps, jailbreak/root detection, and policy violations. This rule triggers on various mobile security events that indicate compromised device security or policy non-compliance.

Next Steps:
1. Immediately isolate the affected mobile device from network access
2. Review the specific threat type and severity reported by Sophos Central
3. Check device compliance status and recent app installations
4. Verify if the device has been jailbroken or rooted
5. Review user activity and access patterns on the device
6. Update mobile device policies if necessary
7. Consider remote wipe if device is compromised and contains sensitive data
8. Notify the device owner and IT security team
', '["https://docs.sophos.com/central/customer/help/en-us/ManageYourProducts/MobileControl/index.html","https://attack.mitre.org/techniques/T1474/"]', 'safe("log.endpointType", "") == "mobile" && (safe("log.type", "") in ["Event::Mobile::Threat::Detected", "Event::Mobile::Device::Jailbroken", "Event::Mobile::Device::Rooted", "Event::Mobile::App::Malicious", "Event::Mobile::Compliance::Failed"] || safe("log.threatType", "") != "")', '2025-09-03 15:02:08.246835', true, false, 'origin', '["log.endpointId","log.userId"]', '[]');
INSERT INTO public.utm_correlation_rules VALUES (376, 'Peripheral Control Security Event', 3, 3, 2, 'Collection', 'T1025 - Removable Media', 'Detects peripheral control events including blocked or monitored access to USB devices, optical drives, network devices, and other peripherals. This may indicate unauthorized device usage or potential data theft attempts.

Next Steps:
1. Review the specific peripheral device that triggered the alert
2. Verify if the device access was authorized by the user or organization policy
3. Check for any sensitive data that may have been accessed or transferred
4. Investigate the user''s recent activity for any other suspicious behavior
5. Consider updating device control policies if legitimate business use is identified
6. If malicious activity is suspected, isolate the endpoint and conduct forensic analysis
', '["https://docs.sophos.com/central/customer/help/en-us/ManageYourProducts/EndpointProtection/ConfigureDeviceControl/index.html","https://attack.mitre.org/techniques/T1025/"]', 'safe("log.type", "") == "Event::Endpoint::Peripheral::Blocked" || safe("log.category", "") == "Peripherals Controlled" || (safe("log.peripheralType", "") != "" && safe("log.action", "") == "blocked")', '2025-09-03 15:02:08.809401', true, false, 'origin', '["log.endpointId","log.peripheralType"]', '[]');
INSERT INTO public.utm_correlation_rules VALUES (377, 'Security Policy Compliance Failure', 3, 3, 2, 'Defense Evasion', 'T1562 - Impair Defenses', 'Detects security policy compliance failures indicating endpoints or users violating established security policies, which could expose the organization to risks or indicate attempts to bypass security controls. This rule identifies various types of policy violations including disabled threat protection, outdated definitions, unauthorized applications, and policy tampering attempts.

Next Steps:
1. Investigate the specific endpoint and policy violation details
2. Check if the violation was intentional (authorized change) or unauthorized
3. Review endpoint security status and update definitions if needed
4. Verify if the violation indicates a potential security incident or attack
5. Implement remediation actions to restore policy compliance
6. Monitor for additional violations from the same endpoint or user
7. Review and strengthen policy enforcement if necessary
', '["https://docs.sophos.com/central/customer/help/en-us/ManageYourProducts/EndpointProtection/ThreatProtectionPolicy/index.html","https://attack.mitre.org/techniques/T1562/"]', 'safe("log.type", "") in ["policy_violation", "compliance_check"] &&
safe("log.compliance_status", "") == "failed" &&
(safe("log.policy_type", "") in ["threat_protection", "device_control", "application_control", "web_control"] ||
 safe("log.violation_type", "") in ["disabled_protection", "outdated_definitions", "unauthorized_app", "policy_tampering"])
', '2025-09-03 15:02:09.348263', true, false, 'origin', '["log.endpointId","log.policy_type"]', '[{"indexPattern":"v11-log-sophos-central-*","with":[{"field":"log.endpointId.keyword","operator":"filter_term","value":"{{.log.endpointId}}"},{"field":"log.compliance_status.keyword","operator":"filter_term","value":"failed"}],"or":null,"within":"now-24h","count":5}]');
INSERT INTO public.utm_correlation_rules VALUES (378, 'Sophos Central Ransomware Detection', 3, 3, 3, 'Impact', 'T1486 - Data Encrypted for Impact', 'Detects ransomware activity including CryptoGuard alerts, master boot record attacks, and file system encryption attempts. This is a critical security event requiring immediate response.

Next Steps:
1. Immediately isolate the affected endpoint from the network
2. Identify the user account and processes involved in the ransomware activity
3. Check for lateral movement to other systems using the same user credentials
4. Verify backup integrity and availability for potential restoration
5. Analyze file system changes and encrypted file patterns
6. Review network connections for command and control communications
7. Search for ransomware notes or payment demands on the system
8. Coordinate with incident response team for containment and recovery
9. Monitor for similar patterns on other endpoints in the environment
10. Document all findings for forensic analysis and threat intelligence
', '["https://developer.sophos.com/siem-api-schemas","https://attack.mitre.org/techniques/T1486/"]', 'safe("log.type", "") == "Event::Endpoint::Threat::RansomwareDetected" ||
safe("log.type", "") == "Event::Endpoint::CryptoGuard::FileEncryption" ||
(safe("log.name", "") == "CryptoGuard" && safe("log.action", "") == "blocked") ||
(safe("log.description", "").contains("ransomware") || safe("log.description", "").contains("CryptoGuard") || safe("log.description", "").contains("master boot record")) ||
(safe("log.name", "") == "Ransomware detected" && safe("log.severity", "") == "critical") ||
(safe("log.type", "") == "Event::Endpoint::Threat::Detected" && safe("log.threatType", "") == "Ransomware")
', '2025-09-03 15:02:09.873934', true, false, 'origin', '["adversary.host"]', '[]');
INSERT INTO public.utm_correlation_rules VALUES (379, 'Server Protection Alerts', 3, 3, 2, 'Persistence', 'T1505 - Server Software Component', 'Detects critical security alerts on servers protected by Sophos Central, including unauthorized access attempts, service tampering, and malware targeting server infrastructure. This rule monitors for high-severity threats specifically targeting server endpoints.

Next Steps:
1. Immediately isolate the affected server from the network if threat is confirmed active
2. Review the specific threat details in Sophos Central console to understand the attack vector
3. Check server logs for unauthorized access attempts or privilege escalation activities
4. Verify integrity of critical server services and configurations
5. Scan for additional indicators of compromise on the server and connected systems
6. Review recent server changes, updates, or new software installations
7. Check for lateral movement attempts from the compromised server
8. Implement additional monitoring for the affected server endpoint
9. Update security policies and access controls based on findings
10. Document the incident and update security procedures if necessary
', '["https://docs.sophos.com/central/customer/help/en-us/ManageYourProducts/Servers/index.html","https://attack.mitre.org/techniques/T1505/"]', '(safe("log.endpointType", "") == "server" && safe("log.severity", "") in ["high", "critical"]) || safe("log.type", "") in ["Event::Server::Threat::Detected", "Event::Server::Protection::Disabled", "Event::Server::Exploit::Prevented"]', '2025-09-03 15:02:10.409609', true, false, 'origin', '["log.endpointId","log.type"]', '[]');
INSERT INTO public.utm_correlation_rules VALUES (380, 'Synchronized Security Heartbeat Failures', 2, 3, 3, 'Defense Evasion', 'T1562.001 - Impair Defenses: Disable or Modify Tools', 'Detects when Sophos synchronized security heartbeat fails, indicating potential endpoint protection issues or communication problems between Sophos components. Heartbeat failures can indicate compromised endpoints, network connectivity issues, or attempts to disable security controls.

Next Steps:
1. Check the endpoint status in Sophos Central console
2. Verify network connectivity between the endpoint and Sophos Central
3. Review endpoint logs for signs of tampering or malware interference
4. Validate that Sophos services are running properly on the affected endpoint
5. Check for any recent policy changes or system updates that might affect heartbeat
6. If multiple endpoints are affected, investigate network infrastructure issues
', '["https://docs.sophos.com/central/customer/help/en-us/ManageYourProducts/Heartbeat/index.html","https://attack.mitre.org/techniques/T1562/001/"]', 'safe("log.type", "") == "Event::Endpoint::SyncSecurity::HeartbeatFailure" || (safe("log.name", "") == "Heartbeat failure" && safe("log.severity", "") in ["high", "critical"])', '2025-09-03 15:02:11.04756', true, false, 'origin', '["log.endpointId"]', '[{"indexPattern":"v11-log-sophos-central-*","with":[{"field":"log.endpointId.keyword","operator":"filter_term","value":"{{.log.endpointId}}"}],"or":null,"within":"now-1h","count":3}]');
INSERT INTO public.utm_correlation_rules VALUES (386, 'Probable Sophos denial of service (DoS) attack', 3, 3, 3, 'Impact', 'Denial of Service (DoS)', 'A Denial of Service (DoS) attack is an attempt to make a machine or network resource unavailable to the intended users. One common method of attack involves saturating the target machine with external communications requests so that it cannot respond to legitimate traffic or the machine responds so slowly that it is essentially useless.', '["https://support.sophos.com/support/s/article/KB-000035754?language=en_US","https://docs.sophos.com/nsg/sophos-firewall/18.5/PDF/SF%20syslog%20guide%2018.5.pdf","https://attack.mitre.org/tactics/TA0040","https://attack.mitre.org/techniques/T1499/"]', 'safe("log.component", "").matches("(D|d)o(S|s) (a|A)ttacks") && safe("log.subType", "").matches("^(D|d)o(S|s)$")', '2025-09-03 15:05:36.529391', true, false, 'origin', NULL, '[]');
INSERT INTO public.utm_correlation_rules VALUES (387, 'Probable malware detected by sophos firewall', 3, 3, 3, 'Malware', 'Phishing', 'The Sophos firewall has detected a suspicious event and made some actions according to his configuration', '["https://www.mcafee.com/en-us/antivirus/malware.html","https://www.fortinet.com/resources/cyberglossary/computer-virus"]', 'safe("log.subType", "").matches("^((V|v)irus|PUA)$")', '2025-09-03 15:05:36.999003', true, false, 'origin', NULL, '[]');
INSERT INTO public.utm_correlation_rules VALUES (388, 'High severity Sophos firewall traffic denegations', 3, 3, 3, 'Firewall Alerts', 'General', 'The Sophos firewall device has detected a high severity event asociated with traffic denegations. For the alert purpose high severity is when log priority is: Emergency, Critical or Alert. Please see the logs attached to this alert for additional details.', '["https://docs.sophos.com/central/Customer/help/en-us/central/Customer/concepts/FirewallAlerts.html","https://docs.sophos.com/nsg/sophos-firewall/17.5/Help/en-us/webhelp/onlinehelp/nsg/concepts/LogIDStructure.html","https://docs.sophos.com/nsg/sophos-firewall/17.5/Help/en-us/webhelp/onlinehelp/nsg/sfos/concepts/LogMessages.html","https://docs.sophos.com/nsg/sophos-firewall/18.5/PDF/SF%20syslog%20guide%2018.5.pdf","https://attack.mitre.org/"]', 'safe("log.component", "").matches("(F|f)irewall (R|r)ule") && safe("log.subType", "") in [''Deny'', ''deny'', ''Drop'', ''drop'', ''Denied'', ''denied'', ''Dropped'', ''dropped''] && safe("log.priority", "") in [''Emergency'', ''Critical'', ''Alert'']', '2025-09-03 15:05:37.567253', true, false, 'origin', NULL, '[]');
INSERT INTO public.utm_correlation_rules VALUES (389, 'Probable Sophos FTP-bounce attack', 3, 3, 3, 'Exfiltration', 'FTP-bounce attack', 'Sophos firewall has detected a probable FTP-bounce attack. FTP bounce attack is an exploit of the FTP protocol whereby an attacker  is able to use the PORT command to request access to ports indirectly through the use of the victim machine, which serves as  a proxy for the request, similar to an Open mail relay using SMTP. This technique can be used to port scan hosts discreetly, and to potentially bypass a network Access-control list to access  specific ports that the attacker cannot access through a direct connection, for example with the nmap port scanner. Please see the logs attached to this alert for additional details.', '["https://docs.sophos.com/nsg/sophos-firewall/18.5/Help/en-us/webhelp/onlinehelp/CommandLineHelp/DeviceConsole/Set/index.html#advanced-firewall","https://attack.mitre.org/tactics/TA0010/","https://attack.mitre.org/techniques/T1048/","http://www.cert.org/tech_tips/ftp_port_attacks.html"]', 'safe("log.Id", "").endsWith(''010202130'')', '2025-09-03 15:05:38.073649', true, false, 'origin', NULL, '[]');
INSERT INTO public.utm_correlation_rules VALUES (1494, 'Windows: Suspicious PrintSpooler Service Executable File Creation', 2, 3, 1, 'Privilege Escalation', 'Exploitation for Privilege Escalation', 'Detects attempts to exploit privilege escalation vulnerabilities related to the Print Spooler service. For more information refer to the following CVE''s - CVE-2020-1048, CVE-2020-1337 and CVE-2020-1300 and verify that the impacted system is patched', '["https://attack.mitre.org/tactics/TA0004/","https://attack.mitre.org/techniques/T1068/"]', '!safe("log.file.path", "").matches("(\\Windows\\System32\\spool\\|:\\Windows\\Temp\\|:\\Users\\)") && safe("log.winlogEventDataProcessName", "").contains("spoolsv.exe")
', '2025-09-04 21:16:05.635994', true, false, 'origin', NULL, '[]');
INSERT INTO public.utm_correlation_rules VALUES (390, 'Sophos detected high priority alerts', 3, 3, 3, 'Device Alerts', 'Phishing', 'The Sophos firewall device has detected a high priority event. For the alert purpose, high priority is when log priority is: Emergency, Critical or Alert, and not part of the list of risked applications. Please see the logs attached to this alert for additional details.', '["https://docs.sophos.com/nsg/sophos-firewall/17.5/Help/en-us/webhelp/onlinehelp/nsg/concepts/LogIDStructure.html","https://docs.sophos.com/nsg/sophos-firewall/17.5/Help/en-us/webhelp/onlinehelp/nsg/sfos/concepts/LogMessages.html"]', 'safe("log.priority", "") in [''Emergency'', ''Critical'', ''Alert''] && (!safe("log.application", "").matches("(Torrent|Proxy|EXE File Download|eMule P2P|Ares P2P|Avast Antivirus|NetFlix|McAfee Antivirus|AVG Antivirus|ISAKMP VPN|WeTransfer Base|Xbox LIVE|OSC_AMU)") || !safe("log.applicationName", "").matches("(Torrent|Proxy|EXE File Download|eMule P2P|Ares P2P|Avast Antivirus|NetFlix|McAfee Antivirus|AVG Antivirus|ISAKMP VPN|WeTransfer Base|Xbox LIVE|OSC_AMU)") || safe("log.application", "") != "" || safe("log.applicationName", "") != "")', '2025-09-03 15:05:38.549579', true, false, 'origin', NULL, '[]');
INSERT INTO public.utm_correlation_rules VALUES (383, 'Sophos Central Update Failure Detected', 1, 3, 3, 'Discovery', 'T1007 - Discovery: System Service Discovery', 'Detects when Sophos Central endpoints fail to update, which could indicate connectivity issues, compromised endpoints, or attempts to prevent security updates from being applied. Update failures can leave systems vulnerable to threats and may indicate malicious interference with security mechanisms.

Next Steps:
1. Verify endpoint connectivity and network configuration
2. Check for signs of malware or system compromise on affected endpoints  
3. Review endpoint logs for error details and root cause analysis
4. Ensure Sophos Central console shows accurate endpoint status
5. Investigate if update failures correlate with other security events
6. Consider manual update deployment if automated updates continue failing
', '["https://developer.sophos.com/apis","https://attack.mitre.org/techniques/T1007/"]', 'safe("log.type", "") in ["Event::Endpoint::UpdateFailure", "updatefailure", "update_failure"] ||
safe("log.name", "") == "Event::Endpoint::UpdateFailure" ||
safe("log.event", "").matches("(?i)(update.*fail|fail.*update)") ||
(safe("log.severity", "") in ["high", "critical"] && safe("log.message", "").matches("(?i)update"))
', '2025-09-03 15:02:42.828638', true, false, 'origin', '["target.host"]', '[{"indexPattern":"v11-log-sophos-central-*","with":[{"field":"log.endpointId.keyword","operator":"filter_term","value":"{{.log.endpointId}}"}],"or":null,"within":"now-24h","count":3}]');
INSERT INTO public.utm_correlation_rules VALUES (384, 'Web Protection Violation Detected', 3, 2, 1, 'Command and Control', 'T1071 - Application Layer Protocol', 'Detects when Sophos Central blocks access to websites that violate web protection policies. This could indicate attempted access to malicious, inappropriate, or policy-violating websites, potentially indicating command and control communication attempts or policy violations.

Next Steps:
1. Review the blocked URL and categorization to understand the nature of the violation
2. Investigate the user''s browsing history for additional suspicious activity
3. Check if the blocked site is part of known malicious infrastructure
4. Verify if this represents legitimate business access that requires policy adjustment
5. Correlate with other security events from the same endpoint or user
6. Consider additional endpoint investigation if malicious intent is suspected
', '["https://docs.sophos.com/central/customer/help/en-us/ManageYourProducts/EndpointProtection/webcontrol/index.html","https://attack.mitre.org/techniques/T1071/"]', 'safe("log.type", "") == "Event::Endpoint::WebControlViolation" || safe("log.type", "") == "Event::Endpoint::WebFilteringBlocked"', '2025-09-03 15:02:43.568581', true, false, 'origin', '["log.endpointId","log.userId"]', '[]');
INSERT INTO public.utm_correlation_rules VALUES (385, 'Zero Trust Network Access Policy Violation', 3, 2, 1, 'Defense Evasion, Persistence, Privilege Escalation, Initial Access', 'T1078 - Valid Accounts', 'Detects Zero Trust Network Access (ZTNA) policy violations where users or devices attempt to access resources they are not authorized for, potentially indicating compromised credentials or lateral movement attempts.

Next Steps:
1. Review the specific policy that was violated and the resource being accessed
2. Investigate the user account and device involved in the violation
3. Check for any recent changes to user permissions or device health status
4. Verify device compliance status and security posture
5. Look for patterns of similar violations across multiple users or devices
6. Consider implementing additional access controls or device health checks
7. Review authentication logs for signs of credential compromise
', '["https://www.sophos.com/en-us/products/zero-trust-network-access","https://attack.mitre.org/techniques/T1078/"]', 'safe("log.type", "") == "ztna" &&
safe("log.action", "") in ["blocked", "denied"] &&
safe("log.endpointType", "") != "" &&
(safe("log.reason", "").contains("policy") || safe("log.reason", "").contains("health_check_failed"))
', '2025-09-03 15:02:44.108112', true, false, 'origin', '["origin.user","origin.host"]', '[]');
INSERT INTO public.utm_correlation_rules VALUES (1251, 'ADFS Authentication Anomalies', 3, 2, 2, 'Defense Evasion, Persistence, Privilege Escalation, Initial Access', 'T1078 - Valid Accounts', 'Detects anomalous authentication attempts against Active Directory Federation Services (ADFS) including multiple failed attempts that could indicate password spraying or brute force attacks. This rule monitors for authentication failures, token validation failures, and other ADFS security events that may indicate malicious activity.

The rule triggers when:
1. Initial ADFS authentication failure is detected (events 411, 342, 516)
2. The same source IP has 5+ additional authentication failures within 15 minutes
3. The additional failures target different usernames (indicating password spraying)

Next Steps:
1. Review the source IP address and determine if it''s from a known/trusted location
2. Check for patterns of failed authentication attempts across multiple users
3. Examine ADFS audit logs for additional context around the authentication failures
4. Verify if the targeted user accounts are valid and active
5. Consider implementing IP-based blocking if malicious activity is confirmed
6. Review ADFS configuration for security hardening opportunities
7. Correlate with other authentication events across the domain
', '["https://learn.microsoft.com/en-us/windows-server/identity/ad-fs/troubleshooting/ad-fs-tshoot-logging","https://attack.mitre.org/techniques/T1078/"]', 'safe("log.winlogProviderName", "") == "AD FS" && (safe("log.eventCode", 0.0) == double(411) || safe("log.eventCode", 0.0) == double(342) || safe("log.eventCode", 0.0) == double(516)) && safe("log.message", "").contains("token validation failed")', '2025-09-04 19:28:20.045571', true, false, 'origin', '["origin.ip","target.user"]', '[{"indexPattern":"v11-log-wineventlog-*","with":[{"field":"log.winlogProviderName.keyword","operator":"filter_term","value":"AD FS"},{"field":"log.winlogEventDataIpAddress.keyword","operator":"filter_term","value":"{{.log.winlogEventDataIpAddress}}"},{"field":"log.eventCode","operator":"filter_term","value":411},{"field":"log.eventCode","operator":"filter_term","value":342},{"field":"log.eventCode","operator":"filter_term","value":516},{"field":"target.user.keyword","operator":"must_not_term","value":"{{.log.winlogEventDataTargetUserName}}"}],"or":null,"within":"now-15m","count":5}]');
INSERT INTO public.utm_correlation_rules VALUES (1341, 'Windows: Microsoft Build Engine Started an Unusual Process', 3, 3, 2, 'Defense Evasion', 'Obfuscated Files or Information', 'An instance of MSBuild, the Microsoft Build Engine, started a PowerShell script or the Visual C# Command Line Compiler. This technique is sometimes used to deploy a malicious payload using the Build Engine.', '["https://attack.mitre.org/tactics/TA0005/","https://attack.mitre.org/techniques/T1027/"]', 'safe("log.winlogEventDataProcessName", "").matches("(csc.exe|iexplore.exe|powershell.exe)") && safe("log.winlogEventDataParentProcessName", "").matches("MSBuild.exe")', '2025-09-04 20:24:31.994193', true, false, 'origin', NULL, '[]');
INSERT INTO public.utm_correlation_rules VALUES (1466, 'Windows Defender: ERROR: FULL SCAN REQUIRED', 1, 2, 3, 'Potentially Compromised System', 'User Execution', 'Detects the ''FULL SCAN REQUIRED'' error event in Windows Defender, which may indicate that a full system scan is necessary to ensure protection.', '["https://learn.microsoft.com/en-us/windows/security/threat-protection/windows-defender-antivirus/troubleshoot"]', 'safe("log.winlogEventDataLogName", "") == "Microsoft-Windows-Windows Defender/Operational" &&  safe("log.winlogEventDataErrorCode", "") == "0x80508024"', '2025-09-04 21:11:29.378474', true, false, 'target', NULL, '[]');
INSERT INTO public.utm_correlation_rules VALUES (397, 'Probable use of Medium-risk unknown applications', 1, 2, 2, 'Lateral Movement', 'Application Layer Protocol', 'The Sophos firewall device has detected a use of medium risked applications but not in the list of known ones. Please see the logs attached to this alert for additional details.', '["https://attack.mitre.org/tactics/TA0008/"]', '!(safe("log.subType", "") in ["Deny", "deny", "Drop", "drop", "Denied", "denied", "Dropped", "dropped"]) && safe("log.applicationRisk", "") >= "4" &&
!(safe("log.application", "").matches("(Torrent|Proxy|EXE File Download|eMule P2P|Ares P2P|Avast Antivirus|NetFlix|McAfee Antivirus|AVG Antivirus|ISAKMP VPN|WeTransfer Base|Xbox LIVE|OSC_AMU)")) ||
!(safe("log.applicationName", "").matches("(Torrent|Proxy|EXE File Download|eMule P2P|Ares P2P|Avast Antivirus|NetFlix|McAfee Antivirus|AVG Antivirus|ISAKMP VPN|WeTransfer Base|Xbox LIVE|OSC_AMU)")) ||
safe("log.applicationName", "") != ""
', '2025-09-03 15:06:07.254933', true, false, 'origin', NULL, '[]');
INSERT INTO public.utm_correlation_rules VALUES (398, 'Probable Sophos TCP land attack', 3, 3, 2, 'Impact', 'TCP land attack', 'Sophos firewall has detected a probable TCP land attack. A LAND Attack is a Layer 4 Denial of Service (DoS) attack in which,  the attacker sets the source and destination information of a TCP segment to be the same. A vulnerable machine will  crash or freeze due to the packet being repeatedly processed by the TCP stack.  Please see the logs attached to this alert for additional details.', '["https://attack.mitre.org/tactics/TA0040","https://attack.mitre.org/techniques/T1499/","https://support.sophos.com/support/s/article/KB-000035754?language=en_US","https://www.imperva.com/learn/ddos/land-attacks/"]', 'safe("log.logId", "").endWiths("010202126")', '2025-09-03 15:06:07.746112', true, false, 'origin', NULL, '[]');
INSERT INTO public.utm_correlation_rules VALUES (399, 'Probable Sophos TCP WinNuke attack', 3, 3, 2, 'Impact', 'TCP WinNuke attack', 'Sophos firewall has detected a probable TCP WinNuke attack. Please see the logs attached to this alert for additional details.', '["https://docs.sophos.com/central/Enterprise/help/en-us/central/common/concepts/ConfigureMalwareProtection.html","https://support.sophos.com/support/s/article/KB-000033966?language=en_US","https://kb.juniper.net/InfoCenter/index?page=content&id=KB5444","https://attack.mitre.org/tactics/TA0040","https://attack.mitre.org/techniques/T1499/"]', 'safe("log.logId", "").endWiths("010202128")', '2025-09-03 15:06:08.315452', true, false, 'origin', NULL, '[]');
INSERT INTO public.utm_correlation_rules VALUES (400, 'GCP probable Defense Evasion, Storage Bucket Permissions Modification', 1, 2, 3, 'Defense Evasion', 'Impair Defenses', 'Defense Evasion consists of techniques that adversaries use to avoid detection throughout their compromise.  Techniques used for defense evasion include uninstalling/disabling security software or  obfuscating/encrypting data and scripts. Adversaries also leverage and abuse trusted processes  to hide and masquerade their malware. Other tactics are cross-listed here when those techniques  include the added benefit of subverting defenses. <br>  Identifies when the Identity and Access Management (IAM) permissions are modified for a Google Cloud Platform (GCP)  storage bucket. An adversary may modify the permissions on a storage bucket to weaken their target''s security controls  or an administrator may inadvertently modify the permissions, which could lead to data exposure or loss.', '["https://cloud.google.com/storage/docs/access-control/iam-permissions","https://attack.mitre.org/techniques/T1562/","https://attack.mitre.org/tactics/TA0005/"]', 'safe("log.protoPayload.methodName ", "").matches("((.+)?storage\\.setIamPermissions)")', '2025-09-03 15:06:08.586161', true, false, 'origin', NULL, '[]');
INSERT INTO public.utm_correlation_rules VALUES (401, 'GCP probable Exfiltration, Logging Sink Modification', 3, 2, 2, 'Exfiltration', 'Transfer Data to Cloud Account', 'Exfiltration consists of techniques that adversaries may use to steal data from your network. Once they''ve collected data,  adversaries often package it to avoid detection while removing it. This can include compression and encryption. Techniques for  getting data out of a target network typically include transferring it over their command and control channel or an alternate  channel and may also include putting size limits on the transmission. <br>  Identifies a modification to a Logging sink in Google Cloud Platform (GCP). Logging compares the log entry to the sinks  in that resource. Each sink whose filter matches the log entry writes a copy of the log entry to the sink''s export  destination. An adversary may update a Logging sink to exfiltrate logs to a different export destination.', '["https://cloud.google.com/logging/docs/export#how_sinks_work","https://cloud.google.com/logging/docs/reference/v2/rest/v2/projects.sinks#LogSink","https://attack.mitre.org/techniques/T1537/","https://attack.mitre.org/tactics/TA0010/"]', 'safe("log.protoPayload.methodName ", "").matches("((.+)?sink(s)?\\.update|(.+)?v(\\w+)\\.ConfigServiceV(\\w+)\\.UpdateSink)")', '2025-09-03 15:06:09.024673', true, false, 'origin', NULL, '[]');
INSERT INTO public.utm_correlation_rules VALUES (402, 'GCP probable Government-backed attack', 3, 3, 2, 'Collection', 'Archive Collected Data', 'A user''s account might have been targeted by government-backed attack.  Government-backed attackers are trying to access the account of one of your users.  An attack happens to less than 0.1% of all Google Account users. There''s a chance the alert is  a false alarm. However, we believe we detected activities that government-backed attackers use  to try to steal a password or other personal information. Such activity includes the user receiving  an email containing a harmful attachment, links to malicious software downloads, or links to fake  websites that are designed to access passwords.', '["https://attack.mitre.org/tactics/TA0009/","https://attack.mitre.org/techniques/T1560"]', 'safe("log.protoPayload.methodName ", "").contains("google.login.LoginService.govAttackWarning")', '2025-09-03 15:06:09.461968', true, false, 'origin', NULL, '[]');
INSERT INTO public.utm_correlation_rules VALUES (403, 'GCP probable Impact, IAM Role Deletion', 1, 2, 3, 'Impact', 'Account Access Removal', 'Impact consists of techniques that adversaries use to disrupt availability or compromise integrity by manipulating business  and operational processes. Techniques used for impact can include destroying or tampering with data. In some cases, business  processes can look fine, but may have been altered to benefit the adversaries goals. These techniques might be used by  adversaries to follow through on their end goal or to provide cover for a confidentiality breach. <br>  Identifies an Identity and Access Management (IAM) role deletion in Google Cloud Platform (GCP). A role contains a set  of permissions that allows you to perform specific actions on Google Cloud resources. An adversary may delete an IAM  role to inhibit access to accounts utilized by legitimate users.', '["https://cloud.google.com/iam/docs/understanding-roles","https://attack.mitre.org/tactics/TA0040/","https://attack.mitre.org/techniques/T1531/"]', 'safe("log.protoPayload.methodName ", "").matches("(((.+)\\.)?role(s)?.delete|(.+)?iam\\.admin\\.v(\\w+)\\.DeleteRole)")', '2025-09-03 15:06:09.934906', true, false, 'origin', NULL, '[]');
INSERT INTO public.utm_correlation_rules VALUES (1342, 'Windows: Process Activity via Compiled HTML File', 3, 3, 1, 'Execution', 'Malicious File', 'Compiled HTML files (.chm) are commonly distributed as part of the Microsoft HTML Help system. Adversaries may conceal malicious code in a CHM file and deliver it to a victim for execution. CHM content is loaded by the HTML Help executable program (hh.exe).', '["https://attack.mitre.org/tactics/TA0002/","https://attack.mitre.org/techniques/T1204/002/"]', 'safe("log.winlogEventDataProcessName", "").matches("(mshta.exe|cmd.exe|powershell.exe|pwsh.exe|powershell_ise.exe|cscript.exe|wscript.exe)") && safe("log.winlogEventDataParentProcessName", "").matches("hh.exe")', '2025-09-04 20:24:32.591976', true, false, 'origin', NULL, '[]');
INSERT INTO public.utm_correlation_rules VALUES (404, 'GCP probable Impact, Service Account Deletion', 1, 2, 3, 'Impact', 'Account Access Removal', 'Impact consists of techniques that adversaries use to disrupt availability or compromise integrity by manipulating business  and operational processes. Techniques used for impact can include destroying or tampering with data. In some cases, business  processes can look fine, but may have been altered to benefit the adversaries goals. These techniques might be used by  adversaries to follow through on their end goal or to provide cover for a confidentiality breach. <br>  Identifies when a service account is deleted in Google Cloud Platform (GCP). A service account is a special type of  account used by an application or a virtual machine (VM) instance, not a person. Applications use service accounts to  make authorized API calls, authorized as either the service account itself, or as G Suite or Cloud Identity users  through domain-wide delegation. An adversary may delete a service account in order to disrupt their target''s business  operations.', '["https://cloud.google.com/iam/docs/service-accounts","https://attack.mitre.org/tactics/TA0040/","https://attack.mitre.org/techniques/T1531/"]', 'safe("log.protoPayload.methodName ", "").matches("(((.+)\\.)?serviceAccount(s)?.delete|(.+)?iam\\.admin\\.v(\\w+)\\.DeleteServiceAccount)")', '2025-09-03 15:06:10.541723', true, false, 'origin', NULL, '[]');
INSERT INTO public.utm_correlation_rules VALUES (405, 'GCP probable Impact, Service Account Disabled', 1, 2, 3, 'Impact', 'Account Access Removal', 'Impact consists of techniques that adversaries use to disrupt availability or compromise integrity by manipulating business  and operational processes. Techniques used for impact can include destroying or tampering with data. In some cases, business  processes can look fine, but may have been altered to benefit the adversaries goals. These techniques might be used by  adversaries to follow through on their end goal or to provide cover for a confidentiality breach. <br>  Identifies when a service account is disabled in Google Cloud Platform (GCP). A service account is a special type of  account used by an application or a virtual machine (VM) instance, not a person. Applications use service accounts to  make authorized API calls, authorized as either the service account itself, or as G Suite or Cloud Identity users  through domain-wide delegation. An adversary may disable a service account in order to disrupt to disrupt their target''s  business operations.', '["https://cloud.google.com/iam/docs/service-accounts","https://attack.mitre.org/tactics/TA0040/","https://attack.mitre.org/techniques/T1531/"]', 'safe("log.protopayload.methodName", "").matches("(((.+)\\.)?serviceAccount(s)?.disable|(.+)?iam\\.admin\\.v(\\w+)\\.DisableServiceAccount)")', '2025-09-03 15:06:11.010503', true, false, 'origin', NULL, '[]');
INSERT INTO public.utm_correlation_rules VALUES (406, 'GCP probable Impact, Storage Bucket Deleted', 1, 2, 3, 'Impact', 'Data Destruction', 'Impact consists of techniques that adversaries use to disrupt availability or compromise integrity by manipulating business  and operational processes. Techniques used for impact can include destroying or tampering with data. In some cases, business  processes can look fine, but may have been altered to benefit the adversaries goals. These techniques might be used by  adversaries to follow through on their end goal or to provide cover for a confidentiality breach. <br>  Identifies when a Google Cloud Platform (GCP) storage bucket is deleted. An adversary may delete a storage bucket in  order to disrupt their target''s business operations.', '["https://cloud.google.com/logging/docs/buckets","https://attack.mitre.org/tactics/TA0040/","https://attack.mitre.org/techniques/T1485/"]', 'safe("log.protopayload.methodName", "").matches("(.+)\\.bucket(s)?\\.delete")', '2025-09-03 15:06:11.455152', true, false, 'origin', NULL, '[]');
INSERT INTO public.utm_correlation_rules VALUES (426, 'Fortinet Antivirus Malware Outbreak Detection', 3, 3, 2, 'Initial Access', 'T1566 - Phishing', 'Detects potential malware outbreak when multiple antivirus detections occur from the same source or targeting multiple destinations in a short time period. This could indicate a widespread infection attempt or a compromised system attempting to spread malware.

Next Steps:
1. Identify the specific malware detected by reviewing the virus field in the alert details
2. Isolate the affected source IP addresses to prevent further spread
3. Check if the blocked malware attempts indicate successful infections on any endpoints
4. Review antivirus logs for the specific virus signature to understand the threat
5. Scan all systems that communicated with the identified source IPs
6. Update antivirus signatures and ensure all endpoints are protected
7. Consider blocking the source IP at the perimeter if it''s external
8. Document all affected systems and remediation actions taken
', '["https://docs.fortinet.com/document/fortigate/7.4.1/administration-guide/198726/antivirus","https://attack.mitre.org/techniques/T1566/"]', 'safe("log.type", "") == "utm" && safe("log.subtype", "") == "virus" && safe("action", "") == "blocked" && (safe("origin.ip", "") != "" || safe("target.ip", "") != "")', '2025-09-03 15:12:04.449089', true, false, 'origin', NULL, '[]');
INSERT INTO public.utm_correlation_rules VALUES (414, 'Sophos XG Lateral Movement Detection', 3, 3, 2, 'Lateral Movement', 'T1021 - Remote Services', 'Detects potential lateral movement activities within the network, including unusual internal connections, multiple service access attempts, and suspicious east-west traffic patterns. This rule identifies connections to common remote access services (SMB, RDP, SSH, Telnet, WinRM) between internal hosts that may indicate an attacker moving laterally through the network.

Next Steps:
1. Verify the legitimacy of the connection between the source and destination hosts
2. Check if the source IP has recently shown signs of compromise
3. Analyze the user account associated with the connection
4. Review authentication logs for unusual login patterns
5. Examine network traffic patterns for data exfiltration indicators
6. Check for concurrent connections to multiple internal hosts from the same source
7. Validate if the accessed services are normally used by the source host
', '["https://docs.sophos.com/nsg/sophos-firewall/20.0/Help/en-us/webhelp/onlinehelp/AdministratorHelp/Logs/index.html","https://attack.mitre.org/techniques/T1021/"]', '((safe("log.srcCountryCode", "") == safe("log.dstCountryCode", "") && safe("log.srcCountryCode", "") == "R1") || (safe("origin.ip", "").contains("10.") || safe("origin.ip", "").contains("172.") || safe("origin.ip", "").contains("192.168.")) && (safe("target.ip", "").contains("10.") || safe("target.ip", "").contains("172.") || safe("target.ip", "").contains("192.168."))) && (safe("target.port", 0) in [445, 139, 3389, 22, 23, 5985, 5986] || safe("log.applicationCategory", "") in ["Remote Access", "Network Protocol"])', '2025-09-03 15:06:40.528687', true, false, 'origin', '["origin.ip","target.ip"]', '[{"indexPattern":"v11-log-firewall-sophos-xg-*","with":[{"field":"origin.ip.keyword","operator":"filter_term","value":"{{.origin.ip}}"}],"or":null,"within":"now-10m","count":20}]');
INSERT INTO public.utm_correlation_rules VALUES (415, 'Sophos XG Firewall RED Tunnel Failures', 1, 1, 3, 'Impact', 'VPN Disruption', 'Detects RED (Remote Ethernet Device) tunnel establishment failures or disconnections which could indicate network issues, configuration problems, or potential attacks on remote connectivity.

Next Steps:
1. Verify the physical connectivity of the RED device to the network
2. Check the RED device configuration in the Sophos XG firewall management interface
3. Review network connectivity between the RED device and the firewall
4. Examine firewall logs for any authentication failures or certificate issues
5. Check for any recent configuration changes that might affect RED connectivity
6. Monitor for patterns of repeated failures that could indicate a DoS attack
7. Verify that the RED device has proper power and is functioning correctly
8. Review bandwidth utilization to ensure adequate resources for tunnel establishment
', '["https://docs.sophos.com/nsg/sophos-firewall/20.0/Help/en-us/webhelp/onlinehelp/AdministratorHelp/SitetoSiteVPN/RED/index.html","https://attack.mitre.org/techniques/T1499/"]', 'safe("log.type", "") == "Event" &&
safe("log.component", "") in ["RED", "VPN"] &&
safe("log.subType", "") == "System" &&
(safe("log.logMessage", "").contains("tunnel") &&
 (safe("log.logMessage", "").contains("fail") ||
  safe("log.logMessage", "").contains("down") ||
  safe("log.logMessage", "").contains("disconnect") ||
  safe("log.logMessage", "").contains("error")))
', '2025-09-03 15:06:41.073832', true, false, 'origin', '["log.deviceName","log.component"]', '[]');
INSERT INTO public.utm_correlation_rules VALUES (407, 'GCP probable Impact, Virtual Private Cloud Network Deletion', 1, 2, 3, 'Impact', 'Stop Service', 'Impact consists of techniques that adversaries use to disrupt availability or compromise integrity by manipulating business  and operational processes. Techniques used for impact can include destroying or tampering with data. In some cases, business  processes can look fine, but may have been altered to benefit the adversaries goals. These techniques might be used by  adversaries to follow through on their end goal or to provide cover for a confidentiality breach. <br>  Identifies when a Virtual Private Cloud (VPC) network is deleted in Google Cloud Platform (GCP). A VPC network is a  virtual version of a physical network within a GCP project. Each VPC network has its own subnets, routes, and firewall,  as well as other elements. An adversary may delete a VPC network in order to disrupt their target''s network and business  operations.', '["https://cloud.google.com/vpc/docs/vpc","https://attack.mitre.org/tactics/TA0040/","https://attack.mitre.org/techniques/T1489"]', 'safe("log.protopayload.methodName", "").matches("(^(.+)\\.(sub)?network(s)?\\.delete$|^(sub)?network(s)?\\.delete$)")', '2025-09-03 15:06:11.916424', true, false, 'origin', NULL, '[]');
INSERT INTO public.utm_correlation_rules VALUES (408, 'GCP probable Impact, Virtual Private Cloud Route Creation', 1, 2, 3, 'Impact', 'Data Destruction', 'Impact consists of techniques that adversaries use to disrupt availability or compromise integrity by manipulating business  and operational processes. Techniques used for impact can include destroying or tampering with data. In some cases, business  processes can look fine, but may have been altered to benefit the adversaries goals. These techniques might be used by  adversaries to follow through on their end goal or to provide cover for a confidentiality breach. <br>  Identifies when a virtual private cloud (VPC) route is created in Google Cloud Platform (GCP). Google Cloud routes  define the paths that network traffic takes from a virtual machine (VM) instance to other destinations. These  destinations can be inside a Google VPC network or outside it. An adversary may create a route in order to impact the  flow of network traffic in their target''s cloud environment.', '["https://cloud.google.com/vpc/docs/routes","https://attack.mitre.org/tactics/TA0040/"]', 'safe("log.protopayload.methodName", "").matches("^((.+)\\.)?route(s)?\\.insert$")', '2025-09-03 15:06:12.340215', true, false, 'origin', NULL, '[]');
INSERT INTO public.utm_correlation_rules VALUES (511, 'ModSecurity Rule Violations Detected', 2, 3, 2, 'Execution', 'T1203 - Exploitation for Client Execution', 'Detects when ModSecurity Web Application Firewall rules are triggered, indicating potential web application attacks or policy violations. This could include SQL injection, XSS, path traversal, or other OWASP Top 10 attack attempts.

Next Steps:
1. Review the specific ModSecurity rule that was triggered and the request details
2. Analyze the blocked request for malicious patterns or payloads
3. Check if this is part of a coordinated attack by reviewing other requests from the same IP
4. Verify that ModSecurity rules are properly tuned to minimize false positives
5. Consider blocking the source IP if confirmed malicious activity
', '["https://www.feistyduck.com/library/modsecurity-handbook-free/online/ch04-logging.html","https://attack.mitre.org/techniques/T1203/"]', 'safe("log.message", "") != "" && 
(safe("log.message", "").contains("ModSecurity: Warning") || 
 safe("log.message", "").contains("ModSecurity: Access denied") ||
 safe("log.message", "").contains("[id \"") ||
 (safe("log.statusCode", 0.0) == double(403) && safe("log.message", "").contains("mod_security")))
', '2025-09-03 15:23:57.627099', true, false, 'origin', NULL, '[]');
INSERT INTO public.utm_correlation_rules VALUES (410, 'Sophos XG Advanced Threat Protection Alert', 3, 3, 2, 'Execution', 'T1204 - User Execution', 'Detects when Sophos XG Firewall''s Advanced Threat Protection (ATP) identifies malicious activity, including sandboxing results, malware detection, and zero-day threats. This rule triggers on ATP events indicating threat detection, malware identification, or virus findings.

Next Steps:
1. Immediately isolate the affected host from the network
2. Review the ATP threat details and sandbox analysis results
3. Check for any file transfers or downloads from the source IP
4. Scan the internal network for indicators of compromise
5. Update threat intelligence feeds and firewall signatures
6. Review user activity from the affected source
7. Consider reimaging the affected system if malware is confirmed
', '["https://docs.sophos.com/nsg/sophos-firewall/20.0/Help/en-us/webhelp/onlinehelp/AdministratorHelp/AdvancedProtection/index.html","https://attack.mitre.org/techniques/T1204/"]', 'safe("log.type", "") == "ATP" && safe("log.component", "") == "Threat Protection" && (safe("log.subType", "") in ["Malware", "Threat"] || safe("log.virus", "") != "" || (safe("log.logMessage", "") != "" && (safe("log.logMessage", "").contains("malware") || safe("log.logMessage", "").contains("threat") || safe("log.logMessage", "").contains("virus"))))', '2025-09-03 15:06:37.827278', true, false, 'origin', '["origin.ip","target.ip"]', '[]');
INSERT INTO public.utm_correlation_rules VALUES (411, 'Sophos XG Firewall Application Risk Changes', 3, 3, 2, 'Command and Control', 'T1071 - Application Layer Protocol', 'Detects changes in application risk levels or usage of high-risk applications that could indicate malware communication, data exfiltration attempts, or policy violations. This rule identifies applications with risk levels 4-5 or applications categorized as malware, backdoors, trojans, or botnets.

Next Steps:
1. Investigate the source IP address and user account associated with the high-risk application usage
2. Review the specific application being used and its legitimate business purpose
3. Check for other suspicious network activity from the same source
4. Verify if the application usage aligns with organizational security policies
5. Consider blocking or restricting the application if it poses a security risk
6. Review application control policies and risk categorizations for accuracy
', '["https://docs.sophos.com/nsg/sophos-firewall/20.0/Help/en-us/webhelp/onlinehelp/AdministratorHelp/WebProtection/ApplicationControl/index.html","https://attack.mitre.org/techniques/T1071/"]', 'safe("log.type", "") == "Content Filtering" &&
safe("log.component", "") == "Application" &&
(safe("log.applicationRisk", "") in ["4", "5"] ||
 (safe("log.applicationCategory", "") != "" &&
  (safe("log.applicationCategory", "").contains("malware") ||
   safe("log.applicationCategory", "").contains("backdoor") ||
   safe("log.applicationCategory", "").contains("trojan") ||
   safe("log.applicationCategory", "").contains("botnet"))))
', '2025-09-03 15:06:38.427778', true, false, 'origin', '["origin.ip","log.applicationName"]', '[]');
INSERT INTO public.utm_correlation_rules VALUES (412, 'Sophos XG Email Protection Threat Detected', 3, 3, 2, 'Initial Access', 'T1566 - Phishing', 'Detects email-based threats including spam, phishing attempts, malware attachments, and suspicious email patterns identified by Sophos XG''s email protection features. This rule triggers when the email protection component identifies malicious content, blocked messages, virus infections, or suspicious email traffic patterns.

Next Steps:
1. Review the email content and attachments for malicious indicators
2. Check the sender''s reputation and authentication status
3. Verify if similar emails were sent to other users
4. Update email security policies if new threat patterns are identified
5. Consider blocking the sender domain if confirmed malicious
6. Notify affected users about potential phishing attempts
', '["https://docs.sophos.com/nsg/sophos-firewall/20.0/Help/en-us/webhelp/onlinehelp/AdministratorHelp/EmailProtection/index.html","https://attack.mitre.org/techniques/T1566/"]', '(safe("log.type", "") in ["Anti-Spam", "Mail"]) && (safe("log.component", "") in ["SMTP", "POP3", "IMAP"]) && (safe("log.subType", "") in ["Spam", "Virus", "Blocked"] || safe("log.virus", "") != "" || (safe("log.logMessage", "") != "" && (safe("log.logMessage", "").contains("spam") || safe("log.logMessage", "").contains("phishing") || safe("log.logMessage", "").contains("malware") || safe("log.logMessage", "").contains("virus"))) || (safe("statusCode", 0) >= 500 && safe("protocol", "") == "SMTP"))', '2025-09-03 15:06:39.028148', true, false, 'origin', '["origin.ip","target.email"]', '[]');
INSERT INTO public.utm_correlation_rules VALUES (1389, 'Windows: Remote Computer Account DnsHostName Update', 3, 3, 2, 'Privilege Escalation', 'Exploitation for Privilege Escalation', 'Identifies the remote update to a computer account''s DnsHostName attribute. If the new value set is a valid domain controller DNS hostname and the subject computer name is not a domain controller, then it''s highly likely a preparation step to exploit CVE-2022-26923 in an attempt to elevate privileges from a standard domain user to domain admin privileges.', '["https://attack.mitre.org/tactics/TA0004/","https://attack.mitre.org/techniques/T1068/"]', 'safe("log.action", "") == ''logged-in'' && safe("actionResult", "").matches("success") && !safe("log.userName", "").contains("ANONYMOUS LOGON") && !safe("log.eventData.subjectUserName", "").contains("ANONYMOUS LOGON") && safe("log.eventData.subjectUserName", "").startsWith("$") && !safe("log.userDomain", "").contains("NT AUTHORITY")', '2025-09-04 20:45:21.166833', true, false, 'origin', NULL, '[]');
INSERT INTO public.utm_correlation_rules VALUES (1344, 'Windows: Possible sideloading of DLL via Microsoft antimalware service executable with MsMpEng process', 3, 3, 3, 'Defense Evasion', 'Hijack Execution Flow', 'Identifies a Windows trusted program that is known to be vulnerable to DLL Search Order Hijacking starting after being renamed or from a non-standard path. This is uncommon behavior and may indicate an attempt to evade defenses via side-loading a malicious DLL within the memory space of one of those processes.', '["https://attack.mitre.org/tactics/TA0005/","https://attack.mitre.org/techniques/T1574/"]', 'safe("log.winlogEventDataProcessName", "").contains(''MsMpEng.exe'') && !safe("winlogEventDataProcessPath", "").matches(''(:\\ProgramData\\Microsoft\\Windows Defender\\(.+).exe|:\\Program Files\\Windows Defender\\(.+).exe|:\\Program Files (x86)\\Windows Defender\\(.+).exe|:\\Program Files\\Microsoft Security Client\\(.+).exe|:\\Program Files (x86)\\Microsoft Security Client\\(.+).exe)'')', '2025-09-04 20:24:33.439662', true, false, 'origin', NULL, '[]');
INSERT INTO public.utm_correlation_rules VALUES (413, 'Sophos XG Firewall Heartbeat Missing Alerts', 1, 2, 3, 'Defense Evasion', 'T1070 - Indicator Removal on Host', 'Detects when multiple endpoints are missing heartbeat signals from Sophos XG Firewall, which could indicate network connectivity issues, endpoint compromise, or service disruption. Missing heartbeats may suggest that security monitoring is being bypassed or that critical network infrastructure is failing.

Next Steps:
1. Verify network connectivity to the affected devices
2. Check if the devices are powered on and functioning properly
3. Review firewall logs for any security events preceding the heartbeat loss
4. Investigate potential network attacks or infrastructure failures
5. Validate that heartbeat monitoring services are running correctly
6. Check for any scheduled maintenance or configuration changes
7. Consider implementing redundant monitoring mechanisms
', '["https://docs.sophos.com/nsg/sophos-firewall/20.0/Help/en-us/webhelp/onlinehelp/AdministratorHelp/Logs/TroubleshootingLogs/LogFileDetails/index.html","https://attack.mitre.org/techniques/T1070/"]', 'safe("log.type", "") == "Event" &&
safe("log.component", "") == "Heartbeat" &&
(safe("log.logMessage", "").contains("missing") ||
 safe("log.logMessage", "").contains("lost") ||
 safe("log.hb_health", "") == "No Heartbeat")
', '2025-09-03 15:06:39.889298', true, false, 'origin', '["origin.host","dataSource"]', '[{"indexPattern":"v11-log-firewall-sophos-*","with":[{"field":"log.deviceName.keyword","operator":"filter_term","value":"{{.log.deviceName}}"}],"or":null,"within":"now-15m","count":3}]');
INSERT INTO public.utm_correlation_rules VALUES (1394, 'Windows: Potential Credential Access via LSASS Memory Dump', 3, 3, 2, 'Credential Access', 'OS Credential Dumping', 'Identifies suspicious access to LSASS handle from a call trace pointing to DBGHelp.dll or DBGCore.dll, which both export the MiniDumpWriteDump method that can be used to dump LSASS memory content in preparation for credential access.', '["https://attack.mitre.org/tactics/TA0006/","https://attack.mitre.org/techniques/T1003/"]', 'safe("log.winlogEventId", "") == ''10'' && safe("log.eventDataTargetImage", "").matches("(C:\\\\WINDOWS\\\\system32\\\\lsass.exe)") && safe("log.eventDataCallTrace", "").matches("(dbghelp|dbgcore)") && !safe("log.eventDataProcessName", "").matches("(C:\\\\Windows\\\\System32\\\\WerFault.exe|C:\\\\Windows\\\\System32\\\\WerFaultSecure.exe)")', '2025-09-04 20:46:19.540371', true, false, 'origin', NULL, '[]');
INSERT INTO public.utm_correlation_rules VALUES (417, 'Sophos XG Synchronized Security Event', 3, 3, 2, 'Discovery', 'Security Software Discovery', 'Detects synchronized security events from Sophos endpoints communicating with the firewall, including heartbeat failures, compromised endpoints, and security status changes. This rule identifies critical security state changes in the Sophos ecosystem that may indicate endpoint compromise, communication failures, or degraded security posture.

Next Steps:
1. Investigate the specific endpoint device generating the alert
2. Check the endpoint''s security status in Sophos Central console
3. Verify network connectivity between endpoint and firewall
4. Review recent security events on the affected endpoint
5. Examine firewall logs for any blocked communications from the endpoint
6. If endpoint is compromised, initiate incident response procedures
7. Consider isolating the endpoint if threat is confirmed
8. Update endpoint security policies if configuration issues are found
', '["https://docs.sophos.com/nsg/sophos-firewall/20.0/Help/en-us/webhelp/onlinehelp/AdministratorHelp/SynchronizedSecurity/index.html","https://attack.mitre.org/techniques/T1518/001/"]', '(safe("log.type", "") == "Event" && safe("log.component", "") == "Synchronized Security") || (safe("log.hb_health", "") != "" && !(safe("log.hb_health", "") in ["No Heartbeat", "Green"])) || (safe("log.component", "") == "Heartbeat" && safe("log.subType", "") in ["Missing", "Red", "Yellow"])', '2025-09-03 15:06:42.932097', true, false, 'origin', '["adversary.ip","adversary.host"]', '[]');
INSERT INTO public.utm_correlation_rules VALUES (1253, 'AMSI Bypass Detection', 3, 3, 2, 'Defense Evasion', 'T1562.001 - Impair Defenses: Disable or Modify Tools', 'Detects attempts to bypass the Antimalware Scan Interface (AMSI) through PowerShell commands, DLL hijacking, or memory patching techniques. AMSI bypass is commonly used by attackers to evade detection when executing malicious PowerShell scripts or other code.

Next Steps:
1. Immediately isolate the affected host to prevent lateral movement
2. Examine the full PowerShell script block text in Event ID 4104 for malicious content
3. Review command line arguments in Event ID 4688 for suspicious PowerShell execution
4. Check for additional indicators of compromise on the host
5. Verify if legitimate administrative tools are being used or if this is malicious activity
6. Review recent file modifications and process execution history
7. Check for persistence mechanisms that may have been installed
8. Consider reimaging the system if compromise is confirmed
', '["https://attack.mitre.org/techniques/T1562/001/","https://docs.microsoft.com/en-us/windows/win32/amsi/antimalware-scan-interface-portal"]', '(safe("log.eventCode", 0.0) == double(4104) &&
 (safe("log.winlogEventDataScriptBlockText", "").contains("[Ref].Assembly.GetType") &&
  safe("log.winlogEventDataScriptBlockText", "").contains("amsi") &&
  safe("log.winlogEventDataScriptBlockText", "").contains("SetValue")) ||
 safe("log.winlogEventDataScriptBlockText", "").contains("AmsiUtils") ||
 safe("log.winlogEventDataScriptBlockText", "").contains("amsiInitFailed") ||
 safe("log.winlogEventDataScriptBlockText", "").contains("Bypass.AMSI") ||
 safe("log.winlogEventDataScriptBlockText", "").contains("AmsiScanBuffer")) ||
(safe("log.eventCode", 0.0) == double(4688) &&
 safe("log.winlogEventDataCommandLine", "").contains("powershell") &&
 (safe("log.winlogEventDataCommandLine", "").contains("amsi.dll") ||
  safe("log.winlogEventDataCommandLine", "").contains("AmsiScanBuffer") ||
  safe("log.winlogEventDataCommandLine", "").contains("amsiInitFailed")))
', '2025-09-04 19:28:21.286871', true, false, 'origin', '["origin.host","origin.user"]', '[]');
INSERT INTO public.utm_correlation_rules VALUES (416, 'Sophos XG Firewall SD-WAN Link Quality Issues', 1, 2, 3, 'Impact', 'Network Performance Degradation', 'Detects SD-WAN link quality degradation including high latency, packet loss, or jitter that could impact application performance or indicate network attacks. These issues can affect business operations and may be indicators of denial of service attacks or network infrastructure problems.

Next Steps:
1. Check the affected SD-WAN interfaces and verify their operational status
2. Review network performance metrics for the impacted links
3. Correlate with any recent network configuration changes
4. Investigate if multiple links are affected simultaneously (possible attack)
5. Contact network team to verify ISP status and connectivity
6. Consider implementing traffic failover to backup links if available
7. Monitor for patterns that might indicate intentional network degradation attacks
', '["https://docs.sophos.com/nsg/sophos-firewall/19.5/Help/en-us/webhelp/onlinehelp/AdministratorHelp/Routing/SDWANRoutes/RoutingSDWANRoutesManage/index.html","https://attack.mitre.org/techniques/T1498/"]', 'safe("log.logMessage", "") != "" &&
safe("log.component", "") == "SD-WAN" &&
(safe("log.logMessage", "").contains("quality") ||
 safe("log.logMessage", "").contains("latency") ||
 safe("log.logMessage", "").contains("packet loss") ||
 safe("log.logMessage", "").contains("jitter") ||
 safe("log.logMessage", "").contains("degraded") ||
 safe("log.logMessage", "").contains("SLA violation"))
', '2025-09-03 15:06:42.051724', true, false, 'origin', '["log.inInterface","log.outInterface"]', '[]');
INSERT INTO public.utm_correlation_rules VALUES (418, 'Sophos XG Firewall User Threat Quotient Spikes', 3, 2, 1, 'Defense Evasion, Persistence, Privilege Escalation, Initial Access', 'T1078 - Valid Accounts: Suspicious User Activity', 'Detects significant increases in user threat quotient scores which could indicate compromised accounts, insider threats, or users engaging in risky behavior patterns. Sophos XG Firewall''s User Threat Quotient feature assigns risk scores to users based on their activities and behaviors.

Next Steps:
1. Review the specific user''s recent activities and authentication patterns
2. Check for any unusual login locations, times, or devices for this user
3. Verify if the user account has been compromised by reviewing recent password changes
4. Examine the user''s network access patterns and file access behaviors
5. Cross-reference with other security tools for additional indicators of compromise
6. Consider temporarily restricting the user''s access while investigating
7. Interview the user to understand any legitimate reasons for unusual behavior
8. Review and update user access privileges if necessary
9. Monitor the user''s threat quotient score trends over time
10. Document findings and implement additional monitoring if suspicious activity is confirmed
', '["https://docs.sophos.com/nsg/sophos-firewall/20.0/Help/en-us/webhelp/onlinehelp/AdministratorHelp/Users/UserThreatQuotient/index.html","https://attack.mitre.org/techniques/T1078/"]', 'safe("log.type", "") == "Event" &&
safe("origin.user", "") != "" &&
(safe("log.logMessage", "").contains("threat quotient") ||
 safe("log.logMessage", "").contains("risk score") ||
 safe("log.logMessage", "").contains("suspicious activity") ||
 (safe("log.component", "") == "User" &&
  safe("log.subType", "") == "Authentication" &&
  (safe("log.logMessage", "").contains("multiple failed") ||
   safe("log.logMessage", "").contains("unusual") ||
   safe("log.logMessage", "").contains("anomal"))))
', '2025-09-03 15:06:43.925534', true, false, 'origin', '["origin.user"]', '[]');
INSERT INTO public.utm_correlation_rules VALUES (419, 'Sophos XG Web Protection Policy Violation', 3, 2, 1, 'Command and Control', 'T1071.001 - Application Layer Protocol: Web Protocols', 'Detects web protection policy violations including blocked websites, malicious downloads, inappropriate content access attempts, and web application attacks on Sophos XG firewalls. This rule monitors for content filtering denials, HTTP blocks, malware/phishing category matches, web policy exceptions, and suspicious file downloads.

Next Steps:
1. Review the blocked URL and categorization to understand the nature of the violation
2. Investigate the source IP for additional suspicious activities or patterns
3. Check if this is a legitimate business request that requires policy adjustment
4. Examine user context and determine if additional security awareness training is needed
5. Consider implementing additional controls if pattern indicates persistent policy violations
6. Document the incident for compliance and policy review purposes
', '["https://docs.sophos.com/nsg/sophos-firewall/20.0/Help/en-us/webhelp/onlinehelp/AdministratorHelp/WebProtection/index.html","https://attack.mitre.org/techniques/T1071/001/"]', '(safe("log.logMessage", "") == "Content Filtering" && safe("log.category", "") in ["Denied", "Blocked"]) || (safe("log.component", "") == "HTTP" && safe("actionResult", "") == "denied") || (safe("log.applicationCategory", "") != "" && (safe("log.applicationCategory", "").contains("Malware") || safe("log.applicationCategory", "").contains("Phishing") || safe("log.applicationCategory", "").contains("Spyware"))) || (safe("log.downloadFileName", "") != "" && (safe("log.downloadFileName", "").contains("exe") || safe("log.downloadFileName", "").contains("dll") || safe("log.downloadFileName", "").contains("scr")))', '2025-09-03 15:06:44.974932', true, false, 'origin', '["origin.ip","target.url"]', '[]');
INSERT INTO public.utm_correlation_rules VALUES (420, 'Authentication Bypass Attempts', 3, 3, 2, 'Credential Access', 'T1212 - Exploitation for Credential Access', 'Detects attempts to bypass authentication mechanisms through various techniques including HTTP verb tampering, authentication header manipulation, session fixation, or exploiting authentication logic flaws in protected resources.

Next Steps:
1. Investigate the source IP address and check for patterns of attack behavior
2. Review Apache access logs for the timeframe around the alert to understand the full attack sequence
3. Examine the specific requests made to protected resources and authentication endpoints
4. Check if the attempts were successful by looking for subsequent 200 status codes from the same IP
5. Verify the integrity of authentication configuration files (.htaccess, .htpasswd)
6. Review user accounts for any unauthorized access or privilege escalation
7. Consider implementing additional authentication controls like rate limiting or IP blocking
8. Update WAF rules to detect and block similar bypass attempts
', '["https://httpd.apache.org/docs/2.4/howto/auth.html","https://attack.mitre.org/techniques/T1212/"]', 'safe("origin.ip", "") != "" &&
((safe("log.statusCode", 0.0) == double(401) || safe("log.statusCode", 0.0) == double(403)) &&
 (safe("log.method", "") == "OPTIONS" || 
  safe("log.method", "") == "PATCH" ||
  safe("log.method", "") == "PUT" ||
  safe("log.method", "") == "TRACE" ||
  safe("log.method", "") == "CONNECT" ||
  safe("log.method", "") == "PROPFIND")) ||
(safe("origin.path", "").contains("/admin") || 
 safe("origin.path", "").contains("/api/") ||
 safe("origin.path", "").contains("/private") ||
 safe("origin.path", "").contains("/.htaccess") ||
 safe("origin.path", "").contains("/.htpasswd")) &&
(safe("log.request", "").contains("Authorization: Basic Og==") ||
 safe("log.request", "").contains("Authorization: Bearer null") ||
 safe("log.request", "").contains("X-Original-URL:") ||
 safe("log.request", "").contains("X-Rewrite-URL:") ||
 safe("origin.path", "").contains("..;/") ||
 safe("origin.path", "").contains("%2e%2e"))
', '2025-09-03 15:09:26.365416', true, false, 'origin', '["origin.ip","origin.path"]', '[{"indexPattern":"v11-log-filebeat-*","with":[{"field":"origin.ip.keyword","operator":"filter_term","value":"{{.origin.ip}}"},{"field":"log.statusCode.keyword","operator":"filter_term","value":"401"}],"or":[{"indexPattern":"v11-log-filebeat-*","with":[{"field":"origin.ip.keyword","operator":"filter_term","value":"{{.origin.ip}}"},{"field":"log.statusCode.keyword","operator":"filter_term","value":"403"}],"or":null,"within":"now-5m","count":3}],"within":"now-5m","count":3}]');
INSERT INTO public.utm_correlation_rules VALUES (1346, 'Windows: Microsoft IIS Service Account Password Dumped', 3, 2, 2, 'Credential Access', 'OS Credential Dumping', 'Identifies the Internet Information Services (IIS) command-line tool, AppCmd, being used to list passwords. An attacker with IIS web server access via a web shell can decrypt and dump the IIS AppPool service account password using AppCmd.', '["https://attack.mitre.org/tactics/TA0006/","https://attack.mitre.org/techniques/T1003/"]', 'safe("log.winlogEventDataProcessName", "").matches(''appcmd.exe'') && safe("log.message", "").matches(''(/list)'') && safe("log.message", "").matches(''(/text(.+)password)'')', '2025-09-04 20:24:34.453392', true, false, 'origin', NULL, '[]');
INSERT INTO public.utm_correlation_rules VALUES (425, 'Admin Account Compromise Indicators', 3, 3, 2, 'Defense Evasion, Persistence, Privilege Escalation, Initial Access', 'T1078 - Valid Accounts', 'Detects multiple failed admin login attempts followed by a successful login from the same IP address, indicating potential account compromise through credential stuffing or brute force attacks.

Next Steps:
1. Review the source IP address and check if it''s from an expected location
2. Contact the admin user to verify if the login was legitimate
3. Check for any suspicious activities performed after the successful login
4. Review other authentication logs from the same IP address
5. Consider implementing IP-based access controls for admin accounts
6. Enable multi-factor authentication if not already configured
7. Reset the compromised admin account password if unauthorized access is confirmed
', '["https://attack.mitre.org/techniques/T1078/","https://docs.fortinet.com/document/fortigate/7.4.1/fortios-log-message-reference/160372/list-of-log-types-and-subtypes"]', 'safe("log.id", "") == "0100032001" && safe("log.type", "") == "event" && safe("log.subtype", "") == "system" && safe("log.desc", "") == "Admin login successful" && safe("origin.ip", "") != "" && safe("log.user", "") != ""', '2025-09-03 15:12:03.535636', true, false, 'origin', NULL, '[{"indexPattern":"v11-log-firewall-fortigate-*","with":[{"field":"origin.ip.keyword","operator":"filter_term","value":"{{.origin.ip}}"},{"field":"log.logdesc.keyword","operator":"filter_term","value":"Admin login failed"},{"field":"log.user.keyword","operator":"filter_term","value":"{{.log.user}}"}],"or":null,"within":"now-30m","count":3}]');
INSERT INTO public.utm_correlation_rules VALUES (421, 'Web Cache Poisoning Attempts', 2, 3, 2, 'Initial Access', 'Drive-by Compromise', 'Detects potential web cache poisoning attempts through manipulation of cache key headers, malformed host headers, or injection of cache-busting parameters. This attack can lead to stored XSS, defacement, or serving malicious content to other users by exploiting caching mechanisms to store malicious responses that are later served to legitimate users.

Next Steps:
1. Examine the specific headers and parameters used in the request to identify the poisoning technique
2. Check if multiple requests from the same IP are attempting cache poisoning variations
3. Verify if any cached responses were successfully poisoned by reviewing cache logs
4. Analyze the target paths and resources being poisoned for business impact
5. Review web application firewall logs for related blocking attempts
6. Check for any successful exploitation by examining user-facing content
7. Consider implementing cache key normalization and header validation
8. Monitor for any subsequent requests to the same poisoned resources
', '["https://portswigger.net/web-security/web-cache-poisoning","https://attack.mitre.org/techniques/T1189/"]', 'safe("origin.ip", "") != "" &&
(safe("log.request", "").contains("X-Forwarded-Host:") ||
 safe("log.request", "").contains("X-Host:") ||
 safe("log.request", "").contains("X-Forwarded-Server:") ||
 safe("log.request", "").contains("X-Original-URL:") ||
 safe("log.request", "").contains("X-Rewrite-URL:") ||
 (safe("origin.path", "").contains("?") && 
  (safe("origin.path", "").contains("cb=") || 
   safe("origin.path", "").contains("utm_") || 
   safe("origin.path", "").contains("cache=") ||
   safe("origin.path", "").contains("_=") ||
   safe("origin.path", "").contains("buster="))) ||
 safe("log.message", "").contains("Cache-Control: no-transform"))
', '2025-09-03 15:09:30.282056', true, false, 'origin', NULL, '[]');
INSERT INTO public.utm_correlation_rules VALUES (422, 'CGI Script Exploitation Attempts', 3, 3, 2, 'Execution', 'T1059 - Command and Scripting Interpreter', 'Detects attempts to exploit CGI scripts including command injection, path traversal to execute system binaries, shellshock-style attacks, or other CGI-based remote code execution attempts. This rule identifies suspicious patterns in HTTP requests targeting CGI scripts that could indicate exploitation attempts.

Next Steps:
1. Review the complete HTTP request including headers, parameters, and payload
2. Examine server logs for any successful execution or error messages
3. Check if the targeted CGI script exists and is vulnerable to the detected attack pattern
4. Analyze the source IP reputation and check for other malicious activities from the same source
5. Verify server integrity and check for any unauthorized code execution or file modifications
6. Review web application firewall logs for additional context and related blocked requests
7. Consider implementing additional CGI security controls and blocking the source IP if confirmed malicious
8. Validate that CGI scripts follow secure coding practices and input validation
', '["https://httpd.apache.org/docs/2.4/howto/cgi.html","https://attack.mitre.org/techniques/T1059/"]', '( safe("origin.path", "").contains("/cgi-bin/") && ( safe("origin.path", "").contains("../") || safe("origin.path", "").contains("..\\") || safe("origin.path", "").contains("/bin/") || safe("origin.path", "").contains("/usr/bin/") || safe("origin.path", "").contains("cmd.exe") || safe("origin.path", "").contains("powershell") ) ) || ( safe("log.userAgent", "").contains("() {") || safe("log.referer", "").contains("() {") || safe("origin.path", "").contains("() {") ) || ( safe("origin.path", "").contains("/cgi-bin/") && ( safe("origin.path", "").contains(";") && (safe("origin.path", "").contains("echo") || safe("origin.path", "").contains("cat") || safe("origin.path", "").contains("id") || safe("origin.path", "").contains("whoami")) ) ) || ( safe("log.method", "") == "POST" && safe("origin.path", "").contains("/cgi-bin/") && safe("statusCode", 0.0) == double(200) && safe("origin.bytesReceived", 0) < 100 )', '2025-09-03 15:09:31.316065', true, false, 'origin', NULL, '[]');
INSERT INTO public.utm_correlation_rules VALUES (423, 'Suspicious Configuration File Access', 3, 2, 1, 'Collection', 'T1005 - Data from Local System', 'Detects access attempts to sensitive configuration files that could expose server configuration, credentials, or other sensitive information. This includes attempts to access Apache configuration files, database configuration files, environment files, version control directories, and other sensitive system files.

Next Steps:
1. Review the accessed file path and determine if it contains sensitive information
2. Check if the request was successful (HTTP 200) and investigate the source IP
3. Examine user agent strings for automated tools or scanners
4. Review server logs for other suspicious activity from the same IP
5. Verify file permissions and consider restricting access to sensitive files
6. Monitor for subsequent requests that may indicate data exfiltration
7. Check web server access logs for patterns of directory traversal or enumeration
8. Validate that the requesting source has legitimate access to the configuration files
', '["https://attack.mitre.org/techniques/T1005/","https://httpd.apache.org/docs/2.4/configuring.html"]', 'safe("origin.path", "") != "" && ( safe("origin.path", "").contains(".conf") || safe("origin.path", "").contains(".config") || safe("origin.path", "").contains(".ini") || safe("origin.path", "").contains(".xml") || safe("origin.path", "").contains(".yml") || safe("origin.path", "").contains(".yaml") || safe("origin.path", "").contains(".env") || safe("origin.path", "").contains(".git/") || safe("origin.path", "").contains(".svn/") || safe("origin.path", "").contains("web.config") || safe("origin.path", "").contains("httpd.conf") || safe("origin.path", "").contains("apache2.conf") || safe("origin.path", "").contains("php.ini") || safe("origin.path", "").contains("wp-config.php") || safe("origin.path", "").contains("database.php") || safe("origin.path", "").contains("db.php") || safe("origin.path", "").contains("config.php") || safe("origin.path", "").contains("settings.php") || safe("origin.path", "").contains(".DS_Store") || safe("origin.path", "").contains("Thumbs.db") || safe("origin.path", "").contains(".bash_history") || safe("origin.path", "").contains("id_rsa") || safe("origin.path", "").contains(".ssh/") ) && safe("log.statusCode", 0) < 400', '2025-09-03 15:09:32.627345', true, false, 'origin', '["origin.ip","origin.path"]', '[]');
INSERT INTO public.utm_correlation_rules VALUES (430, 'Email Security Threat Detection', 3, 3, 1, 'Initial Access', 'T1566 - Phishing', 'Detects email-based security threats including phishing attempts, spam campaigns, and malicious attachments identified by FortiMail security scanners. This rule triggers on banned words, suspicious URLs, and failed authentication checks.

Next Steps:
1. Review the email headers and content for signs of phishing or malware
2. Check if the sender''s domain is legitimate and not spoofed
3. Investigate any URLs or attachments in the suspicious emails
4. Verify SPF, DKIM, and DMARC authentication results
5. Check if other users received similar emails from the same sender
6. Consider blocking the sender''s IP or domain if confirmed malicious
7. Update email security policies if needed
', '["https://docs.fortinet.com/document/fortimail/7.4.0/log-reference/376951/antispam-logs","https://attack.mitre.org/techniques/T1566/"]', '(safe("log.type", "") == "spam" && safe("log.msg", "").contains("Detected by BannedWord test")) ||
safe("log.msg", "").contains("FortiGuard-WebFilter identified URL") ||
safe("log.msg", "").contains("DMARC: No DKIM signature") ||
safe("log.msg", "").contains("SPF check: Fail") ||
safe("log.msg", "").contains("DKIM invalid") ||
(safe("log.subtype", "") == "emailfilter" && safe("action", "") == "blocked")
', '2025-09-03 15:12:07.281707', true, false, 'origin', '["origin.ip","origin.emailAddress"]', '[]');
INSERT INTO public.utm_correlation_rules VALUES (424, 'Denial of Service Attack Pattern', 1, 1, 3, 'Impact', 'T1498 - Network Denial of Service', 'Detects patterns indicative of denial of service attacks including slowloris, high request rates from single IPs, or requests designed to consume excessive server resources. This rule identifies various DoS attack indicators such as timeout responses, service unavailable errors, rate limiting responses, known DoS tool user agents, and abnormally large requests.

Next Steps:
- Investigate the source IP for additional malicious activity
- Check server resource utilization during the timeframe
- Review firewall and load balancer logs for traffic patterns
- Implement rate limiting or IP blocking if confirmed malicious
- Analyze request patterns for application-layer attacks
- Consider implementing DDoS protection mechanisms
', '["https://owasp.org/www-community/attacks/Denial_of_Service","https://attack.mitre.org/techniques/T1498/"]', '(safe("log.statusCode", 0.0) == double(408)) || (safe("log.statusCode", 0.0) == double(503)) || (safe("log.statusCode", 0.0) == double(429)) || (safe("origin.bytesReceived", 0.0) == double(0) && safe("log.statusCode", 0) >= 400) || (safe("log.userAgent", "").contains("slowloris") || safe("log.userAgent", "").contains("slowhttptest") || safe("log.userAgent", "").contains("R-U-Dead-Yet") || safe("log.userAgent", "").contains("PyLoris")) || (safe("origin.path", "").length() > 2048) || (safe("log.request", "").length() > 8192)', '2025-09-03 15:09:36.412388', true, false, 'origin', '["origin.ip"]', '[{"indexPattern":"v11-log-apache-*","with":[{"field":"origin.ip.keyword","operator":"filter_term","value":"{{.origin.ip}}"}],"or":null,"within":"now-1m","count":100}]');
INSERT INTO public.utm_correlation_rules VALUES (468, 'Generic Log Parsing Failures', 1, 2, 2, 'Defense Evasion', 'Log Processing Error', 'Detects when generic log parsing fails, which could indicate malformed logs, corrupted data, or attempts to evade detection by sending malformed log entries. This rule triggers when log messages are empty or when JSON parsing fails.

Next Steps:
1. Investigate the source of the malformed logs by checking the raw log data
2. Verify if this is a configuration issue or intentional log manipulation
3. Check if the log source is properly configured to send logs in the expected format
4. Review other logs from the same source for patterns of malformed data
5. Consider updating log collection configurations if this is a persistent issue
', '["https://www.syslog-ng.com/technical-documents/doc/syslog-ng-open-source-edition/3.24/administration-guide/71","https://attack.mitre.org/techniques/T1070/"]', 'safe("log.message", "") == "" || (safe("log.message", "").contains("parse error") || safe("log.message", "").contains("invalid json") || safe("log.message", "").contains("syntax error"))', '2025-09-03 15:20:54.881874', true, false, 'origin', '["log.message"]', '[]');
INSERT INTO public.utm_correlation_rules VALUES (427, 'Fortinet Application Control Policy Violations', 2, 2, 1, 'Defense Evasion', 'T1562.001 - Impair Defenses: Disable or Modify Tools', 'Detects multiple application control policy violations from the same source, indicating potential attempts to bypass security controls or use of prohibited applications. This could indicate an attacker or malicious insider attempting to use unauthorized applications that could be used for data exfiltration, command and control communication, or other malicious activities.

Next Steps:
- Identify the source IP and determine if it belongs to a legitimate user or system
- Review the blocked applications to understand what was attempted
- Check if the source has attempted other policy violations or suspicious activities
- Verify if the user has a legitimate business need for the blocked applications
- Review application control policies to ensure they align with business requirements
- Consider blocking the source IP if the activity appears malicious
- Document the incident and escalate if policy violations persist
', '["https://docs.fortinet.com/document/fortigate/7.4.1/administration-guide/618581/application-control","https://attack.mitre.org/techniques/T1562/001/"]', 'safe("log.type", "").contains("utm") && safe("log.subtype", "").contains("app-ctrl") && safe("action", "").contains("blocked") && safe("origin.ip", "") != ""', '2025-09-03 15:12:05.296362', true, false, 'origin', '["origin.ip"]', '[{"indexPattern":"v11-log-firewall-fortigate-*","with":[{"field":"origin.ip.keyword","operator":"filter_term","value":"{{.origin.ip}}"},{"field":"log.kvMessage.keyword","operator":"filter_match","value":"subtype=app-ctrl"},{"field":"log.kvMessage.keyword","operator":"filter_match","value":"action=blocked"}],"or":null,"within":"now-30m","count":10}]');
INSERT INTO public.utm_correlation_rules VALUES (428, 'Data Loss Prevention Trigger', 3, 2, 1, 'Exfiltration', 'T1048 - Exfiltration Over Alternative Protocol', 'Detects attempts to exfiltrate sensitive data that triggers DLP policies. This includes detection of credit card numbers, social security numbers, PII, financial records, and other regulated data attempting to leave the network.

Next Steps:
1. Identify the source IP and user associated with the DLP violation
2. Review the DLP profile that was triggered to understand what type of sensitive data was involved
3. Check if this is part of a pattern of data exfiltration attempts from the same source
4. Verify if the blocked action was legitimate business activity or potential data theft
5. Review other logs from the same source IP for suspicious activities
6. Contact the user if needed to understand the context of the attempted data transfer
7. Consider implementing additional access controls if unauthorized access to suspected
', '["https://docs.fortinet.com/document/fortigate/7.6.3/administration-guide/153498/data-loss-prevention","https://attack.mitre.org/techniques/T1048/"]', '(safe("log.subtype", "") == "dlp" && safe("action", "") == "blocked") || (safe("log.msg", "").contains("DLP sensor")) || (safe("log.msg", "").contains("sensitive data detected")) || (safe("log.dlp_profile", "") != "" && safe("log.dlp_action", "") == "block") || (safe("log.msg", "").contains("Data pattern matched"))', '2025-09-03 15:12:05.893281', true, false, 'origin', '["origin.ip","log.dlp_profile"]', '[]');
INSERT INTO public.utm_correlation_rules VALUES (429, 'DNS Filtering High-Risk Domain Blocked', 3, 3, 2, 'Command and Control', 'Command and Control', 'Detects when DNS filtering blocks access to high-risk domains, including malicious newly registered domains, parked domains, DNS tunneling attempts, or known C2 servers. This indicates potential malware communication attempts or compromised systems.

Next Steps:
1. Identify the blocked domain from the log.msg field and verify its reputation
2. Check if the source IP corresponds to a legitimate user or system
3. Review other DNS queries from the same source IP for patterns
4. Scan the source system for malware or suspicious processes
5. Check for any successful connections to suspicious domains before the block
6. Update endpoint security and run full system scan on affected hosts
7. Consider isolating the system if multiple C2 attempts are detected
', '["https://www.fortinet.com/support/support-services/fortiguard-security-subscriptions/dns-security","https://attack.mitre.org/techniques/T1071/004/","https://attack.mitre.org/techniques/T1568/"]', 'safe("log.type", "") == "dns" && safe("action", "") in ["block", "deny", "blocked"] && ( safe("log.msg", "").contains("dns blocked") || safe("log.msg", "").contains("malicious domain") || safe("log.msg", "").contains("botnet c&c") || safe("log.msg", "").contains("dga domain") || safe("log.msg", "").contains("dns tunneling") || safe("log.msg", "").contains("reputation") )', '2025-09-03 15:12:06.625951', true, false, 'origin', '["origin.ip","target.ip"]', '[]');
INSERT INTO public.utm_correlation_rules VALUES (434, 'High Availability Split-Brain Condition Detected', 1, 3, 3, 'System Integrity', 'Service Disruption', 'Split-brain condition detected in FortiGate HA cluster where both units are acting as primary. This critical condition causes IP conflicts, network disruption, and potential data corruption. Immediate remediation is required.

Next Steps:
1. Immediately check HA heartbeat interface connectivity between cluster members
2. Verify all heartbeat links (primary and backup) are functioning
3. Check for network switch/cable failures between HA units
4. Review HA configuration for proper priorities and preemption settings
5. Force one unit to secondary role using ''diagnose sys ha reset-uptime'' if necessary
6. Monitor cluster status with ''get system ha status'' command
7. Consider implementing backup heartbeat interfaces to prevent future occurrences
', '["https://community.fortinet.com/t5/FortiGate/Technical-Tip-High-Availability-Split-Brain/ta-p/214842","https://docs.fortinet.com/document/fortigate/7.6.0/new-features/474848/backup-heartbeat-interface-mitigates-split-brain-scenarios"]', 'safe("log.type", "") == "event" && safe("log.subtype", "") == "ha" && (safe("log.msg", "").contains("backup heartbeat interfaces are used") || (safe("log.ha_role", "") == "primary" && safe("log.desc", "").contains("HA device interface peer information")) || safe("log.msg", "").contains("both devices acting as primary"))', '2025-09-03 15:12:09.571883', true, false, 'origin', '["log.devid","log.devname"]', '[]');
INSERT INTO public.utm_correlation_rules VALUES (431, 'Endpoint Compliance Policy Violation', 3, 3, 2, 'Defense Evasion, Persistence, Privilege Escalation, Initial Access', 'T1078 - Valid Accounts', 'Detects when an endpoint fails compliance checks including outdated antivirus signatures, missing patches, unauthorized software, or security policy violations. This may indicate vulnerable or compromised systems attempting network access.

Next Steps:
1. Identify the affected endpoint and user from the alert details
2. Review the specific compliance failure reason in the FortiGate logs
3. Check if this is a recurring issue for the same endpoint
4. Verify the endpoint''s current security posture (antivirus status, patch level, installed software)
5. If outdated antivirus: Update signatures immediately
6. If missing patches: Schedule critical updates
7. If unauthorized software: Remove and investigate why it was installed
8. Consider temporarily isolating the endpoint until compliance is restored
9. Review network access logs for any suspicious activity from this endpoint
10. Update endpoint compliance policies if false positives are occurring
', '["https://www.fortinet.com/products/network-access-control","https://attack.mitre.org/techniques/T1078/"]', '( safe("log.subtype", "") in ["endpoint", "compliance", "host"] || safe("log.type", "") == "endpoint" || safe("log.id", "") in ["0102043008", "0102043009", "0102043010"] ) && ( safe("log.msg", "").contains("compliance failed") || safe("log.msg", "").contains("policy violation") || safe("log.msg", "").contains("antivirus outdated") || safe("log.msg", "").contains("patch missing") || safe("log.msg", "").contains("unauthorized software") || safe("log.msg", "").contains("security policy") || safe("log.status", "") == "non-compliant" || safe("log.compliance", "") == "failed" || safe("log.verdict", "") == "violation" ) && safe("action", "") in ["deny", "quarantine", "isolate", "block"]', '2025-09-03 15:12:07.747241', true, false, 'origin', NULL, '[]');
INSERT INTO public.utm_correlation_rules VALUES (432, 'FortiGuard Threat Feed Match Detection', 3, 3, 2, 'Command and Control', 'T1071 - Application Layer Protocol', 'Detects when network traffic matches a FortiGuard threat feed entry, indicating communication with known malicious IPs, domains, or URLs. This rule identifies potential malware command and control communications, data exfiltration attempts, or other malicious activities based on FortiGuard''s threat intelligence database. The detection covers webfilter blocks, custom remote FortiGuard categorizations, and explicit FortiGuard WebFilter identifications.

Next Steps:
1. Immediately investigate the source IP address for signs of compromise
2. Check if multiple hosts are communicating with the same threat feed-matched destination
3. Review the specific threat category and description from FortiGuard
4. Isolate affected systems if malware C2 communication is suspected
5. Block the malicious destination at the firewall level if not already blocked
6. Conduct forensic analysis on the source system to identify potential malware or unauthorized applications
7. Review network logs for additional suspicious activity from the same source
8. Check endpoint security tools for any related alerts or indicators
9. Consider threat hunting for similar IOCs across the environment
', '["https://docs.fortinet.com/document/fortigate/7.6.2/administration-guide/995517/fortiguard-category-threat-feed","https://attack.mitre.org/techniques/T1071/"]', '(safe("log.subtype", "") == "webfilter" && safe("log.eventtype", "") == "ftgd_blk") || (safe("log.cat", "") == "192" && safe("log.catdesc", "").contains("Custom-Remote-FGD")) || (safe("log.msg", "").contains("FortiGuard-WebFilter identified URL"))', '2025-09-03 15:12:08.258877', true, false, 'origin', '["origin.ip","target.ip"]', '[]');
INSERT INTO public.utm_correlation_rules VALUES (433, 'FortiSandbox Evasion Attempts Detected', 3, 3, 1, 'Defense Evasion', 'T1497 - Virtualization/Sandbox Evasion', 'Detects attempts to evade FortiSandbox analysis through various techniques such as sandbox detection, anti-debugging, or environment checks. This could indicate malware trying to avoid detection by checking for virtualized environments or analysis tools.

Next Steps:
1. Investigate the source IP address for other suspicious activities
2. Review the FortiSandbox detailed analysis report for the file or URL
3. Check if the file hash or URL has been flagged by other threat intelligence sources
4. Examine network traffic patterns from the affected source to identify potential command and control communications
5. Consider blocking the source IP if malicious behavior is confirmed
6. Update security policies to prevent similar evasion attempts
', '["https://docs.fortinet.com/document/fortisandbox/4.4.4/log-message-reference/183685/event","https://attack.mitre.org/techniques/T1027/","https://attack.mitre.org/techniques/T1497/"]', 'safe("log.subtype", "") == "fortisandbox" && safe("log.level", "") == "alert" && ( safe("log.msg", "").contains("sandbox evasion") || safe("log.msg", "").contains("anti-debugging") || safe("log.msg", "").contains("environment check") || safe("log.msg", "").contains("vm detection") || safe("log.threat", "").contains("evasion") || safe("log.behavior", "").contains("sandbox aware") || safe("log.verdict", "") == "suspicious" && safe("log.msg", "").contains("analysis failed") )', '2025-09-03 15:12:08.86889', true, false, 'origin', '["origin.ip"]', '[]');
INSERT INTO public.utm_correlation_rules VALUES (481, 'Multi-line Event Processing Issues', 1, 3, 2, 'Impact', 'Data Manipulation', 'Detects potential issues with multi-line event processing where logs contain unexpected newline characters or excessive line breaks that could cause parsing failures or log injection attempts.

Next Steps:
1. Review the source application generating these logs to determine if multi-line output is expected
2. Check log parsing configuration to ensure multi-line patterns are properly configured
3. Investigate if this could be a log injection attempt by examining the content around newline characters
4. Verify log collection agents are configured to handle multi-line events appropriately
5. Consider implementing stricter input validation if logs are from user-controlled sources
', '["https://github.com/fluent/fluentd/issues/2585","https://attack.mitre.org/techniques/T1565/"]', 'safe("log.message", "").contains("\n") && (safe("log.message", "").size() > 4096 || (size(safe("log.message", "").split("\n")) - 1) > 10)', '2025-09-03 15:22:02.544688', true, false, 'origin', '["origin.hostname","log.source"]', '[]');
INSERT INTO public.utm_correlation_rules VALUES (436, 'Fortinet IPS Critical Severity Detection', 3, 3, 2, 'Execution', 'T1203 - Exploitation for Client Execution', 'Detects critical severity IPS events indicating active exploitation attempts or severe security threats targeting the network.

Next Steps:
1. Immediately investigate the source IP address and determine if it''s malicious
2. Check if the attack was successfully blocked by reviewing firewall logs
3. Identify the specific vulnerability or attack pattern that triggered the IPS alert
4. Review other security events from the same source IP across all systems
5. Consider blocking the source IP at the perimeter if multiple critical attacks are detected
6. Update IPS signatures and verify all systems are patched against the detected vulnerability
7. Document the incident and notify the security team if this is part of a larger campaign
', '["https://docs.fortinet.com/document/fortigate/7.4.1/administration-guide/331728/ips-sensors","https://attack.mitre.org/techniques/T1203/"]', 'safe("log.msg", "").contains("type=utm") && safe("log.msg", "").contains("subtype=ips") && (safe("log.msg", "").contains("severity=critical") || safe("log.msg", "").contains("severity=high")) && safe("log.msg", "").contains("action=blocked")', '2025-09-03 15:13:20.206012', true, false, 'origin', '["origin.ip"]', '[]');
INSERT INTO public.utm_correlation_rules VALUES (470, 'Log Truncation Detection', 1, 3, 1, 'Impact', 'T1565.001 - Data Manipulation: Stored Data Manipulation', 'Detects potential log truncation issues where messages appear to be cut off, potentially indicating UDP packet size limits, buffer overflows, or attempts to hide malicious activity by truncating log entries.

Next Steps:
1. Investigate the source of truncated logs by checking the origin IP address and system
2. Review system configurations for log size limits, buffer sizes, and UDP packet size settings
3. Check for concurrent suspicious activities from the same source during the timeframe
4. Verify if truncation is intentional (configuration issue) or malicious (attempt to hide evidence)
5. Review complete logs from alternative sources if available
6. Consider implementing log collection via TCP instead of UDP if packet size is the issue
', '["https://www.ibm.com/support/pages/qradar-truncation-tls-syslog-log-source-events","https://github.com/rsyslog/rsyslog/issues/3249","https://attack.mitre.org/techniques/T1565/001/"]', '(safe("log.message", "").endsWith("...")) ||
(safe("log.message", "").endsWith("..")) ||
(size(safe("log.message", "")) == "1024") ||
(size(safe("log.message", "")) == "2048") ||
(size(safe("log.message", "")) == "4096") ||
(safe("log.message", "").matches(".*[^\\s]$") && 
 !safe("log.message", "").matches(".*[.!?;)]$"))
', '2025-09-03 15:20:56.129947', true, false, 'target', NULL, '[]');
INSERT INTO public.utm_correlation_rules VALUES (439, 'SD-WAN SLA Violations Detected', 1, 1, 3, 'Network Performance', 'Service Degradation', 'Multiple SD-WAN SLA violations detected indicating network performance degradation. This could impact application availability and user experience. The rule triggers when health check failures or SLA target misses occur repeatedly.

Next Steps:
1. Review the affected SD-WAN interface and health check details to identify the problematic link
2. Check network performance metrics (latency, jitter, packet loss) for the affected interface
3. Verify if the issue is affecting critical business applications using this SD-WAN link
4. Contact the ISP if the issue persists on a specific WAN link
5. Consider temporarily adjusting SD-WAN rules to route critical traffic through alternative links
6. Review historical SLA violations to identify patterns or recurring issues
', '["https://docs.fortinet.com/document/fortigate/7.2.0/sd-wan-architecture-for-enterprise/890209/sd-wan-logging","https://docs.fortinet.com/document/fortigate/7.2.0/administration-guide/856781/understanding-sd-wan-related-logs"]', 'safe("log.subtype", "") == "sdwan" && safe("log.eventtype", "") == "Health Check" && (safe("log.desc", "") == "Member out-of-sla" || safe("log.msg", "").contains("SLA fail") || safe("log.newvalue", "") == "0")', '2025-09-03 15:13:23.204667', true, false, 'origin', '["log.healthcheck","log.interface"]', '[{"indexPattern":"v11-log-firewall-fortigate-*","with":[{"field":"log.healthcheck.keyword","operator":"filter_term","value":"{{.log.healthcheck}}"},{"field":"log.interface.keyword","operator":"filter_term","value":"{{.log.interface}}"}],"or":null,"within":"now-15m","count":5}]');
INSERT INTO public.utm_correlation_rules VALUES (442, 'FortiWeb API Security Violations', 3, 3, 2, 'Initial Access', 'T1190 - Exploit Public-Facing Application', 'Detects API security violations including unauthorized access attempts, API abuse, rate limit violations, malformed requests, and attempts to exploit API vulnerabilities in FortiWeb protected applications.

Next Steps:
1. Review the blocked request details in the FortiWeb logs to understand the nature of the API violation
2. Check if the source IP has a history of malicious activity or is from a suspicious geographic location
3. Verify if this is a legitimate user/application experiencing issues or a genuine attack
4. Review the API endpoint being targeted and ensure proper authentication and rate limiting are configured
5. If confirmed malicious, consider blocking the source IP at the firewall level
6. Check for any successful API requests from the same source that may have occurred before the block
7. Review API security policies to ensure they are properly configured and up to date
', '["https://docs.fortinet.com/document/fortiweb/7.4.3/administration-guide/210196/blocking-known-attacks","https://attack.mitre.org/techniques/T1190/"]', 'safe("action", "") in ["deny", "block", "alert_deny"] && safe("log.msg", "").matches("(?i)(api.*violat|api.*abuse|api.*security|unauthorized.*api|api.*key.*invalid|api.*rate.*limit|malformed.*api.*request|api.*injection|/api/|/v[0-9]+/|/rest/|/graphql)")', '2025-09-03 15:14:10.167764', true, false, 'origin', '["origin.ip"]', '[]');
INSERT INTO public.utm_correlation_rules VALUES (443, 'FortiWeb Authentication Bypass Attempt Detected', 3, 3, 1, 'Defense Evasion, Persistence, Privilege Escalation, Initial Access', 'T1078 - Valid Accounts', 'Detects authentication bypass attempts including direct access to protected resources, authentication flow manipulation, and credential stuffing attacks on FortiWeb protected applications.

Next Steps:
1. Review the source IP address and check if it''s from a known location or VPN service
2. Examine the specific authentication bypass technique attempted (check log.attack_type and log.msg fields)
3. Verify if any successful authentication occurred from the same IP address
4. Check for other attack patterns from the same source IP in the last 24 hours
5. Consider blocking the source IP if multiple bypass attempts are confirmed
6. Review application logs for any successful unauthorized access
7. Validate that authentication mechanisms are properly configured and up to date
', '["https://docs.fortinet.com/document/fortiweb/7.2.2/log-message-reference/252057/event","https://attack.mitre.org/techniques/T1078/","https://attack.mitre.org/techniques/T1190/"]', 'safe("origin.ip", "") != "" && safe("log.type", "") == "attack" && ( safe("log.subtype", "") == "account-lockout-detection" || safe("log.msg", "").contains("authentication") || safe("log.msg", "").contains("Authentication") || safe("log.msg", "").contains("bypass") || safe("log.msg", "").contains("unauthorized access") || safe("log.attack_type", "") == "auth_bypass" || safe("log.trigger_policy", "").contains("auth") ) && safe("action", "") in ["deny", "alert", "block"]', '2025-09-03 15:14:11.275752', true, false, 'origin', '["origin.ip"]', '[]');
INSERT INTO public.utm_correlation_rules VALUES (444, 'FortiWeb Bot Detection and Mitigation', 2, 1, 3, 'Impact', 'T1496 - Resource Hijacking', 'Detects bot activity, crawlers, and automated tools attempting to access protected web applications, including bad bots, scrapers, and vulnerability scanners. This rule triggers when FortiWeb''s bot detection mechanisms identify and block suspicious automated traffic.

Next Steps:
1. Review the source IP address and check its reputation in threat intelligence databases
2. Analyze the user agent string and request patterns for bot-like behavior
3. Check if the IP is associated with known bot networks or data centers
4. Review the frequency and pattern of requests from this source
5. Consider implementing rate limiting or CAPTCHA challenges for suspicious sources
6. If confirmed as malicious, add the IP to a permanent block list
7. Review web application logs for any successful data extraction or scanning attempts
8. Ensure bot protection policies are properly configured and up to date
9. Monitor for any attempts to bypass bot detection mechanisms
10. Review FortiWeb policies to ensure they are tuned appropriately for legitimate traffic
', '["https://docs.fortinet.com/document/fortiweb/7.4.3/administration-guide/210196/blocking-known-attacks","https://attack.mitre.org/techniques/T1496/"]', 'safe("action", "") in ["deny", "captcha", "rate_limit"] && (safe("log.msg", "").matches("(?i)(bot.*detect|bad.*bot|web.*scrap|vuln.*scan|crawler|automated.*tool|suspicious.*user.*agent)") || safe("log.msg", "").matches("(?i)(bot|spider|scraper|scan|nikto|nmap|masscan|zgrab|gobuster|sqlmap|dirb|dirbuster|wfuzz)"))', '2025-09-03 15:14:11.808913', true, false, 'origin', '["origin.ip"]', '[]');
INSERT INTO public.utm_correlation_rules VALUES (448, 'FortiWeb DDoS Protection Activation', 1, 1, 3, 'Impact', 'Network Denial of Service', 'Detects when FortiWeb DDoS protection mechanisms are triggered, indicating potential distributed denial of service attacks against protected web applications. This rule monitors for patterns in log messages that indicate DDoS protection activation, rate limiting, or attack mitigation actions.

Next Steps:
1. Review the source IP addresses triggering the protection to identify attack patterns
2. Check if the blocked traffic represents legitimate users or actual attack traffic
3. Analyze the volume and frequency of requests from the identified sources
4. Consider implementing IP-based blocking at the network perimeter for confirmed attack sources
5. Review and adjust DDoS protection thresholds if false positives are occurring
6. Document the incident and update security controls as needed
7. Monitor for additional attack vectors or evasion techniques
8. Coordinate with network operations team for upstream blocking if attack persists
', '["https://docs.fortinet.com/document/fortiweb/7.0.0/administration-guide/981691/syntax-based-sql-xss-injection-detection","https://attack.mitre.org/techniques/T1498/"]', '( safe("log.msg", "").contains("ddos") || safe("log.msg", "").contains("DDoS") || safe("log.msg", "").contains("dos attack") || safe("log.msg", "").contains("DoS attack") || safe("log.msg", "").contains("http flood") || safe("log.msg", "").contains("HTTP flood") || safe("log.msg", "").contains("slowloris") || safe("log.msg", "").contains("Slowloris") || safe("log.msg", "").contains("slow post") || safe("log.msg", "").contains("slow read") || safe("log.msg", "").contains("rate limit exceed") || safe("log.msg", "").contains("connection limit") || safe("log.msg", "").contains("request flood") ) && ( safe("action", "").contains("deny") || safe("action", "").contains("block") || safe("action", "").contains("drop") || safe("log.msg", "").contains("rate limit") || safe("log.msg", "").contains("rate_limit") )', '2025-09-03 15:14:16.077003', true, false, 'origin', NULL, '[]');
INSERT INTO public.utm_correlation_rules VALUES (435, 'Industrial Control System Attack Detected', 3, 3, 3, 'Impair Process Control', 'T0836 - Modify Parameter', 'Detects potential attacks targeting Industrial Control Systems (ICS) or SCADA networks. This includes attempts to access OT protocols, modify control logic, or exploit vulnerabilities in industrial equipment. Industrial control systems are critical infrastructure components that manage physical processes in sectors like manufacturing, energy, water treatment, and transportation.

Next Steps:
1. Immediately isolate the affected ICS network segment to prevent lateral movement
2. Review firewall logs for the source IP to identify attack patterns and targeted systems
3. Check if the source IP has accessed other critical OT assets or attempted to modify control logic
4. Verify the integrity of PLC configurations and control logic on targeted systems
5. Contact the ICS/SCADA team and incident response team for immediate investigation
6. Review network segmentation between IT and OT networks for potential weaknesses
7. Consider blocking the source IP at the perimeter if confirmed malicious
', '["https://docs.fortinet.com/document/fortigate/7.0.4/fortios-log-message-reference/656858/log-id-definitions","https://attack.mitre.org/techniques/T0836/","https://attack.mitre.org/techniques/T0882/"]', '( safe("target.port", 0) in [502, 102, 20000, 44818, 47808, 4840, 34980] || safe("log.service", "") in ["modbus", "s7", "dnp3", "iec-104", "opcua", "bacnet", "ethernetip"] || safe("log.appcat", "") == "Industrial" || safe("log.app", "").contains("scada") || safe("log.app", "").contains("industrial") ) && ( safe("action", "") in ["deny", "block", "reset"] || safe("log.attack", "") != "" || safe("log.threat", "") != "" )', '2025-09-03 15:13:19.386305', true, false, 'origin', '["origin.ip","target.ip"]', '[]');
INSERT INTO public.utm_correlation_rules VALUES (440, 'Fortinet SSL/TLS Inspection Anomalies', 3, 2, 1, 'Command and Control', 'T1573 - Encrypted Channel', 'Detects SSL/TLS inspection anomalies including certificate issues, protocol violations, or attempts to bypass SSL inspection. These anomalies may indicate attempts to evade security controls, man-in-the-middle attacks, or compromised certificates being used for malicious communications.

Next Steps:
1. Review the specific SSL/TLS error message in the log.msg field to understand the nature of the anomaly
2. Check if the source IP is from a known/trusted internal device or an external entity
3. Verify if the destination is a legitimate service or potentially malicious domain
4. Examine certificate details if available to identify self-signed, expired, or untrusted certificates
5. Check for any security tools or legitimate applications that might trigger false positives
6. If suspicious, consider blocking the source IP temporarily and investigating the endpoint for compromise
', '["https://docs.fortinet.com/document/fortigate/7.4.1/administration-guide/593133/ssl-ssh-inspection","https://attack.mitre.org/techniques/T1573/"]', '(safe("log.msg", "").matches(".*ssl.*") || safe("log.msg", "").matches(".*tls.*") || safe("log.msg", "").matches(".*certificate.*")) && (safe("log.msg", "").matches(".*error.*") || safe("log.msg", "").matches(".*fail.*") || safe("log.msg", "").matches(".*invalid.*") || safe("log.msg", "").matches(".*untrusted.*") || safe("log.msg", "").matches(".*expired.*") || safe("log.msg", "").matches(".*self.*signed.*") || safe("action", "") == "blocked" || safe("action", "") == "deny") && safe("origin.ip", "") != ""', '2025-09-03 15:13:23.937719', true, false, 'origin', '["origin.ip","target.ip"]', '[]');
INSERT INTO public.utm_correlation_rules VALUES (482, 'Nested Format Exploitation Attempt', 3, 3, 3, 'Defense Evasion', 'Format String Attack', 'Detects attempts to exploit nested format strings or deeply nested JSON/XML structures that could lead to parsing vulnerabilities or denial of service.

Next Steps:
1. Review the source IP and determine if it''s a known or trusted source
2. Examine the full log message to understand the context of the format string patterns
3. Check if the application parsing these logs has any known format string vulnerabilities
4. Look for any application errors or crashes coinciding with these log entries
5. Consider blocking the source IP if multiple exploitation attempts are confirmed
6. Review application input validation and sanitization controls
', '["https://attack.mitre.org/techniques/T1027/","https://owasp.org/www-community/attacks/Format_string_attack"]', '(safe("log.message", "").contains("%s%s") || safe("log.message", "").contains("%n%n") || safe("log.message", "").contains("%x%x") || safe("log.message", "").contains("{{{{") || safe("log.message", "").contains("<%<%") || safe("log.message", "").matches(".*\\{[^}]{1000,}.*") || safe("log.message", "").matches(".*\\[[^\\]]{1000,}.*") || safe("log.message", "").matches(".*<[^>]{1000,}.*"))', '2025-09-03 15:22:03.097754', true, false, 'origin', '["origin.ip"]', '[]');
INSERT INTO public.utm_correlation_rules VALUES (441, 'Fortinet VPN Tunnel Connection Failures', 2, 1, 3, 'Lateral Movement', 'T1021 - Remote Services', 'Detects multiple VPN tunnel connection failures which could indicate connection issues, authentication problems, or potential unauthorized access attempts. This rule monitors for VPN tunnel down events, disconnections, and error messages that may signal connectivity problems or security incidents.

Next Steps:
1. Review the VPN tunnel logs to identify the specific error messages and failure reasons
2. Check if the failures are from legitimate users experiencing connectivity issues
3. Verify VPN tunnel configuration and ensure certificates/keys are valid
4. Look for patterns in the source IPs - are failures coming from specific geographic regions?
5. Check authentication logs for any concurrent failed login attempts
6. Review firewall policies to ensure VPN traffic is properly allowed
7. If unauthorized access is suspected, consider blocking the source IP temporarily
', '["https://docs.fortinet.com/document/fortigate/7.4.1/administration-guide/762116/ipsec-vpn","https://attack.mitre.org/techniques/T1021/"]', 'safe("log.type", "") == "event" && safe("log.subtype", "") == "vpn" && (safe("action", "") == "tunnel-down" || safe("action", "") == "tunnel-disconnect" || safe("log.msg", "").contains("fail") || safe("log.msg", "").contains("error") || safe("log.status", "") == "negotiate_error") && safe("origin.ip", "") != ""', '2025-09-03 15:13:24.747483', true, false, 'origin', '["origin.ip","log.tunnelid"]', '[{"indexPattern":"v11-log-fortinet-fortigate-*","with":[{"field":"origin.ip.keyword","operator":"filter_term","value":"{{.origin.ip}}"},{"field":"log.type.keyword","operator":"filter_term","value":"event"},{"field":"log.subtype.keyword","operator":"filter_term","value":"vpn"}],"or":null,"within":"now-1h","count":10}]');
INSERT INTO public.utm_correlation_rules VALUES (1254, 'BloodHound Reconnaissance Activity', 3, 2, 1, 'Discovery', 'T1087 - Account Discovery', 'Detects potential BloodHound Active Directory reconnaissance tool usage through LDAP queries, characteristic patterns, and AD enumeration activities. BloodHound is commonly used by attackers to map Active Directory relationships and identify privilege escalation paths.

Next Steps:
1. Investigate the source host and user account involved in the activity
2. Review network logs for LDAP queries to domain controllers around the same timeframe
3. Check for other reconnaissance tools or suspicious PowerShell activity on the same host
4. Examine Active Directory audit logs for unusual object access patterns
5. Verify if the user account has legitimate reasons for AD enumeration activities
6. Look for signs of lateral movement or privilege escalation following this reconnaissance
7. Consider isolating the affected host if malicious activity is confirmed
', '["https://attack.mitre.org/techniques/T1087/","https://bloodhound.readthedocs.io/","https://docs.microsoft.com/en-us/windows/security/threat-protection/auditing/event-4662"]', '((safe("log.eventCode", 0.0) == double(4688) || safe("log.eventCode", 0.0) == double(4688)) &&
  (safe("log.winlogEventDataNewProcessName", "").matches("(?i)bloodhound") ||
    safe("log.winlogEventDataNewProcessName", "").matches("(?i)sharphound") ||
    safe("log.winlogEventDataCommandLine", "").matches("(?i)(bloodhound|sharphound)") ||
    safe("log.winlogEventDataCommandLine", "").matches("(?i)--CollectionMethod\\s+(All|Session|LoggedOn)") ||
    safe("log.winlogEventDataCommandLine", "").matches("(?i)(DCOnly|ComputerOnly|LocalGroup)"))) ||
((safe("log.eventCode", 0.0) == double(4104) || safe("log.eventCode", 0.0) == double(4104)) &&
  safe("log.winlogProviderName", "") == "Microsoft-Windows-PowerShell" &&
  (safe("log.winlogEventDataScriptBlockText", "").matches("(?i)invoke-bloodhound") ||
    safe("log.winlogEventDataScriptBlockText", "").contains("Get-BloodHoundData") ||
    safe("log.winlogEventDataScriptBlockText", "").contains("Get-NetSession") ||
    safe("log.winlogEventDataScriptBlockText", "").contains("Get-NetLoggedOn") ||
    safe("log.winlogEventDataScriptBlockText", "").contains("Get-DomainTrust"))) ||
(safe("log.eventCode", 0.0) == double(4662) &&
  safe("log.winlogEventDataObjectType", "").matches("(?i)(bf967aba-0de6-11d0-a285-00aa003049e2|bf967a9c-0de6-11d0-a285-00aa003049e2)") &&
  safe("log.winlogEventDataAccessMask", "").matches("(0x100|0x10000)")) ||
(safe("log.eventCode", 0.0) == double(5156) &&
  safe("log.winlogEventDataDestinationPort", "") == "389" &&
  safe("log.winlogEventDataDirection", "") == "%%14592")
', '2025-09-04 19:28:21.923352', true, false, 'origin', '["origin.host","log.winlogEventDataSubjectUserName"]', '[]');
INSERT INTO public.utm_correlation_rules VALUES (1347, 'Windows: Microsoft IIS Connection Strings Decryption', 2, 3, 1, 'Credential Access', 'OS Credential Dumping', 'Identifies use of aspnet_regiis to decrypt Microsoft IIS connection strings. An attacker with Microsoft IIS web server access via a webshell or alike can decrypt and dump any hardcoded connection strings, such as the MSSQL service account password using aspnet_regiis command.', '["https://attack.mitre.org/tactics/TA0006/","https://attack.mitre.org/techniques/T1003/"]', 'safe("log.winlogEventDataProcessName", "").matches(''aspnet_regiis.exe'') && safe("log.message", "").matches(''(connectionStrings)'') && safe("log.message", "").matches(''(-pdf)'')', '2025-09-04 20:24:34.911861', true, false, 'origin', NULL, '[]');
INSERT INTO public.utm_correlation_rules VALUES (437, 'Network Access Control Policy Violation', 3, 3, 2, 'Defense Evasion, Persistence, Privilege Escalation, Initial Access', 'T1078 - Valid Accounts', 'Detects violations of Network Access Control (NAC) policies including unauthorized device access, authentication failures, or attempts to access restricted network segments. This may indicate rogue devices or compromised credentials.

Next Steps:
1. Identify the device attempting access using the MAC address and IP address from the alert
2. Check if the device is known to the organization and should have access
3. Review the NAC policy that was violated to understand what restrictions were breached
4. Investigate if the MAC address shows signs of spoofing by comparing with known device records
5. Check for any successful authentications from the same device before/after the violation
6. If the device is unauthorized, locate and remove it from the network
7. If legitimate, review and update NAC policies or device authentication credentials
8. Monitor for additional attempts from the same MAC/IP combination
', '["https://www.fortinet.com/resources/cyberglossary/what-is-network-access-control","https://attack.mitre.org/techniques/T1078/","https://attack.mitre.org/techniques/T1133/"]', '( safe("log.subtype", "") == "nac" || safe("log.type", "") == "nac" || safe("log.service", "") == "802.1x" || safe("log.id", "") in ["0102048000", "0102048001", "0102048002", "0102048003"] ) && ( safe("log.msg", "").contains("nac violation") || safe("log.msg", "").contains("unauthorized device") || safe("log.msg", "").contains("authentication failed") || safe("log.msg", "").contains("access denied") || safe("log.msg", "").contains("rogue device") || safe("log.msg", "").contains("mac spoofing") || safe("log.msg", "").contains("vlan violation") || safe("log.authstatus", "") == "failed" || safe("log.nacstatus", "") in ["denied", "quarantine", "violation"] ) && safe("action", "") in ["deny", "block", "quarantine"]', '2025-09-03 15:13:21.026762', true, false, 'origin', '["origin.ip","origin.mac"]', '[]');
INSERT INTO public.utm_correlation_rules VALUES (438, 'FortiSandbox Malicious File Detection', 3, 3, 2, 'Execution', 'T1204 - User Execution', 'Detects when FortiSandbox identifies a file as malicious based on behavioral analysis and static scanning. This indicates active malware attempting to infiltrate the network through file transfers or downloads.

Next Steps:
- Immediately isolate the source IP address and affected systems
- Identify the file hash and search for other instances across the network
- Review network traffic from the source IP for additional suspicious activity
- Check if the malicious file was successfully blocked or if remediation is needed
- Update endpoint protection signatures with the identified file hash
- Investigate the user account associated with the file download/transfer
- Document the incident and notify the security team for further analysis
', '["https://docs.fortinet.com/document/fortisandbox/4.4.0/administration-guide/274898/how-files-determined-to-be-suspicious-low-medium-or-high","https://attack.mitre.org/techniques/T1204/"]', '(safe("log.subtype", "") == "sandbox" && safe("log.verdict", "") == "malicious") ||
(safe("log.msg", "").contains("sandbox verdict: malicious")) ||
(safe("log.risk", "") == "high" && safe("log.subtype", "") == "sandbox") ||
(safe("log.msg", "").contains("FortiSandbox detected malware")) ||
(safe("log.msg", "").contains("verdict=malicious")) ||
(safe("log.msg", "").contains("subtype=sandbox") && safe("log.msg", "").contains("malicious"))
', '2025-09-03 15:13:21.848219', true, false, 'origin', '["origin.ip","log.filehash"]', '[]');
INSERT INTO public.utm_correlation_rules VALUES (445, 'FortiWeb Cookie Security Violation Detected', 3, 3, 1, 'Credential Access', 'T1539 - Steal Web Session Cookie', 'Detects cookie security violations including cookie poisoning, cookie tampering, missing security attributes, and unauthorized cookie manipulation attempts on FortiWeb protected applications. These attacks may indicate attempts to hijack user sessions, bypass authentication, or perform cross-site scripting attacks.

Next Steps:
1. Review the source IP address for previous malicious activity
2. Check if the affected application has proper cookie security settings (HttpOnly, Secure, SameSite attributes)
3. Verify if the cookie manipulation attempt was successful by reviewing subsequent logs from the same source
4. Consider blocking the source IP if multiple cookie security violations are detected
5. Review FortiWeb security policies to ensure cookie protection features are properly configured
6. Check for any successful authentication or data access following the cookie manipulation attempt
', '["https://docs.fortinet.com/document/fortiweb/7.2.2/log-message-reference/252057/event","https://help.fortinet.com/fweb/583/Content/FortiWeb/fortiweb-admin/cookie_security.htm","https://attack.mitre.org/techniques/T1539/"]', 'safe("origin.ip", "") != "" && ( safe("log.msg", "").contains("cookie") || safe("log.msg", "").contains("Cookie") || safe("log.msg", "").contains("poisoning") || safe("log.msg", "").contains("tampering") || safe("log.msg", "").contains("cookie-security") ) && safe("action", "") in ["deny", "alert", "block"]', '2025-09-03 15:14:12.846298', true, false, 'origin', '["origin.ip"]', '[]');
INSERT INTO public.utm_correlation_rules VALUES (446, 'FortiWeb CSRF Protection Triggered', 3, 3, 1, 'Command and Control', 'T1071.001 - Application Layer Protocol: Web Protocols', 'Detects when FortiWeb CSRF protection is triggered, indicating potential cross-site request forgery attempts. CSRF attacks exploit the trust that a site has in a user''s browser to transmit unauthorized commands.

Next Steps:
1. Review the source IP address to determine if it''s a known attacker or compromised system
2. Check if the target application has proper CSRF tokens implemented
3. Analyze the specific request that triggered the protection to understand the attack vector
4. Review other security events from the same source IP for pattern analysis
5. Consider blocking the source IP if multiple CSRF attempts are detected
6. Verify that legitimate users aren''t being incorrectly flagged
7. Check the FortiWeb policy configuration to ensure CSRF protection is properly tuned
', '["https://help.fortinet.com/fweb/583/Content/FortiWeb/fortiweb-admin/csrf_attacks.htm","https://attack.mitre.org/techniques/T1071/001/"]', '(safe("log.message", "").contains("CSRF") || safe("log.message", "").contains("cross-site request forgery") || safe("log.message", "").contains("Cross Site Request Forgery")) && safe("origin.ip", "") != ""', '2025-09-03 15:14:14.169051', true, false, 'origin', NULL, '[]');
INSERT INTO public.utm_correlation_rules VALUES (447, 'FortiWeb Custom Signature Matches Detection', 3, 3, 2, 'Initial Access', 'Custom Rule Violation', 'Detects when FortiWeb custom signatures are matched, indicating potential attacks against web applications using organization-specific detection rules. Custom signatures are typically created to detect application-specific vulnerabilities or attack patterns not covered by default signatures.

Next Steps:
1. Review the specific custom signature that was triggered and its purpose
2. Examine the source IP address for reputation and previous malicious activity
3. Check the targeted URL/application for any signs of compromise
4. Review WAF logs for other attack attempts from the same source
5. Consider blocking the source IP if multiple high-severity signatures are triggered
6. Validate that the custom signature is not causing false positives
7. Correlate with network traffic patterns to identify potential attack campaigns
8. Check if the signature matches are part of a coordinated attack across multiple applications
', '["https://docs.fortinet.com/document/fortiweb/7.2.2/log-message-reference/445549/attack","https://attack.mitre.org/techniques/T1190/"]', 'safe("log.msg", "").contains("attack") && safe("log.msg", "").contains("signature") && safe("log.priority", "").in(["critical", "high"]) && safe("origin.ip", "") != ""', '2025-09-03 15:14:15.218964', true, false, 'origin', NULL, '[]');
INSERT INTO public.utm_correlation_rules VALUES (449, 'FortiWeb File Upload Security Violation Detected', 3, 3, 2, 'Resource Development', 'T1608 - Stage Capabilities: Upload Malware', 'Detects file upload security violations including malicious file uploads, oversized files, restricted file types, and potential web shell upload attempts on FortiWeb protected applications. These violations could indicate attempts to upload malicious files, web shells, or bypass upload restrictions.

Next Steps:
1. Review the blocked file upload attempt details, including file name, type, and size
2. Check if the source IP has made multiple file upload attempts in a short period
3. Examine the web application logs for the specific URL path being targeted
4. Verify if the file upload restriction policy is appropriate for the application
5. If malicious activity is confirmed, consider blocking the source IP temporarily
6. Review other requests from the same source IP for reconnaissance patterns
7. Check if similar file upload attempts have been made to other applications
', '["https://docs.fortinet.com/document/fortiweb/7.2.2/log-message-reference/252057/event","https://attack.mitre.org/techniques/T1608/","https://attack.mitre.org/techniques/T1505/003/"]', 'safe("origin.ip", "") != "" && ( safe("log.msg", "").contains("file upload") || safe("log.msg", "").contains("File upload") || safe("log.msg", "").contains("malicious file") || safe("log.msg", "").contains("file type") || safe("log.msg", "").contains("file size") || safe("log.msg", "").contains("anti-virus") || safe("log.msg", "").contains("upload violation") || safe("log.msg", "").contains("upload blocked") )', '2025-09-03 15:14:16.785404', true, false, 'origin', '["origin.ip"]', '[]');
INSERT INTO public.utm_correlation_rules VALUES (450, 'FortiWeb Geo-blocking Policy Violation', 2, 1, 2, 'Defense Evasion, Persistence, Privilege Escalation, Initial Access', 'T1078 - Valid Accounts', 'Detects when FortiWeb geo-blocking policies block access attempts from restricted geographical locations. This could indicate unauthorized access attempts from forbidden regions or potential evasion techniques using VPNs or proxies to bypass geographic restrictions.

Next Steps:
1. Review the blocked country to verify if it matches your geo-blocking policy
2. Check if this is a legitimate user attempting to access from a restricted location (e.g., employee traveling)
3. Investigate the source IP for known VPN or proxy services
4. Look for patterns of repeated attempts from the same country or IP range
5. Verify if the blocked requests targeted sensitive resources or admin interfaces
6. Consider updating geo-blocking policies if legitimate business needs are being impacted
', '["https://docs.fortinet.com/document/fortiweb/7.6.0/administration-guide","https://attack.mitre.org/techniques/T1078/"]', '(safe("log.type", "") == "attack" || safe("log.type", "") == "traffic") && (contains(safe("log.msg", ""), "geo block") || contains(safe("log.msg", ""), "geo-block") || contains(safe("log.msg", ""), "geographic") || contains(safe("log.msg", ""), "country block") || safe("log.subtype", "") == "geo_block") && safe("action", "") == "blocked" && safe("origin.ip", "") != "" && safe("origin.geolocation.country", "") != ""', '2025-09-03 15:14:17.367645', true, false, 'origin', '["origin.geolocation.country","target.ip"]', '[]');
INSERT INTO public.utm_correlation_rules VALUES (451, 'FortiWeb HTTP Header Injection Attempts', 2, 3, 1, 'Initial Access', 'T1190 - Exploit Public-Facing Application', 'Detects HTTP header injection attempts including CRLF injection, header smuggling, and other header manipulation attacks that could lead to cache poisoning, session hijacking, or response splitting attacks.

Next Steps:
1. Review the source IP address for reputation and previous malicious activity
2. Examine the full HTTP request to understand the injection payload
3. Check if the attack was successful by reviewing application logs
4. Verify that the FortiWeb protection policy is configured correctly
5. Consider blocking the source IP if multiple injection attempts are detected
6. Review all requests from this IP for other attack patterns
7. Ensure web application is patched against header injection vulnerabilities
', '["https://docs.fortinet.com/document/fortiweb/7.2.2/log-message-reference/445549/attack","https://attack.mitre.org/techniques/T1190/","https://owasp.org/www-community/attacks/HTTP_Response_Splitting"]', 'safe("log.type", "") == "attack" && (safe("log.subtype", "") in ["header_injection", "http_header_injection", "crlf_injection"] || safe("log.msg", "").contains("header injection") || safe("log.msg", "").contains("CRLF injection") || safe("log.msg", "").contains("\\r\\n") || safe("log.msg", "").contains("%0d%0a") || safe("log.msg", "").contains("%0D%0A")) && safe("action", "") in ["Alert", "Block", "Deny"] && safe("origin.ip", "") != ""', '2025-09-03 15:14:18.185867', true, false, 'origin', NULL, '[]');
INSERT INTO public.utm_correlation_rules VALUES (452, 'FortiWeb ML Anomaly Detection Alert', 3, 3, 2, 'Command and Control', 'T1071 - Application Layer Protocol', 'Detects when FortiWeb''s machine learning anomaly detection system identifies abnormal behavior patterns. The system uses HMM models to monitor URLs, parameters, and HTTP methods to detect deviations from normal traffic patterns that may indicate zero-day attacks or advanced threats.

Next Steps:
1. Review the source IP reputation and check if it''s associated with known malicious activity
2. Analyze the specific anomaly patterns detected - examine URLs, parameters, and HTTP methods flagged
3. Check for other security events from the same source IP across different systems
4. Review the target application logs for any signs of exploitation or unusual behavior
5. Consider temporarily blocking the source IP if multiple anomalies are detected
6. Investigate whether this represents a legitimate user with unusual behavior or a potential attack
', '["https://docs.fortinet.com/document/fortiweb/7.6.0/administration-guide/94907/ml-based-anomaly-detection","https://docs.fortinet.com/document/fortiweb/6.3.7/administration-guide/865612/viewing-anomaly-detection-log","https://attack.mitre.org/techniques/T1071/"]', 'safe("log.type", "") == "attack" && (safe("log.msg", "").contains("anomaly") || safe("log.msg", "").contains("ML detect") || safe("log.msg", "").contains("machine learning") || safe("log.subtype", "") == "anomaly_detection" || safe("log.subtype", "") == "ml_detection") && safe("origin.ip", "") != ""', '2025-09-03 15:15:17.146404', true, false, 'origin', '["origin.ip","target.ip"]', '[]');
INSERT INTO public.utm_correlation_rules VALUES (453, 'FortiWeb OWASP Top 10 Violation Attempts', 3, 3, 2, 'Initial Access', 'T1190 - Exploit Public-Facing Application', 'Detects attempts to exploit OWASP Top 10 vulnerabilities including injection flaws, broken authentication, sensitive data exposure, XXE, broken access control, security misconfiguration, and more. This rule triggers when FortiWeb blocks or alerts on attack attempts that match known OWASP Top 10 vulnerability patterns.

Next Steps:
1. Review the blocked request details in FortiWeb logs to understand the attack vector
2. Check if the source IP has attempted multiple different attack types
3. Verify if the targeted application has any known vulnerabilities
4. Consider blocking the source IP if attacks persist
5. Review application security headers and WAF rules for the targeted resource
6. Check for any successful requests from the same source IP before the block
7. Analyze the specific OWASP category and implement additional protections
8. Review application code for the detected vulnerability type
', '["https://docs.fortinet.com/document/fortiweb-cloud/23.3.0/user-guide/552829/known-attacks","https://owasp.org/www-project-top-ten/","https://attack.mitre.org/techniques/T1190/"]', 'safe("action", "") in ["deny", "alert_deny", "block", "blocked"] && ( safe("log.msg", "").toLower().contains("injection") || safe("log.msg", "").toLower().contains("traversal") || safe("log.msg", "").toLower().contains("xxe") || safe("log.msg", "").toLower().contains("xml external entity") || safe("log.msg", "").toLower().contains("broken auth") || safe("log.msg", "").toLower().contains("sensitive data") || safe("log.msg", "").toLower().contains("security misconfig") || safe("log.msg", "").toLower().contains("owasp") || safe("log.msg", "").toLower().contains("sqli") || safe("log.msg", "").toLower().contains("xss") || safe("log.msg", "").toLower().contains("csrf") || safe("log.msg", "").toLower().contains("command injection") || safe("log.msg", "").toLower().contains("path traversal") || safe("log.msg", "").toLower().contains("lfi") || safe("log.msg", "").toLower().contains("rfi") || safe("log.msg", "").toLower().contains("deserialization") )', '2025-09-03 15:15:17.890078', true, false, 'origin', NULL, '[]');
INSERT INTO public.utm_correlation_rules VALUES (454, 'FortiWeb Protocol Validation Failures', 2, 3, 2, 'Impact', 'Protocol Manipulation', 'Detects protocol validation failures in FortiWeb, indicating attempts to bypass security controls through malformed or non-compliant HTTP/HTTPS requests. These attacks may attempt to exploit vulnerabilities in web applications or the FortiWeb itself through protocol manipulation.

Next Steps:
1. Review the specific protocol violation details in the alert to understand the attack vector
2. Check if the source IP has a history of malicious activity or is from a suspicious location
3. Analyze web server logs for any successful requests from the same source
4. Verify that FortiWeb security policies are properly configured to block protocol violations
5. Consider blocking the source IP if multiple violations are detected
6. Review application logs for any signs of successful exploitation
', '["https://docs.fortinet.com/document/fortiweb/7.2.2/log-message-reference/252057/event","https://attack.mitre.org/techniques/T1499/"]', 'safe("log.type", "") == "attack" && (safe("log.subtype", "") in ["http_protocol_validation", "protocol_constraint_violation"] || safe("log.msg", "").contains("protocol violation") || safe("log.msg", "").contains("invalid HTTP") || safe("log.msg", "").contains("malformed request")) && safe("action", "") in ["Alert", "Block", "Deny"] && safe("origin.ip", "") != ""', '2025-09-03 15:15:18.685325', true, false, 'origin', '["origin.ip","target.port"]', '[]');
INSERT INTO public.utm_correlation_rules VALUES (455, 'FortiWeb Rate Limiting Violation', 1, 2, 3, 'Impact', 'T1499 - Endpoint Denial of Service', 'Detects when FortiWeb rate limiting policies are violated, indicating potential DoS attempts or abusive behavior. Rate limiting helps protect against resource exhaustion and ensures fair usage of web applications.

Next Steps:
1. Review the source IP address and determine if it''s a legitimate user or potential attacker
2. Check FortiWeb logs for the specific rate limit policy that was triggered
3. Analyze the pattern of requests to identify if this is automated behavior
4. Consider temporarily blocking the source IP if the behavior continues
5. Review and adjust rate limiting thresholds if false positives occur frequently
6. Check for any performance impact on the protected web applications
7. Correlate with other security events from the same source IP
8. Check if the rate limiting is part of a larger attack campaign
', '["https://docs.fortinet.com/document/fortiweb/7.6.0/administration-guide","https://attack.mitre.org/techniques/T1499/"]', '(safe("log.msg", "").contains("rate limit") || safe("log.msg", "").contains("rate-limit") || safe("log.msg", "").contains("exceeded rate") || safe("log.msg", "").contains("rate_limit")) && safe("origin.ip", "") != ""', '2025-09-03 15:15:19.805819', true, false, 'origin', '["origin.ip"]', '[]');
INSERT INTO public.utm_correlation_rules VALUES (456, 'FortiWeb HTTP Response Splitting Attempts', 3, 3, 1, 'Initial Access', 'HTTP Response Splitting', 'Detects HTTP response splitting attempts that could allow attackers to inject arbitrary HTTP responses, potentially leading to XSS, cache poisoning, or phishing attacks. Response splitting exploits vulnerabilities where user input is reflected in HTTP headers without proper sanitization, allowing attackers to inject CRLF sequences to manipulate HTTP responses.

Next Steps:
1. Immediately block the source IP if not already blocked
2. Review the attack payload in log.msg to understand the injection attempt
3. Check if the targeted application is vulnerable by reviewing its input validation
4. Search for other requests from the same source IP to identify attack patterns
5. Verify that FortiWeb''s response splitting protection is properly configured
6. Review application logs for any successful exploitation attempts
7. Consider implementing additional input validation at the application level
8. Document the incident and update security policies if needed
', '["https://docs.fortinet.com/document/fortiweb/7.2.2/log-message-reference/445549/attack","https://attack.mitre.org/techniques/T1190/","https://owasp.org/www-community/attacks/HTTP_Response_Splitting"]', 'safe("log.type", "") == "attack" && (safe("log.subtype", "") in ["response_splitting", "http_response_splitting"] || safe("log.msg", "").contains("response splitting") || safe("log.msg", "").contains("HTTP/1.1") && safe("log.msg", "").contains("\\r\\n") || safe("log.msg", "").contains("%0d%0a%0d%0a") || safe("log.msg", "").contains("Content-Length:") && safe("log.msg", "").contains("\\r\\n") || safe("log.msg", "").contains("Set-Cookie:") && safe("log.msg", "").contains("\\r\\n")) && safe("action", "") in ["Alert", "Block", "Deny"] && safe("origin.ip", "") != ""', '2025-09-03 15:15:20.669877', true, false, 'origin', '["adversary.ip","log.policy"]', '[]');
INSERT INTO public.utm_correlation_rules VALUES (457, 'FortiWeb Session Management Attack Detected', 3, 3, 2, 'Defense Evasion, Lateral Movement', 'T1550.004 - Use Alternate Authentication Material: Web Session Cookie', 'Detects session management attacks including session hijacking, session fixation, and unauthorized session manipulation attempts on FortiWeb protected applications. These attacks attempt to compromise user sessions to gain unauthorized access.

Next Steps:
1. Review the source IP address and check for other suspicious activities from the same origin
2. Examine the specific attack patterns in the log messages to understand the attack vector
3. Check if the attacker successfully compromised any sessions by reviewing subsequent authentication logs
4. Consider blocking the source IP if multiple attempts are detected
5. Review and strengthen session management configurations in FortiWeb
6. Notify the application owner and security team about the potential session attack
', '["https://docs.fortinet.com/document/fortiweb/7.2.2/log-message-reference/252057/event","https://attack.mitre.org/techniques/T1550/004/"]', 'safe("origin.ip", "") != "" && safe("log.msg", "") != "" && ( safe("log.msg", "").contains("session") || safe("log.msg", "").contains("Session") || safe("log.msg", "").contains("cookie") || safe("log.msg", "").contains("Cookie") || safe("log.msg", "").contains("JSESSIONID") || safe("log.msg", "").contains("hijack") || safe("log.msg", "").contains("fixation") ) && safe("action", "") in ["deny", "alert", "block"]', '2025-09-03 15:15:21.545562', true, false, 'origin', NULL, '[]');
INSERT INTO public.utm_correlation_rules VALUES (458, 'FortiWeb Web Application Attack Detection', 3, 3, 2, 'Initial Access', 'T1190 - Exploit Public-Facing Application', 'Detects SQL injection, XSS, and other web application attacks blocked by FortiWeb WAF based on signature or syntax-based detection. These attacks attempt to exploit vulnerabilities in web applications to gain unauthorized access, steal data, or compromise application integrity.

Next Steps:
1. Review the specific attack type and payload in the FortiWeb logs
2. Check if the source IP has a history of malicious activity
3. Verify if the targeted application has known vulnerabilities
4. Review application logs for any successful exploitation attempts
5. Consider blocking the source IP if attacks persist
6. Ensure WAF rules are up-to-date and properly configured
7. Implement additional application-level security controls if needed
8. Check for any bypass attempts or evasion techniques being used
', '["https://docs.fortinet.com/document/fortiweb/7.6.0/administration-guide/981691/syntax-based-sql-xss-injection-detection","https://attack.mitre.org/techniques/T1190/"]', 'safe("action", "") == "deny" && ( safe("log.type", "") == "attack" || safe("log.subtype", "") == "waf" || safe("log.attack_type", "") in ["SQL Injection", "Cross Site Scripting", "XSS", "SQLi"] || safe("log.message", "").contains("sql injection") || safe("log.message", "").contains("SQL injection") || safe("log.message", "").contains("cross site scripting") || safe("log.message", "").contains("Cross Site Scripting") || safe("log.message", "").contains("xss") || safe("log.message", "").contains("XSS") || safe("log.message", "").contains("sqli") || safe("log.message", "").contains("SQLi") || safe("log.main_type", "") == "SQL/XSS Syntax Based Detection" )', '2025-09-03 15:15:22.087649', true, false, 'origin', NULL, '[]');
INSERT INTO public.utm_correlation_rules VALUES (459, 'FortiWeb XML/JSON Attack Attempt Detected', 3, 3, 2, 'Execution', 'T1059 - Command and Scripting Interpreter', 'Detects XML and JSON based attacks including XXE injection, JSON injection, malformed data structures, and parser exploitation attempts on FortiWeb protected applications.

Next Steps:
1. Review the attack payload in FortiWeb logs to understand the specific attack vector
2. Check if the attack was successfully blocked or if any requests bypassed the WAF
3. Identify the targeted application and verify its XML/JSON parsing configuration
4. Review application logs for any signs of successful exploitation
5. Consider blocking the source IP if multiple attacks are detected
6. Update WAF signatures and security policies if new attack patterns are identified
', '["https://docs.fortinet.com/document/fortiweb/7.2.2/log-message-reference/252057/event","https://attack.mitre.org/techniques/T1059/","https://attack.mitre.org/techniques/T1027/"]', 'safe("origin.ip", "") != "" && safe("log.type", "") == "attack" && (safe("log.msg", "").contains("XML") || safe("log.msg", "").contains("JSON") || safe("log.msg", "").contains("XXE") || safe("log.msg", "").contains("parser") || safe("log.msg", "").contains("malformed") || safe("log.attack_type", "").in(["xml_injection", "json_injection", "xxe_attack"]) || safe("log.trigger_policy", "").contains("xml") || safe("log.trigger_policy", "").contains("json") || safe("log.subtype", "") == "signature-detection") && safe("action", "") in ["deny", "alert", "block"]', '2025-09-03 15:15:23.42332', true, false, 'origin', '["origin.ip","target.ip"]', '[]');
INSERT INTO public.utm_correlation_rules VALUES (938, 'System Linux: Possible Brute Force Attack', 2, 2, 3, 'Credential Access', 'Brute Force', 'Identifies multiple SSH login failures followed by a successful one from the same source address. Adversaries can attempt to login into multiple users with a common or known password to gain access to accounts.', '["https://attack.mitre.org/tactics/TA0006/","https://attack.mitre.org/techniques/T1110/"]', 'safe("action", "") == ''system.auth'' && safe("log.message", "").matches("([Ss]ession opened)")', '2025-09-03 16:36:54.309236', true, false, 'origin', NULL, '[{"indexPattern":"v11-log-linux-*","with":[{"field":"origin.user.keyword","operator":"filter_term","value":"{{.origin.user}}"},{"field":"log.hostId.keyword","operator":"filter_term","value":"{{.log.hostId}}"},{"field":"log.message","operator":"filter_match","value":"Failed password"}],"or":[{"indexPattern":"v11-log-linux-*","with":[{"field":"origin.user.keyword","operator":"filter_term","value":"{{.origin.user}}"},{"field":"log.hostId.keyword","operator":"filter_term","value":"{{.log.hostId}}"},{"field":"log.message","operator":"filter_match","value":"authentication failure"}],"or":null,"within":"now-5m","count":5}],"within":"now-5m","count":5}]');
INSERT INTO public.utm_correlation_rules VALUES (460, 'Zero-Day Attack Pattern Detection', 3, 3, 2, 'Initial Access', 'T1190 - Exploit Public-Facing Application', 'Detects potential zero-day attack patterns through anomalous behavior, unknown attack signatures, and suspicious payload characteristics that deviate from normal web traffic patterns in FortiWeb logs.

Next Steps:
1. Investigate the source IP address to determine if it''s a known malicious actor
2. Review the specific attack patterns and payloads in the log messages
3. Check if similar attack patterns have been observed from other source IPs
4. Analyze the targeted application or URL path for vulnerabilities
5. Consider implementing temporary IP blocking if attack persists
6. Review FortiWeb signature updates and consider custom signatures for repeated patterns
7. Correlate with other security events from the same time period
', '["https://docs.fortinet.com/document/fortiweb/7.2.2/log-message-reference/252057/event","https://attack.mitre.org/techniques/T1190/"]', 'safe("origin.ip", "") != "" && ( safe("log.msg", "").contains("unknown") || safe("log.msg", "").contains("anomaly") || safe("log.msg", "").contains("suspicious") || safe("log.msg", "").contains("0day") || safe("log.msg", "").contains("zero-day") || safe("log.msg", "").contains("exploit") || safe("log.msg", "").contains("payload") || safe("log.msg", "").contains("attack") )', '2025-09-03 15:15:24.146327', true, false, 'origin', NULL, '[]');
INSERT INTO public.utm_correlation_rules VALUES (466, 'Escape Sequence Abuse', 2, 3, 1, 'Defense Evasion', 'T1027.003 - Obfuscated Files or Information: Steganography', 'Detects abuse of escape sequences in logs that could be used to bypass security controls, manipulate log output, or execute command injection. This includes various escape characters and encoding patterns commonly used in attacks.

Next Steps:
1. Review the log message content to identify the specific escape sequences being used
2. Check if the source IP (if available) has attempted similar patterns recently
3. Determine if this is part of a larger attack pattern (SQL injection, command injection, XSS)
4. Investigate the application or service generating these logs for potential vulnerabilities
5. Review application input validation and encoding practices
6. Consider implementing input sanitization for the affected application
7. Analyze the application logs for additional indicators of compromise
8. Review security controls and WAF rules to prevent similar attacks
', '["https://owasp.org/www-community/attacks/Log_Injection","https://cheatsheetseries.owasp.org/cheatsheets/Logging_Cheat_Sheet.html","https://attack.mitre.org/techniques/T1027/003/"]', 'safe("log.message", "") != "" && ( safe("log.message", "").contains("\\x00") || safe("log.message", "").contains("\\x0a") || safe("log.message", "").contains("\\x0d") || safe("log.message", "").contains("\\x1a") || safe("log.message", "").contains("\\x1b") || safe("log.message", "").contains("\\x7f") || safe("log.message", "").contains("\\u0000") || safe("log.message", "").contains("\\u000a") || safe("log.message", "").contains("\\u000d") || safe("log.message", "").contains("%00") || safe("log.message", "").contains("%0a") || safe("log.message", "").contains("%0d") || safe("log.message", "").contains("%0A") || safe("log.message", "").contains("%0D") || safe("log.message", "").contains("&#x0a;") || safe("log.message", "").contains("&#x0d;") || safe("log.message", "").contains("&#10;") || safe("log.message", "").contains("&#13;") || safe("log.message", "").matches(".*\\\\[btnfr].*\\\\[btnfr].*") || safe("log.message", "").matches(".*\\\\x[0-9a-fA-F]{2}.*\\\\x[0-9a-fA-F]{2}.*") || safe("log.message", "").matches(".*\\\\u[0-9a-fA-F]{4}.*\\\\u[0-9a-fA-F]{4}.*") || safe("log.message", "").matches(".*%[0-9a-fA-F]{2}.*%[0-9a-fA-F]{2}.*%[0-9a-fA-F]{2}.*") )', '2025-09-03 15:20:53.424921', true, false, 'origin', NULL, '[]');
INSERT INTO public.utm_correlation_rules VALUES (467, 'Input Validation Failures Detection', 2, 3, 2, 'Execution', 'T1059 - Command and Scripting Interpreter', 'Detects events indicating input validation failures, which could indicate attempts to inject malicious data or bypass security controls. These failures may be signs of SQL injection, command injection, or other input-based attacks.

Next Steps:
1. Review the source IP address and check if it''s associated with known malicious activity
2. Examine the specific validation errors to understand what type of input was rejected
3. Check application logs for the full context of the validation failure
4. Look for patterns in the failed validation attempts (e.g., SQL keywords, script tags, command characters)
5. Verify if the same source has successful requests before/after the failures
6. Consider blocking the source IP if malicious intent is confirmed
7. Review application input validation mechanisms for potential bypasses
8. Correlate with WAF logs if available to understand attack vectors
', '["https://owasp.org/www-community/attacks/Input_Validation_Attacks","https://attack.mitre.org/techniques/T1059/"]', 'safe("log.message", "") != "" && ( safe("log.message", "").contains("validation failed") || safe("log.message", "").contains("invalid input") || safe("log.message", "").contains("validation error") || safe("log.message", "").contains("input rejected") || safe("log.message", "").contains("format error") || safe("log.message", "").contains("illegal character") || safe("log.message", "").contains("malformed request") || safe("log.message", "").contains("parameter validation") || safe("log.message", "").contains("input sanitization") || safe("log.message", "").contains("injection attempt") )', '2025-09-03 15:20:54.052252', true, false, 'origin', NULL, '[]');
INSERT INTO public.utm_correlation_rules VALUES (465, 'Encoding Detection Issues', 1, 3, 2, 'Command and Control', 'T1132 - Data Encoding', 'Detects encoding-related issues that could indicate data corruption, encoding attacks, or attempts to bypass security filters through encoding manipulation. These errors may suggest attempts to evade detection, exploit vulnerabilities, or corrupt data integrity.

Next Steps:
1. Review the specific encoding error messages to understand the nature of the issue
2. Check if the errors are coming from a specific source IP or application
3. Investigate if this is part of a larger pattern of suspicious activity
4. Verify if legitimate applications are misconfigured and causing encoding errors
5. Look for correlating events such as injection attempts or data exfiltration
6. Check system logs for any file corruption or data integrity issues
', '["https://owasp.org/www-community/attacks/Unicode_Encoding","https://attack.mitre.org/techniques/T1132/"]', 'safe("log.message", "").contains("encoding error") || safe("log.message", "").contains("charset error") || safe("log.message", "").contains("decode error") || safe("log.message", "").contains("unicode error") || safe("log.message", "").contains("utf-8 error") || safe("log.message", "").contains("utf8 error") || safe("log.message", "").contains("invalid encoding") || safe("log.message", "").contains("character encoding") || safe("log.message", "").contains("encoding exception") || safe("log.message", "").contains("malformed unicode") || safe("log.message", "").contains("illegal character") || safe("log.message", "").contains("invalid byte sequence") || safe("log.message", "").contains("encoding mismatch")', '2025-09-03 15:20:52.817116', true, false, 'origin', '["origin.ip"]', '[]');
INSERT INTO public.utm_correlation_rules VALUES (476, 'Suspicious Configuration File Access', 3, 2, 1, 'Collection', 'T1005 - Data from Local System', 'Detects access attempts to sensitive configuration files that could expose server configuration, credentials, or other sensitive information. This includes attempts to access Apache configuration files, database configuration files, environment files, version control directories, and other sensitive system files.

Next Steps:
1. Review the accessed file path and determine if it contains sensitive information
2. Check if the request was successful (HTTP 200) and investigate the source IP
3. Examine user agent strings for automated tools or scanners
4. Review server logs for other suspicious activity from the same IP
5. Verify file permissions and consider restricting access to sensitive files
6. Monitor for subsequent requests that may indicate data exfiltration
7. Check web server access logs for patterns of directory traversal or enumeration
8. Validate that the requesting source has legitimate access to the configuration files
', '["https://attack.mitre.org/techniques/T1005/","https://httpd.apache.org/docs/2.4/configuring.html"]', 'safe("origin.path", "") != "" && ( safe("origin.path", "").contains(".conf") || safe("origin.path", "").contains(".config") || safe("origin.path", "").contains(".ini") || safe("origin.path", "").contains(".xml") || safe("origin.path", "").contains(".yml") || safe("origin.path", "").contains(".yaml") || safe("origin.path", "").contains(".env") || safe("origin.path", "").contains(".git/") || safe("origin.path", "").contains(".svn/") || safe("origin.path", "").contains("web.config") || safe("origin.path", "").contains("httpd.conf") || safe("origin.path", "").contains("apache2.conf") || safe("origin.path", "").contains("php.ini") || safe("origin.path", "").contains("wp-config.php") || safe("origin.path", "").contains("database.php") || safe("origin.path", "").contains("db.php") || safe("origin.path", "").contains("config.php") || safe("origin.path", "").contains("settings.php") || safe("origin.path", "").contains(".DS_Store") || safe("origin.path", "").contains("Thumbs.db") || safe("origin.path", "").contains(".bash_history") || safe("origin.path", "").contains("id_rsa") || safe("origin.path", "").contains(".ssh/") ) && safe("log.statusCode", 0) < 400', '2025-09-03 15:21:00.792268', true, false, 'origin', '["origin.ip","origin.path"]', '[]');
INSERT INTO public.utm_correlation_rules VALUES (461, 'Archive Extraction Failures', 2, 2, 3, 'Impact', 'T1565.001 - Data Manipulation: Stored Data Manipulation', 'Detects archive extraction failures that could indicate corrupted files, malicious archives (zip bombs), or system resource issues during archive processing. Multiple failures from the same source may indicate an attack attempt or systemic issues.

Next Steps:
1. Check system resource utilization (CPU, memory, disk space) for anomalies
2. Review the specific archive file(s) mentioned in the logs for signs of corruption or malicious content
3. Verify if the failures are isolated to specific sources or widespread
4. Look for patterns in file sizes or types that are failing
5. Check for zip bomb indicators (extremely high compression ratios)
6. Review system logs for any related security events or resource exhaustion
7. If malicious activity is suspected, isolate the affected systems and preserve evidence
', '["https://unix.stackexchange.com/questions/634315/unzip-thinks-my-zip-file-is-a-zip-bomb","https://docs.aws.amazon.com/codeguru/detector-library/python/zip-bomb-attack/","https://attack.mitre.org/techniques/T1565/001/"]', '(safe("log.message", "").contains("extraction failed")) ||
(safe("log.message", "").contains("archive corrupted")) ||
(safe("log.message", "").contains("invalid zip file")) ||
(safe("log.message", "").contains("decompression error")) ||
(safe("log.message", "").contains("unsupported compression")) ||
(safe("log.message", "").contains("CRC error")) ||
(safe("log.message", "").contains("unzip") && safe("log.message", "").contains("error")) ||
(safe("log.message", "").contains("tar: ") && safe("log.message", "").contains("error")) ||
(safe("log.message", "").contains("gzip: ") && safe("log.message", "").contains("error"))
', '2025-09-03 15:20:50.308985', true, false, 'origin', '["origin.host"]', '[{"indexPattern":"v11-log-generic-*","with":[{"field":"origin.host.keyword","operator":"filter_term","value":"{{.origin.host}}"}],"or":null,"within":"now-30m","count":5}]');
INSERT INTO public.utm_correlation_rules VALUES (462, 'Binary Data in Text Logs', 3, 3, 2, 'Data Anomaly', 'Binary Payload Injection', 'Detects presence of binary data or non-printable characters in text logs which could indicate encoding evasion, malware payloads, or attempts to corrupt log processing systems. Binary data in text logs is often a sign of malicious activity or system compromise.

Next Steps:
- Investigate the source IP/host that generated the binary data in logs
- Check if the binary patterns match known malware signatures or file headers (PE, ELF, ZIP, etc.)
- Review other logs from the same source for additional suspicious activity
- Determine if this is a legitimate application behavior or potential security incident
- Examine if log injection or corruption attempts are being made
- Consider blocking or rate-limiting the source if malicious activity is confirmed
', '["https://owasp.org/www-community/attacks/Binary_planting","https://cheatsheetseries.owasp.org/cheatsheets/Input_Validation_Cheat_Sheet.html"]', 'safe("log.message", "") != "" && ( safe("log.message", "").matches(".*[\x00-\x08\x0B\x0C\x0E-\x1F\x7F-\xFF]+.*") || safe("log.message", "").matches(".*\\\\x[8-9A-Fa-f][0-9A-Fa-f].*") || safe("log.message", "").matches(".*\\\\x[0-7][0-9A-Fa-f].*") || safe("log.message", "").matches(".*\xEF\xBB\xBF.*") || safe("log.message", "").matches(".*\xFF\xFE.*") || safe("log.message", "").matches(".*\xFE\xFF.*") || safe("log.message", "").matches(".*[\x80-\xFF]{3,}.*") || safe("log.message", "").matches(".*MZ.{0,100}This program.*") || safe("log.message", "").matches(".*\x4D\x5A.*") || safe("log.message", "").matches(".*\x7FELF.*") || safe("log.message", "").matches(".*PK\x03\x04.*") || safe("log.message", "").matches(".*\x50\x4B\x03\x04.*") || safe("log.message", "").matches(".*\x1F\x8B\x08.*") || safe("log.message", "").matches(".*GIF8[79]a.*") || safe("log.message", "").matches(".*\x89PNG.*") || safe("log.message", "").matches(".*\xFF\xD8\xFF.*") || safe("log.message", "").matches(".*[^\x20-\x7E\x09\x0A\x0D].*") && !safe("log.message", "").matches(".*[a-zA-Z0-9 .,!?:;''\"-]{10,}.*")) )', '2025-09-03 15:20:50.866772', true, false, 'origin', NULL, '[]');
INSERT INTO public.utm_correlation_rules VALUES (463, 'Compression Bomb Attempts', 1, 2, 3, 'Impact', 'T1499 - Endpoint Denial of Service: Resource Exhaustion', 'Detects potential compression bomb attempts in log processing where compressed archives show extreme compression ratios or recursive structures that could cause resource exhaustion.

Next Steps:
1. Identify the source of the compression bomb attempt by reviewing the origin IP and associated logs
2. Check system resource utilization (CPU, memory, disk) for signs of exhaustion
3. Review any file processing or decompression services that may have been targeted
4. Block the source IP if malicious activity is confirmed
5. Implement file size and compression ratio limits on file processing services
6. Review logs for other suspicious activities from the same source
', '["https://www.wallarm.com/what/zip-bomb","https://encyclopedia.kaspersky.com/glossary/zip-bomb/","https://attack.mitre.org/techniques/T1499/"]', '(safe("log.message", "").contains("zip bomb")) || (safe("log.message", "").contains("compression bomb")) || (safe("log.message", "").contains("overlapped components")) || (safe("log.message", "").contains("excessive compression ratio")) || (safe("log.message", "").contains("recursive compression detected")) || (safe("log.message", "").contains("decompression limit")) || (safe("log.message", "").contains("resource exhaustion"))', '2025-09-03 15:20:51.568896', true, false, 'origin', NULL, '[]');
INSERT INTO public.utm_correlation_rules VALUES (464, 'Delimiter Injection Attempts', 3, 3, 1, 'Defense Evasion', 'T1070.002 - Indicator Removal: Clear Linux or Mac System Logs', 'Detects attempts to inject delimiters, newlines, or special characters into logs that could break log parsing or forge log entries. This includes carriage returns, line feeds, and common log delimiters that could be used to create fake log entries or hide malicious activity.

Next Steps:
1. Identify the source of the injection attempt by examining the origin IP or user associated with the log entry
2. Review surrounding log entries to determine if this is part of a larger attack campaign
3. Check if the injection attempt was successful by looking for malformed or suspicious entries after this event
4. Examine the application or service generating these logs for potential vulnerabilities
5. Consider implementing input validation and sanitization to prevent log injection attacks
6. Review logs from the same source for other suspicious activities or exploitation attempts
', '["https://owasp.org/www-community/attacks/Log_Injection","https://capec.mitre.org/data/definitions/93.html","https://attack.mitre.org/techniques/T1070/002/"]', 'safe("log.message", "") != "" && ( safe("log.message", "").contains("\r\n") || safe("log.message", "").contains("\n\r") || safe("log.message", "").contains("\\r\\n") || safe("log.message", "").contains("\\n\\r") || safe("log.message", "").matches(".*[\r\n].*Successful Login.*") || safe("log.message", "").matches(".*[\r\n].*authenticated.*") || safe("log.message", "").matches(".*[\r\n].*INFO.*") || safe("log.message", "").matches(".*[\r\n].*ERROR.*") || safe("log.message", "").matches(".*[\r\n].*DEBUG.*") || safe("log.message", "").matches(".*[\r\n].*WARN.*") || safe("log.message", "").matches(".*\t\t+.*") || safe("log.message", "").matches(".*\|\|.*\|\|.*") || safe("log.message", "").matches(".*;;.*;;.*") )', '2025-09-03 15:20:52.186176', true, false, 'origin', NULL, '[]');
INSERT INTO public.utm_correlation_rules VALUES (945, 'System Linux: Persistence via KDE AutoStart Script or Desktop File Modification', 2, 2, 3, 'Persistence', 'Boot or Logon Autostart Execution', 'Identifies the creation or modification of a K Desktop Environment (KDE) AutoStart script or desktop file that will execute upon each user logon. Adversaries may abuse this method for persistence.', '["https://attack.mitre.org/tactics/TA0003/","https://attack.mitre.org/techniques/T1547/"]', 'safe("log.message", "").matches("sh,desktop") && safe("log.message", "").matches("(/home/(.+)/.config/autostart/|/root/.config/autostart/|/home/(.+)/.kde/Autostart/|/root/.kde/Autostart/|/home/(.+)/.kde4/Autostart/|/root/.kde4/Autostart/|/home/(.+)/.kde/share/autostart/|/root/.kde/share/autostart/|/home/(.+)/.kde4/share/autostart/|/root/.kde4/share/autostart/|/home/(.+)/.local/share/autostart/|/root/.local/share/autostart/|/home/(.+)/.config/autostart-scripts/|/root/.config/autostart-scripts/|/etc/xdg/autostart/|/usr/share/autostart/)") && !safe("log.message", "").matches("(yum|dpkg|install|dnf|teams|yum-cron|dnf-automatic)")', '2025-09-03 16:36:57.562798', true, false, 'origin', NULL, '[]');
INSERT INTO public.utm_correlation_rules VALUES (477, 'CORS Misconfiguration Exploitation', 3, 2, 1, 'Collection', 'T1213 - Data from Information Repositories', 'Detects attempts to exploit Cross-Origin Resource Sharing (CORS) misconfigurations through crafted Origin headers, wildcard origins, or credential requests. This could allow attackers to bypass same-origin policy and access sensitive data.

Next Steps:
1. Review the request details and origin IP for suspicious patterns
2. Check if the Origin header contains unusual values (null, file://, wildcards)
3. Verify if CORS policy allows credentials with wildcard origins
4. Examine the application''s CORS configuration for misconfigurations
5. Monitor for subsequent requests from the same IP attempting data access
6. Check access logs for successful data retrieval following CORS preflight requests
7. Review application responses for exposed sensitive data
8. Correlate with user-agent strings to identify automated tools
9. Check for multiple CORS requests from different origins but same IP
', '["https://developer.mozilla.org/en-US/docs/Web/HTTP/CORS","https://attack.mitre.org/techniques/T1213/"]', 'safe("origin.ip", "") != "" && (safe("log.request", "").contains("Origin:") || safe("log.referer", "").contains("null") || (safe("log.request", "").contains("Origin:") && (safe("log.request", "").contains("file://") || safe("log.request", "").contains("null") || safe("log.request", "").contains("*"))) || (safe("log.method", "") == "OPTIONS" && (safe("log.request", "").contains("Access-Control-Request-Method") || safe("log.request", "").contains("Access-Control-Request-Headers"))) || (safe("log.statusCode", 0.0) == double(200) && safe("log.request", "").contains("credentials=true")))', '2025-09-03 15:21:01.178616', true, false, 'origin', '["origin.ip","origin.path"]', '[]');
INSERT INTO public.utm_correlation_rules VALUES (478, 'Denial of Service Attack Pattern', 1, 1, 3, 'Impact', 'T1498 - Network Denial of Service', 'Detects patterns indicative of denial of service attacks including slowloris, high request rates from single IPs, or requests designed to consume excessive server resources. This rule identifies various DoS attack indicators such as timeout responses, service unavailable errors, rate limiting responses, known DoS tool user agents, and abnormally large requests.

Next Steps:
- Investigate the source IP for additional malicious activity
- Check server resource utilization during the timeframe
- Review firewall and load balancer logs for traffic patterns
- Implement rate limiting or IP blocking if confirmed malicious
- Analyze request patterns for application-layer attacks
- Consider implementing DDoS protection mechanisms
', '["https://owasp.org/www-community/attacks/Denial_of_Service","https://attack.mitre.org/techniques/T1498/"]', '(safe("log.statusCode", 0.0) == double(408)) || (safe("log.statusCode", 0.0) == double(503)) || (safe("log.statusCode", 0.0) == double(429)) || (safe("origin.bytesReceived", 0.0) == double(0) && safe("log.statusCode", 0) >= 400) || (safe("log.userAgent", "").contains("slowloris") || safe("log.userAgent", "").contains("slowhttptest") || safe("log.userAgent", "").contains("R-U-Dead-Yet") || safe("log.userAgent", "").contains("PyLoris")) || (safe("origin.path", "").length() > 2048) || (safe("log.request", "").length() > 8192)', '2025-09-03 15:21:01.882736', true, false, 'origin', '["origin.ip"]', '[{"indexPattern":"v11-log-apache-*","with":[{"field":"origin.ip.keyword","operator":"filter_term","value":"{{.origin.ip}}"}],"or":null,"within":"now-1m","count":100}]');
INSERT INTO public.utm_correlation_rules VALUES (479, 'Directory Traversal Attack Attempts', 3, 3, 2, 'Discovery', 'T1083 - File and Directory Discovery', 'Detects attempts to access files outside the web root directory using directory traversal techniques. 
This rule identifies various encoded and unencoded path traversal patterns that attackers use to 
access sensitive system files.

Next Steps:
1. Immediately block the source IP address if confirmed malicious
2. Review web server access logs for other suspicious activities from the same IP
3. Check if any sensitive files were successfully accessed
4. Verify web application input validation and sanitization controls
5. Consider implementing or updating Web Application Firewall (WAF) rules
6. Review and harden file system permissions on the web server
', '["https://attack.mitre.org/techniques/T1083/","https://owasp.org/www-community/attacks/Path_Traversal"]', 'safe("log.request", "") != "" && ( safe("log.request", "").contains("../") || safe("log.request", "").contains("..\\") || safe("log.request", "").contains("..%2f") || safe("log.request", "").contains("..%2F") || safe("log.request", "").contains("..%5c") || safe("log.request", "").contains("..%5C") || safe("log.request", "").contains("%2e%2e/") || safe("log.request", "").contains("%2e%2e\\") || safe("log.request", "").contains("..%252f") || safe("log.request", "").contains("..%255c") || safe("log.request", "").contains("/etc/passwd") || safe("log.request", "").contains("/windows/system32") || safe("log.request", "").contains("/proc/self") || safe("log.request", "").contains("C:\\Windows") || safe("log.request", "").contains("C:\\winnt") )', '2025-09-03 15:21:02.424012', true, false, 'origin', NULL, '[]');
INSERT INTO public.utm_correlation_rules VALUES (946, 'System Linux: Enumeration of Kernel Modules', 1, 1, 2, 'Discovery', 'System Information Discovery', 'Loadable Kernel Modules (or LKMs) are pieces of code that can be loaded and unloaded into the kernel upon demand. They extend the functionality of the kernel without the need to reboot the system. This identifies attempts to enumerate information about a kernel module.', '["https://attack.mitre.org/tactics/TA0007/","https://attack.mitre.org/techniques/T1082/"]', 'safe("log.message", "").matches("(sudo (kmod(.+)list|list(.+)kmod|depmod|lsmod|modinfo))")', '2025-09-03 16:36:57.827711', true, false, 'origin', NULL, '[]');
INSERT INTO public.utm_correlation_rules VALUES (1467, 'Windows Defender: ERROR: NO INTERNET CONNECTION', 1, 2, 3, 'Potentially Compromised System', 'User Execution', 'Detects the ''NO INTERNET CONNECTION'' error event in Windows Defender, which may indicate connectivity issues affecting protection.', '["https://learn.microsoft.com/en-us/windows/security/threat-protection/windows-defender-antivirus/troubleshoot"]', 'safe("log.winlogEventDataLogName", "") == "Microsoft-Windows-Windows Defender/Operational" &&  safe("log.winlogEventDataErrorCode", "") == "0x80501004"', '2025-09-04 21:11:29.941188', true, false, 'target', NULL, '[]');
INSERT INTO public.utm_correlation_rules VALUES (469, 'Log Source Identification Failures', 2, 3, 3, 'Defense Evasion', 'T1070.003 - Indicator Removal: Clear Command History', 'Detects when log messages appear to be malformed or contain patterns that suggest attempts to obfuscate the true source of logs. This could indicate misconfigured systems, corrupted log data, or deliberate attempts to hide activity.

Next Steps:
1. Review the raw log message content to identify the pattern or format issue
2. Check if the sending system is properly configured to send structured logs
3. Verify that intermediate log collectors or forwarders are not corrupting the data
4. Look for other anomalous logs from the same source IP address
5. If deliberate obfuscation is suspected, investigate the source system for compromise
6. Consider implementing log format validation at the collection point
', '["https://www.splunk.com/en_us/blog/learn/syslog.html","https://attack.mitre.org/techniques/T1070/003/"]', 'safe("log.message", "") != "" && ( safe("log.message", "").contains("<-1>") || safe("log.message", "").contains("<>") || safe("log.message", "").matches("^[0-9]+\\s+<[0-9]+>.*") || safe("log.message", "").matches("^\\s*$") || !safe("log.message", "").matches(".*[a-zA-Z]+.*") )', '2025-09-03 15:20:55.522017', true, false, 'origin', NULL, '[]');
INSERT INTO public.utm_correlation_rules VALUES (1458, 'Windows: Whoami Process Activity', 1, 2, 3, 'Discovery', 'System Owner/User Discovery', 'Identifies suspicious use of whoami.exe which displays user, group, and privileges information for the user who is currently logged on to the local system.', '["https://attack.mitre.org/tactics/TA0007/","https://attack.mitre.org/techniques/T1033/"]', 'safe("log.eventDataProcessName", "").contains("whoami.exe")', '2025-09-04 21:02:18.73192', true, false, 'origin', NULL, '[]');
INSERT INTO public.utm_correlation_rules VALUES (471, 'Authentication Bypass Attempts', 3, 3, 2, 'Credential Access', 'T1212 - Exploitation for Credential Access', 'Detects attempts to bypass authentication mechanisms through various techniques including HTTP verb tampering, authentication header manipulation, session fixation, or exploiting authentication logic flaws in protected resources.

Next Steps:
1. Investigate the source IP address and check for patterns of attack behavior
2. Review Apache access logs for the timeframe around the alert to understand the full attack sequence
3. Examine the specific requests made to protected resources and authentication endpoints
4. Check if the attempts were successful by looking for subsequent 200 status codes from the same IP
5. Verify the integrity of authentication configuration files (.htaccess, .htpasswd)
6. Review user accounts for any unauthorized access or privilege escalation
7. Consider implementing additional authentication controls like rate limiting or IP blocking
8. Update WAF rules to detect and block similar bypass attempts
', '["https://httpd.apache.org/docs/2.4/howto/auth.html","https://attack.mitre.org/techniques/T1212/"]', 'safe("origin.ip", "") != "" &&
((safe("log.statusCode", 0.0) == double(401) || safe("log.statusCode", 0.0) == double(403)) &&
 (safe("log.method", "") == "OPTIONS" || 
  safe("log.method", "") == "PATCH" ||
  safe("log.method", "") == "PUT" ||
  safe("log.method", "") == "TRACE" ||
  safe("log.method", "") == "CONNECT" ||
  safe("log.method", "") == "PROPFIND")) ||
(safe("origin.path", "").contains("/admin") || 
 safe("origin.path", "").contains("/api/") ||
 safe("origin.path", "").contains("/private") ||
 safe("origin.path", "").contains("/.htaccess") ||
 safe("origin.path", "").contains("/.htpasswd")) &&
(safe("log.request", "").contains("Authorization: Basic Og==") ||
 safe("log.request", "").contains("Authorization: Bearer null") ||
 safe("log.request", "").contains("X-Original-URL:") ||
 safe("log.request", "").contains("X-Rewrite-URL:") ||
 safe("origin.path", "").contains("..;/") ||
 safe("origin.path", "").contains("%2e%2e"))
', '2025-09-03 15:20:56.138898', true, false, 'origin', '["origin.ip","origin.path"]', '[{"indexPattern":"v11-log-filebeat-*","with":[{"field":"origin.ip.keyword","operator":"filter_term","value":"{{.origin.ip}}"},{"field":"log.statusCode.keyword","operator":"filter_term","value":"401"}],"or":[{"indexPattern":"v11-log-filebeat-*","with":[{"field":"origin.ip.keyword","operator":"filter_term","value":"{{.origin.ip}}"},{"field":"log.statusCode.keyword","operator":"filter_term","value":"403"}],"or":null,"within":"now-5m","count":3}],"within":"now-5m","count":3}]');
INSERT INTO public.utm_correlation_rules VALUES (472, 'Apache Backup File Access Attempts', 3, 1, 1, 'Collection', 'T1530 - Data from Cloud Storage Object', 'Detects attempts to access backup files, temporary files, or old versions of files that may contain sensitive information. Attackers often target these files as they may contain configuration files, source code, database dumps, or other sensitive data that could aid in further attacks.

Next Steps:
1. Verify if the accessed file contains sensitive information
2. Check if the file should be publicly accessible or if it was misconfigured
3. Review web server configuration to ensure backup files are not served
4. Audit file permissions and access controls
5. Consider implementing proper backup file management practices
6. Monitor for any data exfiltration attempts from the same IP
7. Review server logs for other suspicious activities from this source
', '["https://owasp.org/www-project-web-security-testing-guide/latest/4-Web_Application_Security_Testing/02-Configuration_and_Deployment_Management_Testing/04-Review_Old_Backup_and_Unreferenced_Files_for_Sensitive_Information","https://attack.mitre.org/techniques/T1530/"]', 'safe("origin.path", "") != "" && safe("log.statusCode", 0.0) == double(200) && ( safe("origin.path", "").contains(".bak") || safe("origin.path", "").contains(".backup") || safe("origin.path", "").contains(".old") || safe("origin.path", "").contains(".orig") || safe("origin.path", "").contains(".save") || safe("origin.path", "").contains(".swp") || safe("origin.path", "").contains(".tmp") || safe("origin.path", "").contains(".temp") || safe("origin.path", "").contains("~") || safe("origin.path", "").contains(".copy") || safe("origin.path", "").contains(".dist") || safe("origin.path", "").contains("_backup") || safe("origin.path", "").contains("_old") || safe("origin.path", "").contains(".1") || safe("origin.path", "").contains(".2") || safe("origin.path", "").contains(".tar") || safe("origin.path", "").contains(".gz") || safe("origin.path", "").contains(".zip") || safe("origin.path", "").contains(".rar") || safe("origin.path", "").contains(".7z") || safe("origin.path", "").contains(".sql") || safe("origin.path", "").contains(".dump") )', '2025-09-03 15:20:56.764079', true, false, 'origin', '["origin.ip","origin.path"]', '[]');
INSERT INTO public.utm_correlation_rules VALUES (473, 'Web Application Brute Force Attack', 3, 2, 2, 'Credential Access', 'T1110 - Brute Force', 'Detects brute force login attempts against web applications by monitoring for multiple failed authentication attempts (401/403 status codes) from the same IP address within a short time window. This rule identifies potential credential stuffing and password spraying attacks targeting web application login pages.

Next Steps:
1. Investigate the source IP address for reputation and geolocation
2. Review Apache access logs for the affected paths and timeline of attempts
3. Check if any successful logins occurred from the same IP after failed attempts
4. Verify the targeted login endpoints are properly secured with rate limiting
5. Consider implementing IP-based blocking or CAPTCHA for repeated failures
6. Review user accounts targeted in the attack for any compromise indicators
', '["https://owasp.org/www-community/attacks/Brute_force_attack","https://attack.mitre.org/techniques/T1110/"]', '(safe("log.statusCode", 0.0) == double(401) || safe("log.statusCode", 0.0) == double(403)) && (safe("origin.path", "").contains("login") || safe("origin.path", "").contains("signin") || safe("origin.path", "").contains("auth") || safe("origin.path", "").contains("admin") || safe("origin.path", "").contains("wp-login") || safe("origin.path", "").contains("administrator") || safe("origin.path", "").contains("user/login") || safe("origin.path", "").contains("account/login")) && safe("action", "") == "post"', '2025-09-03 15:20:57.414619', true, false, 'origin', NULL, '[{"indexPattern":"v11-log-filebeat-apache-*","with":[{"field":"origin.ip.keyword","operator":"filter_term","value":"{{.origin.ip}}"},{"field":"log.statusCode","operator":"filter_term","value":"401"}],"or":[{"indexPattern":"v11-log-filebeat-apache-*","with":[{"field":"origin.ip.keyword","operator":"filter_term","value":"{{.origin.ip}}"},{"field":"log.statusCode","operator":"filter_term","value":"403"}],"or":null,"within":"now-1m","count":6}],"within":"now-1m","count":6}]');
INSERT INTO public.utm_correlation_rules VALUES (485, 'Regular Expression DoS Attack', 1, 1, 3, 'Impact', 'T1499: Endpoint Denial of Service', 'Detects patterns that could cause catastrophic backtracking in regular expression engines, leading to CPU exhaustion and denial of service. These patterns exploit the way regex engines process certain repetitive patterns, causing exponential time complexity.

Next Steps:
1. Identify the source IP address and check if it''s sending multiple requests with similar patterns
2. Review application logs for high CPU usage or timeout errors during the time of the attack
3. Check if the regex patterns are being submitted through user input fields or API endpoints
4. Consider implementing input validation and regex complexity limits
5. If confirmed malicious, block the source IP at firewall level
6. Review and optimize any regular expressions used in the application to prevent ReDoS vulnerabilities
7. Monitor for additional suspicious patterns from the same source
8. Document the incident for future reference and security awareness training
', '["https://attack.mitre.org/techniques/T1499/","https://owasp.org/www-community/attacks/Regular_expression_Denial_of_Service_-_ReDoS"]', '(safe("log.message", "").contains("aaaaaaaaaaaaaaaaaaaaaa") || safe("log.message", "").contains("(.*+)*") || safe("log.message", "").contains("(.*)*+") || safe("log.message", "").contains("(.+)+") || safe("log.message", "").contains("([a-zA-Z]+)*") || safe("log.message", "").contains("(a|a)*") || safe("log.message", "").contains("(a*)*") || safe("log.message", "").contains("(a+)+") || safe("log.message", "").contains("(a{1,32767}){1,32767}") || safe("log.message", "").contains("^(a+)+$") || safe("log.message", "").contains("([a-zA-Z0-9])*([a-zA-Z0-9])*"))', '2025-09-03 15:22:05.745783', true, false, 'origin', NULL, '[]');
INSERT INTO public.utm_correlation_rules VALUES (591, 'Data Stream Tampering Attempt Detected', 2, 3, 2, 'Impact', 'T1565 - Data Manipulation', 'Detects attempts to tamper with Elasticsearch data streams through unauthorized modifications, deletions, or rollover operations that could compromise data integrity. Data stream tampering can lead to data loss, corruption, or unauthorized access to sensitive information.

Next Steps:
1. Review the specific data stream operation that triggered this alert
2. Verify if the user performing the operation has legitimate authorization
3. Check for any concurrent suspicious activities from the same user or IP
4. Examine the data streams affected for any signs of compromise
5. Review access logs for unusual patterns or unauthorized access attempts
6. Consider temporarily restricting access to critical data streams
7. Validate data integrity of affected streams
', '["https://www.elastic.co/guide/en/elasticsearch/reference/current/data-streams.html","https://attack.mitre.org/techniques/T1565/"]', 'safe("log.msg", "").contains("_data_stream") && (safe("log.msg", "").contains("DELETE") || safe("log.msg", "").contains("PUT") || safe("log.msg", "").contains("_rollover") || safe("log.msg", "").contains("_modify_data_stream"))', '2025-09-03 15:32:04.123276', true, false, 'origin', '["log.nodeName"]', '[]');
INSERT INTO public.utm_correlation_rules VALUES (484, 'Recursive Parsing Attack Detection', 1, 2, 3, 'Impact', 'T1499 - Resource Exhaustion', 'Detects patterns that could cause recursive parsing issues or infinite loops in log processors, potentially leading to CPU exhaustion or memory overflow. These attacks exploit nested structures or recursive function calls to overwhelm processing resources.

Next Steps:
1. Identify the source IP and hostname generating these patterns
2. Check system resource usage (CPU, memory) on log processing systems
3. Review other logs from the same source for additional suspicious patterns
4. Consider blocking or rate-limiting the source if malicious intent is confirmed
5. Update log parsing configurations to handle recursive patterns safely
6. Implement resource limits on log processing functions
', '["https://attack.mitre.org/techniques/T1499/","https://cwe.mitre.org/data/definitions/674.html"]', '(safe("log.message", "").matches(".*\\$\\{[^}]*\\$\\{[^}]*\\}[^}]*\\}.*") || safe("log.message", "").matches(".*\\(\\([^)]*\\([^)]*\\)[^)]*\\)\\).*") || safe("log.message", "").matches(".*\\\\x[0-9a-fA-F]{2}\\\\x[0-9a-fA-F]{2}\\\\x[0-9a-fA-F]{2}\\\\x[0-9a-fA-F]{2}.*") || safe("log.message", "").contains("eval(eval(") || safe("log.message", "").contains("decode(decode(") || safe("log.message", "").contains("parse(parse(") || safe("log.message", "").matches(".*(&amp;){5,}.*") || safe("log.message", "").matches(".*(\\\\\\\\){10,}.*"))', '2025-09-03 15:22:04.707008', true, false, 'origin', '["origin.ip"]', '[]');
INSERT INTO public.utm_correlation_rules VALUES (493, 'GitHub Enterprise Member Changes', 3, 3, 1, 'Persistence, Privilege Escalation', 'Account Manipulation', 'Detects changes to enterprise member status including additions and removals. This could indicate unauthorized access management or insider threats attempting to modify organization membership.

Next Steps:
- Verify if the user performing the action (senderLogin) is authorized to manage members
- Check if the member changes align with approved access requests or HR processes
- Review the member account that was added/removed for any suspicious activity
- Investigate if multiple member changes occurred in a short timeframe
- Validate with the organization owner if these changes were expected
', '["https://docs.github.com/en/webhooks/webhook-events-and-payloads#member","https://attack.mitre.org/techniques/T1098/"]', 'safe("action", "") == "member.added" || safe("action", "") == "member.removed" || safe("action", "") == "member.edited"', '2025-09-03 15:23:08.693524', true, false, 'origin', '["log.member","action"]', '[]');
INSERT INTO public.utm_correlation_rules VALUES (486, 'Stack Overflow Exploitation Attempt', 3, 3, 3, 'Execution', 'T1203 - Exploitation for Client Execution', 'Detects patterns commonly used in stack overflow exploitation attempts including long strings of repeated characters, shellcode patterns, or memory addresses that may indicate buffer overflow exploitation.

Next Steps:
1. Identify the affected system or application from the log source
2. Check if the overflow attempt was successful by looking for:
   - Process crashes or unexpected terminations
   - New processes spawned with elevated privileges
   - Unusual network connections from the affected system
3. Review application logs for any error messages or crash dumps
4. If exploitation is confirmed:
   - Isolate the affected system
   - Capture memory dump for forensic analysis
   - Check for persistence mechanisms
5. Update or patch the vulnerable application
6. Consider implementing ASLR, DEP, or stack canaries if not already enabled
', '["https://attack.mitre.org/techniques/T1203/","https://cwe.mitre.org/data/definitions/121.html"]', '(safe("log.message", "").matches(".*[A-Za-z]{500,}.*") || safe("log.message", "").matches(".*\\x90{20,}.*") || safe("log.message", "").matches(".*\\x41{100,}.*") || safe("log.message", "").matches(".*0x[0-9a-fA-F]{8,}.*0x[0-9a-fA-F]{8,}.*") || safe("log.message", "").matches(".*\\xeb\\x[0-9a-fA-F]{2}.*") || safe("log.message", "").matches(".*\\x31\\xc0\\x50\\x68.*") || safe("log.message", "").matches(".*%[0-9]{4,}\\$.*") || safe("log.message", "").matches(".*\\x00{50,}.*") || safe("log.message", "").length() > 10000)', '2025-09-03 15:22:06.630034', true, false, 'origin', NULL, '[]');
INSERT INTO public.utm_correlation_rules VALUES (474, 'Web Cache Poisoning Attempts', 2, 3, 2, 'Initial Access', 'Drive-by Compromise', 'Detects potential web cache poisoning attempts through manipulation of cache key headers, malformed host headers, or injection of cache-busting parameters. This attack can lead to stored XSS, defacement, or serving malicious content to other users by exploiting caching mechanisms to store malicious responses that are later served to legitimate users.

Next Steps:
1. Examine the specific headers and parameters used in the request to identify the poisoning technique
2. Check if multiple requests from the same IP are attempting cache poisoning variations
3. Verify if any cached responses were successfully poisoned by reviewing cache logs
4. Analyze the target paths and resources being poisoned for business impact
5. Review web application firewall logs for related blocking attempts
6. Check for any successful exploitation by examining user-facing content
7. Consider implementing cache key normalization and header validation
8. Monitor for any subsequent requests to the same poisoned resources
', '["https://portswigger.net/web-security/web-cache-poisoning","https://attack.mitre.org/techniques/T1189/"]', 'safe("origin.ip", "") != "" &&
(safe("log.request", "").contains("X-Forwarded-Host:") ||
 safe("log.request", "").contains("X-Host:") ||
 safe("log.request", "").contains("X-Forwarded-Server:") ||
 safe("log.request", "").contains("X-Original-URL:") ||
 safe("log.request", "").contains("X-Rewrite-URL:") ||
 (safe("origin.path", "").contains("?") && 
  (safe("origin.path", "").contains("cb=") || 
   safe("origin.path", "").contains("utm_") || 
   safe("origin.path", "").contains("cache=") ||
   safe("origin.path", "").contains("_=") ||
   safe("origin.path", "").contains("buster="))) ||
 safe("log.message", "").contains("Cache-Control: no-transform"))
', '2025-09-03 15:20:58.16571', true, false, 'origin', NULL, '[]');
INSERT INTO public.utm_correlation_rules VALUES (475, 'CGI Script Exploitation Attempts', 3, 3, 2, 'Execution', 'T1059 - Command and Scripting Interpreter', 'Detects attempts to exploit CGI scripts including command injection, path traversal to execute system binaries, shellshock-style attacks, or other CGI-based remote code execution attempts. This rule identifies suspicious patterns in HTTP requests targeting CGI scripts that could indicate exploitation attempts.

Next Steps:
1. Review the complete HTTP request including headers, parameters, and payload
2. Examine server logs for any successful execution or error messages
3. Check if the targeted CGI script exists and is vulnerable to the detected attack pattern
4. Analyze the source IP reputation and check for other malicious activities from the same source
5. Verify server integrity and check for any unauthorized code execution or file modifications
6. Review web application firewall logs for additional context and related blocked requests
7. Consider implementing additional CGI security controls and blocking the source IP if confirmed malicious
8. Validate that CGI scripts follow secure coding practices and input validation
', '["https://httpd.apache.org/docs/2.4/howto/cgi.html","https://attack.mitre.org/techniques/T1059/"]', '( safe("origin.path", "").contains("/cgi-bin/") && ( safe("origin.path", "").contains("../") || safe("origin.path", "").contains("..\\") || safe("origin.path", "").contains("/bin/") || safe("origin.path", "").contains("/usr/bin/") || safe("origin.path", "").contains("cmd.exe") || safe("origin.path", "").contains("powershell") ) ) || ( safe("log.userAgent", "").contains("() {") || safe("log.referer", "").contains("() {") || safe("origin.path", "").contains("() {") ) || ( safe("origin.path", "").contains("/cgi-bin/") && ( safe("origin.path", "").contains(";") && (safe("origin.path", "").contains("echo") || safe("origin.path", "").contains("cat") || safe("origin.path", "").contains("id") || safe("origin.path", "").contains("whoami")) ) ) || ( safe("log.method", "") == "POST" && safe("origin.path", "").contains("/cgi-bin/") && safe("statusCode", 0.0) == double(200) && safe("origin.bytesReceived", 0) < 100 )', '2025-09-03 15:20:59.555392', true, false, 'origin', NULL, '[]');
INSERT INTO public.utm_correlation_rules VALUES (480, 'htaccess File Modification Attempts', 2, 3, 2, 'Persistence', 'T1505 - Server Software Component', 'Detects attempts to access or modify .htaccess files which could be used to establish persistence, redirect traffic, or bypass security controls. Attackers may modify .htaccess files to redirect users to malicious sites, establish backdoors, or bypass authentication mechanisms.

Next Steps:
1. Review the source IP and verify if it''s authorized to access .htaccess files
2. Check the content of any .htaccess modifications for malicious directives
3. Examine authentication logs for the user associated with this activity
4. Verify the integrity of web application files and configurations
5. Consider blocking the source IP if activity is confirmed malicious
6. Review web server access logs for other suspicious activities from the same source
', '["https://attack.mitre.org/techniques/T1505/","https://httpd.apache.org/docs/2.4/howto/htaccess.html"]', 'safe("log.request", "") != "" && safe("log.request", "").contains(".htaccess") && ( safe("log.method", "") == "PUT" || safe("log.method", "") == "POST" || safe("log.method", "") == "PATCH" || (safe("log.method", "") == "GET" && safe("log.statusCode", 0.0) == double(200)) )', '2025-09-03 15:21:03.213814', true, false, 'origin', '["origin.ip","log.request"]', '[{"indexPattern":"v11-log-filebeat-apache-*","with":[{"field":"origin.ip.keyword","operator":"filter_term","value":"{{.origin.ip}}"},{"field":"log.request.keyword","operator":"filter_match","value":".htaccess"}],"or":null,"within":"now-1h","count":2}]');
INSERT INTO public.utm_correlation_rules VALUES (522, 'GitHub Workflow Modifications Detected', 3, 3, 2, 'Initial Access', 'T1195.001 - Supply Chain Compromise: Compromise Software Dependencies and Development Tools', 'Detects modifications to GitHub Actions workflows which could be used to inject malicious code into the CI/CD pipeline or steal secrets. Attackers may modify workflows to execute arbitrary code, exfiltrate secrets, or compromise the software supply chain.

Next Steps:
1. Review the modified workflow files to identify any suspicious changes or additions
2. Check if the user who made the modifications has legitimate access and business justification
3. Look for any attempts to access secrets or environment variables in the workflow
4. Verify if any external actions or Docker images were added that could be malicious
5. Review commit history and pull request approvals for the workflow changes
6. Consider temporarily disabling the workflow if suspicious activity is confirmed
7. Audit repository access permissions and enable branch protection rules for workflow files
8. Check for any unusual timing of modifications (off-hours, weekends)
9. Verify the integrity of the repository and look for other suspicious activities
10. Review access logs for the user account that made the modifications
', '["https://docs.github.com/en/actions/using-workflows/events-that-trigger-workflows","https://attack.mitre.org/techniques/T1195/001/"]', '(safe("action", "") == "workflows.updated" || safe("action", "") == "workflows.created" || safe("action", "") == "workflow_run.completed" || safe("action", "") == "workflow_dispatch") && safe("log.repositoryName", "") != "" && safe("log.senderLogin", "") != "" && (safe("log.headCommitModified", "").contains(".github/workflows/") || safe("log.headCommitAdded", "").contains(".github/workflows/") || safe("log.path", "").contains(".github/workflows/") || safe("log.filename", "").contains(".github/workflows/"))', '2025-09-03 15:24:13.089027', true, false, 'origin', '["origin.user","target.host"]', '[]');
INSERT INTO public.utm_correlation_rules VALUES (483, 'Pattern Matching Timeout Attack', 1, 2, 3, 'Impact', 'Algorithmic Complexity Attack', 'Detects input patterns designed to cause excessive processing time in pattern matching algorithms, potentially causing timeouts and service degradation. This rule identifies various malicious patterns including:
- Excessively long email addresses or domain names (100+ characters each)
- Abnormally long URL hostnames (200+ characters)
- Malformed IP addresses with excessive segments (100+ digits in last octet)
- Repeated directory separators (50+ consecutive slashes)
- Query parameters with excessive parameter names (100+ characters)
- Character repetition attacks (20+ consecutive identical characters)
- Large amounts of whitespace characters (100+ consecutive whitespace)
- Messages exceeding 5000 characters with 50+ special characters

Next Steps:
- Review the source IP address and determine if it''s a known attacker
- Check if the application or service experienced performance degradation during the attack
- Analyze the specific pattern that triggered the alert to understand the attack vector
- Implement input validation to limit the length of user inputs
- Consider implementing rate limiting for the affected endpoint
- Review application logs for any timeout errors or performance issues
- If pattern matching is done via regex, review and optimize regex patterns to prevent catastrophic backtracking
- Monitor system resources (CPU, memory) for signs of exhaustion
- Consider implementing Web Application Firewall (WAF) rules to block similar patterns
', '["https://attack.mitre.org/techniques/T1499/002/","https://cwe.mitre.org/data/definitions/407.html"]', '(safe("log.message", "").matches(".*[\\\\w\\\\-\\\\.]{100,}@[\\\\w\\\\-\\\\.]{100,}.*") || safe("log.message", "").matches(".*https?://[^/]{200,}.*") || safe("log.message", "").matches(".*[0-9]{1,3}\\\\.[0-9]{1,3}\\\\.[0-9]{1,3}\\\\.[0-9]{100,}.*") || safe("log.message", "").matches(".*[/\\\\\\\\]{50,}.*") || safe("log.message", "").matches(".*[?&][^=]{100,}=.*") || safe("log.message", "").matches(".*([a-zA-Z])\\\\1{20,}.*") || safe("log.message", "").matches(".*[\\\\s\\\\t\\\\r\\\\n]{100,}.*") || (safe("log.message", "").length() > 5000 && safe("log.message", "").matches(".*[^a-zA-Z0-9\\\\s]{50,}.*")))', '2025-09-03 15:22:04.210818', true, false, 'origin', '["origin.ip"]', '[]');
INSERT INTO public.utm_correlation_rules VALUES (1255, 'Certificate Services Abuse Detection', 3, 3, 1, 'Credential Access', 'T1558 - Steal or Forge Kerberos Tickets', 'Detects suspicious certificate requests and issuance that could indicate Golden Certificate attacks or unauthorized certificate generation for persistence. This rule monitors for Windows Certificate Services events for potentially malicious certificate operations, particularly those involving machine accounts or anonymous logons that could be leveraged for persistence and privilege escalation.

Next Steps:
1. Investigate the certificate request details including the requesting user/machine
2. Verify if the certificate request was legitimate and authorized
3. Check for any recent changes to Certificate Authority policies or templates
4. Review Certificate Authority logs for other suspicious certificate issuance
5. Examine the requesting host for signs of compromise
6. Consider revoking any suspicious certificates issued
7. Validate Certificate Authority security configurations and access controls
', '["https://www.splunk.com/en_us/blog/security/breaking-the-chain-defending-against-certificate-services-abuse.html","https://attack.mitre.org/techniques/T1558/"]', '(safe("log.eventCode", 0.0) == double(4886) || safe("log.eventCode", 0.0) == double(4887)) && safe("log.winlogProviderName", "") == "Microsoft-Windows-Security-Auditing" && (safe("log.winlogEventDataSubjectUserName", "").contains("$") || safe("log.winlogEventDataSubjectUserName", "") == "ANONYMOUS LOGON")', '2025-09-04 19:28:22.562491', true, false, 'origin', '["log.winlogEventDataSubjectUserName","log.origin.host"]', '[]');
INSERT INTO public.utm_correlation_rules VALUES (1256, 'DCOM Lateral Movement Detection', 3, 3, 2, 'Lateral Movement', 'T1021.003 - Remote Services: Distributed Component Object Model', 'Detects potential DCOM lateral movement attempts by monitoring for suspicious process creation with DCOM-related command line parameters. Looks for processes with automation embedding flags and specific DCOM object CLSIDs commonly abused for lateral movement such as ShellWindows and MMC20.Application.

Next Steps:
1. Investigate the source host and user account that initiated the DCOM activity
2. Review network connections between the source and target systems around the time of the alert
3. Check for additional lateral movement indicators on both source and target systems
4. Examine the specific DCOM objects and CLSIDs being accessed for known malicious usage
5. Verify if the DCOM activity aligns with legitimate business processes or scheduled tasks
6. Look for privilege escalation attempts following the lateral movement
7. Check for any data exfiltration or persistence mechanisms deployed post-compromise
', '["https://medium.com/@cY83rR0H1t/detecting-dcom-lateral-movement-ee2b461a8705","https://attack.mitre.org/techniques/T1021/003/"]', 'safe("log.eventCode", 0.0) == double(4688) && safe("log.winlogEventDataCommandLine", "") != "" && (safe("log.winlogEventDataCommandLine", "").contains("/automation -Embedding") || safe("log.winlogEventDataCommandLine", "").contains("9BA05972-F6A8-11CF-A442-00A0C90A8F39") || safe("log.winlogEventDataCommandLine", "").contains("c08afd90-f2a1-11d1-8455-00a0c91f3880") || safe("log.winlogEventDataCommandLine", "").contains("MMC20.Application") || safe("log.winlogEventDataCommandLine", "").contains("Document.Application.ShellExecute") || safe("log.winlogEventDataCommandLine", "").contains("GetTypeFromCLSID") || safe("log.winlogEventDataCommandLine", "").contains("GetTypeFromProgID"))', '2025-09-04 19:28:23.209123', true, false, 'origin', '["origin.host","log.winlogEventDataProcessName"]', '[{"indexPattern":"v11-log-wineventlog-*","with":[{"field":"origin.host.keyword","operator":"filter_term","value":"{{.origin.host}}"},{"field":"log.eventCode","operator":"filter_term","value":4624},{"field":"log.winlogEventDataLogonType.keyword","operator":"filter_term","value":"3"}],"or":null,"within":"now-5m","count":1}]');
INSERT INTO public.utm_correlation_rules VALUES (1257, 'DCShadow Attack Detection', 3, 3, 2, 'Defense Evasion', 'T1207 - Rogue Domain Controller', 'Detects DCShadow attacks where attackers register a rogue domain controller to push malicious Active Directory changes. This technique allows adversaries to modify Active Directory objects by registering a rogue domain controller and triggering replication, effectively bypassing security controls and detection mechanisms.

The rule monitors for:
- Computer account modifications with domain controller service principal names
- Access to sensitive Active Directory objects and properties
- Creation of server objects in the domain controller configuration

Next Steps:
1. Immediately investigate the source host and user account involved in the activity
2. Check if the host is an authorized domain controller in your environment
3. Review recent Active Directory changes and replication logs
4. Examine authentication logs for the affected user account
5. Verify the legitimacy of any recent domain controller promotions
6. Check for signs of compromise on the source system
7. Consider isolating the affected host if unauthorized activity is confirmed
8. Review domain controller security policies and access controls
', '["https://attack.mitre.org/techniques/T1207/","https://www.dcshadow.com/","https://blog.alsid.eu/dcshadow-explained-4510f52fc19d"]', '((safe("log.eventCode", 0.0) == double(4742) &&
   safe("log.winlogChannel", "") == "Security" &&
   safe("log.winlogEventDataServicePrincipalNames", "").matches(".*GC/.*") &&
   safe("log.winlogEventDataUserAccountControl", "").matches(".*SERVER_TRUST_ACCOUNT.*")) ||
  (safe("log.eventCode", 0.0) == double(4662) &&
   safe("log.winlogChannel", "") == "Security" &&
   safe("log.winlogEventDataObjectType", "") == "{bf967a92-0de6-11d0-a285-00aa003049e2}" &&
   safe("log.winlogEventDataProperties", "").matches(".*1131f6ac-9c07-11d1-f79f-00c04fc2dcd2.*")) ||
  (safe("log.eventCode", 0.0) == double(5137) &&
   safe("log.winlogChannel", "") == "Security" &&
   safe("log.winlogEventDataObjectClass", "") == "server" &&
   safe("log.winlogEventDataObjectDN", "").matches(".*CN=Servers,CN=.*"))) &&
!safe("origin.host", "").matches(".*DC.*")
', '2025-09-04 19:28:23.876863', true, false, 'origin', '["origin.host","log.winlogEventDataSubjectUserName"]', '[]');
INSERT INTO public.utm_correlation_rules VALUES (1468, 'Windows Defender: ERROR: PLATFORM OUTDATED', 1, 2, 3, 'Potentially Compromised System', 'User Execution', 'Detects the ''PLATFORM OUTDATED'' error event in Windows Defender, which may indicate that the system is not running the latest security updates.', '["https://learn.microsoft.com/en-us/windows/security/threat-protection/windows-defender-antivirus/troubleshoot"]', 'safe("log.winlogEventDataLogName", "") == "Microsoft-Windows-Windows Defender/Operational" &&  safe("log.winlogEventDataErrorCode", "") == "0x80508031"', '2025-09-04 21:11:30.493105', true, false, 'target', NULL, '[]');
INSERT INTO public.utm_correlation_rules VALUES (487, 'Unstructured Data Anomalies', 2, 3, 2, 'Defense Evasion, Privilege Escalation', 'Log Injection', 'Detects anomalies in unstructured log data including:
- Unusually large log messages (>10KB) that may indicate log flooding or DoS attempts
- Non-printable/control characters that could be log injection attempts
- HTTP header injection patterns in log messages
- Binary data in text logs

Next Steps:
1. Review the suspicious log entry to understand its source and content
2. Check if the source IP/system is authorized to generate such logs
3. Look for patterns of similar anomalous entries from the same source
4. Investigate if this could be an attempt to:
   - Inject false log entries to cover tracks
   - Overflow log storage systems
   - Inject commands through log processing systems
5. Review log processing pipeline for potential vulnerabilities
6. Consider implementing log size limits and input validation at the source
', '["https://betterstack.com/community/guides/logging/json-logging/","https://attack.mitre.org/techniques/T1055/","https://owasp.org/www-community/attacks/Log_Injection"]', '(safe("log.message", "") != "" && size(safe("log.message", "")) > 10000) || (safe("log.message", "").contains("\x00")) || (safe("log.message", "").contains("\r\n") && safe("log.message", "").contains("HTTP/")) || (safe("log.message", "").matches(".*[\x01-\x08\x0B\x0C\x0E-\x1F].*"))', '2025-09-03 15:22:07.467308', true, false, 'origin', '["log.message"]', '[]');
INSERT INTO public.utm_correlation_rules VALUES (488, 'GitHub Action Secret Access Activity', 3, 3, 1, 'Credential Access', 'T1552 - Unsecured Credentials', 'Detects access, modification, or suspicious activities related to GitHub Action secrets. This could indicate attempts to steal credentials, API keys, or other sensitive information stored in repository or organization secrets.

Next Steps:
1. Review the GitHub audit logs to identify who accessed or modified the secrets
2. Check if the user performing the action has legitimate business need for secret access
3. Verify if any secrets were exposed in workflow logs or outputs
4. Rotate any potentially compromised secrets immediately
5. Review repository and organization permissions to ensure proper access controls
6. Check for any unusual API calls or automated scripts accessing secrets
7. Enable secret scanning alerts if not already configured
8. Consider implementing additional controls like environment-specific secrets and approval workflows
', '["https://docs.github.com/en/actions/security-guides/encrypted-secrets","https://attack.mitre.org/techniques/T1552/"]', 'safe("action", "") in ["secret.create", "secret.update", "secret.remove", "org.secret_scanning_alert.create", "repo.secret_scanning_alert.create"] || (safe("log.event", "") in ["secret_scanning_alert", "secret_scanning_alert_location"] && safe("action", "") in ["created", "resolved", "reopened"]) || safe("action", "") in ["actions.secret.create", "actions.secret.update", "actions.secret.remove", "dependabot.secret.create", "dependabot.secret.update", "dependabot.secret.remove"] || (safe("action", "") == "workflows.completed_workflow_run" && safe("log.conclusion", "") == "failure" && safe("log.workflow_name", "") != "")', '2025-09-03 15:23:05.726605', true, false, 'origin', '["log.senderLogin","log.repositoryName","log.action"]', '[{"indexPattern":"v11-log-github-*","with":[{"field":"log.repositoryName.keyword","operator":"filter_term","value":"{{.log.repositoryName}}"},{"field":"log.action.keyword","operator":"filter_match","value":"secret"}],"or":null,"within":"now-1h","count":3}]');
INSERT INTO public.utm_correlation_rules VALUES (489, 'GitHub Advanced Security Feature Change Detected', 3, 3, 2, 'Defense Evasion', 'T1562.001 - Impair Defenses: Disable or Modify Tools', 'Detects changes to GitHub Advanced Security features including code scanning, secret scanning, or dependency review. Unauthorized changes could indicate an attempt to disable security controls before conducting malicious activities.

Next Steps:
1. Verify if the user who made the change (log.senderLogin) is authorized to modify security settings
2. Check the repository (log.repositoryName) to determine if this is a critical or sensitive repository
3. Review the specific action taken (log.action) to understand what security feature was modified
4. Examine recent activity from the same user for other suspicious behavior
5. If unauthorized, immediately revert the security settings and investigate the user''s access
6. Consider implementing branch protection rules to prevent security feature changes
7. Review access logs to determine if the account was compromised
8. Validate that proper approval workflows were followed for security configuration changes
', '["https://docs.github.com/en/code-security/getting-started/github-security-features","https://attack.mitre.org/techniques/T1562/001/"]', 'safe("action", "") in ["security_and_analysis.enable", "security_and_analysis.disable", "advanced_security.enable", "advanced_security.disable", "code_scanning_analysis.delete", "secret_scanning.disable", "secret_scanning.enable"] || (safe("action", "").contains("advanced_security") && safe("action", "").contains("change"))', '2025-09-03 15:23:06.250173', true, false, 'origin', '["log.repositoryName","log.senderLogin"]', '[]');
INSERT INTO public.utm_correlation_rules VALUES (494, 'Fork Permission Changes', 2, 2, 1, 'Discovery', 'T1069 - Permission Groups Discovery', 'Detects changes to fork permissions or unusual forking activity that could indicate attempts to steal source code or create malicious copies of repositories for supply chain attacks.

Next Steps:
1. Review the repository that was forked or had its permissions changed
2. Verify if the user who performed the action has legitimate access to fork repositories  
3. Check if this is part of normal development workflow or an unauthorized action
4. Look for any sensitive code or credentials in the forked repository
5. If suspicious, review the user''s recent GitHub activity for other anomalous behavior
6. Consider revoking fork permissions if unauthorized access is confirmed
7. Examine the destination of the fork and verify the receiving account is legitimate
8. Check organizational policies regarding repository forking and ensure compliance
9. Review repository access logs for any other suspicious activities around the same timeframe
10. If this appears to be part of a coordinated attack, escalate to security team immediately
', '["https://docs.github.com/en/webhooks/webhook-events-and-payloads#fork","https://attack.mitre.org/techniques/T1069/"]', '(safe("action", "") == "created" && safe("log.forkee", "") != "") || (safe("log.repositoryAllowForking", false) == true && safe("action", "") == "edited") || (safe("log.repositoryFork", false) == true && safe("log.repositoryPrivate", false) == false)', '2025-09-03 15:23:09.245499', true, false, 'origin', '["log.repositoryName","log.senderLogin"]', '[]');
INSERT INTO public.utm_correlation_rules VALUES (495, 'GitHub GPG Key Modification Activity', 2, 3, 1, 'Defense Evasion', 'T1553 - Subvert Trust Controls', 'Detects GPG key additions, deletions, or modifications which could indicate attempts to impersonate commits or bypass signature verification. This is critical for maintaining code integrity and preventing supply chain attacks. GPG keys are used to cryptographically sign commits, ensuring the authenticity and integrity of code changes.

Next Steps:
1. Verify if the GPG key modification was authorized by checking with the user
2. Review recent commits signed with the modified key for any suspicious changes
3. Check if the user''s account shows any other suspicious activity (password changes, access from unusual locations)
4. If unauthorized, immediately revoke the GPG key and audit all commits signed with it
5. Review repository access logs for any unusual clone or push activities
6. Consider enforcing commit signature verification requirements on critical repositories
', '["https://docs.github.com/en/authentication/managing-commit-signature-verification","https://attack.mitre.org/techniques/T1553/"]', 'safe("action", "") in ["gpg_key.create", "gpg_key.delete", "gpg_key.update", "gpg_key.verify"] || (safe("log.event", "") == "gpg_key" && safe("action", "") in ["create", "delete", "update"]) || safe("action", "") == "commit.verify_signature"', '2025-09-03 15:23:10.179', true, false, 'origin', '["log.senderLogin","log.action"]', '[]');
INSERT INTO public.utm_correlation_rules VALUES (490, 'GitHub Branch Protection Bypass Detection', 2, 3, 1, 'Defense Evasion', 'T1562.001 - Impair Defenses: Disable or Modify Tools', 'Detects attempts to bypass, disable, or modify branch protection rules which could allow unauthorized code changes to critical branches. Branch protection rules are crucial security controls that prevent direct pushes to important branches, require pull request reviews, and enforce status checks.

Next Steps:
1. Verify if the user who modified the branch protection rules has legitimate administrative privileges
2. Review the specific changes made to the branch protection settings
3. Check for any unauthorized commits or merges that occurred after the protection was modified
4. Audit recent repository access logs for suspicious activities from the same user
5. Consider re-enabling or strengthening branch protection rules if they were weakened
6. Interview the user to understand the business justification for the changes
', '["https://docs.github.com/en/webhooks/webhook-events-and-payloads#branch_protection_rule","https://attack.mitre.org/techniques/T1562/001/"]', '(safe("action", "") == "branch_protection_rule.deleted" || safe("action", "") == "branch_protection_rule.edited" || safe("action", "") == "branch_protection_rule.disabled" || safe("action", "") == "protected_branch.destroy" || safe("action", "") == "protected_branch.update_allow_force_pushes" || safe("action", "") == "protected_branch.update_allow_deletions" || safe("action", "") == "protected_branch.policy_override") && (safe("log.repositoryDefaultBranch", "") != "" || safe("log.repositoryMasterBranch", "") != "" || safe("log.protectedBranch", "") != "" || safe("log.branchName", "").matches("(?i)^(main|master|prod|production|release|develop)$") && safe("log.senderLogin", "") != ""', '2025-09-03 15:23:06.745157', true, false, 'origin', NULL, '[]');
INSERT INTO public.utm_correlation_rules VALUES (501, 'Package Registry Suspicious Events', 3, 3, 1, 'Initial Access', 'T1195.002 - Compromise Software Dependencies and Development Tools', 'Detects suspicious package registry events including unauthorized publishes, deletions, or version changes that could indicate supply chain attacks through malicious package distribution.

Next Steps:
1. Verify if the user who performed the action is authorized to modify packages
2. Check the package content for any malicious code or unexpected changes
3. Review the user''s recent activity for other suspicious package operations
4. Compare package versions to identify what was changed
5. Contact the package owner if the action appears unauthorized
6. Consider temporarily blocking the package if malicious activity is confirmed
', '["https://docs.github.com/en/webhooks/webhook-events-and-payloads#package","https://attack.mitre.org/techniques/T1195/002/"]', '(safe("action", "") in ["published", "updated", "deleted"] && safe("log.package", "") != "") || (safe("log.registry_package", "") != "" && safe("action", "") in ["published", "updated"]) || (safe("log.event", "").contains("package") && safe("action", "") != "")', '2025-09-03 15:23:39.201062', true, false, 'origin', '["log.package","action"]', '[]');
INSERT INTO public.utm_correlation_rules VALUES (491, 'Critical Code Scanning Security Alert', 3, 3, 1, 'Execution', 'T1059 - Command and Scripting Interpreter', 'Detects critical security vulnerabilities identified by GitHub code scanning. These alerts indicate potential security flaws such as SQL injection, XSS, command injection, or other vulnerabilities that could be exploited by attackers.

Next Steps:
1. Review the specific vulnerability details in the GitHub code scanning alert
2. Examine the affected code path and assess the potential impact
3. Check if the vulnerable code is in production or exposed to external users
4. Prioritize fixing critical and high severity vulnerabilities immediately
5. Review the commit history to identify when the vulnerability was introduced
6. Implement security patches following secure coding practices
7. Re-run code scanning after fixes to ensure vulnerabilities are resolved
8. Consider implementing additional security controls and testing for similar vulnerabilities
9. Document the vulnerability and remediation steps for security awareness
', '["https://docs.github.com/en/code-security/code-scanning/managing-code-scanning-alerts/about-code-scanning-alerts","https://attack.mitre.org/techniques/T1059/"]', '(safe("action", "") == "code_scanning_alert.created" || safe("action", "") == "code_scanning_alert.appeared_in_branch" || safe("action", "") == "code_scanning_alert.reopened") && (safe("log.alert.rule.severity", "") == "error" || safe("log.alert.rule.severity", "") == "critical" || safe("log.alert.rule.security_severity_level", "") == "critical" || safe("log.alert.rule.security_severity_level", "") == "high" || safe("log.alert.rule.description", "").contains("injection") || safe("log.alert.rule.description", "").contains("command execution") || safe("log.alert.rule.description", "").contains("XSS")) && safe("log.repositoryName", "") != ""', '2025-09-03 15:23:07.264737', true, false, 'origin', '["log.repositoryName","log.alert.number"]', '[]');
INSERT INTO public.utm_correlation_rules VALUES (492, 'Critical Dependency Vulnerability Detected', 3, 3, 2, 'Initial Access', 'T1190 - Exploit Public-Facing Application', 'Detects high-severity dependency vulnerabilities identified by Dependabot or dependency scanning. These vulnerabilities could be exploited by attackers to compromise applications or gain unauthorized access to systems.

Next Steps:
1. Review the vulnerability details and affected dependencies in the repository
2. Check if the vulnerable dependency is actively used in production code
3. Assess the exploitability and potential impact on your application
4. Apply available patches or upgrade to secure versions immediately
5. If no patch is available, consider implementing compensating controls or removing the dependency
6. Review all repositories using the same dependency for similar vulnerabilities
7. Update dependency management policies to prevent future vulnerable dependencies
', '["https://docs.github.com/en/code-security/dependabot/dependabot-alerts/about-dependabot-alerts","https://attack.mitre.org/techniques/T1190/"]', '(safe("action", "") == "dependabot_alert.created" || safe("action", "") == "dependabot_alert.reintroduced" || safe("action", "") == "vulnerability_alert.create") && (safe("log.alert.severity", "") == "critical" || safe("log.alert.severity", "") == "high" || safe("log.severity", "") == "critical" || safe("log.severity", "") == "high") && safe("log.repositoryName", "") != ""', '2025-09-03 15:23:07.806584', true, false, 'origin', '["log.repositoryName","log.packageName"]', '[]');
INSERT INTO public.utm_correlation_rules VALUES (508, 'HTTP Method Tampering Detected', 2, 3, 1, 'Initial Access', 'T1190 - Exploit Public-Facing Application', 'Detects suspicious HTTP methods that may indicate method tampering or request smuggling attempts. 
Monitors for unusual HTTP verbs like TRACE, CONNECT, OPTIONS, or WebDAV methods that could be used 
to bypass security controls or exploit application vulnerabilities.

Next Steps:
1. Review the specific HTTP method used and the target URL path
2. Check if the application legitimately supports the detected HTTP method
3. Examine the source IP for other suspicious activities
4. Review web application firewall logs for additional context
5. Verify if this represents a legitimate administrative action or potential attack
6. Consider blocking or restricting access to unused HTTP methods at the web server level
', '["https://owasp.org/www-community/attacks/HTTP_Request_Smuggling","https://attack.mitre.org/techniques/T1190/"]', 'safe("log.method", "") != "" && safe("log.method", "") in ["TRACE", "CONNECT", "OPTIONS", "PROPFIND", "PROPPATCH", "MKCOL", "COPY", "MOVE", "LOCK", "UNLOCK", "SEARCH"]', '2025-09-03 15:23:55.683128', true, false, 'origin', '["origin.ip","log.method"]', '[]');
INSERT INTO public.utm_correlation_rules VALUES (509, 'Apache Information Disclosure', 3, 1, 1, 'Collection', 'T1213 - Data from Information Repositories', 'Detects attempts to access sensitive information files on Apache web server including configuration files, environment files, and other sensitive data. This rule identifies successful requests (HTTP 200) to paths containing sensitive files or directories that could expose confidential information.

Next Steps:
1. Review the accessed path and determine if it contains sensitive information
2. Check if the access was authorized and legitimate
3. Verify the source IP and user agent for suspicious patterns
4. Review server logs for additional unauthorized access attempts
5. Ensure proper access controls are in place for sensitive files
6. Consider implementing Web Application Firewall rules to block such requests
7. Review and harden web server configuration to prevent information disclosure
', '["https://owasp.org/www-project-web-security-testing-guide/latest/4-Web_Application_Security_Testing/01-Information_Gathering/","https://attack.mitre.org/techniques/T1213/"]', 'safe("origin.path", "") != "" && ( safe("origin.path", "").contains(".env") || safe("origin.path", "").contains(".git") || safe("origin.path", "").contains(".svn") || safe("origin.path", "").contains(".htaccess") || safe("origin.path", "").contains(".htpasswd") || safe("origin.path", "").contains("web.config") || safe("origin.path", "").contains("phpinfo") || safe("origin.path", "").contains("/config/") || safe("origin.path", "").contains("/admin/") || safe("origin.path", "").contains("/private/") || safe("origin.path", "").contains("/.well-known/") || safe("origin.path", "").contains("/WEB-INF/") || safe("origin.path", "").contains("/META-INF/") || safe("origin.path", "").contains("/.ssh/") || safe("origin.path", "").contains("/.bash_history") || safe("origin.path", "").contains("/proc/") || safe("origin.path", "").contains("/etc/passwd") || safe("origin.path", "").contains("/etc/shadow") ) && safe("log.statusCode", 0.0) == double(200)', '2025-09-03 15:23:56.507994', true, false, 'origin', NULL, '[]');
INSERT INTO public.utm_correlation_rules VALUES (496, 'Large File Upload to GitHub Repository', 2, 3, 3, 'Collection', 'T1074 - Data Staged', 'Detects large file uploads to GitHub repositories which could indicate data exfiltration, storage of malicious payloads, or attempts to abuse repository storage. Attackers may use repositories to stage stolen data or host malware.

Next Steps:
1. Review the repository and uploaded files to determine if they are legitimate
2. Check the user''s recent activity for other suspicious commits or repository changes
3. Verify if the large files contain sensitive data or known malware signatures
4. Review repository permissions and access controls
5. Consider implementing Git LFS (Large File Storage) policies if legitimate large files are needed
6. Contact the user to verify if the upload was intentional
7. If malicious activity is confirmed, revoke user access and remove the compromised files
', '["https://docs.github.com/en/repositories/working-with-files/managing-large-files","https://attack.mitre.org/techniques/T1074/"]', 'safe("action", "") == "push" && safe("log.repositorySize", 0) > 100 && safe("log.repositoryName", "") != "" && (safe("log.size", 0) > 50 || (has(log.commits) && size(safe("log.commits", [])) > 0))', '2025-09-03 15:23:10.846957', true, false, 'origin', '["log.pusherName","log.repositoryName"]', '[{"indexPattern":"v11-log-github-*","with":[{"field":"log.pusherName.keyword","operator":"filter_term","value":"{{.log.pusherName}}"},{"field":"log.repositoryName.keyword","operator":"filter_term","value":"{{.log.repositoryName}}"}],"or":null,"within":"now-30m","count":3}]');
INSERT INTO public.utm_correlation_rules VALUES (497, 'GitHub License Compliance Violation', 1, 3, 1, 'Resource Development', 'Develop Capabilities', 'Detects potential license violations or changes in repository licensing that could lead to legal compliance issues. This includes removal of license files, addition of incompatible dependencies, or changes to repository visibility that may violate license terms.

Next Steps:
1. Review the repository changes to understand what license-related modifications were made
2. Verify if the repository contains proprietary code that requires specific licensing
3. Check if any dependencies have incompatible licenses with the project''s license
4. Contact the repository owner to ensure compliance with licensing requirements
5. If a license was removed, verify this was intentional and not malicious
6. Review organizational policies regarding open source licensing and compliance
7. Examine the commit details to understand the scope of licensing changes
8. Validate that repository visibility changes are authorized and compliant
', '["https://docs.github.com/en/repositories/managing-your-repositorys-settings-and-features/customizing-your-repository/licensing-a-repository","https://attack.mitre.org/techniques/T1587/"]', '(safe("action", "") == "repository.publicized" || safe("action", "") == "repository.privatized" || (safe("action", "") == "push" && (safe("log.headCommitRemoved", "").contains("LICENSE") || safe("log.headCommitRemoved", "").contains("COPYING") || safe("log.headCommitModified", "").contains("LICENSE") || safe("log.headCommitModified", "").contains("package.json") || safe("log.headCommitModified", "").contains("requirements.txt") || safe("log.headCommitModified", "").contains("Gemfile") || safe("log.headCommitModified", "").contains("pom.xml")))) && safe("log.repositoryName", "") != ""', '2025-09-03 15:23:11.485906', true, false, 'origin', NULL, '[]');
INSERT INTO public.utm_correlation_rules VALUES (498, 'GitHub Mass Repository Cloning Detection', 3, 2, 1, 'Collection', 'T1213 - Data from Information Repositories', 'Detects when multiple repositories are cloned or accessed in a short time period, which could indicate data exfiltration or reconnaissance activities. This rule monitors for patterns of repository access that exceed normal user behavior, potentially indicating an insider threat or compromised account attempting to steal source code.

Next Steps:
1. Review the user account activity to determine if this is legitimate behavior
2. Check if the user typically accesses multiple repositories as part of their role
3. Verify if the account shows signs of compromise (unusual login locations, times, or authentication methods)
4. Review which repositories were accessed and determine their sensitivity
5. Contact the user to verify the activity if suspicious
6. Consider temporarily suspending the account if malicious activity is confirmed
7. Review access logs for the specific repositories that were cloned
8. Check for any data downloads or exports from the same user session
', '["https://docs.github.com/en/webhooks/webhook-events-and-payloads#push","https://attack.mitre.org/techniques/T1213/"]', '(safe("action", "") == "push" || safe("action", "") == "clone" || safe("action", "") == "fetch" || safe("action", "") == "pull") && safe("log.repository.clone_url", "") != "" && safe("log.sender.login", "") != ""', '2025-09-03 15:23:37.425', true, false, 'origin', '["log.sender.login"]', '[{"indexPattern":"v11-log-github-*","with":[{"field":"log.sender.login.keyword","operator":"filter_term","value":"{{.log.sender.login}}"},{"field":"log.action.keyword","operator":"filter_match","value":"clone fetch pull"}],"or":null,"within":"now-30m","count":10}]');
INSERT INTO public.utm_correlation_rules VALUES (504, 'Repository Archive or Delete Operations', 2, 3, 3, 'Impact', 'T1485 - Data Destruction', 'Detects when a repository is archived or deleted, which could indicate malicious attempts to destroy code or make repositories unavailable. This could be part of a supply chain attack or insider threat.

Next Steps:
- Verify if the action was authorized and performed by a legitimate user
- Check if the user account shows signs of compromise
- Review recent activities by the same user for other suspicious actions
- Contact the repository owner to confirm if the action was intentional
- If unauthorized, restore the repository from backups if available
- Review access controls and permissions for critical repositories
', '["https://docs.github.com/en/webhooks/webhook-events-and-payloads#repository","https://attack.mitre.org/techniques/T1485/"]', 'safe("action", "") in ["archived", "deleted", "privatized"] && safe("log.repositoryName", "") != ""', '2025-09-03 15:23:41.026392', true, false, 'origin', NULL, '[]');
INSERT INTO public.utm_correlation_rules VALUES (499, 'GitHub OAuth App Installation Activity', 3, 2, 1, 'Defense Evasion, Persistence, Privilege Escalation, Initial Access', 'T1078 - Valid Accounts', 'Detects OAuth app installation or authorization activities in GitHub. This could indicate unauthorized third-party app access to repositories or potential supply chain attacks through malicious OAuth apps.

Next Steps:
1. Verify if the OAuth app installation was authorized by reviewing the app name and permissions requested
2. Check the user who performed the installation (senderLogin) and confirm if they have appropriate privileges
3. Review the repositories affected by the installation
4. Examine the OAuth app''s publisher and verify its legitimacy
5. If unauthorized, immediately revoke the OAuth app access through GitHub settings
6. Review audit logs for any suspicious activities performed by the OAuth app
7. Consider implementing stricter OAuth app installation policies in your GitHub organization
', '["https://docs.github.com/en/webhooks/webhook-events-and-payloads","https://attack.mitre.org/techniques/T1078/"]', 'safe("action", "") in ["oauth_app.create", "oauth_app.destroy", "oauth_app.revoke", "oauth_authorization.create", "oauth_authorization.destroy", "integration_installation.create", "integration_installation.repositories_added"] || (safe("log.event", "") == "installation" && safe("action", "") in ["created", "deleted", "suspend", "unsuspend"]) || (safe("log.event", "") == "installation_repositories" && safe("action", "") in ["added", "removed"])', '2025-09-03 15:23:37.969571', true, false, 'origin', '["safe(\"log.senderLogin\", \"\")","safe(\"action\", \"\")"]', '[]');
INSERT INTO public.utm_correlation_rules VALUES (500, 'GitHub Organization Creation Spikes', 3, 3, 2, 'Impact', 'Resource Hijacking', 'Detects unusual spikes in organization creation which could indicate abuse of enterprise resources or preparation for malicious activities. This could be a sign of an attacker preparing infrastructure for phishing campaigns, malware distribution, or resource abuse.

Next Steps:
- Review the created organizations and their purpose
- Check if the user creating multiple organizations has legitimate business needs
- Verify the user''s authentication logs for any signs of compromise
- Review the organization settings and any repositories created within them
- Check for any suspicious invitations sent from these new organizations
- Consider temporarily suspending the user''s organization creation privileges while investigating
', '["https://docs.github.com/en/webhooks/webhook-events-and-payloads#organization","https://attack.mitre.org/techniques/T1496/"]', 'safe("action", "") == "organization.created" || safe("action", "") == "org.create"', '2025-09-03 15:23:38.585837', true, false, 'origin', NULL, '[{"indexPattern":"v11-log-github-*","with":[{"field":"log.senderLogin.keyword","operator":"filter_term","value":"{{.log.senderLogin}}"},{"field":"log.action.keyword","operator":"filter_term","value":"organization.created"}],"or":null,"within":"now-24h","count":3},{"indexPattern":"v11-log-github-*","with":[{"field":"log.senderLogin.keyword","operator":"filter_term","value":"{{.log.senderLogin}}"},{"field":"log.action.keyword","operator":"filter_term","value":"org.create"}],"or":null,"within":"now-24h","count":3}]');
INSERT INTO public.utm_correlation_rules VALUES (502, 'GitHub Personal Access Token Suspicious Usage', 3, 3, 2, 'Credential Access', 'T1528 - Steal Application Access Token', 'Detects suspicious personal access token (PAT) activities including creation, usage from unusual locations, or multiple token operations. This could indicate compromised credentials or unauthorized access attempts.

Next Steps:
1. Review the user account associated with the PAT activity for any unauthorized access
2. Check if the PAT was created during normal business hours and from expected locations
3. Verify with the user if they authorized the PAT creation or usage
4. Review recent repository access and modifications made using this PAT
5. If unauthorized, immediately revoke the PAT and reset user credentials
6. Enable two-factor authentication if not already enabled
7. Review audit logs for any data exfiltration or unauthorized changes
', '["https://docs.github.com/en/authentication/keeping-your-account-and-data-secure/managing-your-personal-access-tokens","https://attack.mitre.org/techniques/T1528/"]', 'safe("action", "") in ["personal_access_token.create", "personal_access_token.destroy", "personal_access_token.request_created", "personal_access_token.request_approved", "personal_access_token.request_denied"] || (safe("log.programmatic_access_type", "") in ["personal access token", "fine-grained personal access token"] && safe("action", "") in ["git.clone", "git.fetch", "git.push"]) || safe("log.event", "") == "personal_access_token_request"', '2025-09-03 15:23:39.729087', true, false, 'origin', '["log.actor","action"]', '[]');
INSERT INTO public.utm_correlation_rules VALUES (503, 'Release Tampering', 2, 3, 1, 'Initial Access', 'Supply Chain Compromise', 'Detects suspicious modifications to releases including edits, deletions, or rapid changes that could indicate attempts to inject malicious code into software distributions or tamper with release artifacts.

Next Steps:
1. Review the release modification history and identify what changes were made
2. Verify if the user who made the changes has legitimate access and authorization
3. Compare release artifacts before and after the modification for any malicious content
4. Check for any unusual patterns such as rapid edits or deletions followed by re-releases
5. Review the user''s recent activity for other suspicious behaviors
6. If tampering is confirmed, immediately notify the repository owners and consider rolling back changes
7. Audit all downstream systems that may have pulled the tampered release
', '["https://docs.github.com/en/webhooks/webhook-events-and-payloads#release","https://attack.mitre.org/techniques/T1195/"]', 'safe("action", "") in ["edited", "deleted", "unpublished", "prereleased"] && safe("log.release", "") != "" && (safe("log.repository_releases_url", "") != "" || safe("log.event", "").contains("release"))', '2025-09-03 15:23:40.337834', true, false, 'origin', '["log.repository_name","log.release.id"]', '[{"indexPattern":"v11-log-github-*","with":[{"field":"log.repository_name.keyword","operator":"filter_term","value":"{{.log.repository_name}}"},{"field":"action.keyword","operator":"filter_term","value":"edited"}],"or":null,"within":"now-4h","count":3}]');
INSERT INTO public.utm_correlation_rules VALUES (505, 'GitHub Repository Permission Changes', 3, 3, 1, 'Discovery', 'T1069 - Permission Groups Discovery', 'Detects changes to repository permissions including collaborator additions, role changes, or permission modifications. This could indicate unauthorized access attempts or privilege escalation.

Next Steps:
1. Verify if the permission change was authorized by reviewing with the repository owner
2. Check the user who made the change (senderLogin) and confirm their authorization
3. Review the specific permission level granted and ensure it follows the principle of least privilege
4. Check for any suspicious activity from the newly added/modified user account
5. If unauthorized, immediately revoke the permissions and investigate how the change occurred
6. Review audit logs for other unauthorized changes by the same user
', '["https://docs.github.com/en/webhooks/webhook-events-and-payloads#member","https://attack.mitre.org/techniques/T1069/"]', '(safe("action", "") == "member_added" || safe("action", "") == "member_edited" || safe("action", "") == "member_removed" || safe("action", "") == "added" || safe("action", "") == "edited" || safe("action", "") == "removed") && safe("log.repositoryName", "") != "" && safe("log.senderLogin", "") != ""', '2025-09-03 15:23:41.833057', true, false, 'origin', '["log.repositoryName","log.senderLogin"]', '[]');
INSERT INTO public.utm_correlation_rules VALUES (1395, 'Windows: Potential LSASS Memory Dump via PssCaptureSnapShot', 3, 3, 2, 'Credential Access', 'OS Credential Dumping', 'Identifies suspicious access to an LSASS handle via PssCaptureSnapShot where two successive process accesses are performed by the same process and target two different instances of LSASS. This may indicate an attempt to evade detection and dump LSASS memory for credential access.', '["https://attack.mitre.org/tactics/TA0006/","https://attack.mitre.org/techniques/T1003/"]', 'safe("log.winlogEventId", "") == ''10'' && safe("log.eventDataTargetImage", "").matches("([Cc]:\\Windows\\[Ss]ystem32\\lsass.exe)")', '2025-09-04 20:46:20.073694', true, false, 'origin', NULL, '[]');
INSERT INTO public.utm_correlation_rules VALUES (506, 'GitHub SAML SSO Authentication Anomaly', 3, 3, 2, 'Defense Evasion, Persistence, Privilege Escalation, Initial Access', 'T1078: Valid Accounts', 'Detects anomalous SAML SSO authentication events including failures, bypass attempts, or configuration changes. This could indicate unauthorized access attempts or compromise of SAML identity provider.

Next Steps:
1. Review the authentication logs to identify the source of the anomaly and verify if it''s legitimate activity
2. Check if the user account associated with the SAML SSO event has been compromised
3. Verify SAML provider configuration and ensure no unauthorized changes have been made
4. Review organization''s SAML SSO settings in GitHub for any recent modifications
5. Contact the affected user to confirm if they attempted the authentication
6. If malicious activity is confirmed, disable the user''s access and reset SAML configuration
7. Investigate the identity provider logs for signs of compromise
8. Consider implementing additional authentication factors for sensitive operations
', '["https://docs.github.com/en/organizations/managing-saml-single-sign-on-for-your-organization","https://attack.mitre.org/techniques/T1078/"]', 'safe("action", "") in ["saml_sso_auth.failure", "saml_sso_auth.bypass", "saml_sso.update", "saml_sso.disable", "saml_sso.enable", "org.saml_sso_response_auth_failure"] || (safe("action", "").contains("saml") && (safe("action", "").contains("fail") || safe("action", "").contains("error")))', '2025-09-03 15:23:42.78794', true, false, 'origin', '["log.senderLogin","origin.ip"]', '[{"indexPattern":"v11-log-github-*","with":[{"field":"log.senderLogin.keyword","operator":"filter_term","value":"{{.log.senderLogin}}"}],"or":null,"within":"now-30m","count":3}]');
INSERT INTO public.utm_correlation_rules VALUES (939, 'System Linux: File made Immutable by Chattr', 1, 2, 3, 'Defense Evasion', 'File and Directory Permissions Modification', 'Detects a file being made immutable using the chattr binary.  Making a file immutable means it cannot be deleted or renamed, no link can be created to this file,  most of the file is metadata can not be modified, and the file can not be opened in write mode.  Threat actors will commonly utilize this to prevent tampering or modification of their malicious  files or any system files they have modified for purposes of persistence', '["https://attack.mitre.org/tactics/TA0005/","https://attack.mitre.org/techniques/T1222/"]', 'safe("log.message", "").matches("(chattr (\\+|-)i )")', '2025-09-03 16:36:54.761448', true, false, 'origin', NULL, '[]');
INSERT INTO public.utm_correlation_rules VALUES (507, 'GitHub Secret Scanning Alert Detected', 3, 2, 1, 'Credential Access', 'T1552: Unsecured Credentials', 'Detects when GitHub''s secret scanning feature identifies potential secrets, API keys, or credentials committed to a repository. This could indicate inadvertent exposure of sensitive information that could be exploited by attackers.

Next Steps:
1. Immediately review the alert details to identify the exposed secret type and location
2. Rotate or revoke the exposed credential immediately
3. Remove the secret from the repository history using git filter-branch or BFG Repo-Cleaner
4. Audit access logs for any unauthorized use of the exposed credential
5. Review commit history to identify who committed the secret
6. Implement pre-commit hooks to prevent future secret exposures
7. Enable push protection in GitHub to prevent secrets from being pushed
', '["https://docs.github.com/en/code-security/secret-scanning/about-secret-scanning","https://attack.mitre.org/techniques/T1552/"]', 'safe("action", "") == "secret_scanning_alert.created" || safe("action", "") == "secret_scanning.new_alert" || (safe("log.alert_type", "") == "secret" && safe("log.state", "") == "open")', '2025-09-03 15:23:43.44911', true, false, 'origin', NULL, '[]');
INSERT INTO public.utm_correlation_rules VALUES (514, 'HTTP Request Smuggling Attempt', 3, 3, 2, 'Initial Access', 'T1190 - Exploit Public-Facing Application', 'Detects potential HTTP request smuggling attempts by identifying malformed requests with multiple Content-Length headers, Transfer-Encoding anomalies, or suspicious protocol versions that may bypass security controls.

Next Steps:
1. Review the full HTTP request logs for the source IP to identify the exact smuggling technique used
2. Check if the request reached backend servers and what response was returned
3. Examine recent requests from the same source IP for patterns or other attack attempts
4. Verify web application firewall and reverse proxy configurations
5. Check for any successful backend requests that bypassed security controls
6. Review authentication logs for the source IP to identify potential account compromise
7. Consider blocking the source IP if confirmed malicious
', '["https://portswigger.net/web-security/request-smuggling","https://attack.mitre.org/techniques/T1190/"]', '(safe("log.request", "").contains("Content-Length") && safe("log.request", "").contains("Transfer-Encoding")) || (safe("log.request", "").contains("\\r\\n\\r\\n") && safe("log.request", "").contains("HTTP/")) || (safe("log.protoVersion", "") != "" && safe("log.protoVersion", "") != "1.0" && safe("log.protoVersion", "") != "1.1" && safe("log.protoVersion", "") != "2.0") || (safe("origin.path", "").contains("%0d%0a") || safe("origin.path", "").contains("%0D%0A")) || (safe("log.request", "").contains(" HTTP/1.1 ") && safe("log.request", "").contains(" HTTP/"))', '2025-09-03 15:23:59.925295', true, false, 'origin', NULL, '[]');
INSERT INTO public.utm_correlation_rules VALUES (1258, 'DCSync Attack Detection', 3, 3, 1, 'Credential Access', 'T1003.006 - OS Credential Dumping: DCSync', 'Detects DCSync attacks where attackers use directory replication services to retrieve password hashes from domain controllers. 
This technique exploits legitimate Active Directory replication functionality to extract credentials without directly accessing the domain controller''s files.
The rule monitors for specific replication GUIDs associated with credential access operations in Windows Event ID 4662.

Next Steps:
- Immediately verify the legitimacy of the user account performing the replication operation
- Check if the source host is an authorized domain controller or backup system
- Review recent privilege escalation activities for the identified user account
- Examine network traffic for additional signs of credential harvesting
- Consider resetting passwords for high-privilege accounts if compromise is confirmed
- Review domain controller access logs for unauthorized administrative activities
', '["https://attack.mitre.org/techniques/T1003/006/","https://www.ultimatewindowssecurity.com/securitylog/encyclopedia/event.aspx?eventID=4662","https://www.elastic.co/guide/en/security/current/potential-credential-access-via-dcsync.html"]', 'safe("log.eventCode", 0.0) == double(4662) &&
safe("log.winlogChannel", "") == "Security" &&
safe("log.winlogEventDataObjectServer", "") == "DS" &&
(safe("log.winlogEventDataProperties", "").matches(".*1131f6aa-9c07-11d1-f79f-00c04fc2dcd2.*") ||
  safe("log.winlogEventDataProperties", "").matches(".*1131f6ad-9c07-11d1-f79f-00c04fc2dcd2.*") ||
  safe("log.winlogEventDataProperties", "").matches(".*89e95b76-444d-4c62-991a-0facbeda640c.*") ||
  safe("log.winlogEventDataProperties", "").matches(".*19195a5b-6da0-11d0-afd3-00c04fd930c9.*")) &&
!safe("log.winlogEventDataSubjectUserName", "").matches(".*\\$$") &&
!safe("origin.host", "").matches(".*DC.*")
', '2025-09-04 19:28:24.484311', true, false, 'origin', '["origin.user","origin.host"]', '[]');
INSERT INTO public.utm_correlation_rules VALUES (510, 'Apache Log Injection Attack', 2, 3, 2, 'Defense Evasion', 'T1027 - Obfuscated Files or Information: Log Injection', 'Detects attempts to inject malicious content into Apache logs through HTTP requests containing newlines, carriage returns, or other log injection patterns. Attackers may use these techniques to manipulate log files, hide malicious activities, or inject false entries that could mislead security monitoring systems.

Next Steps:
1. Review the specific request details (URL path, User-Agent, Referer) for injection patterns
2. Check if the injection attempt was successful by examining the actual log entries
3. Investigate the source IP for other suspicious activities or previous attacks
4. Verify web application input validation and sanitization controls
5. Review server logs for any evidence of successful log manipulation
6. Consider implementing or enhancing log integrity monitoring
7. Check for any correlated security alerts from the same source
', '["https://owasp.org/www-community/attacks/Log_Injection","https://attack.mitre.org/techniques/T1027/"]', '( safe("origin.path", "") != "" && ( safe("origin.path", "").contains("%0a") || safe("origin.path", "").contains("%0d") || safe("origin.path", "").contains("%0A") || safe("origin.path", "").contains("%0D") || safe("origin.path", "").contains("\\n") || safe("origin.path", "").contains("\\r") || safe("origin.path", "").contains("\n") || safe("origin.path", "").contains("\r") || safe("origin.path", "").contains("%250a") || safe("origin.path", "").contains("%250d") ) ) || ( safe("log.userAgent", "") != "" && ( safe("log.userAgent", "").contains("%0a") || safe("log.userAgent", "").contains("%0d") || safe("log.userAgent", "").contains("%0A") || safe("log.userAgent", "").contains("%0D") || safe("log.userAgent", "").contains("\\n") || safe("log.userAgent", "").contains("\\r") || safe("log.userAgent", "").contains("\n") || safe("log.userAgent", "").contains("\r") || safe("log.userAgent", "").contains("%250a") || safe("log.userAgent", "").contains("%250d") || safe("log.userAgent", "").contains("${") || safe("log.userAgent", "").contains("#{") ) ) || ( safe("log.referer", "") != "" && ( safe("log.referer", "").contains("%0a") || safe("log.referer", "").contains("%0d") || safe("log.referer", "").contains("\\n") || safe("log.referer", "").contains("\\r") ) )', '2025-09-03 15:23:57.138167', true, false, 'origin', NULL, '[]');
INSERT INTO public.utm_correlation_rules VALUES (512, 'Suspicious Apache Module Loading Activity', 2, 3, 2, 'Execution', 'Module Load', 'Detects suspicious access patterns to Apache module files and directories that could indicate attempts to load malicious modules or enumerate server capabilities. This rule identifies requests targeting module directories, configuration files, or server status pages that may indicate reconnaissance or exploitation attempts.

Next Steps:
1. Investigate the source IP for other suspicious activities
2. Review Apache server logs for unauthorized module loading attempts
3. Check if the accessed paths contain legitimate module files
4. Verify server configuration file access patterns
5. Monitor for subsequent privilege escalation attempts
6. Review system integrity and check for unauthorized modifications
', '["https://attack.mitre.org/techniques/T1129/","https://httpd.apache.org/docs/2.4/mod/"]', 'safe("origin.path", "") != "" && ( safe("origin.path", "").contains("/modules/") || safe("origin.path", "").contains("/mods-enabled/") || safe("origin.path", "").contains("/mods-available/") || safe("origin.path", "").contains(".so") || safe("origin.path", "").contains("mod_") || safe("origin.path", "").contains("LoadModule") || (safe("origin.path", "").contains("/cgi-bin/") && safe("log.statusCode", 0.0) == double(200)) || safe("origin.path", "").contains("/server-status") || safe("origin.path", "").contains("/server-info") || safe("origin.path", "").contains("httpd.conf") || safe("origin.path", "").contains("apache2.conf") )', '2025-09-03 15:23:58.364907', true, false, 'origin', '["origin.ip"]', '[]');
INSERT INTO public.utm_correlation_rules VALUES (513, 'Rate Limiting Bypass Attempts', 2, 1, 3, 'Impact', 'Resource Hijacking', 'Detects potential attempts to bypass rate limiting controls through various techniques such as rapid IP rotation, user-agent spoofing, or excessive requests from similar sources. This could indicate automated scanning, brute force attempts, or DDoS preparation.

Next Steps:
- Review the source IP and user agent patterns for signs of automation
- Check if the requests are coming from known malicious IP ranges or VPN/proxy services
- Analyze the request patterns, timing, and frequency to confirm rate limiting bypass attempts
- Examine the specific paths being accessed for sensitive resources or endpoints
- Implement additional rate limiting controls, WAF rules, or block suspicious IPs
- Monitor for follow-up attacks from the same source or related infrastructure
- Consider implementing CAPTCHA or other challenge-response mechanisms
- Review Apache access logs for correlation with other suspicious activities
', '["https://httpd.apache.org/docs/2.4/mod/mod_ratelimit.html","https://attack.mitre.org/techniques/T1496/"]', 'safe("origin.ip", "") != "" && safe("log.statusCode", "") in ["200", "201", "202", "204", "301", "302"] && (safe("log.userAgent", "").contains("curl") || safe("log.userAgent", "").contains("wget") || safe("log.userAgent", "").contains("python") || safe("log.userAgent", "").contains("scanner") || safe("log.userAgent", "") == "-" || safe("log.userAgent", "").size() < 10)', '2025-09-03 15:23:59.30525', true, false, 'origin', '["origin.ip"]', '[{"indexPattern":"v11-log-filebeat-apache-*","with":[{"field":"origin.ip.keyword","operator":"filter_term","value":"{{.origin.ip}}"}],"or":null,"within":"now-1m","count":50}]');
INSERT INTO public.utm_correlation_rules VALUES (515, 'HTTP Response Splitting Attack', 3, 3, 2, 'Initial Access', 'T1190 - Exploit Public-Facing Application', 'Detects HTTP response splitting attacks through identification of CRLF injection attempts in request parameters, headers, and user agents, which could allow attackers to inject arbitrary HTTP headers or content into the response.

Next Steps:
1. Review the request details and identify the injection point
2. Check if the attack was successful by examining response headers
3. Analyze other requests from the same IP for additional attack attempts
4. Verify web application input validation and sanitization controls
5. Consider blocking the source IP if attack patterns continue
6. Review web application firewall rules and configurations
7. Examine the full request including headers and user agent strings
', '["https://owasp.org/www-community/attacks/HTTP_Response_Splitting","https://attack.mitre.org/techniques/T1190/"]', 'safe("origin.path", "").contains("%0d%0a") || safe("origin.path", "").contains("%0D%0A") || safe("origin.path", "").contains("%0d%0aSet-Cookie") || safe("origin.path", "").contains("%0d%0aLocation") || safe("origin.path", "").contains("\\r\\n") || safe("origin.path", "").contains("\\r\\nSet-Cookie") || safe("origin.path", "").contains("\\r\\nLocation") || safe("log.request", "").contains("%0d%0aHTTP/") || safe("log.request", "").contains("\\r\\nHTTP/") || safe("log.userAgent", "").contains("%0d%0a") || safe("log.userAgent", "").contains("\\r\\n") || safe("log.referer", "").contains("%0d%0a") || safe("log.referer", "").contains("\\r\\n") || (safe("log.statusCode", 0.0) == double(400) && (safe("origin.path", "").contains("%0d") || safe("origin.path", "").contains("%0a") || safe("origin.path", "").contains("\\r") || safe("origin.path", "").contains("\\n")))', '2025-09-03 15:24:00.634502', true, false, 'origin', NULL, '[]');
INSERT INTO public.utm_correlation_rules VALUES (516, 'Reverse Proxy Abuse Detection', 3, 3, 2, 'Command and Control', 'T1090 - Proxy', 'Detects potential reverse proxy abuse including Server Side Request Forgery (SSRF) attempts, proxy smuggling, unauthorized proxy usage, or attempts to access internal resources through proxy misconfiguration. This rule identifies suspicious URL patterns, unusual user agents, encoded traversal attempts, and large POST requests to proxy endpoints.

Next Steps:
1. Investigate the source IP and user agent for known malicious activity
2. Review the full request path and parameters for SSRF indicators
3. Check for other requests from the same IP targeting internal resources
4. Verify if the proxy configuration allows the attempted request
5. Examine server logs for any successful proxy abuse or data exfiltration
6. Consider blocking the source IP if malicious intent is confirmed
', '["https://httpd.apache.org/docs/2.4/mod/mod_proxy.html","https://attack.mitre.org/techniques/T1090/"]', '( safe("origin.path", "").contains("@") && (safe("origin.path", "").contains("http://") || safe("origin.path", "").contains("https://") || safe("origin.path", "").contains("gopher://") || safe("origin.path", "").contains("file://")) ) || ( safe("log.userAgent", "").contains("Proxy-") || safe("log.referer", "").contains("unix://") || safe("log.referer", "").contains("dict://") ) || ( safe("origin.path", "").contains("%") && (safe("origin.path", "").contains("%2e%2e") || safe("origin.path", "").contains("%252e") || safe("origin.path", "").contains("%c0%ae")) ) || ( safe("log.method", "") == "POST" && safe("origin.path", "").contains("proxy") && safe("origin.bytesReceived", 0) > 10000 )', '2025-09-03 15:24:00.988934', true, false, 'origin', NULL, '[{"indexPattern":"v11-log-apache-*","with":[{"field":"origin.ip.keyword","operator":"filter_term","value":"{{.origin.ip}}"}],"or":null,"within":"now-10m","count":3}]');
INSERT INTO public.utm_correlation_rules VALUES (1396, 'Windows: Suspicious Managed Code Hosting Process', 3, 3, 2, 'Defense Evasion', 'Process Injection', 'Identifies a suspicious managed code hosting process which could indicate code injection or other form of suspicious code execution.', '["https://attack.mitre.org/tactics/TA0005/","https://attack.mitre.org/techniques/T1055/"]', 'safe("log.winlogEventDataProcessName", "").matches("(wscript.exe|cscript.exe|mshta.exe|wmic.exe|regsvr32.exe|svchost.exe|dllhost.exe|cmstp.exe)")', '2025-09-04 20:46:20.601894', true, false, 'origin', NULL, '[{"indexPattern":"v11-log-wineventlog-*","with":[{"field":"log.winlogEventDataProcessName.keyword","operator":"filter_term","value":"{{.log.winlogEventDataProcessName}}"},{"field":"log.winlogEventdataProcessID.keyword","operator":"filter_term","value":"{{.log.winlogEventdataProcessID}}"}],"or":null,"within":"now-5m","count":3}]');
INSERT INTO public.utm_correlation_rules VALUES (517, 'Apache Server Status Information Exposure', 3, 1, 1, 'Discovery', 'T1082 - System Information Discovery', 'Detects attempts to access Apache server-status pages and other server information endpoints that may expose sensitive configuration and performance data. These endpoints can reveal server architecture, module configuration, active connections, and performance metrics that could be used by attackers for reconnaissance.

Next Steps:
1. Verify if the access was authorized by checking the source IP against known administrative networks
2. Review Apache configuration to ensure status pages are properly restricted
3. Check if mod_status and mod_info modules should be disabled in production
4. Investigate any subsequent suspicious activities from the same IP address
5. Consider implementing IP whitelisting for status endpoints
6. Review access logs for patterns of information gathering attempts
', '["https://httpd.apache.org/docs/2.4/mod/mod_status.html","https://attack.mitre.org/techniques/T1082/"]', 'safe("origin.path", "") != "" && ( safe("origin.path", "").contains("/server-status") || safe("origin.path", "").contains("/server-info") || safe("origin.path", "").contains("/status") || safe("origin.path", "").contains("/apache-status") || safe("origin.path", "").contains("/mod_status") || safe("origin.path", "").contains("/server-stats") || safe("origin.path", "").contains("/stats") || safe("origin.path", "").contains("/info.php") || safe("origin.path", "").contains("/test.php") || safe("origin.path", "").contains("/phpinfo.php") || safe("origin.path", "").contains("/info.html") || safe("origin.path", "").contains("/server-monitor") || safe("origin.path", "").contains("/monitor") || safe("origin.path", "").contains("/balancer-manager") || safe("origin.path", "").contains("/ldap-status") || safe("origin.path", "").contains("/perl-status") ) && safe("log.statusCode", 0.0) == double(200) && safe("origin.ip", "") != "" && !safe("origin.ip", "").startsWith("10.") && !safe("origin.ip", "").startsWith("172.16.") && !safe("origin.ip", "").startsWith("192.168.") &&  !safe("origin.ip", "").startsWith("127.")', '2025-09-03 15:24:02.014832', true, false, 'origin', '["origin.ip","origin.path"]', '[]');
INSERT INTO public.utm_correlation_rules VALUES (1259, 'Event Log Clearing Detection', 3, 3, 2, 'Defense Evasion', 'T1070.001 - Indicator Removal on Host: Clear Windows Event Logs', 'Detects when Windows event logs are cleared, which is often done by attackers to cover their tracks and remove evidence of malicious activities. This rule monitors for Event ID 1102 (Security log cleared), Event ID 104 (System log cleared), and command-line activities using wevtutil or PowerShell cmdlets to clear event logs.

Next Steps:
1. Identify the user account that performed the log clearing operation
2. Review the timeline of events before the log clearing to identify potential malicious activities
3. Check for any remaining forensic artifacts in other log sources (network logs, endpoint logs, etc.)
4. Investigate if this was authorized maintenance or potential malicious activity
5. Review user privileges and access patterns for the account involved
6. Consider implementing additional logging and monitoring for critical systems
', '["https://attack.mitre.org/techniques/T1070/001/","https://www.ultimatewindowssecurity.com/securitylog/encyclopedia/event.aspx?eventid=1102"]', 'safe("log.eventCode", 0.0) == double(1102) ||
safe("log.eventCode", 0.0) == double(1102) ||
(safe("log.eventCode", 0.0) == double(104) &&
 safe("log.winlogChannel", "").contains("System")) ||
(safe("log.eventCode", 0.0) == double(4688) &&
 (safe("log.winlogEventDataCommandLine", "").contains("wevtutil") &&
  safe("log.winlogEventDataCommandLine", "").contains(" cl ")) ||
 (safe("log.winlogEventDataCommandLine", "").contains("Clear-EventLog") ||
  safe("log.winlogEventDataCommandLine", "").contains("Remove-EventLog") ||
  safe("log.winlogEventDataCommandLine", "").contains("Limit-EventLog")))
', '2025-09-04 19:28:25.410487', true, false, 'origin', '["target.host","target.user"]', '[]');
INSERT INTO public.utm_correlation_rules VALUES (1260, 'GPO Tampering Detection', 2, 3, 2, 'Defense Evasion, Privilege Escalation', 'T1484.001 - Domain Policy Modification: Group Policy Modification', 'Detects modifications to Group Policy Objects (GPOs) which could indicate an adversary attempting to escalate privileges, deploy malware across the domain, or establish persistence. GPO tampering is a common technique used by attackers to enforce malicious configurations or deploy payloads to multiple systems simultaneously.

**Next Steps:**
1. Immediately review the specific GPO that was modified and identify what changes were made
2. Verify if the modification was authorized by checking with the responsible administrator
3. Examine the user account that made the changes for signs of compromise
4. Review recent authentication logs for the user account to identify potential lateral movement
5. Check domain controllers for additional suspicious activities around the same timeframe
6. If unauthorized, immediately revert the GPO changes and investigate the compromise vector
7. Consider temporarily disabling the affected user account pending investigation
', '["https://learn.microsoft.com/en-us/windows-server/identity/ad-ds/manage/component-updates/command-line-process-auditing","https://attack.mitre.org/techniques/T1484/001/"]', 'safe("log.eventCode", 0.0) == double(5136) && safe("log.winlogProviderName", "") == "Microsoft-Windows-Security-Auditing" && safe("log.winlogEventDataObjectDN", "").contains("CN=Policies,CN=System")', '2025-09-04 19:28:26.081746', true, false, 'origin', '["origin.user","origin.host"]', '[]');
INSERT INTO public.utm_correlation_rules VALUES (1349, 'Windows: Logon failure - Account locked out', 3, 3, 2, 'Potentially Malicious Activity', 'Account Access Removal', 'Adversaries may interrupt availability of system and network resources  by inhibiting access to accounts utilized by legitimate users.  Accounts may be deleted, locked, or manipulated (ex: changed credentials) to remove access to accounts.  Adversaries may also subsequently log off and/or perform a System Shutdown/Reboot to set malicious changes into place.', '["https://attack.mitre.org/techniques/T1531/"]', 'safe("log.eventCode", 0.0) == double(4740) || (safe("log.eventCode", 0.0) == double(4625) && safe("log.winlogEventDataFailureReason", "").contains("account is currently locked out"))', '2025-09-04 20:24:35.893425', true, false, 'origin', NULL, '[]');
INSERT INTO public.utm_correlation_rules VALUES (1469, 'Windows Defender: ERROR: QUARANTINE FAILED', 1, 2, 3, 'Potentially Compromised System', 'User Execution', 'Detects the ''QUARANTINE FAILED'' error event in Windows Defender, which may indicate issues with the quarantine process.', '["https://learn.microsoft.com/en-us/windows/security/threat-protection/windows-defender-antivirus/troubleshoot"]', 'safe("log.winlogEventDataLogName", "") == "Microsoft-Windows-Windows Defender/Operational" &&  safe("log.winlogEventDataErrorCode", "") == "0x805080211"', '2025-09-04 21:12:12.014771', true, false, 'target', NULL, '[]');
INSERT INTO public.utm_correlation_rules VALUES (518, 'GitHub Sensitive Data Commit Detection', 3, 2, 1, 'Collection', 'T1074 - Data Staged', 'Detects commits that may contain sensitive data such as API keys, passwords, private keys, or other credentials based on commit message patterns or file names.

Next Steps:
1. Review the commit content to verify if sensitive data was actually exposed
2. Check the repository visibility (public vs private)
3. If confirmed, immediately rotate any exposed credentials
4. Remove the sensitive data from repository history using git filter-branch or BFG Repo-Cleaner
5. Enable GitHub secret scanning for the repository
6. Review repository access logs to determine if the exposed data was accessed
7. Implement pre-commit hooks to prevent future credential commits
', '["https://docs.github.com/en/webhooks/webhook-events-and-payloads#push","https://attack.mitre.org/techniques/T1074/"]', 'safe("action", "") == "push" && safe("log.headCommitMessage", "") != "" && (safe("log.headCommitMessage", "").contains("password") || safe("log.headCommitMessage", "").contains("passwd") || safe("log.headCommitMessage", "").contains("pwd") || safe("log.headCommitMessage", "").contains("secret") || safe("log.headCommitMessage", "").contains("key") || safe("log.headCommitMessage", "").contains("token") || safe("log.headCommitMessage", "").contains("api_key") || safe("log.headCommitMessage", "").contains("apikey") || safe("log.headCommitMessage", "").contains("credential") || safe("log.headCommitMessage", "").contains("auth") || safe("log.headCommitMessage", "").contains("private_key") || safe("log.headCommitMessage", "").contains("ssh_key") || safe("log.headCommitMessage", "").contains("access_key") || safe("log.headCommitMessage", "").contains("bearer") || safe("log.headCommitAdded", "").contains(".env") || safe("log.headCommitAdded", "").contains(".pem") || safe("log.headCommitAdded", "").contains(".key") || safe("log.headCommitAdded", "").contains(".p12") || safe("log.headCommitAdded", "").contains(".pfx") || safe("log.headCommitAdded", "").contains("id_rsa") || safe("log.headCommitAdded", "").contains("id_dsa") || safe("log.headCommitAdded", "").contains("credentials") || safe("log.headCommitAdded", "").contains("secrets") || safe("log.headCommitAdded", "").contains("password") || safe("log.headCommitModified", "").contains(".env") || safe("log.headCommitModified", "").contains(".pem") || safe("log.headCommitModified", "").contains(".key") || safe("log.headCommitModified", "").contains(".p12") || safe("log.headCommitModified", "").contains(".pfx") || safe("log.headCommitModified", "").contains("id_rsa") || safe("log.headCommitModified", "").contains("id_dsa") || safe("log.headCommitModified", "").contains("credentials") || safe("log.headCommitModified", "").contains("secrets") || safe("log.headCommitModified", "").contains("password"))', '2025-09-03 15:24:10.350622', true, false, 'origin', '["log.headCommitId","log.repositoryName"]', '[]');
INSERT INTO public.utm_correlation_rules VALUES (1459, 'Windows Defender: ERROR: CODE ASYNC CALL PENDING', 1, 2, 3, 'Potentially Compromised System', 'User Execution', 'Detects the ''CODE ASYNC CALL PENDING'' error event in Windows Defender, which may indicate protection issues on the system.', '["https://learn.microsoft.com/en-us/windows/security/threat-protection/windows-defender-antivirus/troubleshoot"]', 'safe("log.winlogEventDataLogName", "") == "Microsoft-Windows-Windows Defender/Operational" &&  safe("log.winlogEventDataErrorCode", "") == "0x80501103"', '2025-09-04 21:02:19.243502', true, false, 'target', NULL, '[]');
INSERT INTO public.utm_correlation_rules VALUES (519, 'GitHub SSH Key Management Activity', 3, 3, 2, 'Persistence, Privilege Escalation', 'Account Manipulation', 'Detects SSH key additions, modifications, or suspicious usage patterns. This could indicate an attacker establishing persistence through SSH keys or unauthorized access to repositories.

Next Steps:
1. Verify if the SSH key activity was authorized by checking with the user who performed the action
2. Review the user''s recent activity for any other suspicious actions
3. Check if the SSH key was immediately used to access sensitive repositories
4. If unauthorized, immediately revoke the SSH key through GitHub settings
5. Review audit logs for any data access or modifications made using the compromised key
6. Consider enforcing SSH key rotation policies and requiring additional authentication for key management
', '["https://docs.github.com/en/authentication/connecting-to-github-with-ssh","https://attack.mitre.org/techniques/T1098/"]', 'safe("action", "") in ["public_key.create", "public_key.delete", "public_key.update", "public_key.verify"] || (safe("log.event", "") == "public_key" && safe("action", "") in ["create", "delete"]) || (safe("log.programmatic_access_type", "") in ["ssh key", "deploy key"] && safe("action", "") in ["git.clone", "git.fetch", "git.push"]) || safe("action", "") in ["repo.add_deploy_key", "repo.remove_deploy_key"]', '2025-09-03 15:24:11.068905', true, false, 'origin', '["log.senderLogin","log.repositoryName"]', '[]');
INSERT INTO public.utm_correlation_rules VALUES (520, 'GitHub Webhook Modification Detection', 3, 3, 2, 'Privilege Escalation, Persistence', 'T1546 - Event Triggered Execution', 'Detects modifications to webhook configurations which could be used to establish persistence, exfiltrate data, or redirect sensitive information to unauthorized endpoints. Webhooks can be abused to send repository data to attacker-controlled servers whenever specific events occur.

Next Steps:
1. Review the webhook URL and verify it points to a legitimate, authorized endpoint
2. Check the webhook events and ensure they are appropriate for business needs
3. Verify the user who made the modification has authorization to manage webhooks
4. Review the webhook payload configuration for any sensitive data exposure
5. Check for any other webhook modifications by the same user across different repositories
6. If suspicious, disable the webhook immediately and investigate the user''s recent activities
7. Review webhook access logs on the destination server if available
', '["https://docs.github.com/en/webhooks/webhook-events-and-payloads#webhook","https://attack.mitre.org/techniques/T1546/"]', '(safe("action", "") == "created" || safe("action", "") == "edited" || safe("action", "") == "deleted" || safe("action", "") == "hook.created" || safe("action", "") == "hook.edited" || safe("action", "") == "hook.deleted") && (safe("log.repositoryHooksUrl", "") != "" || safe("log.hook", "") != "") && safe("log.senderLogin", "") != ""', '2025-09-03 15:24:11.69156', true, false, 'origin', '["log.repositoryName","log.senderLogin"]', '[{"indexPattern":"v11-log-github-*","with":[{"field":"log.repositoryName.keyword","operator":"filter_term","value":"{{.log.repositoryName}}"},{"field":"log.senderLogin.keyword","operator":"filter_term","value":"{{.log.senderLogin}}"}],"or":null,"within":"now-1h","count":3}]');
INSERT INTO public.utm_correlation_rules VALUES (521, 'Wiki Modifications', 2, 3, 1, 'Defense Evasion', 'T1070 - Indicator Removal', 'Detects modifications to repository wikis which could be used to spread misinformation, hide malicious documentation, or remove important security guidelines and procedures. This rule monitors wiki page creation, editing, and deletion events.

Next Steps:
1. Review the modified wiki pages and their content changes
2. Verify if the user has legitimate permissions to modify wiki content
3. Check the user''s recent activity for other suspicious wiki modifications
4. Review the content that was added, modified, or deleted for malicious content
5. If unauthorized, revert the changes and investigate the user account
6. Consider implementing wiki access controls and approval workflows
', '["https://docs.github.com/en/webhooks/webhook-events-and-payloads#gollum","https://attack.mitre.org/techniques/T1070/"]', 'safe("action", "") in ["created", "edited", "destroyed"] && (safe("log.event", "").contains("gollum") || safe("log.pages", "") != "")', '2025-09-03 15:24:12.310941', true, false, 'origin', '["log.repositoryName","log.senderLogin"]', '[{"indexPattern":"v11-log-github-*","with":[{"field":"log.senderLogin.keyword","operator":"filter_term","value":"{{.log.senderLogin}}"},{"field":"log.repositoryName.keyword","operator":"filter_term","value":"{{.log.repositoryName}}"},{"field":"log.action.keyword","operator":"filter_term","value":"{{.log.action}}"}],"or":null,"within":"now-1h","count":5}]');
INSERT INTO public.utm_correlation_rules VALUES (523, 'SSL Certificate Validation Bypass Attempts', 3, 3, 2, 'Defense Evasion', 'T1562.001 - Impair Defenses: Disable or Modify Tools', 'Detects potential SSL certificate validation bypass attempts including access to SSL-protected resources without proper authentication, suspicious SSL renegotiation patterns, or attempts to exploit SSL configuration weaknesses. This rule identifies suspicious access patterns to secure paths using insecure protocols or outdated SSL versions.

Next Steps:
1. Review the specific URL path accessed and determine if it should require SSL/TLS encryption
2. Check Apache SSL configuration for the accessed virtual host or directory
3. Verify if the client is attempting to access HTTPS-only resources over HTTP
4. Examine the user agent string for signs of SSL version downgrade attacks
5. Review SSL certificate validity and configuration on the target server
6. Check for any SSL renegotiation vulnerabilities in the Apache configuration
7. Monitor for additional attempts from the same source IP
8. Consider implementing HTTP Strict Transport Security (HSTS) headers
', '["https://httpd.apache.org/docs/2.4/ssl/ssl_howto.html","https://attack.mitre.org/techniques/T1562/001/"]', '( safe("log.statusCode", 0.0) == double(200) && (safe("log.request", "").contains("/secure/") || safe("log.request", "").contains("/admin/") || safe("log.request", "").contains("/private/")) ) && ( safe("protocol", "") == "HTTP" || safe("log.protoVersion", "") == "1.0" || (safe("log.userAgent", "").contains("SSLv2") || safe("log.userAgent", "").contains("SSLv3")) ) || ( safe("log.statusCode", 0.0) == double(403) && (safe("log.request", "").contains("ssl-cert") || safe("log.request", "").contains("certificate")) )', '2025-09-03 15:26:11.619303', true, false, 'origin', '["origin.ip","log.request"]', '[]');
INSERT INTO public.utm_correlation_rules VALUES (528, 'IBM AIX Compliance Monitoring Alerts', 2, 3, 1, 'Discovery', 'T1518.001 - Security Software Discovery', 'Detects compliance monitoring events and security policy violations in IBM AIX systems, including failed security checks, policy exceptions, and compliance scan failures.

Next Steps:
1. Review the specific compliance failure or policy violation in the log details
2. Check if the user account involved has appropriate permissions for the attempted action
3. Verify if this is a legitimate security check or potential security bypass attempt
4. Review audit logs for any related suspicious activities from the same user or host
5. If audit command failed (returnCode != 0), investigate what audit operation was attempted
6. Check system compliance status and ensure all security policies are properly configured
', '["https://www.ibm.com/docs/en/aix/7.2?topic=subsystem-compliance-monitoring","https://attack.mitre.org/techniques/T1518/001/"]', '(safe("log.eventType", "") == "COMPLIANCE_FAIL" || safe("log.eventType", "") == "POLICY_VIOLATION") || (safe("log.msg", "").contains("compliance") && (safe("log.msg", "").contains("failed") || safe("log.msg", "").contains("violation"))) || (safe("action", "") == "AUDIT" && safe("log.returnCode", "") != "0") || (safe("log.commandType", "") == "audit" && safe("log.returnCode", "") != "0")', '2025-09-03 15:27:55.468166', true, false, 'origin', '["origin.user","from.host"]', '[]');
INSERT INTO public.utm_correlation_rules VALUES (539, 'IBM AIX Network Security Violation Detected', 3, 2, 3, 'Lateral Movement', 'T1210 - Exploitation of Remote Services', 'Identifies suspicious network activities and security violations in IBM AIX systems, including unauthorized remote access attempts, abnormal port usage, and potential network-based attacks from external sources. This rule detects SSH brute force attempts, connection refusals, invalid user attempts, and network-related failures.

Next Steps:
1. Investigate the source IP address for reputation and geographic location
2. Check authentication logs for additional failed attempts from the same source
3. Review network traffic patterns and connection attempts
4. Verify if the target service should be accessible from the source location
5. Check for any successful logins from the same IP after failed attempts
6. Review firewall rules and access control lists
7. Consider implementing rate limiting or IP blocking if malicious activity is confirmed
', '["https://www.ibm.com/support/pages/aix-audit-audit-subsystem-aix","https://attack.mitre.org/techniques/T1210/"]', '(safe("log.eventType", "") == "sshd" && safe("log.msg", "").contains("Failed") && safe("origin.ip", "") != "") || (safe("origin.port", 0) > 1024 && safe("origin.port", 0) < 65535 && safe("log.msg", "").contains("refused")) || (safe("protocol", "") == "ssh" && safe("log.msg", "").contains("Invalid user")) || (safe("log.eventType", "").contains("network") && safe("log.returnCode", "") != "0")', '2025-09-03 15:28:31.040271', true, false, 'origin', NULL, '[]');
INSERT INTO public.utm_correlation_rules VALUES (524, 'Virtual Host Tampering Detection', 2, 3, 2, 'Lateral Movement', 'T1210 - Exploitation of Remote Services', 'Detects potential virtual host tampering attempts through suspicious Host header manipulation, mismatched virtual host requests, or attempts to access internal virtual hosts. This could indicate an attacker trying to bypass access controls or access restricted resources.

Next Steps:
1. Review the specific request details including URL path, user agent, and referer header
2. Check if the source IP has made other suspicious requests recently
3. Verify if the requested path contains directory traversal attempts
4. Examine server logs for any unauthorized access to configuration files
5. Consider blocking the source IP if confirmed malicious
6. Review virtual host configurations for potential misconfigurations
7. Analyze the Host header value for suspicious patterns or internal hostnames
8. Check for any successful responses (200) to suspicious requests that should have been blocked
', '["https://httpd.apache.org/docs/2.4/vhosts/","https://attack.mitre.org/techniques/T1210/"]', '( safe("log.referer", "") != "" && (safe("log.referer", "").contains("localhost") || safe("log.referer", "").contains("127.0.0.1") || safe("log.referer", "").contains("internal") || safe("log.referer", "").contains("192.168.") || safe("log.referer", "").contains("10.0.")) ) || ( safe("log.request", "").contains("../") && safe("log.statusCode", 0.0) == double(200) ) || ( safe("log.userAgent", "").contains("Host:") && safe("log.userAgent", "").contains("\r\n") ) || ( safe("log.request", "").contains("/admin") && safe("log.referer", "") == "" && safe("log.statusCode", 0.0) == double(200) )', '2025-09-03 15:26:12.365118', true, false, 'origin', '["origin.ip","origin.path"]', '[]');
INSERT INTO public.utm_correlation_rules VALUES (525, 'WebDAV Vulnerability Exploitation', 3, 3, 2, 'Lateral Movement', 'T1210 - Exploitation of Remote Services', 'Detects attempts to exploit WebDAV vulnerabilities including unauthorized file uploads, LOCK method abuse for denial of service, PROPFIND information disclosure, or attempts to modify server configuration through WebDAV.

Next Steps:
1. Review the source IP and user agent for signs of automated scanning or exploitation tools
2. Check if WebDAV is legitimately enabled and required on the affected server
3. Examine the specific files or paths being targeted for malicious content
4. Verify authentication logs for any unauthorized access attempts
5. Review server configurations to ensure WebDAV permissions are properly restricted
6. Consider disabling WebDAV if not required for business operations
7. Implement additional access controls and monitoring for WebDAV endpoints
8. Check for any successful file uploads or modifications in the targeted directories
', '["https://httpd.apache.org/docs/2.4/mod/mod_dav.html","https://attack.mitre.org/techniques/T1210/"]', '( safe("log.method", "") == "PUT" && ( safe("log.request", "").endsWith(".php") || safe("log.request", "").endsWith(".jsp") || safe("log.request", "").endsWith(".asp") || safe("log.request", "").endsWith(".aspx") || safe("log.request", "").endsWith(".exe") || safe("log.request", "").endsWith(".sh") || safe("log.request", "").endsWith(".pl") ) ) || ( safe("log.method", "") in ["PROPFIND", "PROPPATCH", "MKCOL", "COPY", "MOVE", "LOCK", "UNLOCK"] ) || ( safe("log.request", "").contains("_vti_") || safe("log.request", "").contains("/_dav/") || safe("log.request", "").contains("/webdav/") ) || ( safe("log.method", "") == "DELETE" && ( safe("log.request", "").contains(".htaccess") || safe("log.request", "").contains("web.config") || safe("log.request", "").contains(".htpasswd") ) )', '2025-09-03 15:26:12.956052', true, false, 'origin', '["origin.ip","log.method"]', '[]');
INSERT INTO public.utm_correlation_rules VALUES (526, 'Web Server Compromise Indicators', 3, 3, 2, 'Persistence', 'T1505.003 - Server Software Component: Web Shell', 'Detects indicators of web server compromise through suspicious file access patterns commonly associated with web shells and backdoors. This rule identifies requests to potentially malicious files with suspicious names or in upload directories that could indicate successful deployment of web shells.

Next Steps:
1. Immediately investigate the requested file path and verify if the file exists on the web server
2. Check the source IP for other suspicious activity and recent access patterns
3. Review web server logs around the time of the request for additional indicators
4. Scan the web server for web shells and malicious files, particularly in upload directories
5. If confirmed malicious, isolate the affected server and initiate incident response procedures
6. Review application security controls and file upload mechanisms
', '["https://attack.mitre.org/techniques/T1505/003/","https://httpd.apache.org/docs/2.4/logs.html"]', 'safe("log.request", "") != "" && safe("log.statusCode", 0.0) == double(200) && ( safe("log.request", "").contains(".php") && ( safe("log.request", "").contains("shell") || safe("log.request", "").contains("c99") || safe("log.request", "").contains("r57") || safe("log.request", "").contains("wso") || safe("log.request", "").contains("b374k") || safe("log.request", "").contains("eval") || safe("log.request", "").contains("base64") ) || safe("log.request", "").matches(".*\\.(jsp|jspx|asp|aspx|ashx|asmx)$") && ( safe("log.request", "").contains("cmd") || safe("log.request", "").contains("shell") || safe("log.request", "").contains("upload") ) || safe("log.request", "").contains("/uploads/") && safe("log.request", "").matches(".*\\.(php|jsp|asp|aspx)$") )', '2025-09-03 15:26:13.531787', true, false, 'origin', NULL, '[]');
INSERT INTO public.utm_correlation_rules VALUES (527, 'Apache Source Code Disclosure', 3, 1, 1, 'Collection', 'Source Code Exposure', 'Detects attempts to directly access source code files that should not be publicly accessible, including programming language files, configuration files, and development files. This activity could indicate reconnaissance attempts or configuration errors that expose sensitive application files.

Next Steps:
1. Verify if the accessed files contain sensitive information or source code
2. Check web server configuration to ensure proper file access restrictions
3. Review the requesting IP for other suspicious activities
4. Implement proper access controls for development and configuration files
5. Consider moving sensitive files outside the web root directory
', '["https://owasp.org/www-community/vulnerabilities/Source_code_disclosure","https://attack.mitre.org/techniques/T1005/"]', 'safe("origin.path", "") != "" && ( origin.path.endsWith(".php") || origin.path.endsWith(".asp") || origin.path.endsWith(".aspx") || origin.path.endsWith(".jsp") || origin.path.endsWith(".py") || origin.path.endsWith(".rb") || origin.path.endsWith(".pl") || origin.path.endsWith(".cgi") || origin.path.endsWith(".inc") || origin.path.endsWith(".java") || origin.path.endsWith(".class") || origin.path.endsWith(".cs") || origin.path.endsWith(".vb") || origin.path.endsWith(".config") || origin.path.endsWith(".properties") || origin.path.endsWith(".yml") || origin.path.endsWith(".yaml") || origin.path.endsWith(".toml") || origin.path.endsWith(".ini") ) && safe("log.statusCode", 0.0) == double(200) && safe("log.userAgent", "") != "" &&  !safe("log.userAgent", "").contains("Googlebot") && !safe("log.userAgent", "").contains("bingbot")', '2025-09-03 15:26:14.523931', true, false, 'origin', NULL, '[]');
INSERT INTO public.utm_correlation_rules VALUES (947, 'System Linux: Kernel Module Removal', 1, 3, 3, 'Defense Evasion', 'Disable or Modify Tools', 'Kernel modules are pieces of code that can be loaded and unloaded into the kernel upon demand. They extend the functionality of the kernel without the need to reboot the system. This rule identifies attempts to remove a kernel module.', '["https://attack.mitre.org/tactics/TA0005/","https://attack.mitre.org/techniques/T1562/001/"]', 'safe("log.message", "").matches("(modprobe(.+)sudo(.+)(-r|--remove)|modprobe(.+)(-r|--remove)(.+)sudo|sudo(.+)modprobe(.+)(-r|--remove)|sudo(.+)(-r|--remove)(.+)modprobe|(-r|--remove)modprobe(.+)sudo|(-r|--remove)(.+)sudo(.+)modprobe)")', '2025-09-03 16:37:31.480126', true, false, 'origin', NULL, '[]');
INSERT INTO public.utm_correlation_rules VALUES (529, 'IBM AIX Core Dump Security Analysis', 3, 2, 3, 'Defense Evasion, Privilege Escalation', 'T1055 - Process Injection', 'Detects and analyzes core dump events in IBM AIX that could indicate process crashes due to exploitation attempts, buffer overflows, or malicious code execution. Core dumps can be signs of:
- Buffer overflow exploitation attempts
- Process injection techniques
- Memory corruption attacks
- System instability from malicious activity

Next Steps:
1. Identify the process that created the core dump from log.pid and log.objName fields
2. Review the process command line and user context from origin.user
3. Check if the core dump was from a critical system process or user application
4. Analyze the core dump file if available to determine the cause of the crash
5. Look for any suspicious activity from the same user or process before the crash
6. Verify if this is a known application issue or potential security incident
7. If suspicious, isolate the affected system and conduct forensic analysis
', '["https://www.halock.com/configuring-log-event-source-series-ibm-aix/","https://attack.mitre.org/techniques/T1055/"]', '(safe("log.eventType", "") != "" && (safe("log.eventType", "").toLowerCase().contains("core") || safe("log.eventType", "").toLowerCase().contains("dump") || safe("log.eventType", "").toLowerCase().contains("segfault") || safe("log.eventType", "").toLowerCase().contains("sigsegv"))) || (safe("log.msg", "") != "" && (safe("log.msg", "").toLowerCase().contains("core dumped") || safe("log.msg", "").toLowerCase().contains("segmentation fault") || safe("log.msg", "").toLowerCase().contains("memory violation") || safe("log.msg", "").toLowerCase().contains("buffer overflow"))) || (safe("origin.command", "") != "" && safe("origin.command", "").toLowerCase().contains("core"))', '2025-09-03 15:27:56.358032', true, false, 'origin', '["origin.user","log.pid","target.host"]', '[]');
INSERT INTO public.utm_correlation_rules VALUES (530, 'IBM AIX Encrypted File System Access Violation', 3, 3, 1, 'Impact', 'T1486 - Data Encrypted for Impact', 'Detects unauthorized access or manipulation attempts on encrypted file systems in IBM AIX, including cryptographic configuration changes and encrypted file operations that may indicate data theft or ransomware activities.

Next Steps:
1. Review the user account associated with the alert to verify if the access was authorized
2. Check the specific object name (log.objName) to identify which encrypted files or directories were accessed
3. Examine the return code to determine if the operation was successful or failed
4. Review recent user activity for the same account to identify patterns of suspicious behavior
5. Check system logs for any crypto-related commands or configuration changes
6. Verify if there are any scheduled maintenance activities that could explain the encrypted filesystem access
7. If unauthorized, immediately disable the user account and initiate incident response procedures
8. Check for signs of data exfiltration or encryption of additional files
9. Verify system integrity and run malware scans if ransomware is suspected
', '["https://www.ibm.com/docs/en/ssw_aix_72/security/audit_events.html","https://attack.mitre.org/techniques/T1486/"]', 'safe("log.eventType", "") == "CY" || (safe("log.msg", "").contains("encrypt") && (safe("action", "").contains("FILE_") || safe("log.commandType", "").contains("crypto"))) || (safe("log.objName", "").contains("/efs/") && safe("log.returnCode", "") != "0")', '2025-09-03 15:27:56.848841', true, false, 'origin', NULL, '[]');
INSERT INTO public.utm_correlation_rules VALUES (531, 'IBM AIX Enhanced RBAC Privilege Abuse', 3, 3, 2, 'Defense Evasion, Persistence, Privilege Escalation, Initial Access', 'T1078 - Valid Accounts', 'Detects abuse of Enhanced RBAC features in IBM AIX 7.1+, including excessive use of privileged commands, unauthorized role switching, or suspicious patterns in RBAC command execution.

Next Steps:
1. Review the user account that triggered this alert - verify if they have legitimate access to execute these privileged commands
2. Check the specific commands executed (lspv, lsvg, lsdev, lscfg, lsattr) to understand what system information was accessed
3. Review audit logs for any role changes or privilege modifications around the same timeframe
4. If USER_Role events with non-zero return codes are detected, investigate failed role switching attempts
5. Check if the user ID differs from the OS user ID, which may indicate privilege escalation
6. Contact the user or their manager to verify if this activity was authorized
7. Review RBAC configuration to ensure proper role assignments and restrictions are in place
', '["https://www.ibm.com/docs/en/aix/7.2?topic=rbac-enhanced-role-based-access-control","https://attack.mitre.org/techniques/T1078/"]', '(safe("log.commandType", "").matches("^(lspv|lsvg|lsdev|lscfg|lsattr)$") && safe("origin.user", "") != "root") || (safe("log.message", "").contains("RBAC") && safe("log.message", "").contains("privilege") && safe("action", "") != "") || (safe("log.eventType", "") == "USER_Role" && safe("log.returnCode", "") != "0") || (safe("log.osUserID", "") != safe("log.osUserID", "") && safe("action", "").contains("EXEC"))', '2025-09-03 15:27:57.419686', true, false, 'origin', NULL, '[{"indexPattern":"v11-log-ibm-aix-*","with":[{"field":"origin.user.keyword","operator":"filter_term","value":"{{.origin.user}}"},{"field":"log.commandType.keyword","operator":"filter_match","value":"ls*"}],"or":null,"within":"now-10m","count":20}]');
INSERT INTO public.utm_correlation_rules VALUES (560, 'Key-Based Audit Event Correlation', 3, 3, 2, 'Defense Evasion', 'T1070 - Indicator Removal on Host', 'Detects correlated audit events with the same key value indicating potential coordinated malicious activity or system compromise attempts. Multiple failed audit events with the same key within a short timeframe may indicate automated tools attempting to bypass security controls or persistence mechanisms.

Next Steps:
1. Investigate the specific audit key to understand what system resource or operation is being targeted
2. Review the failed events to identify patterns in timing, source, and methods
3. Check for successful events with the same key after the failed attempts
4. Examine system logs for signs of privilege escalation or unauthorized access
5. Verify the integrity of audit configuration and rules
6. Consider implementing additional monitoring for the targeted resource
', '["https://access.redhat.com/documentation/en-us/red_hat_enterprise_linux/7/html/security_guide/sec-defining_audit_rules_and_controls","https://attack.mitre.org/techniques/T1070/"]', 'safe("log.auditd.data.key", "") != "" && safe("log.auditd.result", "") == "fail"', '2025-09-03 15:29:12.592702', true, false, 'origin', NULL, '[]');
INSERT INTO public.utm_correlation_rules VALUES (589, 'Suspicious Cluster State Modifications', 2, 3, 3, 'Defense Evasion', 'T1562.001 - Impair Defenses: Disable or Modify Tools', 'Detects unauthorized or suspicious modifications to the Elasticsearch cluster state, which could indicate attempts to compromise cluster integrity or availability. This rule identifies when multiple cluster configuration changes occur within a short timeframe.

Next Steps:
1. Review the user account making the modifications and verify authorization
2. Examine the specific configuration changes made to the cluster
3. Check if the changes align with scheduled maintenance or deployment activities
4. Investigate the source IP and access patterns of the user
5. Review cluster audit logs for additional suspicious activities
6. Validate cluster health and performance after the modifications
', '["https://www.elastic.co/guide/en/elasticsearch/reference/current/audit-event-types.html","https://attack.mitre.org/techniques/T1562/001/"]', 'safe("level", "") == "hight" && safe("log.component", "") != "" && safe("log.msg", "") != "" && safe("log.nodeName", "") != ""', '2025-09-03 15:32:03.089372', true, false, 'origin', '["log.nodeName","origin.ip"]', '[{"indexPattern":"v11-log-elasticsearch-*","with":[{"field":"log.nodeName.keyword","operator":"filter_term","value":"{{.log.nodeName}}"},{"field":"level.keyword","operator":"filter_term","value":"hight"}],"or":null,"within":"now-30m","count":3}]');
INSERT INTO public.utm_correlation_rules VALUES (532, 'IBM AIX Critical Error Log Patterns', 1, 2, 3, 'Defense Evasion', 'T1211 - Exploitation for Defense Evasion', 'Analyzes critical error patterns in IBM AIX logs including system crashes, kernel panics, critical service failures, and suspicious error patterns that could indicate exploitation attempts or system compromise.

Next Steps:
1. Review the specific error messages in the log.msg field to understand the nature of the critical error
2. Check system uptime and recent reboot history using ''uptime'' and ''last reboot'' commands
3. Examine the AIX error log using ''errpt -a'' for detailed error information and ''errpt -d H'' for hardware errors
4. Review system resources (CPU, memory, disk) using ''topas'', ''vmstat'', and ''df'' commands
5. Check for recent system or kernel updates that may have introduced instability
6. Look for signs of exploitation or compromise in authentication logs (/var/adm/wtmp) and process listings
7. If kernel panic or system crash, analyze core dumps if available using ''crash'' command
8. Review security-related logs in /var/adm/sulog and /etc/security/failedlogin
9. Check for unauthorized privilege escalation attempts in audit logs
10. Consider engaging IBM support if hardware errors are suspected or for complex kernel issues
11. Validate system integrity using ''oslevel -r'' and check for unauthorized kernel modules
12. Monitor for patterns indicating potential rootkit or malware activity in system behavior
', '["https://www.ibm.com/docs/en/db2/11.5?topic=logs-enabling-system-error-event-log-aix","https://attack.mitre.org/techniques/T1211/"]', '(safe("log.eventType", "") != "" && (safe("log.eventType", "").contains("error") || safe("log.eventType", "").contains("critical") || safe("log.eventType", "").contains("fatal") || safe("log.eventType", "").contains("panic") || safe("log.eventType", "").contains("crash"))) || (safe("log.msg", "") != "" && (safe("log.msg", "").contains("kernel panic") || safe("log.msg", "").contains("system crash") || safe("log.msg", "").contains("critical error") || safe("log.msg", "").contains("fatal exception") || safe("log.msg", "").contains("segmentation fault") || safe("log.msg", "").contains("core dump") || safe("log.msg", "").contains("hardware error"))) || (safe("log.returnCode", "") != "" && safe("log.returnCode", "") != "0")', '2025-09-03 15:27:58.386626', true, false, 'origin', NULL, '[]');
INSERT INTO public.utm_correlation_rules VALUES (533, 'IBM AIX Firewall Policy Violation', 2, 2, 3, 'Lateral Movement', 'T1210 - Exploitation of Remote Services', 'Detects firewall policy violations on IBM AIX systems, including blocked connections, unauthorized access attempts, and potential security breach attempts through the firewall.

Next Steps:
1. Review the source IP address and port to determine if this is a legitimate connection attempt
2. Check if the blocked connection is part of a larger pattern of attacks from the same source
3. Verify firewall rules are correctly configured and not blocking legitimate traffic
4. If malicious, consider blocking the source IP at the network perimeter
5. Review system logs for any successful connections from the same source
6. Document the incident and update firewall rules if necessary
', '["https://www.ibm.com/docs/en/aix/7.2?topic=security-ip-security-firewall","https://attack.mitre.org/techniques/T1210/"]', '( safe("log.eventType", "") == "ipfwall" || safe("log.eventType", "") == "ipf" || safe("log.eventType", "") == "firewall" || safe("action", "").contains("DENY") || safe("action", "").contains("BLOCK") || safe("action", "").contains("REJECT") ) && ( safe("log.message", "").contains("denied") || safe("log.message", "").contains("blocked") || safe("log.message", "").contains("rejected") || safe("log.message", "").contains("policy violation") || safe("log.message", "").contains("unauthorized access") || safe("log.message", "").contains("firewall rule") || safe("origin.port", 0) > 0 )', '2025-09-03 15:27:59.057379', true, false, 'origin', NULL, '[{"indexPattern":"v11-log-ibm-aix-*","with":[{"field":"origin.ip.keyword","operator":"filter_term","value":"{{.origin.ip}}"},{"field":"origin.port","operator":"filter_term","value":"{{.origin.port}}"}],"or":null,"within":"now-5m","count":20}]');
INSERT INTO public.utm_correlation_rules VALUES (534, 'IBM AIX Hardware Monitoring Alerts', 1, 2, 3, 'Impact', 'T1529 - System Shutdown/Reboot', 'Monitors hardware-related events and failures in IBM AIX systems including disk failures, memory errors, CPU faults, and other hardware anomalies that could indicate impending system failure or tampering.

Next Steps:
1. Immediately check the affected system''s hardware status using ''errpt -a'' command
2. Review system diagnostics with ''diag'' command for detailed hardware analysis
3. Check for recent hardware changes or physical access to the system
4. If disk errors: Run ''lspv'' and ''lsvg'' to check disk and volume group status
5. If memory errors: Run ''lsattr -El mem0'' to check memory configuration
6. Monitor system performance for degradation using ''topas'' or ''nmon''
7. Schedule emergency maintenance if critical hardware failure is imminent
8. Document all hardware events for trend analysis and preventive maintenance
', '["https://www.ibm.com/support/pages/ibm-aix-how-store-error-log-errpt-messages-local-and-remote-syslog-files","https://attack.mitre.org/techniques/T1529/"]', 'safe("log.eventType", "") != "" && safe("origin.host", "") != "" && (safe("log.eventType", "").toLowerCase().contains("hardware") || safe("log.eventType", "").toLowerCase().contains("disk") || safe("log.eventType", "").toLowerCase().contains("memory") || safe("log.eventType", "").toLowerCase().contains("cpu") || safe("log.eventType", "").toLowerCase().contains("errpt") || safe("log.msg", "").toLowerCase().contains("hardware error") || safe("log.msg", "").toLowerCase().contains("disk failure") || safe("log.msg", "").toLowerCase().contains("memory fault") || safe("log.msg", "").toLowerCase().contains("sysplanar"))', '2025-09-03 15:27:59.629549', true, false, 'origin', '["target.host","log.eventType"]', '[]');
INSERT INTO public.utm_correlation_rules VALUES (535, 'IBM AIX Intrusion Detection Alert', 3, 3, 2, 'Privilege Escalation', 'T1068 - Exploitation for Privilege Escalation', 'Detects intrusion attempts and security violations identified by the IBM AIX intrusion detection system, including suspicious activities, privilege escalation attempts, and potential system compromises.

Next Steps:
1. Immediately isolate the affected system from the network to prevent lateral movement
2. Review the intrusion detection logs for specific details about the attack vector and affected resources
3. Check for any suspicious processes running with elevated privileges using ''ps aux'' and ''topas''
4. Examine system integrity with ''trustchk'' command to verify critical system files
5. Review recent user authentication logs and check for unauthorized account creation or privilege changes
6. Collect forensic evidence including memory dumps, system logs, and file modifications
7. Apply security patches and update AIX security configurations based on the vulnerability exploited
8. Monitor related systems for similar intrusion attempts
9. Check for any unauthorized file modifications using ''find'' command with modification time filters
10. Review network connections and active ports using ''netstat'' and ''lsof'' commands
11. Validate system configuration against security baselines and hardening guides
12. Document the incident details and update security monitoring rules based on attack patterns
', '["https://www.ibm.com/docs/en/powersc-standard/2.1.0?topic=ids-configuring-intrusion-detection-prevention-idp-aix-endpoints","https://attack.mitre.org/techniques/T1068/"]', '( safe("log.eventType", "") == "ids" || safe("log.eventType", "") == "securityd" || safe("log.eventType", "") == "audit" || safe("log.msg", "").contains("intrusion") || safe("log.msg", "").contains("suspicious") || safe("log.msg", "").contains("anomaly detected") ) && ( safe("log.msg", "").contains("buffer overflow") || safe("log.msg", "").contains("privilege escalation") || safe("log.msg", "").contains("unauthorized modification") || safe("log.msg", "").contains("rootkit") || safe("log.msg", "").contains("backdoor") || safe("log.msg", "").contains("suspicious process") || safe("log.msg", "").contains("file integrity") || safe("action", "").contains("ALERT") || safe("log.returnCode", "") == "1" )', '2025-09-03 15:28:00.297495', true, false, 'origin', NULL, '[]');
INSERT INTO public.utm_correlation_rules VALUES (536, 'IBM AIX IPSec Security Event Detected', 3, 3, 2, 'Command and Control', 'T1572 - Protocol Tunneling', 'Detects security events related to IPSec operations on IBM AIX systems, including tunnel establishment failures, encryption errors, and potential VPN compromise attempts. These events may indicate attempted unauthorized access, VPN configuration issues, or active attacks against encrypted communication channels.

Next Steps:
- Review IPSec configuration and ensure proper authentication methods are in place
- Check system logs for any related authentication failures or network anomalies
- Verify the source IP addresses attempting to establish IPSec connections
- Review firewall rules and VPN access control lists
- If replay attacks are detected, ensure IPSec anti-replay protection is enabled
- Check for any recent changes to IPSec policies or certificates
- Monitor for any unusual network traffic patterns from the affected systems
', '["https://www.ibm.com/docs/en/aix/7.2?topic=security-ipsec","https://attack.mitre.org/techniques/T1572/"]', '( safe("log.eventType", "") == "ipsec" || safe("log.eventType", "") == "iked" || safe("log.eventType", "") == "ipsecmgr" || safe("log.msg", "").contains("ipsec") || safe("log.msg", "").contains("tunnel") || safe("log.msg", "").contains("SA proposal") ) && ( safe("log.msg", "").contains("authentication failed") || safe("log.msg", "").contains("negotiation failed") || safe("log.msg", "").contains("invalid SPI") || safe("log.msg", "").contains("replay attack") || safe("log.msg", "").contains("packet dropped") || safe("log.msg", "").contains("encryption failed") || safe("log.returnCode", "") != "0" )', '2025-09-03 15:28:00.865691', true, false, 'target', NULL, '[]');
INSERT INTO public.utm_correlation_rules VALUES (537, 'IBM AIX Kerberos Authentication Anomaly', 3, 3, 2, 'Credential Access', 'T1558.003 - Steal or Forge Kerberos Tickets: Kerberoasting', 'Detects anomalous Kerberos authentication events on IBM AIX systems, including failed authentication attempts, ticket manipulation, and potential Kerberos attacks. This rule monitors for various Kerberos-related error conditions and suspicious authentication patterns that may indicate an attack.

Next Steps:
1. Verify the affected user account and check for legitimate authentication attempts
2. Review the timing and frequency of authentication failures
3. Investigate the source IP address for other suspicious activities
4. Check for any unusual service ticket requests or ticket manipulation
5. Monitor for privilege escalation attempts following authentication events
6. Consider implementing additional monitoring for the affected user account
', '["https://www.ibm.com/docs/en/aix/7.2?topic=kerberos-network-authentication-service","https://attack.mitre.org/techniques/T1558/003/"]', '( safe("log.eventType", "") == "krb5kdc" || safe("log.eventType", "") == "kadmind" || safe("log.eventType", "") == "auth" || safe("log.msg", "").contains("krb5") || safe("log.msg", "").contains("kerberos") ) && ( safe("log.msg", "").contains("authentication failed") || safe("log.msg", "").contains("preauthentication failed") || safe("log.msg", "").contains("ticket expired") || safe("log.msg", "").contains("invalid ticket") || safe("log.msg", "").contains("KDC_ERR") || safe("log.msg", "").contains("TGT request") || safe("action", "").contains("LOGON") )', '2025-09-03 15:28:01.469781', true, false, 'origin', NULL, '[{"indexPattern":"v11-log-ibm-aix-*","with":[{"field":"log.osUserID.keyword","operator":"filter_term","value":"{{.log.osUserID}}"}],"or":null,"within":"now-5m","count":10}]');
INSERT INTO public.utm_correlation_rules VALUES (538, 'IBM AIX LDAP Client Security Issues Detected', 3, 2, 1, 'Defense Evasion, Persistence, Privilege Escalation, Initial Access', 'T1078 - Valid Accounts', 'Detects security issues related to LDAP client operations on IBM AIX systems, including authentication failures, connection errors, and potential unauthorized access attempts through LDAP services. This rule monitors for various LDAP-related security events that could indicate credential attacks, service disruptions, or misconfigurations.

Next Steps:
1. Investigate the source IP address and user account involved in the LDAP authentication failure
2. Review LDAP server logs for corresponding authentication attempts and errors
3. Check for patterns of repeated failures from the same source that might indicate brute force attacks
4. Verify LDAP server configuration and connectivity status
5. Review recent changes to LDAP configuration or user account permissions
6. Monitor for successful authentications from the same source after failures
7. Check system logs for related authentication events across other services
8. Validate user account status and permissions in the LDAP directory
', '["https://www.ibm.com/support/pages/aix-how-configure-aix-ldap-or-krb5ldap-client","https://attack.mitre.org/techniques/T1078/"]', 'safe("log.eventType", "") == "ldapd" && ( safe("log.msg", "").contains("authentication failed") || safe("log.msg", "").contains("bind failed") || safe("log.msg", "").contains("connection refused") || safe("log.msg", "").contains("invalid credentials") || safe("log.msg", "").contains("ldap_bind") || safe("log.msg", "").contains("access denied") || safe("log.msg", "").contains("SSL connection error") || safe("log.msg", "").contains("timeout") || safe("log.returnCode", "") != "0" )', '2025-09-03 15:28:30.525627', true, false, 'origin', NULL, '[]');
INSERT INTO public.utm_correlation_rules VALUES (548, 'AppArmor Profile Violations', 3, 3, 2, 'Defense Evasion', 'T1562.001 - Impair Defenses: Disable or Modify Tools', 'Monitors AppArmor policy violations including denied file access, network operations, and capability usage. These violations may indicate attempts to break out of application confinement or exploit confined services.

Next Steps:
1. Review the specific AppArmor profile that was violated and the operation that was denied
2. Examine the process/application that triggered the violation and verify if it''s legitimate
3. Check if this is part of a pattern of violations from the same host or profile
4. Investigate the target file, capability, or resource that was accessed
5. Consider if the application legitimately needs broader permissions or if this indicates malicious activity
6. Review recent changes to the system or applications that might explain the violation
', '["https://wiki.archlinux.org/title/AppArmor","https://attack.mitre.org/techniques/T1562/001/"]', 'safe("dataType", "") == "auditd" && ( (safe("log.record_type", "") == "AVC" && (safe("log.apparmor", "").contains("DENIED"))) || (safe("log.record_type", "") == "APPARMOR_DENIED") || ((safe("log.message", "").contains("apparmor=\"DENIED\""))) || ((safe("log.message", "").contains("apparmor=\"ALLOWED\"") && (safe("log.message", "").contains("info=\"profile in complain mode\"")))) ) && ( (safe("log.operation", "").contains("open")) || (safe("log.operation", "").contains("exec")) || (safe("log.operation", "").contains("mmap")) || (safe("log.operation", "").contains("create")) || (safe("log.operation", "").contains("connect")) || (safe("log.operation", "").contains("capability")) || (safe("log.operation", "").contains("ptrace")) )', '2025-09-03 15:29:06.451767', true, false, 'origin', '["origin.host","log.profile","log.operation"]', '[]');
INSERT INTO public.utm_correlation_rules VALUES (948, 'System Linux: Hping Process Activity', 1, 1, 2, 'Discovery', 'System Information Discovery', 'Hping ran on a Linux host. Hping is a FOSS command-line packet analyzer and has the ability to construct network packets for a wide variety of network security testing applications, including scanning and firewall auditing.', '["https://attack.mitre.org/tactics/TA0007/","https://attack.mitre.org/techniques/T1082/"]', 'safe("log.message", "").matches("(hping)")', '2025-09-03 16:37:32.0682', true, false, 'origin', NULL, '[]');
INSERT INTO public.utm_correlation_rules VALUES (540, 'IBM AIX Patch Compliance Failures', 1, 3, 2, 'Initial Access', 'T1190 - Exploit Public-Facing Application', 'Detects patch compliance failures and system update issues in IBM AIX systems, including failed patch installations, missing critical updates, or unauthorized patch modifications. This rule identifies immediate patch failures that require attention to maintain system security posture.

Next Steps:
1. Verify the patch installation status using ''lslpp -l'' command
2. Check system logs for detailed error messages using ''errpt'' command
3. Review failed patch details and prerequisites
4. Ensure sufficient disk space and system resources are available
5. Contact IBM support if critical security patches are failing
6. Document the failure for compliance reporting
7. Implement rollback procedures if necessary
8. Schedule immediate remediation for critical security patches
9. Review patch management processes to prevent future failures
', '["https://www.ibm.com/docs/en/aix/7.2?topic=management-software-maintenance","https://attack.mitre.org/techniques/T1190/"]', '(safe("log.eventType", "") == "PATCH_FAIL" || safe("log.eventType", "") == "UPDATE_FAIL") || (safe("log.commandType", "").contains("installp") && safe("log.returnCode", "") != "0") || (safe("log.message", "").contains("patch") && (safe("log.message", "").contains("failed") || safe("log.message", "").contains("error"))) || (safe("action", "").contains("UPDATE") && safe("log.returnCode", "") != "0") || (safe("origin.command", "").contains("oslevel") && safe("log.message", "").contains("missing"))', '2025-09-03 15:28:31.521298', true, false, 'origin', '["target.host","log.commandType"]', '[]');
INSERT INTO public.utm_correlation_rules VALUES (541, 'IBM AIX Performance Anomalies Detection', 1, 2, 3, 'Impact', 'T1496 - Resource Hijacking', 'Detects performance anomalies in IBM AIX systems including high CPU usage, memory exhaustion, and process issues that could indicate resource hijacking or system compromise. This rule monitors for performance-related events and error messages that may signal system stress or potential attacks.

Next Steps:
1. Investigate system performance metrics (CPU, memory, I/O) on the affected host
2. Review running processes and identify any unusual or unauthorized processes
3. Check system logs for correlating events around the time of the anomaly
4. Examine user activity and recent system changes
5. Verify if performance degradation is due to legitimate workload or potential attack
6. Monitor for signs of resource hijacking, cryptocurrency mining, or DoS attacks
7. If malicious activity is suspected, isolate the system and perform forensic analysis
', '["https://www.ibm.com/docs/en/aix/7.1.0?topic=overview-error-logging-tasks","https://attack.mitre.org/techniques/T1496/"]', 'safe("log.eventType", "") != "" && (safe("log.eventType", "").toLowerCase().contains("perf") || safe("log.eventType", "").toLowerCase().contains("cpu") || safe("log.eventType", "").toLowerCase().contains("memory") || safe("log.eventType", "").toLowerCase().contains("vmstat") || safe("log.eventType", "").toLowerCase().contains("iostat") || safe("log.msg", "").toLowerCase().contains("out of memory") || safe("log.msg", "").toLowerCase().contains("cpu threshold") || safe("log.msg", "").toLowerCase().contains("performance degradation"))', '2025-09-03 15:28:32.07526', true, false, 'origin', '["target.host"]', '[]');
INSERT INTO public.utm_correlation_rules VALUES (542, 'IBM AIX Privileged Command Execution', 3, 3, 2, 'Privilege Escalation, Defense Evasion', 'T1548.003 - Abuse Elevation Control Mechanism: Sudo and Sudo Caching', 'Detects execution of privileged commands by users in IBM AIX systems, including sudo usage, setuid/setgid command execution, and privileged shell access. This rule monitors for various indicators of privilege escalation attempts or legitimate privileged operations that may warrant security review.

Next Steps:
1. Verify if the privileged command execution was authorized and legitimate
2. Check the user account performing the privileged actions for suspicious activity
3. Review the specific command executed and its context
4. Examine system logs for any unauthorized privilege escalation attempts
5. Validate that proper approval processes were followed for privileged access
6. Monitor for any subsequent suspicious activities from the same user or system
7. Consider implementing additional monitoring for the affected user account
8. Review audit trails to determine if the privilege escalation aligns with business requirements
9. Check for any policy violations related to privileged access management
10. Investigate the source of the command execution and validate the authentication chain
', '["https://www.ibm.com/docs/en/aix/7.2?topic=commands-privileged-command-database","https://attack.mitre.org/techniques/T1548/003/"]', '(safe("log.commandType", "") == "sudo" || safe("log.commandType", "") == "su") || (safe("origin.command", "").contains("sudo") || safe("origin.command", "").contains("su ")) || (safe("log.eventType", "") == "PRIV_CMD" || safe("log.eventType", "") == "SETUID_EXEC") || (safe("action", "").contains("PRIVILEGED") || safe("action", "").contains("ELEVATED")) || (safe("log.msg", "").contains("privilege") && safe("log.msg", "").contains("command")) || (safe("origin.user", "") != "root" && (safe("origin.command", "").contains("chmod") || safe("origin.command", "").contains("chown") || safe("origin.command", "").contains("mount")))', '2025-09-03 15:28:33.599702', true, false, 'origin', NULL, '[]');
INSERT INTO public.utm_correlation_rules VALUES (567, 'Syscall Filtering Bypass Attempts', 3, 3, 2, 'Defense Evasion, Privilege Escalation', 'T1055 - Process Injection', 'Detects attempts to bypass syscall filtering through ptrace or other injection techniques. These syscalls can be used to inject code into other processes, potentially bypassing security controls and detection mechanisms.

Next Steps:
1. Investigate the process (PID) and parent process (PPID) involved in the syscall
2. Review the command line arguments and execution context of the suspicious process
3. Check for signs of privilege escalation or lateral movement from the affected host
4. Examine network connections and file system changes around the time of the event
5. Correlate with other security events from the same host and user
6. Review running processes and loaded modules for signs of injection or tampering
7. Consider isolating the affected system if malicious activity is confirmed
', '["https://attack.mitre.org/techniques/T1055/","https://izyknows.medium.com/linux-auditd-for-threat-detection-d06c8b941505"]', 'safe("log.type", "") == "SYSCALL" && (safe("log.syscall", "") == "ptrace" || safe("log.syscall", "") == "process_vm_writev" || safe("log.syscall", "") == "process_vm_readv") && safe("log.success", "") == "yes"', '2025-09-03 15:29:57.94003', true, false, 'origin', NULL, '[]');
INSERT INTO public.utm_correlation_rules VALUES (543, 'IBM AIX RBAC Violation Detection', 2, 3, 1, 'Privilege Escalation, Defense Evasion', 'T1548 - Abuse Elevation Control Mechanism', 'Detects RBAC (Role-Based Access Control) violations in IBM AIX systems, including unauthorized privilege escalation attempts, failed role assignments, or attempts to execute privileged commands without proper authorization. This rule identifies multiple failed privilege escalation attempts that could indicate an adversary attempting to gain elevated access.

Next Steps:
1. Investigate the source user and IP address for anomalous behavior
2. Review the specific commands being executed and their authorization status
3. Check for any successful privilege escalations following these attempts
4. Verify if the user account has been compromised or is being used maliciously
5. Review system audit logs for additional unauthorized access attempts
6. Consider temporarily disabling the affected user account if suspicious activity is confirmed
7. Examine the specific RBAC roles and permissions for the affected user
8. Check if there are any policy violations or misconfigurations in the RBAC system
', '["https://www.ibm.com/docs/en/aix/7.2?topic=security-role-based-access-control","https://attack.mitre.org/techniques/T1548/"]', '(safe("log.eventType", "") == "RBAC_FAIL" || (safe("log.msg", "").contains("RBAC") && safe("log.msg", "").contains("denied"))) || (safe("log.commandType", "") == "sudo" && safe("log.returnCode", "") != "0") || (safe("action", "").contains("PRIVILEGE") && safe("log.returnCode", "") != "0")', '2025-09-03 15:28:34.454808', true, false, 'origin', NULL, '[]');
INSERT INTO public.utm_correlation_rules VALUES (544, 'IBM AIX Security Audit Subsystem Alert', 3, 3, 2, 'Defense Evasion', 'T1562.001 - Impair Defenses: Disable or Modify Tools', 'Detects critical security events from the IBM AIX audit subsystem, including audit configuration changes, audit service disruptions, or attempts to tamper with audit logs. This rule identifies when the audit subsystem fails, is disabled, or when audit-related files are modified.

Next Steps:
1. Verify the legitimacy of the audit subsystem changes with the system administrator
2. Check if this is part of scheduled maintenance or authorized configuration changes
3. Review the specific audit event type and return code for failure details
4. Examine the user account that performed the action and verify it has appropriate permissions
5. Investigate any recent changes to audit policies or configurations
6. Check for additional security events around the same time period
7. Verify audit log integrity and ensure no logs have been tampered with
8. Review system logs for any other indicators of compromise
', '["https://www.ibm.com/support/pages/aix-audit-audit-subsystem-aix","https://attack.mitre.org/techniques/T1562/"]', '(safe("log.eventType", "").matches("^audit.*") && safe("log.returnCode", "") != "0") || (safe("log.message", "").contains("audit") && (safe("log.message", "").contains("stop") || safe("log.message", "").contains("disable") || safe("log.message", "").contains("fail"))) || (safe("action", "") == "FILE_MODIFY" && safe("log.objName", "").matches("/etc/security/audit/.*")) || (safe("log.commandType", "") == "audit")', '2025-09-03 15:28:35.125885', true, false, 'origin', NULL, '[]');
INSERT INTO public.utm_correlation_rules VALUES (545, 'IBM AIX Security Policy Enforcement Events', 2, 3, 2, 'Defense Evasion', 'T1562.001 - Impair Defenses: Disable or Modify Tools', 'Detects security policy enforcement events and violations in IBM AIX systems, including policy rule violations, unauthorized policy changes, or attempts to bypass security controls. This rule identifies when security policies are being modified, enforced, or violated, which could indicate attempts to weaken system defenses.

Next Steps:
1. Verify the legitimacy of the policy change or enforcement action
2. Review the user account performing the action and their authorization level
3. Check for any related security events or alerts in the timeframe
4. Examine the specific policy that was modified or violated
5. Validate that the change follows proper change management procedures
6. Consider implementing additional monitoring for the affected policy area
7. Review system audit logs for additional context around the event
8. Check if the policy change was part of an approved maintenance window
9. Verify the source host and ensure it''s an authorized administrative system
10. Document the incident and update security policies if necessary
', '["https://www.ibm.com/docs/en/aix/7.2?topic=security-policy-management","https://attack.mitre.org/techniques/T1562/"]', '(safe("log.eventType", "") == "POLICY_ENFORCE" || safe("log.eventType", "") == "SECURITY_POLICY") || (safe("log.msgAll", "").contains("policy") && (safe("log.msgAll", "").contains("enforced") || safe("log.msgAll", "").contains("violated") || safe("log.msgAll", "").contains("bypass"))) || (safe("action", "").contains("POLICY") && (safe("action", "").contains("CHANGE") || safe("action", "").contains("MODIFY"))) || (safe("log.commandType", "") == "secpolicy" || safe("origin.command", "").contains("chsec")) || (safe("action", "").contains("SECURITY"))', '2025-09-03 15:28:35.688275', true, false, 'origin', NULL, '[]');
INSERT INTO public.utm_correlation_rules VALUES (546, 'IBM AIX System Configuration Changes', 2, 3, 2, 'Discovery', 'T1082 - System Information Discovery', 'Detects system configuration changes and modifications in IBM AIX systems, including kernel parameter changes, system file modifications, and critical configuration updates. This rule monitors for configuration changes through various methods including direct command execution, system modification events, and configuration file edits.

Next Steps:
1. Verify the legitimacy of the configuration change by checking with system administrators
2. Review the specific command executed and parameters modified
3. Check if the change was part of scheduled maintenance or approved change management
4. Examine the user account that performed the change for any signs of compromise
5. Validate that the change follows organizational security policies
6. Monitor for any system instability or security issues following the configuration change
7. Document the change for compliance and audit purposes
8. If unauthorized, immediately investigate potential privilege escalation or insider threat
', '["https://www.ibm.com/docs/en/aix/7.2?topic=management-system-configuration","https://attack.mitre.org/techniques/T1082/"]', '(safe("log.eventType", "") == "CONFIG_CHANGE" || safe("log.eventType", "") == "SYSTEM_MOD") || (safe("action", "") != "" && action in ["CONFIG_CHANGE", "CONFIG_MODIFY", "SYSTEM_CONFIG"]) || (safe("log.objName", "") != "" && (log.objName.startsWith("chdev") || log.objName.startsWith("chfs") || log.objName.startsWith("chsys"))) || (safe("log.commandType", "") in ["config", "kernel"]) || (safe("log.msg", "") != "" && log.msg.contains("configuration") && (log.msg.contains("changed") || log.msg.contains("modified"))) || (safe("log.pwd", "") == "/etc" && safe("log.objName", "") != "" && (log.objName.contains("vi") || log.objName.contains("edit")))', '2025-09-03 15:28:36.255079', true, false, 'origin', '["log.osUserID","log.objName","origin.host"]', '[]');
INSERT INTO public.utm_correlation_rules VALUES (949, 'System Linux: Potential DNS Tunneling via Iodine', 3, 2, 2, 'Command and Control', 'Protocol Tunneling', 'Iodine is a tool for tunneling Internet protocol version 4 (IPV4) traffic over the DNS protocol to circumvent firewalls, network security groups, and network access lists while evading detection.', '["https://attack.mitre.org/tactics/TA0011/","https://attack.mitre.org/techniques/T1572/"]', 'safe("log.message", "").matches("(iodine)")', '2025-09-03 16:37:32.616089', true, false, 'target', NULL, '[]');
INSERT INTO public.utm_correlation_rules VALUES (547, 'IBM AIX System Integrity Violation Detected', 2, 3, 2, 'Defense Evasion', 'T1070 - Indicator Removal on Host', 'Detects attempts to compromise system integrity in IBM AIX, including unauthorized modifications to critical system files, audit tampering, security configuration changes, and privilege escalation attempts. This rule monitors for various indicators of system compromise including audit event tampering, security configuration file modifications, suspicious sudo usage, and privilege escalation attempts.

Next Steps:
1. Immediately investigate the affected system and user account
2. Review audit logs for related suspicious activities
3. Check for unauthorized changes to system configuration files
4. Verify the legitimacy of any privilege escalation attempts
5. Monitor for additional indicators of compromise
6. Consider isolating the affected system if malicious activity is confirmed
7. Review backup and recovery procedures for critical system files
8. Examine command history and process execution logs
9. Validate user permissions and access controls
10. Check for presence of unauthorized tools or backdoors
', '["https://www.ibm.com/docs/en/ssw_aix_72/security/security_pdf.pdf","https://attack.mitre.org/techniques/T1070/"]', '(safe("log.eventType", "").contains("AUD_") && safe("action", "") == "FILE_Write") || (safe("log.objName", "").contains("/etc/security/") && safe("action", "") == "FILE_Write") || (safe("log.commandType", "") == "sudo" && safe("origin.command", "").contains("passwd")) || (safe("log.msg", "").contains("audit") && safe("log.msg", "").contains("disable")) || (safe("log.osUserID", "") == "root" && safe("origin.user", "") != "root")', '2025-09-03 15:28:36.897034', true, false, 'origin', NULL, '[]');
INSERT INTO public.utm_correlation_rules VALUES (554, 'Unauthorized File Access Attempts', 3, 3, 1, 'Collection', 'T1005 - Data from Local System', 'Detects unauthorized attempts to access sensitive files and directories. This may indicate data exfiltration attempts, privilege escalation, or reconnaissance activities.

Next Steps:
1. Verify the legitimacy of the file access attempt by checking if the user has authorized access
2. Review the user''s recent activities and session details
3. Check for any privilege escalation attempts or suspicious login patterns
4. Examine the accessed files for sensitive data and assess potential impact
5. Consider isolating the affected system if unauthorized access is confirmed
6. Review and update file access permissions as necessary
', '["https://attack.mitre.org/techniques/T1005/","https://www.elastic.co/guide/en/beats/filebeat/current/exported-fields-auditd.html"]', 'safe("log.auditd.log.record_type", "") == "PATH" && safe("log.auditd.log.nametype", "") == "NORMAL" && ((safe("log.auditd.log.name", "").contains("/etc/shadow") || (safe("log.auditd.log.name", "").contains("/etc/passwd") || (safe("log.auditd.log.name", "").contains("/etc/sudoers") || (safe("log.auditd.log.name", "").contains("/.ssh/") || (safe("log.auditd.log.name", "").contains("/root/") || (safe("log.auditd.log.name", "").contains("id_rsa") || (safe("log.auditd.log.name", "").contains(".pem") || (safe("log.auditd.log.name", "").contains(".key"))', '2025-09-03 15:29:10.307567', true, false, 'origin', '["origin.host","log.auditd.log.auid","log.auditd.log.name"]', '[]');
INSERT INTO public.utm_correlation_rules VALUES (555, 'IBM AIX Trusted Computing Base Violation', 3, 3, 2, 'Defense Evasion', 'T1070 - Indicator Removal', 'Detects violations of the Trusted Computing Base (TCB) in IBM AIX, including unauthorized modifications to critical system files, security database tampering, or attempts to modify files protected by TCB. TCB violations indicate potential system compromise or unauthorized privilege escalation attempts.

Next Steps:
1. Immediately investigate the user account and source host involved in the TCB violation
2. Review the specific object/file that was modified and assess the impact
3. Check system logs for any related authentication failures or privilege escalation attempts
4. Verify the integrity of critical system files using tcbck command
5. Review recent system changes and patches that might have triggered legitimate TCB events
6. If malicious activity is confirmed, isolate the affected system and initiate incident response procedures
7. Consider running a full system integrity check and malware scan
', '["https://www.ibm.com/docs/en/aix/7.2?topic=configuration-trusted-computing-base","https://attack.mitre.org/techniques/T1070/"]', '(safe("log.eventType", "") == "tcbck" && safe("log.message", "").contains("FAIL")) || (safe("log.message", "").contains("TCB") && (safe("log.message", "").contains("violation") || safe("log.message", "").contains("modified"))) || (safe("log.eventType", "") == "FILE_Mode" && safe("log.objName", "") != "" && safe("log.objName", "").startsWith("/etc/security/")) || (safe("action", "") == "FILE_MODIFY" && safe("log.objName", "") != "" && (safe("log.objName", "").startsWith("/usr/bin/") || safe("log.objName", "").startsWith("/usr/sbin/") || safe("log.objName", "").startsWith("/etc/security/")))', '2025-09-03 15:29:10.880655', true, false, 'origin', NULL, '[]');
INSERT INTO public.utm_correlation_rules VALUES (556, 'Group Membership Changes', 2, 3, 1, 'Persistence, Privilege Escalation', 'T1098 - Account Manipulation', 'Detects modifications to group membership which could be used for privilege escalation or unauthorized access. This rule triggers when usermod, gpasswd, or similar utilities are used to modify group memberships. Group membership changes can be indicators of privilege escalation attempts or unauthorized access provisioning.

Next Steps:
1. Verify the legitimacy of the group membership change with the system administrator or HR department
2. Check if the user making the change has proper authorization and follows change management procedures
3. Review what groups were modified and assess the potential impact on system security
4. Examine recent login activities and command history for the affected user accounts
5. Consider implementing additional monitoring for the affected groups, especially privileged groups
6. Check for any related authentication events or privilege escalation attempts
7. Validate that the change was properly documented and approved through official channels
8. Review system logs for any suspicious activities following the group membership change
', '["https://attack.mitre.org/techniques/T1098/","https://docs.redhat.com/en/documentation/red_hat_enterprise_linux/7/html/security_guide/sec-understanding_audit_log_files"]', 'safe("log.type", "") == "USER_MGMT" && (safe("log.exe", "") == "/usr/sbin/usermod" || safe("log.exe", "") == "/usr/sbin/gpasswd" || safe("log.exe", "") == "/usr/bin/gpasswd") && safe("log.res", "") == "success"', '2025-09-03 15:29:11.147355', true, false, 'origin', '["origin.host","log.uid"]', '[]');
INSERT INTO public.utm_correlation_rules VALUES (681, 'SAML Authentication Security Issue', 3, 3, 1, 'Defense Evasion, Persistence, Privilege Escalation, Initial Access', 'T1078 - Valid Accounts', 'Detects SAML authentication failures and security issues that may indicate authentication bypass attempts, SAML assertion tampering, or configuration vulnerabilities.

Next Steps:
- Review the SAML authentication logs for suspicious patterns or anomalous behavior
- Verify SAML configuration and certificate validity
- Check for potential SAML assertion tampering or replay attacks
- Investigate the source IP and user account involved in the failed authentication
- Review network traffic for signs of man-in-the-middle attacks
- Validate SAML IdP configuration and trust relationships
', '["https://www.elastic.co/guide/en/elasticsearch/reference/current/saml-guide-stack.html","https://attack.mitre.org/techniques/T1078/"]', 'safe("log.actionMessage", "").matches(".*[Ss][Aa][Mm][Ll].*") && (safe("log.severityLabel", "") == "ERROR" || safe("log.severityLabel", "") == "WARN") && (safe("log.actionMessage", "").matches(".*authentication.*failed.*") || safe("log.actionMessage", "").matches(".*invalid.*assertion.*") || safe("log.actionMessage", "").matches(".*signature.*verification.*failed.*"))', '2025-09-03 15:44:43.385309', true, false, 'origin', '["origin.user","origin.host"]', '[]');
INSERT INTO public.utm_correlation_rules VALUES (562, 'Suspicious Network Connection Activity', 3, 2, 2, 'Command and Control', 'T1071 - Application Layer Protocol', 'Tracks network connection activities including outbound connections and listening services. Detects potential backdoors, command and control communications, or data exfiltration attempts through monitoring of network-related system calls (connect, bind, listen, accept, socket) with specific focus on suspicious ports or connection patterns.

Next Steps:
1. Investigate the process making the network connections (PID, command line, parent process)
2. Review the destination addresses and ports for indicators of malicious activity
3. Check if the connecting process is authorized to make network connections
4. Analyze network traffic patterns and frequency of connections
5. Correlate with other security events from the same host and timeframe
6. Verify if the network activity aligns with normal business operations
7. Check for signs of data exfiltration or command and control communication
8. Review system logs for process execution and file access events
9. Examine the socket addresses (saddr) for known malicious IPs or domains
10. Check if multiple network connections are being made rapidly by the same process
', '["https://attack.mitre.org/techniques/T1071/","https://izyknows.medium.com/linux-auditd-for-threat-detection-d06c8b941505"]', 'safe("action", "") == "auditd.log" && safe("log.auditd.log.record_type", "") == "SYSCALL" && (safe("log.auditd.log.syscall", "") == "connect" || safe("log.auditd.log.syscall", "") == "bind" || safe("log.auditd.log.syscall", "") == "listen" || safe("log.auditd.log.syscall", "") == "accept" || safe("log.auditd.log.syscall", "") == "socket") && safe("log.auditd.log.success", "") == "yes" && (contains(safe("log.auditd.log.saddr", ""), ":1F90") || contains(safe("log.auditd.log.saddr", ""), ":115C") || contains(safe("log.auditd.log.saddr", ""), ":0050") || contains(safe("log.auditd.log.saddr", ""), ":0BB8") || contains(safe("log.auditd.log.saddr", ""), ":1388") || contains(safe("log.auditd.log.saddr", ""), ":0CEA"))', '2025-09-03 15:29:54.064507', true, false, 'origin', NULL, '[{"indexPattern":"v11-log-auditd-*","with":[{"field":"origin.host.keyword","operator":"filter_term","value":"{{.origin.host}}"},{"field":"log.auditd.log.pid.keyword","operator":"filter_term","value":"{{.log.auditd.log.pid}}"}],"or":null,"within":"now-1h","count":5}]');
INSERT INTO public.utm_correlation_rules VALUES (549, 'Audit Daemon Failures and Errors', 3, 3, 3, 'Defense Evasion', 'T1562.001 - Impair Defenses: Disable or Modify Tools', 'Detects failures and errors in the audit daemon itself, including configuration errors, disk space issues, daemon crashes, or inability to write audit logs. These events could indicate system issues or attempts to disable audit logging, which poses significant security risks by reducing visibility into system activities and potential attacks.

Next Steps:
1. Check system logs for related error messages or crashes
2. Verify available disk space on audit log partitions
3. Review recent configuration changes to audit daemon
4. Check for unauthorized access or privilege escalation attempts
5. Ensure audit daemon service is running properly
6. Validate audit log file permissions and integrity
7. Review any recent system maintenance or updates that might affect auditing
8. Investigate any attempts to disable or tamper with auditing infrastructure
', '["https://man7.org/linux/man-pages/man5/auditd.conf.5.html","https://attack.mitre.org/techniques/T1562/001/"]', 'safe("action", "") == "auditd.log" && ( safe("log.record_type", "") == "DAEMON_ABORT" || safe("log.record_type", "") == "DAEMON_ERR" || safe("log.record_type", "") == "DAEMON_CONFIG" || safe("log.record_type", "") == "DAEMON_RECONFIG" || safe("log.record_type", "") == "SERVICE_STOP" || safe("log.record_type", "") == "ANOM_DISK_FULL" || safe("log.record_type", "") == "ANOM_DISK_ERROR" || (safe("log.record_type", "") == "CONFIG_CHANGE" && strings.contains(safe("log.audit_enabled", ""), "0")) || (safe("log.record_type", "") == "SYSCALL" && safe("log.comm", "") == "auditctl" && safe("log.success", "") == "no") )', '2025-09-03 15:29:07.604885', true, false, 'origin', '["origin.host","log.record_type"]', '[]');
INSERT INTO public.utm_correlation_rules VALUES (550, 'Audit Rule Modifications', 2, 3, 1, 'Defense Evasion', 'T1070.002 - Indicator Removal on Host: Clear Linux or Mac System Logs', 'Detects attempts to modify audit rules which could indicate an attacker trying to evade detection by disabling or modifying audit logging mechanisms. This activity is commonly observed when attackers attempt to cover their tracks after gaining system access.

Next Steps:
1. Investigate the user account (log.auid) that initiated the audit rule modification
2. Review the specific audit rule changes made by examining the audit configuration
3. Check for other suspicious activities on the affected host around the same time
4. Verify if the modification was authorized and part of legitimate administrative tasks
5. Examine system logs for any events that occurred before or after the audit rule modification
6. Consider isolating the affected system if unauthorized modifications are confirmed
', '["https://attack.mitre.org/techniques/T1070/002/","https://access.redhat.com/articles/4409591"]', '(safe("log.type", "") == "CONFIG_CHANGE" || safe("log.type", "") == "DAEMON_CONFIG") && (safe("log.exe", "") == "/sbin/auditctl" || safe("log.exe", "") == "/usr/sbin/auditctl" || safe("log.exe", "") == "/sbin/augenrules" || safe("log.exe", "") == "/usr/sbin/augenrules")', '2025-09-03 15:29:08.100907', true, false, 'origin', '["origin.host","log.auid"]', '[]');
INSERT INTO public.utm_correlation_rules VALUES (551, 'Linux Capability Usage Tracking', 2, 3, 2, 'Privilege Escalation, Defense Evasion', 'T1548.001 - Abuse Elevation Control Mechanism: Setuid and Setgid', 'Monitors the use of Linux capabilities by processes, particularly focusing on dangerous capabilities like CAP_SYS_ADMIN, CAP_NET_RAW, or CAP_DAC_OVERRIDE that could be abused for privilege escalation or system compromise.

Next Steps:
1. Verify if the capability usage is legitimate for the process and user
2. Check the process binary and its purpose on the system
3. Review recent system changes and software installations
4. Examine surrounding audit logs for additional suspicious activity
5. Check if the process is running with appropriate permissions
6. Validate the process against known good baselines
7. Investigate the user context and whether elevated capabilities are expected
8. Check for any correlation with other security events on the same host
', '["https://man7.org/linux/man-pages/man7/capabilities.7.html","https://attack.mitre.org/techniques/T1548/"]', '( safe("log.record_type", "") == "CAPSET" || safe("log.record_type", "") == "CAPABILITY" || (safe("log.record_type", "") == "SYSCALL" && safe("log.syscall", "") == "capset") ) && ( (safe("log.cap_effective", "").contains("cap_sys_admin")) || (safe("log.cap_effective", "").contains("cap_net_raw")) || (safe("log.cap_effective", "").contains("cap_dac_override")) || (safe("log.cap_effective", "").contains("cap_sys_ptrace")) || (safe("log.cap_effective", "").contains("cap_sys_module")) || (safe("log.cap_effective", "").contains("cap_setuid")) || (safe("log.cap_effective", "").contains("cap_setgid")) )', '2025-09-03 15:29:08.580234', true, false, 'origin', '["origin.host","log.comm"]', '[]');
INSERT INTO public.utm_correlation_rules VALUES (552, 'System Configuration Changes', 3, 3, 2, 'Defense Evasion', 'T1601 - Modify System Image', 'Detects modifications to critical system configuration files and security settings through audit logs. This rule identifies unauthorized changes to system files that could be used for defense evasion or persistence.

Next Steps:
1. Verify if the configuration change was authorized and scheduled
2. Check what specific files were modified and review the changes
3. Identify the user or process that made the changes
4. Review system logs for any suspicious activity around the time of modification
5. Validate system integrity and check for signs of compromise
6. If unauthorized, restore from known good backups and investigate the attack vector
', '["https://attack.mitre.org/techniques/T1601/","https://attack.mitre.org/techniques/T1562/","https://www.elastic.co/guide/en/beats/filebeat/current/filebeat-module-auditd.html"]', 'safe("log.action", "") == "auditd.log" && (safe("log.auditd.record_type", "") == "CONFIG_CHANGE" || safe("log.auditd.record_type", "") == "MAC_CONFIG_CHANGE" || safe("log.auditd.record_type", "") == "PATH") && (safe("log.auditd.name", "").contains("/etc/" || safe("log.auditd.name", "").contains("/boot/" || safe("log.auditd.name", "").contains("/lib/systemd/" || safe("log.auditd.name", "").contains("/usr/lib/systemd/" || safe("log.auditd.name", "").contains("passwd" || safe("log.auditd.name", "").contains("shadow" || safe("log.auditd.name", "").contains("sudoers" || safe("log.auditd.name", "").contains("sshd_config" || safe("log.auditd.name", "").contains("audit.rules" || safe("log.auditd.name", "").contains("auditd.conf")', '2025-09-03 15:29:09.084124', true, false, 'origin', '["log.auditd.name","origin.host"]', '[]');
INSERT INTO public.utm_correlation_rules VALUES (561, 'Log Tampering Attempts', 2, 3, 2, 'Defense Evasion', 'T1070.002 - Indicator Removal on Host: Clear Linux or Mac System Logs', 'Detects attempts to tamper with or delete audit logs which could indicate malicious activity. 
This rule identifies file operations targeting critical log directories such as /var/log/audit/, 
/var/log/messages, and /var/log/secure that involve deletion or write access.

Next Steps:
1. Investigate the user and process responsible for the log tampering attempt
2. Check for any recent privilege escalation activities on the affected host
3. Verify if legitimate administrative activities were scheduled during this time
4. Review backup logs and file integrity monitoring for evidence of actual log deletion
5. Examine other system logs for signs of additional malicious activity
6. Consider isolating the affected system if evidence of compromise is found
', '["https://attack.mitre.org/techniques/T1070/002/","https://www.redhat.com/en/blog/configure-linux-auditing-auditd"]', 'safe("log.type", "") == "PATH" && (safe("log.name", "").contains("/var/log/audit/") || safe("log.name", "").contains("/var/log/messages") || safe("log.name", "").contains("/var/log/secure") || safe("log.name", "").contains("/var/log/auth.log") || safe("log.name", "").contains("/var/log/syslog")) && (safe("log.nametype", "") == "DELETE" || safe("log.mode", "").contains("w"))', '2025-09-03 15:29:53.572396', true, false, 'origin', '["origin.host","origin.user"]', '[]');
INSERT INTO public.utm_correlation_rules VALUES (553, 'Suspicious Executable Monitoring', 3, 3, 2, 'Defense Evasion', 'T1218 - System Binary Proxy Execution', 'Detects multiple executions of suspicious or high-risk executables that could indicate malicious activity or system compromise. This rule monitors for execution of binaries from temporary directories, commonly abused directories, or network tools that could be used for malicious purposes.

Next Steps:
1. Investigate the specific executable and its source location
2. Check if the executable was downloaded from external sources recently
3. Analyze the complete process tree and parent processes
4. Review network connections associated with the suspicious process
5. Examine file system changes made by the executable
6. Check for persistence mechanisms or privilege escalation attempts
7. Correlate with other security events on the same host within the timeframe
8. Validate if the executable has valid digital signatures
9. Check process command line arguments for suspicious parameters
', '["https://access.redhat.com/documentation/en-us/red_hat_enterprise_linux/7/html/security_guide/sec-understanding_audit_log_files","https://attack.mitre.org/techniques/T1218/"]', 'safe("log.auditd.data.syscall", "") == "execve" && (safe("log.auditd.data.exe", "").contains("/tmp/") || safe("log.auditd.data.exe", "").contains("/dev/shm/") || safe("log.auditd.data.exe", "").contains("wget") || safe("log.auditd.data.exe", "").contains("curl") || safe("log.auditd.data.exe", "").contains("nc") || safe("log.auditd.data.exe", "").contains("ncat"))', '2025-09-03 15:29:09.587082', true, false, 'origin', NULL, '[{"indexPattern":"v11-log-auditd-*","with":[{"field":"origin.host.keyword","operator":"filter_term","value":"{{.origin.host}}"},{"field":"log.auditd.data.syscall.keyword","operator":"filter_term","value":"execve"}],"or":null,"within":"now-15m","count":5}]');
INSERT INTO public.utm_correlation_rules VALUES (571, 'User Authentication Events', 2, 2, 1, 'Defense Evasion, Persistence, Privilege Escalation, Initial Access', 'T1078 - Valid Accounts', 'Detects user authentication events including successful and failed login attempts through the audit daemon logs. This rule monitors authentication activities to provide visibility into user access patterns and potential unauthorized access attempts.

Next Steps:
1. Review the authentication result and determine if it was successful or failed
2. Investigate the user account and verify if the authentication is expected
3. Check the source IP and host for any suspicious patterns
4. If failed authentication, look for potential brute force patterns
5. Correlate with other authentication events from the same user or host
6. Review system logs around the time of authentication for additional context
', '["https://attack.mitre.org/techniques/T1078/","https://www.elastic.co/guide/en/beats/filebeat/7.17/filebeat-module-auditd.html"]', 'safe("log.action", "") == "auditd.log" && (safe("log.auditd.record_type", "") == "USER_AUTH" || safe("log.auditd.record_type", "") == "USER_LOGIN" || safe("log.auditd.record_type", "") == "USER_START" || safe("log.auditd.record_type", "") == "USER_END") && safe("log.auditd.result", "") != ""', '2025-09-03 15:30:00.611125', true, false, 'origin', '["log.auditd.user","origin.host"]', '[]');
INSERT INTO public.utm_correlation_rules VALUES (603, 'HAProxy ACL Bypass Attempt Detection', 3, 3, 2, 'Defense Evasion', 'T1562.001 - Impair Defenses: Disable or Modify Tools', 'Detects attempts to bypass HAProxy Access Control Lists (ACLs) through various techniques including header manipulation, request smuggling, or exploiting ACL misconfigurations to access restricted resources.

Next Steps:
1. Review HAProxy access logs for the source IP and examine request patterns
2. Verify the legitimacy of the requests and whether ACL rules are properly configured
3. Check for signs of request smuggling or header manipulation attempts
4. Investigate if the source IP has a history of suspicious activity
5. Review HAProxy configuration for potential ACL misconfigurations
6. Consider implementing additional security controls if bypass attempts persist
', '["https://www.haproxy.com/documentation/haproxy-configuration-tutorials/core-concepts/acls/","https://attack.mitre.org/techniques/T1562/001/"]', 'safe("action", "") == "haproxy.log" &&
 (
   (safe("log.haproxy.http.response.status_code", 0.0) == double(403) &&
    safe("log.haproxy.http.request.time_wait", 0) < 10) ||
   (safe("log.message", "").contains("ACL") &&
    (safe("log.message", "").contains("denied") ||
     safe("log.message", "").contains("blocked") ||
     safe("log.message", "").contains("forbidden")) ||
   (safe("log.haproxy.http.request.raw_headers", "").contains("X-Forwarded-For") &&
    size(split(safe("log.haproxy.http.request.raw_headers", ""), "X-Forwarded-For")) > 2) ||
   (safe("log.haproxy.termination_state", "").contains("PR") &&
    safe("log.haproxy.http.request.body_size", 0) > 100000) ||
   (safe("log.haproxy.http.request.method", "") != "" &&
    !(safe("log.haproxy.http.request.method", "") in ["GET", "POST", "PUT", "DELETE", "HEAD", "OPTIONS", "PATCH"])) ||
   (safe("log.haproxy.frontend_name", "") != safe("log.haproxy.backend_name", "") &&
    safe("log.haproxy.http.response.status_code", 0.0) == double(200) &&
    safe("log.haproxy.http.request.uri", "") contains "../") ||
   (safe("log.haproxy.http.request.captured_headers", "") != "" &&
    (safe("log.haproxy.http.request.captured_headers", "").contains("admin") ||
     safe("log.haproxy.http.request.captured_headers", "").contains("internal") &&
    !(safe("log.haproxy.source", "").startsWith("10.")) &&
    !(safe("log.haproxy.source", "").startsWith("192.168.")) &&
    !(safe("log.haproxy.source", "").startsWith("172."))
 )
', '2025-09-03 15:33:43.489819', true, false, 'origin', '["log.haproxy.source","origin.host"]', '[]');
INSERT INTO public.utm_correlation_rules VALUES (604, 'HAProxy Admin Socket Abuse Detection', 2, 3, 3, 'Execution', 'T1059 - Command and Scripting Interpreter', 'Detects potential abuse of HAProxy admin socket commands, including attempts to disable servers, modify configurations, or clear counters. Such activities could indicate an attacker attempting to manipulate load balancing or disrupt services.

Next Steps:
1. Review the specific admin socket commands executed in the log message
2. Verify if the commands were authorized and executed by legitimate administrators
3. Check for any service disruptions or configuration changes around the time of the alert
4. Examine authentication logs for the source host to identify the user responsible
5. Review HAProxy configuration files for unauthorized modifications
6. Monitor for any subsequent service availability issues or load balancing anomalies
', '["https://www.haproxy.com/blog/haproxy-log-customization","https://discourse.haproxy.org/t/how-to-enable-haproxy-stats-log/1738","https://attack.mitre.org/techniques/T1059/"]', 'safe("action", "") == "haproxy.log" && (safe("log.message", "").contains("disable server") || safe("log.message", "").contains("enable server") || safe("log.message", "").contains("disable frontend") || safe("log.message", "").contains("enable frontend") || safe("log.message", "").contains("clear counters") || safe("log.message", "").contains("set weight") || safe("log.message", "").contains("set maxconn") || safe("log.message", "").contains("admin.sock")', '2025-09-03 15:33:44.056196', true, false, 'origin', NULL, '[{"indexPattern":"v11-log-haproxy-*","with":[{"field":"origin.host.keyword","operator":"filter_term","value":"{{.origin.host}}"},{"field":"log.message","operator":"filter_match","value":"admin.sock"}],"or":null,"within":"now-15m","count":5}]');
INSERT INTO public.utm_correlation_rules VALUES (1350, 'Windows: Logon failure - User not allowed to login at this computer', 2, 3, 3, 'Potentially Malicious Activity', 'Account Access Removal', 'Adversaries may interrupt availability of system and network resources  by inhibiting access to accounts utilized by legitimate users.  Accounts may be deleted, locked, or manipulated (ex: changed credentials) to remove access to accounts.  Adversaries may also subsequently log off and/or perform a System Shutdown/Reboot to set malicious changes into place.', '["https://attack.mitre.org/techniques/T1531/"]', 'safe("log.eventCode", 0.0) == double(4625) && (safe("log.subStatus", "") == "0xC0000070" || safe("log.winlogEventDataStatus", "") == "0xC0000070" || safe("log.winlogEventDataFailureReason", "").contains("0xC0000070"))', '2025-09-04 20:24:36.312073', true, false, 'origin', NULL, '[]');
INSERT INTO public.utm_correlation_rules VALUES (1470, 'Windows Defender: ERROR: REBOOT REQUIRED', 1, 2, 3, 'Potentially Compromised System', 'User Execution', 'Detects the ''REBOOT REQUIRED'' error event in Windows Defender, which may indicate that a system reboot is needed to complete an update.', '["https://learn.microsoft.com/en-us/windows/security/threat-protection/windows-defender-antivirus/troubleshoot"]', 'safe("log.winlogEventDataLogName", "") == "Microsoft-Windows-Windows Defender/Operational" &&  safe("log.winlogEventDataErrorCode", "") == "0x80508022"', '2025-09-04 21:12:12.635934', true, false, 'target', NULL, '[]');
INSERT INTO public.utm_correlation_rules VALUES (557, 'IBM AIX Trusted Execution Violation', 3, 3, 2, 'Defense Evasion', 'T1036 - Masquerading', 'Detects violations of Trusted Execution (TE) policies in IBM AIX, including execution of untrusted binaries, signature verification failures, or attempts to bypass trusted execution controls. These violations may indicate attempts to execute malicious or unauthorized code on the system.

Next Steps:
1. Immediately verify the integrity of the executed binary and its digital signature
2. Check if the binary is from a trusted source or has been tampered with
3. Review system logs for any concurrent privilege escalation attempts or suspicious activities
4. Examine the user''s recent activities, access patterns, and authentication history
5. Validate the system''s trusted execution configuration and policies are properly enforced
6. Check for any recent changes to the trusted execution database or policies
7. Analyze the source and nature of the untrusted binary or process
8. Consider isolating the affected system if malicious activity is confirmed
9. Review file system integrity and check for signs of compromise
10. Escalate to security team if this appears to be part of a broader attack
', '["https://www.ibm.com/support/pages/trusted-execution-enablement","https://attack.mitre.org/techniques/T1036/"]', '(safe("log.eventType", "") == "trustchk" && safe("log.returnCode", "") != "0") || (safe("log.msg", "").contains("Trusted Execution") && (safe("log.msg", "").contains("fail") || safe("log.msg", "").contains("violat"))) || (safe("log.eventType", "") == "PROC_Execute" && safe("log.msg", "").contains("untrusted")) || (safe("action", "") == "EXEC" && safe("log.objName", "").contains("/tmp/") && safe("origin.user", "") == "root")', '2025-09-03 15:29:11.406208', true, false, 'origin', NULL, '[]');
INSERT INTO public.utm_correlation_rules VALUES (558, 'Kernel Module Loading Detection', 2, 3, 3, 'Persistence, Privilege Escalation', 'T1547.006 - Boot or Logon Autostart Execution: Kernel Modules and Extensions', 'Detects when kernel modules are loaded into the system. Attackers may load malicious kernel modules for rootkit installation, privilege escalation, or to hide their activities. This rule monitors both syscall-based module loading (init_module, finit_module) and kernel module events.

Next Steps:
1. Verify the legitimacy of the loaded kernel module by checking its source and signature
2. Examine the process that initiated the module loading and its parent processes
3. Check for any suspicious file modifications or network connections around the time of module loading
4. Review system logs for any other anomalous activities on the affected host
5. Consider isolating the system if unauthorized kernel module loading is confirmed
6. Perform memory analysis to detect any rootkit or malicious module presence
', '["https://attack.mitre.org/techniques/T1547/006/","https://www.elastic.co/guide/en/beats/filebeat/current/filebeat-module-auditd.html"]', 'safe("action", "") == "auditd.log" && ((safe("log.record_type", "") == "SYSCALL" && (safe("log.syscall", "") == "init_module" || safe("log.syscall", "") == "finit_module")) || (safe("log.record_type", "") == "KERN_MODULE" && safe("log.res", "") == "1"))', '2025-09-03 15:29:12.192732', true, false, 'origin', '["origin.host","log.name"]', '[]');
INSERT INTO public.utm_correlation_rules VALUES (559, 'IBM AIX User Administration Events', 2, 3, 1, 'Persistence, Privilege Escalation', 'T1098 - Account Manipulation', 'Detects user administration events in IBM AIX including user creation, deletion, modification, and privilege changes. This rule monitors critical user management operations that could indicate unauthorized account manipulation or insider threats.

Next Steps:
1. Review the specific user administration action and target user account
2. Verify the action was authorized and performed by legitimate administrators
3. Check for any suspicious patterns in timing or frequency of user changes
4. Validate that the changes align with organizational security policies
5. Monitor for any subsequent suspicious activities from affected accounts
6. Review system logs for additional context around the administration event
7. Check if the administrative action was performed from an expected source IP or host
8. Validate the timing of the user administration event against change management schedules
', '["https://www.ibm.com/support/knowledgecenter/en/SSGMCP_9.0.0/com.ibm.aix.log.doc/filter.html","https://attack.mitre.org/techniques/T1098/"]', 'safe("log.msg", "") != "" && (safe("log.msg", "").lower().contains("useradd") || safe("log.msg", "").lower().contains("userdel") || safe("log.msg", "").lower().contains("usermod") || safe("log.msg", "").lower().contains("passwd") || safe("log.msg", "").lower().contains("chuser") || safe("log.msg", "").lower().contains("mkuser") || safe("log.msg", "").lower().contains("rmuser")) && safe("origin.user", "") != ""', '2025-09-03 15:29:12.196156', true, false, 'origin', NULL, '[]');
INSERT INTO public.utm_correlation_rules VALUES (566, 'SELinux AVC Access Denials', 3, 3, 2, 'Defense Evasion', 'T1562.001 - Impair Defenses: Disable or Modify Tools', 'Detects SELinux Access Vector Cache (AVC) denials which indicate attempts to access resources in violation of the SELinux policy. These denials can indicate legitimate misconfigurations, but may also signal malicious attempts to bypass mandatory access controls. High-frequency denials from the same security context could indicate persistent attack attempts or privilege escalation activities.

Next Steps:
1. Review the denied operation and determine if it represents legitimate application behavior
2. Examine the source context (scontext) and target context (tcontext) to understand what process attempted the action
3. Check if this is part of a pattern of denials from the same security context
4. Verify if the denial is due to misconfiguration or represents malicious activity
5. Consider adjusting SELinux policies if the access is legitimate, or investigate further if suspicious
6. Monitor for additional denials from the same context that might indicate ongoing attack attempts
', '["https://selinuxproject.org/page/NB_AL","https://www.redhat.com/en/blog/selinux-denial2","https://attack.mitre.org/techniques/T1562/001/"]', 'safe("log.message", "") != "" && safe("log.record_type", "") == "AVC" && safe("log.selinux_denied", "") == "denied" && ( safe("log.selinux_perm", "").contains("execute") || safe("log.selinux_perm", "").contains("write") || safe("log.selinux_perm", "").contains("read") || safe("log.selinux_perm", "").contains("create") || safe("log.selinux_perm", "").contains("unlink") || safe("log.selinux_perm", "").contains("setattr") || safe("log.selinux_perm", "").contains("transition") ) && ( safe("log.comm", "") != "systemd" && safe("log.comm", "") != "NetworkManager"', '2025-09-03 15:29:57.221963', true, false, 'origin', '["origin.host","log.scontext","log.tcontext","log.selinux_perm"]', '[]');
INSERT INTO public.utm_correlation_rules VALUES (664, 'Kafka Log Compaction Issues Detected', 1, 3, 3, 'System Integrity', 'Resource Hijacking', 'Detects issues with Kafka log compaction that could indicate data integrity problems or resource exhaustion attacks. Log compaction failures can lead to unbounded disk growth and performance degradation.

Next Steps:
1. Check Kafka broker logs for detailed error messages
2. Verify disk space availability on affected brokers
3. Review log compaction configuration and settings
4. Check for corrupted log segments or files
5. Monitor cluster performance and resource usage
6. Consider restarting log cleaner thread if necessary
', '["https://kafka.apache.org/documentation/#compaction","https://docs.confluent.io/kafka/design/log_compaction.html"]', 'safe("severity", "") == "hight" && safe("log.msg", "") != "" && (safe("log.msg", "").contains("compaction") || safe("log.msg", "").contains("cleaner") || safe("log.msg", "").contains("LogCleaner")) && (safe("log.msg", "").contains("failed") || safe("log.msg", "").contains("error") || safe("log.msg", "").contains("exception"))', '2025-09-03 15:39:42.173657', true, false, 'origin', '["origin.host","log.component"]', '[]');
INSERT INTO public.utm_correlation_rules VALUES (563, 'Privilege Escalation Detection', 3, 3, 2, 'Privilege Escalation, Defense Evasion', 'T1548 - Abuse Elevation Control Mechanism', 'Detects privilege escalation attempts including sudo usage, setuid/setgid operations, and capability changes in audit logs. This rule monitors for suspicious elevation of privileges through various system calls and commands.

Next Steps:
1. Verify the legitimacy of the privilege escalation attempt by checking if it aligns with authorized administrative activities
2. Review the user account performing the escalation and validate their authorization level
3. Examine the context and timing of the escalation - check for unusual patterns or off-hours activity
4. Investigate any subsequent actions taken by the user after privilege escalation
5. Check for signs of lateral movement or unauthorized access to sensitive resources
6. Review system logs for any failed privilege escalation attempts from the same user
7. If unauthorized, immediately revoke elevated privileges and investigate potential compromise
', '["https://attack.mitre.org/techniques/T1548/","https://attack.mitre.org/techniques/T1068/","https://docs.redhat.com/en/documentation/red_hat_enterprise_linux/7/html/security_guide/sec-understanding_audit_log_files"]', 'safe("action", "") == "auditd.log" && (safe("log.auditd.record_type", "") == "USER_CMD" || safe("log.auditd.record_type", "") == "EXECVE" || safe("log.auditd.record_type", "") == "SYSCALL" || safe("log.auditd.record_type", "") == "CAPSET") && (safe("log.auditd.exe", "").contains("sudo") || safe("log.auditd.exe", "").contains("su") || safe("log.auditd.comm", "").contains("sudo") || safe("log.auditd.comm", "").contains("su") || safe("log.auditd.syscall", "") == "setuid" || safe("log.auditd.syscall", "") == "setgid" || safe("log.auditd.syscall", "") == "setreuid" || safe("log.auditd.syscall", "") == "setregid")', '2025-09-03 15:29:54.601095', true, false, 'origin', '["log.auditd.uid","origin.host"]', '[{"indexPattern":"v11-log-auditd-*","with":[{"field":"log.auditd.uid.keyword","operator":"filter_term","value":"{{.log.auditd.uid}}"}],"or":null,"within":"now-1m","count":3}]');
INSERT INTO public.utm_correlation_rules VALUES (564, 'Suspicious Process Execution', 2, 3, 2, 'Execution', 'T1059 - Command and Scripting Interpreter', 'Monitors process execution activities for suspicious commands and binaries commonly used by attackers for reconnaissance, lateral movement, or maintaining persistence. This rule detects execution of tools like netcat, curl, wget, scripting interpreters, and network analysis tools that are frequently used in attack chains.

**Next Steps:**
- Investigate the user context and privileges of the process execution
- Review the command-line arguments and parent process details
- Check for any recent authentication events or privilege escalation attempts
- Examine network connections initiated around the same time
- Verify if the process execution aligns with legitimate administrative activities
- Look for additional suspicious activities from the same host or user
', '["https://attack.mitre.org/techniques/T1059/","https://slack.engineering/syscall-auditing-at-scale/"]', 'safe("log.action", "") == "auditd.log" && safe("log.auditd.log.record_type", "") == "EXECVE" && safe("log.auditd.log.proctitle", "") != "" && ( (safe("log.auditd.log.proctitle", "").contains ("nc ")) || (safe("log.auditd.log.proctitle", "").contains ("ncat ")) || (safe("log.auditd.log.proctitle", "").contains ("netcat ")) || (safe("log.auditd.log.proctitle", "").contains ("socat ")) || (safe("log.auditd.log.proctitle", "").contains ("wget ")) || (safe("log.auditd.log.proctitle", "").contains ("curl ")) || (safe("log.auditd.log.proctitle", "").contains ("base64 ")) || (safe("log.auditd.log.proctitle", "").contains ("python ")) || (safe("log.auditd.log.proctitle", "").contains ("perl ")) || (safe("log.auditd.log.proctitle", "").contains ("ruby ")) || (safe("log.auditd.log.proctitle", "").contains ("nmap ")) || (safe("log.auditd.log.proctitle", "").contains ("tcpdump ")) || (safe("log.auditd.log.proctitle", "").contains ("wireshark "))', '2025-09-03 15:29:54.932732', true, false, 'origin', NULL, '[]');
INSERT INTO public.utm_correlation_rules VALUES (565, 'Resource Limit Violations', 1, 2, 3, 'Impact', 'T1496 - Resource Hijacking', 'Detects when processes exceed configured resource limits (ulimits), which could indicate resource exhaustion attacks, denial of service attempts, or misconfigured applications consuming excessive system resources. These violations are typically logged as ANOM_ABEND records in auditd logs.

Next Steps:
1. Investigate the process that triggered the resource limit violation
2. Review system resource usage and identify potential resource exhaustion patterns
3. Check for unusual process behavior or potential malicious activity
4. Verify if resource limits are appropriately configured for the system
5. Monitor for additional resource violations from the same host or process
6. Consider implementing stricter resource controls if abuse is detected
', '["https://docs.redhat.com/en/documentation/red_hat_enterprise_linux/7/html/security_guide/sec-understanding_audit_log_files","https://attack.mitre.org/techniques/T1496/"]', 'safe("log.action", "") == "auditd.log" && safe("log.record_type", "") == "ANOM_ABEND" && ( (safe("log.message", "").contains("RLIMIT_")) || (safe("log.message", "").contains("resource limit")) || (safe("log.message", "").contains("ulimit exceeded")) )', '2025-09-03 15:29:56.26013', true, false, 'origin', '["origin.host","log.pid"]', '[]');
INSERT INTO public.utm_correlation_rules VALUES (588, 'Elasticsearch Audit Log Gaps Detected', 2, 3, 2, 'Defense Evasion', 'T1070 - Indicator Removal on Host', 'Detects gaps in Elasticsearch audit logging which may indicate log tampering, service disruption, or attempts to evade detection by disabling audit functionality. This rule identifies audit trail disruptions, audit component errors, or security configuration changes that could compromise logging integrity.

Next Steps:
1. Verify Elasticsearch cluster health and audit configuration status
2. Check for unauthorized changes to audit settings or policies
3. Review system logs for service interruptions or manual audit disabling
4. Examine user activity around the time of audit gaps for suspicious behavior
5. Validate audit log storage and retention policies are intact
6. Consider implementing audit log backup and monitoring mechanisms
', '["https://www.elastic.co/guide/en/elasticsearch/reference/current/audit-event-types.html","https://attack.mitre.org/techniques/T1070/"]', 'safe("log.msg", "").contains("audit_trail_stopped") || (safe("log.component", "") == "Audit" && safe("log.level", "") == "ERROR") || safe("log.msg", "").contains("audit_config_change")', '2025-09-03 15:32:02.650954', true, false, 'origin', '["log.nodeName"]', '[{"indexPattern":"v11-log-elasticsearch-*","with":[{"field":"log.nodeName.keyword","operator":"filter_term","value":"{{.log.nodeName}}"}],"or":null,"within":"now-6h","count":3}]');
INSERT INTO public.utm_correlation_rules VALUES (577, 'API Key Abuse Detection', 3, 3, 2, 'Credential Access', 'T1528 - Steal Application Access Token', 'Detects suspicious API key operations including excessive creation, deletion, or usage patterns that could indicate credential theft or abuse. This rule monitors for authentication failures with API keys, administrative API key operations, and access denied events involving API keys.

Next Steps:
1. Review the specific API key operations and authentication attempts
2. Verify if the API key usage patterns are legitimate
3. Check for any correlation with other suspicious activities from the same source
4. Review API key permissions and access controls
5. Consider rotating compromised API keys if abuse is confirmed
6. Investigate the source IP and user context for additional indicators
7. Check Elasticsearch audit logs for additional context
8. Verify if the API key belongs to a legitimate service account
', '["https://www.elastic.co/guide/en/elasticsearch/reference/current/security-api-create-api-key.html","https://attack.mitre.org/techniques/T1528/"]', 'safe("log.component", "") == "o.e.x.s.a.ApiKeyService" && ( (safe("log.message", "").contains("authentication_failed") && safe("log.message", "").contains("API_KEY")) || (safe("log.message", "").contains("cluster:admin/xpack/security/api_key/") && (safe("log.message", "").contains("create") || safe("log.message", "").contains("invalidate"))) || (safe("log.level", "") == "WARN" && safe("log.message", "").contains("API_KEY")) )', '2025-09-03 15:31:51.61172', true, false, 'origin', NULL, '[]');
INSERT INTO public.utm_correlation_rules VALUES (568, 'Suspicious System Call Activity', 3, 3, 2, 'Execution', 'T1106 - Native API', 'Detects suspicious system call patterns that may indicate malicious activity such as process injection, privilege escalation attempts, or system manipulation. This rule identifies failed attempts to execute privileged system calls commonly used in attack scenarios.

Next Steps:
1. Investigate the specific syscall that triggered the alert and the process attempting to execute it
2. Review the user context (UID) and determine if the user should have access to perform such operations
3. Examine the process tree to understand the parent-child relationships and identify potential process injection
4. Check for any recent privilege escalation attempts or suspicious process execution patterns
5. Correlate with authentication logs to verify if the user session is legitimate
6. Review system logs for any unauthorized software installations or configuration changes
7. If confirmed malicious, contain the affected host and perform forensic analysis
', '["https://attack.mitre.org/techniques/T1106/","https://docs.redhat.com/en/documentation/red_hat_enterprise_linux/7/html/security_guide/sec-understanding_audit_log_files"]', 'safe("log.action", "") == "auditd.log" && safe("log.auditd.log.record_type", "") == "SYSCALL" && safe("log.auditd.log.success", "") == "no" && safe("log.auditd.log.syscall", "") in ["ptrace", "setuid", "setgid", "setreuid", "setregid", "setresuid", "setresgid", "capset"]', '2025-09-03 15:29:59.034909', true, false, 'origin', NULL, '[{"indexPattern":"v11-log-auditd-*","with":[{"field":"origin.host.keyword","operator":"filter_term","value":"{{.origin.host}}"},{"field":"log.auditd.log.uid.keyword","operator":"filter_term","value":"{{.log.auditd.log.uid}}"}],"or":null,"within":"now-1m","count":3}]');
INSERT INTO public.utm_correlation_rules VALUES (613, 'HTTP Request Smuggling Attempt', 3, 3, 2, 'Defense Evasion', 'HTTP Request Smuggling', 'Detects potential HTTP request smuggling attempts through conflicting Content-Length and Transfer-Encoding headers, malformed requests, or protocol violations. Request smuggling can allow attackers to bypass security controls and access unauthorized resources.

Next Steps:
1. Analyze the full HTTP request headers and body for smuggling patterns
2. Check for conflicting Content-Length and Transfer-Encoding headers
3. Review backend server responses and connection handling
4. Examine firewall and proxy logs for correlation
5. Verify if legitimate traffic could trigger this pattern
6. Consider blocking the source IP if malicious activity is confirmed
', '["https://www.haproxy.com/blog/haproxy-log-customization","https://attack.mitre.org/techniques/T1027/","https://portswigger.net/web-security/request-smuggling"]', '(safe("log.http_request", "") != "" && (safe("log.http_request", "").lower().contains("transfer-encoding") && safe("log.http_request", "").lower().contains("content-length"))) || (safe("log.termination_state", "") != "" && (safe("log.termination_state", "").contains("PR") || safe("log.termination_state", "").contains("PH") || safe("log.termination_state", "").contains("PT"))) || (safe("log.http_request", "") != "" && (safe("log.http_request", "").contains("\\r\\n\\r\\n") || safe("log.http_request", "").contains("\\n\\n"))) || (safe("log.captured_request_headers", "") != "" && (safe("log.captured_request_headers", "").lower().contains("chunked") && safe("log.captured_request_headers", "").lower().contains("identity"))) || (safe("log.http_status", 0.0) == double(400) && safe("log.termination_state", "") != "" && safe("log.termination_state", "").contains("R"))', '2025-09-03 15:34:22.204986', true, false, 'origin', '["origin.ip","target.url"]', '[]');
INSERT INTO public.utm_correlation_rules VALUES (1261, 'Mimikatz Tool Usage Detection', 3, 3, 1, 'Credential Access', 'T1003.001 - OS Credential Dumping: LSASS Memory', 'Detects potential Mimikatz credential dumping tool usage through various indicators including characteristic command patterns, LSASS access, and known Mimikatz modules. Mimikatz is a well-known post-exploitation tool used to extract plaintext passwords, hash, PIN code and kerberos tickets from memory.

Next Steps:
1. Immediately isolate the affected host to prevent lateral movement
2. Review the full command line and process execution details
3. Check for any credential theft or privilege escalation activities
4. Examine recent logon events and account usage patterns
5. Scan for additional persistence mechanisms or backdoors
6. Reset passwords for all potentially compromised accounts
7. Review security logs for signs of lateral movement to other systems
8. Conduct forensic analysis of memory dumps and system artifacts
', '["https://attack.mitre.org/techniques/T1003/001/","https://github.com/gentilkiwi/mimikatz","https://docs.microsoft.com/en-us/windows/security/threat-protection/auditing/event-4688"]', '((safe("log.eventCode", 0.0) == double(4688) || safe("log.eventCode", 0.0) == double(4688)) &&
  (safe("log.winlogEventDataNewProcessName", "").matches("(?i)mimikatz") ||
    safe("log.winlogEventDataCommandLine", "").matches("(?i)(sekurlsa|kerberos|crypto|vault|lsadump|dpapi)::") ||
    safe("log.winlogEventDataCommandLine", "").matches("(?i)(logonpasswords|pth|golden|silver|ticket)") ||
    safe("log.winlogEventDataCommandLine", "").matches("(?i)privilege::debug") ||
    safe("log.winlogEventDataCommandLine", "").contains("coffee") ||
    safe("log.winlogEventDataCommandLine", "").contains("kirbi"))) ||
((safe("log.eventCode", 0.0) == double(4104) || safe("log.eventCode", 0.0) == double(4104)) &&
  safe("log.winlogProviderName", "") == "Microsoft-Windows-PowerShell" &&
  (safe("log.winlogEventDataScriptBlockText", "").matches("(?i)invoke-mimikatz") ||
    safe("log.winlogEventDataScriptBlockText", "").matches("(?i)mimikatz\\.ps1") ||
    safe("log.winlogEventDataScriptBlockText", "").matches("(?i)DumpCreds|DumpCerts") ||
    safe("log.winlogEventDataScriptBlockText", "").contains("Win32_ShadowCopy")))
', '2025-09-04 19:30:02.371736', true, false, 'origin', '["origin.host"]', '[]');
INSERT INTO public.utm_correlation_rules VALUES (1262, 'Named Pipe Impersonation Attack', 3, 3, 2, 'Defense Evasion, Privilege Escalation', 'T1134.001 - Access Token Manipulation: Token Impersonation/Theft', 'Detects potential named pipe impersonation attacks used for privilege escalation. Monitors for suspicious process creation patterns including cmd.exe or powershell.exe with pipe-related commands, and processes creating named pipes with suspicious naming patterns commonly used by attack tools like Meterpreter and Cobalt Strike.

Next Steps:
1. Verify the legitimacy of the process and command line parameters
2. Check for any privilege escalation activities following this event
3. Examine the process parent-child relationship and execution context
4. Review recent logon events (4672) for the affected host
5. Investigate any unusual network connections or file access patterns
6. Consider isolating the affected system if malicious activity is confirmed
', '["https://bherunda.medium.com/hunting-named-pipe-token-impersonation-abuse-573dcca36ae0","https://attack.mitre.org/techniques/T1134/001/"]', 'safe("log.eventCode", 0.0) == double(4688) && (safe("log.winlogEventDataProcessName", "") != "" && (safe("log.winlogEventDataProcessName", "").contains("cmd.exe") || safe("log.winlogEventDataProcessName", "").contains("powershell.exe"))) && safe("log.winlogEventDataCommandLine", "") != "" && (safe("log.winlogEventDataCommandLine", "").contains("\\\\.\\pipe\\") || safe("log.winlogEventDataCommandLine", "").contains("echo") && safe("log.winlogEventDataCommandLine", "").contains("pipe") || safe("log.winlogEventDataCommandLine", "").contains("CreateNamedPipe") || safe("log.winlogEventDataCommandLine", "").contains("ImpersonateNamedPipeClient"))', '2025-09-04 19:30:03.214346', true, false, 'origin', '["origin.host","log.winlogEventDataProcessId"]', '[{"indexPattern":"v11-log-wineventlog-*","with":[{"field":"origin.host.keyword","operator":"filter_term","value":"{{.origin.host}}"},{"field":"log.eventCode","operator":"filter_term","value":4672}],"or":null,"within":"now-5m","count":1}]');
INSERT INTO public.utm_correlation_rules VALUES (1351, 'Windows: Logon failure - User not allowed to login at this computer', 2, 3, 3, 'Potentially Malicious Activity', 'Account Access Removal', 'Adversaries may interrupt availability of system and network resources  by inhibiting access to accounts utilized by legitimate users.  Accounts may be deleted, locked, or manipulated (ex: changed credentials) to remove access to accounts.  Adversaries may also subsequently log off and/or perform a System Shutdown/Reboot to set malicious changes into place.', '["https://attack.mitre.org/techniques/T1531/"]', 'safe("log.eventCode", 0.0) == double(4625) && (safe("log.subStatus", "") == "0xC0000070" || safe("log.winlogEventDataStatus", "") == "0xC0000070" || safe("log.winlogEventDataFailureReason", "").contains("0xC0000070"))', '2025-09-04 20:25:23.279732', true, false, 'origin', NULL, '[]');
INSERT INTO public.utm_correlation_rules VALUES (569, 'IBM AS/400 Object Authority Violation Detection', 3, 3, 1, 'Defense Evasion, Persistence, Privilege Escalation, Initial Access', 'T1078.003 - Valid Accounts: Local Accounts', 'Detects object authority violations and authorization failures in IBM AS/400 systems indicating potential unauthorized access attempts. This rule identifies various authority failure patterns including AF journal entries, explicit authority failures, and access denied messages.

Next Steps:
1. Identify the user account involved in the authority violation
2. Review the specific object or resource that was accessed
3. Verify if the access attempt was legitimate business activity
4. Check user permissions and role assignments
5. Investigate any recent changes to user privileges
6. Review surrounding log entries for additional context
7. Consider implementing additional access controls if needed
', '["https://www.ibm.com/docs/en/i/7.5?topic=entries-af-authority-failure-journal","https://attack.mitre.org/techniques/T1078/003/"]', 'safe("log.message", "") != "" && ( (safe("log.message", "").contains("AF") && safe("log.message", "").contains("Authority")) || safe("log.message", "").contains("authority failure") || safe("log.message", "").contains("authorization failed") || safe("log.message", "").contains("access denied") || safe("log.message", "").contains("not authorized to") || safe("log.message", "").contains("insufficient authority") || safe("log.message", "").contains("object authority") || safe("log.message", "").contains("AUTFAIL") )', '2025-09-03 15:29:59.070261', true, false, 'origin', NULL, '[{"indexPattern":"v11-log-ibm-as400-*","with":[{"field":"log.message","operator":"filter_match","value":"authority failure"}],"or":null,"within":"now-30m","count":5}]');
INSERT INTO public.utm_correlation_rules VALUES (570, 'System Time Change Detection', 2, 3, 1, 'Defense Evasion', 'T1070.006 - Indicator Removal on Host: Timestomp', 'Detects attempts to modify system time which could be used to evade detection or manipulate timestamps in logs. Attackers may modify system time to hide their tracks, interfere with forensic analysis, or disrupt time-based security controls.

Next Steps:
1. Investigate the user and process that initiated the time change
2. Check if the time change was authorized and documented
3. Review logs before and after the time change for suspicious activities
4. Verify if legitimate time synchronization processes were involved
5. Check for other indicators of compromise on the affected system
6. Consider implementing time change monitoring and approval processes
', '["https://attack.mitre.org/techniques/T1070/006/","https://attack.mitre.org/techniques/T1099/","https://docs.redhat.com/en/documentation/red_hat_enterprise_linux/6/html/security_guide/sec-understanding_audit_log_files"]', 'safe("action", "") == "auditd.log" && (safe("log.auditd.record_type", "") == "TIME_INJOFFSET" || safe("log.auditd.record_type", "") == "TIME_ADJNTPVAL" || (safe("log.auditd.record_type", "") == "SYSCALL" && (safe("log.auditd.syscall", "") == "settimeofday" || safe("log.auditd.syscall", "") == "clock_settime" || safe("log.auditd.syscall", "") == "adjtimex"))) || (safe("log.auditd.exe", "").contains("date") || safe("log.auditd.exe", "").contains("ntpdate") || safe("log.auditd.exe", "").contains("timedatectl") || safe("log.auditd.comm", "").contains("date") || safe("log.auditd.comm", "").contains("ntpdate")))', '2025-09-03 15:29:59.870695', true, false, 'origin', '["adversary.host","adversary.user"]', '[]');
INSERT INTO public.utm_correlation_rules VALUES (572, 'IBM AS/400 Password Policy Violations', 3, 3, 1, 'Discovery', 'T1201 - Password Policy Discovery', 'Detects password policy violations on IBM AS/400 systems including invalid password attempts, password expiration issues, and password composition violations. These events may indicate attempts to bypass security controls or compromised accounts.

Next Steps:
- Investigate the affected user account for signs of compromise
- Review recent authentication attempts from the same user or IP
- Check if this is part of a pattern of policy violations
- Verify if the user needs password reset assistance or security awareness training
- Monitor for any successful authentications following these violations
', '["https://www.ibm.com/docs/en/i/7.4?topic=entries-audit-journal-qaudjrn-entry-types","https://attack.mitre.org/techniques/T1201/"]', 'safe("log.event_type", "") in ["PW", "VP"] && ( safe("log.message", "").contains("password policy") || safe("log.message", "").contains("Password policy") || safe("log.message", "").contains("password expired") || safe("log.message", "").contains("Password expired") || safe("log.message", "").contains("password invalid") || safe("log.message", "").contains("Password invalid") || safe("log.message", "").contains("password composition") || safe("log.message", "").contains("Password composition") || safe("log.message", "").contains("password reuse") || safe("log.message", "").contains("Password reuse") || safe("log.message", "").contains("password minimum") || safe("log.message", "").contains("Password minimum") )', '2025-09-03 15:30:00.610132', true, false, 'origin', '["origin.user"]', '[]');
INSERT INTO public.utm_correlation_rules VALUES (573, 'IBM AS/400 Security Audit Journal Event Detection', 3, 3, 2, 'Defense Evasion', 'T1562.008 - Impair Defenses: Disable or Modify Cloud Logs', 'Detects significant security audit journal events in IBM AS/400 systems including authority failures, password violations, and security configuration changes. This rule monitors for QAUDJRN entries and various audit event types that may indicate security incidents or compliance violations.

Next Steps:
1. Review the specific audit journal entry type (AF=Authority Failure, PW=Password, CP=Control Panel, SV=Service)
2. Identify the user account and system involved in the event
3. Correlate with other security events around the same timeframe
4. Verify if the activity was authorized and expected
5. Check for patterns of repeated violations from the same user or system
6. Review IBM AS/400 security policies and access controls
7. Document findings and update security monitoring if needed
', '["https://www.ibm.com/docs/en/i/7.4?topic=actions-security-auditing-journal-entries","https://attack.mitre.org/techniques/T1562/008/"]', 'safe("log.message", "") != "" && ( safe("log.message", "").contains("QAUDJRN") || safe("log.message", "").contains("journal entry") || safe("log.message", "").contains("audit event") || (safe("log.message", "").contains("entry type") && (safe("log.message", "").contains("AF") || safe("log.message", "").contains("PW") || safe("log.message", "").contains("CP") || safe("log.message", "").contains("SV"))) )', '2025-09-03 15:30:01.265764', true, false, 'origin', NULL, '[]');
INSERT INTO public.utm_correlation_rules VALUES (586, 'Elasticsearch Node Compromise Indicators', 3, 3, 3, 'Initial Access', 'System Compromise', 'Detects patterns indicating potential compromise of an Elasticsearch node, including authentication failures from unusual locations and critical errors.', '["https://www.elastic.co/guide/en/elasticsearch/reference/current/audit-event-types.html","https://attack.mitre.org/techniques/T1190/"]', '(safe("action", "") == "authentication_failed" || safe("severity", "") == "high") && safe("origin.ip", "") != "" && safe("log.nodeName", "") != ""', '2025-09-03 15:32:00.220611', true, false, 'origin', '["origin.ip","log.nodeName"]', '[{"indexPattern":"v11-log-elasticsearch-*","with":[{"field":"log.nodeName.keyword","operator":"filter_term","value":"{{.log.nodeName}}"},{"field":"severity.keyword","operator":"filter_term","value":"high"}],"or":[{"indexPattern":"v11-log-elasticsearch-*","with":[{"field":"origin.ip.keyword","operator":"filter_term","value":"{{.origin.ip}}"},{"field":"action.keyword","operator":"filter_term","value":"authentication_failed"}],"or":null,"within":"now-15m","count":5}],"within":"now-2h","count":10}]');
INSERT INTO public.utm_correlation_rules VALUES (574, 'IBM AS/400 Special Authority Usage Detection', 3, 3, 2, 'Privilege Escalation, Defense Evasion', 'T1548 - Abuse Elevation Control Mechanism', 'Detects usage of special authorities in IBM AS/400 systems including *ALLOBJ, *SECADM, *AUDIT, *SERVICE, *SPLCTL, *JOBCTL, *SAVSYS, and *IOSYSCFG. Special authorities provide elevated privileges that can be abused for unauthorized system access or configuration changes.

Next Steps:
1. Verify if the special authority usage was authorized and part of legitimate administrative activities
2. Review the user account that executed the special authority commands
3. Check if the timing of the activity aligns with scheduled maintenance windows
4. Examine the specific commands executed with special authorities
5. Correlate with any recent privilege escalation requests or administrative changes
6. Monitor for any subsequent suspicious activities from the same user or system
', '["https://www.ibm.com/docs/en/i/7.4?topic=profiles-special-authorities","https://attack.mitre.org/techniques/T1548/"]', 'safe("log.message", "") != "" && ( safe("log.message", "").contains("*ALLOBJ") || safe("log.message", "").contains("*SECADM") || safe("log.message", "").contains("*AUDIT") || safe("log.message", "").contains("*SERVICE") || safe("log.message", "").contains("*SPLCTL") || safe("log.message", "").contains("*JOBCTL") || safe("log.message", "").contains("*SAVSYS") || safe("log.message", "").contains("*IOSYSCFG") || safe("log.message", "").contains("special authority") || safe("log.message", "").contains("elevated privilege") || (safe("log.message", "").contains("SPCAUT") && !safe("log.message", "").contains("*NONE")) )', '2025-09-03 15:30:01.985502', true, false, 'origin', NULL, '[]');
INSERT INTO public.utm_correlation_rules VALUES (575, 'IBM AS/400 System Value Changes Detection', 2, 3, 2, 'Defense Evasion', 'T1562.001 - Impair Defenses: Disable or Modify Tools', 'Detects changes to critical system values in IBM AS/400 systems including security-related system values like QAUDCTL, QAUDLVL, QSECURITY, and QPWDLVL. These system values control important security settings and their modification could indicate privilege escalation attempts or security control bypassing.

Next Steps:
1. Review the specific system value that was changed and its new setting
2. Verify if the change was authorized and documented in change management
3. Check the user account that made the change for legitimacy
4. Review recent user activity for signs of compromise
5. Validate that security controls are still functioning as expected
6. Consider reverting unauthorized changes to maintain security posture
', '["https://www.ibm.com/docs/en/i/7.4?topic=entries-sv-system-value-journal","https://attack.mitre.org/techniques/T1562/001/"]', 'safe("log.message", "") != "" && ( (safe("log.message", "").contains("SV") && safe("log.message", "").contains("system value")) || safe("log.message", "").contains("system value changed") || safe("log.message", "").contains("CHGSYSVAL") || safe("log.message", "").contains("QAUDCTL") || safe("log.message", "").contains("QAUDLVL") || safe("log.message", "").contains("QSECURITY") || safe("log.message", "").contains("QPWDLVL") || safe("log.message", "").contains("QMAXSIGN") || safe("log.message", "").contains("QINACTITV") || safe("log.message", "").contains("QRMTSIGN") || safe("log.message", "").contains("QRETSVRSEC") )', '2025-09-03 15:30:02.465394', true, false, 'origin', NULL, '[]');
INSERT INTO public.utm_correlation_rules VALUES (576, 'Watch Rule Violations', 2, 3, 1, 'Collection', 'T1005 - Data from Local System', 'Detects access violations to files or directories monitored by audit watch rules. This indicates potential unauthorized access to sensitive files being monitored by the Linux audit subsystem.

Next Steps:
1. Verify the legitimacy of the user attempting to access the monitored resource
2. Check if the access attempt was part of authorized system administration activities  
3. Review the specific file or directory being accessed and its sensitivity level
4. Investigate other recent activities by the same user or from the same host
5. Consider implementing additional access controls if unauthorized access is confirmed
6. Review audit logs for patterns of similar violations
7. Check system logs for any privilege escalation attempts around the same time
', '["https://attack.mitre.org/techniques/T1005/","https://documentation.suse.com/sles/15-SP6/html/SLES-all/cha-audit-comp.html"]', 'safe("log.type", "") == "PATH" && safe("log.key", "") != "" && (safe("log.key", "").contains("sensitive") || safe("log.key", "").contains("monitor") || safe("log.key", "").contains("watch")) && safe("log.success", "") == "no"', '2025-09-03 15:30:15.44696', true, false, 'origin', NULL, '[]');
INSERT INTO public.utm_correlation_rules VALUES (1352, 'Windows: LSASS Memory Dump Handle Access', 2, 3, 3, 'Credential Access', 'LSASS Memory', 'Identifies handle requests for the Local Security Authority Subsystem Service (LSASS) object access with specific access masks that many tools with a capability to dump memory to disk use (0x1fffff, 0x1010, 0x120089). This rule is tool agnostic as it has been validated against a host of various LSASS dump tools such as SharpDump, Procdump, Mimikatz, Comsvcs etc. It detects this behavior at a low level and does not depend on a specific tool or dump file name.', '["https://attack.mitre.org/tactics/TA0006/","https://attack.mitre.org/techniques/T1003/","https://attack.mitre.org/techniques/T1003/001/"]', 'safe("log.eventCode", 0.0) == double(4656) && safe("log.winlogEventDataObjectName", "").matches(''(:\\Windows\\System32\\lsass.exe|\\Device\\HarddiskVolume[A-Za-z?:\\]([A-Za-z?])?\\Windows\\System32\\lsass.exe)'') && !safe("log.winlogEventDataProcessName", "").matches(''(:\\Program Files\\(.+).exe|:\\Program Files (x86)\\(.+).exe|:\\Windows\\system32\\wbem\\WmiPrvSE.exe|:\\Windows\\System32\\dllhost.exe|:\\Windows\\System32\\svchost.exe|:\\Windows\\System32\\msiexec.exe|:\\ProgramData\\Microsoft\\Windows Defender\\(.+).exe|:\\Windows\\explorer.exe)'') && safe("log.winlogEventDataAccessMask", "") in [''0x1fffff'', ''0x1010'', ''0x120089'', ''0x1F3FFF'']', '2025-09-04 20:25:23.950708', true, false, 'origin', NULL, '[]');
INSERT INTO public.utm_correlation_rules VALUES (578, 'Elasticsearch Audit Log Gaps Detected', 2, 3, 2, 'Defense Evasion', 'T1070 - Indicator Removal on Host', 'Detects gaps in Elasticsearch audit logging which may indicate log tampering, service disruption, or attempts to evade detection by disabling audit functionality. This rule identifies audit trail disruptions, audit component errors, or security configuration changes that could compromise logging integrity.

Next Steps:
1. Verify Elasticsearch cluster health and audit configuration status
2. Check for unauthorized changes to audit settings or policies
3. Review system logs for service interruptions or manual audit disabling
4. Examine user activity around the time of audit gaps for suspicious behavior
5. Validate audit log storage and retention policies are intact
6. Consider implementing audit log backup and monitoring mechanisms
', '["https://www.elastic.co/guide/en/elasticsearch/reference/current/audit-event-types.html","https://attack.mitre.org/techniques/T1070/"]', 'safe("log.msg", "").contains("audit_trail_stopped") || (safe("log.component", "") == "Audit" && safe("log.level", "") == "ERROR") || safe("log.msg", "").contains("audit_config_change")', '2025-09-03 15:31:52.936049', true, false, 'origin', '["log.nodeName"]', '[{"indexPattern":"v11-log-elasticsearch-*","with":[{"field":"log.nodeName.keyword","operator":"filter_term","value":"{{.log.nodeName}}"}],"or":null,"within":"now-6h","count":3}]');
INSERT INTO public.utm_correlation_rules VALUES (579, 'Suspicious Cluster State Modifications', 2, 3, 3, 'Defense Evasion', 'T1562.001 - Impair Defenses: Disable or Modify Tools', 'Detects unauthorized or suspicious modifications to the Elasticsearch cluster state, which could indicate attempts to compromise cluster integrity or availability. This rule identifies when multiple cluster configuration changes occur within a short timeframe.

Next Steps:
1. Review the user account making the modifications and verify authorization
2. Examine the specific configuration changes made to the cluster
3. Check if the changes align with scheduled maintenance or deployment activities
4. Investigate the source IP and access patterns of the user
5. Review cluster audit logs for additional suspicious activities
6. Validate cluster health and performance after the modifications
', '["https://www.elastic.co/guide/en/elasticsearch/reference/current/audit-event-types.html","https://attack.mitre.org/techniques/T1562/001/"]', 'safe("level", "") == "hight" && safe("log.component", "") != "" && safe("log.msg", "") != "" && safe("log.nodeName", "") != ""', '2025-09-03 15:31:53.997258', true, false, 'origin', '["log.nodeName","origin.ip"]', '[{"indexPattern":"v11-log-elasticsearch-*","with":[{"field":"log.nodeName.keyword","operator":"filter_term","value":"{{.log.nodeName}}"},{"field":"level.keyword","operator":"filter_term","value":"hight"}],"or":null,"within":"now-30m","count":3}]');
INSERT INTO public.utm_correlation_rules VALUES (580, 'Cross-Cluster Search Abuse Detected', 3, 2, 3, 'Collection', 'T1213 - Data from Information Repositories', 'Detects suspicious cross-cluster search activities that may indicate unauthorized data access, reconnaissance, or data exfiltration attempts across multiple Elasticsearch clusters. Cross-cluster search allows querying multiple clusters, and unusual patterns may indicate an attacker attempting to access data across distributed environments.

Next Steps:
- Review the user account and verify legitimacy of cross-cluster search operations
- Examine the specific queries and data accessed during the cross-cluster search
- Check for any unusual data volumes or sensitive indices being accessed
- Validate the source IP address and ensure it''s from an authorized location
- Review cluster configuration and cross-cluster search permissions
- Investigate if this activity correlates with other suspicious Elasticsearch operations
- Check for any data exfiltration indicators or unauthorized data access patterns
- Verify the cluster names involved in the cross-cluster search operations
', '["https://www.elastic.co/guide/en/elasticsearch/reference/current/modules-cross-cluster-search.html","https://attack.mitre.org/techniques/T1213/"]', '(safe("log.msg", "").contains("_remote") || safe("origin.url", "").contains("_remote")) && (safe("action", "") == "access_granted" || safe("log.component", "") == "transport") && (safe("log.level", "") == "INFO" || safe("log.level", "") == "WARN")', '2025-09-03 15:31:56.271424', true, false, 'origin', '["origin.user","origin.ip","log.nodeName"]', '[{"indexPattern":"v11-log-elasticsearch-*","with":[{"field":"origin.user.keyword","operator":"filter_term","value":"{{.origin.user}}"},{"field":"origin.ip.keyword","operator":"filter_term","value":"{{.origin.ip}}"}],"or":null,"within":"now-30m","count":10}]');
INSERT INTO public.utm_correlation_rules VALUES (581, 'Data Stream Tampering Attempt Detected', 2, 3, 2, 'Impact', 'T1565 - Data Manipulation', 'Detects attempts to tamper with Elasticsearch data streams through unauthorized modifications, deletions, or rollover operations that could compromise data integrity. Data stream tampering can lead to data loss, corruption, or unauthorized access to sensitive information.

Next Steps:
1. Review the specific data stream operation that triggered this alert
2. Verify if the user performing the operation has legitimate authorization
3. Check for any concurrent suspicious activities from the same user or IP
4. Examine the data streams affected for any signs of compromise
5. Review access logs for unusual patterns or unauthorized access attempts
6. Consider temporarily restricting access to critical data streams
7. Validate data integrity of affected streams
', '["https://www.elastic.co/guide/en/elasticsearch/reference/current/data-streams.html","https://attack.mitre.org/techniques/T1565/"]', 'safe("log.msg", "").contains("_data_stream") && (safe("log.msg", "").contains("DELETE") || safe("log.msg", "").contains("PUT") || safe("log.msg", "").contains("_rollover") || safe("log.msg", "").contains("_modify_data_stream"))', '2025-09-03 15:31:57.327938', true, false, 'origin', '["log.nodeName"]', '[]');
INSERT INTO public.utm_correlation_rules VALUES (950, 'System Linux: Nping Process Activity', 1, 1, 2, 'Discovery', 'Network Service Discovery', 'Some normal use of this command may originate from security engineers and network or server administrators, but this is usually not routine or unannounced. Use of Nping by non-engineers or ordinary users is uncommon.', '["https://attack.mitre.org/tactics/TA0007/","https://attack.mitre.org/techniques/T1046/"]', 'safe("log.message", "").matches("(nping)")', '2025-09-03 16:37:32.868027', true, false, 'origin', NULL, '[]');
INSERT INTO public.utm_correlation_rules VALUES (597, 'Elasticsearch Query Injection Attempt Detection', 3, 3, 2, 'Initial Access', 'T1190 - Exploit Public-Facing Application', 'Detects potential query injection attempts in Elasticsearch through suspicious log messages containing injection patterns, script execution attempts, or unauthorized query operations. This rule identifies malicious attempts to execute arbitrary scripts or manipulate queries through REST API requests.

Next Steps:
1. Investigate the source IP address and verify if it''s authorized to access Elasticsearch
2. Review the specific log messages and component details for injection indicators
3. Check for any successful script executions or data manipulation
4. Validate Elasticsearch security configurations and access controls
5. Monitor for additional suspicious activities from the same source
6. Consider implementing query validation and input sanitization
', '["https://www.elastic.co/guide/en/elasticsearch/reference/current/audit-event-types.html","https://attack.mitre.org/techniques/T1190/"]', 'safe("log.msg", "") != "" && safe("log.component", "") != "" && (safe("log.msg", "").contains("script") || safe("log.msg", "").contains("injection") || safe("log.msg", "").contains("_search") || (safe("log.msg", "").contains("query") && safe("log.level", "") == "ERROR"))', '2025-09-03 15:32:27.037797', true, false, 'origin', NULL, '[]');
INSERT INTO public.utm_correlation_rules VALUES (582, 'Elasticsearch Enrich Policy Manipulation', 2, 3, 2, 'Defense Evasion', 'T1562.001 - Impair Defenses: Disable or Modify Tools', 'Detects unauthorized manipulation of Elasticsearch enrich policies which could be used to tamper with data enrichment processes, potentially leading to data integrity issues or bypassing security controls. Enrich policies are used to add data from existing indices to incoming documents during ingestion, and unauthorized changes could compromise data quality or security controls. This rule specifically monitors REST API calls to enrich policy endpoints that may indicate creation, modification, or deletion of enrich policies.

Next Steps:
1. Verify if the policy modification was authorized and documented
2. Review the specific enrich policy changes made and identify the API operation (PUT, POST, DELETE)
3. Check if the user performing the action has legitimate administrative access to manage enrich policies
4. Examine any data that may have been affected by the policy change
5. Review audit logs for other suspicious configuration changes in the same timeframe
6. Validate that security controls dependent on enrichment are still functioning properly
7. Check for any unusual patterns in data enrichment results following the policy change
', '["https://www.elastic.co/guide/en/elasticsearch/reference/current/ingest-enriching-data.html","https://attack.mitre.org/techniques/T1562/001/"]', 'safe("log.msg", "").contains("/_enrich/policy") && safe("level", "") == "low" && safe("log.component", "").contains("rest")', '2025-09-03 15:31:57.828405', true, false, 'origin', '["log.nodeName","adversary.user"]', '[]');
INSERT INTO public.utm_correlation_rules VALUES (583, 'Fleet Integration Issues Detected', 1, 2, 3, 'Impact', 'T1489 - Service Stop', 'Detects Fleet integration issues in Elasticsearch that could indicate service disruption, communication failures, or potential tampering with Fleet-managed agents. This rule monitors for error conditions in Fleet components that may signal operational problems or security issues.

**Next Steps:**
1. Review the specific error message and component affected
2. Check Fleet agent connectivity and enrollment status
3. Examine Elasticsearch cluster health and node status
4. Verify network connectivity between agents and Fleet server
5. Review Fleet server logs for additional context
6. Check for any recent configuration changes or updates
7. Monitor for repeated failures indicating persistent issues
8. Investigate if this is part of a coordinated attack on infrastructure
9. Review access logs for unauthorized configuration changes
10. Verify Fleet server certificate validity and SSL/TLS configuration
', '["https://www.elastic.co/guide/en/fleet/current/fleet-troubleshooting.html","https://attack.mitre.org/techniques/T1489/"]', 'safe("log.component", "") != "" && (safe("log.component", "").contains("fleet") || safe("log.component", "").contains("agent")) && safe("level", "") == "medium" && (safe("log.msg", "").contains("failed") || safe("log.msg", "").contains("error") || safe("log.msg", "").contains("timeout") || safe("log.msg", "").contains("disconnect"))', '2025-09-03 15:31:58.464491', true, false, 'origin', '["log.nodeName","log.component"]', '[{"indexPattern":"v11-log-elasticsearch-*","with":[{"field":"log.nodeName.keyword","operator":"filter_term","value":"{{.log.nodeName}}"},{"field":"log.component.keyword","operator":"filter_term","value":"{{.log.component}}"}],"or":null,"within":"now-15m","count":5}]');
INSERT INTO public.utm_correlation_rules VALUES (584, 'ILM Policy Violation Detected', 2, 3, 3, 'Defense Evasion', 'T1562.001 - Impair Defenses: Disable or Modify Tools', 'Detects violations and unauthorized modifications to Index Lifecycle Management (ILM) policies that could lead to data retention issues, premature data deletion, or compliance violations. ILM policy modifications can be used by attackers to evade detection by altering log retention settings or deleting historical evidence.

Next Steps:
1. Verify the legitimacy of the ILM policy modification with the Elasticsearch administrator
2. Check if the modification was part of scheduled maintenance or authorized changes
3. Review the specific policy changes made and assess their security impact
4. Examine surrounding log events for signs of unauthorized access
5. Validate that proper access controls are in place for ILM policy management
6. Consider implementing additional monitoring for administrative Elasticsearch operations
', '["https://www.elastic.co/guide/en/elasticsearch/reference/current/index-lifecycle-management.html","https://attack.mitre.org/techniques/T1562/"]', '(safe("log.msg", "").contains("_ilm") || safe("origin.url", "").contains("_ilm/policy")) && (safe("log.msg", "").contains("DELETE") || safe("log.msg", "").contains("PUT") || safe("action", "") == "access_denied" || (safe("log.level", "") == "ERROR" && safe("log.component", "").contains("ilm")))', '2025-09-03 15:31:58.913552', true, false, 'origin', '["origin.ip","log.component"]', '[]');
INSERT INTO public.utm_correlation_rules VALUES (585, 'Machine Learning Job Tampering Detection', 2, 3, 2, 'Impact', 'T1496 - Resource Hijacking', 'Detects attempts to tamper with or modify Elasticsearch machine learning jobs, which could indicate an attacker trying to manipulate anomaly detection or hide malicious activities. This includes deletion, modification, closing, or stopping of ML jobs, datafeeds, or anomaly detectors.

Next Steps:
1. Verify the legitimacy of the ML job modification with the user or administrator
2. Review the specific ML job or datafeed that was modified
3. Check for any other suspicious activities from the same user or IP address
4. Validate if the modification was part of scheduled maintenance
5. Investigate the impact on anomaly detection capabilities
6. Review audit logs for additional context around the modification
', '["https://www.elastic.co/guide/en/elasticsearch/reference/current/ml-apis.html","https://attack.mitre.org/techniques/T1496/"]', 'safe("log.msg", "") != "" && (safe("log.msg", "").contains("cluster:admin/xpack/ml/job/") || safe("log.msg", "").contains("cluster:admin/xpack/ml/datafeed/") || safe("log.msg", "").contains("cluster:admin/xpack/ml/anomaly_detectors/")) && (safe("log.msg", "").contains("/delete") || safe("log.msg", "").contains("/update") || safe("log.msg", "").contains("/close") || safe("log.msg", "").contains("/stop"))', '2025-09-03 15:31:59.76266', true, false, 'origin', '["log.nodeName","origin.user"]', '[]');
INSERT INTO public.utm_correlation_rules VALUES (587, 'API Key Abuse Detection', 3, 3, 2, 'Credential Access', 'T1528 - Steal Application Access Token', 'Detects suspicious API key operations including excessive creation, deletion, or usage patterns that could indicate credential theft or abuse. This rule monitors for authentication failures with API keys, administrative API key operations, and access denied events involving API keys.

Next Steps:
1. Review the specific API key operations and authentication attempts
2. Verify if the API key usage patterns are legitimate
3. Check for any correlation with other suspicious activities from the same source
4. Review API key permissions and access controls
5. Consider rotating compromised API keys if abuse is confirmed
6. Investigate the source IP and user context for additional indicators
7. Check Elasticsearch audit logs for additional context
8. Verify if the API key belongs to a legitimate service account
', '["https://www.elastic.co/guide/en/elasticsearch/reference/current/security-api-create-api-key.html","https://attack.mitre.org/techniques/T1528/"]', 'safe("log.component", "") == "o.e.x.s.a.ApiKeyService" && ( (safe("log.message", "").contains("authentication_failed") && safe("log.message", "").contains("API_KEY")) || (safe("log.message", "").contains("cluster:admin/xpack/security/api_key/") && (safe("log.message", "").contains("create") || safe("log.message", "").contains("invalidate"))) || (safe("log.level", "") == "WARN" && safe("log.message", "").contains("API_KEY")) )', '2025-09-03 15:32:02.170761', true, false, 'origin', NULL, '[]');
INSERT INTO public.utm_correlation_rules VALUES (598, 'Role Mapping Changes Detection', 3, 3, 2, 'Persistence, Privilege Escalation', 'T1098 - Account Manipulation', 'Detects changes to role mappings in Elasticsearch, which could indicate an attacker attempting to escalate privileges or grant unauthorized access to sensitive indices. Role mapping modifications can be used to persist access or escalate privileges by mapping external users to privileged Elasticsearch roles.

Next Steps:
1. Verify if the role mapping change was authorized and performed by a legitimate administrator
2. Review the specific role mapping that was modified to understand what permissions were granted
3. Check if the user making the change has appropriate privileges for this operation
4. Examine recent authentication logs for the user account involved
5. Review all recent role mapping changes and verify their legitimacy
6. Consider implementing change management processes for security role modifications
', '["https://www.elastic.co/guide/en/elasticsearch/reference/current/security-api-put-role-mapping.html","https://attack.mitre.org/techniques/T1098/"]', 'safe("log.msg", "").contains("role_mapping") && (safe("log.msg", "").contains("PUT") || safe("log.msg", "").contains("POST") || safe("log.msg", "").contains("DELETE")) && safe("log.component", "") == "o.e.x.s.a.RoleMapping"', '2025-09-03 15:32:27.456958', true, false, 'origin', '["origin.user","log.nodeName"]', '[]');
INSERT INTO public.utm_correlation_rules VALUES (599, 'Security Realm Modifications Detection', 3, 3, 2, 'Defense Evasion, Persistence, Privilege Escalation, Initial Access', 'T1078 - Valid Accounts', 'Detects modifications to Elasticsearch security realms, which could indicate an attacker attempting to bypass authentication or create backdoor access. Security realm changes can be used to establish persistence or escalate privileges within Elasticsearch environments.

Next Steps:
1. Verify if the realm modification was authorized and documented
2. Review the user account that made the changes for signs of compromise
3. Check for any concurrent suspicious authentication attempts
4. Examine other recent security configuration changes in Elasticsearch
5. Validate that the modified realm configurations follow security best practices
', '["https://www.elastic.co/guide/en/elasticsearch/reference/current/security-settings.html","https://attack.mitre.org/techniques/T1078/"]', 'safe("log.component", "") == "Security" && safe("log.message", "").contains("realm") && (safe("log.message", "").contains("created") || safe("log.message", "").contains("updated") || safe("log.message", "").contains("deleted") || safe("log.message", "").contains("modified")) && safe("origin.user", "") != ""', '2025-09-03 15:32:27.883952', true, false, 'origin', NULL, '[]');
INSERT INTO public.utm_correlation_rules VALUES (600, 'Token Service Anomalies Detection', 3, 3, 2, 'Defense Evasion, Persistence, Privilege Escalation, Initial Access', 'T1078 - Valid Accounts', 'Detects anomalous token service behavior including excessive token generation, failed token authentications, or suspicious token operations that could indicate unauthorized access attempts.

Next Steps:
- Review the source IP and user associated with the token activities
- Check Elasticsearch audit logs for additional suspicious activities from the same source
- Verify if the token operations are legitimate business activities
- Monitor for any data access or privilege escalation following token abuse
- Consider implementing additional authentication controls for token services
', '["https://www.elastic.co/guide/en/elasticsearch/reference/current/security-api-get-token.html","https://attack.mitre.org/techniques/T1078/"]', '(safe("log.authenticationType", "") == "TOKEN" && (safe("actionResult", "") == "failure" || safe("log.eventType", "") == "access_denied")) || (safe("action", "").contains("cluster:admin/xpack/security/token/") && (safe("action", "").contains("/create") || safe("action", "").contains("/invalidate") || safe("action", "").contains("/refresh"))) || (safe("log.component", "") == "Security" && safe("log.message", "").contains("token") && safe("log.level", "") in ["ERROR", "WARN"])', '2025-09-03 15:32:28.504303', true, false, 'origin', '["origin.ip","origin.user"]', '[]');
INSERT INTO public.utm_correlation_rules VALUES (590, 'Cross-Cluster Search Abuse Detected', 3, 2, 3, 'Collection', 'T1213 - Data from Information Repositories', 'Detects suspicious cross-cluster search activities that may indicate unauthorized data access, reconnaissance, or data exfiltration attempts across multiple Elasticsearch clusters. Cross-cluster search allows querying multiple clusters, and unusual patterns may indicate an attacker attempting to access data across distributed environments.

Next Steps:
- Review the user account and verify legitimacy of cross-cluster search operations
- Examine the specific queries and data accessed during the cross-cluster search
- Check for any unusual data volumes or sensitive indices being accessed
- Validate the source IP address and ensure it''s from an authorized location
- Review cluster configuration and cross-cluster search permissions
- Investigate if this activity correlates with other suspicious Elasticsearch operations
- Check for any data exfiltration indicators or unauthorized data access patterns
- Verify the cluster names involved in the cross-cluster search operations
', '["https://www.elastic.co/guide/en/elasticsearch/reference/current/modules-cross-cluster-search.html","https://attack.mitre.org/techniques/T1213/"]', '(safe("log.msg", "").contains("_remote") || safe("origin.url", "").contains("_remote")) && (safe("action", "") == "access_granted" || safe("log.component", "") == "transport") && (safe("log.level", "") == "INFO" || safe("log.level", "") == "WARN")', '2025-09-03 15:32:03.627981', true, false, 'origin', '["origin.user","origin.ip","log.nodeName"]', '[{"indexPattern":"v11-log-elasticsearch-*","with":[{"field":"origin.user.keyword","operator":"filter_term","value":"{{.origin.user}}"},{"field":"origin.ip.keyword","operator":"filter_term","value":"{{.origin.ip}}"}],"or":null,"within":"now-30m","count":10}]');
INSERT INTO public.utm_correlation_rules VALUES (644, 'IIS TRACE Method Cross-Site Tracing (XST) Attempt', 3, 2, 1, 'Credential Access', 'T1539 - Steal Web Session Cookie', 'Detects usage of TRACE HTTP method which could be used for Cross-Site Tracing attacks to steal authentication cookies or bypass HttpOnly cookie protection. The TRACE method can be exploited to reflect client requests back, potentially exposing sensitive headers including authentication cookies.

Next Steps:
1. Review the source IP and user agent for signs of automated scanning tools
2. Check if the TRACE method is enabled on the web server and disable if not needed
3. Examine subsequent requests from the same source for additional attack patterns
4. Verify web application firewall rules are blocking TRACE requests
5. Review server configuration to ensure proper HTTP method restrictions
', '["https://attack.mitre.org/techniques/T1539/","https://owasp.org/www-community/attacks/Cross_Site_Tracing"]', 'safe("log.method", "") == "TRACE" && (safe("statusCode", 0.0) == double(200) || safe("statusCode", 0.0) == double(405) || safe("statusCode", 0.0) == double(501)) && (!safe("origin.ip", "").matches("^(10\\.|172\\.(1[6-9]|2[0-9]|3[01])\\.|192\\.168\\.|127\\.)") || safe("log.userAgent", "").matches("(?i).*(scanner|nikto|nessus|qualys|nmap|burp|zap|acunetix).*"))', '2025-09-03 15:37:14.208413', true, false, 'origin', NULL, '[]');
INSERT INTO public.utm_correlation_rules VALUES (592, 'Elasticsearch Enrich Policy Manipulation', 2, 3, 2, 'Defense Evasion', 'T1562.001 - Impair Defenses: Disable or Modify Tools', 'Detects unauthorized manipulation of Elasticsearch enrich policies which could be used to tamper with data enrichment processes, potentially leading to data integrity issues or bypassing security controls. Enrich policies are used to add data from existing indices to incoming documents during ingestion, and unauthorized changes could compromise data quality or security controls. This rule specifically monitors REST API calls to enrich policy endpoints that may indicate creation, modification, or deletion of enrich policies.

Next Steps:
1. Verify if the policy modification was authorized and documented
2. Review the specific enrich policy changes made and identify the API operation (PUT, POST, DELETE)
3. Check if the user performing the action has legitimate administrative access to manage enrich policies
4. Examine any data that may have been affected by the policy change
5. Review audit logs for other suspicious configuration changes in the same timeframe
6. Validate that security controls dependent on enrichment are still functioning properly
7. Check for any unusual patterns in data enrichment results following the policy change
', '["https://www.elastic.co/guide/en/elasticsearch/reference/current/ingest-enriching-data.html","https://attack.mitre.org/techniques/T1562/001/"]', 'safe("log.msg", "").contains("/_enrich/policy") && safe("level", "") == "low" && safe("log.component", "").contains("rest")', '2025-09-03 15:32:04.636177', true, false, 'origin', '["log.nodeName","adversary.user"]', '[]');
INSERT INTO public.utm_correlation_rules VALUES (593, 'Fleet Integration Issues Detected', 1, 2, 3, 'Impact', 'T1489 - Service Stop', 'Detects Fleet integration issues in Elasticsearch that could indicate service disruption, communication failures, or potential tampering with Fleet-managed agents. This rule monitors for error conditions in Fleet components that may signal operational problems or security issues.

**Next Steps:**
1. Review the specific error message and component affected
2. Check Fleet agent connectivity and enrollment status
3. Examine Elasticsearch cluster health and node status
4. Verify network connectivity between agents and Fleet server
5. Review Fleet server logs for additional context
6. Check for any recent configuration changes or updates
7. Monitor for repeated failures indicating persistent issues
8. Investigate if this is part of a coordinated attack on infrastructure
9. Review access logs for unauthorized configuration changes
10. Verify Fleet server certificate validity and SSL/TLS configuration
', '["https://www.elastic.co/guide/en/fleet/current/fleet-troubleshooting.html","https://attack.mitre.org/techniques/T1489/"]', 'safe("log.component", "") != "" && (safe("log.component", "").contains("fleet") || safe("log.component", "").contains("agent")) && safe("level", "") == "medium" && (safe("log.msg", "").contains("failed") || safe("log.msg", "").contains("error") || safe("log.msg", "").contains("timeout") || safe("log.msg", "").contains("disconnect"))', '2025-09-03 15:32:05.532096', true, false, 'origin', '["log.nodeName","log.component"]', '[{"indexPattern":"v11-log-elasticsearch-*","with":[{"field":"log.nodeName.keyword","operator":"filter_term","value":"{{.log.nodeName}}"},{"field":"log.component.keyword","operator":"filter_term","value":"{{.log.component}}"}],"or":null,"within":"now-15m","count":5}]');
INSERT INTO public.utm_correlation_rules VALUES (594, 'ILM Policy Violation Detected', 2, 3, 3, 'Defense Evasion', 'T1562.001 - Impair Defenses: Disable or Modify Tools', 'Detects violations and unauthorized modifications to Index Lifecycle Management (ILM) policies that could lead to data retention issues, premature data deletion, or compliance violations. ILM policy modifications can be used by attackers to evade detection by altering log retention settings or deleting historical evidence.

Next Steps:
1. Verify the legitimacy of the ILM policy modification with the Elasticsearch administrator
2. Check if the modification was part of scheduled maintenance or authorized changes
3. Review the specific policy changes made and assess their security impact
4. Examine surrounding log events for signs of unauthorized access
5. Validate that proper access controls are in place for ILM policy management
6. Consider implementing additional monitoring for administrative Elasticsearch operations
', '["https://www.elastic.co/guide/en/elasticsearch/reference/current/index-lifecycle-management.html","https://attack.mitre.org/techniques/T1562/"]', '(safe("log.msg", "").contains("_ilm") || safe("origin.url", "").contains("_ilm/policy")) && (safe("log.msg", "").contains("DELETE") || safe("log.msg", "").contains("PUT") || safe("action", "") == "access_denied" || (safe("log.level", "") == "ERROR" && safe("log.component", "").contains("ilm")))', '2025-09-03 15:32:05.953611', true, false, 'origin', '["origin.ip","log.component"]', '[]');
INSERT INTO public.utm_correlation_rules VALUES (595, 'Machine Learning Job Tampering Detection', 2, 3, 2, 'Impact', 'T1496 - Resource Hijacking', 'Detects attempts to tamper with or modify Elasticsearch machine learning jobs, which could indicate an attacker trying to manipulate anomaly detection or hide malicious activities. This includes deletion, modification, closing, or stopping of ML jobs, datafeeds, or anomaly detectors.

Next Steps:
1. Verify the legitimacy of the ML job modification with the user or administrator
2. Review the specific ML job or datafeed that was modified
3. Check for any other suspicious activities from the same user or IP address
4. Validate if the modification was part of scheduled maintenance
5. Investigate the impact on anomaly detection capabilities
6. Review audit logs for additional context around the modification
', '["https://www.elastic.co/guide/en/elasticsearch/reference/current/ml-apis.html","https://attack.mitre.org/techniques/T1496/"]', 'safe("log.msg", "") != "" && (safe("log.msg", "").contains("cluster:admin/xpack/ml/job/") || safe("log.msg", "").contains("cluster:admin/xpack/ml/datafeed/") || safe("log.msg", "").contains("cluster:admin/xpack/ml/anomaly_detectors/")) && (safe("log.msg", "").contains("/delete") || safe("log.msg", "").contains("/update") || safe("log.msg", "").contains("/close") || safe("log.msg", "").contains("/stop"))', '2025-09-03 15:32:06.410562', true, false, 'origin', '["log.nodeName","origin.user"]', '[]');
INSERT INTO public.utm_correlation_rules VALUES (596, 'Elasticsearch Node Compromise Indicators', 3, 3, 3, 'Initial Access', 'System Compromise', 'Detects patterns indicating potential compromise of an Elasticsearch node, including authentication failures from unusual locations and critical errors.', '["https://www.elastic.co/guide/en/elasticsearch/reference/current/audit-event-types.html","https://attack.mitre.org/techniques/T1190/"]', '(safe("action", "") == "authentication_failed" || safe("severity", "") == "high") && safe("origin.ip", "") != "" && safe("log.nodeName", "") != ""', '2025-09-03 15:32:06.834897', true, false, 'origin', '["origin.ip","log.nodeName"]', '[{"indexPattern":"v11-log-elasticsearch-*","with":[{"field":"log.nodeName.keyword","operator":"filter_term","value":"{{.log.nodeName}}"},{"field":"severity.keyword","operator":"filter_term","value":"high"}],"or":[{"indexPattern":"v11-log-elasticsearch-*","with":[{"field":"origin.ip.keyword","operator":"filter_term","value":"{{.origin.ip}}"},{"field":"action.keyword","operator":"filter_term","value":"authentication_failed"}],"or":null,"within":"now-15m","count":5}],"within":"now-2h","count":10}]');
INSERT INTO public.utm_correlation_rules VALUES (1460, 'Windows Defender: ERROR: ACTIONS FAILED', 1, 2, 3, 'Potentially Compromised System', 'User Execution', 'Detects the ''ACTIONS FAILED'' error event in Windows Defender, which may indicate protection issues or failed remediation actions on the system.', '["https://learn.microsoft.com/en-us/windows/security/threat-protection/windows-defender-antivirus/troubleshoot"]', 'safe("log.winlogEventDataLogName", "") == "Microsoft-Windows-Windows Defender/Operational" &&  safe("log.winlogEventDataErrorCode", "") == "0x80501001"', '2025-09-04 21:02:19.678482', true, false, 'target', NULL, '[]');
INSERT INTO public.utm_correlation_rules VALUES (614, 'Load Balancing Algorithm Abuse', 2, 3, 3, 'Impact', 'T1499 - Endpoint Denial of Service', 'Detects attempts to abuse load balancing algorithms through session persistence manipulation, backend server targeting, or uneven distribution patterns. This rule identifies potential abuse through multiple indicators including excessive server queues, suspicious termination states, session cookie manipulation, uneven connection distribution, and excessive retries.

Next Steps:
1. Investigate the source IP for patterns of malicious behavior
2. Review HAProxy logs for unusual session persistence behavior
3. Check backend server health and capacity metrics
4. Analyze connection distribution patterns across backend servers
5. Examine cookie values for manipulation attempts
6. Monitor for continued abuse patterns from the same source
7. Consider implementing rate limiting or blocking the source IP
8. Review load balancing algorithm configuration for potential vulnerabilities
', '["https://www.haproxy.com/documentation/haproxy-configuration-tutorials/load-balancing/","https://attack.mitre.org/techniques/T1499/"]', '(safe("log.backend_name", "") != "" && safe("log.server_name", "") != "" && safe("log.srv_queue", 0) > 100) || (safe("log.termination_state", "") != "" && ( safe("log.termination_state", "").contains("sQ") || safe("log.termination_state", "").contains("SC"))) || (safe("log.captured_request_cookie", "") != "" && ( safe("log.captured_request_cookie", "").contains("SERVERID=") || safe("log.captured_request_cookie", "").contains("JSESSIONID="))) || (safe("log.srv_conn", 0) > 1000 && safe("log.backend_queue", 0.0) == double(0)) || (safe("log.retries", 0) > 3 && safe("log.srv_queue", 0) > 50)', '2025-09-03 15:34:22.811313', true, false, 'origin', '["origin.ip","log.backend_name"]', '[]');
INSERT INTO public.utm_correlation_rules VALUES (615, 'HAProxy Lua Script Exploitation Attempts', 3, 3, 2, 'Execution', 'T1203 - Exploitation for Client Execution', 'Detects potential exploitation attempts targeting HAProxy Lua scripting functionality, including command injection attempts, suspicious Lua function calls, or attempts to execute system commands through Lua scripts.

Next Steps:
1. Review the specific Lua script content and execution context in HAProxy logs
2. Verify if the Lua script execution was authorized and expected
3. Check for any system command execution or file access through Lua functions
4. Examine the source IP and investigate for other suspicious activities
5. Review HAProxy configuration for proper Lua script security controls
6. If confirmed malicious, block the source IP and review all Lua scripts for vulnerabilities
', '["https://www.stackhawk.com/blog/lua-command-injection-examples-and-prevention/","https://docs.haproxy.org/2.8/configuration.html","https://attack.mitre.org/techniques/T1203/"]', 'safe("log.message", "").matches(".*lua.*\\b(os\\.execute|io\\.popen|loadstring|dofile|require|debug\\.).*") || safe("log.message", "").contains("lua-load") || safe("log.message", "").matches(".*lua.*error.*") || safe("log.message", "").matches(".*lua.*(fork|exec|system|spawn).*") || safe("origin.url", "").matches(".*lua.*[;<>&|`$(){}\\[\\]].*")', '2025-09-03 15:34:23.258283', true, false, 'origin', NULL, '[]');
INSERT INTO public.utm_correlation_rules VALUES (616, 'HAProxy Map File Injection Detection', 3, 3, 2, 'Initial Access', 'T1190 - Exploit Public-Facing Application', 'Detects potential injection attempts in HAProxy map files which could be used to manipulate request routing, header manipulation, or access control lists. Map files are used for dynamic configuration and URL rewriting.

Next Steps:
1. Review HAProxy configuration files and map file contents for unauthorized modifications
2. Check access logs for unusual patterns in requests that may have triggered map file errors
3. Verify the integrity of map files by comparing with known good backups
4. Investigate the source of map file update requests and validate authorization
5. Review file system permissions on HAProxy configuration directories
6. Check for any suspicious processes or scripts that may be modifying map files
7. Analyze network traffic for potential injection payloads targeting HAProxy map functionality
', '["https://www.haproxy.com/blog/introduction-to-haproxy-maps","https://attack.mitre.org/techniques/T1190/"]', 'safe("log.message", "") != "" && (safe("log.message", "").contains("map") || safe("log.message", "").contains("acl")) && (safe("log.message", "").contains("invalid entry") || safe("log.message", "").contains("map update failed") || safe("log.message", "").contains("pattern mismatch") || safe("log.message", "").contains("illegal character") || safe("log.message", "").contains("map reload error") || safe("log.message", "").matches("map .* contains suspicious")', '2025-09-03 15:34:23.980003', true, false, 'origin', NULL, '[]');
INSERT INTO public.utm_correlation_rules VALUES (601, 'Elasticsearch Transform Abuse Detected', 3, 2, 3, 'Resource Development', 'T1587 - Develop Capabilities', 'Detects suspicious usage of Elasticsearch transforms that could be used for unauthorized data aggregation, exfiltration preparation, or resource exhaustion attacks. Transform operations can be abused to process large amounts of data, create continuous data pipelines for exfiltration, or consume cluster resources maliciously.

Next Steps:
1. Review the specific transform operation and its configuration
2. Verify if the user is authorized to create or modify transforms
3. Check the transform source and destination indices for sensitive data
4. Monitor cluster performance for resource exhaustion
5. Examine the transform script content for malicious operations
6. Review recent user activity for other suspicious elasticsearch operations
7. Correlate with authentication logs to verify user identity
8. Check for any data exfiltration attempts following transform operations
', '["https://www.elastic.co/guide/en/elasticsearch/reference/current/transforms.html","https://attack.mitre.org/techniques/T1587/"]', '(safe("log.message", "").contains("_transform") || safe("log.component", "").contains("transform")) && (safe("log.level", "") == "INFO" || safe("log.level", "") == "WARN") && (safe("log.message", "").contains("script") || safe("log.message", "").contains("continuous") || safe("log.message", "").contains("start") || safe("log.message", "").contains("create"))', '2025-09-03 15:32:28.936122', true, false, 'origin', '["origin.user","origin.host"]', '[]');
INSERT INTO public.utm_correlation_rules VALUES (1397, 'Windows: Microsoft Exchange Server UM Writing Suspicious Files', 2, 3, 2, 'Initial Access', 'Exploit Public-Facing Application', 'Identifies suspicious files being written by the Microsoft Exchange Server Unified Messaging (UM) service. This activity has been observed exploiting CVE-2021-26858.', '["https://attack.mitre.org/tactics/TA0001/","https://attack.mitre.org/techniques/T1190/"]', 'safe("log.eventDataProcessName", "").matches("(UMWorkerProcess.exe|umservice.exe)") && safe("log.message", "").matches("(php|jsp|js|aspx|asmx|asax|cfm|shtml)") && safe("log.message", "").matches("(:\\\\inetpub\\\\wwwroot\\\\aspnet_client\\\\|:\\\\(.+)\\\\Microsoft\\\\Exchange Server(.+)\\\\FrontEnd\\\\HttpProxy\\\\owa\\\\auth\\\\)") && !safe("log.message", "").matches("(:\\\\(.+)\\\\Microsoft\\\\Exchange Server(.+)\\\\FrontEnd\\\\HttpProxy\\\\(owa|ecp)\\\\auth\\\\version\\\\)")', '2025-09-04 20:46:21.151594', true, false, 'origin', NULL, '[]');
INSERT INTO public.utm_correlation_rules VALUES (602, 'Unauthorized Index Access Attempt', 3, 2, 1, 'Defense Evasion, Persistence, Privilege Escalation, Initial Access', 'T1078 - Valid Accounts', 'Detects attempts to access Elasticsearch indices without proper authorization, which could indicate reconnaissance or data theft attempts.

Next Steps:
1. Investigate the source IP address and determine if it''s legitimate
2. Review the specific indices that were accessed or attempted to be accessed
3. Check if the user account has proper authorization for the requested resources
4. Examine recent user activity patterns for anomalies
5. Review Elasticsearch access logs for related suspicious activities
6. Consider implementing additional access controls if unauthorized access is confirmed
', '["https://www.elastic.co/guide/en/elasticsearch/reference/current/audit-event-types.html","https://attack.mitre.org/techniques/T1078/"]', 'safe("log.level", "") == "WARN" && safe("log.message", "") != "" && (safe("log.message", "").contains("access_denied") || safe("log.message", "").contains("unauthorized") || safe("log.message", "").contains("forbidden"))', '2025-09-03 15:32:29.38601', true, false, 'origin', '["adversary.ip","adversary.host"]', '[{"indexPattern":"v11-log-elasticsearch-*","with":[{"field":"origin.ip.keyword","operator":"filter_term","value":"{{.origin.ip}}"},{"field":"log.level.keyword","operator":"filter_term","value":"WARN"}],"or":null,"within":"now-1h","count":3}]');
INSERT INTO public.utm_correlation_rules VALUES (1264, 'PowerShell Empire Detection', 3, 3, 2, 'Execution', 'T1059.001 - Command and Scripting Interpreter: PowerShell', 'Detects potential PowerShell Empire framework usage based on characteristic command patterns, obfuscation techniques, and encoded payloads commonly used by this post-exploitation framework. PowerShell Empire is a post-exploitation framework that uses PowerShell and Python agents to maintain persistence and execute commands on compromised systems.

Next Steps:
1. Immediately isolate the affected host to prevent lateral movement
2. Analyze the complete PowerShell script block content for additional IOCs
3. Check for persistence mechanisms (scheduled tasks, registry entries, services)
4. Review network connections from the host for C2 communication
5. Examine process tree and parent processes that spawned PowerShell
6. Search for additional Empire artifacts across the environment
7. Reset credentials for any accounts used on the compromised system
8. Conduct memory analysis to identify injected code or payloads
9. Review recent user activity and file access patterns
10. Update endpoint detection rules based on specific Empire techniques observed
', '["https://attack.mitre.org/techniques/T1059/001/","https://www.powershellempire.com/","https://docs.microsoft.com/en-us/powershell/module/microsoft.powershell.core/about/about_logging"]', 'safe("log.eventCode", 0.0) == double(4104) &&
safe("log.winlogProviderName", "") == "Microsoft-Windows-PowerShell" &&
(safe("log.winlogEventDataScriptBlockText", "").contains("System.Management.Automation.AmsiUtils") ||
  safe("log.winlogEventDataScriptBlockText", "").matches("(?i)(empire|invoke-empire|invoke-psempire)") ||
  safe("log.winlogEventDataScriptBlockText", "").matches("(?i)\\[System\\.Convert\\]::FromBase64String") ||
  safe("log.winlogEventDataScriptBlockText", "").matches("(?i)IEX\\s*\\(\\s*New-Object") ||
  safe("log.winlogEventDataScriptBlockText", "").matches("(?i)-enc\\s+[A-Za-z0-9+/=]{100,}") ||
  safe("log.winlogEventDataScriptBlockText", "").matches("(?i)\\$DoIt\\s*=\\s*@") ||
  safe("log.winlogEventDataScriptBlockText", "").matches("(?i)\\[System\\.Text\\.Encoding\\]::Unicode\\.GetString") ||
  safe("log.winlogEventDataScriptBlockText", "").contains("Invoke-Shellcode") ||
  safe("log.winlogEventDataScriptBlockText", "").contains("Invoke-ReflectivePEInjection") ||
  safe("log.winlogEventDataScriptBlockText", "").contains("Invoke-Mimikatz"))
', '2025-09-04 19:30:04.480041', true, false, 'origin', '["origin.host","origin.user"]', '[]');
INSERT INTO public.utm_correlation_rules VALUES (1265, 'Process Injection Techniques Detection', 3, 3, 2, 'Defense Evasion, Privilege Escalation', 'T1055 - Process Injection', 'Detects various process injection techniques including CreateRemoteThread, SetWindowsHookEx, and other methods used by malware to inject code into legitimate processes. This rule monitors for suspicious cross-process activities targeting critical Windows processes and detects PowerShell/command line usage of injection APIs.

Next Steps:
1. Investigate the source process and command line arguments for suspicious activity
2. Examine the target process for signs of compromise or abnormal behavior
3. Review process tree and parent-child relationships for the involved processes
4. Check for additional suspicious network connections or file system activities from the same host
5. Analyze memory dumps of target processes if available to confirm injection
6. Review system logs for privilege escalation attempts around the same timeframe
7. Correlate with threat intelligence to identify known malware families using similar techniques
8. Consider isolating the affected system if malicious activity is confirmed
', '["https://attack.mitre.org/techniques/T1055/","https://docs.microsoft.com/en-us/sysinternals/downloads/sysmon","https://www.elastic.co/blog/ten-process-injection-techniques-technical-survey-common-and-trending-process"]', '((safe("log.eventCode", 0.0) == double(4688) || safe("log.eventCode", 0.0) == double(4688)) &&
  (safe("log.winlogEventDataCommandLine", "").matches("(?i)VirtualAllocEx") ||
    safe("log.winlogEventDataCommandLine", "").matches("(?i)WriteProcessMemory") ||
    safe("log.winlogEventDataCommandLine", "").matches("(?i)CreateRemoteThread") ||
    safe("log.winlogEventDataCommandLine", "").matches("(?i)NtQueueApcThread") ||
    safe("log.winlogEventDataCommandLine", "").matches("(?i)SetWindowsHookEx") ||
    safe("log.winlogEventDataCommandLine", "").matches("(?i)RtlCreateUserThread"))) ||
((safe("log.eventCode", 0.0) == double(4104) || safe("log.eventCode", 0.0) == double(4104)) &&
  (safe("log.winlogEventDataScriptBlockText", "").matches("(?i)\\[Kernel32\\]::(VirtualAllocEx|WriteProcessMemory|CreateRemoteThread)") ||
    safe("log.winlogEventDataScriptBlockText", "").matches("(?i)\\[ntdll\\]::(NtQueueApcThread|RtlCreateUserThread)") ||
    safe("log.winlogEventDataScriptBlockText", "").contains("Invoke-ReflectivePEInjection") ||
    safe("log.winlogEventDataScriptBlockText", "").contains("Invoke-ProcessHollowing")))
', '2025-09-04 19:30:05.318097', true, false, 'origin', '["adversary.host","adversary.process"]', '[]');
INSERT INTO public.utm_correlation_rules VALUES (1353, 'Windows: Microsoft security essentials - Cannot use dynamic signature service', 2, 3, 3, 'Defense Evasion', 'Execution', 'Detects events in which Microsoft Security Essentials (MSE), Microsoft''s antivirus software, cannot use the dynamic signature service.  The Dynamic Signature Service is an important feature that allows you to update MSE and download new virus and malware definitions to stay up-to-date against the latest threats.  If the dynamic signature service cannot be used, it can result in poor protection against new threats and malware.', '["https://attack.mitre.org/tactics/TA0005/","https://attack.mitre.org/tactics/TA0002/"]', 'safe("log.eventCode", 0.0) == double(2012) && safe("log.winlogProviderName", "") == "Microsoft Antimalware"', '2025-09-04 20:25:24.431709', true, false, 'target', NULL, '[]');
INSERT INTO public.utm_correlation_rules VALUES (605, 'HAProxy Backend Server Manipulation Detection', 2, 3, 3, 'Impact', 'T1489 - Service Stop', 'Detects attempts to manipulate HAProxy backend servers including unauthorized server state changes, suspicious backend modifications, or attempts to disable healthy servers which could indicate service disruption attacks. This rule monitors for HAProxy logs indicating server termination states, HTTP 503 errors, and messages about servers going down or being disabled.

Next Steps:
1. Verify if the backend server changes were authorized
2. Check if there are maintenance windows scheduled for the affected servers
3. Review HAProxy configuration for any unauthorized modifications
4. Examine network connectivity to backend servers
5. Monitor for additional service disruption indicators
6. Check for any concurrent administrative access to HAProxy systems
7. Validate if the server state changes are legitimate operational activities
', '["https://www.haproxy.com/blog/introduction-to-haproxy-logging","https://attack.mitre.org/techniques/T1489/"]', 'safe("log.haproxy.backend_name", "") != "" && safe("log.haproxy.server_name", "") != "" && (safe("log.haproxy.termination_state", "") in ["SD", "sD"] || safe("log.haproxy.http.response.status_code", 0.0) == double(503) || (safe("log.message", "").contains("Server") && (safe("log.message", "").contains("going DOWN") || safe("log.message", "").contains("is DOWN") || safe("log.message", "").contains("disabled")) || (safe("log.message", "").contains("backend") && (safe("log.message", "").contains("has no server available") || safe("log.message", "").contains("leaving forced maintenance")))', '2025-09-03 15:33:44.666866', true, false, 'origin', '["origin.host","log.haproxy.backend_name"]', '[]');
INSERT INTO public.utm_correlation_rules VALUES (606, 'HTTP Cache Manipulation and Poisoning', 2, 3, 2, 'Impact', 'T1499.002 - Endpoint Denial of Service: Service Exhaustion Flood', 'Detects HTTP cache manipulation attempts including cache poisoning, cache key injection, Vary header attacks, and attempts to bypass cache controls that could lead to serving malicious content to users.

Next Steps:
1. Review the specific cache manipulation technique detected in the request headers and parameters
2. Check if the origin IP has made similar malicious cache requests recently across different URLs
3. Examine the complete URL path and request parameters for cache key injection attempts
4. Verify HAProxy cache configuration and ensure proper cache key validation is enabled
5. Monitor for additional requests from the same IP attempting to poison other cached resources
6. Review web application logs for any successful cache poisoning attempts that may have served malicious content
7. Consider implementing stricter cache control headers, input validation, and cache key normalization
8. Check if cached content has been compromised and consider cache invalidation if necessary
9. Review network traffic patterns for coordinated cache manipulation attempts
10. Document the attack pattern for future detection improvements
', '["https://www.haproxy.com/documentation/haproxy-configuration-tutorials/performance/caching/","https://attack.mitre.org/techniques/T1499/002/"]', 'safe("log.http_method", "").matches("(?i)(GET|HEAD)") && ( safe("log.http_request_headers", "").matches("(?i)(x-forwarded-(host|proto|for).*[\\r\\n])") || safe("log.http_request_headers", "").matches("(?i)(cache-control.*(no-cache.*max-age|max-age.*no-cache))") || safe("log.http_request_headers", "").matches("(?i)(pragma.*no-cache.*cache-control)") || safe("log.http_request_headers", "").matches("(?i)(vary.*[\\r\\n\\x00-\\x1f])") || safe("origin.url", "").matches("[\\x00-\\x1f\\x7f-\\x9f]") || safe("log.cache_status", "").matches("(?i)(poisoned|corrupted|invalid)") || (safe("log.response_headers", "").matches("(?i)x-cache.*hit") && safe("log.response_headers", "").matches("(?i)(content-type.*text/html)") && safe("log.response_body_hash", "") != "" )', '2025-09-03 15:33:45.340531', true, false, 'origin', '["adversary.ip","adversary.url"]', '[]');
INSERT INTO public.utm_correlation_rules VALUES (607, 'Compression-Based Attack Detection', 3, 2, 3, 'Impact', 'T1499.004 - Endpoint Denial of Service: Application or System Exploitation', 'Detects compression-based attacks including CRIME, BREACH, and compression ratio attacks that attempt to extract sensitive information by analyzing compression ratios and response sizes.

Next Steps:
1. Verify the source IP address and check if it''s from a known malicious actor
2. Analyze the specific HTTP requests and headers to identify the attack pattern
3. Review compression settings and disable compression for sensitive endpoints if necessary
4. Check for abnormal response size variations that may indicate information leakage
5. Monitor for repeated requests with similar patterns from the same source
6. Consider implementing rate limiting for compression-enabled endpoints
7. Review SSL/TLS configuration to ensure proper protection against CRIME/BREACH attacks
', '["https://www.haproxy.com/documentation/haproxy-configuration-tutorials/performance/compression/","https://attack.mitre.org/techniques/T1499/"]', '(safe("log.http_request_headers", "").matches("(?i)accept-encoding.*(gzip|deflate|br)") || safe("log.compression_algo", "") != "") && ( safe("log.http_request_headers", "").matches("(?i)(cookie|authorization|bearer)") && safe("log.request_body_size", 0) > 1000 || safe("log.compression_ratio", 0.0) < 0.3 || safe("log.error_message", "").matches("(?i)(compression.*error|deflate.*fail|gzip.*corrupt)") || (safe("log.response_size_compressed", 0) > 0 && safe("log.response_size_uncompressed", 0) > 50 || safe("log.response_size_compressed", 1) > 50) || safe("log.http_request_headers", "").matches("(?i)range.*bytes.*[0-9]+-[0-9]+") || (safe("log.request_count_per_second", 0) > 100 && safe("log.unique_payload_variations", 0) > 50) )', '2025-09-03 15:33:45.640213', true, false, 'origin', NULL, '[]');
INSERT INTO public.utm_correlation_rules VALUES (608, 'HAProxy Configuration Injection Attempts', 2, 3, 3, 'Initial Access', 'T1190 - Exploit Public-Facing Application', 'Detects attempts to inject malicious configuration directives through HAProxy interfaces or logs. This could indicate an attempt to modify routing rules, ACLs, or backend server configurations through injection vulnerabilities.

Next Steps:
1. Immediately review HAProxy configuration files for unauthorized changes
2. Check HAProxy admin interface logs for suspicious configuration modifications
3. Verify integrity of backend server configurations and routing rules
4. Examine source IP for additional malicious activity patterns
5. Review application logs for related injection attempts
6. Consider temporarily isolating affected HAProxy instances
7. Update HAProxy to latest version if vulnerability is confirmed
', '["https://www.haproxy.com/blog/haproxy-log-customization","https://cve.mitre.org/cgi-bin/cvekey.cgi?keyword=HAProxy","https://attack.mitre.org/techniques/T1190/"]', 'safe("action", "") == "haproxy.log" && (safe("log.message", "").matches(".*\\b(backend|frontend|listen|bind|server|acl|use_backend|redirect|option|timeout)\\s+[^\\s]*[;<>&|`$(){}\\[\\]].*") || safe("log.url", "").matches(".*[;<>&|`$(){}\\[\\]].*config.*") || safe("log.request_body", "").matches(".*\\b(backend|frontend|listen|bind|server)\\s+.*"))', '2025-09-03 15:33:46.052087', true, false, 'origin', NULL, '[]');
INSERT INTO public.utm_correlation_rules VALUES (953, 'System Linux: Interactive Terminal Spawned via Perl', 2, 3, 2, 'Execution', 'Command and Scripting Interpreter', 'Identifies when a terminal (tty) is spawned via Perl. Attackers may upgrade a simple reverse shell to a fully interactive tty after obtaining initial access to a host.', '["https://attack.mitre.org/tactics/TA0002/","https://attack.mitre.org/techniques/T1059/"]', 'safe("log.message", "").matches("(perl)") && safe("log.message", "").matches("(exec \\''/bin/sh\\'';|exec \\''/bin/dash\\'';|exec \\''/bin/bash\\'';)")', '2025-09-03 16:37:34.193136', true, false, 'origin', NULL, '[]');
INSERT INTO public.utm_correlation_rules VALUES (954, 'System Linux: Potential Privilege Escalation via PKEXEC', 2, 3, 3, 'Privilege Escalation', 'Exploitation for Privilege Escalation', 'Identifies an attempt to exploit a local privilege escalation in polkit pkexec (CVE-2021-4034) via unsecure environment variable injection. Successful exploitation allows an unprivileged user to escalate to the root user.', '["https://attack.mitre.org/tactics/TA0004/","https://attack.mitre.org/techniques/T1068/"]', 'safe("log.message", "").matches("(pkexec)")', '2025-09-03 16:37:34.683849', true, false, 'origin', NULL, '[]');
INSERT INTO public.utm_correlation_rules VALUES (617, 'Memory Pool Attack Detected', 1, 2, 3, 'Impact', 'T1496 - Resource Hijacking', 'Detects attempts to exhaust HAProxy memory pools through large header attacks, buffer overflow attempts, or abnormal memory consumption patterns. This includes oversized headers, abnormal request sizes, connection issues indicating memory exhaustion, and pattern-based buffer overflow attempts.

Next Steps:
1. Review HAProxy memory usage and configuration limits
2. Examine the specific request that triggered the alert
3. Check for additional requests from the same source IP
4. Verify HAProxy pool configuration and adjust limits if necessary
5. Consider implementing rate limiting for the attacking source
6. Monitor system memory usage for signs of resource exhaustion
', '["https://www.haproxy.com/documentation/haproxy-configuration-manual/","https://attack.mitre.org/techniques/T1496/"]', '(safe("log.captured_request_headers", "") != "" && size(safe("log.captured_request_headers", "")) > 8192) || (safe("log.captured_response_headers", "") != "" && size(safe("log.captured_response_headers", "")) > 8192) || (safe("log.http_request_size", 0) > 65536) || (safe("log.termination_state", "") != "" && ( safe("log.termination_state", "").contains("cI") || safe("log.termination_state", "").contains("cH"))) || (safe("log.http_request", "") != "" && ( safe("log.http_request", "").contains("AAAAAAAAAA") || safe("log.http_request", "").contains("BBBBBBBBBB"))) || (safe("log.captured_request_cookie", "") != "" && size(safe("log.captured_request_cookie", "")) > 4096)', '2025-09-03 15:34:24.440886', true, false, 'origin', '["origin.ip"]', '[]');
INSERT INTO public.utm_correlation_rules VALUES (609, 'Connection Exhaustion Attack', 1, 1, 3, 'Impact', 'T1498 - Network Denial of Service', 'Detects connection exhaustion attacks including slowloris, connection flooding, and resource starvation attempts against HAProxy. This rule identifies patterns indicative of DoS attacks such as excessive active connections, high frontend connections with low backend connections, client timeouts, slow requests, and excessive queuing.

Next Steps:
1. Immediately verify HAProxy health and performance metrics
2. Check server capacity and current connection limits (maxconn settings)
3. Analyze the source IP(s) for attack patterns and consider blocking malicious sources
4. Review HAProxy logs for termination states and connection patterns
5. Monitor backend server health and response times
6. Consider implementing rate limiting or connection throttling
7. Verify DDoS protection mechanisms are active
8. Check for any legitimate traffic spikes that might explain the behavior
9. Document the incident and update security controls if necessary
', '["https://docs.haproxy.org/1.8/configuration.html#4-maxconn","https://attack.mitre.org/techniques/T1498/"]', '(safe("log.actconn", 0) > 10000) || (safe("log.feconn", 0) > 5000 && safe("log.beconn", 0) < 100) || (safe("log.termination_state", "") != "" && (safe("log.termination_state", "").contains("cR") || safe("log.termination_state", "").contains("cL"))) || (safe("log.time_request", 0) > 30000 && safe("log.http_request_size", 0) < 100) || (safe("log.srv_queue", 0) > 500 || safe("log.backend_queue", 0) > 500) || (safe("log.retries", 0) > 5)', '2025-09-03 15:33:46.476115', true, false, 'origin', NULL, '[{"indexPattern":"v11-log-haproxy-*","with":[{"field":"origin.ip.keyword","operator":"filter_term","value":"{{.origin.ip}}"}],"or":null,"within":"now-5m","count":100}]');
INSERT INTO public.utm_correlation_rules VALUES (610, 'HAProxy DNS Resolution Manipulation Detection', 2, 3, 2, 'Resource Development', 'T1584.002 - Compromise Infrastructure: DNS Server', 'Detects potential DNS resolution manipulation attempts in HAProxy, including DNS poisoning, resolution failures, or suspicious DNS response patterns that could redirect traffic to malicious servers.

Next Steps:
1. Review HAProxy configuration for DNS resolver settings and verify authorized DNS servers
2. Check for unauthorized changes to DNS server configurations in HAProxy backend definitions
3. Verify DNS response integrity and check for signs of DNS poisoning or cache manipulation
4. Monitor network traffic for suspicious DNS queries or responses from HAProxy instances
5. Review HAProxy logs for patterns of DNS manipulation attempts and resolution anomalies
6. Validate backend server connections are reaching intended destinations and not being redirected
7. Implement DNS monitoring to detect resolution changes for critical backend services
8. Consider implementing DNS over HTTPS or DNS over TLS for secure resolution
', '["https://www.haproxy.com/blog/dns-resolution-in-haproxy","https://attack.mitre.org/techniques/T1584/002/"]', 'safe("action", "") == "haproxy.log" && safe("log.message", "").contains("DNS") && (safe("log.message", "").contains("resolution failed") || safe("log.message", "").contains("DNS error") || safe("log.message", "").contains("invalid DNS response") || safe("log.message", "").contains("DNS timeout") || safe("log.message", "").contains("NXDOMAIN") || safe("log.message", "").contains("DNS cache") || safe("log.message", "").contains("changed unexpectedly"))', '2025-09-03 15:33:47.027029', true, false, 'origin', '["origin.host","log.message"]', '[]');
INSERT INTO public.utm_correlation_rules VALUES (611, 'HAProxy Health Check Tampering Detection', 1, 3, 3, 'Defense Evasion', 'T1070 - Indicator Removal', 'Detects suspicious patterns in HAProxy health check responses including failed health checks, manipulated check intervals, or attempts to bypass health monitoring which could indicate attempts to hide compromised services.

Next Steps:
1. Review HAProxy configuration for any unauthorized changes to health check settings
2. Examine server logs on the affected backend servers for signs of compromise
3. Check for unusual network traffic patterns to/from the affected servers
4. Verify the integrity of health check scripts and endpoints
5. Review recent changes to load balancer configuration and access logs
6. Monitor for subsequent failed health checks or service availability issues
', '["https://www.haproxy.com/documentation/haproxy-configuration-tutorials/reliability/health-checks/","https://attack.mitre.org/techniques/T1070/"]', '(safe("action", "") == "haproxy.log" && safe("log.message", "").contains("Health check") && (safe("log.message", "").contains("failed") || safe("log.message", "").contains("timeout") || safe("log.message", "").contains("refused") || safe("log.message", "").contains("L4CON") || safe("log.message", "").contains("L4TOUT")) || (safe("log.haproxy.check_status", "") != "" && (safe("log.haproxy.check_status", "").contains("SOCKERR") || safe("log.haproxy.check_status", "").contains("L4CON") || safe("log.haproxy.check_status", "").contains("L6RSP") || safe("log.haproxy.check_status", "").contains("L7RSP")) || (safe("log.haproxy.server_name", "") != "" && safe("log.haproxy.check_duration", 0) > 5000) || (safe("log.message", "").contains("check") && safe("log.message", "").contains("reason:") && (safe("log.message", "").contains("Layer4") || safe("log.message", "").contains("Layer7"))', '2025-09-03 15:33:47.678759', true, false, 'origin', '["origin.host","log.haproxy.server_name"]', '[]');
INSERT INTO public.utm_correlation_rules VALUES (612, 'HTTP/2 Vulnerability Exploitation Attempts', 2, 3, 3, 'Impact', 'T1499 - Endpoint Denial of Service', 'Detects potential HTTP/2 vulnerability exploitation attempts including HPACK compression attacks, stream multiplexing abuse, and protocol downgrade attacks that could lead to denial of service or information disclosure.

Next Steps:
1. Review HAProxy logs for detailed HTTP/2 error messages and connection patterns
2. Analyze the source IP for other malicious activities or reconnaissance attempts
3. Check if the requests are targeting specific vulnerabilities (CVE-2023-25725, CVE-2023-44487)
4. Monitor for rapid succession of HTTP/2 stream resets or compression table manipulation
5. Consider implementing rate limiting or temporary blocking of the source IP
6. Verify HAProxy version and apply security patches if needed
7. Review HTTP/2 configuration settings for potential hardening opportunities
', '["https://docs.haproxy.org/2.6/configuration.html#h2-workaround-bogus-websocket-clients","https://attack.mitre.org/techniques/T1499/"]', 'safe("log.http_protocol", "") == "HTTP/2.0" && ( safe("log.http_request_headers", "").matches("(?i)(h2c-settings|x-http2-settings|upgrade.*h2c)") || safe("log.http_status_code", 0.0) == double(431) || safe("log.error_message", "").matches("(?i)(h2.*error|stream.*reset|compression.*table|hpack)") || safe("log.connection_error", "").matches("(?i)(goaway|protocol.*error|stream.*error)") || (safe("log.stream_count", 0) > 100 && safe("log.connection_time", 0) < 5000) )', '2025-09-03 15:33:48.350293', true, false, 'origin', NULL, '[]');
INSERT INTO public.utm_correlation_rules VALUES (1354, 'Windows: Microsoft security essentials - Definitions update failed', 2, 3, 3, 'Execution', 'Scheduled Task/Job', 'Detects a problem with Microsoft Security Essentials definition update.  This alert indicates that the latest virus and malware definitions could not be successfully downloaded or applied.', '["https://attack.mitre.org/tactics/TA0002/","https://attack.mitre.org/techniques/T1053/"]', 'safe("log.eventCode", 0.0) == double(2001) && safe("log.winlogProviderName", "") == "Microsoft Antimalware"', '2025-09-04 20:25:24.850833', true, false, 'target', NULL, '[]');
INSERT INTO public.utm_correlation_rules VALUES (618, 'HAProxy Peer Synchronization Attack Detection', 2, 3, 2, 'Credential Access, Collection', 'T1557 - Man-in-the-Middle', 'Detects suspicious peer synchronization activities that may indicate an attempt to manipulate stick-table data or inject malicious entries across HAProxy instances. Monitors for abnormal peer connection patterns or data propagation anomalies.

Next Steps:
1. Review HAProxy configuration files for unauthorized peer definitions
2. Check network connectivity between legitimate HAProxy instances
3. Analyze stick-table contents for suspicious entries or data corruption
4. Verify peer authentication credentials and certificates
5. Monitor peer connection patterns for unusual timing or frequency
6. Review firewall rules to ensure only authorized peers can connect
7. Check for any unauthorized HAProxy instances in the network
', '["https://www.haproxy.com/documentation/haproxy-configuration-manual/2-4r1/","https://attack.mitre.org/techniques/T1557/"]', '(safe("log.message", "").contains("peer") || safe("log.message", "").contains("stick-table")) && (safe("log.message", "").contains("sync error") || safe("log.message", "").contains("peer connection failed") || safe("log.message", "").contains("invalid peer") || safe("log.message", "").contains("unexpected data") || safe("log.message", "").contains("sync timeout") || safe("log.message", "").matches("peer .* rejected")', '2025-09-03 15:34:24.885876', true, false, 'origin', '["origin.host"]', '[]');
INSERT INTO public.utm_correlation_rules VALUES (619, 'HAProxy PROXY Protocol Attack Detection', 2, 3, 2, 'Defense Evasion', 'T1036 - Masquerading', 'Detects potential PROXY protocol manipulation attacks, including attempts to spoof source IPs, bypass ACLs, or exploit PROXY protocol parsing vulnerabilities. Such attacks could allow attackers to hide their true origin or bypass security controls.

Next Steps:
1. Investigate the source IP attempting the PROXY protocol manipulation
2. Review HAProxy access logs for additional suspicious patterns from the same source
3. Check if the source IP is internal or external to determine attack vector
4. Verify HAProxy configuration for proper PROXY protocol settings
5. Examine network traffic patterns for signs of IP spoofing or ACL bypass attempts
6. Review authentication logs for any successful logins from the suspicious source
7. Consider implementing additional PROXY protocol validation rules
8. Monitor for lateral movement if attack originated from internal network
', '["https://www.haproxy.com/blog/introduction-to-haproxy-logging","https://docs.haproxy.org/2.8/configuration.html","https://attack.mitre.org/techniques/T1036/"]', 'safe("log.message", "").contains("haproxy") && (safe("log.message", "").matches(".*PROXY\\s+(TCP4|TCP6|UNKNOWN).*[\\x00-\\x1F\\x7F-\\xFF].*" || safe("log.message", "").contains("bad PROXY protocol header") || safe("log.message", "").contains("missing PROXY protocol header") || safe("log.message", "").matches(".*PROXY.*\\b(127\\.0\\.0\\.1|::1|0\\.0\\.0\\.0)\\b.*" || safe("log.message", "").matches(".*PROXY\\s+.*\\s+[0-9]{1,3}\\.[0-9]{1,3}\\.[0-9]{1,3}\\.[0-9]{1,3}\\s+[0-9]{1,3}\\.[0-9]{1,3}\\.[0-9]{1,3}\\.[0-9]{1,3}\\s+([0-9]+)\\s+\\1.*")', '2025-09-03 15:34:25.308557', true, false, 'origin', NULL, '[]');
INSERT INTO public.utm_correlation_rules VALUES (620, 'HAProxy Rate Limiting Evasion Detection', 1, 2, 3, 'Impact', 'T1498 - Network Denial of Service', 'Detects attempts to evade HAProxy rate limiting controls through distributed attacks, session rotation, header manipulation, or other techniques designed to bypass request rate restrictions. This rule identifies patterns indicating attempts to circumvent rate limiting mechanisms including rapid connection attempts with short queue times, header manipulation with IP spoofing headers, and session state changes with multiple retries.

Next Steps:
1. Analyze the source IP and user-agent patterns for distributed attack indicators
2. Review HAProxy configuration for rate limiting effectiveness
3. Check for IP rotation patterns or header manipulation in captured headers
4. Examine backend response times and connection patterns for anomalies
5. Consider implementing additional rate limiting controls or IP blocking
6. Monitor for escalation to application-layer attacks following rate limit bypass
', '["https://www.haproxy.com/documentation/haproxy-configuration-tutorials/core-concepts/stick-tables/","https://attack.mitre.org/techniques/T1498/"]', '(safe("log.action", "") == "haproxy.log" && ((safe("log.message", "").contains("rate") && (safe("log.message", "").contains("limit exceeded") || safe("log.message", "").contains("too many requests") || safe("log.message", "").contains("throttled")) || (safe("log.haproxy.http.response.status_code", 0.0) == double(429) && safe("log.haproxy.time_queue", 0) < 100) || (safe("log.haproxy.http.response.status_code", 0.0) == double(503) && safe("log.haproxy.queue.current", 0) > 100) || (safe("log.haproxy.connections.frontend", 0) > 1000 && safe("log.haproxy.time_backend_connect", 0) < 10 && safe("log.haproxy.http.request.body_size", 0) < 100))) || (safe("log.haproxy.source", "") != "" && safe("log.haproxy.http.request.captured_headers", "") != "" && (safe("log.haproxy.http.request.captured_headers", "").contains("X-Real-IP") || safe("log.haproxy.http.request.captured_headers", "").contains("X-Originating-IP") || safe("log.haproxy.http.request.captured_headers", "").contains("X-Forwarded-For")) || (safe("log.haproxy.termination_state", "").contains("SC") && safe("log.haproxy.http.request.time_wait", 0) < 1000 && safe("log.haproxy.connections.retries", 0) > 2)', '2025-09-03 15:34:25.829645', true, false, 'origin', NULL, '[]');
INSERT INTO public.utm_correlation_rules VALUES (1355, 'Windows: Microsoft security essentials - Engine update failed', 2, 3, 3, 'Execution', 'Scheduled Task/Job', 'Detects an issue with the Microsoft Security Essentials detection engine update.  This alert indicates that the latest version of the malware detection engine could not be successfully downloaded or applied.', '["https://attack.mitre.org/tactics/TA0002/","https://attack.mitre.org/techniques/T1053/"]', 'safe("log.eventCode", 0.0) == double(2003) && safe("log.winlogProviderName", "") == "Microsoft Antimalware"', '2025-09-04 20:25:25.251835', true, false, 'target', NULL, '[]');
INSERT INTO public.utm_correlation_rules VALUES (1356, 'Windows: Microsoft security essentials - Loading definitions failed. Using last good set', 2, 3, 2, 'Execution', 'Scheduled Task/Job', 'Detects a failure in the process of loading Microsoft Security Essentials definitions.  Consequently, the system is using the latest valid definition available to maintain some level of protection, but it might be out of date compared to the most recent version.', '["https://attack.mitre.org/tactics/TA0002/","https://attack.mitre.org/techniques/T1053/"]', 'safe("log.eventCode", 0.0) == double(2004) && safe("log.winlogProviderName", "") == "Microsoft Antimalware"', '2025-09-04 20:25:25.46271', true, false, 'target', NULL, '[]');
INSERT INTO public.utm_correlation_rules VALUES (621, 'HAProxy Runtime API Abuse Detection', 2, 3, 3, 'Execution', 'T1059 - Command and Scripting Interpreter', 'Detects potential abuse of HAProxy Runtime API through suspicious command execution patterns or unauthorized access attempts. The Runtime API allows critical operations like server state changes and configuration modifications.

Next Steps:
1. Verify if the Runtime API access was authorized and from expected sources
2. Review the specific commands executed via the API
3. Check if configuration changes align with planned maintenance activities
4. Investigate the source IP and user context of the API requests
5. Examine HAProxy logs for any configuration changes or service disruptions
6. Validate current server states match expected configurations
7. Review access controls and authentication mechanisms for the Runtime API
8. Check for any correlation with other suspicious network activities
', '["https://www.haproxy.com/blog/dynamic-configuration-haproxy-runtime-api","https://attack.mitre.org/techniques/T1059/"]', 'safe("log.action", "") == "haproxy.log" && (safe("log.message", "").contains("Runtime API") || safe("log.message", "").contains("stats socket") || safe("log.message", "").contains("admin socket")) && (safe("log.message", "").contains("disable server") || safe("log.message", "").contains("enable server") || safe("log.message", "").contains("set server") || safe("log.message", "").contains("clear counters") || safe("log.message", "").contains("shutdown") || safe("log.message", "").contains("set weight")', '2025-09-03 15:34:26.290216', true, false, 'origin', '["origin.host","origin.ip"]', '[]');
INSERT INTO public.utm_correlation_rules VALUES (622, 'HAProxy Server State File Tampering Detection', 2, 3, 3, 'Impact', 'T1565.001 - Data Manipulation: Stored Data Manipulation', 'Detects potential tampering with HAProxy server state files which could be used to manipulate server weights, drain modes, or maintenance states. This could lead to traffic redirection or service disruption.

Next Steps:
1. Verify the integrity of HAProxy server state files
2. Check for unauthorized modifications to HAProxy configuration
3. Review file system permissions on state files
4. Investigate any recent administrative changes
5. Monitor for unusual network traffic patterns
6. Check for signs of privilege escalation or lateral movement
', '["https://www.haproxy.com/documentation/haproxy-runtime-api/reference/show-servers-state/","https://attack.mitre.org/techniques/T1565/001/"]', 'safe("log.action", "") == "haproxy.log" && (safe("log.message", "").contains("state file") || safe("log.message", "").contains("server-state-file") || safe("log.message", "").contains("load server state")) && (safe("log.message", "").contains("corrupt") || safe("log.message", "").contains("invalid format") || safe("log.message", "").contains("checksum mismatch") || safe("log.message", "").contains("unexpected value") || safe("log.message", "").contains("state file error") || safe("log.message", "").contains("failed to load")', '2025-09-03 15:34:26.7965', true, false, 'origin', '["origin.host"]', '[]');
INSERT INTO public.utm_correlation_rules VALUES (623, 'SSL/TLS Vulnerabilities Detected', 3, 3, 2, 'Defense Evasion', 'T1600 - Weaken Encryption', 'Detects attempts to exploit SSL/TLS vulnerabilities including weak ciphers, protocol downgrade attacks, and certificate issues in HAProxy. This includes detection of deprecated SSL/TLS protocols (SSLv2, SSLv3, TLS 1.0/1.1), weak cipher suites (NULL, EXPORT, RC4, DES), certificate verification failures, SSL termination issues, and SSL-related HTTP errors.

Next Steps:
1. Review the SSL/TLS configuration for weak protocols and ciphers
2. Check certificate validity and chain of trust
3. Verify SSL termination settings in HAProxy configuration
4. Monitor for potential man-in-the-middle attacks
5. Update SSL/TLS configuration to use secure protocols (TLS 1.2+) and strong cipher suites
6. Check client compatibility requirements vs security posture
', '["https://www.haproxy.com/blog/haproxy-ssl-termination","https://attack.mitre.org/techniques/T1600/"]', '(safe("log.ssl_fc_protocol", "") != "" && safe("log.ssl_fc_protocol", "") in ["SSLv2", "SSLv3", "TLSv1", "TLSv1.0", "TLSv1.1"]) || (safe("log.ssl_fc_cipher", "") != "" && (contains(lower(safe("log.ssl_fc_cipher", "")), "export") || contains(lower(safe("log.ssl_fc_cipher", "")), "null") || contains(lower(safe("log.ssl_fc_cipher", "")), "anon") || contains(lower(safe("log.ssl_fc_cipher", "")), "des") || contains(lower(safe("log.ssl_fc_cipher", "")), "rc4"))) || (safe("log.ssl_c_verify", "") != "" && safe("log.ssl_c_verify", "") != "0") || (safe("log.termination_state", "") != "" && contains(safe("log.termination_state", ""), "S")) || (safe("log.http_status", 0) >= 495 && safe("log.http_status", 0) <= 499)', '2025-09-03 15:34:58.415001', true, false, 'origin', '["origin.ip","origin.host"]', '[]');
INSERT INTO public.utm_correlation_rules VALUES (624, 'HAProxy Stats Page Suspicious Access', 3, 1, 1, 'Discovery', 'T1082 - System Information Discovery', 'Detects suspicious or repeated access attempts to the HAProxy stats page, which could indicate reconnaissance activity. Attackers often target stats pages to gather information about backend servers, traffic patterns, and system configuration.

Next Steps:
1. Review the source IP and user agent for suspicious characteristics
2. Check if the access is from an authorized administrator or monitoring system
3. Verify if proper authentication was required and enforced
4. Examine the timing and frequency of access attempts
5. Correlate with other suspicious network activity from the same source
6. Review HAProxy configuration to ensure stats page is properly secured
', '["https://www.haproxy.com/blog/exploring-the-haproxy-stats-page","https://attack.mitre.org/techniques/T1082/"]', 'safe("origin.url", "").contains("/stats") && (safe("log.http.response.status_code", 0.0) == double(200) || safe("log.http.response.status_code", 0.0) == double(401) || safe("log.http.response.status_code", 0.0) == double(403))', '2025-09-03 15:34:59.007127', true, false, 'origin', '["origin.ip"]', '[{"indexPattern":"v11-log-haproxy-*","with":[{"field":"origin.ip.keyword","operator":"filter_term","value":"{{.origin.ip}}"},{"field":"origin.url.keyword","operator":"filter_match","value":"*stats*"}],"or":null,"within":"now-5m","count":10}]');
INSERT INTO public.utm_correlation_rules VALUES (625, 'HAProxy Stick Table Attack Detection', 2, 3, 3, 'Impact', 'T1496 - Resource Hijacking', 'Detects attacks targeting HAProxy stick tables including table overflow attempts, session hijacking through stick table manipulation, or attempts to exhaust stick table resources for denial of service.

Next Steps:
1. Review HAProxy logs for stick table configuration and current usage
2. Check for abnormal connection patterns from the source IP/host
3. Verify stick table size limits and thresholds are properly configured
4. Monitor for concurrent attacks from the same source
5. Consider implementing rate limiting on stick table operations
6. Review session persistence requirements and stick table necessity
', '["https://www.haproxy.com/blog/introduction-to-haproxy-stick-tables","https://attack.mitre.org/techniques/T1496/"]', '(safe("action", "") == "haproxy.log" && ((safe("log.message", "").contains("stick-table") && (safe("log.message", "").contains("overflow") || safe("log.message", "").contains("full") || safe("log.message", "").contains("limit reached") || safe("log.message", "").contains("exceeded")) || (safe("log.haproxy.http.request.captured_headers", "") != "" && size(safe("log.haproxy.http.request.captured_headers", "")) > 1000) || (safe("log.haproxy.termination_state", "").contains("PT") && safe("log.haproxy.time_backend_connect", 0) < 1) || (safe("log.message", "").contains("table") && safe("log.message", "").contains("entry") && (safe("log.message", "").contains("rate limit") || safe("log.message", "").contains("conn_rate") || safe("log.message", "").contains("http_req_rate")))) || (safe("log.haproxy.connections.active", 0) > 10000 && safe("log.haproxy.connections.frontend", 0) > 5000)', '2025-09-03 15:34:59.528537', true, false, 'origin', NULL, '[]');
INSERT INTO public.utm_correlation_rules VALUES (634, 'IIS Double Encoding Directory Traversal Attack', 3, 3, 1, 'Discovery', 'T1083 - File and Directory Discovery', 'Detects double encoding attempts to bypass directory traversal filters, including encoded dot-dot-slash sequences that could allow unauthorized file access. Attackers use double URL encoding to bypass security filters and access files outside the intended directory structure.

Next Steps:
1. Review the requested path and identify the specific encoding patterns used
2. Check server logs for successful or failed file access attempts
3. Investigate the source IP for other suspicious activities
4. Verify web application security filters are properly configured
5. Review IIS access logs for any unauthorized file access
6. Consider blocking the source IP if attack patterns continue
7. Examine HTTP response codes to determine if the attack was successful
8. Check for patterns of similar requests from the same source
', '["https://www.acunetix.com/vulnerabilities/web/iis-extended-unicode-directory-traversal-vulnerability/","https://attack.mitre.org/techniques/T1083/"]', 'safe("target.path", "").contains("%252e%252e") || safe("target.path", "").contains("%25%32%65") || safe("target.path", "").contains("%25%32%65%25%32%65") || safe("target.path", "").contains("%252f") || safe("target.path", "").contains("%255c") || safe("target.path", "").contains("%25%35%63") || safe("target.path", "").contains("%25%32%66") || safe("target.path", "").contains("%%32%65") || safe("target.path", "").contains("%%35%63") || safe("target.path", "").contains("..%252f") || safe("target.path", "").contains("..%255c")', '2025-09-03 15:36:32.458884', true, false, 'origin', NULL, '[]');
INSERT INTO public.utm_correlation_rules VALUES (626, 'WebSocket Connection Hijacking Attempts', 3, 3, 2, 'Credential Access, Collection', 'T1557 - Adversary-in-the-Middle', 'Detects suspicious WebSocket upgrade requests and potential hijacking attempts including protocol downgrade attacks, malformed upgrade headers, and unauthorized WebSocket connections. This rule identifies attempts to manipulate WebSocket handshake processes, intercept WebSocket traffic, or perform man-in-the-middle attacks against WebSocket connections.

Next Steps:
1. Investigate the source IP for other suspicious network activities
2. Review HAProxy logs for anomalous WebSocket upgrade patterns from the same source
3. Check if the WebSocket connection attempts are targeting legitimate services
4. Examine the WebSocket handshake headers for manipulation indicators
5. Verify if proper TLS/SSL is being used for WebSocket connections
6. Monitor for subsequent data exfiltration or command injection attempts
7. Consider implementing additional WebSocket security controls in HAProxy configuration
', '["https://www.haproxy.com/blog/websockets-load-balancing-with-haproxy","https://attack.mitre.org/techniques/T1557/"]', '(safe("log.http_request_headers", "").contains("upgrade") && safe("log.http_request_headers", "").contains("websocket")) || 
safe("log.http_upgrade_header", "").contains("websocket") && (
  !safe("log.http_request_headers", "").contains("sec-websocket-version: 13") ||
  !safe("log.http_request_headers", "").contains("sec-websocket-key") ||
  safe("log.status_code", 0.0) == double(426) ||
  safe("log.error_message", "").matches("(?i)(websocket.*error|upgrade.*fail|tunnel.*mode)") ||
  (safe("log.status_code", 0.0) == double(101) && !safe("log.response_headers", "").contains("sec-websocket-accept")) ||
  safe("log.connection_state", "").matches("(?i)(hijack|intercept|mitm)")
)
', '2025-09-03 15:35:00.020599', true, false, 'origin', NULL, '[]');
INSERT INTO public.utm_correlation_rules VALUES (627, 'IIS Application Pool Attack Detection', 1, 2, 3, 'Impact', 'T1489 - Service Stop', 'Detects suspicious patterns indicating attempts to manipulate or attack IIS application pools through worker process abuse.
This rule identifies requests to sensitive application directories combined with error status codes that may indicate application pool manipulation attempts.

Next Steps:
1. Investigate the source IP and user agent for the requests
2. Check IIS application pool health and worker process status
3. Review application logs for additional error details
4. Verify if the accessed paths contain sensitive application files
5. Check for recent changes to application pool configuration
6. Monitor for service restart patterns or denial of service indicators
7. Correlate with authentication logs to identify potential insider threats
8. Check system event logs for application pool recycle events
', '["https://docs.microsoft.com/en-us/iis/configuration/system.applicationhost/applicationpools/","https://attack.mitre.org/techniques/T1489/"]', 'safe("target.path", "") != "" && ( contains(lower(safe("target.path", "")), "/app_") || contains(lower(safe("target.path", "")), "/_app") || contains(lower(safe("target.path", "")), "/bin/") || contains(lower(safe("target.path", "")), "/app_data/") || contains(lower(safe("target.path", "")), "/app_code/") || contains(lower(safe("target.path", "")), "/app_browsers/") || contains(lower(safe("target.path", "")), "/app_globalresources/") || contains(lower(safe("target.path", "")), "/app_localresources/") || contains(lower(safe("target.path", "")), "/app_webreferences/") || contains(lower(safe("target.path", "")), "/app_themes/") || contains(lower(safe("target.path", "")), "/.vs/") || contains(lower(safe("target.path", "")), "/packages/") ) && ( safe("log.statusCode", 0.0) == double(500) || safe("log.statusCode", 0.0) == double(503) || safe("log.win32Status", 0.0) == double(64) || safe("log.win32Status", 0.0) == double(121) || safe("log.subStatusCode", 0.0) == double(19) || safe("log.subStatusCode", 0.0) == double(20) || safe("log.subStatusCode", 0.0) == double(21) || safe("log.subStatusCode", 0.0) == double(22) )', '2025-09-03 15:36:29.492812', true, false, 'origin', NULL, '[]');
INSERT INTO public.utm_correlation_rules VALUES (628, 'ASPX Injection Attempt Detection', 3, 3, 2, 'Execution', 'T1059 - Command and Scripting Interpreter', 'Detects potential ASPX code injection attempts through suspicious query strings and POST data patterns targeting ASP.NET applications.

Next Steps:
1. Review the specific request details and payload in the web server logs
2. Check if the request resulted in successful code execution or error responses
3. Examine application logs for any unusual system calls or file access
4. Verify the legitimacy of the source IP and user agent
5. Check for other suspicious activities from the same source IP
6. Review application security controls and input validation mechanisms
7. Consider blocking the source IP if confirmed malicious
8. Analyze the HTTP method and referrer to understand attack vector
9. Check for any related alerts from web application firewalls or intrusion detection systems
', '["https://www.acunetix.com/blog/articles/using-logs-to-investigate-a-web-application-attack/","https://attack.mitre.org/techniques/T1059/"]', 'safe("target.path", "") != "" && ( contains(lower(safe("target.path", "")), ".aspx") || contains(lower(safe("target.path", "")), ".asp") || contains(lower(safe("target.path", "")), ".asmx") ) && ( contains(lower(safe("target.path", "")), "system.") || contains(lower(safe("target.path", "")), "eval(") || contains(lower(safe("target.path", "")), "execute(") || contains(lower(safe("target.path", "")), "request.form") || contains(lower(safe("target.path", "")), "request.querystring") || contains(lower(safe("target.path", "")), "response.write") || contains(lower(safe("target.path", "")), "server.execute") || contains(lower(safe("target.path", "")), "server.transfer") || contains(lower(safe("target.path", "")), "process.start") || contains(lower(safe("target.path", "")), "shell.application") || contains(lower(safe("target.path", "")), "wscript.shell") || contains(lower(safe("target.path", "")), "scripting.filesystemobject") || contains(lower(safe("target.path", "")), "%3cscript") || contains(lower(safe("target.path", "")), "<script") || contains(lower(safe("target.path", "")), "javascript:") || contains(lower(safe("target.path", "")), "vbscript:") || contains(lower(safe("log.userAgent", "")), "script") || contains(lower(safe("log.referrer", "")), "javascript:") || safe("log.method", "") == "POST" ) && safe("statusCode", 0) != 404', '2025-09-03 15:36:30.009149', true, false, 'origin', NULL, '[]');
INSERT INTO public.utm_correlation_rules VALUES (629, 'IIS Case Sensitivity Exploitation Attempt', 3, 2, 1, 'Initial Access', 'T1190 - Exploit Public-Facing Application', 'Detects attempts to exploit case sensitivity vulnerabilities in IIS by looking for unusual URL patterns with mixed case variations that could bypass security filters or access controls. Attackers may use case variations to evade detection and access restricted resources or execute malicious scripts.

Next Steps:
1. Review the accessed URL path and verify if it should be accessible
2. Check IIS configuration for case sensitivity settings
3. Examine the source IP for other suspicious activities
4. Verify file system permissions on the accessed resources
5. Review web application logs for evidence of successful exploitation
6. Check for any unauthorized file modifications or uploads
7. Consider implementing URL canonicalization and input validation
8. Analyze the user agent and referrer for additional attack indicators
', '["https://attack.mitre.org/techniques/T1190/","https://docs.microsoft.com/en-us/iis/configuration/system.webserver/security/"]', '(safe("target.path", "").matches("(?i).*[A-Z]+.*[a-z]+.*") || safe("target.path", "").matches("(?i).*[a-z]+.*[A-Z]+.*")) && (safe("target.path", "").matches("(?i).*(cmd|powershell|script|exec|system|shell|admin|config|web\\.config|global\\.asa).*") || safe("target.path", "").matches("(?i).*\\.(asp|aspx|ashx|asmx|axd|config|asa).*")) && (safe("statusCode", 0) >= 200 && safe("statusCode", 0) < 300) && !safe("target.path", "").matches("(?i).*\\.(css|js|jpg|jpeg|png|gif|ico|woff|woff2|ttf|eot)$")', '2025-09-03 15:36:30.476089', true, false, 'origin', '["origin.ip","target.path"]', '[]');
INSERT INTO public.utm_correlation_rules VALUES (636, 'IIS FTP Service Attack Detection', 3, 3, 3, 'Credential Access', 'T1110 - Brute Force', 'Detects various attacks against IIS FTP service including brute force attempts, command injection, and directory traversal.
This rule identifies suspicious FTP activities such as failed authentication attempts, path traversal attacks, 
malicious file uploads, and command injection attempts.

Next Steps:
1. Review the source IP address and geographic location of the attacker
2. Check for successful authentication attempts from the same IP
3. Examine the specific FTP commands and paths being accessed
4. Review FTP server logs for additional suspicious activity
5. Verify the integrity of files in the FTP directories
6. Consider blocking the source IP if confirmed malicious
7. Review FTP server configuration and access controls
', '["https://learn.microsoft.com/en-us/iis/configuration/system.applicationhost/sites/site/ftpserver/","https://attack.mitre.org/techniques/T1110/"]', 'safe("log.method", "") == "FTP" && ( (safe("log.userIdent", "") in ["USER", "PASS"] && safe("statusCode", 0.0) == double(530)) || (safe("log.userIdent", "") == "RETR" && safe("target.path", "").contains("../")) || (safe("log.userIdent", "") == "SITE" && (safe("log.userAgent", "").contains("exec") || safe("log.userAgent", "").contains("spawn") || safe("log.userAgent", "").contains("system"))) || (safe("log.userIdent", "") in ["STOR", "STOU", "APPE"] && (safe("target.path", "").endsWith(".asp") || safe("target.path", "").endsWith(".aspx") || safe("target.path", "").endsWith(".exe") || safe("target.path", "").endsWith(".dll") || safe("target.path", "").endsWith(".cmd") || safe("target.path", "").endsWith(".bat"))) || (safe("log.userIdent", "") == "PORT" && safe("target.port", 0) < 1024) || (safe("log.userIdent", "") == "PASV" && safe("log.responseTime", 0) > 10000) || (safe("target.path", "").contains("%00") || safe("target.path", "").contains("\\x00")) || (safe("log.userIdent", "") == "CWD" && size(safe("target.path", "")) > 260) || (safe("statusCode", 0.0) == double(550) && safe("log.win32Status", 0.0) == double(5)) )', '2025-09-03 15:36:33.795314', true, false, 'origin', NULL, '[{"indexPattern":"v11-log-iis-*","with":[{"field":"origin.ip.keyword","operator":"filter_term","value":"{{.origin.ip}}"}],"or":null,"within":"now-1m","count":10}]');
INSERT INTO public.utm_correlation_rules VALUES (630, 'IBM AS/400 User Profile Modification Detection', 3, 3, 2, 'Persistence, Privilege Escalation', 'T1098 - Account Manipulation', 'Detects user profile modifications in IBM AS/400 systems including creation, changes, deletion, and restoration of user profiles. This rule monitors for various user profile management activities that could indicate unauthorized account manipulation or privilege escalation attempts.

Next Steps:
1. Verify the legitimacy of the user profile modification with the responsible administrator
2. Check if the modification was authorized and documented in change management systems
3. Review the user performing the modification for appropriate privileges
4. Examine the modified user profile for suspicious privilege escalations or unauthorized changes
5. Monitor for subsequent suspicious activities from the modified user account
6. Review system logs for any related security events or anomalies
7. If unauthorized, immediately disable the affected account and investigate further
', '["https://www.ibm.com/docs/en/i/7.3.0?topic=ios-cp-user-profile-change-security-audit-journal-entry","https://attack.mitre.org/techniques/T1098/"]', 'safe("log.message", "") != "" && ( (safe("log.message", "").contains("CP") && safe("log.message", "").contains("user profile")) || safe("log.message", "").contains("CRTUSRPRF") || safe("log.message", "").contains("CHGUSRPRF") || safe("log.message", "").contains("DLTUSRPRF") || safe("log.message", "").contains("RSTUSRPRF") || safe("log.message", "").contains("profile created") || safe("log.message", "").contains("profile changed") || safe("log.message", "").contains("profile deleted") || safe("log.message", "").contains("profile restored") || safe("log.message", "").contains("user profile change") || safe("log.message", "").contains("password changed") || safe("log.message", "").contains("PWDCHG") || safe("log.message", "").contains("special authority assigned") || safe("log.message", "").contains("group profile") )', '2025-09-03 15:36:30.667719', true, false, 'origin', '["log.user","log.host"]', '[]');
INSERT INTO public.utm_correlation_rules VALUES (631, 'IIS Certificate Binding Issues', 2, 3, 2, 'Defense Evasion', 'T1553.004 - Subvert Trust Controls: Install Root Certificate', 'Detects certificate binding errors in IIS that could indicate SSL/TLS configuration issues, potential certificate tampering, or authentication bypass attempts. This rule identifies HTTP 403 errors with Win32 status code 5 (access denied) occurring on dynamic web application endpoints, which may signal certificate validation failures or SSL handshake issues.

Next Steps:
1. Investigate the specific certificate binding configuration for the affected IIS site
2. Verify the certificate validity, expiration, and trust chain
3. Check IIS SSL settings and cipher suite configurations
4. Review certificate store permissions and bindings
5. Examine client certificate requirements and authentication settings
6. Correlate with Windows Security event logs for additional certificate-related events
7. Validate that the certificate matches the requested hostname (SNI)
8. Check for any recent certificate or IIS configuration changes
', '["https://learn.microsoft.com/en-us/troubleshoot/developer/webapps/iis/www-authentication-authorization/troubleshooting-ssl-related-issues-server-certificate","https://attack.mitre.org/techniques/T1553/004/"]', 'safe("statusCode", 0.0) == double(403) && safe("log.win32Status", 0.0) == double(5) && ( safe("target.path", "").contains(".aspx") || safe("target.path", "").contains(".asmx") || safe("target.path", "").contains(".svc") ) && safe("target.ip", "") != ""', '2025-09-03 15:36:30.934925', true, false, 'origin', '["target.ip","target.path"]', '[]');
INSERT INTO public.utm_correlation_rules VALUES (632, 'IIS Compression Attack - Potential BREACH/Zip Bomb', 3, 1, 3, 'Impact', 'Resource Exhaustion', 'Detects potential compression-based attacks including BREACH attacks targeting HTTPS compression or zip bomb attempts that could cause resource exhaustion. These attacks exploit compression algorithms to either extract sensitive information (BREACH) or consume excessive server resources (zip bombs).

Next Steps:
1. Investigate the source IP address for suspicious patterns or known malicious activity
2. Review server resource utilization during the time of the alert for signs of resource exhaustion
3. Examine request patterns from the source IP for abnormal compression-related headers or payloads
4. Check if the affected server experienced performance degradation or service disruption
5. Analyze network traffic for unusual data patterns or compression ratios
6. Review IIS logs for correlation with other suspicious activities from the same source
7. Consider implementing rate limiting or blocking the source IP if confirmed malicious
8. Verify compression settings are properly configured to prevent abuse
', '["https://www.breachattack.com/","https://attack.mitre.org/techniques/T1499/"]', '(safe("log.userAgent", "").contains("gzip") || safe("log.userAgent", "").contains("deflate") && (safe("log.responseTime", 0) > 10000 || safe("log.win32Status", 0.0) == double(64) || safe("log.win32Status", 0.0) == double(121)) && (safe("statusCode", 0.0) == double(500) || safe("statusCode", 0.0) == double(503) || safe("statusCode", 0.0) == double(408))', '2025-09-03 15:36:31.566633', true, false, 'origin', '["origin.ip"]', '[]');
INSERT INTO public.utm_correlation_rules VALUES (633, 'IIS Configuration File Access Attempt', 3, 2, 1, 'Discovery', 'T1082 - System Information Discovery', 'Detects attempts to access sensitive IIS configuration files that could expose system information or credentials. Attackers often target these files to discover database connection strings, application settings, and other sensitive configuration data.

Next Steps:
1. Review the accessed file path and determine if access was legitimate
2. Check the source IP address and user agent for suspicious patterns
3. Examine authentication logs for the user account involved
4. Verify if the requested configuration files contain sensitive information
5. Review server access controls and file permissions
6. Monitor for any subsequent suspicious activities from the same source
7. Consider implementing additional access controls for configuration files
', '["https://docs.microsoft.com/en-us/iis/configuration/","https://attack.mitre.org/techniques/T1082/"]', 'safe("target.path", "") != "" && ( contains(lower(safe("target.path", "")), "web.config") || contains(lower(safe("target.path", "")), "applicationhost.config") || contains(lower(safe("target.path", "")), "machine.config") || contains(lower(safe("target.path", "")), ".config") || contains(lower(safe("target.path", "")), "global.asa") || contains(lower(safe("target.path", "")), "global.asax") || contains(lower(safe("target.path", "")), ".ini") || contains(lower(safe("target.path", "")), ".xml") || contains(lower(safe("target.path", "")), ".bak") || contains(lower(safe("target.path", "")), ".backup") || contains(lower(safe("target.path", "")), ".old") || contains(lower(safe("target.path", "")), ".orig") || contains(lower(safe("target.path", "")), ".save") || contains(lower(safe("target.path", "")), ".swp") || contains(lower(safe("target.path", "")), ".tmp") || contains(lower(safe("target.path", "")), "connectionstrings") || contains(lower(safe("target.path", "")), "appsettings") ) && safe("log.method", "") == "GET" && safe("statusCode", 0) != 404 && safe("statusCode", 0) != 403', '2025-09-03 15:36:32.022204', true, false, 'origin', '["origin.ip","target.path"]', '[{"indexPattern":"v11-log-iis-*","with":[{"field":"origin.ip.keyword","operator":"filter_term","value":"{{.origin.ip}}"}],"or":null,"within":"now-1h","count":5}]');
INSERT INTO public.utm_correlation_rules VALUES (635, 'IIS Failed Request Tracing Abuse - XST Attack Attempt', 3, 2, 1, 'Defense Evasion, Privilege Escalation', 'T1055 - Process Injection: Cross-Site Tracing (XST)', 'Detects potential Cross-Site Tracing (XST) attacks exploiting TRACE/TRACK HTTP methods in IIS. These methods can be used to steal cookies and authentication headers even when HttpOnly flags are set, or attempts to access trace.axd files which can expose sensitive request information.

Next Steps:
1. Review the source IP and user agent for suspicious patterns
2. Check if TRACE/TRACK methods are legitimately needed; if not, disable them
3. Verify trace.axd access controls and consider disabling Failed Request Tracing if not needed
4. Examine response codes and content to determine if the attack was successful
5. Review recent authentication logs for the affected server
6. Check for any unusual file access patterns or privilege escalation attempts
', '["https://owasp.org/www-community/attacks/Cross_Site_Tracing","https://attack.mitre.org/techniques/T1055/"]', 'safe("log.method", "") == "TRACE" || safe("log.method", "") == "TRACK" || (safe("target.path", "").contains("trace.axd") || safe("target.path", "").contains(".axd"))', '2025-09-03 15:36:32.908228', true, false, 'origin', NULL, '[]');
INSERT INTO public.utm_correlation_rules VALUES (678, 'Plugin Vulnerabilities', 3, 3, 2, 'Execution', 'T1203 - Exploitation for Client Execution', 'Detects potential exploitation of vulnerabilities in Kibana plugins including unauthorized plugin installation or modification attempts. This rule identifies suspicious plugin-related activities, error conditions, and unauthorized modifications to Kibana plugin infrastructure.

Next Steps:
1. Verify if the plugin installation/modification was authorized
2. Review user access logs for the timeframe of the activity
3. Check plugin source and integrity
4. Examine Kibana security logs for additional suspicious activities
5. Validate plugin functionality and check for any backdoors or malicious code
6. Review network traffic for any data exfiltration attempts
', '["https://www.elastic.co/guide/en/kibana/current/kibana-plugins.html","https://attack.mitre.org/techniques/T1203/"]', 'safe("log.component", "") != "" && (safe("log.component", "").contains("plugin") || safe("log.component", "") == "plugins") && (safe("log.actionMessage", "").contains("plugin_install") || safe("log.actionMessage", "").contains("plugin_update") || safe("log.actionMessage", "").contains("plugin_remove") || (safe("log.severityLabel", "") == "error" && safe("log.actionMessage", "") != "" && safe("log.actionMessage", "").contains("plugin")))', '2025-09-03 15:44:18.92849', true, false, 'origin', NULL, '[]');
INSERT INTO public.utm_correlation_rules VALUES (679, 'Excessive Report Generation Abuse', 2, 1, 3, 'Impact', 'T1499 - Endpoint Denial of Service', 'Detects potential abuse of Kibana reporting functionality through excessive report generation requests that could lead to resource exhaustion or data exfiltration. This rule identifies users generating an unusually high number of reports within a short time frame.

Next Steps:
1. Review the user''s recent activity and report generation patterns
2. Analyze the content and size of generated reports for potential data exfiltration
3. Check system resource utilization during the timeframe of excessive reporting
4. Verify if the user has legitimate business need for generating multiple reports
5. Consider implementing rate limiting on report generation functionality
6. Monitor for any additional suspicious activities from the same user account
', '["https://www.elastic.co/guide/en/kibana/current/xpack-security-audit-logging.html","https://attack.mitre.org/techniques/T1499/"]', 'safe("log.component", "") == "reporting" && ( safe("log.actionMessage", "").contains("report_create") || safe("log.actionMessage", "").contains("generate_report") || safe("log.actionMessage", "").contains("CSV export") || safe("log.actionMessage", "").contains("PDF generation") || safe("log.actionMessage", "").contains("export initiated") ) && safe("origin.user", "") != ""', '2025-09-03 15:44:19.523832', true, false, 'origin', '["origin.user"]', '[{"indexPattern":"v11-log-kibana-*","with":[{"field":"origin.user.keyword","operator":"filter_term","value":"{{.origin.user}}"},{"field":"log.component.keyword","operator":"filter_term","value":"reporting"}],"or":null,"within":"now-5m","count":10}]');
INSERT INTO public.utm_correlation_rules VALUES (708, 'MongoDB Audit Log Tampering Detection', 3, 3, 2, 'Defense Evasion', 'T1070: Indicator Removal on Host', 'Detects attempts to tamper with MongoDB audit logs, including unauthorized access to audit configuration, attempts to disable auditing, or suspicious gaps in audit log sequences. This could indicate an attacker trying to cover their tracks.

Next Steps:
1. Immediately review the MongoDB audit configuration to ensure it hasn''t been modified
2. Check for any gaps in audit log sequence numbers or timestamps
3. Verify the user account that performed the action has legitimate administrative privileges
4. Review all recent database operations from the same source for suspicious activity
5. Backup current audit logs to a secure location before further investigation
6. Check MongoDB server logs for any unauthorized configuration changes
7. Consider enabling additional monitoring on the affected MongoDB instance
', '["https://www.mongodb.com/docs/manual/core/auditing/","https://attack.mitre.org/techniques/T1070/"]', '(safe("log.component", "") == "CONTROL" && safe("log.message", "").matches(".*audit.*") && (safe("log.message", "").matches(".*disable.*") || safe("log.message", "").matches(".*stop.*") || safe("log.message", "").matches(".*remove.*"))) || (safe("log.component", "") == "ACCESS" && safe("log.message", "").matches(".*system\\.admin.*") && safe("log.message", "").matches(".*auditLog.*")) || (safe("log.severity", "") == "high" && safe("log.message", "").matches(".*audit.*failed.*")) || (safe("log.component", "") == "COMMAND" && safe("log.message", "").matches(".*setParameter.*") && safe("log.message", "").matches(".*auditAuthorizationSuccess.*false.*"))', '2025-09-03 15:49:19.206776', true, false, 'origin', '["origin.host","origin.user"]', '[]');
INSERT INTO public.utm_correlation_rules VALUES (637, 'IIS Handler Mapping Abuse Detection', 3, 3, 2, 'Persistence', 'T1505.004 - Server Software Component: IIS Components', 'Detects attempts to abuse IIS handler mappings for persistence or code execution through unusual file extensions. 
Attackers may register malicious handlers for specific file extensions to execute code on IIS servers.

Next Steps:
1. Examine the requested file path and extension for legitimacy
2. Check if the file extension is expected in the web application
3. Review recent IIS configuration changes for handler mapping modifications
4. Analyze response content and size for signs of code execution
5. Investigate the source IP for other suspicious activity
6. Review access logs for patterns of automated tool usage
', '["https://www.robwillis.info/2022/11/analyzing-detecting-iis-backdoors/","https://attack.mitre.org/techniques/T1505/004/"]', 'safe("target.path", "") != "" && (contains(target.path, ".svc") || contains(target.path, ".rem") || contains(target.path, ".soap") || contains(target.path, ".vbhtml") || contains(target.path, ".cshtml") || contains(target.path, ".vbhtm") || contains(target.path, ".asax") || contains(target.path, ".ascx") || contains(target.path, ".master") || contains(target.path, ".compiled") || contains(target.path, ".browser") || contains(target.path, ".webinfo") || contains(target.path, ".resx") || contains(target.path, ".resources") || contains(target.path, ".mdf") || contains(target.path, ".ldf") || contains(target.path, ".cdx")) && (safe("log.method", "") == "POST" || safe("log.method", "") == "PUT" || (safe("log.method", "") == "GET" && safe("log.statusCode", 0.0) == double(200))) && (safe("log.userAgent", "") == "" || contains(lower(safe("log.userAgent", "")), "mozilla/4.0") || contains(lower(safe("log.userAgent", "")), "mozilla/5.0") || len(safe("log.userAgent", "")) < 20)', '2025-09-03 15:36:34.24189', true, false, 'origin', '["adversary.ip","target.path"]', '[]');
INSERT INTO public.utm_correlation_rules VALUES (673, 'Field Formatter Exploits', 3, 3, 1, 'Execution', 'T1059 - Command and Scripting Interpreter', 'Detects potential exploitation attempts through Kibana field formatters which could lead to script injection or code execution. Attackers may attempt to inject malicious code through field formatters to execute arbitrary scripts or compromise the Kibana instance.

Next Steps:
- Review the specific field formatter configuration that triggered this alert
- Check the user account involved for unauthorized access or compromise
- Examine recent changes to Kibana field formatters and visualizations
- Verify if the script content contains malicious code patterns
- Monitor for additional suspicious activities from the same user or IP address
- Consider temporarily disabling affected field formatters until investigation is complete
', '["https://www.elastic.co/guide/en/kibana/current/field-formatters.html","https://attack.mitre.org/techniques/T1059/"]', 'safe("log.actionMessage", "") != "" && safe("log.component", "") == "field-formats" && (safe("log.actionMessage", "").contains("script") || safe("log.actionMessage", "").contains("javascript") || safe("log.actionMessage", "").contains("eval") || safe("log.actionMessage", "").contains("Function"))', '2025-09-03 15:44:16.04138', true, false, 'origin', '["origin.host","origin.user"]', '[]');
INSERT INTO public.utm_correlation_rules VALUES (638, 'IIS ISAPI Filter Exploitation Attempt', 3, 3, 3, 'Lateral Movement', 'T1210 - Exploitation of Remote Services', 'Detects attempts to exploit ISAPI filter vulnerabilities in IIS, including buffer overflow attempts and malicious extension access patterns. This rule identifies suspicious requests targeting DLL files, script directories, and other ISAPI-related endpoints that could indicate exploitation attempts.

Next Steps:
1. Analyze the target path and HTTP method to understand the attack vector
2. Review the response time and status code for signs of successful exploitation
3. Examine the user agent string for embedded script content or encoding
4. Check for additional requests from the same IP to identify attack patterns
5. Verify if the targeted ISAPI extensions are legitimate and properly secured
6. Review IIS logs for any successful authentication or privilege escalation
7. Implement additional monitoring for the affected server and check for signs of persistence
8. Review firewall logs to identify any outbound connections from the compromised system
', '["https://www.microsoft.com/en-us/security/blog/2022/07/26/malicious-iis-extensions-quietly-open-persistent-backdoors-into-servers/","https://attack.mitre.org/techniques/T1210/"]', 'safe("target.path", "") != "" && safe("statusCode", 0) >= 200 && ( (safe("target.path", "").contains(".dll") && safe("log.method", "") == "POST") || (safe("target.path", "").contains("/scripts/") && safe("target.path", "").contains(".ida")) || (safe("target.path", "").contains("/scripts/") && safe("target.path", "").contains(".idq")) || (safe("target.path", "").contains("/_vti_bin/") && safe("log.responseTime", 0) > 5000) || (safe("log.userAgent", "").contains("<%") || safe("log.userAgent", "").contains("%3C%25")) || (safe("target.path", "").matches(".*\\.(printer|idc|stm|shtm|shtml).*") && safe("log.method", "") == "POST") )', '2025-09-03 15:37:10.830364', true, false, 'origin', '["origin.ip","target.path"]', '[]');
INSERT INTO public.utm_correlation_rules VALUES (639, 'IIS WebDAV LOCK Method Exploitation Attempt', 2, 3, 3, 'Impact', 'T1499 - Endpoint Denial of Service', 'Detects LOCK method attempts that could indicate WebDAV exploitation attempts, including denial of service or unauthorized file locking. The LOCK method can be abused to lock critical files, prevent legitimate access, or perform reconnaissance on WebDAV-enabled servers.

Next Steps:
1. Review the source IP and investigate if it''s from a known legitimate source
2. Check the target path to identify what resource was being locked
3. Examine user agent strings for signs of automated tools or scanners
4. Review IIS logs for additional suspicious WebDAV activity from the same source
5. Verify WebDAV configuration and consider disabling if not required
6. Monitor for subsequent requests from the same source IP
7. Check for successful LOCK operations that may indicate compromise
8. Review authentication logs for failed attempts from the same source
', '["https://attack.mitre.org/techniques/T1499/","https://attack.mitre.org/techniques/T1498/","https://attack.mitre.org/techniques/T1565/","https://docs.microsoft.com/en-us/iis/configuration/system.webserver/webdav/"]', 'safe("log.method", "") == "LOCK" && (safe("statusCode", 0.0) == double(200) || safe("statusCode", 0.0) == double(201) || safe("statusCode", 0.0) == double(423) || safe("statusCode", 0.0) == double(401) || safe("statusCode", 0.0) == double(405)) && (safe("target.path", "").matches("(?i).*\\.(asp|aspx|config|txt|xml|doc|docx|xls|xlsx|pdf).*") || safe("target.path", "").matches("(?i).*/web\\.config.*") || safe("target.path", "").matches("(?i).*/global\\.asa.*") || safe("log.userAgent", "").matches("(?i).*(scanner|exploit|metasploit|nikto|nessus).*") || safe("log.userAgent", "") == "" || safe("log.userAgent", "") == "-")', '2025-09-03 15:37:11.452847', true, false, 'origin', '["origin.ip","target.path"]', '[]');
INSERT INTO public.utm_correlation_rules VALUES (640, 'IIS MIME Type Confusion Attack', 3, 3, 2, 'Defense Evasion', 'T1027 - Obfuscated Files or Information', 'Detects potential MIME type confusion attacks where attackers try to upload malicious scripts disguised as other file types to exploit MIME sniffing vulnerabilities.

Next Steps:
1. Review the uploaded file content and MIME type headers
2. Check if the file contains malicious scripts or payloads
3. Verify web server configuration for proper MIME type handling
4. Review access logs for related suspicious activity from the same IP
5. Implement proper file validation and MIME type restrictions
6. Consider blocking the source IP if malicious intent is confirmed
', '["https://blog.fox-it.com/2012/05/08/mime-sniffing-feature-or-vulnerability/","https://attack.mitre.org/techniques/T1027/"]', '(safe("target.path", "").contains(".jpg") || safe("target.path", "").contains(".jpeg") || safe("target.path", "").contains(".png") || safe("target.path", "").contains(".gif") || safe("target.path", "").contains(".zip") || safe("target.path", "").contains(".csv") && (safe("target.path", "").contains("<script") || safe("target.path", "").contains("%3Cscript") || safe("target.path", "").contains("javascript:") || safe("target.path", "").contains("vbscript:") || safe("log.referrer", "").contains("javascript:") || safe("log.userAgent", "").contains("<script")', '2025-09-03 15:37:11.887575', true, false, 'origin', '["origin.ip","target.path"]', '[]');
INSERT INTO public.utm_correlation_rules VALUES (641, 'IIS Excessive OPTIONS Method Information Disclosure', 2, 1, 1, 'Reconnaissance', 'T1595 - Active Scanning', 'Detects excessive OPTIONS method requests that could indicate reconnaissance attempts to discover allowed HTTP methods and server capabilities. The OPTIONS method reveals server configuration details and supported HTTP methods, which attackers can use for further exploitation planning.

Next Steps:
1. Review the source IP address and user agent for signs of automated scanning tools
2. Check if the requests are coming from internal or external networks
3. Analyze the frequency and pattern of OPTIONS requests from the same source
4. Verify if the OPTIONS method should be disabled for the affected web applications
5. Consider implementing rate limiting for OPTIONS requests
6. Review web server logs for other reconnaissance activities from the same source
', '["https://attack.mitre.org/techniques/T1595/","https://owasp.org/www-project-web-security-testing-guide/latest/4-Web_Application_Security_Testing/02-Configuration_and_Deployment_Management_Testing/06-Test_HTTP_Methods"]', 'safe("log.method", "") == "OPTIONS" && safe("statusCode", 0.0) == double(200) && (safe("target.path", "") == "/" || safe("target.path", "") == "*" || safe("target.path", "").endsWith("/")) && safe("target.ip", "") != "" || !target.ip.matches("^(10\\.|172\\.(1[6-9]|2[0-9]|3[01])\\.|192\\.168\\.)") || safe("log.userAgent", "").matches("(?i).*(scanner|nikto|nessus|qualys|nmap|burp|zap|acunetix|sqlmap|havij).*") || safe("log.userAgent", "") == "" || safe("log.userAgent", "") == "-")', '2025-09-03 15:37:12.314122', true, false, 'origin', '["target.ip","origin.ip"]', '[]');
INSERT INTO public.utm_correlation_rules VALUES (642, 'IIS Request Filtering Evasion Attempt', 3, 3, 2, 'Defense Evasion', 'T1027 - Obfuscated Files or Information', 'Detects attempts to evade IIS request filtering through various encoding, padding, and obfuscation techniques including URL padding, file extension manipulation, control character injection, and malformed URL encoding.

Next Steps:
1. Review the specific request path and method used in the attempt
2. Check if the request resulted in successful access (non-404 status codes)
3. Examine the source IP for other suspicious activities in the same timeframe
4. Validate IIS request filtering rules are properly configured
5. Review web application logs for any successful exploitation
6. Consider blocking the source IP if multiple evasion attempts are detected
', '["https://learn.microsoft.com/en-us/iis/configuration/system.webserver/security/requestfiltering/","https://attack.mitre.org/techniques/T1027/"]', 'safe("target.path", "") != "" && ( (safe("statusCode", 0.0) == double(404) && safe("log.subStatusCode", 0) >= 5 && safe("log.subStatusCode", 0) <= 19) || (size(safe("target.path", "")) > 2048) || (size(safe("log.userAgent", "")) > 1024) || (safe("target.path", "").matches(".*(%20){10,}.*")) || (safe("target.path", "").contains("+.htr") || safe("target.path", "").contains("+.hta")) || (safe("target.path", "").matches(".*\\.(exe|dll|cmd|bat|ps1|vbs).*") && safe("statusCode", 0) != 404) || (safe("target.path", "").contains("/.") && safe("target.path", "").matches(".*/\\.[^/]*$")) || (size(safe("log.method", "")) > 10) || (safe("target.path", "").matches(".*[\\x00-\\x1f\\x7f].*")) || (safe("target.path", "").contains("%") && safe("target.path", "").matches(".*%[^0-9a-fA-F].*")) )', '2025-09-03 15:37:12.784133', true, false, 'origin', '["origin.ip","log.statusCode"]', '[]');
INSERT INTO public.utm_correlation_rules VALUES (643, 'IIS 8.3 Short Filename Enumeration Attack', 3, 2, 1, 'Discovery', 'T1083 - Discovery: File and Directory Discovery', 'Detects attempts to enumerate 8.3 short filenames using the tilde (~) character, which can reveal sensitive file and directory names on IIS servers. This attack technique exploits the Windows 8.3 filename convention to discover files and directories that may not be publicly accessible through normal browsing.

Next Steps:
1. Review the source IP addresses attempting this enumeration
2. Check if any sensitive files or directories were successfully discovered
3. Verify IIS configuration to disable 8.3 filename generation if not needed
4. Implement request filtering to block requests containing tilde characters
5. Monitor for subsequent attacks from the same sources
6. Consider implementing rate limiting for suspicious request patterns
', '["https://attack.mitre.org/techniques/T1083/","https://soroush.secproject.com/blog/2014/07/iis-short-file-name-disclosure-vulnerability/"]', 'safe("target.path", "").contains("~") && (safe("target.path", "").matches(".*~[0-9].*") || safe("target.path", "").matches(".*~[0-9]\\*.*")) && (safe("statusCode", 0.0) == double(404) || safe("statusCode", 0.0) == double(400) || safe("statusCode", 0.0) == double(200)) && (safe("log.subStatusCode", 0.0) == double(0) || safe("log.subStatusCode", 0.0) == double(2)) && !safe("target.path", "").matches("(?i).*\\.(css|js|jpg|jpeg|png|gif|ico).*")', '2025-09-03 15:37:13.455094', true, false, 'origin', '["origin.ip","target.path"]', '[]');
INSERT INTO public.utm_correlation_rules VALUES (645, 'IIS Unicode Bypass Directory Traversal Attack', 3, 3, 2, 'Defense Evasion', 'T1027 - Obfuscated Files or Information', 'Detects Unicode encoding bypass attempts including overlong UTF-8 sequences and alternative Unicode representations used to evade security filters and access restricted files. This attack exploits Unicode normalization vulnerabilities in IIS to traverse directories and access sensitive system files.

**Next Steps:**
1. Examine the full HTTP request including headers and POST data
2. Check if the attack was successful by reviewing response codes and content lengths
3. Verify what files or directories were accessed during the attack
4. Review server logs for any executed commands or accessed sensitive files
5. Check for other suspicious activity from the same source IP
6. Implement proper input validation and Unicode normalization
7. Consider blocking the source IP if attack continues
', '["https://www.kb.cert.org/vuls/id/111677","https://attack.mitre.org/techniques/T1027/"]', 'safe("target.path", "").contains("%c0%af") || safe("target.path", "").contains("%c0%ae") || safe("target.path", "").contains("%c1%9c") || safe("target.path", "").contains("%c0%2f") || safe("target.path", "").contains("%c0%5c") || safe("target.path", "").contains("%c1%8s") || safe("target.path", "").contains("%c1%1c") || safe("target.path", "").contains("%c1%af") || safe("target.path", "").contains("%e0%80%af") || safe("target.path", "").contains("%f0%80%80%af") || safe("target.path", "").contains("%u2215") || safe("target.path", "").contains("%u2216") || safe("target.path", "").contains("%uff0e") || safe("target.path", "").contains("..%c0%af") || (safe("target.path", "").contains("winnt") && safe("target.path", "").contains("system32") || (safe("target.path", "").contains("cmd.exe") || safe("target.path", "").contains("command.com")', '2025-09-03 15:37:14.735512', true, false, 'origin', '["origin.ip"]', '[]');
INSERT INTO public.utm_correlation_rules VALUES (956, 'System Linux: Interactive Terminal Spawned via Python', 3, 2, 3, 'Execution', 'Command and Scripting Interpreter', 'Identifies when a terminal (tty) is spawned via Python. Attackers may upgrade a simple reverse shell to a fully interactive tty after obtaining initial access to a host.', '["https://attack.mitre.org/tactics/TA0002/","https://attack.mitre.org/techniques/T1059/"]', 'safe("log.message", "").contains("python") && safe("log.message", "").matches("(import pty; pty.spawn\\(\\''\\/bin\\/(sh|dash|bash)\\''\\))")', '2025-09-03 16:37:35.656883', true, false, 'origin', NULL, '[]');
INSERT INTO public.utm_correlation_rules VALUES (1471, 'Windows Defender: ERROR: BAD DB: REMOVE FAILED', 1, 2, 3, 'Potentially Compromised System', 'User Execution', 'Detects the ''BAD DB: REMOVE FAILED'' error event in Windows Defender, which may indicate issues with the removal process from the database.', '["https://learn.microsoft.com/en-us/windows/security/threat-protection/windows-defender-antivirus/troubleshoot"]', 'safe("log.winlogEventDataLogName", "") == "Microsoft-Windows-Windows Defender/Operational" &&  safe("log.winlogEventDataErrorCode", "") == "0x8050801"', '2025-09-04 21:12:13.020381', true, false, 'target', NULL, '[]');
INSERT INTO public.utm_correlation_rules VALUES (646, 'IIS URL Rewrite Rule Bypass Attempt', 3, 3, 2, 'Defense Evasion', 'T1211 - Exploitation for Defense Evasion', 'Detects attempts to bypass URL rewrite rules in IIS through encoding tricks, double encoding, or path manipulation techniques. Attackers may use various encoding schemes and path traversal techniques to bypass URL rewrite rules and access restricted resources.

Next Steps:
1. Review the complete HTTP request including headers, user agent, and POST data
2. Check IIS access logs for the source IP to identify patterns of suspicious requests
3. Verify if the requested path corresponds to sensitive files or directories
4. Review URL rewrite rule configuration to identify potential weaknesses
5. Monitor for successful responses (HTTP 200) following bypass attempts
6. Consider implementing additional security controls like Web Application Firewall
7. Check for privilege escalation or lateral movement from the source system
', '["https://learn.microsoft.com/en-us/iis/configuration/system.webserver/rewrite/","https://attack.mitre.org/techniques/T1211/"]', 'safe("target.path", "") != "" &&
(
  (safe("target.path", "").contains("%252e") || safe("target.path", "").contains("%252f")) ||
  (safe("target.path", "").contains("..%5c") || safe("target.path", "").contains("..%2f")) ||
  (safe("target.path", "").contains("/.%2e/") || safe("target.path", "").contains("/%2e./")) ||
  (safe("target.path", "").matches(".*\\\\x[0-9a-fA-F]{2}.*")) ||
  (safe("target.path", "").contains("%u002e") || safe("target.path", "").contains("%u002f")) ||
  (safe("target.path", "").contains("::$DATA") || safe("target.path", "").contains(":$DATA")) ||
  (safe("target.path", "").matches(".*/[^/]+\\.[^/]+/\\.\\..*")) ||
  (safe("target.path", "").contains("?") && safe("target.path", "").matches(".*[?&][^=]+=[^&]*(%00|%0d|%0a).*")) ||
  (safe("log.referrer", "").contains("javascript:") || safe("log.referrer", "").contains("data:"))
)
', '2025-09-03 15:37:15.369047', true, false, 'origin', '["origin.ip","target.path"]', '[]');
INSERT INTO public.utm_correlation_rules VALUES (647, 'Virtual Directory Traversal Attack', 3, 3, 2, 'Discovery', 'T1083 - File and Directory Discovery', 'Detects attempts to traverse directories and access files outside the web root through various encoding techniques and traversal sequences. This attack attempts to access files and directories that are stored outside the web root folder by using relative file paths that contain ''../'' or similar sequences. Attackers may use various encoding techniques to bypass security filters.

Next Steps:
- Review the source IP and user agent for suspicious patterns
- Check if the requests resulted in successful responses (200, 301, 302 status codes)
- Examine the full request path and identify what files were being accessed
- Verify web application security controls and input validation
- Check for other suspicious activity from the same source IP
- Review IIS logs for any successful file access outside the web root
- Consider blocking the source IP if malicious intent is confirmed
', '["https://owasp.org/www-community/attacks/Path_Traversal","https://attack.mitre.org/techniques/T1083/"]', '( safe("target.path", "").matches(".*\\.\\.[\\\\/].*") || safe("target.path", "").matches(".*%2e%2e[\\\\/].*" )|| safe("target.path", "").matches(".*%252e%252e.*") || safe("target.path", "").matches(".*%c0%ae%c0%ae.*") || safe("target.path", "").matches(".*%e0%80%ae%e0%80%ae.*") || safe("target.path", "").matches(".*/Windows/System32/.*") || safe("target.path", "").matches(".*/boot\\.ini.*") || safe("target.path", "").matches(".*/win\\.ini.*") || safe("target.path", "").matches(".*/web\\.config.*") || safe("target.path", "").matches(".*/applicationHost\\.config.*") ) && safe("target.ip", "") != ""', '2025-09-03 15:37:15.795945', true, false, 'origin', '["origin.ip","target.ip"]', '[]');
INSERT INTO public.utm_correlation_rules VALUES (1496, 'Windows: Potential Modification of Accessibility Binaries', 2, 3, 1, 'Persistence', 'Accessibility Features', 'Windows contains accessibility features that may be launched with a key combination before a user has logged in. An adversary can modify the way these programs are launched to get a command prompt or backdoor without logging in to the system.', '["https://attack.mitre.org/tactics/TA0003/","https://attack.mitre.org/techniques/T1546/008/"]', '!safe("log.winlogEventDataProcessName", "").matches("(osk.exe|sethc.exe|utilman2.exe|DisplaySwitch.exe|ATBroker.exe|ScreenMagnifier.exe|SR.exe|Narrator.exe|magnify.exe|MAGNIFY.EXE)") &&
  safe("log.winlogEventDataParentProcessName", "").matches("(Utilman.exe|winlogon.exe)") &&
  safe("log.winlogEventDataSubjectUserName", "").contains("SYSTEM") &&
  safe("log.message", "").matches("(C:\\Windows\\System32\\osk.exe|C:\\Windows\\System32\\Magnify.exe|C:\\Windows\\System32\\Narrator.exe|C:\\Windows\\System32\\Sethc.exe|utilman.exe|ATBroker.exe|DisplaySwitch.exe|sethc.exe)")
', '2025-09-04 21:16:07.123894', true, false, 'origin', NULL, '[]');
INSERT INTO public.utm_correlation_rules VALUES (648, 'IIS WebDAV Vulnerability Exploitation', 3, 3, 3, 'Initial Access', 'T1190 - Exploit Public-Facing Application', 'Detects attempts to exploit WebDAV vulnerabilities in IIS, including PROPFIND/PROPPATCH buffer overflow and malformed request attacks. These attacks can lead to remote code execution, unauthorized file access, or denial of service.

Next Steps:
1. Immediately review the IIS server logs for the affected IP address and time frame
2. Check for any suspicious file uploads or modifications in WebDAV directories
3. Verify the integrity of web application files and configuration
4. Consider temporarily disabling WebDAV if not required for business operations
5. Apply latest IIS security patches and review WebDAV configurations
6. Monitor for any follow-up activities from the same source IP
7. Check for signs of web shell deployment or backdoor installation
8. Review access controls and authentication mechanisms for WebDAV directories
9. Scan the affected server for malware and compromise indicators
10. Document the incident and update security monitoring rules if needed
', '["https://isc.sans.edu/diary/24600","https://www.rapid7.com/db/modules/exploit/windows/iis/iis_webdav_scstoragepathfromurl/","https://attack.mitre.org/techniques/T1190/"]', '(
  (safe("log.method", "") == "PROPFIND" && safe("log.userAgent", "").contains("If: <http://")) ||
  (safe("log.method", "") == "PROPFIND" && safe("target.path", "").length() > 1000) ||
  (safe("log.method", "") == "PROPPATCH" && safe("log.statusCode", 0.0) == double(207)) ||
  (safe("log.method", "") == "SEARCH" && safe("target.path", "").length() > 500) ||
  (safe("log.method", "").matches("^(LOCK|UNLOCK|MKCOL|COPY|MOVE)$") && safe("target.ip", "") != "") ||
  (safe("log.method", "") == "PUT" && safe("target.path", "").matches(".*\\.(asp|aspx|asa|cer|cdx)$")) ||
  (safe("statusCode", 0.0) == double(207) && safe("log.responseTime", 0) > 3000)
)
', '2025-09-03 15:37:26.68841', true, false, 'origin', NULL, '[]');
INSERT INTO public.utm_correlation_rules VALUES (940, 'System Linux: Chkconfig Service Add', 1, 2, 3, 'Persistence', 'RC Scripts', 'Detects the use of the chkconfig binary to manually add a service for management by chkconfig.  Threat actors may utilize this technique to maintain persistence on a system.  When a new service is added, chkconfig ensures that the service has either a start  or a kill entry in every runlevel and when the system is rebooted the service file added will run providing long-term persistence.', '["https://attack.mitre.org/tactics/TA0003/","https://attack.mitre.org/techniques/T1037/004/"]', 'safe("log.message", "").matches("(chkconfig --add )")', '2025-09-03 16:36:55.227497', true, false, 'origin', NULL, '[]');
INSERT INTO public.utm_correlation_rules VALUES (941, 'System Linux: Potential Disabling of SELinux', 1, 2, 3, 'Defense Evasion', 'Disable or Modify Tools', 'Identifies potential attempts to disable Security-Enhanced Linux (SELinux), which is a Linux kernel security feature to support access control policies. Adversaries may disable security tools to avoid possible detection of their tools and activities.', '["https://attack.mitre.org/tactics/TA0005/","https://attack.mitre.org/techniques/T1562/001/"]', 'safe("log.message", "").matches("setenforce 0")', '2025-09-03 16:36:55.743106', true, false, 'origin', NULL, '[]');
INSERT INTO public.utm_correlation_rules VALUES (649, 'IIS Web Shell Upload Detection', 3, 3, 1, 'Persistence', 'T1505.003 - Server Software Component: Web Shell', 'Detects potential web shell uploads based on suspicious file extensions and POST requests to uncommon paths. This rule identifies POST requests to ASP.NET-related file extensions in suspicious directory paths commonly used for web shell placement.

Next Steps:
1. Immediately investigate the target server and file path for uploaded web shells
2. Check file system for recently uploaded .aspx, .asp, .asmx, .ashx, or .axd files
3. Review IIS logs for additional suspicious requests from the same source IP
4. Examine the uploaded file content for malicious code
5. Check for privilege escalation attempts following the upload
6. Review authentication logs for compromised accounts
7. Implement file upload restrictions and input validation
8. Block the source IP if confirmed malicious
9. Scan the entire web directory for additional web shells
10. Review recent file modifications on the web server
', '["https://www.microsoft.com/en-us/security/blog/2022/12/12/iis-modules-the-evolution-of-web-shells-and-how-to-detect-them/","https://attack.mitre.org/techniques/T1505/003/"]', 'safe("log.method", "") == "POST" && safe("target.path", "") != "" && ( safe("target.path", "").contains(".aspx") || safe("target.path", "").contains(".asp") || safe("target.path", "").contains(".asmx") || safe("target.path", "").contains(".ashx") || safe("target.path", "").contains(".axd") ) && ( safe("target.path", "")).lower().contains("upload") || safe("target.path", "")).lower().contains("temp") || safe("target.path", "")).lower().contains("tmp") || safe("target.path", "")).lower().contains("test") || safe("target.path", "")).lower().contains("shell") || safe("target.path", "")).lower().contains("cmd") || safe("target.path", "")).lower().contains("eval") || safe("target.path", "")).lower().contains("exec") || safe("target.path", "")).lower().contains("webshell") || safe("target.path", "")).lower().contains("backdoor") ) && safe("statusCode", 0) >= 200 && safe("statusCode", 0) < 300', '2025-09-03 15:37:27.271659', true, false, 'origin', '["origin.ip","target.path"]', '[]');
INSERT INTO public.utm_correlation_rules VALUES (1266, 'RDP Brute Force Attack', 3, 2, 2, 'Credential Access', 'T1110.001 - Brute Force: Password Guessing', 'Detects multiple failed RDP login attempts from the same source IP address, indicating a potential brute force attack. This rule monitors Windows Event ID 4625 (failed logon) with focus on network logon types (type 3) which are commonly used for RDP connections. The rule triggers when 10 or more failed attempts occur from the same IP within 15 minutes.

Next Steps:
1. Investigate the source IP address for malicious indicators and geolocation
2. Check if the targeted user accounts are legitimate and active
3. Review successful logons from the same IP after failed attempts
4. Implement IP blocking or rate limiting for the source address
5. Enable account lockout policies if not already configured
6. Consider implementing multi-factor authentication for RDP access
7. Review RDP access logs for any successful connections during the attack timeframe
', '["https://www.ultimatewindowssecurity.com/securitylog/encyclopedia/event.aspx?eventID=4625","https://attack.mitre.org/techniques/T1110/001/"]', 'safe("log.eventCode", 0.0) == double(4625) && safe("log.winlogEventDataLogonType", "") == "3" && safe("log.winlogEventDataIpAddress", "") != "" && safe("log.winlogEventDataIpAddress", "") != "-" && safe("log.winlogEventDataIpAddress", "") != "::1" && safe("log.winlogEventDataIpAddress", "") != "127.0.0.1"', '2025-09-04 19:30:05.896093', true, false, 'origin', '["adversary.ip","target.host"]', '[{"indexPattern":"v11-log-wineventlog-*","with":[{"field":"log.winlogEventDataIpAddress.keyword","operator":"filter_term","value":"{{.log.winlogEventDataIpAddress}}"},{"field":"log.eventCode","operator":"filter_term","value":4625},{"field":"log.winlogEventDataLogonType.keyword","operator":"filter_term","value":"3"}],"or":null,"within":"now-15m","count":10}]');
INSERT INTO public.utm_correlation_rules VALUES (1267, 'SAM Database Access Attempt', 3, 3, 1, 'Credential Access', 'T1003.002 - OS Credential Dumping: Security Account Manager', 'Detects attempts to access the Security Account Manager (SAM) database, which contains local user account hashes. This activity may indicate credential dumping attempts by attackers trying to extract password hashes for offline cracking or lateral movement.

Next Steps:
1. Immediately investigate the user account and process that accessed the SAM database
2. Check for any unusual processes running on the affected system
3. Review recent logon events and privilege escalation activities
4. Examine network connections from the affected host for lateral movement
5. Consider isolating the affected system if malicious activity is confirmed
6. Review security policies for SAM database access permissions
7. Check for presence of credential dumping tools or suspicious files
', '["https://attack.mitre.org/techniques/T1003/002/","https://learn.microsoft.com/en-us/previous-versions/windows/it-pro/windows-10/security/threat-protection/auditing/event-4661"]', 'safe("log.eventCode", 0.0) == double(4663) &&
safe("log.winlogChannel", "") == "Security" &&
(safe("log.winlogEventDataObjectName", "").matches(".*\\\\SAM$") ||
  safe("log.winlogEventDataObjectName", "").matches(".*\\\\SECURITY$") ||
  safe("log.winlogEventDataObjectName", "").matches(".*\\\\SYSTEM$")) &&
safe("log.winlogEventDataAccessMask", "") in ["0x20019", "0x1f01ff", "0x40", "0x20", "0x1"]
', '2025-09-04 19:30:06.669658', true, false, 'origin', '["origin.host","origin.user"]', '[]');
INSERT INTO public.utm_correlation_rules VALUES (1357, 'Windows: Microsoft security essentials - Real time protection failed', 3, 3, 2, 'Potentially Malicious Activity', 'Service Stop', 'Adversaries may stop or disable services on a system to render those services unavailable to legitimate users.  Stopping critical services or processes can inhibit or stop response to an incident  or aid in the adversarys overall objectives to cause damage to the environment', '["https://attack.mitre.org/techniques/T1489/"]', 'safe("log.eventCode", 0.0) == double(3002) && safe("log.winlogProviderName", "") == "Microsoft Antimalware"', '2025-09-04 20:25:25.851745', true, false, 'origin', NULL, '[]');
INSERT INTO public.utm_correlation_rules VALUES (662, 'Exactly-Once Semantics Violation Detected', 1, 3, 2, 'Impact', 'T1565.001 - Data Manipulation: Stored Data Manipulation', 'Detects violations of exactly-once semantics in Kafka that could lead to message loss or duplication. This includes transaction failures, producer fencing issues, and coordinator state inconsistencies.

Next Steps:
- Review Kafka broker logs for additional context on the transaction failure
- Check producer configuration for proper exactly-once semantics settings
- Verify transaction coordinator health and connectivity
- Investigate potential zombie producers or fencing issues
- Monitor for data consistency issues in downstream consumers
- Check for network partitions or broker failures during the incident
- Examine transaction log entries for any corruption or inconsistencies
- Validate producer idempotence configuration settings
', '["https://www.confluent.io/blog/simplified-robust-exactly-one-semantics-in-kafka-2-5/","https://cwiki.apache.org/confluence/display/KAFKA/KIP-98+-+Exactly+Once+Delivery+and+Transactional+Messaging","https://attack.mitre.org/techniques/T1565/001/"]', 'safe("log.severity", "") == "hight" && safe("log.message", "") != "" && (safe("log.message", "").contains("exactly-once") || safe("log.message", "").contains("exactly once") || safe("log.message", "").contains("transaction") || safe("log.message", "").contains("fencing") || safe("log.message", "").contains("zombie")) && (safe("log.message", "").contains("violation") || safe("log.message", "").contains("failed") || safe("log.message", "").contains("inconsistent") || safe("log.message", "").contains("abort"))', '2025-09-03 15:39:41.092341', true, false, 'origin', NULL, '[]');
INSERT INTO public.utm_correlation_rules VALUES (663, 'Idempotent Producer Security Issues', 1, 3, 2, 'Impact', 'T1489 - Service Stop', 'Detects issues with Kafka idempotent producers including UNKNOWN_PRODUCER_ID errors, authorization failures, and sequence number violations that could indicate message duplication attacks or producer impersonation. These issues can compromise data integrity and availability in Kafka clusters.

Next Steps:
1. Review Kafka producer logs for error patterns and frequency
2. Check producer configuration for proper idempotence settings
3. Verify broker authentication and authorization policies
4. Monitor for duplicate messages or data inconsistencies
5. Investigate network connectivity between producers and brokers
6. Review producer ID management and sequence number tracking
', '["https://cwiki.apache.org/confluence/display/KAFKA/Idempotent+Producer","https://cwiki.apache.org/confluence/pages/viewpage.action?pageId=89068820","https://attack.mitre.org/techniques/T1489/"]', 'safe("log.severity", "") == "hight" && safe("log.message", "") != "" && (safe("log.message", "").contains("UNKNOWN_PRODUCER_ID") || safe("log.message", "").contains("ClusterAuthorizationException") || safe("log.message", "").contains("IDEMPOTENT_WRITE") || safe("log.message", "").contains("producer id") || safe("log.message", "").contains("sequence number") || safe("log.message", "").contains("duplicate"))', '2025-09-03 15:39:41.517761', true, false, 'origin', NULL, '[]');
INSERT INTO public.utm_correlation_rules VALUES (1358, 'Windows: Microsoft security essentials - Scan error', 3, 3, 2, 'Execution', 'Scheduled Task/Job', 'Detect an error during the Microsoft Security Essentials scanning process. This indicates that the system was unable to complete the scheduled or on-demand scan due to some problem.', '["https://attack.mitre.org/tactics/TA0002/","https://attack.mitre.org/techniques/T1053/"]', 'safe("log.eventCode", 0.0) == double(1005) && safe("log.winlogProviderName", "") == "Microsoft Antimalware"', '2025-09-04 20:25:26.496707', true, false, 'target', NULL, '[]');
INSERT INTO public.utm_correlation_rules VALUES (1269, 'SMBv1 Usage Detection', 3, 2, 2, 'Lateral Movement', 'T1210 - Exploitation of Remote Services', 'Detects usage of the deprecated and vulnerable SMBv1 protocol which could be exploited for lateral movement or ransomware propagation. SMBv1 is susceptible to numerous security vulnerabilities including EternalBlue and should be disabled in favor of SMBv2/SMBv3.

Next Steps:
1. Immediately investigate the source system using SMBv1 and identify which service or application is still dependent on this protocol
2. Review network traffic logs to determine if this is internal communication or external access attempts
3. Check for any signs of exploitation attempts or successful compromises on the affected system
4. Identify all systems in the environment that may still have SMBv1 enabled
5. Plan migration to SMBv2/SMBv3 and disable SMBv1 on all systems where possible
6. Monitor for any lateral movement patterns that may indicate ongoing compromise
7. Consider implementing network segmentation to limit exposure if SMBv1 cannot be immediately disabled
', '["https://learn.microsoft.com/en-us/windows-server/storage/file-server/troubleshoot/detect-enable-and-disable-smbv1-v2-v3","https://attack.mitre.org/techniques/T1210/"]', 'safe("log.eventCode", 0.0) == double(3000) && safe("log.winlogProviderName", "") == "Microsoft-Windows-SMBServer" && safe("log.message", "").contains("SMB1")', '2025-09-04 19:30:07.528889', true, false, 'origin', '["origin.ip","origin.host"]', '[]');
INSERT INTO public.utm_correlation_rules VALUES (1270, 'Windows Token Manipulation', 3, 3, 2, 'Defense Evasion, Privilege Escalation', 'Access Token Manipulation', 'Detects potential token manipulation attacks used for privilege escalation. Monitors for suspicious combinations of privileged service calls (4673) and operations on privileged objects (4674) along with special privilege assignments (4672) that include sensitive privileges like SeDebugPrivilege, SeImpersonatePrivilege, or SeTcbPrivilege commonly abused for token manipulation.', '["https://medium.com/palantir/windows-privilege-abuse-auditing-detection-and-defense-3078a403d74e","https://attack.mitre.org/techniques/T1134/"]', 'safe("log.eventCode", 0.0) == double(4672) && safe("log.winlogEventDataPrivilegeList", "") != "" && (safe("log.winlogEventDataPrivilegeList", "").contains("SeDebugPrivilege") || safe("log.winlogEventDataPrivilegeList", "").contains("SeImpersonatePrivilege") || safe("log.winlogEventDataPrivilegeList", "").contains("SeTcbPrivilege") || safe("log.winlogEventDataPrivilegeList", "").contains("SeAssignPrimaryTokenPrivilege") || safe("log.winlogEventDataPrivilegeList", "").contains("SeLoadDriverPrivilege") || safe("log.winlogEventDataPrivilegeList", "").contains("SeRestorePrivilege"))', '2025-09-04 19:30:08.164651', true, false, 'origin', '["origin.host","log.winlogEventDataTargetUserName","log.winlogEventDataTargetLogonId"]', '[{"indexPattern":"v11-log-wineventlog-*","with":[{"field":"origin.host.keyword","operator":"filter_term","value":"{{.origin.host}}"},{"field":"log.winlogEventDataTargetLogonId.keyword","operator":"filter_term","value":"{{.log.winlogEventDataTargetLogonId}}"}],"or":[{"indexPattern":"v11-log-wineventlog-*","with":[{"field":"origin.host.keyword","operator":"filter_term","value":"{{.origin.host}}"},{"field":"log.winlogEventDataTargetLogonId.keyword","operator":"filter_term","value":"{{.log.winlogEventDataTargetLogonId}}"},{"field":"log.eventCode","operator":"filter_term","value":4673}],"or":null,"within":"now-10m","count":1},{"indexPattern":"v11-log-wineventlog-*","with":[{"field":"origin.host.keyword","operator":"filter_term","value":"{{.origin.host}}"},{"field":"log.winlogEventDataTargetLogonId.keyword","operator":"filter_term","value":"{{.log.winlogEventDataTargetLogonId}}"},{"field":"log.eventCode","operator":"filter_term","value":4674}],"or":null,"within":"now-10m","count":1}],"within":"now-10m","count":2}]');
INSERT INTO public.utm_correlation_rules VALUES (660, 'Consumer Group Manipulation Attempt', 2, 3, 3, 'Impact', 'T1565.001 - Data Manipulation: Stored Data Manipulation', 'Detects potential manipulation of Kafka consumer groups, including unauthorized group membership changes, offset resets, or group deletion attempts. This could indicate an attacker trying to disrupt message processing or steal data.

Next Steps:
1. Investigate the source of the consumer group manipulation attempt
2. Review Kafka access logs for the affected consumer group
3. Check if the manipulation was authorized and expected
4. Verify the integrity of consumer group configurations
5. Monitor for data loss or processing delays in affected topics
6. Review authentication and authorization settings for Kafka
7. Correlate with user activity logs to identify the responsible party
8. Check for any related security events or alerts
', '["https://kafka.apache.org/documentation/#basic_ops_consumer_group","https://attack.mitre.org/techniques/T1565/"]', 'safe("log.component", "") != "" && (contains(safe("log.component", ""), "GroupCoordinator") || contains(safe("log.component", ""), "GroupMetadataManager")) && safe("log.message", "") != "" && (contains(safe("log.message", ""), "Group does not exist") || contains(safe("log.message", ""), "attempt to illegally reset") || contains(safe("log.message", ""), "Unauthorized request") || contains(safe("log.message", ""), "Group authorization failed") || contains(safe("log.message", ""), "offset reset"))', '2025-09-03 15:39:39.732599', true, false, 'origin', '["origin.host","log.component"]', '[]');
INSERT INTO public.utm_correlation_rules VALUES (661, 'Kafka Control Center Access Violation Detected', 3, 3, 2, 'Persistence, Privilege Escalation', 'T1098 - Account Manipulation', 'Detects unauthorized access attempts to Kafka Control Center including failed logins, permission violations, or unusual access patterns that could indicate compromise or insider threats.

Next Steps:
1. Review the specific access violation details in the log message
2. Identify the source IP and user account involved in the access attempt
3. Check for patterns of repeated access violations from the same source
4. Verify if the access attempt was legitimate or part of an attack
5. Review Kafka Control Center access logs and authentication configurations
6. Consider implementing additional access controls or monitoring for the affected systems
7. If malicious activity is confirmed, block the source IP and reset compromised credentials
', '["https://docs.confluent.io/platform/current/control-center/index.html","https://attack.mitre.org/techniques/T1098/"]', 'safe("action", "") == "kafka.log" && (safe("log.component", "") == "ControlCenter" || safe("log.class", "").contains("controlcenter") || safe("log.msg", "").contains("Control Center")) && ( (safe("log.severity", "") == "high" && safe("log.msg", "").contains("authentication failed")) || safe("log.msg", "").contains("Access denied") || safe("log.msg", "").contains("Unauthorized") || safe("log.msg", "").contains("403") || safe("log.msg", "").contains("401") || safe("log.msg", "").contains("Permission denied") || safe("log.msg", "").contains("Invalid credentials") || safe("log.msg", "").contains("Login failed") || safe("log.msg", "").contains("password lookup") || safe("log.msg", "").contains("HTTP/1.1 401") || safe("log.msg", "").contains("UnauthorizedAccessException") || safe("log.msg", "").contains("SecurityException") || safe("log.msg", "").contains("ACL violation") || safe("log.msg", "").contains("Failed to authenticate") || safe("log.msg", "").contains("User not authorized") )', '2025-09-03 15:39:40.359969', true, false, 'origin', NULL, '[]');
INSERT INTO public.utm_correlation_rules VALUES (665, 'Mirror Maker Attack Detected', 3, 3, 3, 'Exfiltration', 'T1020 - Automated Exfiltration', 'Detects potential attacks on Kafka Mirror Maker that could lead to unauthorized data replication, topic mirroring manipulation, or cross-cluster data exfiltration. Monitors for Mirror Maker failures, unauthorized topic patterns, and replication lag issues.

Next Steps:
1. Review Kafka Mirror Maker configuration and access controls
2. Examine cluster topology and replication patterns for unauthorized changes
3. Check for suspicious topic patterns or unauthorized mirroring configurations
4. Verify consumer and producer permissions on source and destination clusters
5. Investigate network connections between clusters for potential data exfiltration
6. Review authentication logs for unauthorized access to Mirror Maker components
7. Analyze replication lag patterns for signs of throttling or interference
', '["https://kafka.apache.org/documentation/#basic_ops_mirror_maker","https://docs.confluent.io/kafka/operations-tools/kafka-tools.html#mirror-maker","https://attack.mitre.org/techniques/T1020/"]', 'safe("log.message", "") != "" && (safe("log.message", "").contains("MirrorMaker") || safe("log.message", "").contains("mirror maker") || safe("log.message", "").contains("replication") || safe("log.message", "").contains("mirroring")) && (safe("log.severity", "") == "hight" || safe("log.message", "").contains("unauthorized") || safe("log.message", "").contains("failed") || safe("log.message", "").contains("lag") || safe("log.message", "").contains("throttled"))', '2025-09-03 15:39:42.535137', true, false, 'origin', '["origin.host"]', '[]');
INSERT INTO public.utm_correlation_rules VALUES (670, 'Alert Action Exploitation Attempt', 2, 3, 1, 'Privilege Escalation', 'T1068 - Exploitation for Privilege Escalation', 'Detects attempts to exploit Kibana alert actions to execute unauthorized operations or escalate privileges through watcher or alert connectors. This rule identifies suspicious activity in Kibana alerting and action components that may indicate attempted exploitation.

Next Steps:
- Review the specific alert action that triggered this detection
- Examine the user account associated with the activity
- Check for any unauthorized webhook configurations or script executions
- Investigate recent changes to alerting rules and connectors
- Verify if the activity aligns with legitimate administrative operations
- Review Kibana audit logs for additional context
- Consider disabling suspicious alert actions if confirmed malicious
', '["https://www.elastic.co/guide/en/kibana/current/xpack-security-audit-logging.html","https://attack.mitre.org/techniques/T1068/"]', 'safe("log.component", "") == "alerting" || safe("log.component", "") == "actions" || (safe("log.actionMessage", "").contains("alert") && (safe("log.severityLabel", "") == "error" || safe("log.actionMessage", "").contains("unauthorized") || safe("log.actionMessage", "").contains("webhook") || safe("log.actionMessage", "").contains("exec") || safe("log.actionMessage", "").contains("command injection") || safe("log.actionMessage", "").contains("script execution") || safe("log.actionMessage", "").contains("privilege escalation")))', '2025-09-03 15:44:14.691449', true, false, 'origin', '["origin.user","origin.ip"]', '[]');
INSERT INTO public.utm_correlation_rules VALUES (671, 'API Access Violations', 3, 3, 2, 'Execution', 'T1106 - Native API', 'Detects unauthorized or suspicious API access attempts in Kibana including failed authentication, permission violations, or unusual API usage patterns. This rule identifies potential attackers attempting to abuse Kibana APIs or legitimate users experiencing access issues that may indicate compromised accounts.

Next Steps:
1. Review the specific API endpoint being accessed and the user account involved
2. Check authentication logs for signs of credential compromise
3. Verify if the user should have access to the requested API endpoints
4. Examine source IP for suspicious geographical locations or known threat indicators
5. Review user permissions and role assignments in Kibana
6. Check for any recent changes to API configurations or access controls
7. If confirmed malicious, disable the user account and reset credentials
', '["https://www.elastic.co/guide/en/kibana/current/api.html","https://attack.mitre.org/techniques/T1106/"]', '(safe("log.actionMessage", "") != "" && (safe("log.actionMessage", "").contains("unauthorized") || safe("log.actionMessage", "").contains("forbidden") || safe("log.actionMessage", "").contains("denied") || safe("log.actionMessage", "").contains("api"))) || (safe("actionResult", "") == "failure" && safe("log.component", "") != "" && safe("log.component", "").contains("api"))', '2025-09-03 15:44:15.169613', true, false, 'origin', '["origin.user","log.actionMessage"]', '[{"indexPattern":"v11-log-kibana-*","with":[{"field":"origin.user.keyword","operator":"filter_term","value":"{{.origin.user}}"},{"field":"actionResult.keyword","operator":"filter_term","value":"failure"}],"or":null,"within":"now-5m","count":3}]');
INSERT INTO public.utm_correlation_rules VALUES (672, 'CSRF Token Bypass Attempt', 2, 3, 1, 'Web Application Attack', 'T1059 - Command and Scripting Interpreter', 'Detects attempts to bypass CSRF token validation in Kibana by monitoring for requests missing required custom headers or using suspicious referer headers. CSRF attacks can allow unauthorized actions to be performed on behalf of authenticated users.

Next Steps:
1. Review the specific Kibana request that triggered this alert
2. Check the source IP and user account involved
3. Verify if the request was legitimate or part of an attack
4. Review recent authentication logs for the affected user
5. Check for any unusual user activity patterns
6. Consider implementing additional CSRF protections if needed
7. Monitor for follow-up malicious activities from the same source
', '["https://www.elastic.co/guide/en/kibana/current/security-best-practices.html","https://owasp.org/www-community/attacks/csrf"]', 'safe("log.component", "") == "kibana" && safe("log.actionMessage", "") != "" && ( safe("log.actionMessage", "").contains("missing custom header") || safe("log.actionMessage", "").contains("invalid kbn-xsrf") || safe("log.actionMessage", "").contains("CSRF token validation failed") || safe("log.actionMessage", "").contains("unauthorized request origin") || safe("log.actionMessage", "").contains("missing CSRF token") )', '2025-09-03 15:44:15.501183', true, false, 'origin', '["origin.user","origin.ip"]', '[]');
INSERT INTO public.utm_correlation_rules VALUES (666, 'Kafka Replicator Security Event Detected', 3, 2, 2, 'Defense Evasion, Persistence, Privilege Escalation, Initial Access', 'T1078 - Valid Accounts', 'Detects security-related events in Kafka Replicator including authentication failures, SSL/TLS errors, or SASL mechanism issues that could indicate unauthorized access attempts or misconfigurations.

Next Steps:
1. Review the specific error message in log.msg for details about the security event
2. Check Kafka cluster authentication configuration and certificates
3. Verify SASL mechanism settings and credentials
4. Examine network connectivity between replicator and target cluster
5. Review replicator configuration for security protocol settings
6. Monitor for additional authentication failures from the same host
7. Check for any unauthorized configuration changes to security settings
', '["https://docs.confluent.io/platform/current/multi-dc-deployments/replicator/index.html","https://attack.mitre.org/techniques/T1078/"]', 'safe("log.msg", "") != "" && ( safe("log.msg", "").contains("Authentication failed") || safe("log.msg", "").contains("SASL authentication failed") || safe("log.msg", "").contains("SSL handshake failed") || safe("log.msg", "").contains("security.protocol") || safe("log.msg", "").contains("sasl.mechanism") || safe("log.msg", "").contains("Unexpected handshake request") || safe("log.msg", "").contains("IllegalSaslStateException") || safe("log.msg", "").contains("No serviceName defined") || safe("log.msg", "").contains("Failed to create channel") || safe("log.msg", "").contains("Unable to read additional data from server") || safe("log.msg", "").contains("Authentication error") )', '2025-09-03 15:39:42.843762', true, false, 'origin', '["origin.host"]', '[]');
INSERT INTO public.utm_correlation_rules VALUES (667, 'Schema Registry Tampering Attempt', 2, 3, 2, 'Impact', 'T1565.001 - Data Manipulation: Stored Data Manipulation', 'Detects attempts to tamper with Kafka Schema Registry, including unauthorized schema modifications, deletions, or version manipulations. This could compromise data integrity and break consumer applications.

Next Steps:
- Investigate the source of schema registry operations from the affected host
- Review recent schema changes and verify if they were authorized
- Check for any applications that may have broken due to schema incompatibilities
- Examine authentication logs for the schema registry service
- Verify schema registry access controls and permissions
- Monitor for additional schema-related errors or warnings in the timeframe
', '["https://docs.confluent.io/platform/current/schema-registry/security/index.html","https://attack.mitre.org/techniques/T1565/001/"]', 'safe("log.component", "") != "" && contains(safe("log.component", ""), "SchemaRegistry") && safe("log.severity", "") != "" && (safe("log.severity", "") == "hight" || safe("log.severity", "") == "hight") && safe("log.message", "") != "" && (contains(safe("log.message", ""), "Schema not found") || contains(safe("log.message", ""), "Incompatible schema") || contains(safe("log.message", ""), "Schema version") || contains(safe("log.message", ""), "Schema deleted") || contains(safe("log.message", ""), "Unauthorized schema") || contains(safe("log.message", ""), "Failed to register schema") || contains(safe("log.message", ""), "Schema evolution"))', '2025-09-03 15:39:43.286117', true, false, 'origin', NULL, '[]');
INSERT INTO public.utm_correlation_rules VALUES (668, 'Transaction Coordinator Attack Detected', 1, 3, 2, 'Impact', 'Data Manipulation', 'Detects potential attacks on Kafka transaction coordinator that could compromise exactly-once semantics. This includes unauthorized transaction state changes, coordinator failures, or attempts to manipulate transaction logs.

Next Steps:
1. Review the specific error message in log.msg for attack indicators
2. Investigate the affected Kafka broker and transaction coordinator
3. Check for unauthorized access to transaction logs or state changes
4. Verify transaction coordinator configuration and security settings
5. Review recent changes to transactional producers and consumers
6. Monitor for data integrity issues in downstream applications
7. Consider temporarily disabling transactions if attack is confirmed
8. Check network traffic to/from the affected coordinator for anomalies
', '["https://cwiki.apache.org/confluence/display/KAFKA/Transactional+Messaging+in+Kafka","https://www.confluent.io/blog/transactions-apache-kafka/","https://attack.mitre.org/techniques/T1565/"]', 'safe("log.severity", "") == "hight" && safe("log.msg", "") != "" && (safe("log.msg", "").contains("TransactionCoordinator") || safe("log.msg", "").contains("transaction coordinator") || safe("log.msg", "").contains("TransactionalId")) && (safe("log.msg", "").contains("unauthorized") || safe("log.msg", "").contains("invalid") || safe("log.msg", "").contains("failed") || safe("log.msg", "").contains("timeout") || safe("log.msg", "").contains("epoch"))', '2025-09-03 15:39:43.881238', true, false, 'origin', NULL, '[]');
INSERT INTO public.utm_correlation_rules VALUES (669, 'Unauthorized Topic Access Attempt', 3, 2, 1, 'Defense Evasion, Persistence, Privilege Escalation, Initial Access', 'T1078 - Valid Accounts', 'Detects attempts to access Kafka topics without proper authorization. This could indicate an attacker trying to read sensitive data or a misconfigured client attempting to access restricted topics.

Next Steps:
1. Review the source host and user attempting the unauthorized access
2. Check Kafka ACLs and authentication configuration
3. Investigate if this is a legitimate client misconfiguration or potential security breach
4. Review recent changes to Kafka security policies
5. Monitor for additional unauthorized access attempts from the same source
', '["https://kafka.apache.org/documentation/#security_authz","https://attack.mitre.org/techniques/T1078/"]', 'safe("log.severity", "") == "hight" && safe("log.message", "") != "" && (contains(safe("log.message", ""), "is not authorized to") || contains(safe("log.message", ""), "Authorization failed") || contains(safe("log.message", ""), "Access denied") || contains(safe("log.message", ""), "TOPIC_AUTHORIZATION_FAILED"))', '2025-09-03 15:39:44.326128', true, false, 'origin', '["origin.host"]', '[]');
INSERT INTO public.utm_correlation_rules VALUES (680, 'Role Mapping Bypass Attempt', 3, 3, 2, 'Privilege Escalation, Defense Evasion', 'T1548 - Abuse Elevation Control Mechanism', 'Detects attempts to bypass role mapping controls in Kibana, which could allow unauthorized access to privileged functionality. This may indicate an attacker trying to escalate privileges through role manipulation.

Next Steps:
1. Review the specific user account attempting the role mapping bypass
2. Check Kibana audit logs for related authentication events
3. Verify if the user has legitimate administrative privileges
4. Examine the source IP and location of the attempt
5. Review recent changes to role mappings and user permissions
6. Correlate with any recent privilege escalation attempts
7. Consider temporarily disabling the affected user account if unauthorized
', '["https://www.elastic.co/guide/en/kibana/current/role-mappings.html","https://attack.mitre.org/techniques/T1548/"]', 'safe("log.component", "") == "role_mapping" && safe("log.severityLabel", "") == "ERROR" && (safe("log.actionMessage", "").matches(".*bypass.*") || safe("log.actionMessage", "").matches(".*unauthorized.*") || safe("log.actionMessage", "").matches(".*denied.*") || safe("log.actionMessage", "").matches(".*forbidden.*"))', '2025-09-03 15:44:42.943597', true, false, 'origin', '["origin.user","origin.ip"]', '[{"indexPattern":"v11-log-kibana-*","with":[{"field":"origin.user.keyword","operator":"filter_term","value":"{{.origin.user}}"},{"field":"log.component.keyword","operator":"filter_term","value":"role_mapping"},{"field":"log.severityLabel.keyword","operator":"filter_term","value":"ERROR"}],"or":null,"within":"now-15m","count":2}]');
INSERT INTO public.utm_correlation_rules VALUES (674, 'Index Pattern Tampering', 2, 3, 2, 'Impact', 'T1565.001 - Data Manipulation: Stored Data Manipulation', 'Detects attempts to tamper with Kibana index patterns which could lead to data manipulation or hiding of malicious activities. Index patterns control how Kibana interprets and displays data, making them critical security components that should be carefully monitored for unauthorized modifications.

Next Steps:
1. Verify the legitimacy of the index pattern modification with the user
2. Review what changes were made to the index pattern configuration
3. Check if the user has appropriate permissions for index pattern management
4. Examine recent user activity for other suspicious administrative actions
5. Validate that the modified index pattern doesn''t expose sensitive data inappropriately
6. Check audit logs for any related configuration changes
7. Verify the timing of the change against maintenance windows or authorized change requests
', '["https://www.elastic.co/guide/en/kibana/current/index-patterns.html","https://attack.mitre.org/techniques/T1565/001/"]', 'safe("log.actionMessage", "") != "" && (safe("log.actionMessage", "").contains("index-pattern") || safe("log.actionMessage", "").contains("index_pattern") || safe("log.actionMessage", "").contains("indexPattern")) && (safe("log.actionMessage", "").contains("create") || safe("log.actionMessage", "").contains("update") || safe("log.actionMessage", "").contains("delete") || safe("log.actionMessage", "").contains("modify") || safe("log.actionMessage", "").contains("change"))', '2025-09-03 15:44:16.513969', true, false, 'origin', '["origin.user","origin.host"]', '[]');
INSERT INTO public.utm_correlation_rules VALUES (675, 'Unauthorized Machine Learning Job Access', 3, 2, 1, 'Defense Evasion, Persistence, Privilege Escalation, Initial Access', 'T1078 - Valid Accounts', 'Detects unauthorized attempts to access, modify, or delete machine learning jobs in Kibana. This could indicate an attacker trying to manipulate ML-based security detections or exfiltrate sensitive ML model data.

Next Steps:
1. Verify the user''s authorization to access ML jobs
2. Check if the user account has been compromised
3. Review recent user activity for other suspicious actions
4. Examine the specific ML job being accessed for sensitive data
5. Consider temporarily disabling the user account if unauthorized access is confirmed
6. Check for any data exfiltration attempts from ML models
7. Review ML job configurations for unauthorized modifications
', '["https://www.elastic.co/guide/en/machine-learning/current/ml-security-overview.html","https://attack.mitre.org/techniques/T1078/"]', 'safe("actionResult", "") == "failure" && safe("log.actionMessage", "") in ["ml_get_job", "ml_put_job", "ml_delete_job", "ml_open_job", "ml_close_job", "ml_get_datafeed", "ml_put_datafeed"]', '2025-09-03 15:44:17.637492', true, false, 'origin', NULL, '[]');
INSERT INTO public.utm_correlation_rules VALUES (676, 'OIDC Authentication Security Event', 3, 3, 2, 'Defense Evasion, Lateral Movement', 'T1550 - Use Alternate Authentication Material', 'Detects OpenID Connect (OIDC) authentication security events including token replay attacks, authorization code interception, or refresh token abuse. These events may indicate attempts to compromise authentication mechanisms or abuse legitimate tokens.

Next Steps:
1. Review the specific OIDC error details in log.message for indicators of attack type
2. Investigate the user account for suspicious activity and recent login patterns
3. Check for multiple failed OIDC attempts from the same user or IP address
4. Verify if the authentication failure is due to legitimate causes or potential abuse
5. Review Kibana access logs for any successful logins following these failures
6. Consider temporarily disabling the affected user account if token abuse is suspected
7. Review OIDC provider logs for additional context on token validation failures
', '["https://www.elastic.co/guide/en/elasticsearch/reference/current/oidc-guide.html","https://attack.mitre.org/techniques/T1550/"]', '(safe("log.actionMessage", "").contains("authentication") || safe("log.actionMessage", "").contains("token")) && safe("log.message", "").contains("oidc") && (safe("actionResult", "") == "failure" || safe("log.severityLabel", "") == "error" || safe("log.severityLabel", "") == "critical")', '2025-09-03 15:44:18.083267', true, false, 'origin', '["origin.user","log.actionMessage"]', '[]');
INSERT INTO public.utm_correlation_rules VALUES (677, 'PKI Certificate Authentication Failure', 3, 2, 1, 'Credential Access', 'T1606.002 - Forge Web Credentials: SAML Tokens', 'Detects PKI certificate authentication failures that may indicate certificate spoofing, invalid certificates, or attempts to bypass client certificate validation. This rule identifies failed authentication attempts using PKI certificates which could indicate an attacker attempting to use forged, expired, or stolen certificates to gain unauthorized access.

Next Steps:
1. Review the source host and user attempting PKI authentication
2. Examine certificate details and validity status
3. Check for patterns of repeated failures from the same source
4. Verify if legitimate certificate renewal is needed
5. Investigate any successful authentications from the same source around the time of failures
6. Review certificate authority logs for any unauthorized certificate issuance
', '["https://www.elastic.co/guide/en/kibana/current/kibana-authentication.html","https://attack.mitre.org/techniques/T1606/002/"]', '(safe("log.actionMessage", "").matches(".*pki.*") || safe("log.actionMessage", "").matches(".*certificate.*") || safe("log.actionMessage", "").matches(".*x509.*") || safe("log.actionMessage", "").matches(".*client cert.*")) && (safe("log.severityLabel", "") == "ERROR" || safe("log.severityLabel", "") == "WARN") && safe("actionResult", "") == "failure"', '2025-09-03 15:44:18.503867', true, false, 'origin', '["origin.host","origin.user"]', '[{"indexPattern":"v11-log-kibana-*","with":[{"field":"origin.host.keyword","operator":"filter_term","value":"{{.origin.host}}"}],"or":null,"within":"now-30m","count":3}]');
INSERT INTO public.utm_correlation_rules VALUES (686, 'Timelion Expression Injection Attempt', 3, 3, 2, 'Execution', 'T1059 - Command and Scripting Interpreter', 'Detects attempts to exploit Timelion expression injection vulnerability (CVE-2019-7609) that could lead to arbitrary code execution. This vulnerability allows attackers with access to Timelion to execute JavaScript code with Kibana process permissions.

Next Steps:
1. Immediately review the Timelion queries executed by the affected user
2. Check if any unauthorized code execution occurred on the Kibana server
3. Analyze the specific expression that triggered the alert for malicious patterns
4. Review user access logs to determine if the account was compromised
5. Update Kibana to a patched version if not already done
6. Consider disabling Timelion if not essential for operations
7. Review and restrict user permissions for Timelion access
', '["https://nvd.nist.gov/vuln/detail/CVE-2019-7609","https://attack.mitre.org/techniques/T1059/"]', 'safe("log.component", "") == "plugins.timelion" && safe("log.severityLabel", "") == "error" && (safe("log.actionMessage", "").contains("eval") || safe("log.actionMessage", "").contains("Function") || safe("log.actionMessage", "").contains("javascript:") || safe("log.actionMessage", "").contains("script"))', '2025-09-03 15:44:45.881014', true, false, 'origin', NULL, '[]');
INSERT INTO public.utm_correlation_rules VALUES (690, 'Beats Input Protocol Exploitation', 3, 3, 3, 'Command and Control', 'Protocol Impersonation', 'Detects potential exploitation attempts against Logstash Beats input plugin including malformed packets, SSL/TLS issues, and protocol violations. This rule monitors for error conditions and suspicious patterns that may indicate attempts to exploit the Beats input protocol.

Next Steps:
- Investigate the source IP attempting the connection
- Review network traffic patterns to/from the affected Logstash instance
- Check for signs of data exfiltration or lateral movement
- Verify Logstash configuration and security settings
- Review certificate validity and SSL/TLS configuration
- Monitor for repeated attempts from the same source
', '["https://www.elastic.co/guide/en/logstash/current/plugins-inputs-beats.html","https://attack.mitre.org/techniques/T1071/"]', 'safe("log.component", "") == "logstash.inputs.beats" && 
safe("log.msg", "") != "" &&
(
  safe("log.msg", "").contains("SSL") ||
  safe("log.msg", "").contains("TLS") ||
  safe("log.msg", "").contains("certificate") ||
  safe("log.msg", "").contains("handshake") ||
  safe("log.msg", "").contains("protocol error") ||
  safe("log.msg", "").contains("invalid frame") ||
  safe("log.msg", "").contains("malformed") ||
  safe("log.msg", "").contains("connection reset") ||
  safe("log.msg", "").contains("unexpected eof") ||
  safe("log.msg", "").contains("decompression") ||
  safe("log.msg", "").contains("max frame size") ||
  safe("log.msg", "").contains("invalid version") ||
  safe("log.msg", "").contains("authentication") ||
  safe("log.msg", "").contains("peer") ||
  (safe("log.level", "") != "" && (safe("log.level", "") == "ERROR" || safe("log.level", "") == "FATAL" || safe("log.level", "") == "WARN"))
)
', '2025-09-03 15:46:05.459812', true, false, 'origin', NULL, '[]');
INSERT INTO public.utm_correlation_rules VALUES (682, 'Saved Object Tampering Detection', 2, 3, 2, 'Impact', 'T1565.001 - Data Manipulation: Stored Data Manipulation', 'Detects suspicious modification patterns of saved objects in Kibana, including rapid updates to dashboards, visualizations, or searches that could indicate tampering or malicious configuration changes.

Next Steps:
1. Review the specific saved objects being modified by checking Kibana audit logs
2. Verify if the user has legitimate reasons for making these changes
3. Check if the modifications align with scheduled maintenance or authorized updates
4. Examine the content of modified objects for signs of malicious code or configuration
5. Review user permissions and access patterns to ensure proper authorization
6. Consider temporarily restricting the user''s access if unauthorized activity is suspected
7. Cross-reference the timing of changes with any security incidents or alerts
8. Validate that the user account hasn''t been compromised by checking for other suspicious activities
', '["https://www.elastic.co/guide/en/kibana/current/xpack-security-audit-logging.html","https://attack.mitre.org/techniques/T1565/001/"]', 'safe("log.actionMessage", "").contains("saved_object") && safe("log.component", "") == "kibana" && (safe("log.actionMessage", "").contains("dashboard") || safe("log.actionMessage", "").contains("visualization") || safe("log.actionMessage", "").contains("search") || safe("log.actionMessage", "").contains("index-pattern"))', '2025-09-03 15:44:43.871744', true, false, 'origin', '["origin.user","origin.host"]', '[{"indexPattern":"v11-log-kibana-*","with":[{"field":"origin.user.keyword","operator":"filter_term","value":"{{.origin.user}}"},{"field":"log.component.keyword","operator":"filter_term","value":"kibana"}],"or":null,"within":"now-2m","count":5}]');
INSERT INTO public.utm_correlation_rules VALUES (683, 'Scripted Field Execution in Kibana', 3, 3, 2, 'Execution', 'T1059.007 - Command and Scripting Interpreter: JavaScript', 'Detects suspicious scripted field execution attempts in Kibana that could be used for remote code execution or data exfiltration. Scripted fields allow execution of Painless scripts which could be abused by attackers.

Next Steps:
1. Review the specific scripted field creation or modification attempt
2. Verify if the user has legitimate access to create scripted fields
3. Examine the script content for malicious code patterns
4. Check for any data exfiltration attempts through script execution
5. Review user permissions and consider restricting scripted field capabilities
6. Monitor for additional suspicious Kibana activities from the same user/host
7. Correlate with other authentication and access events from the same user
8. Check if the scripted field accesses sensitive data or performs suspicious operations
', '["https://www.elastic.co/guide/en/kibana/current/scripted-fields.html","https://attack.mitre.org/techniques/T1059/007/"]', 'safe("log.actionMessage", "") != "" && (safe("log.actionMessage", "").contains("scripted_field") || safe("log.actionMessage", "").contains("script.inline") || safe("log.actionMessage", "").contains("painless")) && safe("log.component", "") == "kibana"', '2025-09-03 15:44:44.54348', true, false, 'origin', '["origin.user","origin.host"]', '[]');
INSERT INTO public.utm_correlation_rules VALUES (684, 'Potential Session Hijacking Activity', 3, 3, 2, 'Collection', 'T1185 - Browser Session Hijacking', 'Detects potential session hijacking activities based on suspicious authentication patterns, multiple IP addresses using the same session, or rapid location changes that may indicate stolen session tokens.

Next Steps:
1. Investigate the user account and recent login patterns
2. Check for concurrent sessions from different IP addresses or locations
3. Review session activity logs for unusual behavior patterns
4. Verify if the user reported any suspicious activity
5. Consider forcing session termination and requiring re-authentication
6. Check for any recent credential compromise indicators
7. Review security controls on user workstations and browsers
', '["https://www.elastic.co/guide/en/kibana/current/xpack-security-audit-logging.html","https://attack.mitre.org/techniques/T1185/"]', 'safe("log.actionMessage", "").matches(".*http_request.*") && safe("origin.user", "") != "" && (safe("log.actionMessage", "").matches(".*session.*") || safe("log.component", "").matches(".*security.*") && (safe("actionResult", "") == "failure" || safe("log.severityLabel", "") == "warning" || safe("log.severityLabel", "") == "error")', '2025-09-03 15:44:45.024124', true, false, 'origin', NULL, '[]');
INSERT INTO public.utm_correlation_rules VALUES (685, 'Kibana Space Isolation Violation', 3, 3, 2, 'Defense Evasion, Persistence, Privilege Escalation, Initial Access', 'T1078 - Valid Accounts', 'Detects attempts to violate Kibana space isolation by accessing resources across unauthorized spaces or bypassing space-level permissions.
This rule triggers on failed authorization events related to space access controls.

Next Steps:
1. Review the user''s assigned spaces and permissions in Kibana
2. Check if the user should have access to the requested space
3. Examine the specific resource or action that triggered the violation
4. Review audit logs for any other suspicious activities by this user
5. Consider updating space permissions or user roles if legitimate access is needed
6. Monitor for additional cross-space access attempts from this user
7. Verify if this represents a privilege escalation attempt
', '["https://www.elastic.co/guide/en/kibana/current/xpack-security-audit-logging.html","https://attack.mitre.org/techniques/T1078/"]', 'safe("action", "") == "kibana.audit" && ( safe("log.actionMessage", "").contains("space") || safe("log.component", "") == "spaces" || safe("log.severityLabel", "") in ["error", "warning"] ) && ( safe("actionResult", "") == "failure" || safe("log.actionMessage", "").contains("space access denied") || safe("log.actionMessage", "").contains("cross-space") || safe("log.actionMessage", "").contains("unauthorized space") || safe("log.actionMessage", "").contains("permission denied") || safe("log.actionMessage", "").contains("space isolation") ) && safe("origin.user", "") != ""', '2025-09-03 15:44:45.466054', true, false, 'origin', NULL, '[]');
INSERT INTO public.utm_correlation_rules VALUES (687, 'Unauthorized Space Access Attempt', 3, 2, 1, 'Defense Evasion, Persistence, Privilege Escalation, Initial Access', 'T1078 - Valid Accounts', 'Detects repeated failed attempts to access Kibana spaces, which may indicate an attacker trying to gain unauthorized access to restricted spaces or enumerate available spaces in the system.

Next Steps:
1. Review the user account attempting space access and verify legitimacy
2. Check if the user has proper permissions for the requested spaces
3. Examine source IP and session details for suspicious patterns
4. Consider implementing additional access controls or multi-factor authentication
5. Monitor for privilege escalation attempts from the same user
', '["https://www.elastic.co/guide/en/kibana/current/xpack-security-audit-logging.html","https://attack.mitre.org/techniques/T1078/"]', 'safe("log.actionMessage", "").contains("space_get") && safe("log.actionMessage", "").contains("failure") && safe("origin.user", "") != ""', '2025-09-03 15:44:46.523519', true, false, 'origin', NULL, '[{"indexPattern":"v11-log-kibana-*","with":[{"field":"origin.user.keyword","operator":"filter_term","value":"{{.origin.user}}"},{"field":"log.actionMessage.keyword","operator":"filter_match","value":"space_get"},{"field":"log.actionMessage.keyword","operator":"filter_match","value":"failure"}],"or":null,"within":"now-5m","count":5}]');
INSERT INTO public.utm_correlation_rules VALUES (688, 'Watcher UI Exploitation Attempt', 3, 3, 2, 'Privilege Escalation', 'T1068 - Exploitation for Privilege Escalation', 'Detects attempts to exploit Watcher UI vulnerabilities or bypass access controls. This includes unauthorized attempts to create, modify, or execute watches that could be used for persistence or data exfiltration.

Next Steps:
1. Review the Kibana audit logs for the affected user account
2. Check for unauthorized watch creations or modifications around the time of the alert
3. Verify the user''s legitimate access requirements to Watcher functionality
4. Examine the specific error messages or failed actions for indicators of exploitation attempts
5. Review network connections from the source IP for other suspicious activities
6. Consider temporarily disabling the user account if exploitation is confirmed
7. Update Watcher access controls and review role-based permissions
', '["https://www.elastic.co/guide/en/kibana/current/watcher-ui.html","https://attack.mitre.org/techniques/T1068/"]', 'safe("log.component", "") == "plugins.watcher" && (safe("log.severityLabel", "") == "error" || safe("log.actionMessage", "").contains("unauthorized") || safe("log.actionMessage", "").contains("permission") && safe("log.actionMessage", "").contains("denied") || safe("log.actionMessage", "").contains("watcher") && safe("log.actionMessage", "").contains("error") || safe("log.actionMessage", "").contains("access") && safe("log.actionMessage", "").contains("denied"))', '2025-09-03 15:44:46.983332', true, false, 'origin', '["origin.user","origin.ip"]', '[]');
INSERT INTO public.utm_correlation_rules VALUES (1499, 'Windows: Suspicious Microsoft Diagnostics Wizard Execution with args IT_RebrowseForFile=, ms-msdt:/id, ms-msdt:-id or FromBase64', 2, 3, 1, 'Defense Evasion', 'System Binary Proxy Execution', 'Identifies potential abuse of the Microsoft Diagnostics Troubleshooting Wizard (MSDT) to proxy malicious command or binary execution via malicious process arguments', '["https://attack.mitre.org/tactics/TA0005/","https://attack.mitre.org/techniques/T1218/"]', 'safe("log.winlogEventDataProcessName", "").contains("msdt.exe") && safe("log.message", "").matches("(IT_RebrowseForFile=|ms-msdt:/id|ms-msdt:-id|FromBase64)")', '2025-09-04 21:16:08.68268', true, false, 'origin', NULL, '[]');
INSERT INTO public.utm_correlation_rules VALUES (689, 'XSS Attack Attempt Detection', 3, 3, 1, 'Execution', 'T1059.007 - Cross-Site Scripting', 'Detects potential XSS attack attempts in Kibana through malicious script injection in search queries, field formatters, or visualization titles. This rule identifies common XSS patterns including script tags, JavaScript execution, and event handlers that could indicate an attempt to inject malicious code into Kibana interfaces.

Next Steps:
1. Review the specific log message and action that triggered this alert
2. Check the user''s recent activity in Kibana for other suspicious actions
3. Examine the affected Kibana component for potential compromise
4. Review Kibana access logs for the source IP and user
5. Consider blocking the source IP if malicious activity is confirmed
6. Update Kibana security configurations and input validation
7. Implement Content Security Policy (CSP) headers to prevent XSS execution
8. Review and sanitize all user inputs in Kibana dashboards and visualizations
', '["https://www.elastic.co/guide/en/kibana/current/security-best-practices.html","https://attack.mitre.org/techniques/T1059/007/"]', '(safe("log.component", "") == "visualize" || safe("log.component", "") == "discover" || safe("log.component", "") == "security") && ( safe("log.actionMessage", "").matches(".*<script.*>.*</script>.*") || safe("log.actionMessage", "").matches(".*javascript:.*") || safe("log.actionMessage", "").matches(".*onerror=.*") || safe("log.actionMessage", "").matches(".*onload=.*") || safe("log.actionMessage", "").matches(".*<iframe.*") || safe("log.actionMessage", "").contains("eval(") || safe("log.actionMessage", "").contains("Function(") )', '2025-09-03 15:44:47.401604', true, false, 'origin', '["adversary.user","log.component"]', '[]');
INSERT INTO public.utm_correlation_rules VALUES (696, 'File Input Path Traversal Attempt', 3, 3, 2, 'Collection', 'T1005 - Data from Local System', 'Detects attempts to use path traversal sequences in Logstash file input plugin to access files outside the intended directory structure. Attackers may exploit misconfigured file input paths to read sensitive files from the system.

Next Steps:
1. Verify the Logstash configuration and file input plugin settings
2. Check if any unauthorized files were actually accessed or read
3. Review file permissions and directory restrictions on the affected host
4. Examine recent Logstash logs for other suspicious file access patterns
5. Consider implementing additional path validation and restrictions
6. Monitor for any data exfiltration activities from the compromised system
7. Review system logs for any unauthorized access to sensitive directories
8. Implement input validation and sanitization for file paths in Logstash configurations
', '["https://cwe.mitre.org/data/definitions/22.html","https://attack.mitre.org/techniques/T1005/"]', 'safe("log.component", "") == "logstash.inputs.file" && safe("log.msg", "") != "" && ( safe("log.msg", "").contains("../") || safe("log.msg", "").contains("..\\") || safe("log.msg", "").contains("%2e%2e") || safe("log.msg", "").contains("%252e") || safe("log.msg", "").contains("..%2f") || safe("log.msg", "").contains("..%5c") || safe("log.msg", "").contains("/etc/") || safe("log.msg", "").contains("\\windows\\") || safe("log.msg", "").contains("/proc/") || safe("log.msg", "").contains("/dev/") )', '2025-09-03 15:46:08.797211', true, false, 'origin', '["origin.host","log.msg"]', '[]');
INSERT INTO public.utm_correlation_rules VALUES (702, 'Logstash Monitoring API Unauthorized Access Attempt', 2, 1, 2, 'Initial Access', 'T1190 - Exploit Public-Facing Application', 'Detects unauthorized access attempts to Logstash monitoring API endpoints, which could expose sensitive system information including JVM stats, pipeline configurations, and plugin details. This could allow attackers to gather intelligence about the logging infrastructure for further exploitation.

Next Steps:
- Review the source IP address attempting unauthorized access
- Check if this is a legitimate monitoring tool or security scanner
- Verify Logstash API authentication is properly configured
- Review firewall rules to ensure monitoring endpoints are not exposed to external networks
- Check for any successful API access from the same source using access logs
- Consider implementing IP whitelisting for monitoring endpoints
- Review Logstash configuration for exposed monitoring interfaces
- Investigate if this is part of a broader reconnaissance campaign
', '["https://www.elastic.co/guide/en/logstash/current/monitoring-logstash.html","https://attack.mitre.org/techniques/T1190/"]', 'safe("log.component", "") == "logstash.api" && safe("log.msg", "") != "" && (safe("log.msg", "").contains("401") || safe("log.msg", "").contains("403") || safe("log.msg", "").contains("unauthorized") || safe("log.msg", "").contains("forbidden") || safe("log.msg", "").contains("access denied")) && safe("log.level", "") == "ERROR"', '2025-09-03 15:46:32.552122', true, false, 'origin', '["origin.ip"]', '[]');
INSERT INTO public.utm_correlation_rules VALUES (691, 'Logstash Central Management Configuration Tampering', 2, 3, 3, 'Lateral Movement', 'T1021 - Remote Services', 'Detects attempts to tamper with Logstash central management configurations, including unauthorized pipeline modifications or configuration injection attempts. This rule identifies error-level log messages related to pipeline or configuration failures that may indicate malicious tampering.

Next Steps:
1. Review the specific error message in log.msg for details about the configuration failure
2. Investigate the affected pipeline (log.pipelineName) for unauthorized changes
3. Check Logstash central management console for recent configuration modifications
4. Verify the source of configuration changes and validate against authorized change management processes
5. Review access logs for the central management system to identify potential unauthorized access
6. If tampering is confirmed, restore configurations from known-good backups and review security controls
', '["https://www.elastic.co/guide/en/logstash/current/configuring-centralized-pipelines.html","https://attack.mitre.org/techniques/T1021/"]', 'safe("log.component", "") == "logstash.agent" && safe("log.msg", "") != "" && (safe("log.msg", "").contains("pipeline") || safe("log.msg", "").contains("config")) && (safe("log.msg", "").contains("failed") || safe("log.msg", "").contains("error") || safe("log.msg", "").contains("rejected") || safe("log.msg", "").contains("invalid")) && safe("log.level", "") == "hight"', '2025-09-03 15:46:06.02398', true, false, 'origin', '["origin.host","log.pipelineName"]', '[]');
INSERT INTO public.utm_correlation_rules VALUES (692, 'Logstash Conditional Logic Bypass', 3, 3, 2, 'Defense Evasion', 'T1562.001 - Impair Defenses: Disable or Modify Tools', 'Detects attempts to bypass conditional logic in Logstash pipelines that could allow malicious events to evade security filters or processing rules. This indicates potential tampering with log processing mechanisms that could enable attackers to hide malicious activities.

Next Steps:
- Review Logstash configuration files for unauthorized modifications
- Check pipeline integrity and validate conditional logic statements
- Examine recent configuration changes and access logs
- Verify filter conditions are working as expected
- Monitor for patterns of dropped or bypassed events
- Review user access to Logstash configuration systems
', '["https://www.elastic.co/guide/en/logstash/current/event-dependent-configuration.html","https://attack.mitre.org/techniques/T1562/001/"]', '(safe("log.component", "") == "logstash.config" || safe("log.component", "") == "logstash.pipeline" || safe("log.component", "") == "logstash.filters") && safe("log.msg", "") != "" && ( (safe("log.msg", "").contains("conditional") && (safe("log.msg", "").contains("bypass") || safe("log.msg", "").contains("skip") || safe("log.msg", "").contains("ignored"))) || (safe("log.msg", "").contains("if") && safe("log.msg", "").contains("statement") && (safe("log.msg", "").contains("always false") || safe("log.msg", "").contains("always true"))) || (safe("log.msg", "").contains("condition") && safe("log.msg", "").contains("evaluation") && safe("log.msg", "").contains("failed")) || (safe("log.msg", "").contains("conditional") && safe("log.msg", "").contains("expression") && (safe("log.msg", "").contains("malformed") || safe("log.msg", "").contains("invalid"))) || (safe("log.msg", "").contains("event") && safe("log.msg", "").contains("dropped") && safe("log.msg", "").contains("conditional")) || (safe("log.msg", "").contains("filter") && safe("log.msg", "").contains("condition") && safe("log.msg", "").contains("not met") && safe("log.level", "") == "high") || (safe("log.msg", "").contains("conditional") && safe("log.msg", "").contains("override")) || (safe("log.msg", "").contains("field") && safe("log.msg", "").contains("missing") && safe("log.msg", "").contains("conditional") && safe("log.msg", "").contains("skipped")) )', '2025-09-03 15:46:06.465612', true, false, 'origin', NULL, '[{"indexPattern":"v11-log-logstash-*","with":[{"field":"origin.host.keyword","operator":"filter_term","value":"{{.origin.host}}"},{"field":"log.pipelineName.keyword","operator":"filter_term","value":"{{.log.pipelineName}}"}],"or":null,"within":"now-2h","count":15}]');
INSERT INTO public.utm_correlation_rules VALUES (693, 'Logstash Configuration Tampering Detection', 3, 3, 2, 'Persistence', 'T1554 - Compromise Client Software Binary', 'Detects attempts to modify Logstash configuration files or pipeline settings that could compromise data processing integrity. This rule triggers on ERROR-level messages from the configuration path loader indicating configuration changes or reloads.

Next Steps:
- Verify if the configuration change was authorized and performed by legitimate administrators
- Review the specific configuration files that were modified
- Check for any unauthorized access to the Logstash server
- Examine recent user activity and administrative actions on the affected system
- Validate the integrity of current Logstash configuration files
- Monitor for any subsequent anomalous data processing behavior
', '["https://www.elastic.co/guide/en/logstash/current/configuration.html","https://attack.mitre.org/techniques/T1554/"]', 'safe("log.component", "") == "config.source.local.configpathloader" && safe("log.msg", "") != "" && (safe("log.msg", "").contains("config reload") || safe("log.msg", "").contains("modified") || safe("log.msg", "").contains("changed")) && safe("log.level", "") == "ERROR"', '2025-09-03 15:46:06.905577', true, false, 'origin', '["origin.host","log.pipelineName"]', '[]');
INSERT INTO public.utm_correlation_rules VALUES (694, 'Logstash Dead Letter Queue Abuse Detection', 3, 3, 3, 'Impact', 'T1565 - Data Manipulation', 'Detects abnormal patterns in dead letter queue operations that could indicate attempts to hide malicious data or bypass security monitoring. Dead letter queues store events that Logstash cannot process, and unusual activity in these queues may suggest data manipulation attempts or configuration tampering.

Next Steps:
1. Review the specific dead letter queue events and messages to understand what data is being rejected
2. Examine Logstash pipeline configurations for recent changes or unauthorized modifications
3. Check for patterns in the rejected events that might indicate intentional data obfuscation
4. Verify system resources and storage capacity to rule out legitimate overflow conditions
5. Correlate with user access logs to identify who might have modified Logstash configurations
6. Review network logs for unusual data ingestion patterns that could cause queue overflow
7. Investigate the source of events being sent to the dead letter queue for potential security implications
', '["https://www.elastic.co/guide/en/logstash/current/dead-letter-queues.html","https://attack.mitre.org/techniques/T1565/"]', 'safe("log.component", "") != "" && safe("log.component", "").contains("dead_letter_queue") && safe("log.msg", "") != "" && (safe("log.msg", "").contains("max_bytes") || safe("log.msg", "").contains("overflow") || safe("log.msg", "").contains("flush")) && safe("log.level", "") != "INFO"', '2025-09-03 15:46:07.533714', true, false, 'origin', '["origin.host","log.pipelineName"]', '[{"indexPattern":"v11-log-elastic-*","with":[{"field":"origin.host.keyword","operator":"filter_term","value":"{{.origin.host}}"},{"field":"log.component.keyword","operator":"filter_term","value":"dead_letter_queue"}],"or":null,"within":"now-2h","count":20}]');
INSERT INTO public.utm_correlation_rules VALUES (695, 'Logstash Environment Variable Information Disclosure', 3, 1, 1, 'Discovery', 'T1082 - System Information Discovery', 'Detects potential environment variable exposure or enumeration attempts that could reveal sensitive configuration data, passwords, or API keys stored in environment variables in Logstash logs.

Next Steps:
1. Review the specific log message to identify what environment variables were exposed
2. Check if sensitive data like passwords, API keys, or secrets were disclosed
3. Identify the source of the disclosure (configuration error, debugging, etc.)
4. Verify if the exposed information could be accessed by unauthorized users
5. Rotate any exposed credentials immediately
6. Review Logstash configuration for proper secret management
7. Implement proper logging filters to prevent sensitive data exposure
', '["https://discuss.elastic.co/t/logstash-keystore-password-can-be-read-from-linux-command/133119","https://attack.mitre.org/techniques/T1082/"]', 'safe("log.msg", "") != "" && (safe("log.msg", "").contains("environ") || safe("log.msg", "").contains("getenv") || safe("log.msg", "").contains("printenv") || safe("log.msg", "").contains("LOGSTASH_KEYSTORE_PASS") || safe("log.msg", "").contains("${") || safe("log.msg", "").contains("password") || safe("log.msg", "").contains("api_key") || safe("log.msg", "").contains("secret")) && (safe("log.component", "") in ["logstash.runner", "logstash.config.source.local.configpathloader"] || safe("log.level", "") in ["WARN", "ERROR"])', '2025-09-03 15:46:07.970814', true, false, 'origin', '["origin.host"]', '[]');
INSERT INTO public.utm_correlation_rules VALUES (704, 'Logstash Pipeline Injection Detection', 3, 3, 2, 'Execution', 'T1059.004 - Command and Scripting Interpreter: Unix Shell', 'Detects potential pipeline injection attempts in Logstash through malicious configuration or command execution in pipeline files. This may indicate an attacker attempting to execute arbitrary commands through Logstash pipeline configuration manipulation.

Next Steps:
1. Review the Logstash configuration files for any unauthorized changes
2. Check the log message content to understand what pipeline configuration was loaded
3. Verify if the pipeline reload was authorized by an administrator
4. Review system processes for any suspicious command execution
5. Check file integrity of /etc/logstash/pipelines.yml and pipeline configuration files
6. Investigate any recent changes to Logstash user permissions or file access
7. Review network connections from the affected host for any unusual outbound traffic
8. Check for any concurrent suspicious activities on the system during the time of the alert
', '["https://book.hacktricks.xyz/linux-hardening/privilege-escalation/logstash","https://attack.mitre.org/techniques/T1059/004/"]', 'safe("log.component", "") == "logstash.config.sourceloader" && safe("log.msg", "") != "" && ( safe("log.msg", "").contains("exec") && (safe("log.msg", "").contains("command") || safe("log.msg", "").contains("interval")) || safe("log.msg", "").contains("ruby") && safe("log.msg", "").contains("code") || safe("log.msg", "").contains("file") && safe("log.msg", "").contains("/etc/") || safe("log.msg", "").contains("pipeline") && safe("log.msg", "").contains("reload") )', '2025-09-03 15:46:33.629404', true, false, 'origin', NULL, '[]');
INSERT INTO public.utm_correlation_rules VALUES (1501, 'Windows: Possible ransomware attack detected. Multiple File Deletion.', 1, 3, 2, 'Ransomware', 'Impact: Data Encrypted for Impact', 'Ransomware, is a type of malware that prevents users from accessing their system or  personal files and requires payment of a ransom in order to gain access to them again. Identifies  ransomware attempts. A high number of file deletion events have been detected in a short period,  potentially indicating ransomware activity.', '["https://attack.mitre.org/tactics/TA0040/"]', 'safe("log.eventCode", 0.0) == double(4663) && safe("log.winlogEeventDataAccessMask", "") in [''0x100080'',''0x40'',''0x10000'']', '2025-09-04 21:16:09.944074', true, false, 'origin', NULL, '[]');
INSERT INTO public.utm_correlation_rules VALUES (697, 'Logstash Filter Bypass Attempts', 3, 3, 2, 'Defense Evasion', 'T1562.006 - Impair Defenses: Indicator Blocking', 'Detects attempts to bypass or disable Logstash filter plugins that could lead to unprocessed malicious data or security control evasion. This rule identifies various indicators of filter manipulation including skip operations, exceptions, and conditional bypasses that could allow malicious data to pass through unprocessed.

Next Steps:
1. Review the specific Logstash pipeline and filter configuration that triggered the alert
2. Examine recent configuration changes to Logstash filters and pipelines
3. Check for unauthorized access to Logstash configuration files
4. Verify the integrity of filter plugins and their dependencies
5. Review logs for patterns of data that may have bypassed security filters
6. Investigate the source system generating the bypass attempts
7. Check for signs of privilege escalation or unauthorized administrative access
8. Validate that all security-related filters are functioning as expected
', '["https://www.elastic.co/guide/en/logstash/current/filter-plugins.html","https://attack.mitre.org/techniques/T1562/006/"]', '(safe("log.component", "") == "logstash.filters" || safe("log.component", "") == "logstash.pipeline") && safe("log.msg", "") != "" && safe("log.level", "") == "ERROR" && ( safe("log.msg", "").contains("filter") && (safe("log.msg", "").contains("skip") || safe("log.msg", "").contains("bypass") || safe("log.msg", "").contains("disabled")) || safe("log.msg", "").contains("exception") && safe("log.msg", "").contains("filter") || safe("log.msg", "").contains("Failed to execute filter") || safe("log.msg", "").contains("Filter chain broken") || safe("log.msg", "").contains("conditional") && safe("log.msg", "").contains("always false") )', '2025-09-03 15:46:09.200925', true, false, 'origin', '["origin.host","log.pipelineName"]', '[{"indexPattern":"v11-log-logstash-*","with":[{"field":"origin.host.keyword","operator":"filter_term","value":"{{.origin.host}}"},{"field":"log.pipelineName.keyword","operator":"filter_term","value":"{{.log.pipelineName}}"}],"or":null,"within":"now-30m","count":3}]');
INSERT INTO public.utm_correlation_rules VALUES (703, 'Logstash Persistent Queue Manipulation Attack', 2, 3, 3, 'Impact', 'T1499 - Endpoint Denial of Service', 'Detects suspicious activities targeting Logstash persistent queues that could lead to data loss, queue exhaustion, or service degradation. This rule monitors for queue failures, capacity issues, and disk space problems that may indicate an attack or system compromise.

Next Steps:
- Check disk space availability on the Logstash server
- Review queue configuration and capacity limits
- Examine recent changes to pipeline configurations
- Look for unusual traffic patterns or data ingestion spikes
- Verify if legitimate maintenance or configuration changes were made
- Check system logs for related errors or resource exhaustion
- Investigate correlating events in the persistent queue subsystem
- Review authentication logs for unauthorized access attempts
', '["https://www.elastic.co/guide/en/logstash/current/persistent-queues.html","https://attack.mitre.org/techniques/T1499/"]', 'safe("log.component", "") != "" && (safe("log.component", "").contains("queue") || safe("log.component", "").contains("acked")) && safe("log.msg", "") != "" && (safe("log.msg", "").contains("failed") || safe("log.msg", "").contains("capacity") || safe("log.msg", "").contains("disk full") || safe("log.msg", "").contains("error") || safe("log.msg", "").contains("exhausted") || safe("log.msg", "").contains("corrupt"))', '2025-09-03 15:46:32.859745', true, false, 'origin', NULL, '[]');
INSERT INTO public.utm_correlation_rules VALUES (721, 'MongoDB SCRAM Authentication Attack Detection', 3, 2, 1, 'Credential Access', 'T1110 - Brute Force', 'Detects multiple failed SCRAM authentication attempts from the same source IP, indicating potential brute force or credential stuffing attacks against MongoDB database users. SCRAM is MongoDB''s default authentication mechanism and repeated failures suggest systematic credential guessing.

Next Steps:
1. Identify the source IP address and check if it''s a legitimate user or system accessing MongoDB
2. Review the targeted MongoDB user accounts for any signs of compromise or suspicious activity
3. Check if the source IP has attempted authentication against other database or application services
4. Consider temporarily blocking the source IP if the attack is ongoing and confirmed malicious
5. Review MongoDB authentication logs for successful logins from the same source after failed attempts
6. Verify that strong password policies are enforced for MongoDB users and consider requiring password resets for targeted accounts
7. Implement or review account lockout policies, rate limiting, and connection throttling for MongoDB authentication
8. Check MongoDB server logs for any database enumeration activities from the source IP
9. Review network security controls to ensure MongoDB is not unnecessarily exposed to external networks
', '["https://www.mongodb.com/docs/manual/core/security-scram/","https://attack.mitre.org/techniques/T1110/"]', 'safe("log.component", "") == "ACCESS" && safe("log.message", "").contains("SCRAM") && (safe("log.message", "").contains("authentication failed") || safe("log.message", "").contains("storedKey mismatch") || safe("log.message", "").contains("AuthenticationFailed")) && safe("origin.ip", "") != ""', '2025-09-03 15:50:22.889627', true, false, 'origin', NULL, '[{"indexPattern":"v11-log-mongodb-*","with":[{"field":"origin.ip.keyword","operator":"filter_term","value":"{{.origin.ip}}"},{"field":"log.component.keyword","operator":"filter_term","value":"ACCESS"},{"field":"log.message","operator":"filter_match","value":"authentication failed"}],"or":null,"within":"now-10m","count":5}]');
INSERT INTO public.utm_correlation_rules VALUES (722, 'MongoDB Stored JavaScript Execution', 3, 3, 2, 'Execution', 'T1059 - Command and Scripting Interpreter', 'Detects execution of stored JavaScript functions or server-side JavaScript which could be used for code injection attacks or unauthorized operations.

Next Steps:
1. Review the JavaScript code being executed to determine if it''s legitimate
2. Check the source IP and user account for signs of compromise
3. Audit recent changes to system.js collection for malicious stored procedures
4. Review MongoDB access logs for other suspicious activities from the same source
5. Consider disabling server-side JavaScript execution if not required
6. Implement strict access controls for JavaScript execution privileges
', '["https://www.mongodb.com/docs/manual/core/server-side-javascript/","https://attack.mitre.org/techniques/T1059/"]', 'safe("log.component", "") == "COMMAND" && (safe("log.message", "").contains("$where") || safe("log.message", "").contains("$function") || safe("log.message", "").contains("mapReduce") || safe("log.message", "").contains("system.js")) && safe("log.severity", "") != "low"', '2025-09-03 15:50:23.59679', true, false, 'origin', '["origin.host","origin.user"]', '[]');
INSERT INTO public.utm_correlation_rules VALUES (728, 'Suspicious Database Schema Changes', 2, 3, 2, 'Defense Evasion', 'T1070 - Indicator Removal on Host', 'Detects unauthorized or suspicious database schema modifications including table drops, alterations, or creation of potentially malicious objects. These changes could indicate an attacker attempting to hide their tracks, create backdoors, or damage the database structure.

Next Steps:
1. Identify the user account and source IP that made these schema changes
2. Review the specific DDL statements executed to understand the modifications
3. Check if these changes were authorized through proper change management procedures
4. Examine MySQL general and audit logs for additional suspicious activities from the same source
5. Verify database backups are current in case restoration is needed
6. Consider revoking DDL privileges from non-administrative accounts if unauthorized
', '["https://dev.mysql.com/doc/refman/8.0/en/sql-data-definition-statements.html","https://attack.mitre.org/techniques/T1070/","https://cloud.google.com/sql/docs/mysql/audit-logging"]', 'safe("log.msg", "") != "" && ( safe("log.msg", "").contains("DROP DATABASE") || safe("log.msg", "").contains("DROP TABLE") && !safe("log.msg", "").contains("IF EXISTS tmp_") || safe("log.msg", "").contains("DROP SCHEMA") || safe("log.msg", "").contains("TRUNCATE TABLE") || safe("log.msg", "").contains("ALTER TABLE") && (safe("log.msg", "").contains("DISABLE KEYS") || safe("log.msg", "").contains("DROP COLUMN") || safe("log.msg", "").contains("DROP CONSTRAINT")) || safe("log.msg", "").contains("CREATE TABLE") && (safe("log.msg", "").contains("BLACKHOLE") || safe("log.msg", "").contains("FEDERATED") || safe("log.msg", "").contains("CSV")) || safe("log.msg", "").contains("RENAME TABLE") || safe("log.msg", "").contains("CREATE DATABASE") && (safe("log.msg", "").contains("test") || safe("log.msg", "").contains("temp") || safe("log.msg", "").contains("tmp")) || safe("log.msg", "").contains("ALTER DATABASE") || safe("log.msg", "").contains("CREATE VIEW") && safe("log.msg", "").contains("mysql.") || safe("log.msg", "").contains("DROP VIEW") || safe("log.msg", "").contains("CREATE TRIGGER") || safe("log.msg", "").contains("DROP TRIGGER") || safe("log.msg", "").contains("CREATE EVENT") || safe("log.msg", "").contains("DROP EVENT") || safe("log.msg", "").contains("INFORMATION_SCHEMA") && (safe("log.msg", "").contains("UPDATE") || safe("log.msg", "").contains("DELETE")) || safe("log.errorCode", "") == "ER_CANT_CREATE_TABLE" || safe("log.errorCode", "") == "ER_CANT_DROP_FIELD_OR_KEY" )', '2025-09-03 15:51:49.807888', true, false, 'origin', '["origin.host"]', '[]');
INSERT INTO public.utm_correlation_rules VALUES (698, 'Grok Pattern Injection Attack', 2, 3, 2, 'Defense Evasion', 'T1027.006 - Obfuscated Files or Information: HTML Smuggling', 'Detects potential injection attacks through malicious Grok patterns that could lead to regex catastrophic backtracking, data exfiltration, or pattern manipulation.

Next Steps:
1. Review the specific Grok pattern that triggered the alert in the log message
2. Check if the pattern contains recursive expressions or dangerous regex constructs
3. Verify if the pattern was loaded from an unexpected location (e.g., /tmp/)
4. Review the pipeline configuration for unauthorized modifications
5. Check for any performance impacts or service disruptions
6. Investigate the source of the malicious pattern input
', '["https://www.elastic.co/guide/en/logstash/current/plugins-filters-grok.html","https://attack.mitre.org/techniques/T1027/006/"]', '(safe("log.component", "") == "logstash.filters.grok" || safe("log.component", "") == "logstash.filters") && safe("log.msg", "") != "" && ( (safe("log.msg", "").contains("pattern") && safe("log.msg", "").contains("timeout")) || (safe("log.msg", "").contains("regex") && safe("log.msg", "").contains("catastrophic")) || (safe("log.msg", "").contains("grok") && safe("log.msg", "").contains("failure") && safe("severity", "") == "high") || (safe("log.msg", "").contains("_grokparsefailure") && safe("log.msg", "").contains("malformed")) || (safe("log.msg", "").contains("pattern") && (safe("log.msg", "").contains("(?R)") || safe("log.msg", "").contains("(?P<") || safe("log.msg", "").contains("(?{") || safe("log.msg", "").contains("(?"))) || (safe("log.msg", "").contains("custom pattern") && safe("log.msg", "").contains("loaded") && safe("log.msg", "").contains("/tmp/")) || (safe("log.msg", "").contains("grok") && safe("log.msg", "").contains("expression") && safe("log.msg", "").contains("eval")) )', '2025-09-03 15:46:09.518767', true, false, 'origin', NULL, '[]');
INSERT INTO public.utm_correlation_rules VALUES (706, 'Logstash Plugin Installation Security Risk', 2, 3, 2, 'Execution, Lateral Movement', 'T1072 - Software Deployment Tools', 'Detects suspicious plugin installation activities in Logstash that could introduce vulnerabilities or backdoors into the data pipeline. Plugin installations can modify the behavior of data processing pipelines and potentially compromise data integrity or introduce security vulnerabilities.

Next Steps:
1. Verify if the plugin installation was authorized and scheduled
2. Review the plugin source and verify it''s from a trusted repository
3. Check plugin documentation for known vulnerabilities or security concerns
4. Examine recent configuration changes in Logstash pipelines
5. Verify the user/process that initiated the plugin installation
6. Review system logs for any unusual activity around the time of installation
7. Consider temporarily disabling the plugin until security review is complete
', '["https://www.elastic.co/guide/en/logstash/current/plugins.html","https://attack.mitre.org/techniques/T1072/"]', 'safe("log.component", "") == "pluginmanager" && safe("log.msg", "") != "" && (safe("log.msg", "").contains("install") || safe("log.msg", "").contains("update"))', '2025-09-03 15:46:34.717002', true, false, 'origin', NULL, '[]');
INSERT INTO public.utm_correlation_rules VALUES (699, 'HTTP Input Plugin Security Violation', 2, 2, 2, 'Initial Access', 'T1190 - Exploit Public-Facing Application', 'Detects potential security violations in Logstash HTTP input plugin including authentication bypasses, injection attempts, and DoS attacks.

Next Steps:
1. Identify the source IP/host attempting the malicious activity
2. Review recent HTTP input plugin logs for patterns of abuse
3. Check if authentication is properly configured on the HTTP input
4. Verify SSL/TLS certificates if HTTPS is being used
5. Consider implementing rate limiting or IP whitelisting
6. Review Logstash configuration for exposed endpoints
7. Check for any successful exploitation attempts following these failures
', '["https://www.elastic.co/guide/en/logstash/current/plugins-inputs-http.html","https://attack.mitre.org/techniques/T1190/"]', 'safe("log.component", "") == "logstash.inputs.http" && safe("log.level", "") != "" && (safe("log.msg", "") != "" && (safe("log.msg", "").contains("authentication failed") || safe("log.msg", "").contains("unauthorized") || safe("log.msg", "").contains("429") || safe("log.msg", "").contains("queue full") || safe("log.msg", "").contains("backpressure") || safe("log.msg", "").contains("invalid request") || safe("log.msg", "").contains("malformed") || safe("log.msg", "").contains("<script") || safe("log.msg", "").contains("SELECT ") || safe("log.msg", "").contains("UNION ") || safe("log.msg", "").contains("DROP ") || safe("log.msg", "").contains("exec(") || safe("log.msg", "").contains("system(") || safe("log.msg", "").contains("eval(")) || safe("log.level", "") == "ERROR" || safe("log.level", "") == "FATAL")', '2025-09-03 15:46:10.05327', true, false, 'origin', '["origin.host","origin.ip"]', '[]');
INSERT INTO public.utm_correlation_rules VALUES (700, 'JDBC Input SQL Injection Attempt', 3, 3, 2, 'Initial Access', 'SQL Injection', 'Detects SQL injection attempts and database security violations in Logstash JDBC input plugin operations. This rule monitors for common SQL injection patterns, authentication failures, and permission denials that could indicate an attacker attempting to manipulate database queries through the JDBC input plugin.

Next Steps:
1. Review the specific log message to identify the exact SQL injection pattern or error
2. Check the JDBC input configuration to ensure proper query parameterization
3. Verify that database user permissions are correctly restricted
4. Investigate the source of the suspicious queries if possible
5. Review recent database activity logs for any unauthorized access or data manipulation
6. Consider implementing input validation and query whitelisting in the JDBC configuration
', '["https://www.elastic.co/guide/en/logstash/current/plugins-inputs-jdbc.html","https://attack.mitre.org/techniques/T1190/","https://cwe.mitre.org/data/definitions/89.html"]', 'safe("log.component", "") == "logstash.inputs.jdbc" && safe("log.msg", "") != "" && ( safe("log.msg", "").contains("SELECT") || safe("log.msg", "").contains("INSERT") || safe("log.msg", "").contains("UPDATE") || safe("log.msg", "").contains("DELETE") || safe("log.msg", "").contains("DROP") || safe("log.msg", "").contains("CREATE") || safe("log.msg", "").contains("ALTER") || safe("log.msg", "").contains("UNION") || safe("log.msg", "").contains("'' OR ") || safe("log.msg", "").contains("\" OR ") || safe("log.msg", "").contains("1=1") || safe("log.msg", "").contains("1'' = ''1") || safe("log.msg", "").contains("--") || safe("log.msg", "").contains("/*") || safe("log.msg", "").contains("*/") || safe("log.msg", "").contains("xp_") || safe("log.msg", "").contains("sp_") || safe("log.msg", "").contains("exec ") || safe("log.msg", "").contains("execute ") || safe("log.msg", "").contains("cast(") || safe("log.msg", "").contains("convert(") || safe("log.msg", "").contains("concat(") || safe("log.msg", "").contains("authentication failed") || safe("log.msg", "").contains("access denied") || safe("log.msg", "").contains("permission denied") || (safe("log.level", "") != "" && (safe("log.level", "") == "ERROR" || safe("log.level", "") == "FATAL")) )', '2025-09-03 15:46:31.578414', true, false, 'origin', '["origin.host","log.pipelineName"]', '[]');
INSERT INTO public.utm_correlation_rules VALUES (701, 'Logstash Keystore Security Breach Attempt', 3, 3, 2, 'Credential Access', 'T1555 - Credentials from Password Stores', 'Detects suspicious activities related to Logstash keystore access, including failed authentication attempts, keystore file access errors, or attempts to read encrypted credentials. This could indicate an attacker trying to access stored credentials or configuration secrets.

Next Steps:
1. Identify the source of the keystore access attempts by checking the origin host and component
2. Review the Logstash configuration files for any unauthorized modifications
3. Check if the keystore file permissions have been altered
4. Verify if any credentials stored in the keystore have been compromised
5. Review authentication logs for the affected system to identify potential unauthorized access
6. Consider rotating any credentials stored in the affected keystore
7. Implement additional access controls and monitoring for keystore operations
', '["https://www.elastic.co/guide/en/logstash/current/keystore.html","https://attack.mitre.org/techniques/T1555/"]', 'safe("log.component", "") in ["logstash.runner", "logstash.config.source.local.configpathloader"] && safe("log.msg", "") != "" && safe("log.msg", "").contains("keystore") && ( safe("log.msg", "").contains("failed") || safe("log.msg", "").contains("error") || safe("log.msg", "").contains("denied") || safe("log.msg", "").contains("Cannot evaluate") ) && safe("log.level", "") in ["ERROR", "FATAL", "WARN"]', '2025-09-03 15:46:32.192394', true, false, 'origin', '["origin.host","log.component"]', '[{"indexPattern":"v11-log-logstash-*","with":[{"field":"origin.host.keyword","operator":"filter_term","value":"{{.origin.host}}"}],"or":null,"within":"now-5m","count":3}]');
INSERT INTO public.utm_correlation_rules VALUES (957, 'System Linux: Reverse Shell Created via Named Pipe', 3, 2, 3, 'Execution', 'Unix Shell', 'Identifies a reverse shell via the abuse of named pipes on Linux with the help of OpenSSL or Netcat. First in, first out (FIFO) files are special files for reading and writing to by Linux processes. For this to work, a named pipe is created and passed to a Linux shell where the use of a network connection tool such as Netcat or OpenSSL has been established. The stdout and stderr are captured in the named pipe from the network connection and passed back to the shell for execution.', '["https://attack.mitre.org/tactics/TA0002/","https://attack.mitre.org/techniques/T1059/004/"]', 'safe("log.message", "").matches("((sh|bash|openssl) (-i|-connect))")', '2025-09-03 16:37:51.953239', true, false, 'origin', NULL, '[{"indexPattern":"v11-log-linux-*","with":[{"field":"log.message.keyword","operator":"filter_term","value":"(nc|ncat|netcat|netcat.openbsd|netcat.traditional|openssl)"},{"field":"log.host.id.keyword","operator":"filter_term","value":"{{.log.host.id}}"}],"or":null,"within":"now-5m","count":1}]');
INSERT INTO public.utm_correlation_rules VALUES (705, 'Logstash Pipeline Reloading Security Event', 1, 3, 3, 'Impact', 'T1489 - Service Stop', 'Detects suspicious pipeline reloading patterns that could indicate attempts to inject malicious configurations or disrupt log processing. This rule triggers when multiple pipeline reload errors occur within a short time window, which may indicate configuration tampering or service disruption attempts.

Next Steps:
1. Review the Logstash configuration files for recent unauthorized changes
2. Check the pipeline configuration directory for suspicious modifications
3. Verify if the reload attempts correlate with legitimate administrative actions
4. Review system access logs to identify who initiated the pipeline changes
5. Examine the specific error messages to understand the nature of the reload failures
6. Consider temporarily disabling automatic pipeline reloading if malicious activity is confirmed
7. Check for any injected pipeline configurations that could compromise log integrity
8. Investigate network connections from the affected Logstash instance
9. Review authentication logs for the Logstash service account
10. Check for file integrity monitoring alerts on Logstash configuration directories
', '["https://www.elastic.co/guide/en/logstash/current/reloading-config.html","https://attack.mitre.org/techniques/T1489/"]', 'safe("log.component", "") != "" && (safe("log.component", "").contains("pipeline") || safe("log.component", "").contains("reload")) && safe("log.msg", "") != "" && (safe("log.msg", "").contains("reload") || safe("log.msg", "").contains("restart") || safe("log.msg", "").contains("shutdown")) && safe("log.level", "") == "ERROR"', '2025-09-03 15:46:34.245138', true, false, 'origin', NULL, '[]');
INSERT INTO public.utm_correlation_rules VALUES (707, 'Ruby Filter Code Execution Attack', 3, 3, 3, 'Execution', 'T1059.004 - Command and Scripting Interpreter: Unix Shell', 'Detects malicious Ruby code execution attempts through the Ruby filter plugin that could lead to system compromise, data theft, or unauthorized access. This rule monitors for dangerous Ruby methods and patterns that could indicate an attacker is attempting to execute system commands, access files, or establish network connections through the Ruby filter.

Next Steps:
1. Immediately isolate the affected Logstash instance to prevent further compromise
2. Review the Ruby filter configuration in your Logstash pipelines for any unauthorized modifications
3. Check system logs for any successful command executions or file access attempts
4. Examine network connections from the Logstash process for suspicious outbound connections
5. Review recent configuration changes and audit who has access to modify Logstash configurations
6. Consider disabling the Ruby filter plugin if not strictly necessary for your use case
7. Implement strict input validation and sandboxing for any Ruby code execution
', '["https://www.elastic.co/guide/en/logstash/current/plugins-filters-ruby.html","https://attack.mitre.org/techniques/T1059/004/"]', '(safe("log.component", "") == "logstash.filters.ruby" || safe("log.component", "") == "logstash.filters" || safe("log.component", "") == "logstash.pipeline") && safe("log.msg", "") != "" && ( (safe("log.msg", "").contains("ruby") && (safe("log.msg", "").contains("exec") || safe("log.msg", "").contains("system") || safe("log.msg", "").contains("eval") || safe("log.msg", "").contains("`"))) || (safe("log.msg", "").contains("ruby") && (safe("log.msg", "").contains("File.") || safe("log.msg", "").contains("IO.") || safe("log.msg", "").contains("Open3") || safe("log.msg", "").contains("Kernel."))) || (safe("log.msg", "").contains("ruby") && (safe("log.msg", "").contains("require") || safe("log.msg", "").contains("load")) && (safe("log.msg", "").contains("/tmp/") || safe("log.msg", "").contains("http://") || safe("log.msg", "").contains("https://"))) || (safe("log.msg", "").contains("ruby") && safe("log.msg", "").contains("exception") && (safe("log.msg", "").contains("SecurityError") || safe("log.msg", "").contains("LoadError"))) || (safe("log.msg", "").contains("ruby") && (safe("log.msg", "").contains("socket") || safe("log.msg", "").contains("net/http") || safe("log.msg", "").contains("open-uri"))) || (safe("log.msg", "").contains("ruby") && safe("log.msg", "").contains("code") && (safe("log.msg", "").contains("ENV[") || safe("log.msg", "").contains("@@") || safe("log.msg", "").contains("$"))) || (safe("log.msg", "").contains("script_error") && safe("log.msg", "").contains("ruby")) || (safe("log.msg", "").contains("ruby") && safe("log.msg", "").contains("thread") && safe("log.msg", "").contains("unsafe")) )', '2025-09-03 15:46:35.163519', true, false, 'origin', NULL, '[]');
INSERT INTO public.utm_correlation_rules VALUES (735, 'MySQL Plugin Installation Detection', 3, 3, 3, 'Persistence', 'T1505 - Server Software Component', 'Detects plugin installation attempts in MySQL which could be used for persistence or to extend server functionality maliciously. MySQL plugins can provide backdoor access, enable data exfiltration, or modify server behavior.

Next Steps:
1. Review the plugin name and library file being loaded
2. Verify if this plugin installation was authorized and expected
3. Check the source of the plugin library file (.so/.dll)
4. Review MySQL user privileges and who executed the INSTALL PLUGIN command
5. Examine MySQL general and error logs for related suspicious activities
6. Consider reviewing recently modified files in the MySQL plugin directory
7. If unauthorized, immediately uninstall the plugin and investigate potential compromise
', '["https://dev.mysql.com/doc/refman/8.0/en/server-plugin-loading.html","https://attack.mitre.org/techniques/T1505/"]', 'safe("log.msg", "") != "" && (safe("log.msg", "").contains("INSTALL PLUGIN") || safe("log.msg", "").contains("plugin") && (safe("log.msg", "").contains("loaded") || safe("log.msg", "").contains("installed")) || safe("log.msg", "").contains("library") && safe("log.msg", "").contains(".so") || safe("log.msg", "").contains("library") && safe("log.msg", "").contains(".dll") || safe("log.msg", "").contains("UNINSTALL PLUGIN") || safe("log.subsystem", "") == "Plugin" || safe("log.errorCode", "") == "MY-013129")', '2025-09-03 15:52:22.206711', true, false, 'origin', '["origin.host","log.msg"]', '[]');
INSERT INTO public.utm_correlation_rules VALUES (709, 'MongoDB Authentication Bypass Attempts', 3, 3, 2, 'Defense Evasion, Persistence, Privilege Escalation, Initial Access', 'T1078 - Valid Accounts', 'Detects multiple failed authentication attempts followed by a successful login from the same source, which may indicate authentication bypass or brute force attempts that succeeded.

Next Steps:
1. Review the source IP/hostname for legitimacy
2. Check if the successful authentication was for a privileged account
3. Examine MongoDB audit logs for any unauthorized database operations following the successful login
4. Verify if the authentication pattern matches known user behavior
5. Consider blocking the source IP if confirmed malicious
6. Reset credentials for affected accounts if compromise is suspected
7. Review MongoDB configuration for security weaknesses
8. Check for any privilege escalation attempts post-authentication
', '["https://www.mongodb.com/docs/manual/reference/log-messages/","https://attack.mitre.org/techniques/T1078/"]', 'safe("log.component", "") == "ACCESS" && safe("log.message", "").contains("Authentication") && (safe("log.message", "").contains("failed") || safe("log.message", "").contains("unsuccessful")) && safe("origin.host", "") != ""', '2025-09-03 15:49:19.900514', true, false, 'origin', '["origin.host","origin.user"]', '[{"indexPattern":"v11-log-mongodb-*","with":[{"field":"origin.host.keyword","operator":"filter_term","value":"{{.origin.host}}"},{"field":"log.message","operator":"filter_match","value":"Authentication successful"}],"or":null,"within":"now-5m","count":1}]');
INSERT INTO public.utm_correlation_rules VALUES (710, 'MongoDB BSON Injection Attack Pattern', 3, 3, 1, 'Initial Access', 'T1190 - Exploit Public-Facing Application', 'Detects potential BSON injection attempts through malformed queries, special operators abuse, or type confusion attacks. These attacks attempt to manipulate MongoDB queries by injecting malicious BSON operators or exploiting type conversions.

Next Steps:
1. Review the query that triggered this alert to identify the injection pattern
2. Check the source IP/host for other suspicious MongoDB query activity
3. Verify if the query succeeded and what data may have been accessed
4. Review application logs for corresponding user activity
5. Consider blocking the source IP if confirmed malicious
6. Update application input validation to prevent BSON injection
', '["https://www.mongodb.com/docs/manual/reference/bson-types/","https://attack.mitre.org/techniques/T1190/"]', 'safe("log.component", "") == "QUERY" && (safe("log.message", "").contains("$ne") || safe("log.message", "").contains("$gt") || safe("log.message", "").contains("$regex") || safe("log.message", "").contains("$where") || safe("log.message", "").contains("{$") || safe("log.message", "").contains("null}"))', '2025-09-03 15:49:20.414048', true, false, 'origin', NULL, '[]');
INSERT INTO public.utm_correlation_rules VALUES (711, 'MongoDB Change Stream Unauthorized Access', 3, 2, 1, 'Defense Evasion, Persistence, Privilege Escalation, Initial Access', 'T1078 - Valid Accounts', 'Detects unauthorized access to MongoDB change streams which could indicate attempts to monitor database activity or exfiltrate data in real-time. Change streams provide real-time notifications of data modifications and unauthorized access could allow attackers to monitor sensitive database operations.

Next Steps:
1. Identify the source of the unauthorized access attempt (check origin.host and origin.ip)
2. Review MongoDB authentication logs for failed login attempts from the same source
3. Check if the user account associated with the attempt has appropriate permissions
4. Review recent database changes and sensitive data access from this source
5. Consider blocking the source IP if malicious activity is confirmed
6. Review and strengthen MongoDB change stream permissions and authentication
7. Analyze MongoDB logs for patterns of change stream access attempts
8. Verify if the accessing application/user should have change stream permissions
', '["https://www.mongodb.com/docs/manual/changestreams/","https://attack.mitre.org/techniques/T1078/"]', 'safe("log.component", "") == "COMMAND" && safe("log.message", "").contains("changeStream") && (safe("log.severity", "") == "medium" || safe("log.context", "").contains("unauthorized") || safe("log.message", "").contains("unauthorized") || safe("log.message", "").contains("access denied"))', '2025-09-03 15:49:20.87619', true, false, 'origin', '["origin.host","origin.user"]', '[]');
INSERT INTO public.utm_correlation_rules VALUES (712, 'MongoDB Collection Dropping Attempts', 1, 3, 3, 'Impact', 'Data Destruction', 'Detects attempts to drop collections or databases which could indicate destructive attacks or ransomware behavior. This includes drop commands for collections, databases, and indexes.

Next Steps:
- Immediately verify if the drop operation was authorized by checking with the database administrator
- Check the user account that executed the drop command for signs of compromise
- Review MongoDB access logs for other suspicious activities from the same source
- Verify if proper backups exist for the dropped collections/databases
- Check for patterns of multiple drop operations across different databases
- Investigate any unusual authentication or connection events prior to the drop
- If unauthorized, consider disabling the account and restoring from backups
', '["https://www.mongodb.com/docs/manual/reference/log-messages/","https://attack.mitre.org/techniques/T1485/"]', 'safe("log.component", "") in ["COMMAND", "STORAGE"] && safe("log.severity", "") in ["high", "medium"] && (safe("log.message", "").contains("drop") || safe("log.message", "").contains("dropDatabase") || safe("log.message", "").contains("dropCollection") || safe("log.message", "").contains("db.dropDatabase") || safe("log.message", "").contains(".drop()") || safe("log.message", "").contains("dropIndexes") || safe("log.message", "").contains("command drop")) && safe("origin.host", "") != ""', '2025-09-03 15:49:21.394166', true, false, 'origin', '["origin.host","origin.user"]', '[]');
INSERT INTO public.utm_correlation_rules VALUES (713, 'MongoDB Connection Pool Exhaustion', 1, 1, 3, 'Impact', 'T1499: Network Denial of Service', 'Detects MongoDB connection pool exhaustion events which could indicate a denial of service attack or misconfigured clients overwhelming the database with connections. This can prevent legitimate users from accessing the database.

Next Steps:
1. Check the current number of active connections using db.serverStatus().connections
2. Review the MongoDB logs to identify the source IPs creating excessive connections
3. Verify the maxIncomingConnections setting in MongoDB configuration
4. Check if specific applications or services are misconfigured and creating connection leaks
5. Consider implementing connection pooling limits at the application level
6. Review network access controls to ensure only authorized hosts can connect
7. Monitor connection metrics to establish baseline patterns for future detection
', '["https://www.mongodb.com/docs/manual/administration/connection-pool-overview/","https://www.mongodb.com/docs/manual/tutorial/connection-pool-performance-tuning/","https://attack.mitre.org/techniques/T1499/"]', 'safe("log.component", "") == "NETWORK" && safe("log.severity", "") == "high" && ( safe("log.message", "").contains("connection refused because too many open connections") || safe("log.message", "").contains("pool has been closed") || safe("log.message", "").contains("MaxConnectionPoolSize") && safe("log.message", "").contains("exceeded") || safe("log.message", "").contains("numOpenConns") && safe("log.message", "").contains("limit") )', '2025-09-03 15:49:21.832852', true, false, 'origin', NULL, '[{"indexPattern":"v11-log-mongodb-*","with":[{"field":"origin.host.keyword","operator":"filter_term","value":"{{.origin.host}}"},{"field":"log.component.keyword","operator":"filter_term","value":"NETWORK"}],"or":null,"within":"now-5m","count":10}]');
INSERT INTO public.utm_correlation_rules VALUES (714, 'MongoDB Database Enumeration', 3, 1, 1, 'Discovery', 'T1082 - System Information Discovery', 'Detects enumeration activities such as listing databases, collections, or excessive metadata queries that may indicate reconnaissance activities.

Next Steps:
1. Verify if the source IP/host is authorized to perform database enumeration
2. Check if this is part of legitimate administrative activity or automated monitoring
3. Review the user account associated with these queries
4. Look for subsequent data access or exfiltration attempts from the same source
5. Check for other discovery activities from the same origin in other systems
6. Consider implementing access controls to limit metadata queries if unauthorized
7. Review MongoDB access logs for the time period around this alert
8. Check if the enumeration commands were successful or resulted in errors
', '["https://www.mongodb.com/docs/manual/reference/log-messages/","https://attack.mitre.org/techniques/T1082/"]', 'safe("log.component", "") in ["COMMAND", "QUERY", "ACCESS"] && (safe("log.message", "").contains("listDatabases") || safe("log.message", "").contains("listCollections") || safe("log.message", "").contains("getCollectionInfos") || safe("log.message", "").contains("show dbs") || safe("log.message", "").contains("show collections") || safe("log.message", "").contains("db.getCollectionNames") || safe("log.message", "").contains("db.getMongo") || safe("log.message", "").contains("db.adminCommand") || safe("log.message", "").contains("serverStatus") || safe("log.message", "").contains("buildInfo") || safe("log.message", "").contains("hostInfo"))', '2025-09-03 15:49:22.24343', true, false, 'origin', '["origin.host"]', '[]');
INSERT INTO public.utm_correlation_rules VALUES (715, 'MongoDB Suspicious Index Manipulation', 2, 3, 3, 'Impact', 'T1485 - Data Destruction', 'Detects suspicious index creation, modification, or deletion operations that could impact database performance or hide malicious activity. Multiple index operations in a short time window may indicate an attempt to degrade database performance or manipulate query results.

Next Steps:
1. Review the index operations to determine if they are authorized
2. Check the user account performing these operations for legitimacy
3. Examine the affected collections and indexes for data integrity
4. Look for any performance degradation or unusual query patterns
5. Verify if these changes align with scheduled maintenance windows
6. Contact the database administrator to confirm if these operations were planned
', '["https://www.mongodb.com/docs/manual/indexes/","https://attack.mitre.org/techniques/T1485/"]', 'safe("log.component", "") == "INDEX" && (safe("log.message", "").contains("dropIndexes") || safe("log.message", "").contains("createIndexes") || safe("log.message", "").contains("reIndex")) && safe("log.severity", "") == "high"', '2025-09-03 15:49:22.949539', true, false, 'origin', '["origin.host","log.ns"]', '[{"indexPattern":"v11-log-mongodb-*","with":[{"field":"origin.host.keyword","operator":"filter_term","value":"{{.origin.host}}"},{"field":"log.component.keyword","operator":"filter_term","value":"INDEX"}],"or":null,"within":"now-30m","count":5}]');
INSERT INTO public.utm_correlation_rules VALUES (774, 'Lua Script Injection Attempt', 3, 3, 2, 'Execution', 'T1059 - Command and Scripting Interpreter', 'Detects potential Lua script injection attempts through malicious input patterns in requests that could be processed by Nginx Lua modules, potentially leading to remote code execution.

Next Steps:
1. Review the source IP address and check if it''s known or trusted
2. Examine the full request details to understand the injection attempt
3. Check if your Nginx configuration uses Lua modules (openresty/lua-nginx-module)
4. Review Nginx error logs for any script execution errors
5. Block the source IP if confirmed malicious
6. Update WAF rules to prevent similar injection attempts
7. Consider disabling unnecessary Lua functionality if not required
', '["https://github.com/openresty/lua-nginx-module#security-considerations","https://attack.mitre.org/techniques/T1059/"]', '(safe("origin.path", "").contains("lua") || (safe("log.request", "").contains("_by_lua") || (safe("log.message", "").contains("lua")) && (safe("log.request", "").contains("os.execute") || (safe("log.request", "").contains("io.popen") || (safe("log.request", "").contains("loadstring") || (safe("log.request", "").contains("require") || (safe("origin.path", "").contains("../") || (safe("log.referrer", "").contains("os.execute"))', '2025-09-03 15:59:23.48608', true, false, 'origin', NULL, '[]');
INSERT INTO public.utm_correlation_rules VALUES (716, 'MongoDB Injection Attack Patterns', 3, 3, 2, 'Initial Access', 'T1190 - Exploit Public-Facing Application', 'Detects potential MongoDB injection attempts through suspicious query patterns including $where, $function, mapReduce operations, or malicious operators that may contain arbitrary JavaScript code execution. These patterns often indicate attempts to execute code, bypass authentication mechanisms, or perform unauthorized data access.

Next Steps:
- Review the source IP address and check if it''s from a known legitimate application or user
- Examine the full query to understand the attempted injection pattern and payload
- Check if the query was successful or resulted in an error response
- Look for other suspicious activities from the same source IP in recent timeframes
- Verify if any sensitive data was accessed, modified, or exfiltrated
- Consider blocking the source IP if confirmed malicious activity
- Review application code for proper input validation and parameterized queries
- Check MongoDB security configuration and access controls
- Monitor for privilege escalation attempts or lateral movement
', '["https://www.mongodb.com/docs/manual/reference/log-messages/","https://attack.mitre.org/techniques/T1190/","https://owasp.org/www-project-web-security-testing-guide/v41/4-Web_Application_Security_Testing/07-Input_Validation_Testing/05.6-Testing_for_NoSQL_Injection"]', 'safe("log.component", "") in ["QUERY", "COMMAND"] && (safe("log.message", "").contains("$where") || safe("log.message", "").contains("$function") || safe("log.message", "").contains("mapReduce") || safe("log.message", "").contains("eval") || safe("log.message", "").contains("$regex") || safe("log.message", "").contains("function()") || safe("log.message", "").contains("this.") || safe("log.message", "").contains("db.eval") || safe("log.message", "").contains("$ne") || safe("log.message", "").contains("$gt") || safe("log.message", "").contains("$gte") || safe("log.message", "").contains("$lt") || safe("log.message", "").contains("$lte") || safe("log.message", "").contains("$or") || safe("log.message", "").contains("$nor") || safe("log.message", "").contains("$exists"))', '2025-09-03 15:49:23.805481', true, false, 'origin', NULL, '[]');
INSERT INTO public.utm_correlation_rules VALUES (717, 'MongoDB Kerberos Authentication Failures', 3, 2, 2, 'Credential Access', 'T1110.001 - Brute Force: Password Guessing', 'Detects Kerberos authentication failures in MongoDB which could indicate brute force attempts, misconfigured Kerberos settings, or attempts to compromise service accounts. Monitors for GSSAPI errors, time skew issues, and invalid credentials.

Next Steps:
1. Review the authentication logs to identify the source IP and service principal attempting authentication
2. Check if the time skew errors indicate system clock synchronization issues between MongoDB server and KDC
3. Verify the Kerberos keytab file permissions and validity if keytab errors are present
4. Review the service principal name (SPN) configuration if SPN errors are detected
5. Check for patterns of failed authentication attempts from the same source
6. Investigate if legitimate service accounts are being targeted
7. Review MongoDB server Kerberos configuration for any misconfigurations
', '["https://www.mongodb.com/docs/manual/tutorial/troubleshoot-kerberos/","https://attack.mitre.org/techniques/T1110/001/"]', 'safe("log.component", "") == "ACCESS" && (safe("log.severity", "") == "error" || safe("log.severity", "") == "warning") && ( (safe("log.message", "").contains("GSSAPI") && safe("log.message", "").contains("error")) || (safe("log.message", "").contains("Kerberos") && safe("log.message", "").contains("authentication") && safe("log.message", "").contains("failed")) || (safe("log.message", "").contains("security context") && safe("log.message", "").contains("negotiation") && safe("log.message", "").contains("failed")) || (safe("log.message", "").contains("time") && safe("log.message", "").contains("skew") && safe("log.message", "").contains("detected")) || (safe("log.message", "").contains("KRB5") && safe("log.message", "").contains("error")) || (safe("log.message", "").contains("invalid") && safe("log.message", "").contains("keytab")) || (safe("log.message", "").contains("service") && safe("log.message", "").contains("principal") && safe("log.message", "").contains("not") && safe("log.message", "").contains("found")) )', '2025-09-03 15:49:24.478852', true, false, 'origin', NULL, '[{"indexPattern":"v11-log-mongodb-*","with":[{"field":"origin.host.keyword","operator":"filter_term","value":"{{.origin.host}}"},{"field":"log.component.keyword","operator":"filter_term","value":"ACCESS"}],"or":null,"within":"now-1h","count":5}]');
INSERT INTO public.utm_correlation_rules VALUES (748, 'NATS Configuration Reload Attack Detection', 2, 3, 3, 'Impact', 'T1489 - Service Stop', 'Detects suspicious configuration reload attempts that could be used to modify server behavior, inject malicious settings, or cause service disruption. Frequent reloads may indicate an attack or misconfiguration.

Next Steps:
- Review the configuration reload events to determine if they were authorized
- Check the timing and frequency of reloads - multiple reloads in a short time period are suspicious
- Verify the source of the reload commands (user, process, or system)
- Review NATS server logs for any configuration errors or warnings following the reload
- Check if any configuration files were modified before the reload
- Look for other suspicious activities from the same host around the time of the reloads
- Verify that configuration management procedures were followed
', '["https://docs.nats.io/running-a-nats-service/configuration","https://attack.mitre.org/techniques/T1489/"]', 'safe("log.message", "").contains("configuration reload") || safe("log.message", "").contains("config reload") || safe("log.message", "").contains("SIGHUP") || safe("log.message", "").contains("reloading config") || (safe("action", "") == "nats.log" && safe("log.message", "").contains("reload"))', '2025-09-03 15:57:07.809568', true, false, 'origin', NULL, '[{"indexPattern":"v11-log-nats-*","with":[{"field":"origin.host.keyword","operator":"filter_term","value":"{{.origin.host}}"}],"or":null,"within":"now-5m","count":3}]');
INSERT INTO public.utm_correlation_rules VALUES (736, 'Prepared Statement Bypass Attempt', 3, 3, 1, 'Initial Access', 'T1190 - Exploit Public-Facing Application', 'Detects attempts to bypass or manipulate prepared statements which could indicate SQL injection attempts. Monitors for errors related to PREPARE, EXECUTE, and DEALLOCATE statements, as well as parameter binding issues that might indicate attempts to exploit prepared statement vulnerabilities.

Next Steps:
1. Identify the source IP and user account associated with the prepared statement errors
2. Review the application logs to understand the context of the failed prepared statements
3. Check if the error patterns match known SQL injection techniques
4. Analyze the SQL queries being attempted for malicious patterns
5. Review database access logs for any successful unauthorized queries from the same source
6. Consider temporarily blocking the source IP if multiple attempts are detected
7. Audit the application code for proper prepared statement usage and parameter binding
', '["https://dev.mysql.com/doc/refman/8.0/en/sql-prepared-statements.html","https://www.securityjourney.com/post/how-to-prevent-sql-injection-vulnerabilities-how-prepared-statements-work","https://attack.mitre.org/techniques/T1190/"]', 'safe("log.level", "") == "ERROR" && safe("log.msg", "") != "" && ( safe("log.msg", "").contains("PREPARE") || safe("log.msg", "").contains("EXECUTE") || safe("log.msg", "").contains("DEALLOCATE") || safe("log.msg", "").contains("prepared statement") || safe("log.msg", "").contains("parameter") || safe("log.msg", "").contains("placeholder") ) && ( safe("log.msg", "").contains("Incorrect arguments") || safe("log.msg", "").contains("parameter count mismatch") || safe("log.msg", "").contains("Unknown prepared statement") || safe("log.msg", "").contains("Can''t create more than max_prepared_stmt_count") || safe("log.msg", "").contains("Statement not found") || safe("log.msg", "").contains("syntax error") || safe("log.msg", "").contains("denied") || safe("log.msg", "").contains("type mismatch") || safe("log.msg", "").contains("Invalid parameter") || safe("log.errorCode", "") != "" )', '2025-09-03 15:52:22.554757', true, false, 'origin', '["origin.host","origin.user"]', '[]');
INSERT INTO public.utm_correlation_rules VALUES (878, 'JSON Memory Exhaustion Attack', 1, 1, 3, 'Impact', 'T1499.001 - Endpoint Denial of Service: OS Exhaustion Flood', 'Detects attempts to exhaust system memory through malicious JSON payloads. This includes extremely large JSON documents, deeply nested structures, or patterns that cause excessive memory allocation during parsing.

Next Steps:
1. Review the JSON payload size and structure in the logs
2. Check system memory usage and application performance metrics
3. Examine the source IP for other memory exhaustion attempts
4. Implement JSON parsing limits and validate input size restrictions
5. Monitor for subsequent attacks from the same source
6. Consider blocking the source IP if attacks persist
', '["https://cloud.google.com/dataflow/docs/guides/common-errors","https://attack.mitre.org/techniques/T1499/001/"]', '(safe("log.error", "").contains("out of memory") || safe("log.error", "").contains("memory exhausted") || safe("log.error_type", "") == "OOM" || safe("log.error_type", "") == "OutOfMemoryError" || safe("log.memory_usage_percent", 0) > 90 || safe("log.json_size_bytes", 0) > 104857600 || (safe("log.gc_thrashing", false) == true && safe("log.component", "") == "json_parser") || safe("log.message", "").contains("GC thrashing") || safe("log.allocation_failure", "") == "json_parse")', '2025-09-03 16:29:38.002955', true, false, 'origin', NULL, '[]');
INSERT INTO public.utm_correlation_rules VALUES (718, 'MongoDB LDAP Injection Attempts', 3, 3, 1, 'Initial Access', 'T1190 - Exploit Public-Facing Application: LDAP Injection', 'Detects potential LDAP injection attempts in MongoDB authentication. Monitors for malformed LDAP queries, special characters in authentication requests, and suspicious patterns that could indicate attempts to bypass authentication or extract unauthorized information.

Next Steps:
1. Immediately review the source IP address and check if it''s from a known legitimate source
2. Examine the full LDAP query in the MongoDB logs to identify the injection pattern
3. Check if the authentication attempt was successful or failed
4. Review other authentication attempts from the same source IP in the last 24 hours
5. If injection is confirmed, block the source IP at the firewall level
6. Review application code for proper input validation and parameterized LDAP queries
7. Enable MongoDB audit logging if not already enabled to capture detailed authentication events
8. Consider implementing IP whitelisting for LDAP authentication if feasible
', '["https://www.mongodb.com/docs/manual/core/security-ldap-external/","https://owasp.org/www-community/attacks/LDAP_Injection","https://attack.mitre.org/techniques/T1190/"]', 'safe("log.component", "") == "ACCESS" && ( (safe("log.message", "").contains("LDAP") && safe("log.message", "").contains("query") && safe("log.message", "").contains("error")) || (safe("log.message", "").contains("LDAP") && safe("log.message", "").contains("authentication") && safe("log.message", "").contains("failed")) || (safe("log.message", "").contains("invalid") && safe("log.message", "").contains("DN")) || (safe("log.message", "").contains("LDAP") && safe("log.message", "").contains("bind") && safe("log.message", "").contains("failed")) || (safe("log.message", "").contains("queryTemplate") && safe("log.message", "").contains("error")) || (safe("log.message", "").contains("LDAP") && (safe("log.message", "").contains("(") || safe("log.message", "").contains(")") || safe("log.message", "").contains("*") || safe("log.message", "").contains("\\") || safe("log.message", "").contains("="))) )', '2025-09-03 15:50:21.708454', true, false, 'origin', '["origin.ip"]', '[]');
INSERT INTO public.utm_correlation_rules VALUES (719, 'MongoDB Replica Set Poisoning Detection', 3, 3, 3, 'Impact', 'T1565 - Data Manipulation', 'Detects attempts to poison or manipulate MongoDB replica sets through unauthorized configuration changes, suspicious primary elections, or attempts to add malicious nodes to the replica set. This could lead to data corruption or unauthorized access.

Next Steps:
1. Verify if the replica set configuration changes were authorized
2. Check the authentication logs for the source IP/host that initiated the changes
3. Review the current replica set configuration using rs.status() and rs.conf()
4. Verify all replica set members are legitimate and authorized servers
5. Check for any data inconsistencies across replica set members
6. Review MongoDB audit logs for any suspicious database operations
7. Consider rolling back unauthorized configuration changes if detected
', '["https://www.mongodb.com/docs/manual/replication/","https://attack.mitre.org/techniques/T1565/"]', '(safe("log.component", "") == "REPL" && (safe("log.message", "").matches(".*replSetReconfig.*") || safe("log.message", "").matches(".*replSetInitiate.*")) || (safe("log.component", "") == "REPL" && safe("log.message", "").matches(".*priority.*") && safe("log.message", "").matches(".*changed.*") || (safe("log.component", "") == "REPL" && safe("log.message", "").matches(".*member.*added.*") && safe("severity", "") == "high") || (safe("log.component", "") == "REPL_HB" && safe("log.message", "").matches(".*authentication.*failed.*") || (safe("log.component", "") == "ELECTION" && safe("log.message", "").matches(".*unexpected.*primary.*") || (safe("log.component", "") == "REPL" && safe("log.message", "").matches(".*replSetStepDown.*") || (safe("log.component", "") == "NETWORK" && safe("log.message", "").matches(".*replica.*") && safe("log.message", "").matches(".*refused.*")', '2025-09-03 15:50:22.145106', true, false, 'origin', '["origin.host"]', '[]');
INSERT INTO public.utm_correlation_rules VALUES (720, 'MongoDB Role Privilege Escalation', 3, 3, 2, 'Defense Evasion, Persistence, Privilege Escalation, Initial Access', 'T1078 - Valid Accounts', 'Detects attempts to escalate privileges through role modifications, user creation with elevated privileges, or grant operations that may indicate unauthorized privilege escalation.

Next Steps:
1. Identify the user account that performed the privilege escalation operations
2. Review the specific roles and privileges that were granted or modified
3. Check if the user had legitimate authorization to perform these actions
4. Look for any newly created accounts with administrative privileges
5. Review MongoDB audit logs for the complete sequence of commands executed
6. Check for any suspicious database operations following the privilege changes
7. Verify if similar privilege escalation attempts occurred on other MongoDB instances
8. Consider revoking unauthorized privilege changes and disabling compromised accounts
', '["https://www.mongodb.com/docs/manual/reference/log-messages/","https://attack.mitre.org/techniques/T1078/"]', 'safe("log.component", "") in ["ACCESS", "COMMAND"] && (safe("log.message", "").contains("createRole") || safe("log.message", "").contains("updateRole") || safe("log.message", "").contains("grantPrivilegesToRole") || safe("log.message", "").contains("grantRolesToRole") || safe("log.message", "").contains("grantRolesToUser") || safe("log.message", "").contains("createUser") || safe("log.message", "").contains("updateUser") || safe("log.message", "").contains("db.grantRolesToUser") || safe("log.message", "").contains("db.createUser") || safe("log.message", "").contains("db.updateUser") || safe("log.message", "").contains("roles:" || safe("log.message", "").contains("root") || safe("log.message", "").contains("dbOwner") || safe("log.message", "").contains("userAdmin") || safe("log.message", "").contains("dbAdmin")', '2025-09-03 15:50:22.559109', true, false, 'origin', NULL, '[{"indexPattern":"v11-log-mongodb-*","with":[{"field":"origin.host.keyword","operator":"filter_term","value":"{{.origin.host}}"},{"field":"log.component.keyword","operator":"filter_term","value":"ACCESS"}],"or":null,"within":"now-30m","count":5}]');
INSERT INTO public.utm_correlation_rules VALUES (725, 'Character Set Encoding Attack Detection', 3, 3, 1, 'Defense Evasion, Privilege Escalation', 'Multi-byte Character Injection', 'Detects attempts to exploit character set encoding vulnerabilities in MySQL, including multi-byte character attacks, UTF-8 encoding bypasses, and character set switching attacks. These attacks can bypass input validation and SQL injection defenses by exploiting differences in how character encodings are interpreted.

Next Steps:
1. Review the MySQL error logs to identify the specific queries causing character set errors
2. Check if the source IP/host has legitimate reasons to use multiple character sets
3. Examine recent database schema changes or application updates that might affect character encoding
4. Review database connection settings and character set configurations
5. Look for patterns of SQL injection attempts that might be using encoding tricks
6. Consider implementing stricter character set validation at the application layer
7. Monitor for data exfiltration attempts following encoding errors
', '["https://dev.mysql.com/doc/refman/8.0/en/charset-unicode-sets.html","https://capec.mitre.org/data/definitions/80.html","https://attack.mitre.org/techniques/T1055/"]', 'safe("action", "") == "mysql.error" && safe("log.msg", "") != "" && ( safe("log.msg", "").contains("CHARACTER SET") || safe("log.msg", "").contains("CHARSET") || safe("log.msg", "").contains("COLLATE") || safe("log.msg", "").contains("utf8") || safe("log.msg", "").contains("UTF-8") || safe("log.msg", "").contains("latin1") || safe("log.msg", "").contains("gbk") || safe("log.msg", "").contains("big5") || safe("log.msg", "").contains("ucs2") || safe("log.msg", "").contains("utf16") || safe("log.msg", "").contains("utf32") || safe("log.msg", "").contains("CONVERT(") || safe("log.msg", "").contains("_charset") ) && ( safe("log.msg", "").contains("Illegal mix of collations") || safe("log.msg", "").contains("Invalid character string") || safe("log.msg", "").contains("Incorrect string value") || safe("log.msg", "").contains("Cannot convert string") || safe("log.msg", "").contains("character set mismatch") || safe("log.msg", "").contains("Invalid utf8") || safe("log.msg", "").contains("Malformed") || safe("log.msg", "").contains("encoding") || safe("log.msg", "").contains("denied") || safe("log.msg", "").contains("syntax error") || safe("severity", "") == "high" )', '2025-09-03 15:51:48.073918', true, false, 'origin', NULL, '[]');
INSERT INTO public.utm_correlation_rules VALUES (1472, 'Windows Defender: ERROR: REMOVE LOW MEDIUM DISABLED', 1, 2, 3, 'Potentially Compromised System', 'User Execution', 'Detects the ''REMOVE LOW MEDIUM DISABLED'' error event in Windows Defender, which may indicate issues with the removal process.', '["https://learn.microsoft.com/en-us/windows/security/threat-protection/windows-defender-antivirus/troubleshoot"]', 'safe("log.winlogEventDataLogName", "") == "Microsoft-Windows-Windows Defender/Operational" &&  safe("log.winlogEventDataErrorCode", "") == "0x80508027"', '2025-09-04 21:12:13.669735', true, false, 'target', NULL, '[]');
INSERT INTO public.utm_correlation_rules VALUES (723, 'MongoDB View Security Bypass Attempt', 3, 3, 1, 'Privilege Escalation, Defense Evasion', 'T1548 - Abuse Elevation Control Mechanism: View Security Bypass', 'Detects attempts to bypass view-level security restrictions or unauthorized access to views that could expose sensitive aggregated data. MongoDB views provide read-only access to data with predefined aggregation pipelines, and attempts to modify or create views with elevated permissions could indicate security bypass attempts.

Next Steps:
1. Review the user account that attempted the view operation - verify if they have legitimate permissions
2. Check the view definition being created/modified for potential security implications
3. Examine the aggregation pipeline in the view for unauthorized data access patterns
4. Review audit logs for any successful data access following view creation
5. Verify if the source IP/host is authorized for administrative operations
6. Check for any other suspicious activities from the same user or host
7. Consider temporarily revoking view creation privileges if unauthorized activity is confirmed
', '["https://www.mongodb.com/docs/manual/core/views/","https://attack.mitre.org/techniques/T1548/"]', 'safe("log.component", "") == "COMMAND" && (safe("log.message", "").contains("createView") || safe("log.message", "").contains("modifyView") || safe("log.message", "").contains("collMod")) && safe("log.ctx", "").contains("view") && safe("log.severity", "") != "low"', '2025-09-03 15:50:24.670171', true, false, 'origin', '["origin.host","origin.user","log.ctx","log.ns"]', '[{"indexPattern":"v11-log-mongodb-*","with":[{"field":"origin.host.keyword","operator":"filter_term","value":"{{.origin.host}}"},{"field":"log.component.keyword","operator":"filter_term","value":"COMMAND"}],"or":null,"within":"now-1h","count":3}]');
INSERT INTO public.utm_correlation_rules VALUES (724, 'MongoDB Wire Protocol Attack Attempts', 3, 3, 2, 'Credential Access, Collection', 'T1557 - Man-in-the-Middle', 'Detects potential attacks on MongoDB wire protocol including malformed requests, protocol violations, and suspicious socket-level activities that could indicate exploitation attempts or man-in-the-middle attacks.

Next Steps:
1. Identify the source IP address and investigate if it''s from a known or trusted location
2. Check MongoDB logs for any authentication failures or unusual connection patterns from the same source
3. Review network traffic for signs of packet injection or protocol manipulation
4. Verify MongoDB wire protocol encryption settings (TLS/SSL) are properly configured
5. Consider blocking the source IP if the activity is confirmed malicious
6. Check for any unauthorized database access or data exfiltration attempts
7. Update MongoDB to the latest version to patch any known wire protocol vulnerabilities
', '["https://www.mongodb.com/docs/manual/reference/mongodb-wire-protocol/","https://attack.mitre.org/techniques/T1557/"]', 'safe("log.component", "") == "NETWORK" && (safe("log.severity", "") == "high" || safe("log.severity", "") == "medium") && ( (safe("log.message", "").contains("wire protocol") && safe("log.message", "").contains("error")) || (safe("log.message", "").contains("socket") && safe("log.message", "").contains("exception")) || (safe("log.message", "").contains("protocol") && safe("log.message", "").contains("violation")) || (safe("log.message", "").contains("invalid") && safe("log.message", "").contains("opcode")) || (safe("log.message", "").contains("malformed") && safe("log.message", "").contains("request")) || (safe("log.message", "").contains("unexpected") && safe("log.message", "").contains("message") && safe("log.message", "").contains("format")) )', '2025-09-03 15:50:25.140967', true, false, 'origin', NULL, '[]');
INSERT INTO public.utm_correlation_rules VALUES (726, 'Common Table Expression (CTE) Attack Detection', 2, 2, 3, 'Initial Access', 'T1190 - Exploit Public-Facing Application', 'Detects potential attacks using Common Table Expressions (CTEs) including recursive CTEs that could be used for SQL injection, resource exhaustion, or unauthorized data access. Monitors for suspicious WITH and WITH RECURSIVE statements that may indicate malicious activity.

Next Steps:
1. Review the MySQL error logs to understand the full context of the CTE-related errors
2. Check if the source IP/user has legitimate reasons to execute complex CTE queries
3. Examine the full query text if available to determine if it contains malicious patterns
4. Look for other SQL injection indicators from the same source
5. Review database user permissions and consider restricting CTE usage if not required
6. Enable query logging if not already enabled to capture full query details
7. Consider implementing query timeout limits to prevent resource exhaustion attacks
8. Monitor for patterns of repeated CTE errors that may indicate automated attacks
9. Verify if the MySQL version supports CTEs and if they should be allowed
', '["https://dev.mysql.com/doc/refman/8.0/en/with.html","https://attack.mitre.org/techniques/T1190/","https://owasp.org/www-community/attacks/SQL_Injection"]', 'safe("log.msg", "") != "" && safe("log.level", "") == "error" && ( safe("log.msg", "").contains("WITH RECURSIVE") || safe("log.msg", "").contains("WITH") || safe("log.msg", "").contains("CTE") ) && ( safe("log.msg", "").contains("max_sp_recursion_depth") || safe("log.msg", "").contains("max_execution_time") || safe("log.msg", "").contains("Recursive query aborted") || safe("log.msg", "").contains("Statement is unsafe") || safe("log.msg", "").contains("syntax error") || safe("log.msg", "").contains("denied") || safe("log.msg", "").contains("Too many levels of recursion") || safe("log.msg", "").contains("Stack overflow") || safe("log.msg", "").contains("Query execution was interrupted") )', '2025-09-03 15:51:48.835875', true, false, 'origin', NULL, '[]');
INSERT INTO public.utm_correlation_rules VALUES (727, 'MySQL Connection Limit Violations', 1, 1, 3, 'Impact', 'T1499 - Resource Exhaustion', 'Detects when MySQL connection limits are reached or when hosts are blocked due to connection errors, potentially indicating DoS attempts or misconfigured applications.

Next Steps:
1. Check MySQL server status and current connection count using ''SHOW PROCESSLIST'' and ''SHOW STATUS LIKE "Threads_connected"''
2. Review max_connections setting in MySQL configuration (my.cnf/my.ini)
3. Identify the source of excessive connections from MySQL logs
4. Check for application misconfigurations causing connection leaks
5. Monitor for potential DoS attack patterns from specific IPs
6. Consider implementing connection pooling if not already in use
7. Review and potentially increase max_connections if legitimate traffic
8. Implement rate limiting at the network or application level
', '["https://dev.mysql.com/doc/refman/8.0/en/server-system-variables.html#sysvar_max_connections","https://attack.mitre.org/techniques/T1499/"]', 'safe("log.msg", "") != "" && (safe("log.msg", "").contains("Too many connections") || (safe("log.msg", "").contains("Host") && safe("log.msg", "").contains("is blocked because of many connection errors")) || safe("log.msg", "").contains("max_connections") || safe("log.msg", "").contains("Connection limit exceeded") || safe("log.msg", "").contains("is not allowed to connect to this MySQL server"))', '2025-09-03 15:51:49.257721', true, false, 'origin', '["origin.host"]', '[]');
INSERT INTO public.utm_correlation_rules VALUES (958, 'System Linux: BPF filter applied using TC', 2, 3, 3, 'Execution', 'Unix Shell', 'Detects when the tc (transmission control) binary is utilized to set a BPF (Berkeley Packet Filter) on a network interface.  Tc is used to configure Traffic Control in the Linux kernel. It can shape, schedule, police and drop traffic.  A threat actor can utilize tc to set a bpf filter on an interface for the purpose of manipulating the incoming traffic.  This technique is not at all common and should indicate abnormal, suspicious or malicious activity.', '["https://attack.mitre.org/tactics/TA0002/","https://attack.mitre.org/techniques/T1059/004/"]', 'safe("log.message", "").matches("tc") && safe("log.message", "").matches("filter") && safe("log.message", "").matches("bpf")', '2025-09-03 16:37:52.410535', true, false, 'origin', NULL, '[]');
INSERT INTO public.utm_correlation_rules VALUES (729, 'MySQL File System Access Attempts', 3, 2, 1, 'Collection', 'T1005 - Data from Local System', 'Detects attempts to access the file system through MySQL commands which could be used for data exfiltration or to read sensitive files. This includes the use of LOAD DATA INFILE, SELECT INTO OUTFILE/DUMPFILE, LOAD_FILE() function, and attempts to access sensitive system files.

Next Steps:
1. Identify the user account executing these commands by checking origin.user and origin.host
2. Review the specific file paths being accessed in the log messages
3. Check if the user has legitimate reasons to access file system functions
4. Verify if secure_file_priv is properly configured to restrict file operations
5. Look for any data exfiltration patterns or attempts to read sensitive configuration files
6. Review database audit logs for other suspicious activities from the same user/host
7. If unauthorized, immediately revoke FILE privilege from the user and investigate further
', '["https://dev.mysql.com/doc/refman/8.0/en/load-data.html","https://attack.mitre.org/techniques/T1005/"]', 'safe("log.msg", "") != "" && ( (safe("log.msg", "").contains("LOAD DATA") && safe("log.msg", "").contains("INFILE")) || (safe("log.msg", "").contains("SELECT") && safe("log.msg", "").contains("INTO OUTFILE")) || (safe("log.msg", "").contains("SELECT") && safe("log.msg", "").contains("INTO DUMPFILE")) || safe("log.msg", "").contains("LOAD_FILE") || safe("log.msg", "").contains("secure_file_priv") || safe("log.msg", "").contains("FILE privilege") || safe("log.msg", "").contains("/etc/passwd") || safe("log.msg", "").contains("/proc/") || safe("log.msg", "").contains("\\windows\\") || safe("log.msg", "").contains("\\system32\\") || safe("log.errorCode", "") == "ER_OPTION_PREVENTS_STATEMENT" )', '2025-09-03 15:51:50.242953', true, false, 'origin', '["origin.host","origin.user"]', '[]');
INSERT INTO public.utm_correlation_rules VALUES (730, 'MySQL Full-Text Search Abuse Detection', 3, 2, 2, 'Initial Access', 'T1190 - Exploit Public-Facing Application', 'Detects potential abuse of MySQL full-text search functionality including SQL injection attempts through MATCH AGAINST queries, attempts to bypass restrictions, or excessive full-text searches that could indicate information gathering or denial of service.

Next Steps:
1. Review the full query in log.msg to understand the attempted operation
2. Check if the query is from an authorized application or user
3. Look for patterns of repeated queries from the same origin host
4. Verify if sensitive data was accessed using the full-text search
5. Check application logs for corresponding user activity
6. Consider blocking the source if malicious intent is confirmed
7. Review and update input validation in applications using full-text search
', '["https://security.stackexchange.com/questions/104926/mysql-full-text-search-safety","https://attack.mitre.org/techniques/T1190/","https://owasp.org/www-community/attacks/Full_Path_Disclosure"]', 'safe("log.msg", "") != "" && ( safe("log.msg", "").contains("MATCH") && safe("log.msg", "").contains("AGAINST") || safe("log.msg", "").contains("FULLTEXT") || safe("log.msg", "").contains("WITH QUERY EXPANSION") || safe("log.msg", "").contains("IN BOOLEAN MODE") || safe("log.msg", "").contains("IN NATURAL LANGUAGE MODE") ) && ( safe("log.msg", "").contains("UNION") || safe("log.msg", "").contains("SELECT") && safe("log.msg", "").contains("FROM") && safe("log.msg", "").contains("information_schema") || safe("log.msg", "").contains("LOAD_FILE") || safe("log.msg", "").contains("INTO OUTFILE") || safe("log.msg", "").contains("INTO DUMPFILE") || safe("log.msg", "").contains("@@") || safe("log.msg", "").contains("SLEEP(") || safe("log.msg", "").contains("BENCHMARK(") || safe("log.msg", "").contains("/*") && safe("log.msg", "").contains("*/") || safe("log.msg", "").contains("--") || safe("log.msg", "").contains("0x") || safe("log.msg", "").contains("CHAR(") || safe("log.errorCode", "") != "" )', '2025-09-03 15:51:50.704709', true, false, 'origin', NULL, '[]');
INSERT INTO public.utm_correlation_rules VALUES (731, 'MySQL Information Schema Enumeration', 3, 1, 1, 'Discovery', 'T1082 - System Information Discovery', 'Detects excessive queries to MySQL information_schema tables which could indicate reconnaissance activities or preparation for attacks. Attackers often enumerate database structure and permissions before attempting privilege escalation or data exfiltration.

Next Steps:
- Review the source IP/host making these queries
- Check if the user account has legitimate reasons to query system tables
- Look for any subsequent privilege escalation attempts or data access from the same source
- Review database audit logs for any suspicious activity following these queries
- Consider implementing least privilege access controls on system tables
', '["https://dev.mysql.com/doc/refman/8.0/en/information-schema.html","https://attack.mitre.org/techniques/T1082/"]', 'safe("log.message", "") != "" && (safe("log.message", "").contains("information_schema") || safe("log.message", "").contains("INFORMATION_SCHEMA") || safe("log.message", "").contains("mysql.user") || safe("log.message", "").contains("mysql.db") || safe("log.message", "").contains("performance_schema") || safe("log.message", "").contains("SHOW DATABASES") || safe("log.message", "").contains("SHOW TABLES") || safe("log.message", "").contains("SHOW COLUMNS") || safe("log.message", "").contains("SHOW GRANTS") || safe("log.message", "").contains("SHOW PRIVILEGES") || safe("log.message", "").contains("SHOW PROCESSLIST") || safe("log.message", "").contains("SHOW VARIABLES") || safe("log.message", "").contains("SHOW STATUS"))', '2025-09-03 15:51:51.168889', true, false, 'origin', '["origin.host"]', '[{"indexPattern":"v11-log-filebeat-mysql-*","with":[{"field":"origin.host.keyword","operator":"filter_term","value":"{{.origin.host}}"}],"or":null,"within":"now-10m","count":20}]');
INSERT INTO public.utm_correlation_rules VALUES (732, 'JSON Function Exploitation Attempt', 3, 3, 2, 'Initial Access', 'T1190 - Exploit Public-Facing Application', 'Detects attempts to exploit MySQL JSON functions to bypass security controls or perform SQL injection attacks. Attackers may use JSON functions like JSON_EXTRACT, JSON_SET, or JSON_SEARCH with malicious payloads to bypass WAF filters or execute unauthorized queries.

Next Steps:
1. Review the SQL query in log.msg to identify the specific JSON function and payload being used
2. Check if the source IP/host has legitimate access to execute complex JSON queries
3. Look for patterns indicating automated scanning or injection attempts
4. Review application logs to identify the specific application endpoint being targeted
5. Check if similar attempts have been made against other database servers
6. Consider implementing stricter input validation for JSON-based queries
7. Review database user permissions to ensure principle of least privilege
', '["https://dev.mysql.com/doc/refman/8.0/en/json-functions.html","https://www.picussecurity.com/resource/blog/waf-bypass-using-json-based-sql-injection-attacks","https://attack.mitre.org/techniques/T1190/"]', 'safe("log.level", "") == "ERROR" && safe("log.msg", "") != "" && ( safe("log.msg", "").contains("JSON_EXTRACT") || safe("log.msg", "").contains("JSON_SET") || safe("log.msg", "").contains("JSON_INSERT") || safe("log.msg", "").contains("JSON_REPLACE") || safe("log.msg", "").contains("JSON_REMOVE") || safe("log.msg", "").contains("JSON_SEARCH") || safe("log.msg", "").contains("JSON_MERGE") || safe("log.msg", "").contains("JSON_SCHEMA_VALID") || safe("log.msg", "").contains("->") || safe("log.msg", "").contains("->>") ) && ( safe("log.msg", "").contains("syntax error") || safe("log.msg", "").contains("Incorrect") || safe("log.msg", "").contains("Invalid JSON") || safe("log.msg", "").contains("malformed") || safe("log.msg", "").contains("denied") || safe("log.msg", "").contains("violation") )', '2025-09-03 15:51:51.502507', true, false, 'origin', NULL, '[]');
INSERT INTO public.utm_correlation_rules VALUES (766, 'Nginx Cache Poisoning Attack', 3, 3, 2, 'Persistence', 'T1505: Server Software Component', 'Detects potential cache poisoning attacks targeting nginx cache mechanisms. Monitors for malicious headers designed to poison cache entries, suspicious Host header manipulation, and attempts to inject cached responses.

Next Steps:
1. Review the request details to identify the specific cache poisoning technique being attempted
2. Check if the attacker''s IP has made similar requests to other endpoints
3. Verify if any cached responses were successfully poisoned by inspecting cache contents
4. Consider temporarily blocking the source IP if multiple attempts are detected
5. Review and harden cache configuration to prevent header-based poisoning
6. Implement proper cache key normalization and input validation
', '["https://portswigger.net/research/practical-web-cache-poisoning","https://attack.mitre.org/techniques/T1505/"]', 'safe("origin.ip", "") != "" && ( (safe("log.request", "") != "" && ( safe("log.request", "").contains("X-Forwarded-Host:") || safe("log.request", "").contains("X-Original-URL:") || safe("log.request", "").contains("X-Rewrite-URL:") || safe("log.request", "").contains("X-Forwarded-Server:") || safe("log.request", "").contains("X-Host:") || safe("log.request", "").contains("X-HTTP-Host-Override:") || safe("log.request", "").contains("Forwarded:") || safe("log.request", "").matches(".*Host:.*[<>\"''].*") || safe("log.request", "").matches(".*Host:.*\\$(\\{|\\().*") )) || (safe("log.userAgent", "") != "" && ( safe("log.userAgent", "").contains("$(") || safe("log.userAgent", "").contains("${") || safe("log.userAgent", "").contains("<script") || safe("log.userAgent", "").contains("javascript:") )) || (safe("origin.path", "") != "" && ( safe("origin.path", "").contains("?cb=") || safe("origin.path", "").contains("?cache_buster=") || (safe("origin.path", "").contains("?utm_") && safe("origin.path", "").matches(".*[<>\"''].*")) )) || (safe("log.referrer", "") != "" && safe("log.referrer", "").matches(".*[<>\"''`].*")) )', '2025-09-03 15:59:04.992833', true, false, 'origin', '["origin.ip"]', '[]');
INSERT INTO public.utm_correlation_rules VALUES (733, 'MySQL Partition Manipulation Detection', 2, 3, 3, 'Impact', 'T1485 - Data Destruction', 'Detects attempts to manipulate MySQL table partitions which could be used to cause data loss, performance degradation, or to bypass security controls. Partition manipulation can also be used to prepare for data exfiltration or disrupt database operations.

Next Steps:
- Verify if the partition operation was authorized and performed by a legitimate administrator
- Check the user account performing the operation for any suspicious activity
- Review recent database schema changes and verify they align with approved change requests
- Examine the affected tables to determine if they contain sensitive data
- Look for any data exfiltration attempts following partition operations
- Monitor for performance degradation or service disruptions
- Consider temporarily suspending the account if unauthorized activity is confirmed
', '["https://dev.mysql.com/doc/refman/8.0/en/group-replication-network-partitioning.html","https://attack.mitre.org/techniques/T1485/"]', 'safe("log.msg", "") != "" && ( safe("log.msg", "").contains("ALTER TABLE") && safe("log.msg", "").contains("PARTITION") || safe("log.msg", "").contains("DROP PARTITION") || safe("log.msg", "").contains("TRUNCATE PARTITION") || safe("log.msg", "").contains("ADD PARTITION") || safe("log.msg", "").contains("REORGANIZE PARTITION") || safe("log.msg", "").contains("COALESCE PARTITION") || safe("log.msg", "").contains("EXCHANGE PARTITION") || safe("log.msg", "").contains("ANALYZE PARTITION") || safe("log.msg", "").contains("CHECK PARTITION") || safe("log.msg", "").contains("OPTIMIZE PARTITION") || safe("log.msg", "").contains("REBUILD PARTITION") || safe("log.msg", "").contains("REPAIR PARTITION") || safe("log.msg", "").contains("REMOVE PARTITIONING") ) && ( safe("severity", "") == "high" || safe("log.level", "") == "Error" || safe("log.msg", "").contains("UNREACHABLE") )', '2025-09-03 15:51:52.123163', true, false, 'origin', '["origin.host"]', '[]');
INSERT INTO public.utm_correlation_rules VALUES (734, 'MySQL Performance Schema Abuse Detection', 3, 2, 1, 'Discovery', 'T1046 - Network Service Scanning', 'Detects suspicious queries to MySQL Performance Schema tables that could indicate information gathering or reconnaissance activities. Attackers often query performance_schema tables to understand system configuration, running queries, user sessions, and identify potential vulnerabilities.

Next Steps:
1. Review the query to determine if it''s legitimate database administration activity
2. Check if the source IP/user has a valid reason to access performance schema tables
3. Look for other suspicious queries from the same source in recent logs
4. Verify if this is part of a broader reconnaissance pattern
5. Consider restricting access to performance_schema for non-administrative users
6. Review MySQL audit logs for other suspicious activities from this connection
', '["https://dev.mysql.com/doc/refman/8.0/en/performance-schema-system-variables.html","https://attack.mitre.org/techniques/T1046/"]', 'safe("log.msg", "") != "" && ( safe("log.msg", "").contains("performance_schema") || safe("log.msg", "").contains("PERFORMANCE_SCHEMA") ) && ( safe("log.msg", "").contains("global_variables") || safe("log.msg", "").contains("session_variables") || safe("log.msg", "").contains("threads") || safe("log.msg", "").contains("events_statements") || safe("log.msg", "").contains("prepared_statements_instances") || safe("log.msg", "").contains("status_by_") || safe("log.msg", "").contains("variables_by_thread") || safe("log.msg", "").contains("user_variables_by_thread") || safe("log.msg", "").contains("accounts") || safe("log.msg", "").contains("hosts") || safe("log.msg", "").contains("users") )', '2025-09-03 15:51:52.931364', true, false, 'origin', '["origin.host","origin.ip"]', '[]');
INSERT INTO public.utm_correlation_rules VALUES (737, 'MySQL Privilege Escalation Attempt', 3, 3, 2, 'Defense Evasion, Persistence, Privilege Escalation, Initial Access', 'T1078 - Valid Accounts', 'Detects attempts to escalate privileges in MySQL through GRANT statements, role modifications, or exploitation of FILE privileges. This rule monitors for:
- GRANT statements with dangerous privileges (ALL PRIVILEGES, SUPER, FILE)
- User creation and modification with elevated privileges
- Attempts to access system files through FILE privileges
- Direct manipulation of mysql.user table
- UDF (User Defined Function) creation attempts
- Access denied errors related to privilege operations

Next Steps:
1. Identify the source of the privilege escalation attempt (user, IP, application)
2. Review the MySQL user''s legitimate access requirements
3. Check MySQL audit logs for any successful privilege changes
4. Verify if the user has been granted new privileges: SHOW GRANTS FOR ''username''@''host''
5. Review recent changes to mysql.user table
6. If malicious, revoke unnecessary privileges immediately
7. Consider enabling MySQL audit plugin for enhanced monitoring
8. Review application code for hardcoded credentials or SQL injection vulnerabilities
', '["https://dev.mysql.com/doc/refman/8.0/en/privilege-system.html","https://attack.mitre.org/techniques/T1078/","https://legalhackers.com/advisories/MySQL-Exploit-Remote-Root-Code-Execution-Privesc-CVE-2016-6662.html"]', 'safe("log.msg", "") != "" && ( safe("log.msg", "").contains("GRANT") && (safe("log.msg", "").contains("ALL PRIVILEGES") || safe("log.msg", "").contains("SUPER") || safe("log.msg", "").contains("FILE") || safe("log.msg", "").contains("WITH GRANT OPTION")) || safe("log.msg", "").contains("CREATE USER") && safe("log.msg", "").contains("IDENTIFIED") || safe("log.msg", "").contains("ALTER USER") && (safe("log.msg", "").contains("SUPER") || safe("log.msg", "").contains("FILE")) || safe("log.msg", "").contains("SET ROLE") || safe("log.msg", "").contains("LOAD DATA INFILE") || safe("log.msg", "").contains("SELECT") && safe("log.msg", "").contains("INTO OUTFILE") && safe("log.msg", "").contains("/etc/") || safe("log.msg", "").contains("mysql.user") && (safe("log.msg", "").contains("UPDATE") || safe("log.msg", "").contains("INSERT")) || safe("log.msg", "").contains("FLUSH PRIVILEGES") || safe("log.errorCode", "") == "ER_SPECIFIC_ACCESS_DENIED_ERROR" || safe("log.errorCode", "") == "ER_ACCESS_DENIED_ERROR" && safe("log.msg", "").contains("SUPER") || safe("log.msg", "").contains("UDF") && (safe("log.msg", "").contains("CREATE FUNCTION") || safe("log.msg", "").contains("lib_mysqludf_sys")) )', '2025-09-03 15:52:23.107773', true, false, 'origin', NULL, '[{"indexPattern":"v11-log-mysql-*","with":[{"field":"origin.host.keyword","operator":"filter_term","value":"{{.origin.host}}"},{"field":"log.thread.keyword","operator":"filter_term","value":"{{.log.thread}}"}],"or":null,"within":"now-5m","count":3}]');
INSERT INTO public.utm_correlation_rules VALUES (738, 'MySQL Replication Attack Detection', 3, 3, 3, 'Impact', 'T1565.001 - Data Manipulation: Stored Data Manipulation', 'Detects potential attacks on MySQL replication including unauthorized changes to replication configuration, suspicious binary log operations, and attempts to manipulate slave servers. These attacks can lead to data loss or ransomware deployment.

Next Steps:
1. Review the MySQL error logs for the specific replication commands that triggered this alert
2. Check if the user executing these commands has proper authorization
3. Verify the source IP and hostname for legitimacy
4. Look for any recent changes to MySQL user permissions, especially SUPER or REPLICATION privileges
5. Review binary log files for unusual purge operations or encryption changes
6. Check slave server status and verify replication integrity
7. Consider temporarily stopping replication if unauthorized changes are confirmed
8. Review MySQL audit logs for related suspicious activities
', '["https://www.akamai.com/blog/security/please-read-me-opportunistic-ransomware-devastating-mysql-servers","https://attack.mitre.org/techniques/T1565/001/"]', 'safe("log.msg", "") != "" && ( safe("log.msg", "").contains("CHANGE MASTER") || safe("log.msg", "").contains("CHANGE REPLICATION") || safe("log.msg", "").contains("START SLAVE") || safe("log.msg", "").contains("STOP SLAVE") || safe("log.msg", "").contains("RESET SLAVE") || safe("log.msg", "").contains("SHOW SLAVE STATUS") || safe("log.msg", "").contains("SHOW MASTER STATUS") || safe("log.msg", "").contains("PURGE BINARY LOGS") || safe("log.msg", "").contains("FLUSH LOGS") || safe("log.msg", "").contains("binlog_encryption") || safe("log.msg", "").contains("mysqlbackups''@''%") || safe("log.msg", "").contains("GRANT REPLICATION") || (safe("log.msg", "").contains("SUPER") && safe("log.msg", "").contains("GRANT")) ) && ( safe("log.level", "") == "ERROR" || safe("log.errorCode", "") != "" )', '2025-09-03 15:52:23.522447', true, false, 'origin', NULL, '[{"indexPattern":"v11-log-mysql-*","with":[{"field":"origin.host.keyword","operator":"filter_term","value":"{{.origin.host}}"}],"or":null,"within":"now-15m","count":3}]');
INSERT INTO public.utm_correlation_rules VALUES (959, 'System Linux: Connection to External Network via Telnet', 2, 3, 3, 'Lateral Movement', 'Remote Services', 'Telnet provides a command line interface for communication with a remote device or server. This rule identifies Telnet network connections to publicly routable IP addresses.', '["https://attack.mitre.org/tactics/TA0008/","https://attack.mitre.org/techniques/T1021/"]', 'safe("log.message", "").contains("telnet")', '2025-09-03 16:37:52.876018', true, false, 'target', NULL, '[]');
INSERT INTO public.utm_correlation_rules VALUES (1271, 'UAC Bypass Attempt Detection', 3, 3, 2, 'Privilege Escalation, Defense Evasion', 'T1548.002 - Abuse Elevation Control Mechanism: Bypass User Account Control', 'Detects potential UAC bypass attempts by monitoring for processes with elevated privileges that were not launched through the proper UAC consent mechanism. This rule identifies processes running with elevated token types (TokenElevationTypeVirtual) without proper UAC consent flow, which may indicate an attempt to bypass User Account Control security measures.

Next Steps:
1. Investigate the process that triggered the alert - examine the process name, command line arguments, and parent process
2. Check if the process is known legitimate software that should have elevated privileges
3. Verify the user account that launched the process and their normal privilege level
4. Look for other suspicious activities on the same host around the same time
5. Check for known UAC bypass techniques such as DLL hijacking, registry manipulation, or abuse of auto-elevated processes
6. Examine the process execution chain to identify the attack vector
7. Consider isolating the affected system if malicious activity is confirmed
8. Review security policies and UAC settings to prevent similar bypasses
', '["https://attack.mitre.org/techniques/T1548/002/","https://www.ultimatewindowssecurity.com/securitylog/encyclopedia/event.aspx?eventid=4688"]', 'safe("log.eventCode", 0.0) == double(4688) &&
!safe("log.winlogEventDataProcessName", "").contains("TrustedInstaller.exe") &&
!safe("log.winlogEventDataSubjectUserName", "").contains("SYSTEM") &&
safe("log.winlogEventDataProcessName", "").matches("(?i)(fodhelper|eventvwr|computerdefaults|sdclt|slui|migwiz|dism)")
', '2025-09-04 19:30:32.366627', true, false, 'origin', '["origin.host","origin.user"]', '[]');
INSERT INTO public.utm_correlation_rules VALUES (1272, 'Volume Shadow Copy Deletion', 2, 3, 3, 'Impact', 'T1490 - Inhibit System Recovery', 'Detects deletion of Volume Shadow Copies which is commonly performed by ransomware to prevent recovery of encrypted files. This rule identifies various methods attackers use to delete shadow copies including vssadmin, wmic, PowerShell, wbadmin, and bcdedit commands.

Next Steps:
1. Immediately investigate the affected host for signs of ransomware activity
2. Check for recent file encryption or unusual file modifications
3. Review process execution timeline around the shadow copy deletion
4. Verify if this was legitimate administrative activity or malicious
5. Examine network connections and lateral movement indicators
6. Check backup integrity and consider isolating the system if ransomware is confirmed
7. Review user accounts and privileges involved in the activity
', '["https://attack.mitre.org/techniques/T1490/","https://docs.microsoft.com/en-us/windows-server/administration/windows-commands/vssadmin"]', 'safe("log.eventCode", 0.0) == double(4688) &&
((safe("log.winlogEventDataProcessName", "").endsWith("vssadmin.exe") &&
  (safe("log.winlogEventDataCommandLine", "").contains("delete shadows") ||
   safe("log.winlogEventDataCommandLine", "").contains("resize shadowstorage") &&
   safe("log.winlogEventDataCommandLine", "").contains("maxsize="))) ||
 (safe("log.winlogEventDataProcessName", "").endsWith("wmic.exe") &&
  safe("log.winlogEventDataCommandLine", "").contains("shadowcopy") &&
  safe("log.winlogEventDataCommandLine", "").contains("delete")) ||
 (safe("log.winlogEventDataProcessName", "").endsWith("powershell.exe") &&
  (safe("log.winlogEventDataCommandLine", "").contains("Get-WmiObject") ||
   safe("log.winlogEventDataCommandLine", "").contains("gwmi")) &&
  safe("log.winlogEventDataCommandLine", "").contains("Win32_ShadowCopy") &&
  safe("log.winlogEventDataCommandLine", "").contains("Delete()")) ||
 (safe("log.winlogEventDataProcessName", "").endsWith("wbadmin.exe") &&
  safe("log.winlogEventDataCommandLine", "").contains("delete") &&
  (safe("log.winlogEventDataCommandLine", "").contains("catalog") ||
   safe("log.winlogEventDataCommandLine", "").contains("backup"))) ||
 (safe("log.winlogEventDataProcessName", "").endsWith("bcdedit.exe") &&
  safe("log.winlogEventDataCommandLine", "").contains("recoveryenabled") &&
  safe("log.winlogEventDataCommandLine", "").contains("no")))
', '2025-09-04 19:30:32.996333', true, false, 'origin', '["origin.host","log.winlogEventDataProcessName"]', '[]');
INSERT INTO public.utm_correlation_rules VALUES (1273, 'Windows Defender Tampering Detection', 2, 3, 3, 'Defense Evasion', 'T1562.001 - Impair Defenses: Disable or Modify Tools', 'Detects attempts to disable or tamper with Windows Defender components through registry modifications, service stops, or exclusion additions. This includes registry changes to disable antivirus features, stopping Windows Defender services, or using PowerShell commands to modify protection settings.

Next Steps:
1. Investigate the user account and process responsible for the tampering attempt
2. Check if this is part of authorized maintenance or if it''s malicious activity
3. Review recent logon events and process execution history on the affected host
4. Verify Windows Defender configuration and ensure it''s properly restored
5. Scan the system for malware that may have disabled protection
6. Check for other security tool tampering attempts across the environment
', '["https://attack.mitre.org/techniques/T1562/001/","https://docs.microsoft.com/en-us/windows/security/threat-protection/windows-defender-antivirus/troubleshoot-windows-defender-antivirus"]', '(safe("log.eventCode", 0.0) == double(4657) &&
 safe("log.winlogEventDataObjectName", "").contains("\\Windows Defender\\") &&
 (safe("log.winlogEventDataObjectValueName", "").contains("DisableAntiSpyware") ||
  safe("log.winlogEventDataObjectValueName", "").contains("DisableAntiVirus") ||
  safe("log.winlogEventDataObjectValueName", "").contains("DisableRealtimeMonitoring"))) ||
(safe("log.eventCode", 0.0) == double(7040) &&
 safe("log.winlogEventDataServiceName", "").contains("WinDefend") &&
 safe("log.winlogEventDataNewState", "") == "disabled") ||
(safe("log.eventCode", 0.0) == double(4688) &&
 safe("log.winlogEventDataCommandLine", "").contains("Set-MpPreference") &&
 (safe("log.winlogEventDataCommandLine", "").contains("DisableRealtimeMonitoring") ||
  safe("log.winlogEventDataCommandLine", "").contains("DisableIOAVProtection") ||
  safe("log.winlogEventDataCommandLine", "").contains("DisableBehaviorMonitoring")))
', '2025-09-04 19:30:33.95102', true, false, 'origin', '["origin.host","log.winlogEventDataSubjectUserName"]', '[]');
INSERT INTO public.utm_correlation_rules VALUES (1390, 'Windows: New Windows Service Created to start from windows root path. Suspicious event as the binary may have been dropped using Windows Admin Shares', 1, 2, 3, 'Potentially Compromised System', 'Remote Services: SMB/Windows Admin Shares', 'Adversaries may use Valid Accounts to interact with a remote network share using Server Message Block (SMB).  The adversary may then perform actions as the logged-on user.', '["https://attack.mitre.org/techniques/T1021/002/"]', 'safe("log.eventDataImagePath", "").matches("(^%systemroot%\\(.+)\\(.+).exe)") && safe("log.eventCode", 0.0) == double(7045) && safe("log.logName", "") in [''system'', ''System'']', '2025-09-04 20:45:21.6867', true, false, 'target', NULL, '[]');
INSERT INTO public.utm_correlation_rules VALUES (739, 'SQL Injection Attempts Detected', 3, 3, 2, 'Initial Access', 'T1190 - Exploit Public-Facing Application', 'Detects potential SQL injection attempts through error messages indicating syntax errors, unauthorized access attempts, or suspicious SQL patterns in MySQL logs. SQL injection attacks can lead to unauthorized data access, data modification, or complete database compromise.

Next Steps:
1. Review the SQL query and error message to confirm if this is a legitimate SQL injection attempt
2. Identify the source IP/host making the suspicious queries
3. Check application logs for corresponding web requests that may have triggered these queries
4. Review other recent queries from the same source for additional suspicious activity
5. If confirmed as malicious, block the source IP at the firewall/WAF level
6. Review and patch the vulnerable application code that allowed the injection
7. Consider implementing prepared statements and input validation in the affected application
8. Monitor database access logs for any unauthorized data access or modifications
9. Review database user permissions and remove unnecessary privileges
', '["https://dev.mysql.com/doc/refman/8.0/en/error-log-format.html","https://attack.mitre.org/techniques/T1190/","https://owasp.org/www-community/attacks/SQL_Injection"]', 'safe("log.msg", "") != "" && ( safe("log.msg", "").contains("syntax error") || safe("log.msg", "").contains("Access denied") || safe("log.msg", "").contains("UNION") || (safe("log.msg", "").contains("SELECT") && safe("log.msg", "").contains("FROM") && safe("log.msg", "").contains("WHERE")) || safe("log.msg", "").contains("1=1") || safe("log.msg", "").contains("'' OR ''") || safe("log.msg", "").contains("\" OR \"") || (safe("log.msg", "").contains("/*") && safe("log.msg", "").contains("*/")) || safe("log.msg", "").contains("xp_cmdshell") || safe("log.msg", "").contains("EXEC(") || safe("log.msg", "").contains("EXECUTE(") || safe("log.msg", "").contains("CAST(") || safe("log.msg", "").contains("CONVERT(") || safe("log.msg", "").contains("CHAR(") || safe("log.msg", "").contains("CONCAT(") || safe("log.msg", "").contains("INFORMATION_SCHEMA") || safe("log.msg", "").contains("mysql.user") || safe("log.msg", "").contains("INTO OUTFILE") || safe("log.msg", "").contains("INTO DUMPFILE") || safe("log.msg", "").contains("LOAD_FILE") || safe("log.msg", "").contains("BENCHMARK") || safe("log.msg", "").contains("SLEEP(") || safe("log.msg", "").contains("WAITFOR DELAY") || safe("log.msg", "").contains("0x") || safe("log.msg", "").contains("--") || safe("log.msg", "").contains(";--") || safe("log.msg", "").contains("#") || safe("log.msg", "").contains("@@version") || safe("log.msg", "").contains("user()") )', '2025-09-03 15:52:24.479282', true, false, 'origin', '["origin.host"]', '[{"indexPattern":"v11-log-mysql-*","with":[{"field":"origin.host.keyword","operator":"filter_term","value":"{{.origin.host}}"},{"field":"log.msg","operator":"filter_match","value":"syntax error OR Access denied OR UNION OR SELECT"}],"or":null,"within":"now-15m","count":5}]');
INSERT INTO public.utm_correlation_rules VALUES (740, 'MySQL Stored Procedure Abuse', 3, 3, 2, 'Execution', 'T1059 - Command and Scripting Interpreter', 'Detects potential abuse of stored procedures and functions including creation of malicious procedures, execution of system commands, or unauthorized procedure modifications. This could indicate an attacker attempting to establish persistence, execute arbitrary commands, or escalate privileges within the MySQL database.

Next Steps:
1. Identify the user account that executed the suspicious stored procedure operation
2. Review the full SQL statement to understand the intent and potential impact
3. Check if the stored procedure/function name follows organizational naming conventions
4. Verify if the user has legitimate reasons to create/modify stored procedures
5. Look for any unusual DEFINER clauses that could indicate privilege escalation attempts
6. Review recent authentication logs for the user to check for compromised credentials
7. If malicious, immediately revoke the user''s stored procedure privileges
8. Audit all stored procedures created or modified by this user
9. Check for any data exfiltration or unauthorized access that may have occurred
', '["https://dev.mysql.com/doc/refman/8.0/en/stored-programs-defining.html","https://attack.mitre.org/techniques/T1059/","https://www.mysql.com/products/enterprise/audit.html"]', 'safe("log.msg", "") != "" && ( (safe("log.msg", "").contains("CREATE PROCEDURE") && (safe("log.msg", "").contains("xp_cmdshell") || safe("log.msg", "").contains("sys_exec") || safe("log.msg", "").contains("sys_eval"))) || (safe("log.msg", "").contains("CREATE FUNCTION") && (safe("log.msg", "").contains("SONAME") || safe("log.msg", "").contains(".so") || safe("log.msg", "").contains(".dll"))) || safe("log.msg", "").contains("ALTER PROCEDURE") || safe("log.msg", "").contains("ALTER FUNCTION") || (safe("log.msg", "").contains("DROP PROCEDURE") && !safe("log.msg", "").contains("IF EXISTS")) || (safe("log.msg", "").contains("DROP FUNCTION") && !safe("log.msg", "").contains("IF EXISTS")) || (safe("log.msg", "").contains("CALL") && (safe("log.msg", "").contains("sys.") || safe("log.msg", "").contains("mysql."))) || (safe("log.msg", "").contains("EXECUTE") && safe("log.msg", "").contains("PREPARE")) || (safe("log.msg", "").contains("DEFINER") && (safe("log.msg", "").contains("root@") || safe("log.msg", "").contains("SUPER"))) || safe("log.msg", "").contains("CREATE DEFINER") || safe("log.msg", "").contains("SQL SECURITY DEFINER") || (safe("log.msg", "").contains("mysql.proc") && (safe("log.msg", "").contains("INSERT") || safe("log.msg", "").contains("UPDATE") || safe("log.msg", "").contains("DELETE"))) || (safe("log.msg", "").contains("mysql.func") && (safe("log.msg", "").contains("INSERT") || safe("log.msg", "").contains("UPDATE"))) || safe("log.msg", "").contains("lib_mysqludf") || safe("log.errorCode", "") == "ER_SP_ALREADY_EXISTS" || safe("log.errorCode", "") == "ER_SP_DOES_NOT_EXIST" || safe("log.errorCode", "") == "ER_PROCACCESS_DENIED_ERROR" )', '2025-09-03 15:52:24.892679', true, false, 'origin', NULL, '[]');
INSERT INTO public.utm_correlation_rules VALUES (741, 'MySQL System Variable Modification Detection', 2, 3, 2, 'Defense Evasion', 'T1562.001 - Impair Defenses: Disable or Modify Tools', 'Detects modifications to MySQL system variables that could indicate malicious configuration changes. Attackers often modify system variables to disable security features, change logging behavior, or prepare for data exfiltration.

Next Steps:
- Review the specific system variable being modified and its security implications
- Check if the modification was authorized by the database administrator
- Investigate the user account and source IP that made the change
- Review recent database activity from the same session/thread for suspicious queries
- Verify if similar changes were made to other database instances
- Check for any data exfiltration attempts following the configuration change
- Monitor for subsequent privilege escalation attempts
- Review MySQL error logs for failed authentication attempts from the same source
', '["https://dev.mysql.com/doc/refman/8.0/en/security-against-attack.html","https://attack.mitre.org/techniques/T1562/001/"]', 'safe("log.msg", "") != "" && ( safe("log.msg", "").contains("SET GLOBAL") || safe("log.msg", "").contains("SET SESSION") || safe("log.msg", "").contains("SET @@") || safe("log.msg", "").contains("set global") || safe("log.msg", "").contains("set session") ) && ( safe("log.msg", "").contains("secure_file_priv") || safe("log.msg", "").contains("general_log") || safe("log.msg", "").contains("log_output") || safe("log.msg", "").contains("binlog_") || safe("log.msg", "").contains("max_connections") || safe("log.msg", "").contains("max_user_connections") || safe("log.msg", "").contains("sql_mode") || safe("log.msg", "").contains("foreign_key_checks") || safe("log.msg", "").contains("autocommit") || safe("log.msg", "").contains("read_only") || safe("log.msg", "").contains("super_read_only") )', '2025-09-03 15:52:25.463597', true, false, 'origin', '["origin.host","origin.user"]', '[]');
INSERT INTO public.utm_correlation_rules VALUES (742, 'MySQL Trigger Manipulation Detection', 2, 3, 2, 'Persistence', 'T1505.001 - SQL Stored Procedures', 'Detects attempts to create, alter, or drop database triggers which could be used for persistence, data tampering, or privilege escalation. Triggers can execute malicious code automatically on data changes and represent a significant security risk when manipulated by unauthorized users.

Next Steps:
1. Review the trigger manipulation commands in the alert details to understand what changes were attempted
2. Identify the user account that executed the trigger commands and verify if this activity was authorized
3. Examine the trigger definition for any suspicious or malicious code patterns, including calls to external functions or file operations
4. Check for any recent privilege escalations or account compromises for the executing user
5. Review database audit logs for other suspicious activities from the same source IP and user account
6. Verify if the trigger creation aligns with scheduled maintenance or authorized database changes
7. If unauthorized, immediately revoke the user''s trigger creation privileges and audit all existing triggers for malicious content
8. Consider implementing stricter database access controls and trigger creation policies with approval workflows
9. Monitor for subsequent database activities that might leverage the newly created or modified triggers
10. Document the incident and update security procedures to prevent similar unauthorized trigger manipulations
', '["https://dev.mysql.com/doc/refman/8.0/en/trigger-syntax.html","https://dev.mysql.com/doc/refman/8.0/en/audit-log-reference.html","https://attack.mitre.org/techniques/T1505/001/"]', 'safe("log.msg", "") != "" && ( safe("log.msg", "").contains("CREATE TRIGGER") || safe("log.msg", "").contains("create trigger") || safe("log.msg", "").contains("ALTER TRIGGER") || safe("log.msg", "").contains("alter trigger") || safe("log.msg", "").contains("DROP TRIGGER") || safe("log.msg", "").contains("drop trigger") || (safe("log.msg", "").contains("trigger") && safe("log.msg", "").contains("definer")) )', '2025-09-03 15:52:25.932139', true, false, 'origin', '["origin.host"]', '[]');
INSERT INTO public.utm_correlation_rules VALUES (960, 'System Linux: Potential Protocol Tunneling via EarthWorm', 3, 3, 2, 'Command and Control', 'Protocol Tunneling', 'Identifies the execution of the EarthWorm tunneler. Adversaries may tunnel network communications to and from a victim system within a separate protocol to avoid detection and network filtering, or to enable access to otherwise unreachable systems.', '["https://attack.mitre.org/tactics/TA0011/","https://attack.mitre.org/techniques/T1572/"]', 'safe("log.message", "").contains("-s") && safe("log.message", "").contains("-d") && safe("log.message", "").contains("rssocks")', '2025-09-03 16:37:53.471572', true, false, 'target', NULL, '[]');
INSERT INTO public.utm_correlation_rules VALUES (749, 'NATS Connection Limits Bypass Attempt', 1, 2, 3, 'Impact', 'T1499 - Endpoint Denial of Service', 'Detects attempts to bypass or exceed NATS server connection limits, which could indicate a denial of service attack or unauthorized resource consumption. This rule monitors for rapid connection attempts from the same source or connection limit errors in the logs.

Next Steps:
1. Review NATS server configuration for connection limits and ensure they are appropriate
2. Check source IP/host for legitimate business purposes
3. Monitor NATS server performance metrics for resource exhaustion
4. Review authentication logs for failed authentication attempts from the same source
5. Consider implementing rate limiting or IP blocking for repeat offenders
6. Check if the source is attempting connections to multiple NATS clusters
7. Verify if this is part of a distributed attack pattern
8. Review NATS cluster health and connection pool utilization
', '["https://docs.nats.io/running-a-nats-service/configuration","https://attack.mitre.org/techniques/T1499/"]', '(safe("log.error", "").contains("maximum") && safe("log.error", "").contains("connection")) || (safe("log.message", "").contains("connection") && safe("log.message", "").contains("limit")) || safe("log.error_message", "").contains("too many connections") || (safe("log.message", "").contains("max_connections") && safe("log.message", "").contains("exceeded"))', '2025-09-03 15:57:08.227782', true, false, 'origin', '["origin.host","origin.ip"]', '[]');
INSERT INTO public.utm_correlation_rules VALUES (743, 'MySQL UDF Exploitation Attempts', 3, 3, 2, 'Execution', 'T1059 - Command and Scripting Interpreter', 'Detects attempts to create or use User Defined Functions (UDFs) in MySQL which could be used for privilege escalation or code execution. UDFs allow execution of arbitrary code through the MySQL server process, potentially leading to complete system compromise.

Next Steps:
1. Review the MySQL error logs to identify the source IP and user account attempting UDF operations
2. Check if the UDF libraries (lib_mysqludf_sys, openssl_udf) exist on the MySQL server filesystem
3. Examine MySQL user privileges - only users with CREATE ROUTINE privilege should be able to create functions
4. Review recent authentication logs for the MySQL user account involved
5. Check for any suspicious files in the MySQL plugin directory (typically /usr/lib/mysql/plugin/)
6. Consider revoking CREATE ROUTINE privileges from non-administrative users
7. Enable MySQL audit logging if not already active to capture detailed query information
', '["https://dev.mysql.com/doc/refman/8.0/en/create-function-loadable.html","https://attack.mitre.org/techniques/T1059/"]', 'safe("log.msg", "") != "" && ((safe("log.msg", "").contains("CREATE FUNCTION") && (safe("log.msg", "").contains("SONAME") || safe("log.msg", "").contains("RETURNS"))) || safe("log.msg", "").contains("DROP FUNCTION") || safe("log.msg", "").contains("sys_exec") || safe("log.msg", "").contains("sys_eval") || safe("log.msg", "").contains("lib_mysqludf_sys") || safe("log.msg", "").contains("openssl_udf") || safe("log.errorCode", "") == "ER_CANT_FIND_UDF" || safe("log.errorCode", "") == "ER_CANT_CREATE_UDF" || (safe("log.msg", "").contains("UDF") && (safe("log.msg", "").contains("error") || safe("log.msg", "").contains("failed"))))', '2025-09-03 15:52:26.372702', true, false, 'origin', '["origin.host"]', '[]');
INSERT INTO public.utm_correlation_rules VALUES (744, 'MySQL User Account Manipulation', 3, 3, 1, 'Persistence, Privilege Escalation', 'T1098 - Account Manipulation', 'Detects suspicious user account manipulation activities including creation of backdoor accounts, password changes, or unauthorized account modifications in MySQL databases. This could indicate an attacker attempting to establish persistence or elevate privileges.

Next Steps:
1. Review the specific account manipulation activity in the MySQL logs
2. Identify the user account that performed the action and verify if it was authorized
3. Check if the affected user account shows any suspicious privilege grants
4. Review recent authentication logs for the source host
5. Examine if there are any other account manipulation attempts from the same source
6. Consider revoking suspicious accounts and resetting passwords if unauthorized
', '["https://dev.mysql.com/doc/refman/8.0/en/account-management-statements.html","https://attack.mitre.org/techniques/T1098/"]', 'safe("log.msg", "") != "" && ( safe("log.msg", "").contains("CREATE USER") || safe("log.msg", "").contains("DROP USER") || safe("log.msg", "").contains("RENAME USER") || (safe("log.msg", "").contains("ALTER USER") && (safe("log.msg", "").contains("IDENTIFIED BY") || safe("log.msg", "").contains("PASSWORD"))) || safe("log.msg", "").contains("SET PASSWORD") || (safe("log.msg", "").contains("GRANT") && safe("log.msg", "").contains("TO") && safe("log.msg", "").contains("@")) || (safe("log.msg", "").contains("REVOKE") && safe("log.msg", "").contains("FROM")) || (safe("log.msg", "").contains("mysql.user") && (safe("log.msg", "").contains("INSERT") || safe("log.msg", "").contains("UPDATE") || safe("log.msg", "").contains("DELETE"))) || (safe("log.msg", "").contains("mysql.db") && (safe("log.msg", "").contains("INSERT") || safe("log.msg", "").contains("UPDATE"))) || (safe("log.msg", "").contains("mysql.tables_priv") && (safe("log.msg", "").contains("INSERT") || safe("log.msg", "").contains("UPDATE"))) || (safe("log.msg", "").contains("mysql.columns_priv") && (safe("log.msg", "").contains("INSERT") || safe("log.msg", "").contains("UPDATE"))) || (safe("log.msg", "").contains("mysql.procs_priv") && (safe("log.msg", "").contains("INSERT") || safe("log.msg", "").contains("UPDATE"))) || safe("log.errorCode", "") == "ER_CANNOT_USER" || safe("log.errorCode", "") == "ER_PASSWORD_NO_MATCH" )', '2025-09-03 15:52:27.037989', true, false, 'origin', NULL, '[]');
INSERT INTO public.utm_correlation_rules VALUES (745, 'Window Function Abuse Detection', 2, 2, 3, 'Impact', 'T1499 - Endpoint Denial of Service', 'Detects potential abuse of MySQL window functions that could lead to resource exhaustion or unauthorized data access. Window functions like ROW_NUMBER(), RANK(), DENSE_RANK(), LAG(), LEAD() can be abused to create complex queries that consume excessive resources or bypass access controls.

Next Steps:
1. Review the query that triggered this alert to determine if it''s legitimate
2. Check MySQL slow query log for additional context
3. Monitor system resources (CPU, memory) on the MySQL server
4. Verify if the user has legitimate need for complex window function queries
5. Consider implementing query execution time limits or resource usage limits
6. Review application code to ensure proper query optimization
7. If malicious, investigate the source IP and user account for further suspicious activity
', '["https://dev.mysql.com/doc/refman/8.0/en/window-functions.html","https://attack.mitre.org/techniques/T1499/"]', 'safe("log.msg", "").contains("window function") || ( safe("log.msg", "") != "" && ( safe("log.msg", "").contains("ROW_NUMBER()") || safe("log.msg", "").contains("RANK()") || safe("log.msg", "").contains("DENSE_RANK()") || safe("log.msg", "").contains("PERCENT_RANK()") || safe("log.msg", "").contains("CUME_DIST()") || safe("log.msg", "").contains("NTILE()") || safe("log.msg", "").contains("LAG()") || safe("log.msg", "").contains("LEAD()") || safe("log.msg", "").contains("FIRST_VALUE()") || safe("log.msg", "").contains("LAST_VALUE()") || safe("log.msg", "").contains("NTH_VALUE()") || safe("log.msg", "").contains("OVER") || safe("log.msg", "").contains("PARTITION BY") ) && ( safe("log.msg", "").contains("Resource temporarily unavailable") || safe("log.msg", "").contains("Out of memory") || safe("log.msg", "").contains("Query execution was interrupted") || safe("log.msg", "").contains("max_execution_time exceeded") || safe("log.msg", "").contains("Too many connections") || safe("log.msg", "").contains("denied") || safe("log.errorCode", "") != "" || safe("log.level", "").contains("error") || safe("log.level", "").contains("warning") ) )', '2025-09-03 15:52:46.037297', true, false, 'origin', '["origin.host","origin.user"]', '[{"indexPattern":"v11-log-filebeat-mysql-*","with":[{"field":"origin.host.keyword","operator":"filter_term","value":"{{.origin.host}}"},{"field":"log.msg","operator":"filter_match","value":"window function"}],"or":null,"within":"now-10m","count":5}]');
INSERT INTO public.utm_correlation_rules VALUES (746, 'NATS Account Isolation Bypass Attempt', 3, 3, 2, 'Privilege Escalation, Defense Evasion', 'T1548 - Abuse Elevation Control Mechanism', 'Detects attempts to bypass account isolation in NATS, including cross-account access attempts, import/export violations, or account boundary breaches. This could indicate an attacker attempting to escalate privileges or access data from other accounts.

Next Steps:
1. Identify the source of the account isolation bypass attempt
2. Review NATS account configuration and permissions
3. Check if the account has legitimate access to the requested resources
4. Verify import/export configurations are properly secured
5. Review audit logs for any successful cross-account access
6. Consider temporarily disabling the account if malicious activity is confirmed
7. Update NATS account isolation policies if necessary
', '["https://docs.nats.io/running-a-nats-service/configuration/securing_nats/accounts","https://attack.mitre.org/techniques/T1548/"]', 'safe("log.action", "") == "nats.log" && ( safe("log.message", "").matches(".*account.*isolation.*") || safe("log.message", "").matches(".*cross.*account.*denied.*") || safe("log.level", "") == "error" && safe("log.message", "").matches(".*import.*not.*allowed.*") || safe("log.level", "") == "error" && safe("log.message", "").matches(".*export.*violation.*") || safe("log.message", "").matches(".*account.*boundary.*violation.*") || (safe("log.type", "") == "PUB" && safe("log.message", "").matches(".*different.*account.*")) || (safe("log.operation", "") == "IMPORT" && safe("log.status", "") == "denied") )', '2025-09-03 15:57:06.884348', true, false, 'origin', NULL, '[]');
INSERT INTO public.utm_correlation_rules VALUES (747, 'NATS Cluster Gossip Attack Detection', 2, 3, 3, 'Impact', 'T1498 - Network Denial of Service', 'Detects potential attacks on NATS cluster gossip protocol including malformed gossip messages, excessive gossip traffic, or unauthorized cluster join attempts. These attacks can compromise cluster integrity, cause split-brain scenarios, or lead to denial of service.

Next Steps:
1. Identify the source IP/host generating the suspicious gossip messages
2. Check NATS cluster health and connectivity status
3. Review cluster authentication configuration and certificates
4. Examine network traffic between cluster nodes for anomalies
5. Verify all cluster members are legitimate and authorized
6. Check for any recent configuration changes or new node additions
7. Consider temporarily isolating suspicious nodes if attack is ongoing
8. Review and strengthen cluster authentication mechanisms
', '["https://docs.nats.io/running-a-nats-service/configuration/clustering/cluster_config","https://attack.mitre.org/techniques/T1498/"]', 'safe("action", "") == "nats.log" && ( safe("log.message", "").matches(".*gossip.*error.*") || safe("log.message", "").matches(".*cluster.*invalid.*") || safe("log.message", "").matches(".*route.*authentication.*failed.*") || safe("log.message", "").matches(".*excessive.*gossip.*") || safe("log.level", "") == "error" && safe("log.message", "").matches(".*cluster.*") )', '2025-09-03 15:57:07.311069', true, false, 'origin', NULL, '[]');
INSERT INTO public.utm_correlation_rules VALUES (750, 'NATS Gateway Security Violation', 3, 2, 3, 'Initial Access', 'Gateway Bypass', 'Detects security violations in NATS gateway operations including authentication failures, unauthorized gateway access, or gateway configuration tampering. These events may indicate an attacker attempting to compromise gateway security controls or gain unauthorized access to NATS cluster resources.

Next Steps:
- Review the source IP and host attempting gateway access
- Verify if the gateway credentials are properly configured
- Check TLS certificate validity and configuration
- Review gateway access control lists and permissions
- Investigate any recent gateway configuration changes
- Look for patterns of failed attempts from the same source
- Consider blocking suspicious IPs at the network level
', '["https://docs.nats.io/running-a-nats-service/configuration","https://attack.mitre.org/techniques/T1190/"]', 'safe("log.action", "") == "nats.log" && ( safe("log.message", "").matches(".*gateway.*auth.*fail.*") || safe("log.message", "").matches(".*gateway.*unauthorized.*") || safe("log.message", "").matches(".*gateway.*invalid.*credentials.*") || safe("log.message", "").matches(".*gateway.*access.*denied.*") || safe("log.message", "").matches(".*gateway.*certificate.*error.*") || safe("log.message", "").matches(".*gateway.*tls.*fail.*") )', '2025-09-03 15:57:08.668508', true, false, 'origin', NULL, '[{"indexPattern":"v11-log-filebeat-nats-*","with":[{"field":"origin.host.keyword","operator":"filter_term","value":"{{.origin.host}}"},{"field":"log.action.keyword","operator":"filter_term","value":"nats.log"}],"or":null,"within":"now-1h","count":15}]');
INSERT INTO public.utm_correlation_rules VALUES (751, 'NATS JetStream Tampering Detection', 3, 3, 2, 'Impact', 'T1565.001 - Data Manipulation: Stored Data Manipulation', 'Detects attempts to tamper with NATS JetStream including stream manipulation, consumer deletion, RAFT consensus attacks, or storage corruption attempts. These events indicate potential data integrity violations or attacks on the messaging infrastructure.

Next Steps:
1. Review the specific tampering attempt in the log message to understand the nature of the attack
2. Check the source host and user account that triggered the tampering event
3. Verify the integrity of affected JetStream streams and consumers
4. Review RAFT cluster health and consensus status if consensus failures are detected
5. Check for any unauthorized configuration changes or permission modifications
6. Investigate any related authentication failures or privilege escalation attempts
7. Consider implementing additional access controls or encryption for sensitive streams
', '["https://docs.nats.io/nats-concepts/jetstream","https://docs.nats.io/running-a-nats-service/configuration/clustering/jetstream_clustering","https://attack.mitre.org/techniques/T1565/001/"]', 'safe("log.message", "").matches(".*jetstream.*tamper.*") || safe("log.message", "").matches(".*stream.*unauthorized.*modif.*") || safe("log.message", "").matches(".*consumer.*unauthorized.*delete.*") || safe("log.message", "").matches(".*raft.*consensus.*fail.*") || safe("log.message", "").matches(".*jetstream.*storage.*corrupt.*") || safe("log.message", "").matches(".*jetstream.*integrity.*fail.*") || safe("log.message", "").matches(".*stream.*permission.*denied.*") || safe("log.message", "").matches(".*jetstream.*encryption.*error.*")', '2025-09-03 15:57:09.109573', true, false, 'origin', '["origin.host"]', '[]');
INSERT INTO public.utm_correlation_rules VALUES (752, 'NATS JWT Authentication Failures', 3, 3, 1, 'Credential Access', 'T1110 - Brute Force', 'Detects JWT authentication failures in NATS including invalid tokens, expired JWTs, signature verification failures, or malformed JWT attempts. This could indicate credential stuffing, brute force attacks, or attempts to exploit JWT vulnerabilities.

Next Steps:
1. Review the source IP and user account involved in the authentication failures
2. Check if the failures are coming from known internal systems or external sources
3. Verify if the JWT tokens are properly configured and not expired
4. Look for patterns indicating automated attacks (rapid failures from same IP)
5. Review NATS server JWT configuration and ensure proper key management
6. Consider implementing rate limiting for authentication attempts
7. Check for any recently changed or rotated JWT keys that clients may not have updated
8. Analyze the timing of failures to identify potential attack windows
9. Correlate with other authentication events across the infrastructure
10. Review NATS access logs for additional suspicious activity from the same sources
', '["https://docs.nats.io/running-a-nats-service/configuration/securing_nats/auth_intro/jwt","https://attack.mitre.org/techniques/T1110/"]', 'safe("log.action", "") == "nats.log" && ( safe("log.message", "").contains("JWT") && safe("log.message", "").contains("invalid") || safe("log.message", "").contains("JWT") && safe("log.message", "").contains("expired") || safe("log.message", "").contains("token") && safe("log.message", "").contains("verification") && safe("log.message", "").contains("failed") || safe("log.message", "").contains("JWT") && safe("log.message", "").contains("signature") || safe("log.message", "").contains("malformed") && safe("log.message", "").contains("JWT") || safe("log.message", "").contains("JWT") && safe("log.message", "").contains("decode") && safe("log.message", "").contains("error") || (safe("log.auth_type", "") == "jwt" && safe("log.status", "") == "failed") || (safe("log.msg_type", "") == "CONNECT" && safe("log.message", "").contains("JWT")) )', '2025-09-03 15:57:09.523366', true, false, 'origin', '["origin.ip","origin.user"]', '[{"indexPattern":"v11-log-nats-*","with":[{"field":"origin.ip.keyword","operator":"filter_term","value":"{{.origin.ip}}"}],"or":null,"within":"now-10m","count":5}]');
INSERT INTO public.utm_correlation_rules VALUES (759, 'NATS Resolver Exploitation Detection', 3, 3, 2, 'Execution', 'T1203 - Exploitation for Client Execution', 'Detects attempts to exploit NATS resolver functionality including JWT resolver, account resolver, or DNS resolver issues that could lead to authentication bypass or unauthorized access.

Next Steps:
1. Identify the affected NATS server and check if the resolver errors are persistent
2. Review NATS server logs for authentication failures or suspicious connection attempts around the same time
3. Check JWT/account resolver configuration for misconfigurations or tampered settings
4. Verify DNS resolution is working correctly and hasn''t been hijacked
5. Look for unusual client connections or authentication patterns
6. Consider rotating JWT signing keys if JWT resolver exploitation is suspected
7. Review account permissions and disable any compromised accounts
', '["https://docs.nats.io/running-a-nats-service/configuration/securing_nats/auth_intro/jwt","https://attack.mitre.org/techniques/T1203/"]', 'safe("log.message", "").contains("resolver error") || safe("log.message", "").contains("resolver failed") || safe("log.message", "").contains("JWT resolver") || safe("log.message", "").contains("account resolver") || safe("log.message", "").contains("DNS resolution failed") || (safe("log.message", "").contains("resolver") && (safe("log.message", "").contains("invalid") || safe("log.message", "").contains("malformed")))', '2025-09-03 15:57:29.536631', true, false, 'origin', '["origin.host"]', '[]');
INSERT INTO public.utm_correlation_rules VALUES (753, 'NATS Leaf Node Exploitation Attempt', 3, 3, 2, 'Lateral Movement', 'T1021 - Remote Services', 'Detects attempts to exploit NATS leaf node connections including unauthorized leaf node connections, leaf node impersonation, or malicious leaf node activities. Leaf nodes are lightweight NATS servers that maintain a single connection to a remote cluster, and exploitation of these nodes could lead to unauthorized access to the NATS messaging system.

Next Steps:
1. Review the source IP and hostname attempting the leaf node connection
2. Verify if this is a legitimate leaf node in your NATS architecture
3. Check NATS server configuration for proper leaf node authentication settings
4. Review certificate validity if TLS is being used for leaf connections
5. Examine NATS server logs for additional suspicious activities from the same source
6. Consider blocking the source IP if the activity is confirmed malicious
7. Update leaf node authentication credentials if compromise is suspected
', '["https://docs.nats.io/running-a-nats-service/configuration","https://attack.mitre.org/techniques/T1021/","https://docs.nats.io/running-a-nats-service/configuration/leafnodes"]', 'safe("log.event.action", "") == "nats.log" && ( safe("log.message", "").matches(".*leaf.*node.*auth.*fail.*") || safe("log.message", "").matches(".*leaf.*unauthorized.*") || safe("log.message", "").matches(".*leaf.*connection.*rejected.*") || safe("log.message", "").matches(".*leaf.*node.*impersonat.*") || safe("log.message", "").matches(".*leaf.*certificate.*invalid.*") || safe("log.message", "").matches(".*leaf.*node.*suspicious.*") || safe("log.message", "").matches(".*leaf.*remote.*error.*") )', '2025-09-03 15:57:10.365353', true, false, 'origin', '["origin.host","origin.ip"]', '[{"indexPattern":"v11-log-nats-*","with":[{"field":"origin.host.keyword","operator":"filter_term","value":"{{.origin.host}}"}],"or":null,"within":"now-2h","count":5}]');
INSERT INTO public.utm_correlation_rules VALUES (754, 'NATS Monitoring Endpoint Exposure Detection', 3, 1, 1, 'Discovery', 'T1046 - Network Service Discovery', 'Detects unauthorized access attempts to NATS monitoring endpoints which could expose sensitive server information. The monitoring endpoint provides detailed server metrics and should be restricted to authorized administrators only.

Next Steps:
1. Identify the source IP and hostname attempting to access monitoring endpoints
2. Verify if the access is from an authorized monitoring system or administrator
3. Check if authentication is properly configured for monitoring endpoints
4. Review NATS server configuration to ensure monitoring endpoints are not publicly exposed
5. If unauthorized, block the source IP and investigate for potential reconnaissance activity
6. Implement IP whitelisting for monitoring endpoint access if not already configured
7. Enable authentication on monitoring endpoints using the --http_user and --http_pass flags
', '["https://docs.nats.io/running-a-nats-service/nats_admin/monitoring","https://attack.mitre.org/techniques/T1046/"]', 'safe("origin.url", "").contains("/varz") || safe("origin.url", "").contains("/connz") || safe("origin.url", "").contains("/routez") || safe("origin.url", "").contains("/subsz") || safe("origin.url", "").contains("/leafz") || safe("origin.url", "").contains("/gatewayz") || safe("origin.url", "").contains("/healthz") || (safe("log.message", "").contains("monitoring") && safe("log.message", "").contains("endpoint"))', '2025-09-03 15:57:10.788315', true, false, 'origin', '["origin.host","origin.ip"]', '[{"indexPattern":"v11-log-nats-*","with":[{"field":"origin.host.keyword","operator":"filter_term","value":"{{.origin.host}}"}],"or":null,"within":"now-10m","count":5}]');
INSERT INTO public.utm_correlation_rules VALUES (755, 'NATS Operator Security Issues Detection', 3, 3, 3, 'Defense Evasion, Persistence, Privilege Escalation, Initial Access', 'T1078 - Valid Accounts', 'Detects security issues related to NATS operator functionality including operator JWT violations, signing key issues, or attempts to impersonate operator roles which could compromise the entire NATS security model.

Next Steps:
1. Identify the source of operator security violations by checking the affected host and user accounts
2. Review NATS server logs for detailed error messages related to JWT validation failures
3. Verify operator JWT configuration and ensure signing keys are properly secured
4. Check for any unauthorized changes to operator configurations or JWT policies
5. Review access patterns to determine if this is a misconfiguration or potential attack
6. Consider rotating operator signing keys if compromise is suspected
', '["https://docs.nats.io/running-a-nats-service/configuration/securing_nats/auth_intro/jwt","https://attack.mitre.org/techniques/T1078/"]', 'safe("log.message", "").contains("operator JWT") || safe("log.message", "").contains("operator key") || safe("log.message", "").contains("operator signing") || safe("log.message", "").contains("operator claim") || safe("log.message", "").contains("invalid operator") || safe("log.message", "").contains("operator mismatch") || (safe("log.message", "").contains("operator") && (safe("log.message", "").contains("unauthorized") || safe("log.message", "").contains("denied")))', '2025-09-03 15:57:11.231781', true, false, 'origin', '["origin.host"]', '[]');
INSERT INTO public.utm_correlation_rules VALUES (756, 'NATS Publisher Flooding Attack', 1, 2, 3, 'Impact', 'T1499 - Endpoint Denial of Service: Service Exhaustion Flood', 'Detects publisher flooding attacks where a client publishes an excessive number of messages to overwhelm the NATS server or subscribers. This type of attack can degrade server performance, cause message processing delays, and potentially lead to service unavailability.

Next Steps:
1. Identify the source client using the client_id and origin IP address
2. Review the message sizes and subjects being published to determine if this is legitimate traffic
3. Check NATS server metrics for CPU, memory, and message queue saturation
4. Consider implementing rate limiting for the offending client
5. Review NATS server configuration for max_payload and max_pending settings
6. If malicious, block the client at the network level or revoke its authentication credentials
7. Monitor for any service degradation or impact on legitimate subscribers
', '["https://docs.nats.io/running-a-nats-service/configuration","https://attack.mitre.org/techniques/T1499/"]', 'safe("action", "") == "publish" && safe("log.client_id", "") != "" && safe("origin.ip", "") != ""', '2025-09-03 15:57:27.537881', true, false, 'origin', '["adversary.ip","adversary.host"]', '[{"indexPattern":"v11-log-nats-*","with":[{"field":"log.client_id.keyword","operator":"filter_term","value":"{{.log.client_id}}"},{"field":"action.keyword","operator":"filter_term","value":"publish"}],"or":null,"within":"now-1m","count":50}]');
INSERT INTO public.utm_correlation_rules VALUES (1361, 'Windows: Potential Invoke-Mimikatz PowerShell Script', 3, 3, 2, 'Credential Access', 'LSASS Memory', 'Mimikatz is a credential dumper capable of obtaining plaintext Windows account logins and passwords, along with many other features that make it useful for testing the security of networks. This rule detects Invoke-Mimikatz PowerShell script and alike.', '["https://attack.mitre.org/tactics/TA0006/","https://attack.mitre.org/techniques/T1003/","https://attack.mitre.org/techniques/T1003/001/"]', 'safe("log.message", "").matches(''(DumpCreds(.+)DumpCerts|DumpCerts(.+)DumpCreds|sekurlsa::logonpasswords|crypto::certificates(.+)CERT_SYSTEM_STORE_LOCAL_MACHINE|CERT_SYSTEM_STORE_LOCAL_MACHINE(.+)crypto::certificates)'')', '2025-09-04 20:33:04.197018', true, false, 'origin', NULL, '[]');
INSERT INTO public.utm_correlation_rules VALUES (962, 'System Linux: A user has been added to the administrators group', 3, 3, 2, 'Privilege Escalation', 'Domain Policy Modification', 'Detects when a user has been added to the administrators group (sudo) on a Linux system.', '["https://attack.mitre.org/tactics/TA0004","https://attack.mitre.org/techniques/T1484/"]', 'safe("log.message", "").matches("(((adduser|useradd|usermod)(.+)([Aa]dded user|new user|add)(.+)to(.+)group)(.+)sudo)") && safe("log.message", "").contains("usermod -aG sudo")', '2025-09-03 16:37:54.420975', true, false, 'origin', NULL, '[]');
INSERT INTO public.utm_correlation_rules VALUES (757, 'NATS Queue Group Manipulation Attack', 2, 3, 2, 'Impact', 'Resource Hijacking', 'Detects attempts to manipulate queue groups by creating conflicting subscriptions, abnormal queue patterns, or attempting to hijack message processing. Queue group manipulation can lead to message loss, duplicate processing, or unauthorized access to message streams.

Next Steps:
- Investigate the source of the queue group manipulation attempts (check origin.host and origin.ip)
- Review NATS server logs for additional context around the suspicious queue group operations
- Check if legitimate applications use similar queue group names or patterns
- Verify if any messages were lost or duplicated during the incident timeframe
- Review NATS ACL configurations and ensure proper queue group access controls
- Consider implementing stricter naming conventions for queue groups
- Monitor for any unauthorized subscriptions to sensitive subjects
', '["https://docs.nats.io/nats-concepts/subjects#queue-groups","https://attack.mitre.org/techniques/T1496/"]', 'safe("log.module", "") == "nats" && safe("log.queue_group", "") != "" && ( (safe("log.operation", "") == "SUB" && safe("log.queue_group", "").matches(".*[^a-zA-Z0-9_\\-\\.].*")) || (safe("log.error", "").contains("queue group") && safe("log.error", "").contains("conflict")) || (safe("log.message", "").contains("duplicate queue group")) || (safe("log.queue_group", "").length() > 128) || (safe("log.queue_group", "").contains("..")) || (safe("log.queue_group", "").matches("^\\s+|\\s+$")) || (safe("log.queue_group", "").matches(".*[<>\"''&;\\|\\$\\`].*")) || (safe("log.operation", "") == "UNSUB" && safe("log.queue_group", "").matches(".*\\*.*")) )', '2025-09-03 15:57:28.143734', true, false, 'origin', NULL, '[{"indexPattern":"v11-log-nats-*","with":[{"field":"origin.host.keyword","operator":"filter_term","value":"{{.origin.host}}"},{"field":"log.queue_group.keyword","operator":"filter_term","value":"{{.log.queue_group}}"}],"or":null,"within":"now-5m","count":10}]');
INSERT INTO public.utm_correlation_rules VALUES (758, 'NATS Request-Reply Hijacking Attempt', 3, 3, 2, 'Credential Access, Collection', 'T1557 - Adversary-in-the-Middle', 'Detects potential request-reply hijacking where an attacker attempts to intercept or respond to request-reply patterns by subscribing to reply subjects or manipulating inbox patterns.

Next Steps:
1. Identify the suspicious client_id and verify if it''s an authorized NATS client
2. Review the subject patterns being accessed, especially _INBOX subjects
3. Check for any unauthorized subscriptions to reply subjects
4. Investigate the source IP and host for signs of compromise
5. Review NATS server logs for permission violations or authentication failures
6. Consider implementing NATS security features like user permissions and subject-based authorization
', '["https://docs.nats.io/nats-concepts/core-nats/reqreply","https://attack.mitre.org/techniques/T1557/"]', 'safe("log.action", "") == "nats.log" && ( (safe("log.subject", "").contains("_INBOX.") && safe("log.operation", "") == "SUB" && safe("log.client_id", "") != safe("log.original_requestor", "")) || (safe("log.subject", "").startsWith("_INBOX.") && safe("log.error", "").contains("permission")) || (safe("log.message", "").contains("reply subject hijack")) || (safe("log.subject", "").contains("_INBOX.") && safe("log.queue_group", "") != "" && safe("log.operation", "") == "SUB") || (safe("log.reply_to", "") != "" && safe("log.reply_to", "").contains("_INBOX.") && safe("log.operation", "") == "PUB" && safe("log.client_id", "") != safe("log.expected_responder", "")) )', '2025-09-03 15:57:28.604861', true, false, 'origin', NULL, '[{"indexPattern":"v11-log-filebeat-nats-*","with":[{"field":"origin.host.keyword","operator":"filter_term","value":"{{.origin.host}}"},{"field":"log.operation.keyword","operator":"filter_term","value":"SUB"}],"or":null,"within":"now-10m","count":5}]');
INSERT INTO public.utm_correlation_rules VALUES (760, 'NATS Route Poisoning Detection', 3, 3, 2, 'Impact', 'T1565.002 - Data Manipulation: Transmission Data Manipulation', 'Detects attempts to poison NATS routing tables or inject malicious routes that could redirect traffic or cause cluster instability. Route poisoning can lead to traffic interception, cluster fragmentation, or denial of service.

Next Steps:
1. Identify the source node reporting the route anomaly from origin.host
2. Check NATS cluster health and verify all nodes are properly connected
3. Review recent configuration changes on affected nodes
4. Examine network connectivity between cluster nodes for potential MitM attacks
5. Check for unauthorized nodes attempting to join the cluster
6. Review route configurations across all NATS servers for consistency
7. Consider temporarily isolating suspicious nodes until investigation is complete
8. Collect and preserve logs from all cluster nodes for forensic analysis
', '["https://docs.nats.io/running-a-nats-service/configuration/clustering/cluster_config","https://attack.mitre.org/techniques/T1565/002/"]', 'safe("action", "") == "nats.log" && ( safe("log.message", "").matches(".*route.*conflict.*") || safe("log.message", "").matches(".*duplicate.*route.*") || safe("log.message", "").matches(".*invalid.*route.*") || safe("log.message", "").matches(".*route.*loop.*detected.*") || safe("log.message", "").matches(".*route.*table.*corrupt.*") || (safe("log.level", "") == "warn" || safe("log.level", "") == "error") && safe("log.message", "").matches(".*route.*") )', '2025-09-03 15:57:29.94878', true, false, 'origin', '["origin.host"]', '[{"indexPattern":"v11-log-filebeat-nats-*","with":[{"field":"origin.host.keyword","operator":"filter_term","value":"{{.origin.host}}"}],"or":null,"within":"now-30m","count":5}]');
INSERT INTO public.utm_correlation_rules VALUES (761, 'NATS Subject Injection Attack Detected', 3, 3, 1, 'Initial Access', 'T1190 - Exploit Public-Facing Application', 'Detects potential subject injection attacks in NATS messaging system where malicious patterns are injected into subject names to bypass authorization or access unauthorized topics.

Next Steps:
1. Review the source IP and host generating the suspicious subject patterns
2. Check NATS authorization configuration to ensure proper subject access controls
3. Analyze surrounding NATS traffic from the same origin for additional malicious patterns
4. Verify if the injected subject patterns resulted in unauthorized topic access
5. Consider blocking the source if confirmed malicious
6. Review and strengthen NATS subject validation and sanitization
', '["https://docs.nats.io/nats-concepts/subjects","https://attack.mitre.org/techniques/T1190/"]', 'safe("log.subject", "") != "" && (safe("log.subject", "").contains("../") || safe("log.subject", "").contains("..\\") || safe("log.subject", "").contains("%2e%2e") || safe("log.subject", "").contains("%252e%252e") || safe("log.subject", "").contains("*>") || safe("log.subject", "").contains(">*") || safe("log.subject", "").matches(".*[\\x00-\\x1f\\x7f-\\x9f].*") || safe("log.subject", "").contains("${") || safe("log.subject", "").contains("{{") || safe("log.subject", "").contains("%00") || safe("log.subject", "").contains("\\u0000"))', '2025-09-03 15:57:30.52803', true, false, 'origin', NULL, '[]');
INSERT INTO public.utm_correlation_rules VALUES (963, 'System Linux: Virtual Machine Fingerprinting', 2, 3, 1, 'Discovery', 'System Information Discovery', 'An adversary may attempt to get detailed information about the operating system and hardware. This rule identifies common locations used to discover virtual machine hardware by a non-root user. This technique has been used by the Pupy RAT and other malware.', '["https://attack.mitre.org/tactics/TA0007/","https://attack.mitre.org/techniques/T1082/"]', 'safe("log.message", "").matches("(/sys/class/dmi/id/bios_version|/sys/class/dmi/id/product_name|/sys/class/dmi/id/chassis_vendor|/proc/scsi/scsi|/proc/ide/hd0/model)")', '2025-09-03 16:37:54.82372', true, false, 'origin', NULL, '[]');
INSERT INTO public.utm_correlation_rules VALUES (775, 'Memory Exhaustion Attack', 1, 1, 3, 'Impact', 'T1499.002 - Endpoint Denial of Service: Service Exhaustion Flood', 'Detects potential memory exhaustion attacks against nginx through patterns such as large request headers, excessive POST data, or attacks targeting buffer allocation. These attacks attempt to consume server memory resources leading to service degradation or crashes.

Next Steps:
1. Check nginx error logs for memory allocation failures or worker process crashes
2. Review the source IP address for other suspicious activity or known malicious reputation
3. Monitor server memory usage and nginx worker process health
4. Consider implementing rate limiting or request size limits for the affected endpoints
5. If attack is ongoing, consider temporarily blocking the source IP at the firewall level
6. Review nginx configuration for proper buffer size limits (client_body_buffer_size, client_header_buffer_size, large_client_header_buffers)
', '["https://www.nginx.com/blog/avoiding-top-10-nginx-configuration-mistakes/","https://attack.mitre.org/techniques/T1499/002/"]', 'safe("origin.ip", "") != "" && ( (safe("log.severityLabel", "") == "error" && safe("log.message", "") != "" && ( safe("log.message", "").contains("client request body is buffered to a temporary file") || safe("log.message", "").contains("a client request body is too large") || safe("log.message", "").contains("request header is too large") || safe("log.message", "").contains("could not allocate memory") || safe("log.message", "").contains("malloc() failed") || (safe("log.message", "").contains("worker process") && safe("log.message", "").contains("exited on signal")) ) ) || (safe("statusCode", 0.0) == double(413) || safe("statusCode", 0.0) == double(414)) || (safe("log.request", "") != "" && len(log.request) > 8192 ) || (safe("log.userAgent", "") != "" && len(log.userAgent) > 1024 ) )', '2025-09-03 15:59:23.943294', true, false, 'origin', '["origin.ip"]', '[{"indexPattern":"v11-log-filebeat-nginx-*","with":[{"field":"origin.ip.keyword","operator":"filter_term","value":"{{.origin.ip}}"},{"field":"log.severityLabel.keyword","operator":"filter_term","value":"error"}],"or":null,"within":"now-10m","count":5}]');
INSERT INTO public.utm_correlation_rules VALUES (776, 'SSL/TLS Vulnerability Exploitation', 3, 3, 2, 'Credential Access, Discovery', 'T1040 - Network Sniffing', 'Detects attempts to exploit SSL/TLS vulnerabilities in nginx including protocol downgrade attacks, cipher suite manipulation, certificate validation bypass, and SSL stripping attacks. Monitors error logs for SSL handshake failures and suspicious patterns that may indicate active exploitation attempts or reconnaissance.

Next Steps:
- Review the SSL/TLS configuration in nginx.conf for weak ciphers or protocols (SSLv2, SSLv3, TLS 1.0, TLS 1.1)
- Check if the source IP has a history of malicious activity or is listed in threat intelligence feeds
- Verify certificate chain validity, expiration dates, and proper certificate binding
- Review nginx error logs for detailed SSL error messages and patterns
- Implement rate limiting for the source IP if repeated SSL attacks are detected
- Ensure TLS 1.2 or higher is enforced and weak protocols/ciphers are disabled
- Consider implementing SSL pinning and HSTS headers for additional protection
- Monitor for SSL stripping attempts and enforce HTTPS redirects
- Check for certificate transparency logs and validate certificate authenticity
- Review network traffic for signs of man-in-the-middle attacks
', '["https://nginx.org/en/docs/http/ngx_http_ssl_module.html","https://attack.mitre.org/techniques/T1040/","https://owasp.org/www-project-web-security-testing-guide/v42/4-Web_Application_Security_Testing/09-Testing_for_Weak_Cryptography/01-Testing_for_Weak_SSL_TLS_Ciphers_Insufficient_Transport_Layer_Protection"]', 'safe("origin.ip", "") != "" && ( (safe("log.message", "") != "" && ( safe("log.message", "").contains("SSL_do_handshake() failed") || safe("log.message", "").contains("SSL_shutdown() failed") || safe("log.message", "").contains("SSL certificate error") || safe("log.message", "").contains("SSL certificate verify error") || safe("log.message", "").contains("no shared cipher") || safe("log.message", "").contains("unknown protocol") || safe("log.message", "").contains("wrong version number") || safe("log.message", "").contains("decryption failed or bad record mac") || safe("log.message", "").contains("tlsv1 alert") || safe("log.message", "").contains("sslv3 alert") || safe("log.message", "").contains("SSL routines") || safe("log.message", "").contains("peer closed connection in SSL handshake") || safe("log.message", "").contains("SSL handshake failed") || safe("log.message", "").contains("certificate verify failed") )) || (safe("protocol", "") != "" && ( safe("protocol", "").contains("HTTP/1.0") || safe("protocol", "").contains("SSLv2") || safe("protocol", "").contains("SSLv3") || safe("protocol", "").contains("TLSv1.0") )) || (safe("log.request", "") != "" && ( (safe("log.request", "").contains("https://") && safe("origin.path", "") != "" && origin.path.startsWith("http://")) || safe("log.request", "").matches(".*[Ss][Ss][Ll].*[Vv][23].*") || safe("log.request", "").matches(".*[Tt][Ll][Ss].*[Vv]?1\\.[01].*") )) || (safe("log.severityLabel", "") == "error" && safe("log.message", "") != "" && (safe("log.message", "").contains("SSL") || safe("log.message", "").contains("TLS"))) )', '2025-09-03 15:59:24.521381', true, false, 'origin', '["origin.ip"]', '[]');
INSERT INTO public.utm_correlation_rules VALUES (777, 'Nginx Variable Extraction and Information Disclosure', 3, 2, 1, 'Discovery', 'System Information Discovery', 'Detects attempts to extract sensitive Nginx variables or server information through crafted requests, potentially exposing configuration details, internal paths, or environment variables.

Next Steps:
1. Review the source IP address and check if it''s from a known scanner or legitimate source
2. Examine the specific requests to identify which Nginx variables were being targeted
3. Check if any sensitive information was actually disclosed in the responses
4. Review Nginx configuration to ensure variables are not exposed in error pages or headers
5. Consider implementing rate limiting for the source IP if malicious behavior is confirmed
6. Check for other reconnaissance activity from the same IP address
', '["https://nginx.org/en/docs/varindex.html","https://attack.mitre.org/techniques/T1082/"]', '(safe("origin.path", "").contains("$") || safe("log.request", "").contains("${") || safe("log.userAgent", "").contains("$server_") || safe("log.userAgent", "").contains("$upstream_") || safe("log.referrer", "").contains("$document_root") || safe("log.request", "").contains("$request_filename") || safe("origin.path", "").contains("%24"))', '2025-09-03 15:59:24.791068', true, false, 'origin', NULL, '[]');
INSERT INTO public.utm_correlation_rules VALUES (771, 'gRPC Authentication Bypass Attempt', 3, 3, 1, 'Defense Evasion, Persistence, Privilege Escalation, Initial Access', 'T1078 - Valid Accounts', 'Detects attempts to bypass gRPC authentication mechanisms or access gRPC endpoints without proper authorization, potentially indicating unauthorized API access attempts.

Next Steps:
1. Review the source IP address and check if it''s from a known or expected location
2. Examine the user agent and request patterns to determine if this is automated tooling
3. Check nginx access logs for other requests from the same IP address
4. Verify if the gRPC endpoint being accessed should require authentication
5. Look for successful authentication attempts from the same IP after these failures
6. Consider blocking the IP if malicious activity is confirmed
7. Review gRPC service configurations and authentication requirements
8. Check for any bypass techniques or misconfigurations in authentication middleware
', '["https://nginx.org/en/docs/http/ngx_http_grpc_module.html","https://attack.mitre.org/techniques/T1078/"]', 'safe("log.method", "") == "POST" && safe("origin.path", "").contains("/grpc/") && statusCode == 401 && (safe("log.userAgent", "").contains("grpc") || safe("log.message", "").contains("grpc"))', '2025-09-03 15:59:07.185265', true, false, 'origin', '["origin.ip","origin.path"]', '[{"indexPattern":"v11-log-filebeat-nginx-*","with":[{"field":"origin.ip.keyword","operator":"filter_term","value":"{{.origin.ip}}"},{"field":"log.method.keyword","operator":"filter_term","value":"POST"}],"or":null,"within":"now-15m","count":10}]');
INSERT INTO public.utm_correlation_rules VALUES (879, 'JSON Merge Conflict Detection', 2, 3, 2, 'Impact', 'T1565 - Data Manipulation', 'Detects potential JSON merge conflicts that could indicate concurrent update attacks or data integrity issues. Multiple clients attempting to update the same JSON resource simultaneously can lead to data corruption or loss. This pattern may indicate coordinated attacks attempting to manipulate data or exploit race conditions in concurrent update mechanisms.

Next Steps:
1. Investigate the source IP addresses involved in the merge conflicts
2. Review the timing and frequency of conflicts to identify patterns
3. Check if the affected resource_id contains sensitive data
4. Verify application logs for signs of exploitation or data corruption
5. Review authentication logs for the involved users/sessions
6. Consider implementing stronger concurrency controls or optimistic locking
', '["https://medium.com/@AlexanderObregon/handling-json-merge-conflicts-in-concurrent-updates-276d1bdc4a82","https://attack.mitre.org/techniques/T1565/"]', '(safe("log.error", "") == "merge_conflict" || safe("log.status", 0.0) == double(409) || safe("log.message", "").contains("version mismatch") || safe("log.error_type", "") == "concurrent_modification" || safe("log.conflict_type", "") == "merge" || (safe("log.response_code", 0.0) == double(409) && safe("log.resource_type", "") == "json"))', '2025-09-03 16:29:38.482908', true, false, 'origin', NULL, '[]');
INSERT INTO public.utm_correlation_rules VALUES (762, 'NATS Unauthorized Subscription Attempt', 3, 2, 1, 'Defense Evasion, Persistence, Privilege Escalation, Initial Access', 'T1078 - Valid Accounts: Privilege Escalation', 'Detects attempts to subscribe to subjects that result in authorization violations, indicating potential unauthorized access attempts to restricted topics in NATS messaging system.

Next Steps:
1. Identify the client attempting unauthorized subscriptions using client_id and source IP
2. Review which subjects the client attempted to access and determine sensitivity
3. Check if this client has legitimate access needs and if permissions need adjustment
4. Investigate if this is part of a broader reconnaissance or lateral movement attempt
5. Review NATS authorization configuration to ensure proper subject-based permissions
6. Consider blocking the client if malicious intent is confirmed
', '["https://docs.nats.io/running-a-nats-service/configuration/securing_nats/authorization","https://attack.mitre.org/techniques/T1078/"]', '(safe("log.error", "").contains("permissions violation") || safe("log.error", "").contains("authorization violation") || safe("log.message", "").contains("Permissions Violation for Subscription") || safe("log.message", "").contains("Authorization Violation")) && safe("log.action", "") == "nats.log" && (safe("log.operation", "") == "SUB" || safe("log.msg_type", "") == "SUB" || safe("log.event_type", "") == "subscription")', '2025-09-03 15:57:31.001784', true, false, 'origin', '["adversary.host","log.client_id","log.subject"]', '[{"indexPattern":"v11-log-filebeat-nats-*","with":[{"field":"origin.host.keyword","operator":"filter_term","value":"{{.origin.host}}"},{"field":"log.client_id.keyword","operator":"filter_term","value":"{{.log.client_id}}"}],"or":null,"within":"now-15m","count":5}]');
INSERT INTO public.utm_correlation_rules VALUES (763, 'Access Log Tampering Detection', 2, 3, 1, 'Defense Evasion', 'T1070.002 - Indicator Removal: Clear Linux or Mac System Logs', 'Detects attempts to tamper with or manipulate nginx access logs, including attempts to inject null bytes, control characters, or malformed entries that could be used to hide malicious activity or corrupt log files. This could indicate an attacker trying to evade detection or cover their tracks.

Next Steps:
1. Investigate the source IP address (origin.ip) for other suspicious activities
2. Review nginx access logs around the time of the alert for any gaps or anomalies
3. Check if the user agent string appears legitimate or contains injection attempts
4. Examine the full request URI for signs of exploitation attempts
5. Verify nginx log file integrity and permissions on the affected server
6. Look for any process modifications to nginx or log rotation scripts
7. Consider blocking the source IP if malicious intent is confirmed
', '["https://attack.mitre.org/techniques/T1070/002/","https://nginx.org/en/docs/http/ngx_http_log_module.html"]', 'safe("origin.ip", "") != "" && ( safe("log.message", "").matches(".*\\x00.*") || safe("log.message", "").matches(".*\\r\\n.*\\r\\n.*") || safe("log.message", "").matches(".*\\\\x[0-9a-fA-F]{2}.*") || safe("log.userAgent", "").matches(".*\\$\\{.*\\}.*") || safe("log.userAgent", "").matches(".*\\x00.*") || safe("log.request", "").matches(".*\\n.*\\n.*") || safe("log.request", "").matches(".*\\\\x[0-9a-fA-F]{2}.*") || safe("origin.path", "").matches(".*\\.\\./\\.\\./.*") || safe("log.referrer", "").matches(".*\\x00.*") || safe("log.referrer", "").matches(".*\\\\x[0-9a-fA-F]{2}.*") )', '2025-09-03 15:59:03.448535', true, false, 'origin', '["origin.ip","log.userAgent"]', '[]');
INSERT INTO public.utm_correlation_rules VALUES (764, 'Bandwidth Exhaustion Attack', 1, 1, 3, 'Impact', 'T1498.001 - Network Denial of Service: Direct Network Flood', 'Detects bandwidth exhaustion attacks where attackers consume excessive network resources through large requests, slow reads, or repetitive large file downloads. This rule identifies patterns of abnormally high data transfer from single sources.

Next Steps:
1. Review the source IP address and determine if it''s legitimate traffic or an attack
2. Check nginx access logs for the specific requests from this IP
3. Analyze the user agent string and requested resources to identify patterns
4. Consider implementing rate limiting or blocking the source IP if malicious
5. Review server resource utilization (CPU, memory, network) during the event
6. Check if multiple IPs are involved indicating a distributed attack
', '["https://blog.nginx.org/blog/mitigating-ddos-attacks-with-nginx-and-nginx-plus","https://attack.mitre.org/techniques/T1498/001/"]', 'safe("origin.bytesReceived", 0.0) > 1048576.0 && safe("origin.ip", "") != "" && ((safe("log.userAgent", "") != "" && (safe("log.userAgent", "").contains("bot") || safe("log.userAgent", "").contains("crawler") || safe("log.userAgent", "").contains("scanner") || safe("log.userAgent", "") == "-")) || (safe("log.method", "") != "" && (safe("log.method", "") == "GET" || safe("log.method", "") == "POST") && safe("log.statusCode", 0.0) == double(200)) || (safe("origin.path", "") != "" && (safe("origin.path", "").contains(".zip") || safe("origin.path", "").contains(".tar") || safe("origin.path", "").contains(".gz") || safe("origin.path", "").contains(".iso") || safe("origin.path", "").contains(".mp4") || safe("origin.path", "").contains(".avi"))))', '2025-09-03 15:59:03.86829', true, false, 'origin', '["origin.ip"]', '[{"indexPattern":"v11-log-nginx-*","with":[{"field":"origin.ip.keyword","operator":"filter_term","value":"{{.origin.ip}}"}],"or":null,"within":"now-5m","count":20}]');
INSERT INTO public.utm_correlation_rules VALUES (765, 'Nginx Buffer Overflow Attack', 2, 2, 3, 'Impact', 'T1499.004 - Endpoint Denial of Service: Application or System Exploitation', 'Detects potential buffer overflow attacks against nginx including chunked transfer encoding exploits, range header attacks, and excessive hexadecimal payloads. Monitors for abnormally large headers, malformed chunked requests, and suspicious hex patterns.

Next Steps:
- Immediately isolate the affected nginx server if the attack appears successful
- Check nginx error logs for worker process crashes or memory corruption indicators
- Review the source IP address for other malicious activity across your infrastructure
- Examine the full request payload to identify the specific attack vector used
- Update nginx to the latest version if running an outdated or vulnerable version
- Consider implementing rate limiting and request size restrictions
- Enable core dumps to analyze any worker process crashes for forensic analysis
', '["https://www.acunetix.com/vulnerabilities/web/nginx-stack-based-buffer-overflow/","https://attack.mitre.org/techniques/T1499/"]', 'safe("origin.ip", "") != "" && ( (safe("log.message", "") != "" && size(log.message) > 8192) || (safe("log.userAgent", "") != "" && size(log.userAgent) > 1024) || (safe("log.referrer", "") != "" && size(log.referrer) > 1024) || (safe("origin.path", "") != "" && ( safe("origin.path", "").contains("AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA") || safe("origin.path", "").contains("0x") && size(origin.path) > 200 )) || (safe("log.message", "") != "" && ( safe("log.message", "").contains("client intended to send too large body") || safe("log.message", "").contains("recv() failed") || safe("log.message", "").contains("upstream sent too big header") || (safe("log.message", "").contains("worker process") && safe("log.message", "").contains("exited on signal")) )) || (safe("log.severityLabel", "") == "error" && safe("log.message", "") != "" && safe("log.message", "").contains("buffer")) )', '2025-09-03 15:59:04.508622', true, false, 'origin', NULL, '[]');
INSERT INTO public.utm_correlation_rules VALUES (1362, 'Windows: Modification of Boot Configuration', 1, 3, 3, 'Impact', 'Inhibit System Recovery', 'Identifies use of bcdedit.exe to delete boot configuration data. This tactic is sometimes used as by malware or an attacker as a destructive technique.', '["https://attack.mitre.org/tactics/TA0040/","https://attack.mitre.org/techniques/T1490/"]', 'safe("log.winlogEventDataProcessName", "").contains(''bcdedit.exe'') && safe("log.message", "").matches(''((ignoreallfailures(.+)bootstatuspolicy(.+)/set)|(ignoreallfailures(.+)/set(.+)bootstatuspolicy)|(/set(.+)bootstatuspolicy(.+)ignoreallfailures)|(/set(.+)ignoreallfailures(.+)bootstatuspolicy)|(bootstatuspolicy(.+)set(.+)ignoreallfailures)|(bootstatuspolicy(.+)ignoreallfailures(.+)/set)|(no(.+)recoveryenabled)|(recoveryenabled(.+)no))'')', '2025-09-04 20:33:04.469877', true, false, 'origin', NULL, '[]');
INSERT INTO public.utm_correlation_rules VALUES (767, 'Connection Limit Bypass Attempt', 1, 1, 3, 'Impact', 'Resource Exhaustion', 'Detects attempts to bypass nginx connection limits through various techniques including rapid connection cycling, keepalive manipulation, or exploiting configuration weaknesses. These attacks aim to exhaust server resources by circumventing rate limiting controls.

Next Steps:
1. Review nginx connection limit configuration in nginx.conf (limit_conn_zone and limit_conn directives)
2. Check if the source IP is legitimate or part of a distributed attack
3. Analyze request patterns from the source IP for signs of automated tools
4. Consider implementing additional rate limiting or blocking the source IP temporarily
5. Review server resource utilization (CPU, memory, connections) during the incident
6. Check for any successful bypasses by examining successful requests from the same IP
7. Examine nginx error logs for related connection limit errors from the same timeframe
8. Consider implementing additional mitigation strategies such as fail2ban or upstream rate limiting
', '["https://nginx.org/en/docs/http/ngx_http_limit_conn_module.html","https://attack.mitre.org/techniques/T1499/"]', '( (safe("log.severityLabel", "") == "error" && safe("log.message", "") != "" && ( safe("log.message", "").contains("limiting connections by zone") || safe("log.message", "").contains("limiting requests") || safe("log.message", "").contains("client exceeded limit_conn") || safe("log.message", "").contains("limiting connections, dry run") || safe("log.message", "").contains("connection limit exceeded") ) ) || (safe("statusCode", 0.0) == double(503) && safe("log.message", "") != "" && safe("log.message", "").contains("Service Temporarily Unavailable") ) || (safe("statusCode", 0.0) == double(429) && safe("log.message", "") != "" && safe("log.message", "").contains("denied") ) ) && safe("origin.ip", "") != ""', '2025-09-03 15:59:05.486474', true, false, 'origin', '["adversary.ip"]', '[{"indexPattern":"v11-log-nginx-*","with":[{"field":"origin.ip.keyword","operator":"filter_term","value":"{{.origin.ip}}"},{"field":"log.statusCode","operator":"filter_term","value":"429"}],"or":null,"within":"now-1m","count":50}]');
INSERT INTO public.utm_correlation_rules VALUES (768, 'CPU Exhaustion Attack Pattern', 1, 1, 3, 'Impact', 'T1499 - Endpoint Denial of Service: Service Exhaustion Flood', 'Detects CPU exhaustion attack patterns targeting nginx, including HTTP/2 vulnerabilities, complex regex processing, compression bombs, and SSL/TLS renegotiation attacks that consume excessive CPU resources.

Next Steps:
- Check nginx error logs for additional SSL handshake failures or worker process issues
- Monitor server CPU usage and identify if specific patterns correlate with high CPU spikes
- Review access logs for the source IP to identify attack patterns
- Consider implementing rate limiting or connection limits for the attacking IP
- Analyze if the requests match known CVE patterns for nginx vulnerabilities
- Check if HTTP/2 is necessary or if it can be temporarily disabled during the attack
- Verify nginx configuration for SSL renegotiation settings and regex timeout limits
- Examine if compression is properly configured to prevent decompression bombs
- Review upstream server connections if applicable for worker process issues
', '["https://www.cybersecurity-help.cz/vulnerabilities/20196/","https://attack.mitre.org/techniques/T1499/"]', 'safe("origin.ip", "") != "" && ( (safe("log.severityLabel", "") == "error" && safe("log.message", "") != "" && ( safe("log.message", "").contains("SSL_do_handshake() failed") || safe("log.message", "").contains("peer closed connection in SSL handshake") || safe("log.message", "").contains("SSL renegotiation disabled") || safe("log.message", "").contains("decompression failed") || (safe("log.message", "").contains("regex") && safe("log.message", "").contains("timed out")) || (safe("log.message", "").contains("worker process") && safe("log.message", "").contains("respawned")) ) ) || (safe("protocol", "") == "HTTP/2.0" && safe("log.statusCode", "") != "" && int(safe("log.statusCode", "0")) >= 400 && safe("log.message", "") != "" && ( safe("log.message", "").contains("client sent invalid") || safe("log.message", "").contains("HTTP/2 error") ) ) || (safe("log.request", "") != "" && ( log.request.matches(".*%.*%.*%.*") || log.request.matches(".*\\.\\./.*\\.\\./.*\\.\\./.*") ) ) )', '2025-09-03 15:59:05.897559', true, false, 'origin', '["origin.ip"]', '[{"indexPattern":"v11-log-nginx-*","with":[{"field":"origin.ip.keyword","operator":"filter_term","value":"{{.origin.ip}}"}],"or":null,"within":"now-5m","count":30}]');
INSERT INTO public.utm_correlation_rules VALUES (769, 'Error Log Injection Attack', 3, 3, 2, 'Initial Access', 'T1190 - Exploit Public-Facing Application', 'Detects error log injection attempts where attackers try to inject malicious content into nginx error logs to execute code, hide activity, or cause log corruption through specially crafted requests or headers.

Next Steps:
1. Review the source IP address and check if it''s a known malicious actor
2. Examine the full log entries to understand the injection attempt pattern
3. Check other nginx logs from the same IP for additional suspicious activity
4. Review nginx configuration to ensure proper input validation and sanitization
5. Consider blocking the source IP if malicious intent is confirmed
6. Look for any signs of successful exploitation or compromise
7. Update WAF rules to block similar injection patterns
8. Check for any successful log corruption or tampering
9. Review access logs for related suspicious requests from the same source
', '["https://attack.mitre.org/techniques/T1190/","https://nginx.org/en/docs/ngx_core_module.html#error_log"]', 'safe("origin.ip", "") != "" && ((safe("log.severityLabel", "") == "error" || safe("log.severityLabel", "") == "critical") && (safe("log.message", "").contains("<script") || safe("log.message", "").contains("${jndi:") || safe("log.message", "").contains("\\x") || safe("log.message", "").contains("\r\n\r\n") || safe("log.message", "").contains("\\u") || safe("log.request", "").contains("%0d%0a") || safe("log.request", "").contains("%0D%0A") || safe("log.userAgent", "").contains("$(") || safe("log.referrer", "").contains("javascript:") || (safe("log.message", "").contains("client") && safe("log.message", "").contains("sent invalid"))))', '2025-09-03 15:59:06.38145', true, false, 'origin', NULL, '[]');
INSERT INTO public.utm_correlation_rules VALUES (770, 'Nginx FastCGI Exploitation Attempt', 3, 3, 2, 'Initial Access', 'T1190 - Exploit Public-Facing Application', 'Detects FastCGI exploitation attempts including path traversal, SCRIPT_FILENAME injection, and CVE-2019-11043 PHP-FPM/nginx RCE patterns. These attacks can lead to remote code execution and complete server compromise.

Next Steps:
1. Immediately block the source IP at the firewall level
2. Review all nginx access logs from the same IP for additional exploitation attempts
3. Check if the PHP-FPM service is exposed and properly configured
4. Verify nginx configuration for proper FastCGI security settings
5. Look for any signs of successful exploitation (new processes, files, or network connections)
6. Apply security patches for nginx and PHP-FPM if not up to date
7. Consider implementing a Web Application Firewall (WAF) to filter malicious requests
8. Check for any unusual file modifications or new files created on the server
9. Monitor system processes for any suspicious PHP or shell processes
10. Review recent nginx error logs for additional attack indicators
', '["https://nextcloud.com/blog/urgent-security-issue-in-nginx-php-fpm/","https://attack.mitre.org/techniques/T1190/"]', '(safe("origin.path", "").contains(".php") && safe("origin.path", "").matches(".*(\\.\\.[\\/\\\\]|%2e%2e).*") || (safe("log.request", "").contains("SCRIPT_FILENAME") && safe("log.request", "").contains("../") || (safe("origin.path", "").matches(".*\\.php[\\/\\\\].*\\.php.*") || (safe("log.message", "").contains("FastCGI sent in stderr") && safe("log.severityLabel", "") == "error") || (safe("origin.path", "").contains(".php") && safe("origin.path", "").contains("%00") || (safe("log.request", "").matches(".*\\.php.*[\\/\\\\]?.*\\?.*=.*\\.php.*") || (safe("log.statusCode", 0.0) == double(502) && safe("log.message", "").contains("fastcgi") || (safe("log.userAgent", "").contains("python") && safe("origin.path", "").contains(".php") && safe("log.statusCode", 0) >= 400)', '2025-09-03 15:59:06.775195', true, false, 'origin', '["origin.ip"]', '[]');
INSERT INTO public.utm_correlation_rules VALUES (1363, 'Windows: Mounting Hidden or WebDav Remote Shares', 3, 2, 1, 'Lateral Movement', 'SMB/Windows Admin Shares', 'Identifies the use of net.exe to mount a WebDav or hidden remote share. This may indicate lateral movement or preparation for data exfiltration.', '["https://attack.mitre.org/tactics/TA0008/","https://attack.mitre.org/techniques/T1021/002/"]', 'safe("log.winlogEventDataProcessName", "").matches(''(net.exe|net1.exe)'') && safe("log.message", "").matches(''(\\\\(.+)\\(.+)$|\\\\(.+)@SSL\\|http)'') && safe("log.message", "").contains(''/d'') && safe("log.message", "").contains(''use'') && !(safe("log.winlogEventDataParentProcessName", "").contains(''net.exe''))', '2025-09-04 20:33:04.810544', true, false, 'origin', NULL, '[]');
INSERT INTO public.utm_correlation_rules VALUES (772, 'Nginx Load Balancer Manipulation Attack', 2, 3, 3, 'Impact', 'T1499.002 - Endpoint Denial of Service: Service Exhaustion Flood', 'Detects attempts to manipulate nginx load balancer behavior through upstream health check bypass, false positive responses, or timing exploitation. This can lead to service disruption by causing legitimate upstream servers to be marked as unhealthy or by exhausting connection pools.

Next Steps:
1. Review nginx upstream configuration and health check settings
2. Verify if the source IP is authorized to access health check endpoints
3. Check nginx error logs for corresponding upstream failures
4. Monitor upstream server status and response times
5. Consider implementing rate limiting on health check endpoints
6. Review load balancer algorithm settings for potential abuse
7. Analyze request patterns and user agents for suspicious activity
8. Implement monitoring for upstream server availability patterns
', '["https://docs.nginx.com/nginx/admin-guide/load-balancer/http-health-check/","https://attack.mitre.org/techniques/T1499/002/"]', '(safe("log.message", "").contains("upstream") && (safe("log.message", "").contains("failed") || safe("log.message", "").contains("timeout") || safe("log.message", "").contains("unavailable"))) || (statusCode == 504 && safe("log.message", "").contains("upstream")) || (safe("log.message", "").contains("no live upstreams") && safe("log.severityLabel", "") == "error") || (safe("log.message", "").contains("upstream server temporarily disabled")) || (safe("log.message", "").contains("upstream prematurely closed connection")) || (safe("origin.path", "") == "/" && (safe("log.userAgent", "").contains("health") || safe("log.userAgent", "").contains("check") || safe("log.userAgent", "").contains("monitor") || safe("log.userAgent", "").contains("probe")) && statusCode == 200)', '2025-09-03 15:59:07.803099', true, false, 'origin', '["origin.ip","target.ip"]', '[{"indexPattern":"v11-log-nginx-*","with":[{"field":"origin.ip.keyword","operator":"filter_term","value":"{{.origin.ip}}"},{"field":"log.message","operator":"filter_match","value":"upstream"}],"or":null,"within":"now-10m","count":15}]');
INSERT INTO public.utm_correlation_rules VALUES (773, 'Location Block Security Bypass', 3, 3, 1, 'Privilege Escalation', 'T1068 - Exploitation for Privilege Escalation', 'Detects attempts to bypass nginx location block security restrictions through path traversal, case sensitivity exploits, or Unicode normalization attacks to access protected directories or resources.

Next Steps:
1. Review nginx access logs around the time of the alert to identify the full request pattern and any successful access attempts
2. Check if the attacker successfully accessed protected resources by examining HTTP status codes (200-299) in subsequent requests
3. Examine the source IP for additional suspicious activities, reconnaissance attempts, or vulnerability scanning patterns
4. Review nginx configuration files to ensure proper location block security settings and access controls
5. Check for any data exfiltration or further exploitation following successful bypasses, including file downloads or configuration changes
6. Consider implementing additional WAF rules, request filtering, or rate limiting for the source IP address
7. Update nginx configuration to properly handle Unicode normalization, case sensitivity, and path traversal protection
8. Verify that sensitive directories like .git, .htaccess, admin panels, and API endpoints have proper access restrictions
9. Monitor for any privilege escalation attempts or unauthorized administrative actions from the same source
10. Review system logs for any configuration changes or file modifications that occurred around the same timeframe
', '["https://attack.mitre.org/techniques/T1068/","https://nginx.org/en/docs/http/ngx_http_core_module.html#location"]', 'safe("origin.ip", "") != "" && safe("origin.path", "") != "" && ( safe("origin.path", "").matches(".*/[Aa][Dd][Mm][Ii][Nn].*" && safe("log.statusCode", 0.0) == double(200) && origin.path != "/admin") || safe("origin.path", "").matches("\\.\\.[/\\\\]private.*") && safe("log.actionResult", "") == "accepted" || safe("origin.path", "").matches("%[Cc]0%[Aa][Ff].*") || safe("origin.path", "").matches("%[Ee]0%80%[Aa][Ff].*") || safe("origin.path", "").matches("\\\\[uU][0-9a-fA-F]{4}.*") || (safe("origin.path", "").matches(".*/api/v[0-9]/internal.*") && safe("log.referrer", "") == "-") || (safe("origin.path", "").matches(".*/\\.ht.*") && safe("log.statusCode", 0) < 400) || (safe("origin.path", "").matches(".*[/\\\\]\\$.*") && safe("log.statusCode", 0.0) == double(200)) || (safe("log.request", "").matches(".*[Pp][Uu][Tt].*") && safe("origin.path", "").matches(".*/config.*")) || (safe("origin.path", "").matches(".*/\\.git.*") && safe("log.statusCode", 0) != 404) )', '2025-09-03 15:59:22.847056', true, false, 'origin', '["origin.ip"]', '[{"indexPattern":"v11-log-nginx-*","with":[{"field":"origin.ip.keyword","operator":"filter_term","value":"{{.origin.ip}}"},{"field":"actionResult.keyword","operator":"filter_term","value":"accepted"}],"or":null,"within":"now-20m","count":5}]');
INSERT INTO public.utm_correlation_rules VALUES (778, 'ATC Table Exploitation Attempt', 3, 2, 1, 'Credential Access', 'T1555 - Credentials from Password Stores', 'Detects potential exploitation of Auto Table Construction (ATC) feature to access sensitive SQLite databases. Monitors for queries targeting browser credentials, keychains, or other sensitive application databases that could expose PII or credentials.

Next Steps:
1. Identify the user and host involved in the ATC query
2. Review the specific query details to determine what sensitive data was accessed
3. Check if this is part of authorized security testing or administrative activity
4. Investigate any other suspicious activities from the same user/host in the same timeframe
5. If unauthorized, consider rotating potentially exposed credentials
6. Review osquery configuration to ensure ATC is properly restricted
', '["https://www.kolide.com/blog/how-to-build-custom-osquery-tables-using-atc","https://attack.mitre.org/techniques/T1555/"]', 'safe("log.eventName", "") == "auto_table_construction" && (safe("log.message", "").contains("password") || safe("log.message", "").contains("keychain") || safe("log.message", "").contains("login_data") || safe("log.message", "").contains("cookies") || safe("log.message", "").contains("history") || safe("log.message", "").contains("chrome") || safe("log.message", "").contains("firefox") || safe("log.message", "").contains("safari") || safe("origin.path", "").contains("Login Data") || safe("origin.path", "").contains("Cookies") || safe("origin.path", "").contains("History") || safe("origin.path", "").contains("keychain"))', '2025-09-03 16:01:20.889389', true, false, 'origin', '["origin.host","origin.user"]', '[]');
INSERT INTO public.utm_correlation_rules VALUES (1364, 'Windows: MS DTC run out of memory', 1, 2, 3, 'Impact', 'Endpoint Denial of Service', 'Detects that the Microsoft Distributed Transaction Coordinator (MS DTC) has exhausted its available memory.  MS DTC is a component of the Windows operating system that facilitates the coordination of distributed transactions between applications and databases.', '["https://attack.mitre.org/tactics/TA0040/","https://attack.mitre.org/techniques/T1499/"]', 'safe("log.winlogProviderName", "") == "Microsoft-Windows-MSDTC" && safe("log.eventCode", 0.0) == double(4103)', '2025-09-04 20:33:05.230085', true, false, 'origin', NULL, '[]');
INSERT INTO public.utm_correlation_rules VALUES (1402, 'Windows: Suspicious Portable Executable Encoded in Powershell Script', 2, 3, 1, 'Execution', 'Command and Scripting Interpreter', 'Detects the presence of a portable executable (PE) in a PowerShell script by looking for its encoded header. Attackers embed PEs into PowerShell scripts to inject them into memory, avoiding defences by not writing to disk.', '["https://attack.mitre.org/tactics/TA0002/","https://attack.mitre.org/techniques/T1059/"]', 'safe("log.message", "").contains("TVqQAAMAAAAEAAAA")', '2025-09-04 20:52:51.415064', true, false, 'origin', NULL, '[]');
INSERT INTO public.utm_correlation_rules VALUES (810, 'Redis Bitmap Operation Attack Detection', 2, 3, 3, 'Resource Development', 'T1587 - Develop Capabilities', 'Detects potential attacks using Redis bitmap operations (BITOP, BITFIELD, SETBIT) that could be used for unauthorized access control manipulation, permission escalation, or resource exhaustion through excessive bit operations. This rule identifies suspicious patterns in Redis bitmap commands that may indicate malicious activity.

Next Steps:
1. Review the specific bitmap operations being performed and their frequency
2. Check if the source host is authorized to perform these operations
3. Verify if the bitmap operations align with normal application behavior
4. Look for patterns of permission or access control manipulation
5. Monitor Redis memory usage for signs of resource exhaustion
6. Review application logs for correlated suspicious activities
7. Consider implementing rate limiting for bitmap operations if abuse is confirmed
8. Analyze the context and timing of bitmap operations for anomalies
', '["https://redis.io/docs/latest/commands/bitop/","https://redis.io/docs/latest/commands/bitfield/","https://attack.mitre.org/techniques/T1587/"]', 'safe("log.msg", "") != "" && ( safe("log.msg", "").contains("BITOP") || safe("log.msg", "").contains("BITFIELD") || (safe("log.msg", "").contains("SETBIT") && safe("log.levelEnc", "") == "warning") ) && safe("origin.host", "") != ""', '2025-09-03 16:11:46.040079', true, false, 'origin', NULL, '[]');
INSERT INTO public.utm_correlation_rules VALUES (779, 'Osquery Configuration Refresh Attack', 2, 3, 2, 'Persistence, Privilege Escalation', 'T1543 - Create or Modify System Process', 'Detects suspicious configuration refresh patterns that could indicate attempts to inject malicious configurations, disable security queries, or manipulate osquery behavior through configuration tampering.

Next Steps:
1. Review the osquery configuration files on the affected host for unauthorized changes
2. Check osquery daemon logs for additional error details and timestamps
3. Verify the integrity of osquery configuration sources (file paths, remote endpoints)
4. Review system audit logs for unauthorized access to osquery configuration files
5. Check for other suspicious processes or activities on the affected host around the same time
6. Ensure osquery configuration files have proper permissions and are not world-writable
7. Consider temporarily reverting to a known-good configuration backup
', '["https://osquery.readthedocs.io/en/stable/deployment/configuration/","https://attack.mitre.org/techniques/T1543/"]', 'safe("log.action", "") == "osquery.status" && (safe("log.message", "").matches("(?i)(config.*refresh.*fail|config.*invalid|config.*error)" || safe("log.message", "").matches("(?i)(config.*inject|malformed.*config|config.*tamper)" || safe("log.eventName", "").matches("(?i)(config.*reload.*error|config.*update.*fail)" || (safe("log.actionResult", "") == "error" && safe("log.message", "").matches("(?i)config.*refresh") || safe("log.message", "").matches("(?i)(unauthorized.*config|config.*unauthorized|config.*permission.*denied)")', '2025-09-03 16:01:21.317442', true, false, 'origin', '["origin.host"]', '[{"indexPattern":"v11-log-filebeat-*","with":[{"field":"origin.host.keyword","operator":"filter_term","value":"{{.origin.host}}"},{"field":"log.action.keyword","operator":"filter_term","value":"osquery.status"}],"or":null,"within":"now-20m","count":4}]');
INSERT INTO public.utm_correlation_rules VALUES (780, 'Osquery Decorator Bypass Attempt', 3, 3, 2, 'Defense Evasion', 'T1070 - Indicator Removal', 'Detects attempts to bypass or disable osquery decorators which are used to add contextual information to query results. Attackers may try to remove decorators to hide their activities or reduce the amount of forensic information collected.

Next Steps:
1. Investigate the source of the decorator modification attempt
2. Review osquery configuration files for unauthorized changes
3. Check for other signs of tampering with security tools on the affected host
4. Examine recent query results to see if decorator information is missing
5. Review user and process activity around the time of the alert
6. Verify if this was part of legitimate maintenance or configuration update
', '["https://osquery.readthedocs.io/en/stable/deployment/configuration/","https://attack.mitre.org/techniques/T1070/"]', '(safe("log.eventName", "").contains("decorator") || safe("log.action", "").contains("decorator") || (safe("log.message", "").contains("decorator") || safe("log.message", "").contains("decorations"))) && (safe("log.actionResult", "") == "removed" || safe("log.message", "").contains("bypass") || safe("log.message", "").contains("disable") || safe("log.message", "").contains("empty") || safe("log.message", "").contains("null") || safe("log.message", "").contains("clear") || safe("log.message", "").contains("delete")) && safe("origin.hostname", "") != "" && safe("log.agentVersion", "") != ""', '2025-09-03 16:01:21.7648', true, false, 'origin', '["origin.hostname","log.agentVersion"]', '[]');
INSERT INTO public.utm_correlation_rules VALUES (781, 'Osquery Distributed Query Injection Attack', 3, 3, 1, 'Execution', 'T1059 - Command and Scripting Interpreter', 'Detects potential SQL injection attempts in osquery distributed queries. Attackers may exploit improper input validation to execute unauthorized queries, potentially accessing sensitive system information or performing malicious enumeration.

Next Steps:
1. Review the suspicious query content in the log message for SQL injection patterns
2. Identify the source host and user account involved in the query execution
3. Check for any unauthorized data access or system enumeration attempts
4. Review osquery configuration for proper input validation and sanitization
5. Investigate if similar injection attempts occurred from the same source
6. Consider temporarily disabling distributed queries for the affected host if compromise is suspected
7. Examine osquery logs for additional evidence of compromise or lateral movement
8. Review network traffic from the affected host for suspicious communications
', '["https://www.invicti.com/blog/web-security/osquery-injection/","https://attack.mitre.org/techniques/T1059/"]', '(safe("log.eventName", "") == "distributed" || safe("log.eventName", "") == "query" || safe("log.eventName", "") == "schedule" || safe("log.action", "") == "osquery.distributed") && (safe("log.message", "").contains("UNION") || safe("log.message", "").contains("SELECT") || safe("log.message", "").contains("DROP") || safe("log.message", "").contains("--") || safe("log.message", "").contains("/*") || safe("log.message", "").contains("*/") || safe("log.message", "").contains("'';") || safe("log.message", "").contains(''";'') || safe("log.query", "").contains("UNION") || safe("log.query", "").contains("SELECT") || safe("log.query", "").contains("''") || safe("log.query", "").contains(''"'')) && safe("origin.host", "") != ""', '2025-09-03 16:01:22.174628', true, false, 'origin', '["origin.host"]', '[]');
INSERT INTO public.utm_correlation_rules VALUES (782, 'Osquery Enrollment Failure Detection', 1, 3, 3, 'Defense Evasion', 'T1562.001 - Impair Defenses: Disable or Modify Tools', 'Detects enrollment failures or issues with osquery fleet management which could indicate tampering with the monitoring infrastructure or attempts to evade detection. Multiple enrollment failures may suggest an attacker is trying to disable osquery monitoring or that the endpoint has been compromised.

Next Steps:
1. Immediately verify the osquery service status and configuration on the affected host
2. Check enrollment certificates and keys for tampering or expiration
3. Review system audit logs for unauthorized administrative activities during enrollment timeframe
4. Validate network connectivity and firewall rules between the host and fleet management server
5. Examine osquery configuration files for unauthorized modifications
6. Check for signs of endpoint compromise including other disabled security tools
7. Verify fleet server health and enrollment policies
8. If tampering is confirmed, isolate the host and initiate incident response procedures
9. Review enrollment logs on the fleet server for additional context
10. Consider rotating enrollment certificates if compromise is suspected
', '["https://osquery.readthedocs.io/en/stable/deployment/logging/","https://attack.mitre.org/techniques/T1562/001/"]', 'safe("log.action", "") == "osquery.status" && ( safe("log.message", "").matches("(?i)(enroll.*fail|enrollment.*error|enroll.*denied)") || safe("log.message", "").matches("(?i)(fleet.*enroll.*fail|tls.*enroll.*error)") || safe("log.eventName", "").matches("(?i)(enrollment.*failure|enroll.*reject)") || (safe("log.actionResult", "") == "failed" && safe("log.message", "").matches("(?i)enroll")) || safe("log.message", "").matches("(?i)(certificate.*invalid.*enroll|enroll.*certificate.*fail)") )', '2025-09-03 16:01:22.565152', true, false, 'origin', '["origin.host"]', '[{"indexPattern":"v11-log-filebeat-osquery-*","with":[{"field":"origin.host.keyword","operator":"filter_term","value":"{{.origin.host}}"},{"field":"log.action.keyword","operator":"filter_term","value":"osquery.status"}],"or":null,"within":"now-1h","count":3}]');
INSERT INTO public.utm_correlation_rules VALUES (1403, 'Windows: Potential Process Injection via PowerShell', 3, 3, 2, 'Defense Evasion', 'Process Injection', 'Detects the use of Windows API functions that are commonly abused by malware and security tools to load malicious code or inject it into remote processes.', '["https://attack.mitre.org/tactics/TA0005/","https://attack.mitre.org/techniques/T1055/"]', 'safe("log.message", "").matches("(WriteProcessMemory|CreateRemoteThread|NtCreateThreadEx|CreateThread|QueueUserAPC|SuspendThread|ResumeThread|GetDelegateForFunctionPointer)") && safe("log.message", "").matches("(VirtualAlloc|VirtualAllocEx|VirtualProtect|LdrLoadDll|LoadLibrary|LoadLibraryA|LoadLibraryEx|GetProcAddress|OpenProcess|OpenProcessToken|AdjustTokenPrivileges)")', '2025-09-04 20:52:51.81618', true, false, 'origin', NULL, '[]');
INSERT INTO public.utm_correlation_rules VALUES (783, 'Osquery Event Publisher Attack Detected', 2, 2, 1, 'Impact', 'T1489 - Service Stop', 'Detects potential attacks against osquery event publishers including failed setup attempts, misconfiguration exploitation, or attempts to disable event collection mechanisms. Event publishers are critical components that collect system events for osquery monitoring and their compromise can lead to blind spots in security monitoring.

Next Steps:
1. Immediately check osquery service status and review detailed logs for error messages
2. Verify osquery configuration files for unauthorized modifications or tampering
3. Review system authentication logs for privilege escalation attempts around the time of the event
4. Check if other security monitoring tools or agents have been disabled simultaneously
5. Investigate any suspicious processes, users, or network connections on the affected host
6. Validate system integrity using file integrity monitoring or system baseline comparisons
7. If legitimate configuration issue, backup current config before making changes and restart osquery service
8. Consider isolating the host if signs of broader compromise are detected
', '["https://github.com/osquery/osquery/issues/6762","https://attack.mitre.org/techniques/T1489/"]', '(safe("actionResult", "") == "failed" && (safe("log.message", "").contains("Event publisher"))) || (safe("log.eventName", "") == "osquery_events" && (safe("log.message", "").contains("Publisher disabled"))) || (safe("log.message", "").contains("Event publisher failed setup")) || (safe("action", "") == "osquery.result" && (safe("log.message", "").contains("publisher") && safe("log.message", "").contains("error")))', '2025-09-03 16:01:22.840924', true, false, 'origin', NULL, '[]');
INSERT INTO public.utm_correlation_rules VALUES (784, 'File Carving Abuse Detection', 3, 3, 1, 'Collection', 'T1119 - Automated Collection', 'Detects excessive file carving operations which may indicate data exfiltration attempts. Monitors for multiple carve requests from the same host within a short time period, especially targeting sensitive directories.

Next Steps:
1. Review the carved files and their destinations to identify what data was collected
2. Check the process that initiated the carving operations using osquery process_events table
3. Investigate if the host has other suspicious activities around the same timeframe
4. Verify if the user account performing the carving has legitimate reasons for accessing these files
5. Check network logs for potential data exfiltration to external destinations
6. Consider blocking or monitoring the identified process if malicious
7. Review osquery configuration to ensure file carving is appropriately restricted
8. Correlate with endpoint detection tools for additional suspicious file access patterns
9. Check if the carved files contain sensitive data like credentials, keys, or PII
', '["https://osquery.readthedocs.io/en/latest/deployment/file-carving/","https://attack.mitre.org/techniques/T1119/"]', 'safe("log.eventName", "") == "carves" && safe("actionResult", "") == "added" && (safe("origin.path", "").contains("/etc/") || safe("origin.path", "").contains("/var/") || safe("origin.path", "").contains("/home/") || safe("origin.path", "").contains("/Users/") || safe("origin.path", "").contains("/root/") || safe("origin.path", "").contains("passwd") || safe("origin.path", "").contains("shadow") || safe("origin.path", "").contains("ssh") || safe("origin.path", "").contains("private"))', '2025-09-03 16:01:23.310787', true, false, 'origin', NULL, '[{"indexPattern":"v11-log-osquery-*","with":[{"field":"origin.host.keyword","operator":"filter_term","value":"{{.origin.host}}"},{"field":"log.eventName.keyword","operator":"filter_term","value":"carves"}],"or":null,"within":"now-15m","count":10}]');
INSERT INTO public.utm_correlation_rules VALUES (785, 'Osquery Flag Override Attempt Detected', 3, 3, 2, 'Defense Evasion', 'T1562.001 - Impair Defenses: Disable or Modify Tools', 'Detects attempts to override osquery security flags, disable critical monitoring features, or modify runtime flags to bypass security controls. This could indicate an attacker attempting to evade detection by disabling or modifying the osquery monitoring tool.

Next Steps:
1. Investigate the source of the flag modification attempt - check if it was an authorized administrative action
2. Review the specific flags that were attempted to be changed and assess their security impact
3. Check for any other suspicious activities from the same host or user around the same timeframe
4. Verify the integrity of the osquery installation and configuration files
5. Review system logs for any signs of privilege escalation or unauthorized access
6. If unauthorized, consider isolating the affected system and conducting a full security assessment
', '["https://osquery.readthedocs.io/en/stable/deployment/configuration/","https://attack.mitre.org/techniques/T1562/001/"]', '(safe("log.message", "").contains("flag") && safe("log.message", "").contains("override")) || (safe("log.message", "").contains("disable") && safe("log.message", "").contains("monitoring")) || (safe("log.eventName", "") == "osquery_flags" && safe("log.message", "").contains("changed")) || (safe("log.message", "").contains("security") && safe("log.message", "").contains("disabled")) || (safe("log.message", "").contains("--disable") && safe("action", "") == "osquery.result") || (safe("log.message", "").contains("Flag validation failed"))', '2025-09-03 16:01:23.75516', true, false, 'origin', '["origin.host"]', '[]');
INSERT INTO public.utm_correlation_rules VALUES (786, 'JSON Parsing Attack on Osquery Configuration', 2, 3, 3, 'Defense Evasion', 'T1562.001 - Impair Defenses: Disable or Modify Tools', 'Detects JSON parsing attacks including deeply nested configuration exploitation, stack overflow attempts through recursive parsing, or configuration size limit bypass attempts. These attacks could be used to disable or impair osquery monitoring capabilities.

Next Steps:
1. Investigate the source of the malformed JSON configuration
2. Check if osquery service is still running properly
3. Review recent configuration changes and their sources
4. Examine system logs for any unusual activity around the time of the alert
5. Verify the integrity of osquery binary and configuration files
6. Consider restarting osquery service with a known-good configuration
', '["https://github.com/osquery/osquery/pull/6325","https://attack.mitre.org/techniques/T1562/001/"]', '(safe("log.message", "").contains("stack overflow") && safe("log.message", "").contains("config")) || (safe("log.message", "").contains("deeply nested") && safe("log.action", "") == "osquery.result") || (safe("log.message", "").contains("JSON") && safe("log.message", "").contains("parsing error")) || (safe("log.message", "").contains("config") && safe("log.message", "").contains("nesting level exceeded")) || (safe("log.message", "").contains("RapidJSON") && safe("log.message", "").contains("error")) || safe("log.message", "").contains("Maximum JSON depth reached")', '2025-09-03 16:01:24.222309', true, false, 'origin', NULL, '[]');
INSERT INTO public.utm_correlation_rules VALUES (1365, 'Windows: Multiple failed attempts to perform a privileged operation by the same user', 1, 2, 3, 'Potentially Malicious Activity', 'Brute Force', 'Adversaries may use brute force techniques to gain access to accounts when passwords are unknown or when password hashes are obtained.', '["https://attack.mitre.org/techniques/T1110/"]', 'safe("log.eventCode", 0.0) == double(577) || safe("log.eventCode", 0.0) == double(4673)', '2025-09-04 20:33:05.651244', true, false, 'origin', NULL, '[{"indexPattern":"v11-log-wineventlog-*","with":[{"field":"log.eventDataTargetUserName.keyword","operator":"filter_term","value":"{{.log.eventDataTargetUserName}}"}],"or":[{"indexPattern":"v11-log-wineventlog-*","with":[{"field":"log.eventCode","operator":"filter_term","value":"577"},{"field":"log.eventCode","operator":"filter_term","value":"4673"}],"or":null,"within":"now-5m","count":null}],"within":"now-1m","count":1}]');
INSERT INTO public.utm_correlation_rules VALUES (787, 'Osquery Logger Plugin Abuse Detected', 2, 3, 2, 'Defense Evasion', 'T1562.006 - Impair Defenses: Indicator Blocking', 'Detects potential abuse of osquery logger plugins where an attacker may attempt to disable logging, modify logger configurations, or inject malicious logger plugins to evade detection. This could indicate an attempt to blind security monitoring.

Next Steps:
1. Review the osquery configuration on the affected host to verify logger plugin settings
2. Check for any recent configuration changes or unauthorized modifications
3. Examine system logs for evidence of privilege escalation or unauthorized access
4. Verify if legitimate administrative action was performed at the time of the event
5. Look for other defense evasion techniques on the same host
6. Review network connections from the host for potential C2 communication
7. Correlate with recent authentication events to identify the responsible user
8. Check for persistence mechanisms that may have been established
', '["https://osquery.readthedocs.io/en/stable/deployment/logging/","https://attack.mitre.org/techniques/T1562/006/"]', '(safe("log.eventName", "") == "logger_plugin" || safe("action", "") == "osquery.logger" || safe("log.message", "").contains("logger_plugin")) && (safe("actionResult", "") == "removed" || safe("log.message", "").contains("disable") || safe("log.message", "").contains("stop") || safe("log.message", "").contains("unload") || safe("log.message", "").contains("failed") || safe("log.message", "").contains("error") && safe("origin.host", "") != ""', '2025-09-03 16:01:24.499624', true, false, 'origin', '["origin.host"]', '[{"indexPattern":"v11-log-osquery-*","with":[{"field":"origin.host.keyword","operator":"filter_term","value":"{{.origin.host}}"}],"or":null,"within":"now-30m","count":3}]');
INSERT INTO public.utm_correlation_rules VALUES (788, 'Osquery Node Key Compromise Indicator', 3, 3, 2, 'Defense Evasion, Persistence, Privilege Escalation, Initial Access', 'T1078 - Valid Accounts', 'Detects potential compromise of osquery node keys which are used for authentication in distributed deployments. This could allow unauthorized queries or data exfiltration through the osquery infrastructure.

Next Steps:
1. Immediately review osquery server logs to identify the source of the invalid node key attempts
2. Check if the affected node(s) are legitimate osquery agents or potential attackers
3. Rotate all osquery node keys if compromise is confirmed
4. Review osquery server configuration for proper authentication settings
5. Audit all recent queries executed from the suspicious node(s)
6. Check for any data exfiltration patterns in osquery query logs
7. Enable additional logging on osquery server to capture all authentication attempts
8. Consider implementing IP allowlisting for osquery nodes if not already in place
', '["https://osquery.readthedocs.io/en/stable/deployment/configuration/","https://attack.mitre.org/techniques/T1078/"]', 'safe("action", "") == "osquery.status" && ( safe("log.message", "").matches("(?i)(node.*key.*invalid|invalid.*node.*key|node.*key.*fail)") || safe("log.message", "").matches("(?i)(node.*key.*mismatch|duplicate.*node.*key)") || safe("log.eventName", "").matches("(?i)(node.*key.*error|node.*authentication.*fail)") || (safe("actionResult", "") == "denied" && safe("log.message", "").matches("(?i)node.*key")) || safe("log.message", "").matches("(?i)(unauthorized.*node|node.*unauthorized)") )', '2025-09-03 16:06:52.334967', true, false, 'origin', '["origin.host"]', '[{"indexPattern":"v11-log-osquery-*","with":[{"field":"origin.host.keyword","operator":"filter_term","value":"{{.origin.host}}"},{"field":"action.keyword","operator":"filter_term","value":"osquery.status"}],"or":null,"within":"now-10m","count":2}]');
INSERT INTO public.utm_correlation_rules VALUES (789, 'Osquery Pack Manipulation Detected', 2, 3, 2, 'Defense Evasion', 'T1562.001 - Impair Defenses: Disable or Modify Tools', 'Detects unauthorized modifications to osquery packs which contain pre-configured queries for security monitoring. Attackers may attempt to remove, disable, or modify packs to evade detection or reduce visibility into their activities.

Next Steps:
- Investigate who made the pack modification and verify if it was authorized
- Review recent osquery activity and check for any disabled or removed queries
- Check for other defense evasion activities on the affected host
- Review pack configuration files for unauthorized changes
- Verify osquery service is running properly and all expected packs are loaded
- Look for signs of privilege escalation or persistence mechanisms
', '["https://github.com/osquery/osquery/blob/master/packs/incident-response.conf","https://attack.mitre.org/techniques/T1562/001/"]', '(safe("log.eventName", "") in ["pack", "packs"] || safe("action", "").contains("pack") || safe("origin.path", "") in ["pack", "conf"]) && (safe("actionResult", "") in ["removed", "modified", "failed"] || safe("log.message", "").contains("unload") || safe("log.message", "").contains("disable") || safe("log.message", "").contains("delete") || safe("log.message", "").contains("remove") || safe("log.message", "").contains("clear") || safe("log.message", "").contains("failed to load") && safe("origin.host", "") != ""', '2025-09-03 16:06:52.78168', true, false, 'origin', '["origin.host","log.path"]', '[{"indexPattern":"v11-log-osquery-*","with":[{"field":"origin.host","operator":"filter_term","value":"{{.origin.host}}"},{"field":"log.action","operator":"filter_match","value":"*pack*"}],"or":null,"within":"now-2h","count":3}]');
INSERT INTO public.utm_correlation_rules VALUES (790, 'Process Auditing Gap Exploitation', 3, 3, 3, 'Defense Evasion, Privilege Escalation', 'T1055: Process Injection', 'Detects potential exploitation of process auditing gaps including ephemeral processes, audit system tampering, or suspicious process patterns that may indicate attempts to evade monitoring. Monitors for audit failures, disabled events, or rapid process spawning.

Next Steps:
1. Review the audit system status on the affected host using ''osqueryi'' or system audit logs
2. Check for any recently disabled audit rules or configurations
3. Investigate the process that triggered the alert and its parent/child processes
4. Look for any memory injection patterns or suspicious process creation chains
5. Verify if legitimate maintenance or known issues caused the audit gaps
6. Check system resources to ensure audit throttling isn''t due to legitimate high load
', '["https://osquery.readthedocs.io/en/stable/deployment/process-auditing/","https://attack.mitre.org/techniques/T1055/"]', '(safe("log.eventName", "") == "process_events" || safe("log.eventName", "") == "bpf_process_events" || safe("action", "").contains("process")) && (safe("log.message", "").contains("audit") && (safe("log.message", "").contains("disabled") || safe("log.message", "").contains("failed") || safe("log.message", "").contains("throttled") || safe("log.message", "").contains("lost")) || safe("actionResult", "") == "failure" || safe("origin.path", "").contains("/proc/") || safe("origin.path", "").contains("memfd") || safe("log.message", "").contains("injection") || (safe("log.processCount", 0) > 100 && safe("log.duration", 0) < 60))', '2025-09-03 16:06:53.213765', true, false, 'origin', NULL, '[]');
INSERT INTO public.utm_correlation_rules VALUES (1366, 'Windows: Schema admins group changed', 3, 3, 2, 'Potentially Compromised System', 'Domain Policy Modification', 'Adversaries may modify the configuration settings of a domain to evade defenses and/or escalate privileges in domain environments.  Domains provide a centralized means of managing how computer resources (ex: computers, user accounts) can act, and interact with each other, on a network.  The policy of the domain also includes configuration settings that may apply between domains in a multi-domain/forest environment.  Modifications to domain settings may include altering domain Group Policy Objects (GPOs) or changing trust settings for domains, including federation trusts.', '["https://attack.mitre.org/techniques/T1484"]', 'safe("log.winlogEventDataTargetUserSid", "").matches("(^%{S-1-5-21(.+)-518}$|^S-1-5-21(.+)-518$)")', '2025-09-04 20:38:20.793884', true, false, 'origin', NULL, '[]');
INSERT INTO public.utm_correlation_rules VALUES (791, 'Osquery Query Performance Issues Detected', 1, 1, 3, 'Impact', 'Resource Exhaustion', 'Detects osquery queries that are consuming excessive CPU time or memory, indicating potential performance issues that could impact system availability. This could be due to poorly optimized queries, excessive JOIN operations, or malicious queries designed to exhaust system resources.

Next Steps:
1. Identify the specific query causing performance issues by examining the log.message or query details
2. Review the query complexity - check for unnecessary JOIN operations or unbounded table scans
3. Analyze CPU and memory usage metrics for the affected host
4. Check if the query is part of a scheduled pack and consider adjusting the query interval
5. Review osquery configuration for performance tuning options (watchdog limits, query timeouts)
6. Consider temporarily disabling problematic queries while investigating
7. Check for any unusual or unauthorized queries that might indicate malicious activity
', '["https://osquery.readthedocs.io/en/stable/deployment/performance-safety/","https://attack.mitre.org/techniques/T1499/"]', '(safe("actionResult", "") == "failed" && safe("log.message", "").contains("performance")) || (safe("log.eventName", "") == "osquery_schedule" && safe("log.cpu_time", 0) > 10) || (safe("log.eventName", "") == "watchdog" && (safe("log.message", "").contains("CPU") || safe("log.message", "").contains("memory")) && safe("log.message", "").contains("limit")) || (safe("action", "") == "osquery.result" && safe("log.message", "").contains("query") && safe("log.message", "").contains("timeout")) || (safe("log.eventName", "") == "query_performance" && safe("log.duration", 0) > 3000)', '2025-09-03 16:06:53.674192', true, false, 'origin', '["origin.host"]', '[]');
INSERT INTO public.utm_correlation_rules VALUES (792, 'Osquery Scheduled Query Abuse', 3, 3, 2, 'Execution, Persistence, Privilege Escalation', 'T1053 - Scheduled Task/Job', 'Detects suspicious modifications or abuse of osquery scheduled queries. Attackers may attempt to disable security-critical scheduled queries, add malicious queries for persistence, or modify query intervals to reduce detection capabilities.

Next Steps:
1. Review the osquery configuration changes to identify what scheduled queries were modified
2. Check if critical security queries were disabled or had their intervals increased significantly
3. Look for any new scheduled queries that execute suspicious commands or access sensitive data
4. Verify if the changes were authorized by checking with the system administrator
5. Review osquery logs for any suspicious query executions around the time of modification
6. Check for other persistence mechanisms on the affected host
7. If unauthorized, restore the original osquery configuration and investigate the source of changes
', '["https://osquery.readthedocs.io/en/stable/deployment/configuration/","https://attack.mitre.org/techniques/T1053/"]', '(safe("log.eventName", "").contains("schedule") || safe("log.eventName", "").contains("scheduled_query") || safe("action", "").contains("schedule") || safe("log.message", "").contains("scheduled")) && (safe("actionResult", "").contains("removed") || safe("actionResult", "").contains("disabled") || safe("actionResult", "").contains("failed") || safe("actionResult", "").contains("error") || safe("log.message", "").contains("interval") || safe("log.message", "").contains("disable") || safe("log.message", "").contains("stop") || safe("log.message", "").contains("unschedule") || safe("log.message", "").contains("remove")) && safe("origin.host", "") != ""', '2025-09-03 16:06:54.143194', true, false, 'origin', '["origin.host","log.eventName"]', '[]');
INSERT INTO public.utm_correlation_rules VALUES (793, 'Osquery Shard Assignment Anomaly', 2, 3, 2, 'Discovery', 'T1082 - System Information Discovery', 'Detects anomalies in osquery shard assignments which could indicate attempts to manipulate query distribution, bypass monitoring on specific hosts, or perform targeted reconnaissance. Shard assignment issues may indicate configuration tampering or attempts to evade detection.

Next Steps:
1. Review the osquery configuration file on the affected host to check for unauthorized modifications
2. Verify the shard assignment configuration in the fleet management system (if using osquery fleet)
3. Check osquery daemon logs for any signs of tampering or configuration reload issues
4. Compare the current configuration with known-good baselines
5. Investigate any recent changes to the osquery deployment or infrastructure
6. Look for other signs of compromise on the affected host
7. Review user accounts with access to modify osquery configurations
8. Check for unauthorized processes or services attempting to modify osquery
', '["https://osquery.readthedocs.io/en/stable/deployment/configuration/","https://attack.mitre.org/techniques/T1082/"]', 'safe("action", "") == "osquery.status" && (safe("log.message", "").matches("(?i)(shard.*invalid|shard.*error|shard.*fail|shard.*conflict|shard.*mismatch)") || safe("log.eventName", "").matches("(?i)shard.*assignment") || (safe("actionResult", "") == "error" && safe("log.message", "").matches("(?i)shard")))', '2025-09-03 16:06:54.537408', true, false, 'origin', '["origin.host","log.eventName"]', '[]');
INSERT INTO public.utm_correlation_rules VALUES (794, 'SQLite Exploitation Attempt on Osquery', 3, 3, 2, 'Lateral Movement', 'T1210 - Exploitation of Remote Services', 'Detects potential SQLite exploitation attempts including SQL injection, memory leaks through malicious queries, or attempts to tamper with SQLite database files used by osquery. These attacks could compromise the integrity of osquery''s operation and potentially lead to unauthorized access to system information.

Next Steps:
1. Identify the source host and user account involved in the suspicious activity
2. Review the full osquery logs for the affected host to understand the query patterns
3. Check if any unauthorized queries were executed or if database files were modified
  4. Verify the integrity of osquery installation and configuration files
  5. Look for any other indicators of compromise on the affected system
  6. Consider rotating credentials and reviewing osquery access controls
  7. Update osquery to the latest version if vulnerability exploitation is confirmed
', '["https://www.sqlite.org/cves.html","https://github.com/osquery/osquery/blob/master/SECURITY.md","https://attack.mitre.org/techniques/T1210/"]', '(safe("log.message", "").contains("SQL injection") && safe("action", "") == "osquery.result") || (safe("log.message", "").contains("maliciously crafted SQL") && safe("log.eventName", "") != "") || (safe("log.message", "").contains("SQLite") && safe("log.message", "").contains("memory leak")) || (safe("log.message", "").contains("corrupt") && safe("log.message", "").contains("database")) || (safe("actionResult", "") == "error" && safe("log.message", "").contains("SQL syntax")) || (safe("log.message", "").contains("SQLite authorizer") && safe("log.message", "").contains("denied"))', '2025-09-03 16:06:55.016508', true, false, 'origin', NULL, '[]');
INSERT INTO public.utm_correlation_rules VALUES (1368, 'Windows: Multiple TS Gateway login failures', 3, 3, 2, 'Potentially Malicious Activity', 'Brute Force', 'Adversaries may use brute force techniques to gain access to accounts when passwords are unknown or when password hashes are obtained.', '["https://attack.mitre.org/techniques/T1110/"]', 'safe("log.evenCode", "") == "1001" && safe("log.message", "").contains("Microsoft-Windows-TerminalServices")', '2025-09-04 20:39:50.648159', true, false, 'origin', NULL, '[]');
INSERT INTO public.utm_correlation_rules VALUES (795, 'Osquery Subscription Exhaustion Attack', 1, 2, 3, 'Impact', 'Endpoint Denial of Service', 'Detects potential subscription exhaustion attacks through excessive event subscriptions, memory exhaustion patterns, or configuration-based resource consumption attempts. Attackers may attempt to overwhelm osquery by creating excessive subscriptions, large configurations, or triggering memory exhaustion to degrade endpoint monitoring capabilities or cause denial of service.

Next Steps:
1. Review osquery daemon logs for memory usage patterns and subscription counts
2. Check current osquery configuration size and complexity
3. Examine the number of active event subscriptions and their resource consumption
4. Verify if the osquery process has been restarting frequently due to memory issues
5. Review system resources (CPU, memory) on the affected endpoint
6. Check for any unauthorized configuration changes or subscription additions
7. Consider implementing stricter resource limits in osquery configuration
8. Investigate source of configuration changes if config size limits are being exceeded
', '["https://github.com/osquery/osquery/pull/6325","https://attack.mitre.org/techniques/T1499/"]', '(safe("log.message", "").contains("memory exhaustion") && safe("log.message", "").contains("osquery")) || (safe("log.message", "").contains("subscription") && safe("log.message", "").contains("limit exceeded")) || (safe("log.eventName", "") == "osquery_info" && safe("log.message", "").contains("out of memory")) || (safe("log.message", "").contains("config size") && safe("log.message", "").contains("exceeds limit")) || (safe("log.message", "").contains("Maximum config size reached")) || (safe("log.message", "").contains("event subscriber") && safe("log.message", "").contains("overflow")) || (safe("action", "") == "osquery.status" && safe("log.message", "").contains("memory pressure"))', '2025-09-03 16:06:55.460414', true, false, 'origin', NULL, '[{"indexPattern":"v11-log-filebeat-*","with":[{"field":"origin.host.keyword","operator":"filter_term","value":"{{.origin.host}}"}],"or":null,"within":"now-10m","count":5}]');
INSERT INTO public.utm_correlation_rules VALUES (796, 'Osquery Table Access Violations Detected', 3, 2, 1, 'Discovery', 'T1057 - Process Discovery', 'Detects unauthorized or suspicious access attempts to osquery tables, particularly sensitive system tables that could be used for reconnaissance or data exfiltration. This includes access to tables containing process information, network connections, or system configuration data.

Next Steps:
1. Review the specific osquery tables being accessed and determine if the access is legitimate
2. Check the user account performing the queries - verify if they should have access to system monitoring tools
3. Look for patterns of systematic enumeration across multiple sensitive tables
4. Investigate any attempts to access credential-related tables (shadow, passwd, sudoers)
5. Check if the source host is authorized to run osquery queries
6. Review distributed query logs if the event involves remote query execution
7. Consider blocking the user account if reconnaissance activity is confirmed
', '["https://osquery.readthedocs.io/en/stable/deployment/process-auditing/","https://attack.mitre.org/techniques/T1057/"]', '(safe("actionResult", "") == "failed" && safe("log.message", "").matches(".*(permission|denied|unauthorized).*table.*") || (safe("log.eventName", "").matches(".*table_access.*") && safe("actionResult", "") == "denied") || (safe("action", "") == "osquery.result" && safe("log.message", "").matches(".*(shadow|passwd|sudoers|private).*") || (safe("log.eventName", "") == "query" && safe("log.message", "").matches(".*(SELECT.*FROM.*(users|groups|processes|listening_ports|certificates)).*" && safe("origin.user", "") != "root") || (safe("log.eventName", "") == "distributed_query" && safe("log.message", "").matches(".*(kernel_info|system_info|hardware_events).*")', '2025-09-03 16:06:55.936781', true, false, 'origin', NULL, '[]');
INSERT INTO public.utm_correlation_rules VALUES (797, 'Osquery Watchdog Bypass Attempt', 2, 3, 3, 'Defense Evasion', 'T1562.001 - Impair Defenses: Disable or Modify Tools', 'Detects attempts to bypass or disable the osquery watchdog process which monitors memory and CPU utilization. This could indicate an attacker trying to run resource-intensive queries without detection or attempting to hide malicious osquery usage.

Next Steps:
1. Investigate the source of the watchdog bypass attempt by checking the origin.host and origin.user
2. Review recent osquery queries executed on the affected system for anomalous or resource-intensive operations
3. Check system logs for any process termination events related to osqueryd or its watchdog process
4. Verify if legitimate maintenance or troubleshooting activities were being performed
5. Look for other defense evasion indicators on the same host
6. Check if osquery configuration files have been modified
7. Review osquery daemon logs for additional context around the watchdog events
8. Correlate with any recent system performance issues or resource exhaustion events
', '["https://osquery.readthedocs.io/en/stable/deployment/debugging/","https://attack.mitre.org/techniques/T1562/001/"]', 'safe("action", "") == "osquery.status" && ( (safe("log.message", "").contains("watchdog") && (safe("log.message", "").contains("disable") || safe("log.message", "").contains("bypass") || safe("log.message", "").contains("kill") || safe("log.message", "").contains("stop") || safe("log.message", "").contains("terminate"))) || (safe("actionResult", "") == "failed" && safe("log.message", "").contains("watchdog")) || (safe("log.message", "").contains("watchdog_timeout") || safe("log.message", "").contains("watchdog_override")) )', '2025-09-03 16:06:56.405511', true, false, 'origin', NULL, '[{"indexPattern":"v11-log-osquery-*","with":[{"field":"origin.host.keyword","operator":"filter_term","value":"{{.origin.host}}"},{"field":"log.action.keyword","operator":"filter_term","value":"osquery.status"}],"or":null,"within":"now-15m","count":3}]');
INSERT INTO public.utm_correlation_rules VALUES (798, 'YARA Rule Bypass Attempt Detection', 3, 3, 2, 'Defense Evasion', 'T1070 - Indicator Removal', 'Detects potential attempts to bypass YARA scanning through file size inflation, scan failures, or suspicious file operations. Monitors for oversized files, failed YARA scans, or patterns indicating evasion techniques like polymorphism or obfuscation.

Next Steps:
1. Review the affected file and its properties (size, location, extensions)
2. Check if the YARA scan failure was due to timeout, size limit, or error
3. Examine the process that created or modified the suspicious file
4. Look for other defense evasion indicators on the same host
5. Verify if legitimate large files or encrypted files are causing false positives
6. Consider adjusting YARA scanning limits if needed for legitimate use cases
', '["https://osquery.readthedocs.io/en/stable/deployment/yara/","https://attack.mitre.org/techniques/T1070/"]', '(safe("log.eventName", "") == "yara" || safe("log.eventName", "") == "yara_events") && (safe("actionResult", "").contains("FAIL") || safe("log.message", "").contains("size limit") || safe("log.message", "").contains("timeout") || safe("log.message", "").contains("error") || safe("log.file_size", 0) > 104857600 || safe("origin.file", "").contains("/tmp/") || safe("origin.file", "").contains("/var/tmp/") || safe("origin.file", "").contains(".enc") || safe("origin.file", "").contains(".locked") || safe("origin.file", "").contains(".crypted"))', '2025-09-03 16:07:30.439856', true, false, 'origin', '["origin.host","origin.file"]', '[]');
INSERT INTO public.utm_correlation_rules VALUES (1369, 'Windows: Privilege Escalation via Named Pipe Impersonation', 3, 3, 2, 'Privilege Escalation', 'Access Token Manipulation', 'Identifies a privilege escalation attempt via named pipe impersonation. An adversary may abuse this technique by utilizing a framework such Metasploit''s meterpreter getsystem command.', '["https://attack.mitre.org/tactics/TA0004/","https://attack.mitre.org/techniques/T1134/"]', 'safe("log.winlogEventDataProcessName", "").matches("(Cmd.Exe|PowerShell.EXE|powershell.exe|cmd.exe)") && safe("log.message", "").contains(">") && safe("log.message", "").matches("(\\\\.\\pipe\\)")', '2025-09-04 20:39:51.243574', true, false, 'origin', NULL, '[]');
INSERT INTO public.utm_correlation_rules VALUES (1370, 'Windows: Detection of a suspicious PowerShell Script with screenshot capabilities', 3, 2, 1, 'Collection', 'Screen Capture', 'Detects PowerShell scripts that can take screenshots, which is a common feature in post-exploitation kits and remote access tools', '["https://attack.mitre.org/tactics/TA0009/","https://attack.mitre.org/techniques/T1113/"]', 'safe("log.message", "").matches("(CopyFromScreen(.+)Drawing.Bitmap|Drawing.Bitmap(.+)CopyFromScreen)")', '2025-09-04 20:40:05.774839', true, false, 'origin', NULL, '[]');
INSERT INTO public.utm_correlation_rules VALUES (799, 'PostgreSQL Checkpoint Manipulation and Recovery Issues', 2, 3, 3, 'Impact', 'T1490 - Inhibit System Recovery', 'Detects attempts to manipulate PostgreSQL checkpoint processes, invalid checkpoint records, or recovery issues that could indicate database corruption, DoS attempts, or efforts to prevent proper database recovery.

Next Steps:
1. Check PostgreSQL logs for the full error context and any related warnings
2. Verify database integrity using pg_checksums or similar tools
3. Review recent database configuration changes, especially checkpoint_segments and checkpoint_timeout
4. Check disk space and I/O performance on the database server
5. If recovery issues persist, consider restoring from a known good backup
6. Monitor for any unauthorized access attempts around the same timeframe
7. Review PostgreSQL process permissions and ensure proper access controls
', '["https://www.postgresql.org/docs/current/wal-configuration.html","https://attack.mitre.org/techniques/T1490/"]', 'safe("log.messageType", "") in ["ERROR", "FATAL", "PANIC", "WARNING"] && safe("log.msg", "") != "" && (safe("log.msg", "").matches("(?i)could not locate.*checkpoint record") || safe("log.msg", "").matches("(?i)invalid.*checkpoint record") || safe("log.msg", "").matches("(?i)checkpoint.*starting.*too frequently") || safe("log.msg", "").matches("(?i)checkpoints.*too frequent") || safe("log.msg", "").matches("(?i)recovery.*in progress") || safe("log.msg", "").matches("(?i)database system was not properly shut down") || safe("log.msg", "").matches("(?i)could not write.*checkpoint") || safe("log.msg", "").matches("(?i)checkpoint.*failed") || safe("log.msg", "").matches("(?i)redo.*failed")', '2025-09-03 16:10:18.273833', true, false, 'origin', '["origin.host"]', '[]');
INSERT INTO public.utm_correlation_rules VALUES (800, 'PostgreSQL Kerberos Authentication Failures', 2, 2, 1, 'Credential Access', 'T1110.001 - Brute Force: Password Guessing', 'Detects multiple Kerberos/GSSAPI authentication failures in PostgreSQL that may indicate credential brute forcing, ticket manipulation, or authentication configuration issues. This rule monitors for various Kerberos-related error messages including authentication failures, ticket expiration, clock skew issues, and keytab problems.

Next Steps:
- Check PostgreSQL logs for the specific Kerberos error messages and error codes
- Verify the Kerberos configuration on both client and server sides
- Check for clock synchronization issues between the database server and KDC
- Review keytab file permissions and validity
- Look for patterns of failed authentication attempts from specific hosts
- Check if the affected sessions correspond to legitimate service accounts
- Investigate if there are any recent changes to Kerberos/GSSAPI configuration
- Review network connectivity between database server and Key Distribution Center (KDC)
- Validate that service principal names (SPNs) are correctly configured
- Check for account lockouts or expired service accounts in Active Directory
', '["https://www.postgresql.org/docs/current/gssapi-auth.html","https://attack.mitre.org/techniques/T1110/001/"]', 'safe("log.messageType", "") in ["FATAL", "ERROR"] && safe("log.msg", "") != "" && ( (safe("log.msg", "").contains("GSSAPI") || safe("log.msg", "").contains("Kerberos")) && ( safe("log.msg", "").contains("authentication failed") || safe("log.msg", "").contains("accepting GSS security context failed") || safe("log.msg", "").contains("could not acquire credential") || safe("log.msg", "").contains("no credential found") || safe("log.msg", "").contains("keytab") || safe("log.msg", "").contains("ticket expired") || safe("log.msg", "").contains("clock skew") || safe("log.msg", "").contains("checksum failed") ) ) || ( safe("log.errorCode", "") == "28000" && (safe("log.msg", "").contains("gss") || safe("log.msg", "").contains("krb")) )', '2025-09-03 16:10:18.753977', true, false, 'origin', '["target.host","log.sessionId"]', '[{"indexPattern":"v11-log-postgresql-*","with":[{"field":"target.host.keyword","operator":"filter_term","value":"{{.target.host}}"},{"field":"log.messageType.keyword","operator":"filter_term","value":"FATAL"}],"or":[{"indexPattern":"v11-log-postgresql-*","with":[{"field":"target.host.keyword","operator":"filter_term","value":"{{.target.host}}"},{"field":"log.msg","operator":"filter_match","value":"GSSAPI authentication failed"}],"or":null,"within":"now-1h","count":10}],"within":"now-30m","count":5}]');
INSERT INTO public.utm_correlation_rules VALUES (801, 'PostgreSQL LDAP Authentication Bypass Attempt', 3, 3, 1, 'Defense Evasion, Lateral Movement', 'T1550.001 - Application Access Token', 'Detects potential LDAP authentication bypass attempts through empty bind, anonymous authentication, or LDAP injection patterns in PostgreSQL logs. These attempts may indicate an attacker trying to bypass authentication controls to gain unauthorized database access.

Next Steps:
1. Investigate the source IP/host attempting the authentication bypass
2. Review PostgreSQL authentication configuration for LDAP settings
3. Check for any successful logins following these failed attempts
4. Verify LDAP server logs for corresponding authentication events
5. Consider implementing stricter LDAP bind requirements and input validation
6. Review and update pg_hba.conf authentication rules if necessary
7. Monitor for privilege escalation attempts following any successful bypass
8. Check PostgreSQL logs for any suspicious database operations from the source
', '["https://www.postgresql.org/docs/current/auth-ldap.html","https://attack.mitre.org/techniques/T1550/001/"]', 'safe("log.messageType", "") in ["FATAL", "ERROR"] && safe("log.msg", "") != "" && ( safe("log.msg", "").contains("LDAP") && ( safe("log.msg", "").contains("bind failed") || safe("log.msg", "").contains("could not search LDAP") || safe("log.msg", "").contains("empty password") || safe("log.msg", "").contains("anonymous bind") || safe("log.msg", "").contains("LDAP authentication failed") || safe("log.msg", "").contains("invalid syntax") ) ) || ( safe("log.msg", "").contains("authentication failed") && safe("log.msg", "").contains("ldap") )', '2025-09-03 16:10:19.145272', true, false, 'origin', '["origin.host","origin.ip"]', '[]');
INSERT INTO public.utm_correlation_rules VALUES (802, 'PostgreSQL Logical Replication Security Issues', 2, 3, 3, 'Impact', 'T1565 - Data Manipulation', 'Identifies security issues and anomalies in PostgreSQL logical replication that could indicate replication slot exhaustion, unauthorized access to replication streams, or attempts to manipulate replicated data.

Next Steps:
1. Check PostgreSQL replication status using pg_stat_replication view
2. Verify replication slot configuration and ownership
3. Review recent changes to replication settings
4. Check for unauthorized replication connections
5. Monitor disk space usage related to WAL retention
6. Validate replication user permissions and authentication
', '["https://www.postgresql.org/docs/current/logical-replication-security.html","https://attack.mitre.org/techniques/T1565/"]', 'safe("log.messageType", "") in ["ERROR", "WARNING", "FATAL"] && safe("log.msg", "") != "" && (safe("log.msg", "").contains("replication slot") && safe("log.msg", "").contains("does not exist") || safe("log.msg", "").contains("replication slot") && safe("log.msg", "").contains("already exists") || safe("log.msg", "").contains("replication origin") && safe("log.msg", "").contains("not found") || safe("log.msg", "").contains("logical decoding") && safe("log.msg", "").contains("error") || safe("log.msg", "").contains("could not create replication slot") || safe("log.msg", "").contains("replication slot") && safe("log.msg", "").contains("is active") || safe("log.msg", "").contains("cannot drop") && safe("log.msg", "").contains("replication slot"))', '2025-09-03 16:10:19.637661', true, false, 'origin', '["origin.host","log.processId"]', '[]');
INSERT INTO public.utm_correlation_rules VALUES (1371, 'Windows Script Executing PowerShell', 2, 3, 2, 'Initial Access', 'Spearphishing Attachment', 'Identifies a PowerShell process launched by either cscript.exe or wscript.exe. Observing Windows scripting processes executing a PowerShell script, may be indicative of malicious activity.', '["https://attack.mitre.org/tactics/TA0001/","https://attack.mitre.org/techniques/T1566/001/"]', 'safe("log.winlogEventDataEventType", "") == "start" && safe("log.winlogEventDataParentProcessName", "") in ["cscript.exe", "wscript.exe"] && safe("log.winlogEventDataProcessName", "").contains("powershell.exe")', '2025-09-04 20:40:49.445769', true, false, 'origin', NULL, '[]');
INSERT INTO public.utm_correlation_rules VALUES (803, 'PostgreSQL Physical Replication Attack Indicators', 3, 3, 3, 'Impact', 'T1489 - Service Stop', 'Detects potential attacks on PostgreSQL physical replication including standby server compromise, replication lag manipulation, timeline divergence, and attempts to disrupt streaming replication. These attacks could lead to data loss, service disruption, or compromise of database availability.

Next Steps:
1. Check the PostgreSQL replication status using pg_stat_replication view
2. Verify connectivity between primary and standby servers
3. Review PostgreSQL logs on both primary and standby servers for authentication failures
4. Check for recent configuration changes in postgresql.conf and recovery.conf
5. Validate that backup and recovery procedures are functioning correctly
6. Monitor replication lag and ensure it''s within acceptable limits
7. Verify timeline consistency across all servers in the replication cluster
', '["https://www.postgresql.org/docs/current/warm-standby.html","https://attack.mitre.org/techniques/T1489/"]', 'safe("log.messageType", "") in ["ERROR", "FATAL", "PANIC", "WARNING"] && safe("log.msg", "") != "" && (safe("log.msg", "").matches("(?i)streaming replication.*disconnected") || safe("log.msg", "").matches("(?i)standby.*disconnected") || safe("log.msg", "").matches("(?i)timeline.*does not match") || safe("log.msg", "").matches("(?i)requested timeline.*not found") || safe("log.msg", "").matches("(?i)recovery.*conflict") || safe("log.msg", "").matches("(?i)archive recovery.*failed") || safe("log.msg", "").matches("(?i)restore_command.*failed") || safe("log.msg", "").matches("(?i)primary_conninfo.*authentication failed")', '2025-09-03 16:10:20.081865', true, false, 'origin', '["target.host"]', '[{"indexPattern":"v11-log-postgresql-*","with":[{"field":"target.host.keyword","operator":"filter_term","value":"{{.target.host}}"},{"field":"log.messageType.keyword","operator":"filter_term","value":"ERROR"}],"or":[{"indexPattern":"v11-log-postgresql-*","with":[{"field":"target.host.keyword","operator":"filter_term","value":"{{.target.host}}"},{"field":"log.messageType.keyword","operator":"filter_term","value":"FATAL"}],"or":null,"within":"now-1h","count":3}],"within":"now-1h","count":5}]');
INSERT INTO public.utm_correlation_rules VALUES (804, 'PostgreSQL Privilege Escalation Attempt Detected', 3, 3, 2, 'Privilege Escalation', 'T1068 - Exploitation for Privilege Escalation', 'Detects attempts to escalate privileges in PostgreSQL through role manipulation, grant statements, security definer functions, or configuration changes. This includes attempts to grant superuser privileges, create security definer functions, modify system settings, or use dangerous extensions that could lead to privilege escalation.

Next Steps:
1. Identify the user/session that attempted privilege escalation using the session ID and connection details
2. Review the specific SQL command that triggered the alert to understand the attempted escalation method
3. Check PostgreSQL audit logs for previous suspicious activities from the same user or IP address
4. Verify if the privilege escalation attempt was successful by checking current user privileges
5. Review database schema changes and newly created functions or extensions
6. Consider temporarily revoking privileges for the suspicious user until investigation is complete
7. Implement additional monitoring on the affected database server
', '["https://www.postgresql.org/docs/current/sql-grant.html","https://attack.mitre.org/techniques/T1068/","https://github.com/Aiven-Open/pghostile","https://www.enterprisedb.com/blog/postgresql-extensions-impacted-cve-2022-2625-privilege-escalation"]', '(safe("log.messageType", "") == "LOG" || safe("log.messageType", "") == "ERROR") && ( contains(safe("log.msg", ""), "ALTER USER") && (contains(safe("log.msg", ""), "SUPERUSER") || contains(safe("log.msg", ""), "CREATEROLE") || contains(safe("log.msg", ""), "CREATEDB") || contains(safe("log.msg", ""), "REPLICATION") || contains(safe("log.msg", ""), "BYPASSRLS")) || contains(safe("log.msg", ""), "ALTER ROLE") && (contains(safe("log.msg", ""), "SUPERUSER") || contains(safe("log.msg", ""), "CREATEROLE") || contains(safe("log.msg", ""), "CREATEDB") || contains(safe("log.msg", ""), "REPLICATION") || contains(safe("log.msg", ""), "BYPASSRLS")) || contains(safe("log.msg", ""), "GRANT ALL") || contains(safe("log.msg", ""), "GRANT SUPERUSER") || contains(safe("log.msg", ""), "pg_execute_server_program") || contains(safe("log.msg", ""), "pg_read_server_files") || contains(safe("log.msg", ""), "pg_write_server_files") || contains(safe("log.msg", ""), "CREATE FUNCTION") && contains(safe("log.msg", ""), "SECURITY DEFINER") || contains(safe("log.msg", ""), "CREATE OR REPLACE FUNCTION") && contains(safe("log.msg", ""), "SECURITY DEFINER") || contains(safe("log.msg", ""), "ALTER SYSTEM SET archive_command") || contains(safe("log.msg", ""), "ALTER SYSTEM SET session_preload_libraries") || contains(safe("log.msg", ""), "SET ROLE postgres") || contains(safe("log.msg", ""), "SET ROLE pg_") || contains(safe("log.msg", ""), "CREATE EXTENSION adminpack") || contains(safe("log.msg", ""), "CREATE EXTENSION file_fdw") || contains(safe("log.msg", ""), "CREATE EXTENSION dblink") || contains(safe("log.msg", ""), "lo_import") || contains(safe("log.msg", ""), "lo_export") || contains(safe("log.msg", ""), "ALTER TABLE") && contains(safe("log.msg", ""), "OWNER TO") || contains(safe("log.msg", ""), "CREATE USER") && contains(safe("log.msg", ""), "IN ROLE pg_") || contains(safe("log.msg", ""), "CREATE ROLE") && contains(safe("log.msg", ""), "IN ROLE pg_") || safe("log.errorCode", "") == "42501" || safe("log.errorCode", "") == "0LP01" )', '2025-09-03 16:10:20.535575', true, false, 'origin', '["target.host","log.sessionId"]', '[]');
INSERT INTO public.utm_correlation_rules VALUES (805, 'PostgreSQL Publication/Subscription Tampering', 2, 3, 2, 'Impact', 'Replication Manipulation', 'Detects suspicious activities related to PostgreSQL publication/subscription modifications that could lead to data tampering or unauthorized data replication. This includes CREATE, ALTER, or DROP operations on publications and subscriptions.

Next Steps:
1. Review the PostgreSQL logs to identify which user/session performed the publication/subscription changes
2. Verify if the changes were authorized and part of planned maintenance
3. Check for any unusual data replication patterns or unauthorized data access
4. Review the source IP and user credentials for legitimacy
5. If unauthorized, immediately revoke the publication/subscription and review all replicated data
6. Check for any data exfiltration attempts through logical replication
7. Review PostgreSQL audit logs for other suspicious activities from the same session
', '["https://www.postgresql.org/docs/current/logical-replication-publication.html","https://attack.mitre.org/techniques/T1565/001/"]', 'safe("log.messageType", "") in ["ERROR", "WARNING", "FATAL", "PANIC"] && safe("log.msg", "") != "" && (safe("log.msg", "").matches("(?i)(CREATE|ALTER|DROP)\\s+(PUBLICATION|SUBSCRIPTION)") || safe("log.msg", "").matches("(?i)publication.*does not exist") || safe("log.msg", "").matches("(?i)subscription.*conflict") || safe("log.msg", "").matches("(?i)could not connect to publisher") || safe("log.msg", "").matches("(?i)logical replication.*error")', '2025-09-03 16:10:20.985901', true, false, 'origin', '["target.host","log.sessionId"]', '[{"indexPattern":"v11-log-postgresql-*","with":[{"field":"target.host.keyword","operator":"filter_term","value":"{{.target.host}}"}],"or":null,"within":"now-15m","count":3}]');
INSERT INTO public.utm_correlation_rules VALUES (806, 'PostgreSQL SQL Injection Attack Detected', 3, 3, 2, 'Initial Access', 'T1190 - Exploit Public-Facing Application', 'Detects SQL injection patterns in PostgreSQL logs including common injection techniques, error-based injections, and malicious SQL syntax patterns.

Next Steps:
1. Review the SQL query that triggered this alert to confirm if it contains injection patterns
2. Identify the source IP/host and user account associated with the session
3. Check for any successful data access or schema modifications following this attempt
4. Review application logs to identify the input vector used for injection
5. Consider blocking the source IP if multiple injection attempts are detected
6. Patch or update the vulnerable application code to properly sanitize inputs
', '["https://www.postgresql.org/docs/current/sql-syntax.html","https://attack.mitre.org/techniques/T1190/","https://owasp.org/www-project-web-security-testing-guide/latest/4-Web_Application_Security_Testing/07-Input_Validation_Testing/05-Testing_for_SQL_Injection"]', 'safe("log.messageType", "") == "ERROR" && (safe("log.msg", "").matches(".*([''\";]\\s*(OR|AND)\\s+[0-9]+=\\s*[0-9]+).*") || safe("log.msg", "").matches(".*(UNION\\s+(ALL\\s+)?SELECT).*") || safe("log.msg", "").matches(".*('';\\s*(DROP|ALTER|CREATE|TRUNCATE)\\s+(TABLE|DATABASE)).*") || safe("log.msg", "").matches(".*(/\\*.*\\*/|--\\s*$|#\\s*$).*") || safe("log.msg", "").matches(".*(xp_cmdshell|sp_executesql|exec\\s*\\().*") || safe("log.msg", "").matches(".*(CAST\\s*\\(.*AS\\s*(INT|VARCHAR)).*") || safe("log.msg", "").matches(".*(information_schema\\.|pg_catalog\\.).*") || safe("log.msg", "").matches(".*(WAITFOR\\s+DELAY|BENCHMARK\\s*\\(|pg_sleep).*") || safe("log.msg", "").matches(".*(0x[0-9a-fA-F]+|CHAR\\s*\\([0-9]+\\)).*") || safe("log.errorCode", "") == "42601" || safe("log.errorCode", "") == "42703" || safe("log.errorCode", "") == "42P01")', '2025-09-03 16:10:21.447566', true, false, 'origin', NULL, '[]');
INSERT INTO public.utm_correlation_rules VALUES (807, 'PostgreSQL Statistics Collector Issues', 2, 3, 3, 'Defense Evasion', 'T1070.004 - Indicator Removal: File Deletion', 'Detects issues with PostgreSQL statistics collector including failures to write statistics, missing statistics files, or repeated errors in statistics gathering. This could indicate attempts to blind monitoring systems or hide malicious activity.

Next Steps:
1. Check PostgreSQL server logs for the full error messages and context
2. Verify the stats_temp_directory exists and has proper permissions
3. Check disk space availability on the PostgreSQL data directory
4. Review recent system or configuration changes
5. Look for signs of file system tampering or permission changes
6. Investigate any concurrent database activities during the error occurrences
7. Consider restarting the PostgreSQL statistics collector if legitimate issues persist
', '["https://www.postgresql.org/docs/current/monitoring-stats.html","https://attack.mitre.org/techniques/T1070/004/"]', 'safe("action", "") == "postgresql.log" && (safe("log.messageType", "") == "ERROR" || safe("log.messageType", "") == "WARNING") && (safe("log.msg", "").contains("statistics collector") || safe("log.msg", "").contains("pgstat") || safe("log.msg", "").contains("stats_temp_directory"))', '2025-09-03 16:10:21.850143', true, false, 'origin', '["origin.host","log.processId"]', '[{"indexPattern":"v11-log-postgresql-*","with":[{"field":"origin.host.keyword","operator":"filter_term","value":"{{.origin.host}}"},{"field":"log.messageType.keyword","operator":"filter_term","value":"ERROR"}],"or":null,"within":"now-5m","count":5}]');
INSERT INTO public.utm_correlation_rules VALUES (808, 'PostgreSQL Vacuum Process Abuse', 1, 2, 3, 'Impact', 'T1499 - Endpoint Denial of Service', 'Detects potential abuse of PostgreSQL vacuum processes including repeated failures, abnormal autovacuum behavior, or vacuum operations causing excessive resource consumption. This could indicate attempts to degrade database performance or exploit vacuum-related vulnerabilities.

Next Steps:
1. Check PostgreSQL server logs for detailed error messages related to vacuum operations
2. Monitor system resources (CPU, memory, disk I/O) during the timeframe of alerts
3. Review PostgreSQL configuration parameters for autovacuum settings
4. Identify the database and tables being vacuumed excessively
5. Check for any recent schema changes or bulk data operations
6. Verify if legitimate maintenance operations are scheduled
7. Look for signs of transaction wraparound or other vacuum-triggering conditions
8. Consider temporarily adjusting vacuum cost parameters if legitimate high load is confirmed
', '["https://www.postgresql.org/docs/current/routine-vacuuming.html","https://attack.mitre.org/techniques/T1499/"]', 'safe("log.messageType", "") in ["ERROR", "WARNING", "FATAL"] && (safe("log.message", "").contains("vacuum") || safe("log.message", "").contains("VACUUM") || safe("log.message", "").contains("autovacuum"))', '2025-09-03 16:10:22.378158', true, false, 'origin', '["target.host"]', '[]');
INSERT INTO public.utm_correlation_rules VALUES (809, 'PostgreSQL WAL Tampering and Corruption', 3, 3, 3, 'Impact', 'T1485 - Data Destruction', 'Identifies attempts to tamper with PostgreSQL Write-Ahead Log (WAL) files, including deletion, corruption, missing segments, or attempts to manipulate WAL archiving. These attacks can lead to data loss and database corruption.

Next Steps:
1. Immediately verify the PostgreSQL database integrity using pg_checksums
2. Check for any unauthorized access to the PostgreSQL data directory
3. Review PostgreSQL logs for any suspicious user activity or privilege escalation
4. Verify WAL archive configuration and ensure archive_command is functioning properly
5. Check filesystem permissions on pg_wal directory
6. Consider restoring from backup if corruption is confirmed
7. Enable continuous archiving if not already configured to prevent data loss
', '["https://www.postgresql.org/docs/current/wal-intro.html","https://attack.mitre.org/techniques/T1485/"]', 'safe("log.messageType", "") in ["ERROR", "FATAL", "PANIC", "WARNING"] && safe("log.msg", "") != "" && (safe("log.msg", "").contains("could not open file") && safe("log.msg", "").contains("pg_wal") || safe("log.msg", "").contains("could not open file") && safe("log.msg", "").contains("pg_xlog") || safe("log.msg", "").contains("WAL file") && safe("log.msg", "").contains("not found") || safe("log.msg", "").contains("invalid") && safe("log.msg", "").contains("WAL") && safe("log.msg", "").contains("record") || safe("log.msg", "").contains("WAL segment") && safe("log.msg", "").contains("missing") || safe("log.msg", "").contains("archive_command") && safe("log.msg", "").contains("failed") || safe("log.msg", "").contains("could not archive") && safe("log.msg", "").contains("WAL") || safe("log.msg", "").contains("invalid resource manager ID") || safe("log.msg", "").contains("WAL") && safe("log.msg", "").contains("corrupted") || safe("log.msg", "").contains("unexpected pageaddr") && safe("log.msg", "").contains("in log segment"))', '2025-09-03 16:10:32.251708', true, false, 'origin', '["target.host","log.messageType"]', '[{"indexPattern":"v11-log-postgresql-*","with":[{"field":"target.host.keyword","operator":"filter_term","value":"{{.target.host}}"},{"field":"log.messageType.keyword","operator":"filter_term","value":"ERROR"}],"or":null,"within":"now-2h","count":2}]');
INSERT INTO public.utm_correlation_rules VALUES (816, 'Redis Keyspace Notifications Abuse Detection', 3, 2, 1, 'Discovery', 'T1082 - System Information Discovery', 'Detects potential abuse of Redis keyspace notifications which could be used to monitor sensitive key operations in real-time. Attackers may enable keyspace notifications to track database operations and exfiltrate information about key access patterns.

Next Steps:
1. Review the source IP/host that initiated the keyspace notification configuration
2. Check if keyspace notifications were previously disabled and verify if this change was authorized
3. Examine which specific notification events were enabled (K$, E$, etc.) to understand the scope
4. Look for subsequent SUBSCRIBE/PSUBSCRIBE commands from the same source to identify what keys are being monitored
5. Review Redis ACL logs if available to identify the user account involved
6. Check for any data exfiltration attempts following the notification setup
7. Consider disabling keyspace notifications if not required for legitimate operations
8. Correlate with authentication logs to identify the user account that made these changes
9. Check for any suspicious subsequent Redis commands from the same source
10. Review network traffic for potential data exfiltration following the notification setup
', '["https://redis.io/docs/latest/develop/use/keyspace-notifications/","https://attack.mitre.org/techniques/T1082/"]', 'safe("log.msg", "") != "" && (safe("log.msg", "").contains("CONFIG SET notify-keyspace-events") || safe("log.msg", "").contains("PSUBSCRIBE __key") || safe("log.msg", "").contains("SUBSCRIBE __key") || (safe("log.msg", "").contains("CONFIG") && safe("log.msg", "").contains("notify-keyspace-events") && !safe("log.msg", "").contains("GET")))', '2025-09-03 16:11:49.19386', true, false, 'origin', '["origin.host"]', '[]');
INSERT INTO public.utm_correlation_rules VALUES (854, 'Plugin Vulnerability Exploitation Attempt', 3, 3, 2, 'Execution', 'T1203 - Exploitation for Client Execution', 'Detects attempts to exploit vulnerabilities in Traefik plugins including code injection, path traversal, or unauthorized plugin installation attempts. This could indicate an attacker trying to compromise the Traefik instance through vulnerable or malicious plugins.

Next Steps:
1. Immediately review the source IP address and block if malicious
2. Check which plugin was targeted and review its security status
3. Examine Traefik logs for any successful plugin installations or modifications
4. Verify plugin integrity and check for any unauthorized plugins
5. Review plugin configurations and disable any unnecessary plugins
6. Update all plugins to their latest secure versions
7. Consider implementing plugin whitelisting if not already in place
8. Check for any signs of successful exploitation or system compromise
', '["https://doc.traefik.io/traefik/plugins/","https://attack.mitre.org/techniques/T1203/","https://plugins.traefik.io/security"]', '(safe("log.message", "").contains("/plugins/") || safe("log.message", "").contains("/api/plugins") || safe("log.message", "").contains("/.traefik/") || safe("log.message", "").contains("/pilot/") || safe("origin.url", "").contains("/plugins/") || safe("origin.url", "").contains("/api/plugins")) && (safe("log.message", "").contains("../") || safe("log.message", "").contains("..\\") || safe("log.message", "").contains("%2e%2e") || safe("log.message", "").contains("%252e%252e") || safe("log.message", "").contains("/etc/") || safe("log.message", "").contains("\\windows\\") || safe("log.message", "").contains("<script>") || safe("log.message", "").contains("javascript:") || safe("log.message", "").contains("eval(") || safe("log.message", "").contains("exec(") || safe("log.message", "").contains("system(") || safe("log.message", "").contains("__import__") || safe("log.message", "").contains("plugin.zip") || safe("log.message", "").contains("plugin.tar") || safe("log.message", "").contains("malicious") || safe("log.message", "").contains("backdoor") || safe("origin.url", "").contains("exec=") || safe("origin.url", "").contains("cmd="))', '2025-09-03 16:18:29.735514', true, false, 'origin', '["origin.ip"]', '[]');
INSERT INTO public.utm_correlation_rules VALUES (811, 'Redis Cluster Node Attack Detection', 2, 3, 3, 'Lateral Movement', 'Cluster Node Exploitation', 'Detects potential attacks against Redis cluster nodes including unauthorized cluster commands, node hijacking attempts, or suspicious cluster bus protocol activity.

Next Steps:
1. Check the Redis access logs to identify the source IP and user performing cluster operations
2. Verify if the cluster operations were authorized and part of legitimate maintenance
3. Review cluster node status using ''CLUSTER NODES'' command to check for unauthorized changes
4. Check for any data exfiltration or unauthorized data access in Redis logs
5. If unauthorized, immediately revoke access and reset cluster authentication
6. Consider implementing stricter ACLs for cluster management commands
7. Enable Redis command logging if not already active to capture full command history
', '["https://redis.io/docs/latest/operate/oss_and_stack/reference/cluster-spec/","https://attack.mitre.org/techniques/T1210/"]', 'safe("log.msg", "") != "" && ( safe("log.msg", "").contains("CLUSTER FLUSHSLOTS") || safe("log.msg", "").contains("CLUSTER ADDSLOTS") || safe("log.msg", "").contains("CLUSTER DELSLOTS") || safe("log.msg", "").contains("CLUSTER SETSLOT") || safe("log.msg", "").contains("CLUSTER BUMPEPOCH") || safe("log.msg", "").contains("Possible SECURITY ATTACK detected") || (safe("log.msg", "").contains("cluster node") && safe("log.msg", "").contains("failed")) || safe("log.msg", "").contains("Disconnecting cluster node") || (safe("log.msg", "").contains("DENIED") && safe("log.msg", "").contains("cluster")) || (safe("log.levelEnc", "") == "warning" && safe("log.msg", "").contains("cluster")) )', '2025-09-03 16:11:46.441586', true, false, 'origin', NULL, '[]');
INSERT INTO public.utm_correlation_rules VALUES (812, 'Redis Command Injection Attempt', 3, 3, 2, 'Execution', 'T1059.004 - Command and Scripting Interpreter: Unix Shell', 'Detects potential command injection attempts in Redis through dangerous commands like EVAL with suspicious patterns, CONFIG SET operations that modify critical settings, or attempts to execute system commands through Lua scripts.

Next Steps:
1. Immediately investigate the source IP/host that initiated the suspicious command
2. Review Redis audit logs for any successful command executions
3. Check if Redis is exposed to untrusted networks
4. Verify Redis ACL configuration and user permissions
5. Look for any unauthorized changes to Redis configuration files
6. Check for any suspicious processes spawned by Redis
7. Consider rotating Redis passwords if compromise is suspected
', '["https://redis.io/docs/latest/operate/oss_and_stack/management/security/","https://attack.mitre.org/techniques/T1059/004/"]', 'safe("log.msg", "") != "" && ( (safe("log.msg", "").matches("(?i)(EVAL|EVALSHA|SCRIPT\\s+LOAD).*\\b(os\\.execute|io\\.popen|io\\.open|loadfile|dofile|require)\\b")) || (safe("log.msg", "").matches("(?i)CONFIG\\s+SET\\s+(dir|dbfilename|requirepass|masterauth)")) || (safe("log.msg", "").matches("(?i)(EVAL|EVALSHA).*\\b(cat\\s+/etc/passwd|chmod|chown|wget|curl|nc|bash|sh)\\b")) || (safe("log.msg", "").matches("(?i)SCRIPT\\s+LOAD.*\\\\x[0-9a-fA-F]{2}")) || (safe("log.severity", "") == "high" && safe("log.msg", "").matches("(?i)Lua\\s+script\\s+attempted\\s+to\\s+access")) )', '2025-09-03 16:11:47.037015', true, false, 'origin', '["origin.host"]', '[]');
INSERT INTO public.utm_correlation_rules VALUES (813, 'Redis Data Exfiltration Attempt Detected', 3, 2, 1, 'Exfiltration', 'T1048 - Exfiltration Over Alternative Protocol', 'Detects potential data exfiltration attempts from Redis including mass data dumps, bulk key retrieval operations, or suspicious backup/restore activities that could indicate data theft.

Next Steps:
1. Identify the source IP and user account associated with the suspicious Redis commands
2. Review the specific commands executed to determine the scope of data access
3. Check if the affected Redis instance contains sensitive data (passwords, tokens, API keys)
4. Analyze network traffic from the Redis server to identify potential data destinations
5. Review Redis access logs for other anomalous activities from the same source
6. If confirmed malicious, revoke access for the compromised account and rotate any exposed credentials
7. Consider implementing Redis ACLs to restrict access to sensitive operations
', '["https://book.hacktricks.xyz/network-services-pentesting/6379-pentesting-redis","https://attack.mitre.org/techniques/T1048/"]', 'safe("log.msg", "") != "" && ( (safe("log.msg", "").matches("(?i)(DUMP|RESTORE)\\s+") && safe("log.msg", "").size() > 1000) || (safe("log.msg", "").matches("(?i)KEYS\\s+\\*") && safe("log.levelEnc", "") != "debug") || (safe("log.msg", "").matches("(?i)(SCAN|HSCAN|SSCAN|ZSCAN)\\s+\\d+\\s+MATCH\\s+\\*\\s+COUNT\\s+[1-9]\\d{3,}")) || (safe("log.msg", "").matches("(?i)(BGSAVE|SAVE|LASTSAVE)") && safe("log.msg", "").matches("(?i)(remote|external|http|ftp)")) || (safe("log.msg", "").matches("(?i)SELECT\\s+\\d+") && safe("log.msg", "").matches("(?i)(KEYS\\s+\\*|SCAN\\s+0)")) || (safe("log.msg", "").matches("(?i)MIGRATE\\s+\\d+\\.\\d+\\.\\d+\\.\\d+")) || (safe("log.msg", "").matches("(?i)(GET|HGETALL|SMEMBERS|ZRANGE).*") && safe("log.msg", "").matches("(?i)(password|secret|token|api[_-]?key|private[_-]?key)")) )', '2025-09-03 16:11:47.608898', true, false, 'origin', NULL, '[]');
INSERT INTO public.utm_correlation_rules VALUES (859, 'Router Rule Injection Attempt', 3, 3, 2, 'Persistence', 'T1505.003 - Server Software Component: Web Shell', 'Detects attempts to inject malicious routing rules into Traefik configuration. This could allow attackers to redirect traffic, bypass security controls, or expose internal services.

Next Steps:
- Immediately review the source IP and user making the request
- Check if the router configuration change was authorized
- Review Traefik logs for any successful configuration changes from this IP
- Verify that no unauthorized routing rules were created
- Consider blocking the source IP if the activity is confirmed malicious
- Review and strengthen API authentication and authorization controls
', '["https://doc.traefik.io/traefik/routing/routers/","https://attack.mitre.org/techniques/T1505/003/"]', 'safe("log.method", "") in ["POST", "PUT", "PATCH"] && safe("log.url", "").contains("/api/http/routers") && (safe("log.path", "").contains("../") || safe("log.path", "").contains("..\\") || safe("log.path", "").contains("%2e%2e") || safe("log.path", "").contains("${") || safe("log.path", "").contains("{{") || safe("log.body", "").contains("rule:") && (safe("log.body", "").contains("PathPrefix(`/") || safe("log.body", "").contains("Host(`") || safe("log.body", "").contains("Headers(`")))', '2025-09-03 16:19:00.483348', true, false, 'origin', NULL, '[]');
INSERT INTO public.utm_correlation_rules VALUES (868, 'JSON Encoding Attack Detection', 2, 3, 1, 'Defense Evasion', 'T1027 - Obfuscated Files or Information', 'Detects attempts to exploit JSON encoding vulnerabilities including Unicode manipulation, Base64 encoding attacks, and character escape sequence abuse. These attacks can be used to bypass security controls, inject malicious code, or cause application errors.

Next Steps:
1. Examine the raw log data for malicious encoding patterns
2. Check if the encoding attack successfully bypassed input validation
3. Review application logs for any errors or unexpected behavior
4. Verify if the attack originated from known attack sources
5. Implement proper input validation and encoding controls
6. Monitor for additional attacks from the same source IP
', '["https://pragmaticwebsecurity.com/articles/spasecurity/json-stringify-xss","https://attack.mitre.org/techniques/T1027/"]', '(safe("log.encoding_error", "") != "") || (safe("log.unicode_error", false) == true) || (safe("log.message", "").contains("\\u0000")) || (safe("log.message", "").contains("\\x00")) || (safe("log.parser_warning", "").contains("invalid encoding")) || (safe("log.parser_warning", "").contains("truncated unicode")) || (safe("log.content_length", 0) > 0 && safe("log.decoded_length", 0) > 0 && log.decoded_length > log.content_length * 10) || (safe("log.character_encoding", "") != "UTF-8" && safe("log.character_encoding", "") != "")', '2025-09-03 16:29:03.932604', true, false, 'origin', NULL, '[]');
INSERT INTO public.utm_correlation_rules VALUES (814, 'Redis Hash Operation Exploitation', 3, 3, 2, 'Credential Access', 'T1555: Credentials from Password Stores', 'Detects potential exploitation of Redis hash operations including attempts to access credential stores, mass extraction of hash fields with HGETALL, or suspicious patterns in HMSET operations that could indicate data injection attacks.

Next Steps:
- Review the source IP/host making these requests
- Check if the hash operations target sensitive keys (passwords, tokens, credentials)
- Verify if the user/application should have access to these hash operations
- Look for patterns of data exfiltration through mass HGETALL or HSCAN operations
- Check Redis ACL rules and user permissions
- Review application logs for corresponding activity
', '["https://redis.io/docs/latest/develop/data-types/hashes/","https://redis.io/docs/latest/commands/hset/","https://attack.mitre.org/techniques/T1555/"]', 'safe("log.msg", "") != "" && ( (safe("log.msg", "").contains("HGETALL") && (safe("log.msg", "").contains("password") || safe("log.msg", "").contains("credential") || safe("log.msg", "").contains("token"))) || (safe("log.msg", "").contains("HMSET") && safe("log.msg", "").matches(".*HMSET\\s+\\w+\\s+(.+\\s+){20,}.*")) || (safe("log.msg", "").contains("HSCAN") && safe("log.msg", "").contains("MATCH") && safe("log.msg", "").contains("*")) || (safe("log.msg", "").contains("HKEYS") && safe("log.levelEnc", "").contains("warning")) || (safe("log.msg", "").contains("HDEL") && safe("log.msg", "").matches(".*HDEL\\s+\\w+\\s+(.+\\s+){10,}.*")) || (safe("log.msg", "").contains("hash") && safe("log.msg", "").contains("injection")) ) && safe("origin.host", "") != ""', '2025-09-03 16:11:48.282933', true, false, 'origin', '["origin.host"]', '[{"indexPattern":"v11-log-filebeat-*","with":[{"field":"origin.host.keyword","operator":"filter_term","value":"{{.origin.host}}"},{"field":"log.msg","operator":"filter_match","value":"HGET HSET HMSET HSCAN HKEYS"}],"or":null,"within":"now-10m","count":10}]');
INSERT INTO public.utm_correlation_rules VALUES (815, 'Redis HyperLogLog Manipulation Attack', 3, 3, 2, 'Impact', 'Data Manipulation', 'Detects potential manipulation of Redis HyperLogLog data structures through unusual PFADD/PFCOUNT patterns, GET/SET operations on HLL keys, or performance-based attacks using multiple-key PFCOUNT operations.

Next Steps:
1. Review the Redis logs to identify the specific HyperLogLog commands being executed
2. Check if the source IP/host is authorized to perform these operations
3. Verify if the HyperLogLog keys being accessed contain sensitive cardinality data
4. Look for patterns of PFCOUNT operations on multiple keys which could indicate performance attacks
5. Check for any GET/SET operations on HLL keys which could indicate direct manipulation attempts
6. Review Redis configuration for proper ACL rules on HyperLogLog commands
7. Monitor for any corrupted HyperLogLog warnings in the logs
8. Consider implementing rate limiting for HyperLogLog operations if abuse is confirmed
', '["https://redis.io/docs/latest/develop/data-types/probabilistic/hyperloglogs/","https://redis.io/docs/latest/commands/pfadd/","https://attack.mitre.org/techniques/T1565/"]', 'safe("log.msg", "") != "" && ( (safe("log.msg", "").contains("PFCOUNT") && safe("log.msg", "").matches(".*PFCOUNT\\s+\\w+\\s+\\w+.*")) || (safe("log.msg", "").contains("GET") && safe("log.msg", "").contains("HLL")) || (safe("log.msg", "").contains("SET") && safe("log.msg", "").contains("HLL")) || (safe("log.msg", "").contains("PFADD") && safe("log.levelEnc", "") == "warning") || (safe("log.msg", "").contains("corrupted HyperLogLog")) ) && safe("origin.host", "") != ""', '2025-09-03 16:11:48.559979', true, false, 'origin', '["origin.host"]', '[]');
INSERT INTO public.utm_correlation_rules VALUES (820, 'Redis Module Exploitation Attempt', 3, 3, 2, 'Execution', 'T1203 - Exploitation for Client Execution', 'Detects attempts to exploit Redis modules including unauthorized module loading, malicious module commands, or attempts to abuse module functionality for code execution. This includes detection of MODULE LOAD/UNLOAD commands, module-related errors, and attempts to manipulate loadmodule configuration.

Next Steps:
1. Identify the source of the module exploitation attempt by checking the origin host and process ID
2. Review Redis access logs to determine if the attempt was successful
3. Check if any unauthorized modules were loaded using MODULE LIST command
4. Examine Redis configuration file for unauthorized loadmodule directives
5. Review system logs for any suspicious process execution or file system changes
6. Consider rotating Redis credentials and restricting MODULE commands via ACL
7. Enable Redis command logging if not already enabled to capture all module-related commands
', '["https://redis.io/docs/latest/operate/oss_and_stack/stack-with-enterprise/gears-v1/","https://www.exploit-db.com/exploits/47195","https://attack.mitre.org/techniques/T1203/"]', 'safe("log.msg", "") != "" && ( safe("log.msg", "").contains("MODULE LOAD") || safe("log.msg", "").contains("MODULE UNLOAD") || safe("log.msg", "").contains("MODULE LIST") || (safe("log.msg", "").contains("module") && safe("log.msg", "").contains("failed")) || (safe("log.msg", "").contains("module") && safe("log.msg", "").contains("denied")) || (safe("log.msg", "").contains("module") && safe("log.msg", "").contains("error")) || safe("log.msg", "").contains("unauthorized module") || safe("log.msg", "").contains("malicious module") || (safe("log.msg", "").contains("CONFIG SET") && safe("log.msg", "").contains("loadmodule")) || (safe("log.msg", "").contains(".so") && safe("log.msg", "").contains("load")) || (safe("log.levelEnc", "") == "warning" && safe("log.msg", "").contains("module")) )', '2025-09-03 16:12:06.315708', true, false, 'origin', NULL, '[]');
INSERT INTO public.utm_correlation_rules VALUES (821, 'Redis Persistence Mechanism Abuse Detected', 3, 3, 2, 'Persistence', 'T1505: Server Software Component', 'Detects attempts to abuse Redis persistence mechanisms for maintaining unauthorized access, including suspicious RDB/AOF operations, module loading for backdoors, or configuration changes to establish persistence.

Next Steps:
1. Immediately review the Redis server configuration changes and module operations
2. Check if any unauthorized modules were loaded using MODULE LIST command
3. Examine Redis data directory for suspicious files (crontab, authorized_keys, shell scripts)
4. Review Redis access logs for the source IP and authentication method used
5. Verify if RDB/AOF files have been written to unusual locations
6. Check system cron jobs and SSH authorized_keys for signs of compromise
7. Consider rotating Redis passwords and implementing ACL restrictions
8. Enable Redis command logging if not already active for forensic analysis
', '["https://medium.com/@knownsec404team/rce-exploits-of-redis-based-on-master-slave-replication-ef7a664ce1d0","https://attack.mitre.org/techniques/T1505/"]', 'safe("log.msg", "") != "" && ( (safe("log.msg", "").matches("(?i)CONFIG\\s+SET\\s+(save|appendonly|appendfsync|aof-rewrite)")) || (safe("log.msg", "").matches("(?i)MODULE\\s+LOAD\\s+") && !safe("log.msg", "").matches("(?i)(redis[_-]?search|redis[_-]?graph|redis[_-]?timeseries|redis[_-]?json|redis[_-]?bloom)")) || (safe("log.msg", "").matches("(?i)CONFIG\\s+SET\\s+dir\\s+/(root|home|usr|etc|var/spool/cron)")) || (safe("log.msg", "").matches("(?i)CONFIG\\s+SET\\s+dbfilename\\s+(crontab|authorized_keys|passwd|shadow|\\.bashrc|\\.profile)")) || (safe("log.msg", "").matches("(?i)(BGREWRITEAOF|BGSAVE)") && safe("log.msg", "").matches("(?i)(ssh|cron|bash|shell)")) || (safe("log.roleEnc", "") == "master" && safe("log.msg", "").matches("(?i)Synchronization\\s+with\\s+replica.*module\\s+load")) || (safe("log.msg", "").matches("(?i)MODULE\\s+(LIST|UNLOAD)") && safe("log.levelEnc", "") == "error") )', '2025-09-03 16:12:06.772107', true, false, 'origin', NULL, '[]');
INSERT INTO public.utm_correlation_rules VALUES (1373, 'Windows: Potential Secure File Deletion via SDelete Utility', 3, 2, 2, 'Defense Evasion', 'File Deletion', 'Detects file name patterns generated by the use of Sysinternals SDelete utility to securely delete a file via multiple file overwrite and rename operations.', '["https://attack.mitre.org/tactics/TA0005/","https://attack.mitre.org/techniques/T1070/004/"]', 'safe("log.winlogEventDataEventType", "") == "change" && safe("log.winlogEventDataFileName", "").contains("AAA.AAA")', '2025-09-04 20:44:33.624645', true, false, 'origin', NULL, '[]');
INSERT INTO public.utm_correlation_rules VALUES (817, 'Redis List Operation Abuse Detection', 2, 3, 3, 'Command and Control', 'T1001 - Data Obfuscation', 'Detects abuse of Redis list operations including excessive LPUSH/RPUSH operations for data exfiltration, blocking pop operations for DoS, or unusual LRANGE queries that could indicate reconnaissance activities.

Next Steps:
1. Identify the source host performing the suspicious list operations
2. Review the specific commands being executed (LPUSH/RPUSH for large data, BLPOP/BRPOP with timeouts, LRANGE with full list retrieval)
3. Check for patterns of data exfiltration (large PUSH operations) or DoS attempts (blocking operations)
4. Analyze the Redis slow log for performance impact and memory usage
5. Review application logs to determine if this is legitimate application behavior
6. If malicious, block the source IP and review Redis ACL configurations
7. Consider implementing Redis command restrictions or memory limits for list operations
8. Monitor for additional Redis abuse patterns from the same source
', '["https://redis.io/docs/latest/develop/data-types/lists/","https://redis.io/docs/latest/commands/lpush/","https://attack.mitre.org/techniques/T1001/"]', 'safe("log.msg", "") != "" && ( (safe("log.msg", "").matches(".*[LR]PUSH\\s+\\w+\\s+.{1000,}.*")) || (safe("log.msg", "").contains("BLPOP") && safe("log.msg", "").contains("timeout")) || (safe("log.msg", "").contains("BRPOP") && safe("log.msg", "").contains("timeout")) || (safe("log.msg", "").contains("LRANGE") && safe("log.msg", "").matches(".*LRANGE\\s+\\w+\\s+0\\s+-1.*")) || (safe("log.msg", "").contains("LTRIM") && safe("log.levelEnc", "") == "warning") || (safe("log.msg", "").matches(".*list.*exceeds.*memory.*")) ) && safe("origin.host", "") != ""', '2025-09-03 16:11:49.656763', true, false, 'origin', NULL, '[{"indexPattern":"v11-log-filebeat-redis-*","with":[{"field":"origin.host.keyword","operator":"filter_term","value":"{{.origin.host}}"},{"field":"log.msg","operator":"filter_match","value":"LPUSH RPUSH LRANGE BLPOP BRPOP"}],"or":null,"within":"now-15m","count":30}]');
INSERT INTO public.utm_correlation_rules VALUES (818, 'Redis Lua Script Injection Attack', 3, 3, 3, 'Execution', 'Script Injection', 'Detects potential Lua script injection attacks in Redis including malicious EVAL/EVALSHA commands, script-based exploitation attempts, or suspicious scripting activity.

Next Steps:
1. Immediately review the Redis logs to identify the source of the suspicious script commands
2. Check if the Redis instance is exposed to untrusted networks
3. Verify that Redis authentication is properly configured and strong passwords are in use
4. Review all Lua scripts loaded into Redis for malicious code
5. Consider implementing command blacklisting for EVAL/EVALSHA if not required
6. Monitor for any unauthorized data access or modification following the alert
7. If compromise is confirmed, rotate Redis passwords and review all stored data for tampering
', '["https://antirez.com/news/119","https://redis.io/docs/latest/develop/interact/programmability/lua-debugging/","https://attack.mitre.org/techniques/T1059/007/"]', 'safe("log.msg", "") != "" && ( safe("log.msg", "").contains("EVAL") || safe("log.msg", "").contains("EVALSHA") || safe("log.msg", "").contains("SCRIPT LOAD") || safe("log.msg", "").contains("SCRIPT KILL") || safe("log.msg", "").contains("SCRIPT FLUSH") || safe("log.msg", "").contains("Cross Protocol Scripting") || (safe("log.msg", "").contains("POST") && safe("log.msg", "").contains("Host:")) || safe("log.msg", "").contains("cmsgpack") || (safe("log.msg", "").contains("lua") && (safe("log.msg", "").contains("error") || safe("log.msg", "").contains("attack"))) || (safe("log.msg", "").contains("script") && safe("log.msg", "").contains("timeout")) || safe("log.msg", "").contains("Lua script attempted to access") || (safe("log.levelEnc", "") == "warning" && safe("log.msg", "").contains("script")) )', '2025-09-03 16:11:50.144635', true, false, 'origin', '["adversary.host"]', '[]');
INSERT INTO public.utm_correlation_rules VALUES (819, 'Redis Memory Exhaustion Attack', 1, 1, 3, 'Impact', 'T1499 - Endpoint Denial of Service: Resource Exhaustion', 'Detects potential memory exhaustion attacks against Redis including attempts to consume excessive memory, trigger out-of-memory conditions, or perform denial of service through memory manipulation.

Next Steps:
1. Check Redis memory usage and configuration limits using INFO memory command
2. Review Redis maxmemory and maxmemory-policy settings in redis.conf
3. Identify the source of memory-intensive operations in Redis logs
4. Check for unusual patterns of large key creation or bulk operations
5. Monitor client connections and command patterns for anomalies
6. Consider implementing memory usage alerts and automatic eviction policies
7. Review and potentially block suspicious client IPs if attack is ongoing
', '["https://redis.io/docs/latest/operate/oss_and_stack/management/optimization/memory-optimization/","https://www.trendmicro.com/en_us/research/20/d/exposed-redis-instances-abused-for-remote-code-execution-cryptocurrency-mining.html","https://attack.mitre.org/techniques/T1499/"]', 'safe("log.msg", "") != "" && ( safe("log.msg", "").contains("OOM command not allowed") || safe("log.msg", "").contains("out of memory") || safe("log.msg", "").contains("memory exhaustion") || (safe("log.msg", "").contains("used_memory") && safe("log.msg", "").contains("maxmemory")) || safe("log.msg", "").contains("can''t allocate memory") || safe("log.msg", "").contains("Background save terminated by signal") || safe("log.msg", "").contains("MISCONF Redis is configured to save RDB snapshots") || (safe("log.msg", "").contains("evicted") && safe("log.msg", "").contains("keys")) || (safe("log.msg", "").contains("maxclients") && safe("log.msg", "").contains("reached")) || (safe("log.msg", "").contains("Too many") && safe("log.msg", "").contains("allocate")) || (safe("log.msg", "").contains("memory") && safe("log.msg", "").contains("limit")) || (safe("log.levelEnc", "") == "warning" && safe("log.msg", "").contains("memory")) )', '2025-09-03 16:11:50.598387', true, false, 'origin', NULL, '[]');
INSERT INTO public.utm_correlation_rules VALUES (882, 'Prototype Pollution Attempt Detected', 2, 3, 2, 'Defense Evasion, Privilege Escalation', 'Prototype Pollution', 'Detects attempts to pollute JavaScript object prototypes through malicious JSON input containing __proto__, constructor, or prototype properties. This attack can lead to application compromise by modifying the behavior of all objects in the application.

Next Steps:
1. Immediately block the source IP address if possible
2. Review application logs for any successful prototype pollution attempts
3. Check for any unexpected behavior in the affected application
4. Validate input sanitization mechanisms are working correctly
5. Review recent application deployments for security vulnerabilities
6. Monitor for additional attack attempts from the same source
', '["https://www.netspi.com/blog/technical-blog/web-application-pentesting/ultimate-guide-to-prototype-pollution/","https://attack.mitre.org/techniques/T1055/"]', '(safe("log.__proto__", "") != "" || safe("log.constructor", "") != "" || safe("log.prototype", "") != "" || safe("raw", "").contains("__proto__") || safe("raw", "").contains("constructor.prototype") || safe("raw", "").contains("Object.prototype"))', '2025-09-03 16:29:39.836794', true, false, 'origin', NULL, '[]');
INSERT INTO public.utm_correlation_rules VALUES (822, 'Redis Pipeline Command Abuse', 1, 2, 3, 'Impact', 'T1499 - Endpoint Denial of Service', 'Detects potential abuse of Redis pipeline functionality that could lead to memory exhaustion or performance degradation. Attackers may send large batches of pipelined commands to overwhelm the server''s memory or processing capacity.

Next Steps:
1. Investigate the source host generating pipeline abuse patterns
2. Review Redis server memory usage and performance metrics
3. Analyze client output buffer configurations and limits
4. Check for suspicious connection patterns or bulk operations
5. Consider implementing rate limiting for pipeline commands
6. Review Redis authentication and access controls
', '["https://redis.io/docs/latest/develop/use/pipelining/","https://attack.mitre.org/techniques/T1499/"]', 'safe("log.msg", "") != "" && ( (safe("log.msg", "").contains("pipeline") && (safe("log.msg", "").contains("memory") || safe("log.msg", "").contains("OOM"))) || (safe("log.msg", "").contains("Client") && safe("log.msg", "").contains("output buffer limit")) || (safe("log.msg", "").contains("closing connection") && safe("log.msg", "").contains("query buffer")) || (safe("log.msg", "").contains("Protocol error") && safe("log.msg", "").contains("bulk")) || (safe("log.levelEnc", "") == "warning" && safe("log.msg", "").contains("client-output-buffer-limit")) )', '2025-09-03 16:12:07.24518', true, false, 'origin', '["origin.host"]', '[{"indexPattern":"v11-log-redis-*","with":[{"field":"origin.host.keyword","operator":"filter_term","value":"{{.origin.host}}"},{"field":"log.levelEnc.keyword","operator":"filter_term","value":"warning"}],"or":null,"within":"now-5m","count":3}]');
INSERT INTO public.utm_correlation_rules VALUES (823, 'Redis Pub/Sub Channel Abuse Detection', 3, 2, 3, 'Credential Access, Collection', 'T1557 - Adversary-in-the-Middle', 'Detects suspicious activity in Redis Pub/Sub channels including channel flooding, unauthorized subscriptions, or potential data exfiltration attempts through pub/sub mechanism. This rule identifies pattern subscriptions, keyspace notifications abuse, mass publishing operations, channel flooding, and access denials related to pub/sub functionality.

Next Steps:
- Review the specific Redis commands being executed and identify the source client
- Check for unusual patterns in channel names or subscription activities
- Verify if the pub/sub operations are authorized for the connecting client
- Examine network traffic patterns to identify potential data exfiltration
- Review Redis configuration for proper pub/sub access controls
- Check for correlation with other suspicious Redis activities from the same source
- Investigate the frequency and timing of pub/sub operations
- Validate client authentication and authorization for pub/sub operations
', '["https://redis.io/docs/latest/develop/interact/pubsub/","https://attack.mitre.org/techniques/T1557/"]', 'safe("log.msg", "") != "" && ( safe("log.msg","").contains("PSUBSCRIBE") || safe("log.msg","").contains("PUNSUBSCRIBE") || (safe("log.msg","").contains("PUBLISH") && safe("log.msg","").contains("__keyspace@")) || (safe("log.msg","").contains("PUBLISH") && safe("log.msg","").contains("__keyevent@")) || safe("log.msg","").contains("Mass PUBLISH") || safe("log.msg","").contains("channel") && safe("log.msg","").contains("flood") || safe("log.msg","").contains("Too many channels") || safe("log.msg","").contains("pubsub") && safe("log.msg","").contains("denied") || (safe("log.levelEnc", "") == "warning" && safe("log.msg","").contains("pubsub")) )', '2025-09-03 16:12:07.829893', true, false, 'origin', '["origin.host"]', '[{"indexPattern":"v11-log-redis-*","with":[{"field":"origin.host.keyword","operator":"filter_term","value":"{{.origin.host}}"}],"or":null,"within":"now-10m","count":10}]');
INSERT INTO public.utm_correlation_rules VALUES (824, 'Redis Replication Poisoning Attack Detected', 3, 3, 2, 'Command and Control', 'T1219 - Remote Access Software', 'Detects potential Redis replication poisoning attacks where attackers abuse the master-slave replication mechanism to load malicious modules or execute remote commands through SLAVEOF/REPLICAOF commands. This attack technique allows unauthorized code execution and data access in Redis instances.

Next Steps:
1. Immediately isolate the affected Redis instance from the network
2. Review Redis logs for suspicious replication commands and module loading activities
3. Check for unauthorized Redis configurations and loaded modules
4. Verify the legitimacy of any master-slave replication relationships
5. Examine network traffic for connections to suspicious external Redis servers
6. Review Redis authentication and access control configurations
7. Check for any data exfiltration or unauthorized access patterns
8. Update Redis to the latest version and implement proper security hardening
', '["https://medium.com/@knownsec404team/rce-exploits-of-redis-based-on-master-slave-replication-ef7a664ce1d0","https://attack.mitre.org/techniques/T1219/"]', 'safe("log.msg", "") != "" && ( (safe("log.msg", "").matches("(?i)(SLAVEOF|REPLICAOF)\\s+\\d+\\.\\d+\\.\\d+\\.\\d+")) || (safe("log.msg", "").matches("(?i)(SLAVEOF|REPLICAOF)\\s+NO\\s+ONE") && safe("log.roleEnc", "") == "slave") || (safe("log.msg", "").matches("(?i)REPLCONF\\s+(listening-port|capa)")) || (safe("log.msg", "").matches("(?i)PSYNC\\s+") && safe("log.msg", "").matches("(?i)(module|backdoor|\\.so)")) || (safe("log.roleEnc", "") == "slave" && safe("log.msg", "").matches("(?i)(Full\\s+resync|MASTER\\s+<->\\s+REPLICA\\s+sync).*module")) || (safe("log.msg", "").matches("(?i)Connecting\\s+to\\s+MASTER\\s+\\d+\\.\\d+\\.\\d+\\.\\d+") && safe("log.levelEnc", "") == "error") || (safe("log.msg", "").matches("(?i)(Master\\s+replid\\s+changed|Partial\\s+resynchronization\\s+not\\s+possible)") && safe("log.msg", "").matches("(?i)module")) )', '2025-09-03 16:12:08.346103', true, false, 'origin', NULL, '[]');
INSERT INTO public.utm_correlation_rules VALUES (825, 'Redis Sorted Set Score Manipulation Attack', 2, 3, 3, 'Impact', 'T1496 - Resource Hijacking', 'Detects potential attacks on Redis sorted sets including score overflow attempts, excessive ZINCRBY operations for resource exhaustion, or large ZRANGE queries that could cause performance degradation. These attacks can be used to consume server resources and impact availability.

Next Steps:
1. Review the specific Redis command being executed and validate if it''s legitimate
2. Check the application logs for the source of these commands
3. Verify the authentication and authorization of the Redis client
4. Monitor Redis performance metrics for resource consumption spikes
5. Consider implementing Redis command monitoring and rate limiting
6. Review Redis configuration for security best practices
', '["https://redis.io/docs/latest/develop/data-types/sorted-sets/","https://redis.io/docs/latest/commands/zincrby/","https://attack.mitre.org/techniques/T1496/"]', 'safe("log.message", "") != "" && ( (safe("log.message", "").contains("ZINCRBY") && safe("log.message", "").matches(".*ZINCRBY\\s+\\w+\\s+\\w+\\s+[0-9]{10,}.*")) || (safe("log.message", "").contains("ZADD") && safe("log.message", "").matches(".*ZADD\\s+\\w+\\s+[0-9]{16,}.*")) || (safe("log.message", "").contains("ZRANGE") && safe("log.message", "").matches(".*ZRANGE\\s+\\w+\\s+[0-9]+\\s+[0-9]{4,}.*")) || (safe("log.message", "").contains("score overflow")) || (safe("severity", "") == "high" && safe("log.message", "").contains("sorted set")) ) && safe("origin.host", "") != ""', '2025-09-03 16:12:08.765491', true, false, 'origin', NULL, '[]');
INSERT INTO public.utm_correlation_rules VALUES (1374, 'Windows: Security enabled group deleted', 2, 3, 2, 'Potentially Malicious Activity', 'Account Access Removal', 'Adversaries may interrupt availability of system and network resources  by inhibiting access to accounts utilized by legitimate users.  Accounts may be deleted, locked, or manipulated (ex: changed credentials) to remove access to accounts.  Adversaries may also subsequently log off and/or perform a System Shutdown/Reboot to set malicious changes into place.', '["https://attack.mitre.org/techniques/T1531/"]', 'safe("log.eventCode", 0.0) == double(634) || safe("log.eventCode", 0.0) == double(638) || safe("log.eventCode", 0.0) == double(662)', '2025-09-04 20:44:34.077806', true, false, 'origin', NULL, '[]');
INSERT INTO public.utm_correlation_rules VALUES (826, 'Redis Transaction Manipulation Attack', 3, 3, 3, 'Impact', 'T1565 - Data Manipulation', 'Detects suspicious patterns in Redis transaction operations that may indicate attempts to manipulate data atomicity or exploit race conditions. This includes unusual MULTI/EXEC patterns, WATCH command abuse, or transaction failures that could indicate manipulation attempts.

Next Steps:
1. Review Redis server logs for the affected host to identify the source of transaction manipulation
2. Analyze the specific Redis commands being executed during the suspicious transaction patterns
3. Check for unauthorized access to Redis instances or configuration changes
4. Investigate network traffic to the Redis server for potential external attackers
5. Review application logs that interact with Redis to identify potential application-level attacks
6. Verify Redis authentication and access control configurations
7. Consider implementing Redis transaction monitoring and alerting for future incidents
', '["https://redis.io/docs/latest/develop/interact/transactions/","https://attack.mitre.org/techniques/T1565/"]', 'safe("log.msg", "") != "" && ( (safe("log.msg", "").contains("MULTI") && safe("log.msg", "").contains("EXEC") && safe("log.levelEnc", "") == "warning") || (safe("log.msg", "").contains("WATCH") && safe("log.msg", "").contains("Transaction discarded")) || (safe("log.msg", "").contains("DISCARD") && safe("log.levelEnc", "") == "warning") || (safe("log.msg", "").contains("ERR EXEC without MULTI")) || (safe("log.msg", "").contains("ERR WATCH inside MULTI")) || (safe("log.msg", "").contains("Transaction") && safe("log.msg", "").contains("abort")) )', '2025-09-03 16:12:09.249507', true, false, 'origin', NULL, '[{"indexPattern":"v11-log-redis-*","with":[{"field":"origin.host.keyword","operator":"filter_term","value":"{{.origin.host}}"},{"field":"log.msg","operator":"filter_match","value":"MULTI"}],"or":null,"within":"now-10m","count":10}]');
INSERT INTO public.utm_correlation_rules VALUES (827, 'Redis Unauthorized Access Pattern Detected', 3, 3, 2, 'Defense Evasion, Persistence, Privilege Escalation, Initial Access', 'T1078 - Valid Accounts', 'Detects patterns indicative of unauthorized access attempts to Redis including authentication failures, dangerous command usage without authentication, or attempts to bypass security restrictions. This rule identifies potential Redis security breaches through analysis of log messages for authentication failures, dangerous administrative commands, and unauthorized client activities.

Next Steps:
1. Verify the legitimacy of the Redis client connection from the identified origin host
2. Check Redis authentication configuration and ensure AUTH is properly enabled
3. Review Redis configuration for exposed dangerous commands (FLUSHALL, FLUSHDB, CONFIG)
4. Investigate if any data was compromised during the unauthorized access attempt
5. Consider implementing Redis ACLs and restricting dangerous commands
6. Monitor for data exfiltration attempts from the affected Redis instance
', '["https://medium.com/@Victor.Z.Zhu/redis-unauthorized-access-vulnerability-simulation-victor-zhu-ac7a71b2e419","https://attack.mitre.org/techniques/T1078/"]', 'safe("log.msg", "") != "" && ( (safe("log.msg", "").matches("(?i)(AUTH\\s+failed|invalid\\s+password|authentication\\s+required)")) || (safe("log.msg", "").matches("(?i)(FLUSHALL|FLUSHDB|CONFIG\\s+(GET|SET)|KEYS\\s+\\*|SCAN\\s+0)") && safe("log.severity", "") == "warning") || (safe("log.msg", "").matches("(?i)CONFIG\\s+SET\\s+(dir\\s+/|dbfilename\\s+authorized_keys)")) || (safe("log.msg", "").matches("(?i)(SAVE|BGSAVE).*ssh|authorized_keys")) || (safe("log.msg", "").matches("(?i)Client\\s+id=\\d+\\s+addr=.*\\s+name=.*\\s+cmd=(flushall|flushdb|config)")) || (safe("severity", "") == "high" && safe("log.msg", "").matches("(?i)(Possible\\s+security\\s+attack|unauthorized\\s+client)")) )', '2025-09-03 16:12:09.548465', true, false, 'origin', '["origin.host","origin.ip"]', '[{"indexPattern":"v11-log-redis-*","with":[{"field":"origin.host.keyword","operator":"filter_term","value":"{{.origin.host}}"}],"or":null,"within":"now-10m","count":5}]');
INSERT INTO public.utm_correlation_rules VALUES (838, 'SSH Brute Force Attempts', 3, 3, 2, 'Credential Access', 'T1110.001 - Brute Force: Password Guessing', 'Detects multiple failed SSH authentication attempts from the same source IP address, indicating a potential brute force attack against SSH services. This rule identifies patterns where an attacker attempts to guess passwords by making repeated login attempts.

Next Steps:
1. Immediately block the attacking IP address at the firewall level
2. Review SSH logs for the timeframe to identify targeted usernames
3. Check if any successful logins occurred from the same IP after failed attempts
4. Verify SSH configuration follows security best practices (disable root login, use key-based authentication)
5. Consider implementing fail2ban or similar intrusion prevention tools
6. Monitor for lateral movement if any accounts were compromised
7. Review other systems for similar brute force attempts from the same IP
8. Consider adding the IP to threat intelligence feeds if confirmed malicious
', '["https://www.elastic.co/guide/en/beats/filebeat/current/filebeat-module-system.html","https://attack.mitre.org/techniques/T1110/001/"]', 'safe("log.message", "").contains("Failed password") && safe("log.message", "").contains("ssh") && safe("origin.ip", "") != ""', '2025-09-03 16:16:47.171281', true, false, 'origin', '["origin.ip"]', '[{"indexPattern":"v11-log-linux-*","with":[{"field":"origin.ip.keyword","operator":"filter_term","value":"{{.origin.ip}}"},{"field":"log.message.keyword","operator":"filter_match","value":"Failed password"}],"or":null,"within":"now-5m","count":10}]');
INSERT INTO public.utm_correlation_rules VALUES (1375, 'Windows: Security enabled group created', 2, 3, 1, 'Potentially Malicious Activity', 'Domain Policy Modification: Group Policy Modification', 'Adversaries may modify Group Policy Objects (GPOs) to subvert the intended discretionary access controls for a domain,  usually with the intention of escalating privileges on the domain.  Group policy allows for centralized management of user and computer settings in Active Directory (AD).', '["https://attack.mitre.org/techniques/T1484/001/"]', 'safe("log.eventCode", 0.0) == double(631) || safe("log.eventCode", 0.0) == double(635) || safe("log.eventCode", 0.0) == double(658)', '2025-09-04 20:44:34.578276', true, false, 'origin', NULL, '[]');
INSERT INTO public.utm_correlation_rules VALUES (830, 'Hardware Error Patterns', 1, 2, 3, 'Initial Access', 'T1200 - Hardware Additions', 'Detects hardware-related errors including memory failures, disk errors, CPU issues, temperature warnings, and other hardware anomalies that may impact system stability or indicate potential hardware tampering.

Next Steps:
1. Check system hardware status and logs for additional error patterns
2. Verify hardware integrity and check for unauthorized hardware modifications
3. Monitor system performance metrics and temperature readings
4. Review recent hardware changes or maintenance activities
5. Consider running hardware diagnostic tools (memtest, smartctl, sensors)
6. Check for patterns of errors that could indicate malicious hardware implants
7. Coordinate with physical security team if hardware tampering is suspected
', '["https://attack.mitre.org/techniques/T1200/","https://www.kernel.org/doc/html/latest/admin-guide/ras.html"]', '(
      safe("log.message", "").matches("(?i)(mce:.*hardware error|machine check exception|cpu.*error detected|thermal throttling)") ||
      safe("log.message", "").matches("(?i)(ecc.*error|memory.*parity error|dimm.*failure|corrected.*error|uncorrectable.*error)") ||
      safe("log.message", "").matches("(?i)(ata.*error|sata.*fail|disk.*error|i/o error|bad sector|smart.*fail)") ||
      safe("log.message", "").matches("(?i)(pci.*error|pcie.*error|bus error|dma.*fail|irq.*nobody cared)") ||
      safe("log.message", "").matches("(?i)(power supply.*warn|voltage.*out of range|fan.*fail|temperature.*critical)") ||
      (safe("log.program", "").matches("(?i)(smartd|mcelog|sensors)") && safe("log.message", "").matches("(?i)(warning|error|critical|fail)"))
    )', '2025-09-05 18:15:13.77651', true, false, 'origin', '["origin.host"]', '[]');
INSERT INTO public.utm_correlation_rules VALUES (832, 'Memory Usage Spike Detection', 1, 2, 3, 'Impact', 'Resource Exhaustion', 'Detects sudden memory usage spikes and memory pressure events that could indicate memory leaks or resource exhaustion attacks', '["https://www.elastic.co/guide/en/beats/filebeat/current/filebeat-module-system.html","https://attack.mitre.org/techniques/T1499/"]', '(
      safe("log.message", "") != "" &&
      (
        safe("log.message", "").contains("oom-killer") ||
        safe("log.message", "").contains("Out of memory: Kill process") ||
        safe("log.message", "").contains("Memory cgroup out of memory") ||
        safe("log.message", "").contains("page allocation failure") ||
        (
          safe("log.message", "").contains("swapfile") &&
          safe("log.message", "").contains("full")
        ) ||
        safe("log.message", "").contains("memory pressure") ||
        safe("log.message", "").contains("low on memory")
      ) &&
      safe("origin.host", "") != ""
    )', '2025-09-05 18:33:42.947311', true, false, 'origin', '["origin.host"]', '[{"indexPattern":"v11-log-linux-*","with":[{"field":"origin.host.keyword","operator":"filter_term","value":"{{.origin.host}}"}],"or":[],"within":"now-5m","count":3}]');
INSERT INTO public.utm_correlation_rules VALUES (831, 'Kernel Parameter Modifications', 2, 3, 2, 'Persistence, Privilege Escalation', 'T1547.006 - Boot or Logon Autostart Execution: Kernel Modules and Extensions', 'Detects modifications to kernel parameters or kernel module loading that could indicate rootkit installation or system compromise. This rule identifies suspicious kernel-related activities including module loading/unloading operations and sysctl parameter changes.

Next Steps:
1. Verify the legitimacy of kernel module operations by checking if they align with scheduled maintenance or authorized system changes
2. Investigate the source of the module operations - examine the process tree and parent processes
3. Review system logs for additional suspicious activities around the same timeframe
4. Check file system integrity and compare loaded modules against known good baselines
5. Examine network connections and processes spawned after kernel modifications
6. If unauthorized, immediately isolate the affected system and conduct forensic analysis
7. Review user accounts and privileges that may have been used to perform these operations
', '["https://www.elastic.co/guide/en/beats/filebeat/current/filebeat-module-system.html","https://attack.mitre.org/techniques/T1547/006/"]', '(safe("log.message", "").contains("kernel") &&
      (safe("log.message", "").contains("module") ||
        safe("log.message", "").contains("insmod") ||
        safe("log.message", "").contains("modprobe") ||
        safe("log.message", "").contains("rmmod"))) ||
        safe("log.message", "").contains("sysctl") &&
        safe("origin.host", "") != ""', '2025-09-05 20:00:29.280459', true, false, 'origin', NULL, '[]');
INSERT INTO public.utm_correlation_rules VALUES (1372, 'Windows Script Interpreter Executing Process via WMI', 2, 2, 2, 'Initial Access', 'Spearphishing Attachment', 'Identifies use of the built-in Windows script interpreters (cscript.exe or wscript.exe) being used to execute a process via Windows Management Instrumentation (WMI). This may be indicative of malicious activity.', '["https://attack.mitre.org/tactics/TA0001/","https://attack.mitre.org/techniques/T1566/001/"]', 'safe("log.winlogProcessName", "") in ["wscript.exe", "cscript.exe"] && safe("log.message", "").contains("wmiutils.dll")', '2025-09-04 20:41:22.132921', true, false, 'origin', NULL, '[{"indexPattern":"v11-log-wineventlog-*","with":[{"field":"log.winlogEventDataParentProcessName.keyword","operator":"filter_term","value":"wmiprvse.exe"},{"field":"log.winlogEventDataUserDomain.keyword","operator":"filter_not_match","value":"NT AUTHORITY"},{"field":"log.message.keyword","operator":"filter_match","value":"(C:\\Users\\(.+).exe|C:\\ProgramData\\(.+).exe|cscript.exe|wscript.exe|PowerShell.EXE|Cmd.Exe|MSHTA.EXE|RUNDLL32.EXE|REGSVR32.EXE|MSBuild.exe|InstallUtil.exe|RegAsm.exe|RegSvcs.exe|msxsl.exe|CONTROL.EXE|EXPLORER.EXE|Microsoft.Workflow.Compiler.exe|msiexec.exe)"}],"or":null,"within":"now-60s","count":1}]');
INSERT INTO public.utm_correlation_rules VALUES (834, 'Suspicious Package Installation Activity', 3, 3, 2, 'Execution, Lateral Movement', 'T1072 - Enterprise Application Deployment', 'Detects unusual package installation or removal activities that could indicate system compromise or unauthorized software deployment. This rule identifies systems with high frequency package management operations using apt, yum, dpkg, rpm, or snap, which may indicate automated malware installation, privilege escalation attempts, or unauthorized system modifications.

Next Steps:
1. Verify the legitimacy of the package operations by reviewing the specific packages being installed/removed
2. Check if the activity corresponds to scheduled maintenance windows or authorized deployments
3. Investigate the user context and permissions under which the package operations are occurring
4. Review system logs for any accompanying suspicious process executions or network connections
5. Examine the source repositories and package signatures for integrity verification
6. Correlate with other security events on the same host for potential attack patterns
7. If unauthorized, initiate incident response procedures and consider host isolation
', '["https://www.elastic.co/guide/en/beats/filebeat/current/filebeat-module-system.html","https://attack.mitre.org/techniques/T1072/"]', '(
      (
        safe("log.message", "").contains("apt") ||
        safe("log.message", "").contains("yum") ||
        safe("log.message", "").contains("dpkg") ||
        safe("log.message", "").contains("rpm") ||
        safe("log.message", "").contains("snap")
      ) &&
      (
        safe("log.message", "").contains("install") ||
        safe("log.message", "").contains("remove") ||
        safe("log.message", "").contains("purge")
      ) &&
      safe("origin.host", "") != ""
    )', '2025-09-05 18:29:42.059758', true, false, 'origin', '["origin.host"]', '[]');
INSERT INTO public.utm_correlation_rules VALUES (842, 'System Update Failures', 2, 3, 3, 'Persistence', 'T1505.001 - Server Software Component: Web Shell', 'Detects failures in system update processes including package manager errors, dependency conflicts, repository issues, and failed patches that may leave systems vulnerable.

Next Steps:
1. Check the specific error messages in the logs to identify the root cause (dependency issues, network problems, repository errors)
2. Verify repository configuration and connectivity to update servers
3. Review disk space availability on system partitions
4. Check for held or broken packages using package manager diagnostic commands
5. Validate GPG keys and repository signatures if authentication failures are present
6. Consider manual intervention to resolve dependency conflicts
7. Review system update policies and maintenance windows
8. Check if critical security updates have been missed due to these failures
9. Monitor for repeated failures on the same host that might indicate persistent issues
10. Assess impact on system security posture due to missing updates
11. Review automated update schedules and maintenance windows
12. Consider implementing redundant update mechanisms or mirrors
', '["https://attack.mitre.org/techniques/T1505/001/","https://www.elastic.co/guide/en/beats/filebeat/current/filebeat-module-system.html"]', '(
        (safe("log.program", "").matches("(?i)(apt|apt-get|dpkg|yum|dnf|zypper|rpm|snap|flatpak)") && 
          safe("log.message", "").matches("(?i)(error|failed|unable|cannot|dependency.*problem|conflict|broken|corrupt)")
        ) ||
        safe("log.message", "").matches("(?i)(repository.*not found|gpg.*fail|signature.*invalid|checksum.*mismatch|verification.*fail)") ||
        safe("log.message", "").matches("(?i)(unmet dependencies|held broken packages|unable to correct problems|dpkg.*error|rpm.*fail)") ||
        safe("log.message", "").matches("(?i)(upgrade.*abort|update.*fail|patch.*error|kernel.*update.*fail|security update.*fail)") ||
        (
          safe("log.program", "") == "unattended-upgrades" && 
          safe("log.message", "").matches("(?i)(error|warning|fail)")
        ) ||
        safe("log.message", "").matches("(?i)(package.*hash.*mismatch|mirror.*fail|cdn.*unreachable|timeout.*repository)")
      )', '2025-09-05 18:21:24.725466', true, false, 'origin', '["origin.host"]', '[]');
INSERT INTO public.utm_correlation_rules VALUES (841, 'Critical System Service Failures', 1, 2, 3, 'Persistence, Privilege Escalation', 'T1543.002 - Create or Modify System Process: Systemd Service', 'Detects critical system service failures that could indicate system instability or potential attacks targeting system services. Multiple service failures in a short time window may indicate a compromise or deliberate service disruption.

Next Steps:
- Review the specific services that failed and their criticality to system operations
- Check system logs for patterns of failure or unusual activity preceding the failures
- Verify if the failures are isolated to a single host or affecting multiple systems
- Investigate if the service failures correlate with other security events such as privilege escalation attempts
- Review recent system changes, updates, or administrative activities
- Consider checking process execution logs for unauthorized service manipulation commands
', '["https://www.elastic.co/guide/en/beats/filebeat/current/filebeat-module-system.html","https://attack.mitre.org/techniques/T1543/002/"]', 'safe("log.message", "").contains("systemd") &&
      (
        safe("log.message", "").contains("Failed") ||
        safe("log.message", "").contains("failed") ||
        safe("log.message", "").contains("error") ||
        safe("log.message", "").contains("crash")
      ) &&
      safe("origin.host", "") != ""', '2025-09-05 19:23:09.504299', true, false, 'origin', '["origin.host"]', '[{"indexPattern":"v11-log-linux-*","with":[{"field":"origin.host.keyword","operator":"filter_term","value":"{{.origin.host}}"},{"field":"log.message.keyword","operator":"filter_term","value":"systemd"},{"field":"log.message.keyword","operator":"filter_term","value":"Failed"}],"or":[],"within":"now-15m","count":3}]');
INSERT INTO public.utm_correlation_rules VALUES (843, 'User Account Modifications', 3, 3, 2, 'Persistence', 'T1136 - Create Account', 'Detects user account creation, modification, or deletion activities that could indicate unauthorized access or privilege escalation attempts. This rule monitors for commands like useradd, usermod, userdel, adduser, deluser, and passwd that are commonly used to manage user accounts on Linux systems.

Next Steps:
1. Verify if the user account modification was authorized and part of a legitimate administrative task
2. Check the origin.user field to identify who performed the action
3. Review the full log message to understand what specific changes were made
4. If the activity appears suspicious:
   - Check for other suspicious activities from the same user or host
   - Review recently created or modified files by the user
   - Verify if any new SSH keys were added to authorized_keys files
   - Check for privilege escalation attempts following the account modification
5. If unauthorized, immediately disable the affected account and investigate the compromise
', '["https://www.elastic.co/guide/en/beats/filebeat/current/filebeat-module-system.html","https://attack.mitre.org/techniques/T1136/"]', 'safe("origin.host", "") != "" && (safe("log.message", "").contains("useradd") || safe("log.message", "").contains("usermod") || safe("log.message", "").contains("userdel") || safe("log.message", "").contains("adduser") || safe("log.message", "").contains("deluser") || (safe("log.message", "").contains("passwd") && safe("log.message", "").contains("changed")))', '2025-09-05 19:27:31.581839', true, false, 'origin', '["origin.host","origin.user"]', '[]');
INSERT INTO public.utm_correlation_rules VALUES (1376, 'Windows: Security Software Discovery using WMIC', 3, 2, 1, 'Discovery', 'Security Software Discovery', 'Identifies the use of Windows Management Instrumentation Command (WMIC) to discover certain System Security Settings such as AntiVirus or Host Firewall details.', '["https://attack.mitre.org/tactics/TA0007/","https://attack.mitre.org/techniques/T1518/001/"]', 'safe("log.message", "").matches("(namespace:\\\\root\\SecurityCenter2)") && safe("log.message", "").contains("(Get") && safe("log.winlogEventDataProcessName", "").contains("wmic.exe")', '2025-09-05 20:11:59.210319', true, false, 'origin', NULL, '[]');
INSERT INTO public.utm_correlation_rules VALUES (845, 'Access Log Injection Attack', 3, 3, 2, 'Defense Evasion', 'T1070 - Indicator Removal on Host', 'Detects attempts to inject malicious content into access logs through request fields, potentially corrupting log integrity or executing log parser exploits. Attackers may use log injection to hide their activities, corrupt log analysis tools, or exploit vulnerabilities in log processing systems.

Next Steps:
1. Immediately investigate the source IP address for other suspicious activities
2. Review all requests from this IP in the last 24 hours for patterns of attack
3. Check if log processing tools or SIEM parsers have been affected
4. Examine the specific injection attempts to understand the attacker''s intent
5. Consider blocking the source IP if multiple injection attempts are confirmed
6. Validate that log integrity has not been compromised
7. Update log parsing rules to properly sanitize user-controlled input
8. Document the incident and any indicators of compromise (IOCs)
', '["https://doc.traefik.io/traefik/observability/access-logs/","https://attack.mitre.org/techniques/T1070/"]', '(safe("log.http.request_headers.user_agent", "").contains("\\n") || safe("log.http.request_headers.user_agent", "").contains("\\r") || safe("log.http.request_headers.user_agent", "").contains("\\x") || safe("log.http.request_headers.referer", "").contains("\\n") || safe("log.http.request_headers.referer", "").contains("\\r") || safe("log.http.request_url", "").contains("%0a") || safe("log.http.request_url", "").contains("%0d") || safe("log.http.request_url", "").contains("${") || safe("log.http.request_headers.user_agent", "").contains("${") || safe("log.http.request_headers.user_agent", "").size() > 500)', '2025-09-03 16:18:25.692764', true, false, 'origin', NULL, '[]');
INSERT INTO public.utm_correlation_rules VALUES (846, 'Circuit Breaker Manipulation Detected', 1, 2, 3, 'Impact', 'T1489 - Service Stop', 'Detects attempts to manipulate circuit breaker behavior through artificial failures, latency injection, or error response flooding in Traefik. This could indicate an attacker trying to disrupt service availability by triggering circuit breaker mechanisms.

Next Steps:
1. Review the source IP address (ClientHost) for legitimacy
2. Check if the high error rate and latency are genuine or artificially induced
3. Examine Traefik access logs for patterns of deliberate failure injection
4. Verify if the backend service is actually experiencing issues
5. Consider temporarily blocking suspicious source IPs if manipulation is confirmed
6. Review circuit breaker configuration thresholds to ensure they are appropriate
7. Correlate with backend service health metrics to distinguish legitimate issues from attacks
8. Check for coordinated attacks from multiple IPs targeting the same service
', '["https://doc.traefik.io/traefik/middlewares/http/circuitbreaker/","https://attack.mitre.org/techniques/T1489/"]', '(safe("log.OriginStatus", 0) >= 500 && safe("log.OriginStatus", 0) < 600) && safe("log.Duration", 0) > 30000000000 && (safe("log.error", "").contains("circuit breaker") || safe("log.error", "").contains("open state") || safe("log.error", "").contains("timeout") || safe("log.error", "").contains("connection refused") || safe("log.Retries", 0) > 2)', '2025-09-03 16:18:26.247462', true, false, 'origin', NULL, '[{"indexPattern":"v11-log-traefik-*","with":[{"field":"log.ClientHost.keyword","operator":"filter_term","value":"{{.log.ClientHost}}"}],"or":null,"within":"now-10m","count":20}]');
INSERT INTO public.utm_correlation_rules VALUES (847, 'Dynamic Configuration Manipulation Attempt', 3, 3, 2, 'Defense Evasion', 'T1562: Impair Defenses', 'Detects attempts to access or modify Traefik''s dynamic configuration through API endpoints, file providers, or other configuration sources that could compromise routing rules. Attackers may try to modify routing rules to redirect traffic, bypass security controls, or gain unauthorized access to internal services.

Next Steps:
1. Verify if the source IP is authorized to make configuration changes
2. Check if the user account associated with the IP has administrative privileges
3. Review the specific configuration endpoints accessed and any changes made
4. Examine proxy logs for any suspicious routing changes or traffic redirection
5. Check for any new or modified backend services, middlewares, or routers
6. Investigate if any security-related middlewares (auth, rate limiting) were disabled
7. Consider blocking the source IP if unauthorized access is confirmed
', '["https://doc.traefik.io/traefik/providers/overview/","https://attack.mitre.org/techniques/T1562/"]', '(safe("log.url", "").contains("/api/providers") || safe("log.url", "").contains("/api/http/routers") || safe("log.url", "").contains("/api/http/services") || safe("log.url", "").contains("/api/http/middlewares") || safe("log.url", "").contains("/api/tcp/routers") || safe("log.url", "").contains("/api/tcp/services") || safe("log.url", "").contains("/api/udp/routers") || safe("log.url", "").contains("/api/udp/services") || safe("log.url", "").contains("/api/entrypoints") && (safe("log.method", "") == "PUT" || safe("log.method", "") == "POST" || safe("log.method", "") == "DELETE" || safe("log.method", "") == "PATCH")', '2025-09-03 16:18:26.730399', true, false, 'origin', '["origin.ip","log.url"]', '[{"indexPattern":"v11-log-traefik-*","with":[{"field":"origin.ip.keyword","operator":"filter_term","value":"{{.origin.ip}}"}],"or":null,"within":"now-1h","count":3}]');
INSERT INTO public.utm_correlation_rules VALUES (849, 'Health Check Falsification Detection', 2, 3, 3, 'Impact', 'T1489 - Service Stop', 'Detects attempts to falsify health check responses, potentially causing service disruption by marking healthy services as unhealthy or unhealthy services as healthy. This could be used by attackers to disrupt service availability or hide malicious services behind false health checks.

Next Steps:
1. Verify if the source IP is authorized to perform health checks
2. Check if the non-GET methods to health endpoints are legitimate monitoring tools
3. Review Traefik configuration to ensure health check endpoints are properly secured
4. Investigate the user agent string and source of the suspicious requests
5. Consider implementing IP whitelisting for health check endpoints if appropriate
6. Analyze the frequency and timing of these requests to identify patterns
7. Cross-reference with legitimate monitoring tools and their expected behavior
8. Review access logs for any correlation with service disruptions or outages
', '["https://doc.traefik.io/traefik/routing/services/#health-check","https://attack.mitre.org/techniques/T1489/"]', 'safe("log.url", "").contains("/health") && safe("log.http.response.code", 0.0) == double(200) && (safe("log.user.agent", "").contains("curl") || safe("log.user.agent", "").contains("wget") || safe("log.user.agent", "") == "") && safe("log.http.method", "") != "GET"', '2025-09-03 16:18:27.65903', true, false, 'origin', '["origin.ip","log.url"]', '[]');
INSERT INTO public.utm_correlation_rules VALUES (1377, 'Windows: Sensitive Privilege SeEnableDelegationPrivilege assigned to a User', 3, 3, 1, 'Credential Access', 'Exploitation for Credential Access', 'Identifies the assignment of the SeEnableDelegationPrivilege sensitive user right to a user. The SeEnableDelegationPrivilege user right enables computer and user accounts to be trusted for delegation. Attackers can abuse this right to compromise Active Directory accounts and elevate their privileges.', '["https://attack.mitre.org/tactics/TA0006/","https://attack.mitre.org/techniques/T1212/"]', 'safe("action", "").matches("([Aa]uthorization [Pp]olicy [Cc]hange)") && safe("log.eventCode", 0.0) == double(4704) && safe("log.winlogEventDataPrivilegeList", "").contains("SeEnableDelegationPrivilege")', '2025-09-04 20:44:35.622425', true, false, 'target', NULL, '[]');
INSERT INTO public.utm_correlation_rules VALUES (848, 'Traefik File Provider Exploits', 3, 3, 2, 'Persistence, Initial Access', 'T1133 - External Remote Services', 'Detects attempts to exploit Traefik''s file provider through unauthorized configuration changes, malicious file uploads, or directory traversal attempts targeting configuration files. Monitors for suspicious access patterns to configuration directories and attempts to modify dynamic configuration files.

Next Steps:
1. Review the source IP address and check if it''s from an authorized administrator
2. Examine the full request path to understand what configuration was targeted
3. Check Traefik logs for any successful configuration changes around the same time
4. Verify file integrity of Traefik configuration files in /etc/traefik or configured paths
5. Review access logs for other suspicious activity from the same source IP
6. If unauthorized, consider blocking the source IP and rotating any exposed credentials
', '["https://doc.traefik.io/traefik/providers/file/","https://attack.mitre.org/techniques/T1133/"]', 'safe("log.action", "") == "traefik.access" && ( (safe("log.request_path", "").contains("..") && safe("log.request_path", "").contains("conf")) || (safe("log.request_path", "").contains("/etc/traefik") && safe("log.request_method", "").in(["PUT", "POST", "PATCH"])) || (safe("log.request_path", "").matches(".*\\.(yml|yaml|toml)$") && safe("log.status_code", 0) >= 400) || (safe("log.error", "").contains("file provider") && safe("log.error", "").contains("permission denied")) || (safe("log.message", "").contains("dynamic configuration") && safe("log.message", "").contains("reload")) || (safe("log.provider", "") == "file" && safe("log.event", "") == "error") )', '2025-09-03 16:18:27.23731', true, false, 'origin', NULL, '[]');
INSERT INTO public.utm_correlation_rules VALUES (850, 'HTTP/3 Vulnerabilities', 3, 2, 3, 'Command and Control', 'T1071.001 - Application Layer Protocol: Web Protocols', 'Detects potential HTTP/3 and QUIC protocol vulnerabilities including UDP port conflicts, TLS configuration issues, and authority header manipulation attempts. These vulnerabilities could allow attackers to bypass security controls, perform protocol downgrade attacks, or exploit UDP-based weaknesses in HTTP/3 implementations.

Next Steps:
1. Investigate the source IP address for suspicious activity patterns
2. Review HTTP/3 and QUIC configuration settings in Traefik
3. Check for any UDP port conflicts or binding issues
4. Verify TLS certificate configuration for HTTP/3 endpoints
5. Monitor for protocol downgrade attempts from the same client
6. Review access logs for unusual request patterns or header manipulation
7. Consider temporarily disabling HTTP/3 if attacks persist
8. Analyze the specific vulnerability type detected in the log messages
9. Check for any correlation with known HTTP/3 CVEs or exploits
', '["https://doc.traefik.io/traefik/routing/entrypoints/#http3","https://attack.mitre.org/techniques/T1071/001/"]', '(safe("action", "") == "traefik.access" || safe("action", "") == "traefik") && ( (safe("log.RequestProtocol", "") == "HTTP/3.0") || (safe("log.message", "").contains("HTTP/3") || safe("log.message", "").contains("QUIC") || safe("log.message", "").contains("alt-svc")) || (safe("log.error_message", "").contains("UDP port") && safe("log.error_message", "").contains("already in use")) || (safe("log.entryPointName", "") != "" && safe("log.RequestScheme", "") == "https" && safe("log.TLSVersion", "") == "" && safe("log.RequestProtocol", "").contains("3")) || (safe("log.headers", "").contains("alt-svc") && safe("log.headers", "").contains("h3=")) )', '2025-09-03 16:18:28.15732', true, false, 'origin', '["origin.ip","log.entryPointName"]', '[]');
INSERT INTO public.utm_correlation_rules VALUES (851, 'Load Balancer Tampering Detected', 3, 3, 3, 'Defense Evasion, Persistence, Command and Control', 'T1205 - Traffic Signaling', 'Detects attempts to tamper with load balancer behavior through header injection, backend manipulation, or session persistence attacks in Traefik. This includes unauthorized access attempts to internal endpoints, API endpoints, or requests from non-local sources trying to access localhost-only resources.

Next Steps:
1. Review the source IP address (log.ClientHost) to determine if it''s from a known or authorized source
2. Check if the requested paths are legitimate administrative actions or unauthorized access attempts
3. Analyze the response codes to understand if the attempts were successful (200) or blocked (401/403)
4. Review Traefik access logs for patterns of similar requests from the same source
5. Check if any load balancer configuration changes were made around the time of these events
6. Consider blocking the source IP if the activity is confirmed malicious
7. Review and strengthen access controls for Traefik administrative endpoints
8. Investigate network traffic patterns to identify potential lateral movement
9. Check for any configuration files or administrative interfaces that may have been compromised
10. Correlate with authentication logs to identify any privileged account usage during the timeframe
', '["https://doc.traefik.io/traefik/routing/services/","https://attack.mitre.org/techniques/T1205/"]', '(safe("log.RequestHost", "").contains("127.0.0.1") ||
 safe("log.RequestHost", "").contains("localhost") ||
 safe("log.RequestHost", "").contains("::1") ||
 safe("origin.url", "").contains("/_internal/") ||
 safe("origin.url", "").contains("/traefik/") ||
 safe("log.RequestPath", "").contains("/api/rawdata") ||
 safe("log.RequestPath", "").contains("/api/overview")) &&
(safe("log.DownstreamStatus", 0.0) == double(403) ||
 safe("log.DownstreamStatus", 0.0) == double(401) ||
 safe("log.DownstreamStatus", 0.0) == double(200)) &&
!safe("log.ClientHost", "").contains("127.0.0.1") &&
!safe("log.ClientHost", "").contains("::1")
', '2025-09-03 16:18:28.523524', true, false, 'origin', '["log.ClientHost"]', '[{"indexPattern":"v11-log-filebeat-traefik-*","with":[{"field":"log.ClientHost.keyword","operator":"filter_term","value":"{{.log.ClientHost}}"}],"or":null,"within":"now-15m","count":5}]');
INSERT INTO public.utm_correlation_rules VALUES (852, 'Metrics Endpoint Unauthorized Access', 3, 1, 1, 'Discovery', 'T1082 - System Information Discovery', 'Detects unauthorized access attempts to Traefik metrics endpoints which could expose sensitive system performance data and infrastructure details.

Next Steps:
- Review the source IP address for legitimacy and check if it belongs to known monitoring systems
- Verify if authentication is properly configured for metrics endpoints
- Check if the IP has accessed other sensitive endpoints
- Consider implementing IP allowlisting for metrics endpoints
- Review Traefik access logs for other suspicious activities from the same source
- Ensure metrics endpoints are not exposed to the internet without proper authentication
', '["https://doc.traefik.io/traefik/observability/metrics/prometheus/","https://attack.mitre.org/techniques/T1082/"]', '(safe("log.url", "").contains("/metrics") || safe("log.url", "").contains("/prometheus") && (safe("log.response_code", 0.0) == double(200) || safe("log.response_code", 0.0) == double(401) || safe("log.response_code", 0.0) == double(403)) && safe("log.request_headers_authorization", "") == ""', '2025-09-03 16:18:28.801304', true, false, 'origin', '["origin.ip"]', '[{"indexPattern":"v11-log-traefik-*","with":[{"field":"origin.ip.keyword","operator":"filter_term","value":"{{.origin.ip}}"}],"or":null,"within":"now-15m","count":5}]');
INSERT INTO public.utm_correlation_rules VALUES (1378, 'Windows: Service Control Spawned via Script Interpreter', 2, 3, 2, 'Lateral Movement', 'Remote Services', 'Identifies Service Control (sc.exe) spawning from script interpreter processes to create, modify, or start services. This could be indicative of adversary lateral movement but will be noisy if commonly done by admins.', '["https://attack.mitre.org/tactics/TA0008/","https://attack.mitre.org/techniques/T1021/"]', 'safe("log.winlogEventDataParentProcessName", "") in ["cmd.exe", "wscript.exe", "rundll32.exe", "regsvr32.exe", "wmic.exe", "mshta.exe", "powershell.exe", "pwsh.exe"] && safe("log.message", "") in ["config", "create", "start", "delete", "stop", "pause"] && safe("log.winlogEventDataSubjectUserName", "") != "S-1-5-18" && safe("log.winlogEventDataProcessName", "").contains("sc.exe")', '2025-09-04 20:44:36.151732', true, false, 'origin', NULL, '[]');
INSERT INTO public.utm_correlation_rules VALUES (853, 'Middleware Bypass Attempt', 3, 3, 1, 'Defense Evasion', 'T1562.001 - Impair Defenses: Disable or Modify Tools', 'Detects attempts to bypass Traefik middleware security controls such as authentication, rate limiting, or IP filtering through malformed requests or path manipulation.

Next Steps:
1. Review the specific middleware configuration that may have been bypassed
2. Check if the source IP has a history of suspicious activity
3. Analyze the full request headers and path to understand the bypass technique
4. Verify if any unauthorized access was gained to protected resources
5. Consider blocking the source IP if malicious intent is confirmed
6. Review and strengthen middleware security configurations
', '["https://doc.traefik.io/traefik/middlewares/overview/","https://attack.mitre.org/techniques/T1562/001/"]', '(safe("statusCode", 0.0) == double(200) || safe("statusCode", 0.0) == double(201)) && (safe("log.request_path", "").contains("/.") || safe("log.request_path", "").contains("//") || safe("log.request_path", "").contains("/./") || safe("log.request_path", "").contains("/%2e/") || safe("log.request_path", "").contains("/%252e/") || safe("log.request_path", "").contains("\\x") || safe("log.request_path", "").contains("%00") || safe("log.request_path", "").contains("%0d%0a") || (safe("log.request_headers", "").contains("X-Forwarded-For") && safe("log.request_headers", "").contains("127.0.0.1")) || (safe("log.request_headers", "").contains("X-Real-IP") && safe("log.request_headers", "").contains("localhost")))', '2025-09-03 16:18:29.200085', true, false, 'origin', '["adversary.ip","log.router_name","log.service_name"]', '[{"indexPattern":"v11-log-traefik-*","with":[{"field":"origin.ip.keyword","operator":"filter_term","value":"{{.origin.ip}}"}],"or":null,"within":"now-30m","count":5}]');
INSERT INTO public.utm_correlation_rules VALUES (1274, 'Windows Remote Management (WinRM) Abuse', 3, 3, 2, 'Lateral Movement', 'T1021.006 - Remote Services: Windows Remote Management', 'Detects potential abuse of Windows Remote Management (WinRM) for lateral movement. Monitors for successful logon events (4624) with network logon type 3 combined with privilege escalation (4672) and WinRM-related process activity, indicating remote command execution via WinRM.

Next Steps:
1. Investigate the source IP address and verify if it''s an authorized administrative workstation
2. Review the target user account for any signs of compromise or unusual privilege usage
3. Examine recent PowerShell execution logs and command history on the target system
4. Check for concurrent suspicious activities from the same source IP across other systems
5. Verify if the WinRM connection aligns with scheduled maintenance or authorized administrative tasks
6. Review network traffic patterns between source and target systems for data exfiltration indicators
7. Validate the legitimacy of any processes spawned through the WinRM session
8. Consider implementing additional monitoring for WinRM usage if this represents unexpected activity
', '["https://jpcertcc.github.io/ToolAnalysisResultSheet/details/WinRM.htm","https://attack.mitre.org/techniques/T1021/006/"]', 'safe("log.eventCode", 0.0) == double(4624) &&
safe("log.winlogEventDataLogonType", "") == "3" &&
safe("log.winlogEventDataProcessName", "") != "" &&
["wsmprovhost.exe", "winrshost.exe", "powershell.exe"].exists(p, safe("log.winlogEventDataProcessName", "").contains(p))
', '2025-09-04 19:30:34.690176', true, false, 'origin', '["log.winlogEventDataIpAddress","log.winlogEventDataTargetUserName","origin.host"]', '[{"indexPattern":"v11-log-wineventlog-*","with":[{"field":"log.winlogEventDataIpAddress.keyword","operator":"filter_term","value":"{{.log.winlogEventDataIpAddress}}"},{"field":"log.eventCode","operator":"filter_term","value":4672},{"field":"target.user.keyword","operator":"filter_term","value":"{{.log.winlogEventDataTargetUserName}}"}],"or":null,"within":"now-5m","count":1}]');
INSERT INTO public.utm_correlation_rules VALUES (1379, 'Windows: Potential Shadow Credentials added to AD Object', 3, 3, 2, 'Credential Access', 'Modify Authentication Process', 'Identify the modification of the msDS-KeyCredentialLink attribute in an Active Directory Computer or User Object. Attackers can abuse control over the object and create a key pair, append to raw public key in the attribute, and obtain persistent and stealthy access to the target user or computer object.', '["https://attack.mitre.org/tactics/TA0006/","https://attack.mitre.org/techniques/T1556/"]', 'safe("log.action", "").matches("([Dd]irectory [Ss]ervice [Cc]hanges)") && safe("log.eventCode", 0.0) == double(5136) && safe("log.message", "").matches("(msDS-KeyCredentialLink)") && safe("log.message", "").contains(":828")', '2025-09-04 20:44:36.669699', true, false, 'origin', NULL, '[]');
INSERT INTO public.utm_correlation_rules VALUES (1380, 'Windows: Execution via local SxS Shared Modules', 1, 2, 3, 'Execution', 'Shared Modules', 'Identifies the creation, change, or deletion of a DLL module within a Windows SxS local folder. Adversaries may abuse shared modules to execute malicious payloads by instructing the Windows module loader to load DLLs from arbitrary local paths.', '["https://attack.mitre.org/tactics/TA0002/","https://attack.mitre.org/techniques/T1129/"]', 'safe("log.file.extension", "").contains("dll") && safe("log.file.path", "").matches("(C:\\\\(.+)\\\\.exe.local\\\\(.+).dll)")', '2025-09-04 20:44:37.200021', true, false, 'origin', NULL, '[]');
INSERT INTO public.utm_correlation_rules VALUES (1381, 'Windows: SIP Provider Modification', 1, 2, 3, 'Defense Evasion', 'SIP and Trust Provider Hijacking', 'Identifies modifications to the registered Subject Interface Package (SIP) providers. SIP providers are used by the Windows cryptographic system to validate file signatures on the system. This may be an attempt to bypass signature validation checks or inject code into critical processes.', '["https://attack.mitre.org/tactics/TA0005/","https://attack.mitre.org/techniques/T1553/003/"]', 'safe("log.event.type", "") == "change" && safe("log.registryDataStrings", "").contains(".dll") && safe("log.registryPath", "").matches("(HKLM\\\\SOFTWARE(\\\\WOW6432Node)?\\\\Microsoft\\\\Cryptography\\\\OID\\\\EncodingType 0\\\\CryptSIPDllPutSignedDataMsg\\\\(.+)\\\\Dll|HKLM\\\\SOFTWARE(\\\\WOW6432Node)?\\\\Microsoft\\\\Cryptography\\\\Providers\\\\Trust\\\\FinalPolicy\\\\(.+)\\\\\\$Dll)")', '2025-09-04 20:44:37.734512', true, false, 'origin', NULL, '[]');
INSERT INTO public.utm_correlation_rules VALUES (1382, 'Windows: User account exposed to Kerberoasting', 3, 3, 2, 'Credential Access', 'Kerberoasting', 'Detects when a user account has the servicePrincipalName attribute modified. Attackers can abuse write privileges over a user to configure Service Principle Names (SPNs) so that they can perform Kerberoasting. Administrators can also configure this for legitimate purposes, exposing the account to Kerberoasting.', '["https://attack.mitre.org/tactics/TA0006/","https://attack.mitre.org/techniques/T1558/003/"]', 'safe("log.action", "").matches("([Dd]irectory [Ss]ervice [Cc]hanges)") && safe("log.eventCode", 0.0) == double(5136) && safe("log.message", "").matches("(servicePrincipalName)")', '2025-09-04 20:45:17.166837', true, false, 'target', NULL, '[]');
INSERT INTO public.utm_correlation_rules VALUES (1383, 'Windows: Startup Persistence by a Suspicious Process', 1, 2, 3, 'Persistence', 'Registry Run Keys / Startup Folder', 'Identifies files written to or modified in the startup folder by commonly abused processes. Adversaries may use this technique to maintain persistence.', '["https://attack.mitre.org/tactics/TA0003/","https://attack.mitre.org/techniques/T1547/001/"]', 'safe("log.message", "").contains("delet") && safe("log.eventDataProcessName", "").matches("(cmd.exe|powershell.exe|wmic.exe|mshta.exe|pwsh.exe|cscript.exe|wscript.exe|regsvr32.exe|RegAsm.exe|rundll32.exe|EQNEDT32.EXE|WINWORD.EXE|EXCEL.EXE|POWERPNT.EXE|MSPUB.EXE|MSACCESS.EXE|iexplore.exe|InstallUtil.exe)") && safe("log.message", "").matches("(C:\\Users\\(.+)\\AppData\\Roaming\\Microsoft\\Windows\\Start Menu\\Programs\\Startup\\|C:\\ProgramData\\Microsoft\\Windows\\Start Menu\\Programs\\StartUp\\)") && !safe("target.domain", "").contains("NT AUTHORITY")', '2025-09-04 20:45:17.659602', true, false, 'origin', NULL, '[]');
INSERT INTO public.utm_correlation_rules VALUES (855, 'Provider API Abuse Detection', 3, 3, 2, 'Execution', 'API Exploitation', 'Detects unauthorized or suspicious access to Traefik provider APIs including Docker, Kubernetes, Consul, or file providers that could lead to configuration tampering.

Next Steps:
1. Review the source IP address and check if it belongs to authorized administrators
2. Examine the specific API endpoints being accessed and the HTTP status codes returned
3. Check for any configuration changes made through the provider APIs around this time
4. Verify if the authentication headers are present and valid for API access
5. Look for patterns of API enumeration or brute force attempts from the same IP
6. If unauthorized access is confirmed, block the IP and rotate API credentials
7. Review Traefik access logs for additional suspicious activity from the same source
8. Check if legitimate API tools or automation might be misconfigured
', '["https://doc.traefik.io/traefik/providers/overview/","https://attack.mitre.org/techniques/T1106/"]', '(safe("log.url", "").contains("/api/providers") ||
 safe("log.url", "").contains("/api/overview") ||
 (safe("log.request_path", "").contains("/api/docker") ||
  safe("log.request_path", "").contains("/api/kubernetes") ||
  safe("log.request_path", "").contains("/api/consul") ||
  safe("log.request_path", "").contains("/api/file") ||
  safe("log.request_path", "").contains("/api/etcd") ||
  safe("log.request_path", "").contains("/api/zookeeper") ||
  safe("log.request_path", "").contains("/api/redis"))) &&
(safe("statusCode", 0) in [401, 403, 429] ||
 (safe("log.method", "") == "GET" && safe("log.response_size", 0) > 1048576) ||
 (safe("log.method", "") in ["POST", "PUT", "PATCH", "DELETE"] && 
  safe("log.username", "") == "") ||
 !safe("log.request_headers", "").contains("Authorization") ||
 (safe("log.duration", 0) > 10000 && safe("log.method", "") == "GET"))
', '2025-09-03 16:18:57.30818', true, false, 'origin', '["origin.ip","target.url"]', '[{"indexPattern":"v11-log-traefik-*","with":[{"field":"origin.ip.keyword","operator":"filter_term","value":"{{.origin.ip}}"}],"or":null,"within":"now-10m","count":10}]');
INSERT INTO public.utm_correlation_rules VALUES (856, 'Rate Limiter Bypass Attempt Detected', 2, 1, 3, 'Impact', 'T1499 - Endpoint Denial of Service', 'Detects attempts to bypass rate limiting controls through rapid requests, header manipulation, or distributed attacks in Traefik. This rule triggers when multiple rate-limited (429) or service unavailable (503) responses occur for sensitive endpoints within a short time window.

Next Steps:
- Review the source IP address (ClientHost) and check if it''s from a known malicious source
- Examine the targeted endpoint (RequestPath) to understand what resource is being attacked
- Check if multiple IPs are targeting the same endpoint (potential distributed attack)
- Review Traefik rate limiting configuration to ensure it''s properly configured
- Consider implementing additional rate limiting rules or IP blocking for persistent offenders
- Analyze request patterns to identify potential bot behavior or automated tools
- Monitor for escalation to more sophisticated attack techniques
', '["https://doc.traefik.io/traefik/middlewares/http/ratelimit/","https://attack.mitre.org/techniques/T1499/"]', '(safe("log.DownstreamStatus", 0.0) == double(429) || safe("log.DownstreamStatus", 0.0) == double(503)) && safe("log.Duration", 0) < 1000000 && (safe("log.RequestPath", "").contains("/api/") || safe("log.RequestPath", "").contains("/auth/") || safe("log.RequestPath", "").contains("/login") || safe("log.RequestPath", "").contains("/token") || safe("log.RequestMethod", "") == "POST")', '2025-09-03 16:18:58.685857', true, false, 'origin', '["origin.ip","target.url"]', '[{"indexPattern":"v11-log-traefik-*","with":[{"field":"log.ClientHost.keyword","operator":"filter_term","value":"{{.log.ClientHost}}"},{"field":"log.RequestPath.keyword","operator":"filter_term","value":"{{.log.RequestPath}}"}],"or":null,"within":"now-1m","count":50}]');
INSERT INTO public.utm_correlation_rules VALUES (857, 'Redis Provider Issues', 1, 2, 3, 'Defense Evasion', 'T1562.001 - Impair Defenses: Disable or Modify Tools', 'Detects issues with Redis provider connection, authentication failures, or keyspace notification problems that could indicate service disruption or configuration tampering attempts.

Next Steps:
1. Check Redis server connectivity and ensure it''s running on the expected host/port
2. Verify Redis authentication credentials in Traefik configuration
3. Review Redis server logs for connection attempts and authentication failures
4. Check if Redis keyspace notifications are properly enabled (notify-keyspace-events)
5. Monitor network connectivity between Traefik and Redis
6. Review recent configuration changes to Traefik or Redis
7. Check for signs of DoS attacks or resource exhaustion on Redis server
8. Validate Traefik configuration syntax and provider settings
9. Consider implementing Redis clustering or backup providers for high availability
', '["https://doc.traefik.io/traefik/providers/redis/","https://attack.mitre.org/techniques/T1562/001/"]', '(safe("log.action", "") == "traefik.access" || safe("log.action", "") == "traefik") && ( (safe("log.message", "").contains("redis") && (safe("log.message", "").contains("connection refused") || safe("log.message", "").contains("authentication failed") || safe("log.message", "").contains("keyspace notification"))) || (safe("log.error", "").contains("redis provider")) || (safe("log.ServiceName", "").contains("redis") && safe("log.DownstreamStatus", "") != "" && int(safe("log.DownstreamStatus", "0")) >= 500) || (safe("log.provider", "") == "redis" && safe("log.status", "") == "error") )', '2025-09-03 16:18:59.198371', true, false, 'origin', '["origin.host"]', '[{"indexPattern":"v11-log-syslog-*","with":[{"field":"origin.host.keyword","operator":"filter_term","value":"{{.origin.host}}"},{"field":"log.message.keyword","operator":"filter_match","value":"redis"}],"or":null,"within":"now-15m","count":3}]');
INSERT INTO public.utm_correlation_rules VALUES (858, 'Retry Mechanism Abuse Detected', 1, 1, 3, 'Impact', 'T1499.002 - Endpoint Denial of Service: Service Exhaustion Flood', 'Detects abuse of retry mechanisms through excessive retry attempts, retry amplification attacks, or retry configuration exploitation in Traefik. This can lead to resource exhaustion and service unavailability.

Next Steps:
1. Review the source IP address (ClientHost) for suspicious patterns or known malicious IPs
2. Check if multiple endpoints are being targeted with retry abuse from the same source
3. Analyze the origin status codes to understand the nature of failures causing retries
4. Examine the request duration to identify potential timeout-based attacks
5. Consider implementing rate limiting on retry mechanisms
6. Review Traefik retry configuration to ensure appropriate limits are set
7. Monitor backend service health to ensure they''re not overwhelmed by retry traffic
', '["https://doc.traefik.io/traefik/middlewares/http/retry/","https://attack.mitre.org/techniques/T1499/002/"]', 'safe("log.retries", 0) > 3 && (safe("log.origin_status", 0) >= 500 || safe("log.origin_status", 0.0) == double(0) || safe("log.message", "").contains("retry") || safe("log.message", "").contains("attempt")) && safe("log.duration", 0) > 5000000000', '2025-09-03 16:18:59.714789', true, false, 'origin', '["origin.host","target.host"]', '[{"indexPattern":"v11-log-traefik-*","with":[{"field":"log.client_host.keyword","operator":"filter_term","value":"{{.log.client_host}}"},{"field":"log.request_host.keyword","operator":"filter_term","value":"{{.log.request_host}}"}],"or":null,"within":"now-5m","count":30}]');
INSERT INTO public.utm_correlation_rules VALUES (860, 'Service Discovery Poisoning Attempt', 3, 3, 2, 'Credential Access, Collection', 'T1557 - Man-in-the-Middle: LLMNR/NBT-NS Poisoning and SMB Relay', 'Detects attempts to poison Traefik''s service discovery mechanism by injecting malicious service endpoints or manipulating provider configurations. This could allow an attacker to redirect traffic to malicious servers or disrupt service availability.

Next Steps:
1. Review the suspicious request details to identify the source IP and user agent
2. Check if the origin IP is authorized to modify Traefik configurations
3. Examine the request body to understand what service endpoints were being modified
4. Review Traefik provider configurations for any unauthorized changes
5. Check for any traffic being routed to the suspicious endpoints
6. If confirmed malicious, block the source IP and revert any configuration changes
7. Review access controls for Traefik API endpoints
8. Monitor for additional requests from the same source IP
9. Check application logs for any service routing anomalies
10. Verify integrity of service discovery backend stores (Consul, etcd, etc.)
', '["https://doc.traefik.io/traefik/providers/overview/","https://attack.mitre.org/techniques/T1557/"]', 'safe("log.method", "") in ["POST", "PUT", "DELETE"] && (safe("log.url", "").contains("/api/providers/") || safe("log.url", "").contains("/api/http/services/") || safe("log.url", "").contains("/consul/") || safe("log.url", "").contains("/etcd/") || safe("log.url", "").contains("/zookeeper/") || safe("log.url", "").contains("/kubernetes/")) && (safe("log.body", "").contains("loadBalancer") || safe("log.body", "").contains("servers") || safe("log.body", "").contains("url:") || safe("log.body", "").contains("address:")) && (safe("log.body", "").contains("10.") || safe("log.body", "").contains("172.") || safe("log.body", "").contains("192.168.") || safe("log.body", "").contains("localhost") || safe("log.body", "").contains("127.0.0.1"))', '2025-09-03 16:19:01.16251', true, false, 'origin', '["origin.ip","log.url"]', '[]');
INSERT INTO public.utm_correlation_rules VALUES (861, 'TLS Configuration Attack Detected', 3, 2, 2, 'Initial Access', 'T1190 - Exploit Public-Facing Application', 'Detects potential TLS configuration attacks including downgrade attempts, cipher manipulation, and certificate validation bypass attempts in Traefik. This rule triggers when multiple suspicious TLS-related requests are detected from the same client, including attempts to access certificate endpoints, use of outdated TLS versions, or errors related to TLS handshakes.

Next Steps:
1. Review the source IP address and check for any previous security incidents
2. Examine the specific TLS version and cipher suite being requested
3. Check Traefik access logs for the full pattern of requests from this client
4. Verify if legitimate certificate renewal processes are in progress
5. Consider blocking the source IP if malicious intent is confirmed
6. Review and strengthen TLS configuration to disable weak protocols
7. Analyze the full request context including user agent and request headers
8. Check for correlation with other security events from the same source
', '["https://doc.traefik.io/traefik/observability/access-logs/","https://attack.mitre.org/techniques/T1190/"]', 'safe("log.downstream_status", 0.0) == double(400) && ( safe("log.request_path", "").contains("/.well-known/") || safe("log.request_path", "").contains("/acme-challenge/") || safe("log.error", "").contains("tls") || safe("log.error", "").contains("certificate") || safe("log.error", "").contains("handshake") || safe("log.request_protocol", "").contains("HTTP/1.0") || safe("log.tls_version", "") == "1.0" || safe("log.tls_version", "") == "1.1" )', '2025-09-03 16:19:01.765047', true, false, 'origin', '["log.client_host"]', '[{"indexPattern":"v11-log-traefik-*","with":[{"field":"log.client_host.keyword","operator":"filter_term","value":"{{.log.client_host}}"}],"or":null,"within":"now-5m","count":10}]');
INSERT INTO public.utm_correlation_rules VALUES (862, 'Tracing Data Exposure Detection', 3, 2, 1, 'Discovery', 'T1016 - System Network Configuration Discovery', 'Detects access to tracing endpoints or headers that could expose sensitive request flow information, service dependencies, and performance metrics. This can reveal application architecture, internal service names, performance bottlenecks, and request flow patterns to attackers.

Next Steps:
- Verify if the source IP is authorized to access tracing data
- Check if this is a legitimate monitoring or debugging activity
- Review Traefik configuration to ensure tracing endpoints are properly secured
- Investigate other requests from this IP for reconnaissance patterns
- Consider implementing authentication for debug endpoints
- Review exposed trace information for sensitive data leakage
- Check if the accessing user account has proper permissions
- Analyze the timing and frequency of these requests for automated scanning behavior
', '["https://doc.traefik.io/traefik/observability/tracing/","https://attack.mitre.org/techniques/T1016/"]', '(safe("log.http_request_headers_x_trace_id", "") != "" || safe("log.http_request_headers_x_span_id", "") != "" || safe("log.http_request_headers_x_b3_traceid", "") != "" || safe("log.http_request_headers_traceparent", "") != "" || safe("origin.url", "").contains("/debug/pprof") || safe("origin.url", "").contains("/trace")) && safe("statusCode", 0) < 400', '2025-09-03 16:19:02.25685', true, false, 'origin', '["origin.ip","origin.url"]', '[]');
INSERT INTO public.utm_correlation_rules VALUES (863, 'JSON Array Manipulation Attack', 3, 3, 3, 'Impact', 'Array Manipulation', 'Detects attempts to manipulate JSON arrays including oversized arrays, array injection attacks, and attempts to bypass security controls through array manipulation techniques. This rule identifies various indicators of malicious array manipulation such as excessive array sizes, array-related errors, injection patterns, and suspicious array characteristics.

Next Steps:
1. Investigate the source IP address and associated user account
2. Review the full JSON payload for malicious content
3. Check application logs for related errors or exceptions
4. Analyze the timing and frequency of array manipulation attempts
5. Verify if the manipulation attempt was successful or blocked
6. Review network traffic for additional suspicious activity from the same source
7. Consider implementing additional input validation and rate limiting
', '["https://medium.com/dataseries/working-with-json-injection-attacks-90eda79305e2","https://attack.mitre.org/techniques/T1565/001/"]', '(safe("log.array_size", 0) > 10000 || safe("log.error", "").contains("array overflow") || safe("log.error", "").contains("array bounds") || safe("log.error", "").contains("invalid array") || safe("log.message", "").contains("array manipulation") || safe("log.message", "").contains("array injection") || safe("log.payload", "").contains("[][]") || safe("log.payload", "").contains("[null,null,null") || (safe("log.array_count", 0) > 100 && safe("log.unique_values", 0) < 5) || (safe("log.empty_arrays", 0) > 50) || safe("log.nested_arrays", 0) > 10) && safe("origin.ip", "") != ""', '2025-09-03 16:29:01.627221', true, false, 'origin', NULL, '[]');
INSERT INTO public.utm_correlation_rules VALUES (1277, 'Windows: Remote File Copy to a Hidden Share', 3, 2, 1, 'Lateral Movement', 'Remote Services', 'Identifies a remote file copy attempt to a hidden network share. This may indicate lateral movement or data staging activity.', '["https://attack.mitre.org/tactics/TA0008/","https://attack.mitre.org/techniques/T1021/"]', 'safe("log.winlogEventDataProcessName", "") in ["cmd.exe", "powershell.exe", "robocopy.exe", "xcopy.exe"] && safe("log.message", "").contains("$") && (safe("log.message", "").contains("copy") || safe("log.message", "").contains("move") || safe("log.message", "").contains(" cp ") || safe("log.message", "").contains(" mv "))', '2025-09-04 19:58:19.938533', true, false, 'origin', NULL, '[]');
INSERT INTO public.utm_correlation_rules VALUES (864, 'JSON Callback Manipulation Attack', 3, 3, 2, 'Execution', 'JSONP Injection', 'Detects attempts to manipulate JSON callbacks (JSONP) to execute arbitrary JavaScript code. This includes injecting malicious callback functions, manipulating existing callbacks, or exploiting JSONP endpoints for cross-site scripting attacks.

Next Steps:
1. Immediately block the source IP if confirmed malicious
2. Review all JSONP endpoints for proper input validation
3. Examine HTTP request logs for additional malicious callback attempts
4. Check Content Security Policy (CSP) configuration
5. Validate callback parameter sanitization on affected endpoints
6. Monitor for successful code execution indicators
7. Review authentication logs for account compromise
8. Consider implementing strict callback whitelisting
', '["https://securitycafe.ro/2017/01/18/practical-jsonp-injection/","https://cheatsheetseries.owasp.org/cheatsheets/AJAX_Security_Cheat_Sheet.html","https://attack.mitre.org/techniques/T1059/007/"]', '(safe("log.callback", "").contains("<script") || safe("log.callback", "").contains("javascript:") || safe("log.callback", "").contains("eval(") || safe("log.jsonp_callback", "") !~ "^[a-zA-Z_$][a-zA-Z0-9_$]*$" || safe("log.error", "").contains("invalid callback") || safe("log.security_event", "") == "jsonp_injection" || (safe("log.request_parameter", "") == "callback" && (safe("log.parameter_value", "").contains("alert(" || safe("log.parameter_value", "").contains("document.") || safe("log.parameter_value", "").contains("window.")) || safe("log.csp_violation", "").contains("jsonp") || safe("log.blocked_action", "") == "callback_execution")', '2025-09-03 16:29:02.055045', true, false, 'origin', NULL, '[]');
INSERT INTO public.utm_correlation_rules VALUES (865, 'JSON CPU Exhaustion Attack', 1, 2, 3, 'Impact', 'T1496 - Resource Hijacking', 'Detects attempts to exhaust CPU resources through malicious JSON processing. This includes complex parsing operations, excessive string manipulations, or patterns that cause high CPU usage during JSON deserialization. Such attacks can lead to denial of service conditions by overwhelming system resources.

Next Steps:
1. Investigate the source of the JSON input causing high CPU usage
2. Analyze the JSON structure and complexity that triggered the alert
3. Check for patterns of repeated requests from the same source
4. Review system resource utilization and performance metrics
5. Consider implementing rate limiting or input validation controls
6. Monitor for similar attacks from other sources
7. Review application logs for any error patterns or anomalies
8. Implement JSON schema validation to prevent malformed payloads
', '["https://medium.com/data-science-community-srm/json-is-incredibly-slow-heres-what-s-faster-ca35d5aaf9e8","https://attack.mitre.org/techniques/T1496/"]', '(safe("log.cpu_usage_percent", 0) > 90 && safe("log.component", "") == "json_parser") || safe("log.error", "").contains("CPU limit exceeded") || safe("log.error_type", "") == "cpu_exhaustion" || safe("log.processing_time_ms", 0) > 30000 || safe("log.parser_timeout", false) == true || safe("log.message", "").contains("JSON parsing timeout") || (safe("log.thread_state", "") == "blocked" && safe("log.blocked_on", "").contains("json")) || safe("log.json_complexity_score", 0) > 1000 || safe("log.string_operations_count", 0) > 100000', '2025-09-03 16:29:02.567412', true, false, 'origin', NULL, '[]');
INSERT INTO public.utm_correlation_rules VALUES (866, 'JSON Depth Limit Violation Detection', 1, 2, 3, 'Impact', 'Nested Structure Attack', 'Detects attempts to send deeply nested JSON structures that could cause parser stack overflow, excessive memory usage, or denial of service conditions. This attack technique involves crafting JSON payloads with excessive nesting levels to overwhelm parsing resources and potentially crash applications.

Next Steps:
1. Examine the raw JSON payload in the log.raw field to confirm the nesting structure
2. Check application logs for any parser errors, memory spikes, or service crashes
3. Review the source IP for other suspicious JSON parsing attempts
4. Validate JSON parsing configurations and depth limits in affected applications
5. Consider implementing or adjusting JSON depth validation controls
6. Monitor system resources (CPU, memory) during the timeframe of the alert
', '["https://danaepp.com/attacking-apis-using-json-injection","https://attack.mitre.org/techniques/T1499/002/"]', '(safe("log.nesting_depth", 0) > 100) || (safe("log.json_depth", 0) > 100) || (safe("log.max_depth_exceeded", false) == true) || (safe("log.error", "").contains("maximum depth")) || (safe("log.error", "").contains("nesting too deep")) || (safe("log.parser_error", "").contains("recursion limit")) || (safe("log.parser_error", "").contains("stack overflow")) || (safe("log.processing_time", 0) > 5000 && safe("log.json_depth", 0) > 50)', '2025-09-03 16:29:03.246519', true, false, 'origin', NULL, '[]');
INSERT INTO public.utm_correlation_rules VALUES (867, 'Unsafe Deserialization Attack Detected', 3, 3, 2, 'Initial Access', 'T1190 - Exploit Public-Facing Application', 'Detects attempts to exploit unsafe deserialization vulnerabilities through malicious JSON payloads containing serialized objects or code execution patterns. These attacks can lead to remote code execution, privilege escalation, or data compromise.

Next Steps:
1. Analyze the JSON payload structure and identify malicious patterns
2. Check application logs for evidence of successful exploitation
3. Review the target application''s deserialization implementation
4. Implement input validation and use safe deserialization practices
5. Monitor for any unusual process execution or system changes
6. Consider blocking the source IP if attack patterns persist
7. Examine target application for signs of compromise
8. Review recent deployments or configuration changes
9. Check for additional indicators of compromise on affected systems
10. Document the attack pattern for threat intelligence purposes
', '["https://knowledge-base.secureflag.com/vulnerabilities/unsafe_deserialization/unsafe_deserialization_java.html","https://attack.mitre.org/techniques/T1190/"]', '(safe("log.message", "").contains("java.lang.Runtime")) || (safe("log.message", "").contains("java.lang.ProcessBuilder")) || (safe("log.message", "").contains("java.io.ObjectInputStream")) || (safe("log.message", "").contains("readObject()")) || (safe("log.message", "").contains("writeObject()")) || (safe("log.message", "").contains("serialVersionUID")) || (safe("log.message", "").contains("$$beanFactory")) || (safe("log.message", "").contains("gadget")) || (safe("log.type", "") != "") || (safe("log._type", "") != "") || (safe("log.class", "") != "")', '2025-09-03 16:29:03.584847', true, false, 'origin', NULL, '[]');
INSERT INTO public.utm_correlation_rules VALUES (883, 'JSON Reference Loop Attack', 1, 3, 3, 'Impact', 'T1499 - Endpoint Denial of Service', 'Detects attempts to create circular references or reference loops in JSON data that could lead to infinite loops, memory exhaustion, or parser crashes. This attack exploits JSON parsers that don''t properly handle circular references.

Next Steps:
1. Investigate the source IP address and any associated user accounts
2. Review application logs for patterns of similar attacks
3. Check if the JSON parser has proper depth limits and circular reference detection
4. Implement rate limiting for JSON processing endpoints
5. Consider updating JSON parsing libraries to versions with better protection
6. Monitor system resources (CPU, memory) for signs of exhaustion
7. Block the attacking IP if confirmed malicious
', '["https://bishopfox.com/blog/json-interoperability-vulnerabilities","https://attack.mitre.org/techniques/T1499/"]', '(safe("log.error", "").contains("circular reference") || safe("log.error", "").contains("reference loop") || safe("log.error_type", "").contains("circular_dependency") || safe("log.parser_error", "").contains("maximum recursion") || safe("log.message", "").contains("infinite loop detected") || safe("log.json_depth", 0) > 100 || (safe("log.error_code", "") == "ERR_JSON_CIRCULAR_REF" || safe("log.error_code", "") == "ERR_MAX_RECURSION"))', '2025-09-03 16:30:02.279199', true, false, 'origin', NULL, '[]');
INSERT INTO public.utm_correlation_rules VALUES (869, 'JSON Hijacking Attempt Detected', 3, 2, 1, 'Execution', 'JSON Hijacking', 'Detects attempts to hijack JSON data through malicious script tags, Array constructor overrides, or cross-domain data theft patterns. JSON hijacking attacks attempt to steal sensitive data by exploiting vulnerabilities in JSON responses through script tag inclusion or prototype manipulation.

Next Steps:
1. Review the request details and identify the source of the hijacking attempt
2. Check if the origin IP is from a known malicious source
3. Examine the full request payload for additional malicious indicators
4. Verify if any sensitive data was exposed in the JSON response
5. Implement proper CSRF tokens and validate referer headers
6. Consider blocking the source IP if malicious activity is confirmed
7. Review application code for proper JSON response security measures
', '["https://owasp.org/www-community/attacks/JSON_Hijacking","https://attack.mitre.org/techniques/T1059/007/"]', '(contains(safe("log.message", ""), "<script") || contains(safe("log.message", ""), "Array.prototype") || contains(safe("log.message", ""), "Object.defineProperty") || contains(safe("log.message", ""), "window.location") || contains(safe("log.message", ""), "document.domain") || contains(safe("log.message", ""), "postMessage") || (safe("log.callback", "") != "" && contains(safe("log.callback", ""), "eval")) || (safe("origin.url", "") != "" && safe("target.domain", "") != "" && !contains(safe("origin.url", ""), safe("target.domain", ""))))', '2025-09-03 16:29:04.546802', true, false, 'origin', NULL, '[]');
INSERT INTO public.utm_correlation_rules VALUES (870, 'JSON Injection Attack Attempt', 3, 3, 2, 'Defense Evasion', 'JSON Injection', 'Detects potential JSON injection attempts including malicious payloads, script injections, and attempts to manipulate JSON structure. These attacks can lead to XSS, authentication bypass, or remote code execution.

Next Steps:
1. Examine the full JSON payload for injection patterns and malicious content
2. Check if the request was successful and what data was accessed or modified
3. Review authentication status and privileges of the requesting user
4. Investigate the source IP for other suspicious activities
5. Validate JSON parsing error logs for additional attack indicators
6. Check for any successful exploitation or data exfiltration
', '["https://www.acunetix.com/blog/web-security-zone/what-are-json-injections/","https://attack.mitre.org/techniques/T1027/"]', '(safe("log.payload", "").contains("<script") || safe("log.payload", "").contains("javascript:") || safe("log.payload", "").contains("eval(") || safe("log.payload", "").contains("__proto__") || safe("log.payload", "").contains("constructor") || safe("log.payload", "").contains("prototype") || safe("log.data", "").contains("<script") || safe("log.data", "").contains("javascript:") || safe("log.data", "").contains("eval(") || safe("log.json_data", "").contains("'',''") || safe("log.json_data", "").contains(''","'') || safe("log.message", "").contains("malformed JSON") || safe("log.message", "").contains("unexpected character")) && safe("origin.ip", "") != ""', '2025-09-03 16:29:05.170671', true, false, 'origin', NULL, '[]');
INSERT INTO public.utm_correlation_rules VALUES (871, 'JSON-LD Context Loading Attack', 3, 3, 2, 'Initial Access', 'T1190 - Exploit Public-Facing Application', 'Detects attempts to load malicious JSON-LD contexts from untrusted HTTP sources or DNS poisoning attempts targeting context URLs. Attackers may try to alter the meaning of data fields through malicious context documents by serving malicious @context definitions over insecure HTTP connections or through compromised context URLs.

Next Steps:
1. Investigate the source IP for other suspicious activities
2. Check if the context URL is legitimate and verify its SSL certificate
3. Examine application logs for any data parsing anomalies
4. Review network traffic for DNS poisoning attempts
5. Validate all JSON-LD context sources are using HTTPS
6. Check for unauthorized modifications to application configuration
7. Monitor for follow-up exploitation attempts or data exfiltration
', '["https://github.com/json-ld/json-ld.org/issues/213","https://attack.mitre.org/techniques/T1190/"]', 'safe("log.method", "") == "GET" && safe("log.path", "").contains("@context") && (safe("log.url", "").startsWith("http://") || safe("log.context_url", "").startsWith("http://") || (safe("log.user_agent", "").contains("json-ld") && safe("log.referrer", "").startsWith("http://")))', '2025-09-03 16:29:05.631918', true, false, 'origin', NULL, '[]');
INSERT INTO public.utm_correlation_rules VALUES (872, 'JSON Patch Operation Exploit', 3, 3, 3, 'Impact', 'JSON Patch Abuse', 'Detects malicious JSON Patch operations attempting to manipulate data through improper move, remove, or replace operations that could result in data loss, exposure, or unauthorized modifications.

Next Steps:
1. Review the specific JSON Patch operations in the request body
2. Analyze the target paths being modified or removed
3. Check if the operations are targeting sensitive data structures
4. Verify if the user has proper authorization for these operations
5. Monitor for subsequent data integrity issues or unauthorized access
6. Consider implementing additional validation for JSON Patch operations
', '["https://jsonpatch.com/","https://bishopfox.com/blog/json-interoperability-vulnerabilities","https://attack.mitre.org/techniques/T1565/"]', '(safe("log.content_type", "").contains("application/json-patch") || safe("log.content_type", "").contains("application/json-patch+json")) && (safe("log.method", "") == "PATCH" || safe("log.method", "") == "POST") && (safe("log.body", "").contains(''"op":"remove"'') || safe("log.body", "").contains(''"op":"move"'') || safe("log.body", "").contains(''"op":"replace"'')) && (safe("log.body", "").contains(''"path":"/"'') || safe("log.body", "").contains(''"path":"/0"'') || safe("log.body", "").contains(''"path":"/*"'') || safe("log.patch_operations_count", 0) > 10)', '2025-09-03 16:29:06.112624', true, false, 'origin', NULL, '[]');
INSERT INTO public.utm_correlation_rules VALUES (873, 'JSON Pointer Path Traversal Abuse', 3, 2, 1, 'Discovery', 'T1083 - File and Directory Discovery', 'Detects attempts to abuse JSON Pointer syntax for unauthorized access to data structures, including path traversal attempts and escape sequence manipulation to access restricted keys. JSON Pointer manipulation can be used to bypass access controls and extract sensitive data from JSON documents.

Next Steps:
1. Review the specific JSON pointer path and target data being accessed
2. Examine the application''s JSON pointer validation and sanitization mechanisms
3. Check for successful data extraction attempts from the same source
4. Verify if the accessed paths contain sensitive information
5. Review application logs for related unauthorized access attempts
6. Consider implementing stricter JSON pointer validation and access controls
', '["https://datatracker.ietf.org/doc/html/rfc6901","https://bishopfox.com/blog/json-interoperability-vulnerabilities","https://attack.mitre.org/techniques/T1083/"]', '(safe("log.json_pointer", "") != "" || safe("log.path", "").contains("/")) && (safe("log.json_pointer", "").contains("~0") || safe("log.json_pointer", "").contains("~1") || safe("log.path", "").contains("/../") || safe("log.path", "").contains("/..%2F") || safe("log.path", "").contains("/..%252F") || safe("log.body", "").matches(".*\"path\"\\s*:\\s*\"[^\"]*(\\.\\.|~0~1|~1~0).*\".*") || safe("log.query_params", "").contains("pointer=/../"))', '2025-09-03 16:29:35.725865', true, false, 'origin', NULL, '[]');
INSERT INTO public.utm_correlation_rules VALUES (874, 'JSONP Vulnerability Exploitation Detected', 3, 3, 1, 'Execution', 'JSONP Exploitation', 'Detects attempts to exploit JSONP endpoints through callback manipulation, XSS injection via callbacks, or unauthorized cross-domain data access. This rule identifies malicious callback parameters containing script tags, JavaScript execution functions, or non-standard callback names that could indicate exploitation attempts.

Next Steps:
1. Review the origin IP and URL path to identify the source of the attack
2. Examine the callback parameter value for malicious content
3. Check application logs for successful data extraction or code execution
4. Verify JSONP endpoint security controls and callback validation
5. Consider blocking the source IP if confirmed malicious
6. Review and strengthen JSONP implementation security measures
', '["https://owasp.org/www-community/attacks/Server_Side_Request_Forgery","https://attack.mitre.org/techniques/T1059/007/"]', '(safe("log.callback", "") != "" && 
 (safe("log.callback", "").contains("<") ||
  safe("log.callback", "").contains(">") ||
  safe("log.callback", "").contains("javascript:") ||
  safe("log.callback", "").contains("alert(") ||
  safe("log.callback", "").contains("eval(") ||
  safe("log.callback", "").contains("Function(") ||
  safe("log.callback", "").contains(".constructor(") ||
  !matches(safe("log.callback", ""), "^[a-zA-Z_$][a-zA-Z0-9_$]*$"))) ||
(safe("log.url_query", "") != "" && 
 safe("log.url_query", "").contains("callback=") &&
 safe("log.url_query", "").contains("<script"))
', '2025-09-03 16:29:36.201483', true, false, 'origin', NULL, '[]');
INSERT INTO public.utm_correlation_rules VALUES (875, 'JSON Schema Validation Bypass Attempt', 3, 3, 2, 'Defense Evasion', 'Schema Validation Evasion', 'Detects attempts to bypass JSON Schema validation through duplicate keys, type confusion, or malformed JSON structures designed to exploit parser discrepancies between validation and processing stages.

Next Steps:
1. Review the specific validation errors and malformed JSON content
2. Check if the request originated from legitimate applications or automated tools
3. Examine the target endpoint for proper input validation implementation
4. Verify if the application properly handles duplicate keys and prototype pollution attempts
5. Consider implementing additional input sanitization and validation layers
6. Monitor for follow-up exploitation attempts from the same source
', '["https://json-schema.org/understanding-json-schema/","https://www.invicti.com/learn/json-injection/","https://attack.mitre.org/techniques/T1027/"]', 'safe("log.validation_error", "") != "" || safe("log.schema_validation", "failed") == "failed" || (safe("log.content_type", "").contains("application/json") && (safe("log.body", "").matches(".*\"[^\"]+\"\\s*:\\s*[^,}]+\\s*,\\s*\"\\1\"\\s*:.*") || safe("log.duplicate_keys_detected", false) == true || safe("log.json_parse_error", "") != "" || safe("log.body", "").contains("__proto__") || safe("log.body", "").contains("constructor") || safe("log.body", "").contains("prototype") || safe("log.body_size", 0) > 1048576))', '2025-09-03 16:29:36.597532', true, false, 'origin', NULL, '[]');
INSERT INTO public.utm_correlation_rules VALUES (876, 'JWT Token Security Issue Detected', 3, 3, 2, 'Defense Evasion, Lateral Movement', 'T1550.001 - Use Alternate Authentication Material: Application Access Token', 'Detects JWT token security issues including algorithm confusion, none algorithm usage, expired tokens, invalid signatures, or token manipulation attempts. These vulnerabilities can lead to authentication bypass and unauthorized access to protected resources.

Next Steps:
1. Investigate the source IP and user agent for signs of malicious activity
2. Review JWT configuration to ensure proper algorithm validation
3. Check if "none" algorithm is explicitly disabled in JWT libraries
4. Validate token expiration and signature verification is properly implemented
5. Monitor for additional JWT manipulation attempts from the same source
6. Consider implementing JWT token blacklisting for compromised tokens
', '["https://research.securitum.com/jwt-json-web-token-security/","https://cheatsheetseries.owasp.org/cheatsheets/JSON_Web_Token_for_Java_Cheat_Sheet.html","https://attack.mitre.org/techniques/T1550/001/"]', '(safe("log.alg", "") == "none" || safe("log.alg", "") == "None" || safe("log.alg", "") == "NONE" || (safe("log.jwt_error", "") != "" && (safe("log.jwt_error", "").contains("signature") || safe("log.jwt_error", "").contains("expired") || safe("log.jwt_error", "").contains("invalid"))) || (safe("log.exp", 0) > 0 && safe("log.exp", 0) < timestamp_seconds(now())) || (safe("log.iat", 0) > 0 && safe("log.iat", 0) > timestamp_seconds(now())) || (safe("raw", "").contains("eyJhbGciOiJub25lIi") || safe("raw", "").contains("eyJhbGciOiJOb25lIi") || safe("raw", "").contains("eyJhbGciOiJOT05FIi")) || (safe("log.jti", "") != "" && safe("log.token_reuse", false) == true))', '2025-09-03 16:29:37.050395', true, false, 'origin', NULL, '[]');
INSERT INTO public.utm_correlation_rules VALUES (884, 'JSON Schema Validation Failure Detected', 1, 3, 2, 'Execution', 'T1059 - Command and Scripting Interpreter', 'Detects JSON schema validation failures which may indicate attempts to bypass input validation or exploit parser vulnerabilities. Multiple failures from the same source could indicate reconnaissance or attack attempts.

Next Steps:
1. Review the failed JSON payload and validation error details
2. Check if this is part of a pattern of validation bypass attempts
3. Examine the source IP for other suspicious activities
4. Verify application input validation controls are properly configured
5. Consider blocking the source if multiple validation failures are detected
6. Review application logs for potential injection attempts
', '["https://www.invicti.com/learn/json-injection/","https://attack.mitre.org/techniques/T1059/"]', '(safe("log.error_type", "") == "schema_validation_failed" || safe("log.error_type", "") == "invalid_schema" || safe("log.error_type", "") == "validation_error" || safe("log.message", "").contains("schema validation") || safe("log.message", "").contains("invalid JSON schema") || safe("log.message", "").contains("failed to validate")) && safe("origin.ip", "") != ""', '2025-09-03 16:30:02.621304', true, false, 'origin', '["origin.ip"]', '[]');
INSERT INTO public.utm_correlation_rules VALUES (877, 'JSON Key Collision Attack Detection', 3, 3, 2, 'Execution', 'Duplicate Key Manipulation', 'Detects attempts to exploit JSON parser inconsistencies through duplicate keys, which can lead to security bypasses, data corruption, or unexpected application behavior. Key collision attacks exploit differences in how various JSON parsers handle duplicate keys - some use the first occurrence while others use the last, potentially allowing attackers to bypass security validations.

Next Steps:
1. Examine the source JSON payload and identify which keys are duplicated
2. Review the application''s JSON parsing logic to understand which value is being used
3. Check for any security validations that might be bypassed due to parser inconsistencies
4. Analyze the impact on business logic and data integrity
5. Consider implementing strict JSON validation to reject payloads with duplicate keys
6. Review other requests from the same source for similar attack patterns
', '["https://bishopfox.com/blog/json-interoperability-vulnerabilities","https://attack.mitre.org/techniques/T1059/"]', '(safe("log.duplicate_keys_found", false) == true) || (safe("log.duplicate_key_count", 0) > 0) || (safe("log.parser_warning", "").contains("duplicate key") || (safe("log.parser_warning", "").contains("key collision") || (safe("log.validation_error", "").contains("duplicate property") || (safe("log.json_anomaly", "").contains("multiple keys") || (safe("log.key_count", 0) > 0 && safe("log.unique_key_count", 0) > 0 && log.key_count != log.unique_key_count) || (safe("log.parser_behavior", "").contains("last-key-wins") || safe("log.parser_behavior", "").contains("first-key-wins")', '2025-09-03 16:29:37.552526', true, false, 'origin', NULL, '[]');
INSERT INTO public.utm_correlation_rules VALUES (880, 'Nested Object Attack Detected', 2, 3, 3, 'Defense Evasion, Privilege Escalation', 'Nested Object Manipulation', 'Detects attacks involving deeply nested JSON objects, excessive nesting levels, or attempts to exploit deserialization vulnerabilities through complex object structures. These attacks can lead to DoS, memory exhaustion, or code execution through manipulation of JSON parsing engines.

Next Steps:
1. Immediately block the source IP if confirmed malicious
2. Review application logs for parsing errors or performance degradation
3. Check memory usage and CPU utilization during the timeframe
4. Examine the JSON payload structure for malicious patterns
5. Update JSON parsing limits and validation rules
6. Implement rate limiting for JSON processing endpoints
7. Review deserialization security configurations
', '["https://github.blog/security/vulnerability-research/execute-commands-by-sending-json-learn-how-unsafe-deserialization-vulnerabilities-work-in-ruby-projects/","https://attack.mitre.org/techniques/T1055/001/"]', '(safe("log.nesting_depth", 0) > 50 || safe("log.object_count", 0) > 1000 || safe("log.array_depth", 0) > 20 || safe("log.error", "").contains("maximum nesting") || safe("log.error", "").contains("stack overflow") || safe("log.error", "").contains("recursion limit") || safe("log.error", "").contains("deserialization gadget") || safe("log.message", "").contains("excessive nesting") || safe("log.message", "").contains("circular reference") || safe("log.message", "").contains("polymorphic type") || (safe("log.processing_time_ms", 0) > 5000 && safe("log.object_count", 0) > 100)) && safe("origin.ip", "") != ""', '2025-09-03 16:29:38.952987', true, false, 'origin', NULL, '[]');
INSERT INTO public.utm_correlation_rules VALUES (881, 'JSON Parser Exploitation Attempt', 3, 3, 3, 'Defense Evasion, Privilege Escalation', 'Parser Exploitation', 'Detects attempts to exploit JSON parser vulnerabilities including duplicate keys, serialization discrepancies, number overflow attempts, and parser-specific quirks that could lead to security bypasses. These attacks can result in authentication bypasses, data corruption, or application compromise.

Next Steps:
1. Examine the specific JSON payload and parsing error details
2. Review application logs for signs of successful exploitation
3. Check for any unusual application behavior or unauthorized access
4. Validate JSON schema validation and input sanitization controls
5. Consider implementing additional JSON parsing security measures
6. Monitor for subsequent attacks from the same source IP
', '["https://bishopfox.com/blog/json-interoperability-vulnerabilities","https://attack.mitre.org/techniques/T1055/"]', '(safe("log.error", "").contains("duplicate key") || safe("log.error", "").contains("parser error") || safe("log.error", "").contains("deserialization failed") || safe("log.error", "").contains("unexpected token") || safe("log.error", "").contains("maximum depth exceeded") || safe("log.message", "").contains("duplicate JSON key") || safe("log.message", "").contains("parser inconsistency") || safe("log.message", "").contains("conflicting values") || safe("log.parse_errors", 0) > 5 || (safe("log.json_depth", 0) > 100 && safe("log.error", "") != "") || safe("log.numeric_overflow", false) == true) && safe("origin.ip", "") != ""', '2025-09-03 16:29:39.398593', true, false, 'origin', NULL, '[]');
INSERT INTO public.utm_correlation_rules VALUES (885, 'JSON Size Limit Violation Detection', 1, 2, 3, 'Impact', 'T1499 - Endpoint Denial of Service', 'Detects attempts to send oversized JSON payloads that could lead to denial of service, memory exhaustion, or buffer overflow conditions. This rule identifies JSON payloads exceeding size limits, error messages indicating payload size violations, HTTP 413 responses, or excessive array/object counts that may indicate an attempt to overwhelm the application.

Next Steps:
- Review the source IP and identify if this is legitimate traffic or an attack
- Check application logs for additional context about the oversized payload
- Verify JSON parsing configuration and size limits are properly set
- Monitor for additional size limit violations from the same source
- Consider implementing rate limiting or blocking the source if malicious
- Analyze the content of the oversized payload if available to understand attack patterns
', '["https://www.acunetix.com/blog/articles/json-web-token-jwt-attacks-vulnerabilities/","https://attack.mitre.org/techniques/T1499/"]', '(safe("log.content_length", 0) > 1048576) || (safe("log.json_size", 0) > 1048576) || (safe("log.payload_size", 0) > 1048576) || (safe("log.error", "").contains("payload too large")) || (safe("log.error", "").contains("size limit exceeded")) || (safe("log.parser_error", "").contains("maximum size")) || (safe("log.response_code", 0.0) == double(413)) || (safe("log.array_length", 0) > 10000) || (safe("log.object_count", 0) > 10000)', '2025-09-03 16:30:03.172003', true, false, 'origin', '["origin.ip","log.request_id"]', '[{"indexPattern":"v11-log-json-*","with":[{"field":"origin.ip.keyword","operator":"filter_term","value":"{{.origin.ip}}"}],"or":null,"within":"now-5m","count":3}]');
INSERT INTO public.utm_correlation_rules VALUES (886, 'JSON Type Confusion Attack Detection', 2, 3, 2, 'Defense Evasion, Privilege Escalation', 'Type Confusion', 'Detects attempts to exploit type confusion vulnerabilities in JSON parsing where attackers manipulate data types to bypass security controls or cause unexpected behavior. This attack can lead to privilege escalation, data corruption, or application crashes by sending unexpected data types to parsers that don''t properly validate input.

Next Steps:
1. Examine the specific JSON payload and field that triggered the type confusion
2. Review application logs for any errors or unexpected behavior following the attack
3. Check if the attack resulted in any privilege escalation or unauthorized access
4. Validate input sanitization and type checking mechanisms in the affected application
5. Consider implementing stricter JSON schema validation
6. Monitor for any subsequent malicious activity from the same source
', '["https://bishopfox.com/blog/json-interoperability-vulnerabilities","https://attack.mitre.org/techniques/T1055/"]', '(safe("log.algorithm", "") != "" && safe("log.expected_algorithm", "") != "" && log.algorithm != log.expected_algorithm) || (safe("log.data_type_mismatch", false) == true) || (safe("log.parser_error", "").contains("type mismatch")) || (safe("log.validation_error", "").contains("unexpected type")) || (safe("log.json_field_type", "") != "" && safe("log.expected_field_type", "") != "" && log.json_field_type != log.expected_field_type)', '2025-09-03 16:30:03.575152', true, false, 'origin', NULL, '[]');
INSERT INTO public.utm_correlation_rules VALUES (1279, 'Windows: Remote System Discovery Commands', 3, 1, 2, 'Discovery', 'Remote System Discovery', 'Discovery of remote system information using built-in commands, which may be used to move laterally.', '["https://attack.mitre.org/tactics/TA0007/","https://attack.mitre.org/techniques/T1018/"]', 'safe("log.message", "").matches("(-n|-s|-a)") && safe("log.winlogEventDataProcessName", "").matches("(nbtstat.exe|arp.exe)")', '2025-09-04 19:58:21.089075', true, false, 'origin', NULL, '[]');
INSERT INTO public.utm_correlation_rules VALUES (1384, 'Windows: High Number of Process and/or Service Terminations', 1, 2, 3, 'Impact', 'Service Stop', 'This rule identifies a high number (10) of process terminations (stop, delete, or suspend) from the same host within a short time period.', '["https://attack.mitre.org/tactics/TA0040/","https://attack.mitre.org/techniques/T1489/"]', 'safe("log.eventData.processName", "").matches("(net.exe|sc.exe|taskkill.exe)") && safe("log.message", "").matches("(stop|pause|delete|/PID|/IM|/T|/F|/t|/f|/im|/pid)")', '2025-09-04 20:45:17.952367', true, false, 'origin', NULL, '[]');
INSERT INTO public.utm_correlation_rules VALUES (1019, 'Unusual Traffic Volume Anomaly Detection', 2, 1, 3, 'Exfiltration', 'T1048 - Exfiltration Over Alternative Protocol', 'Detects unusual traffic volumes that could indicate data exfiltration, DDoS attacks, or other anomalous network behavior. This rule triggers when a single source IP generates traffic exceeding normal thresholds within a short time window.

Next Steps:
1. Investigate the source IP address and its geolocation
2. Review the destination IPs and ports involved in the high-volume traffic
3. Analyze the timing patterns of the traffic to identify if it''s automated
4. Check if the source IP is internal or external to your network
5. Review firewall logs and network monitoring tools for additional context
6. If confirmed malicious, implement IP blocking and investigate potential data compromise
7. Monitor for similar patterns from other IP addresses
', '["https://www.cisco.com/en/US/technologies/tk648/tk362/technologies_white_paper09186a00800a3db9.html","https://attack.mitre.org/techniques/T1048/"]', 'safe("origin.ip", "") != "" && safe("origin.bytesSent", 0.0) > double(10000000) && safe("origin.packagesSent", 0.0) > double(10000)', '2025-09-04 15:18:51.256799', true, false, 'origin', '["origin.ip","target.ip"]', '[{"indexPattern":"v11-log-netflow-*","with":[{"field":"origin.ip.keyword","operator":"filter_term","value":"{{.origin.ip}}"}],"or":null,"within":"now-15m","count":3}]');
INSERT INTO public.utm_correlation_rules VALUES (1020, 'Traffic Redirection and Hijacking Detection', 3, 3, 2, 'Credential Access, Collection', 'Man-in-the-Middle', 'Detects potential traffic redirection, BGP hijacking, or man-in-the-middle attacks by identifying unusual routing patterns, unexpected next-hop changes, or traffic flowing through suspicious intermediate nodes. This rule monitors for anomalous network behaviors including BGP route modifications, TTL variance indicating rerouting, asymmetric routing patterns, and traffic flowing through unexpected geographic locations.

Next Steps:
1. Investigate the source and destination IPs involved in the traffic redirection
2. Check BGP routing tables for unauthorized route advertisements or hijacking
3. Analyze network topology to identify if traffic is taking unexpected paths
4. Review firewall and router logs for configuration changes
5. Verify if the next-hop changes are authorized maintenance activities
6. Check for DNS poisoning or ARP spoofing attacks that could redirect traffic
7. Correlate with threat intelligence feeds for known malicious infrastructure
8. Monitor for data exfiltration attempts through redirected traffic
9. Contact network administrators to verify any recent routing changes
10. Consider implementing additional network monitoring for affected segments
', '["https://attack.mitre.org/techniques/T1557/","https://documentation.meraki.com/MX/Monitoring_and_Reporting/NetFlow_Overview"]', '( safe("log.next_hop_changed", "false") == "true" && safe("log.flow_count", 0.0) > double(100) ) || ( safe("log.bgp_next_hop", "") != safe("log.expected_next_hop", "") && safe("log.bytes", 0.0) > double(10485760) ) || ( safe("log.ttl_variance", 0.0) > double(5) && safe("origin.ip", "") == safe("log.previous_origin_ip", "") ) || ( safe("target.port", 0.0) == 179 && safe("log.bgp_updates", 0.0) > double(50) ) || ( safe("log.route_changed", "false") == "true" && safe("log.sensitive_traffic", "false") == "true" ) || ( safe("origin.geolocation.country", "") != safe("log.expected_country", "") && safe("log.critical_infrastructure", "false") == "true" ) || ( safe("log.asymmetric_routing", "false") == "true" && safe("log.bytes", 0.0) > double(52428800) )', '2025-09-04 15:18:51.769729', true, false, 'origin', '["origin.ip","target.ip","log.next_hop"]', '[{"indexPattern":"v11-log-*","with":[{"field":"target.ip.keyword","operator":"filter_term","value":"{{.target.ip}}"}],"or":null,"within":"now-2h","count":20}]');
INSERT INTO public.utm_correlation_rules VALUES (1385, 'Windows: Detection of SUNBURST command and control activity', 3, 3, 2, 'Command and Control', 'Supply Chain Compromise', 'This rule detects post-exploitation command and control activity of the SUNBURST backdoor.', '["https://attack.mitre.org/tactics/TA0011/","https://attack.mitre.org/techniques/T1195/"]', 'safe("log.eventDataProcessName", "").matches("(ConfigurationWizard.exe|NetFlowService.exe|NetflowDatabaseMaintenance.exe|SolarWinds.Administration.exe|SolarWinds.BusinessLayerHost.exe|SolarWinds.BusinessLayerHostx64.exe|SolarWinds.Collector.Service.exe|SolarwindsDiagnostics.exe)") && safe("log.message", "").matches("(/swip/Upload.ashx(.+)(POST|PUT)|(POST|PUT)(.+)/swip/Upload.ashx|/swip/SystemDescription(.+)(GET|HEAD)|(GET|HEAD)(.+)/swip/SystemDescription)")', '2025-09-04 20:45:18.629258', true, false, 'target', NULL, '[]');
INSERT INTO public.utm_correlation_rules VALUES (934, 'SystemD Unit File Attack Detected', 2, 3, 2, 'Persistence, Privilege Escalation', 'T1543.002 - Create or Modify System Process: Systemd Service', 'Detects malicious SystemD unit file creation or modification attempts, including privilege escalation through invalid usernames, suspicious service directives, or attempts to create persistent backdoors through systemd generators or malicious service configurations.

Next Steps:
1. Investigate the user account attempting to modify systemd unit files
2. Examine the specific unit file content for malicious directives
3. Check for any new services that were created or started
4. Review system logs for privilege escalation attempts
5. Verify the legitimacy of any new systemd generators
6. Check file permissions and ownership of modified unit files
7. Look for persistence mechanisms in systemd configuration
8. Consider isolating the affected system if malicious activity is confirmed
', '["https://attack.mitre.org/techniques/T1543/002/","https://www.linuxjournal.com/content/systemd-service-strengthening"]', '(safe("log.process", "") == "systemd" || safe("log.process", "") == "systemctl") && 
         (
           (safe("log.message", "").contains("Failed to parse user") && safe("log.message", "").matches("[0-9].*")) ||
           (safe("log.message", "").contains("unit file") && 
            (safe("log.message", "").contains("ExecStart") || safe("log.message", "").contains("ExecStartPre") || safe("log.message", "").contains("ExecStartPost")) && 
            (safe("log.message", "").contains("/tmp/") || safe("log.message", "").contains("/dev/shm/") || safe("log.message", "").contains("bash -c") || safe("log.message", "").contains("sh -c"))) ||
           (safe("log.message", "").contains("User=") && safe("log.message", "").matches("User=[0-9].*")) ||
           (safe("log.message", "").contains("systemd-generator") && (safe("log.message", "").contains("created") || safe("log.message", "").contains("modified"))) ||
           safe("log.message", "").contains("NoNewPrivileges=false") ||
           safe("log.message", "").contains("ProtectSystem=false")
         )', '2025-09-05 20:40:24.496233', true, false, 'origin', NULL, '[]');
INSERT INTO public.utm_correlation_rules VALUES (943, 'System Linux: File Transfer or Listener Established via Netcat', 1, 2, 3, 'Execution', 'Unix Shell', 'A netcat process is engaging in network activity on a Linux host. Netcat is often used as a persistence mechanism by exporting a reverse shell or by serving a shell on a listening port. Netcat is also sometimes used for data exfiltration.', '["https://attack.mitre.org/tactics/TA0002/","https://attack.mitre.org/techniques/T1059/004/"]', 'safe("log.message", "").matches("((nc|ncat|netcat|netcat.openbsd|netcat.traditional) (-l|-p|-lp|(-e)(.+)(\\/bin\\/bash|\\/bin\\/sh)|(\\/bin\\/bash|\\/bin\\/sh)(.+)(-e)))")', '2025-09-03 16:36:56.603343', true, false, 'target', NULL, '[]');
INSERT INTO public.utm_correlation_rules VALUES (942, 'System Linux: File Deletion via Shred', 1, 2, 3, 'Defense Evasion', 'File Deletion', 'Malware or other files dropped or created on a system by an adversary may leave traces behind as to what was done within a network and how. Adversaries may remove these files over the course of an intrusion to keep their footprint low or remove them at the end as part of the post-intrusion cleanup process.', '["https://attack.mitre.org/tactics/TA0005/","https://attack.mitre.org/techniques/T1070/004/"]', 'safe("log.message", "").matches("(shred (-u|--remove|-z|--zero))")', '2025-09-03 16:36:56.177543', true, false, 'target', NULL, '[]');
INSERT INTO public.utm_correlation_rules VALUES (1305, 'Windows: An administrative account was deleted', 3, 3, 3, 'Impact', 'Account Access Removal', 'This alert is generated every time a user account is deleted. This event generates on domain controllers, member servers, and workstations', '["https://attack.mitre.org/tactics/TA0040/","https://attack.mitre.org/techniques/T1531/"]', '(safe("log.wineventlogEventDataTargetSid","").endsWith(''-544'') || safe("log.wineventlogEventDataTargetSid","").endsWith(''-512'') || safe("log.wineventlogEventDataTargetSid","").endsWith(''-518'') || safe("log.wineventlogEventDataTargetSid","").endsWith(''-519'') || safe("log.wineventlogEventDataTargetSid","").endsWith(''-520'') || safe("log.wineventlogEventDataTargetSid","").endsWith(''-500'') || safe("log.wineventlogEventDataTargetSid","").endsWith(''-548'') || safe("log.wineventlogEventDataTargetSid","").endsWith(''-549'')) && safe("log.wineventlogEventId","") in [''4733'', ''4729'', ''4726'', ''4743'']', '2025-09-04 20:22:06.412245', true, false, 'origin', NULL, '[]');
INSERT INTO public.utm_correlation_rules VALUES (1280, 'Windows: Remote Logon followed by Scheduled Task Creation', 3, 3, 2, 'Lateral Movement', 'Remote Services', 'Identifies a remote logon followed by a scheduled task creation on the target host. This could be indicative of adversary lateral movement.', '["https://attack.mitre.org/tactics/TA0008/","https://attack.mitre.org/techniques/T1021/"]', 'safe("log.action", "") == ''logged-in'' && safe("actionResult", "") == ''success'' && !safe("log.wineventlogUserName", "").contains("ANONYMOUS LOGON") && !safe("log.wineventlogUserDomain", "").contains("NT AUTHORITY")', '2025-09-04 19:58:21.616399', true, false, 'origin', NULL, '[{"indexPattern":"v11-log-wineventlog-*","with":[{"field":"log.winlogHostId.keyword","operator":"filter_term","value":"{{.log.winlogHostId}}"},{"field":"log.winlogEventDataSubjectLogonId.keyword","operator":"filter_term","value":"scheduled-task-created"}],"or":null,"within":"now-60s","count":3}]');
INSERT INTO public.utm_correlation_rules VALUES (920, 'NetworkManager Exploit Detection', 3, 3, 2, 'Privilege Escalation', 'T1068 - Exploitation for Privilege Escalation', 'Detects potential exploitation attempts against NetworkManager service including privilege escalation attempts, unauthorized configuration changes, and suspicious network profile modifications.

Next Steps:
1. Review NetworkManager service logs and system audit logs for the affected host
2. Check for unauthorized network configuration changes and new network profiles
3. Verify the legitimacy of the user account and source IP attempting these operations
4. Examine running processes and network connections for signs of compromise
5. Review system patches and update status for NetworkManager vulnerabilities
6. Check for other suspicious activities from the same source IP or user account
7. Consider isolating the affected system if privilege escalation is confirmed
', '["https://access.redhat.com/security/vulnerabilities/networkmanager","https://attack.mitre.org/techniques/T1068/"]', 'safe("log.process_name", "") == "NetworkManager" || safe("log.service", "") == "NetworkManager" && ( safe("log.message", "").contains("privilege escalation") || safe("log.message", "").contains("unauthorized access") || safe("log.message", "").contains("segmentation fault") || safe("log.message", "").contains("buffer overflow") || safe("log.message", "").contains("failed to authenticate") || (safe("log.event_type", "") == "config_change" && safe("origin.user", "") != "root") || safe("log.error_code", "") in ["EPERM", "EACCES"] )', '2025-09-03 16:35:33.794734', true, false, 'origin', NULL, '[{"indexPattern":"v11-log-linux-*","with":[{"field":"origin.ip.keyword","operator":"filter_term","value":"{{.origin.ip}}"}],"or":null,"within":"now-15m","count":3}]');
INSERT INTO public.utm_correlation_rules VALUES (1404, 'Windows: PowerShell PSReflect Script', 2, 3, 1, 'Execution', 'Command and Scripting Interpreter', 'Detects the use of PSReflect in PowerShell scripts. Attackers leverage PSReflect as a library that enables PowerShell to access win32 API functions.', '["https://attack.mitre.org/tactics/TA0002/","https://attack.mitre.org/techniques/T1059/"]', 'safe("log.message", "").matches("(New-InMemoryModule|Add-Win32Type|psenum|DefineDynamicAssembly|DefineDynamicModule|Reflection.TypeAttributes|Reflection.Emit.OpCodes|Reflection.Emit.CustomAttributeBuilder|Runtime.InteropServices.DllImportAttribute)")', '2025-09-04 20:52:52.197938', true, false, 'origin', NULL, '[]');
INSERT INTO public.utm_correlation_rules VALUES (927, 'RHEL Satellite Client Anomalies Detected', 3, 3, 2, 'Command and Control', 'T1071 - Application Layer Protocol', 'Detects anomalous behavior in RHEL Satellite client communications, including unexpected connection patterns, authentication failures, and suspicious command executions that may indicate compromised satellite clients or unauthorized management attempts. This activity could suggest system compromise, man-in-the-middle attacks, or unauthorized access to satellite infrastructure.

**Next Steps:**
1. Immediately investigate the source IP and verify if it''s a legitimate satellite client
2. Check satellite server logs for corresponding authentication failures or connection anomalies
3. Verify the integrity of SSL/TLS certificates used for satellite communications
4. Review recent changes to satellite client configurations and access policies
5. Examine the affected host for signs of compromise or unauthorized modifications
6. Check for any recent software updates, patches, or configuration changes that might cause legitimate failures
7. If confirmed malicious, isolate the affected client and revoke its certificates
8. Review other satellite clients for similar anomalous patterns
9. Validate the satellite server''s security posture and access controls
', '["https://docs.redhat.com/en/documentation/red_hat_satellite/6.16/html/administering_red_hat_satellite/logging_and_reporting_problems_admin","https://attack.mitre.org/techniques/T1071/"]', 'safe("log.process", "") == "satellite-client" && (safe("log.message", "").contains("authentication failed") || safe("log.message", "").contains("unexpected disconnect") || safe("log.message", "").contains("command execution failed") || safe("log.message", "").contains("certificate validation failed") || safe("log.message", "").contains("unauthorized request"))', '2025-09-03 16:36:03.984185', true, false, 'origin', NULL, '[{"indexPattern":"v11-log-linux-*","with":[{"field":"origin.ip.keyword","operator":"filter_term","value":"{{.origin.ip}}"}],"or":null,"within":"now-15m","count":10}]');
INSERT INTO public.utm_correlation_rules VALUES (1281, 'Windows: Privilege Escalation via Windir Environment Variable', 2, 3, 2, 'Privilege Escalation', 'Path Interception by PATH Environment Variable', 'Identifies a privilege escalation attempt via a rogue Windows directory (Windir) environment variable. This is a known primitive that is often combined with other vulnerabilities to elevate privileges.', '["https://attack.mitre.org/tactics/TA0004/","https://attack.mitre.org/techniques/T1574/007/"]', 'safe("log.message", "").matches("(C:\\windows|%SystemRoot%)") && safe("log.message", "").matches("(HKEY_USERS\\(.+)\\Environment\\windir|HKEY_USERS\\(.+)\\Environment\\systemroot)")', '2025-09-04 19:58:22.197477', true, false, 'origin', NULL, '[]');
INSERT INTO public.utm_correlation_rules VALUES (1405, 'Windows: PowerShell Kerberos Ticket Request', 3, 2, 1, 'Credential Access', 'Command and Scripting Interpreter', 'Detects PowerShell scripts that have the capability of requesting kerberos tickets, which is a common step in Kerberoasting toolkits to crack service accounts.', '["https://attack.mitre.org/tactics/TA0006/","https://attack.mitre.org/techniques/T1059/"]', 'safe("log.message", "").matches("(KerberosRequestorSecurityToken)")', '2025-09-04 20:52:52.456117', true, false, 'origin', NULL, '[]');
INSERT INTO public.utm_correlation_rules VALUES (964, 'Apple Script Abuse Detection', 3, 3, 2, 'Execution', 'T1059.002 - Command and Scripting Interpreter: AppleScript', 'Detects suspicious AppleScript execution that could indicate malicious activity, including osascript command-line usage, automation attempts, and script-based attacks on macOS systems. AppleScript can be abused by attackers to execute commands, interact with applications, and perform system manipulation.

Next Steps:
1. Review the specific AppleScript commands being executed
2. Check if the script execution is part of legitimate automation or suspicious activity
3. Examine the process tree to understand the execution context
4. Verify if the user executing the script has legitimate reasons to do so
5. Look for additional indicators of compromise on the affected system
6. Consider blocking or monitoring the source if malicious intent is confirmed
', '["https://attack.mitre.org/techniques/T1059/002/","https://developer.apple.com/documentation/os/logging","https://www.crowdstrike.com/en-us/blog/how-to-leverage-apple-unified-log-for-incident-response/"]', '(safe("log.process", "") in ["osascript", "Script Editor", "AppleScript", "Automator"] || safe("log.eventMessage", "").contains("osascript") || safe("log.eventMessage", "").contains("AppleScript") || safe("log.subsystem", "") ==."com.app(e.applescript") && (safe("log.eventMessage", "").contains("tell application") || safe("log.eventMessage", "").contains("do shell script") || safe("log.eventMessage", "").contains("keystroke") || safe("log.eventMessage", "").contains("System Events") || safe("log.eventMessage", "").contains("admin privileges") || safe("log.eventMessage", "").contains("sudo") || safe("log.eventMessage", "").contains("password") && safe("log.eventType", "") in ["logEvent", "traceEvent"]', '2025-09-04 14:03:10.29706', true, false, 'origin', NULL, '[]');
INSERT INTO public.utm_correlation_rules VALUES (965, 'GCP probable Defense Evasion, Firewall Rule Modification', 1, 2, 2, 'Defense Evasion', 'Impair Defenses', 'Defense Evasion consists of techniques that adversaries use to avoid detection throughout their compromise.  Techniques used for defense evasion include uninstalling/disabling security software or  obfuscating/encrypting data and scripts. Adversaries also leverage and abuse trusted processes  to hide and masquerade their malware. Other tactics are cross-listed here when those techniques  include the added benefit of subverting defenses. <br>  Identifies when a firewall rule is modified in Google Cloud Platform (GCP). Virtual Private Cloud (VPC) firewall rules can be configured to allow or deny connections to or from virtual machine (VM) instances. An adversary may modify a firewall rule in order to weaken their target''s security controls.', NULL, 'safe("log.protoPayload.methodName ", "").matches("((.+)?v(\\w+)(\\.compute\\.firewalls\\.patch)|(.+)?(compute\\.v(\\w+)\\.firewalls\\.patch)|(.+)?beta(\\w+)?(\\.compute\\.firewalls\\.patch)|(.+)?(compute\\.beta(\\w+)?\\.firewalls\\.patch))")', '2025-09-04 14:17:21.942343', true, false, 'origin', NULL, '[]');
INSERT INTO public.utm_correlation_rules VALUES (1282, 'Windows: Unusual Child Processes of RunDLL32', 2, 3, 2, 'Defense Evasion', 'Rundll32', 'Identifies child processes of unusual instances of RunDLL32 where the command line parameters were suspicious. Misuse of RunDLL32 could indicate malicious activity', '["https://attack.mitre.org/tactics/TA0005/","https://attack.mitre.org/techniques/T1218/011/"]', 'safe("log.winlogEventDataProcessName", "").contains("rundll32.exe")', '2025-09-04 19:58:22.757459', true, false, 'origin', NULL, '[{"indexPattern":"v11-log-wineventlog-*","with":[{"field":"log.winlogEventDataProcessName.keyword","operator":"filter_match","value":"rundll32.exe"},{"field":"log.winlogEventDataProcessID.keyword","operator":"filter_term","value":"{{.log.wineventlogEventDataProcessID}}"}],"or":null,"within":"now-60s","count":1}]');
INSERT INTO public.utm_correlation_rules VALUES (1283, 'Windows: Execution of Persistent Suspicious Program', 2, 3, 2, 'Persistence', 'Boot or Logon Autostart Execution', 'Identifies execution of suspicious persistent programs (scripts, rundll32, etc.) by looking at process lineage and command line usage', '["https://attack.mitre.org/tactics/TA0003/","https://attack.mitre.org/techniques/T1547/"]', 'safe("log.winlogEventDataProcessName", "").contains("explorer.exe")', '2025-09-04 19:58:23.32791', true, false, 'origin', NULL, '[{"indexPattern":"v11-log-wineventlog-*","with":[{"field":"log.winlogEventDataProcessName.keyword","operator":"filter_term","value":"explorer.exe"},{"field":"log.winlogEventDataProcessName.keyword","operator":"filter_match","value":"(cscript.exe|wscript.exe|PowerShell.EXE|MSHTA.EXE|RUNDLL32.EXE|REGSVR32.EXE|RegAsm.exe|MSBuild.exe|InstallUtil.exe)"},{"field":"log.message.keyword","operator":"filter_not_match","value":"(ctfmon.exe|:\\Program Files\\(.+).exe|:\\Program Files \\(x86\\)\\(.+).exe|:\\Windows\\system32\\cmd.exe|:\\Users\\(.+)\\AppData\\Local\\Microsoft\\OneDrive\\)"},{"field":"log.message.keyword","operator":"filter_match","value":"(C:\\Users\\|C:\\ProgramData\\|C:\\Windows\\Temp\\|C:\\Windows\\Tasks\\|C:\\PerfLogs\\|C:\\Intel\\)"},{"field":"log.winlogEventDataSubjectUserName.keyword","operator":"==","value":"{{.log.winlogEventDataSubjectUserName}}"}],"or":null,"within":"now-60s","count":1}]');
INSERT INTO public.utm_correlation_rules VALUES (1284, 'Windows: Potential Privileged Escalation via SamAccountName Spoofing', 2, 3, 1, 'Privilege Escalation', 'Valid Accounts', 'Identifies a suspicious computer account name rename event, which may indicate an attempt to exploit CVE-2021-42278 to elevate privileges from a standard domain user to a user with domain admin privileges. CVE-2021-42278 is a security vulnerability that allows potential attackers to impersonate a domain controller via samAccountName attribute spoofing.', '["https://attack.mitre.org/tactics/TA0004/","https://attack.mitre.org/techniques/T1078/"]', 'safe("action", "") == "renamed-user-account" && safe("target.user", "").startsWith("$") && safe("log.winlogEventDataNewTargetUserName", "").startsWith("$")', '2025-09-04 19:58:23.896064', true, false, 'origin', NULL, '[]');
INSERT INTO public.utm_correlation_rules VALUES (1285, 'Windows: Possible ransomware attack detected. Unusual File Extensions.', 3, 3, 3, 'Ransomware', 'Impact: Data Encrypted for Impact', 'Ransomware, is a type of malware that prevents users from accessing their system or  personal files and requires payment of a ransom in order to gain access to them again. Identifies  ransomware attempts. Files with unusual file extensions have been detected, potentially indicating encrypted files created by ransomware.', '["https://attack.mitre.org/tactics/TA0040/"]', 'safe("log.eventCode", 0.0) == double(4663) && safe("log.eventDataFileName", "").matches("\\.(7z\\.encrypted|aaa|abcd|abtc|acc|aes256|aes_ni|aes256ctr|aes256encrypted|aes_gcm|ajp|alcatraz_locked|alfa|amnesia[1-9]?|amsi|apocalypse666|armadillo|arrow|asasin|asi|atom128|auditor|aurora|autoit|avastvirusinfo|avenger|av666|azero|barak|barrax|bart|beef|beetle|bip|bit|bitcoin|bl2r|blackblock|blackmail|blast|blind|bmw|boot|braincrypt[3-8]?|broken|btcware|budak|bull|buydecryptor|cakl|calipso|calum|carote|cats|cbf|cccmn|ccrypt|cerber[3-9]?|chifrator|chimera|ciphered|crypted|clover|cobra|codnat3|combo|comrade|conficker|coot|cpt|crash|crimson|cry|crypt\\d{3,4}|crypt38|crypt72|crypt888|cryptinfinite|cryptolocker|cryptowall|cryptxxx|crypz|csfr|csone|ctb[1-4]|ctb-locker|ctrsa|cryptowin|cube|dcrpt|ddtf|dr2|dragon|dried|druid|ducky|ecrpt|eeta|etr|ee|f[0-9]{3,4}|flock|grt|grt[0-9]+|grtlock|gwz|h3ll|hades|hakunamatata|hallucinating|happy|harmful|harrow|havoc|headdesk|helpdecrypt|hermes|hidden|hideous|hijack|hilda|hitler|hjg|hmpl|hrosas|hsdf|hushed|hwrm|ihsdj|ikarus|ikasir|ikayed|ill|imbtc|img|encrypted|improved|indrik|injected|innocent|insane|interesante|jungle|kaos|karl|katana|kimcilware|kin|kiratos|kiss|kjh|locked|locky|lokf|losers|lukitus|m3g4c0rtx|m4n1fest0|m4s4g3|maas|madmax|mafi|magic|maktub|malware|manamecrypt|mandelbrot|manic|matrix|max|md5|medusa|mega|melme|merry|mesmerize|metropolitan|mikey|mikibackup|milarepa.lotos@aol.com|mirror|mmnn|mole|monro|mosk|muslat|n1n1n1|nabr|napoleon|narrow|nasoh|nataniel|neitrino|neras|nlah|nosu|novasof|nozelesn|nuclear|nwa|nymaim|obelisk|off|offwhite|ogdo|omega|omerta|onion|ooss|opencode|openme|opqz|osiris|otx|p3rf0rm4|pabluk|pack14|packagetrackr@india.com|packrat|pahd|panda|pandemic|pandora|pansy|paradise|paris|paym3|paymer|payms|pcap|pclock|peet|pelikan|penis|petya|pewcrypt|phoenix|photominr|phobos|phps|pirated|pluto|po1|point|poop|potato|pr0tect|preppy|princesa|princess|prosper|prosperity|prq|pshy|pumas|pumax|pure|purple|purpler|pwnd|pysa|q9q9|qbtex|qiuu|qkkd|qscx|qtyop|quimera|r2d2|r5a|rabit|radman|raid10|rainbow|rakhni|rambo|ramses|rat|rcrypted|react|reactor|realtek|reaper|redlion|redmat|redrum|rekt|remk|removal|remsec|remy|renaming|revenge|rezuc|rhino|ribd|rich|rip|rire|rizonesoft@protonmail.ch|rk|rmdir|robinhood|rocke|rogue|roldat|rolin|ronzware|rosenquist|rotten|roza|rpcminer|rsalive|rumba|run|rxx|uak|udjvu|unlock92|unlckr|upd|urcp|usam|usbc|v8|vag|vandt|varasto|vault|vauw|vb|ve|vendetta|venom|veracrypt|versiegelt|veton|vhd|vindows|violate|virus|vivin|vk_677|vma|vmx|volcano|vorasto|vorphal|vos|vscrypt|vxl|w4b|wakanda|wannacash|wannacry|wanted|war|wasted|wcry|weapologize|webmafia|weird|weui|whatthefuck|whistler|white|whitenoise|whiterabbit|whorus|why!decryptor|wicked|wildfire|windows10|windows7|windows8|windowsupdate|winlock|wipe|wisconsin|wizard|wlu|woolger|worm|wormfubuki|wow|wpencrypt|wq!decryptor|wrui|wtg|x1881|x3m|xampug|xdata|xencrypt|xfiles|xhelper|xlr|xman|xmd|xmd|xtbl|xtbl|xtr|xtt|xtz|xyz|yakuza|yatron|ybn|year|yellow|yheq|yty|yuke|yxo|yyto|z3|zatrov|zax|zbot|zbt|zbt|zeppelin|zerber|zet|zet|zfj|zfj|zimbra|zip|zix|zlz|zobm|zoh|zorro|zphs)$")', '2025-09-04 20:01:49.333289', true, false, 'origin', NULL, '[]');
INSERT INTO public.utm_correlation_rules VALUES (1286, 'Windows: Remote File Download via Desktopimgdownldr Utility', 2, 3, 1, 'Command and Control', 'Ingress Tool Transfer', 'Identifies the desktopimgdownldr utility being used to download a remote file. An adversary may use desktopimgdownldr to download arbitrary files as an alternative to certutil.', '["https://attack.mitre.org/tactics/TA0011/","https://attack.mitre.org/techniques/T1105/"]', 'safe("log.winlogEventDataProcessName", "").contains("desktopimgdownldr.exe")', '2025-09-04 20:01:50.038727', true, false, 'origin', NULL, '[]');
INSERT INTO public.utm_correlation_rules VALUES (968, 'Apple Script Abuse Detection', 3, 3, 2, 'Execution', 'T1059.002 - Command and Scripting Interpreter: AppleScript', 'Detects suspicious AppleScript execution that could indicate malicious activity, including osascript command-line usage, automation attempts, and script-based attacks on macOS systems. AppleScript can be abused by attackers to execute commands, interact with applications, and perform system manipulation.

Next Steps:
1. Review the specific AppleScript commands being executed
2. Check if the script execution is part of legitimate automation or suspicious activity
3. Examine the process tree to understand the execution context
4. Verify if the user executing the script has legitimate reasons to do so
5. Look for additional indicators of compromise on the affected system
6. Consider blocking or monitoring the source if malicious intent is confirmed
', '["https://attack.mitre.org/techniques/T1059/002/","https://developer.apple.com/documentation/os/logging","https://www.crowdstrike.com/en-us/blog/how-to-leverage-apple-unified-log-for-incident-response/"]', '(safe("log.process", "") in ["osascript", "Script Editor", "AppleScript", "Automator"] || safe("log.eventMessage", "").contains("osascript") || safe("log.eventMessage", "").contains("AppleScript") || safe("log.subsystem", "") ==."com.app(e.applescript") && (safe("log.eventMessage", "").contains("tell application") || safe("log.eventMessage", "").contains("do shell script") || safe("log.eventMessage", "").contains("keystroke") || safe("log.eventMessage", "").contains("System Events") || safe("log.eventMessage", "").contains("admin privileges") || safe("log.eventMessage", "").contains("sudo") || safe("log.eventMessage", "").contains("password") && safe("log.eventType", "") in ["logEvent", "traceEvent"]', '2025-09-04 15:11:19.737272', true, false, 'origin', NULL, '[]');
INSERT INTO public.utm_correlation_rules VALUES (969, 'Application Firewall Configuration Modified', 2, 3, 3, 'Defense Evasion', 'T1562.004 - Impair Defenses: Disable or Modify Tools', 'Detects modifications to the macOS Application Layer Firewall (ALF) configuration, which could indicate an attempt to disable security controls or allow malicious network connections. This rule monitors changes to firewall settings through the socketfilterfw utility or ALF subsystem events.

Next Steps:
- Verify if the firewall modification was authorized by checking with system administrators
- Review the specific changes made to the firewall configuration
- Check if the modification aligns with approved security policies
- Investigate the user account and process that initiated the change
- Review surrounding system activity for signs of compromise
- Validate that legitimate business requirements justify the firewall changes
- Consider rolling back unauthorized changes and implementing additional monitoring
', '["https://attack.mitre.org/techniques/T1562/004/","https://support.apple.com/guide/security/firewall-protection-secf6b7ccbd5/web"]', '(safe("log.process", "") == "socketfilterfw" || safe("log.subsystem", "") == "com.apple.alf") && (safe("log.message", "").contains("setglobalstate") || safe("log.message", "").contains("setloggingmode") || safe("log.message", "").contains("allowsigned") || safe("log.message", "").contains("firewall configuration changed") || safe("log.message", "").contains("ALF settings modified")', '2025-09-04 15:11:20.230972', true, false, 'origin', '["origin.host","log.process"]', '[]');
INSERT INTO public.utm_correlation_rules VALUES (970, 'Code Signing Violations', 2, 3, 1, 'Defense Evasion', 'T1553.001 - Subvert Trust Controls: Gatekeeper Bypass', 'Detects code signing violations indicating unsigned, modified, or improperly signed executables that may bypass Gatekeeper or other security controls. This could indicate malware execution, tampering with legitimate applications, or attempts to bypass macOS security mechanisms.

Next Steps:
1. Investigate the specific executable or application that triggered the violation
2. Check if the file is from a trusted source and properly signed
3. Verify the integrity of the application using codesign verification
4. Review recent downloads and installations on the affected system
5. Scan the system for malware using updated antivirus signatures
6. Consider reimaging the system if persistent violations occur from unknown sources
', '["https://developer.apple.com/documentation/security/code_signing_services","https://attack.mitre.org/techniques/T1553/001/"]', '(safe("log.subsystem", "") == "com.apple.securityd" && (safe("log.message", "").contains("code signature") && (safe("log.message", "").contains("invalid") || safe("log.message", "").contains("fail") || safe("log.message", "").contains("reject") || safe("log.message", "").contains("violation"))) || (safe("origin.process", "") == "codesign" && safe("log.messageType", "") == "error") || (safe("log.message", "").contains("Gatekeeper") && (safe("log.message", "").contains("blocked") || safe("log.message", "").contains("unsigned") || safe("log.message", "").contains("notarization") || safe("log.message", "").contains("quarantine")) || (safe("log.subsystem", "") == "com.apple.Security" && safe("log.category", "") == "SecAssessment" && (safe("log.message", "").contains("deny") || safe("log.message", "").contains("blocked")) || (safe("log.message", "").contains("spctl") && (safe("log.message", "").contains("rejected") || safe("log.message", "").contains("assessment") || safe("log.message", "").contains("disabled"))', '2025-09-04 15:11:20.805421', true, false, 'origin', NULL, '[]');
INSERT INTO public.utm_correlation_rules VALUES (971, 'Contacts and Calendar Access Violations', 3, 3, 1, 'Collection', 'T1005 - Data from Local System', 'Detects unauthorized or suspicious access attempts to contacts and calendar data, including repeated permission requests that may indicate data harvesting attempts.

Next Steps:
1. Investigate the application or process requesting access to contacts/calendar data
2. Verify if the access request is legitimate for the application''s functionality
3. Check the TCC (Transparency, Consent, and Control) database for unauthorized permissions
4. Review user behavior and determine if the user knowingly granted permissions
5. Examine system logs for additional privacy violations or suspicious activities
6. Consider revoking unauthorized permissions through System Preferences > Security & Privacy
7. If malicious activity is confirmed, isolate the affected system and perform malware analysis
8. Review other applications with similar privacy permissions for potential compromise
', '["https://www.rainforestqa.com/blog/macos-tcc-db-deep-dive","https://attack.mitre.org/techniques/T1005/"]', '(safe("log.subsystem", "") == "com.apple.TCC" && (safe("log.message", "").contains("AddressBook") || safe("log.message", "").contains("Calendar"))) || (safe("log.process", "") == "tccd" && (safe("log.message", "").contains("kTCCServiceAddressBook") || safe("log.message", "").contains("kTCCServiceCalendar"))) || (safe("log.message", "").contains("ContactsAgent") && safe("log.message", "").contains("denied")) || (safe("log.message", "").contains("CalendarAgent") && safe("log.message", "").contains("unauthorized")) || (safe("log.message", "").contains("privacy") && (safe("log.message", "").contains("contacts") || safe("log.message", "").contains("calendar"))))', '2025-09-04 15:11:21.358701', true, false, 'origin', NULL, '[]');
INSERT INTO public.utm_correlation_rules VALUES (988, 'Safari Extension Abuse', 3, 3, 1, 'Persistence', 'T1176 - Browser Extensions', 'Detects suspicious Safari extension installations or modifications that could be used for credential theft, session hijacking, or data exfiltration. This rule monitors Safari extension-related activities including installations, loading, enabling, and potential security violations.

Next Steps:
1. Identify the specific Safari extension involved in the alert
2. Review the extension''s permissions and capabilities
3. Check if the extension was installed from Apple''s official Safari Extensions Gallery
4. Examine the extension''s code signature and developer certificate
5. Review the user''s browsing history and recent downloads
6. Check for any unauthorized modifications to Safari''s extension directory
7. Verify if the extension has network communication capabilities
8. Review any recent changes to Safari''s security settings
9. Consider temporarily disabling the extension while investigating
10. Monitor for additional suspicious browser behavior or network traffic
', '["https://developer.apple.com/documentation/safariservices/safari_app_extensions","https://attack.mitre.org/techniques/T1176/"]', '(safe("log.subsystem", "") == "com.apple.Safari" && safe("log.category", "") == "Extensions" && (safe("log.message", "").contains("install") || safe("log.message", "").contains("load") || safe("log.message", "").contains("enable")) || (safe("log.process", "") == "Safari" && (safe("log.message", "").contains("extension") && (safe("log.message", "").contains("unsigned") || safe("log.message", "").contains("untrusted") || safe("log.message", "").contains("modified") || safe("log.message", "").contains("injected"))) || (safe("log.message", "").contains("Safari/Extensions") && (safe("log.message", "").contains("unauthorized") || safe("log.message", "").contains("suspicious") || safe("log.message", "").contains("malicious")) || (safe("log.subsystem", "") == "com.apple.WebKit" && safe("log.message", "").contains("extension") && safe("log.messageType", "") == "error")', '2025-09-04 15:12:47.301793', true, false, 'origin', NULL, '[{"indexPattern":"v11-log-macos-*","with":[{"field":"origin.user.keyword","operator":"filter_term","value":"{{.origin.user}}"}],"or":null,"within":"now-24h","count":2}]');
INSERT INTO public.utm_correlation_rules VALUES (976, 'Full Disk Access Abuse Detection', 3, 3, 2, 'Privilege Escalation, Defense Evasion', 'T1548.004 - Abuse Elevation Control Mechanism: Elevated Execution with Prompt', 'Detects suspicious Full Disk Access (FDA) usage, including unexpected processes gaining FDA permissions or potential TCC database manipulation attempts. This rule identifies when applications request or are granted Full Disk Access privileges, which could indicate privilege escalation attempts or malicious software trying to bypass macOS security controls.

Next Steps:
1. Investigate the process that requested or was granted Full Disk Access permissions
2. Verify if the application legitimately requires FDA access for its functionality
3. Check if the TCC database has been tampered with or modified unexpectedly
4. Review user activity around the time of the FDA request to identify potential social engineering
5. Examine system logs for any unauthorized changes to privacy settings
6. Validate the digital signature and source of the application requesting FDA access
', '["https://www.huntress.com/blog/full-transparency-controlling-apples-tcc","https://attack.mitre.org/techniques/T1548/004/"]', '(safe("log.subsystem", "") == "com.apple.TCC" && safe("log.message", "").contains("kTCCServiceSystemPolicyAllFiles")) || (safe("log.process", "") == "tccd" && safe("log.message", "").contains("SystemPolicyAllFiles")) || (safe("log.message", "").contains("Full Disk Access") && (safe("log.message", "").contains("granted") || safe("log.message", "").contains("allowed"))) || (safe("log.message", "").contains("TCC.db") && (safe("log.message", "").contains("modified") || safe("log.message", "").contains("accessed"))) || (safe("log.message", "").contains("com.apple.TCC") && safe("log.message", "").contains("write"))', '2025-09-04 15:11:23.949312', true, false, 'origin', NULL, '[]');
INSERT INTO public.utm_correlation_rules VALUES (972, 'Developer Tools Security Policy Bypass', 3, 3, 2, 'Defense Evasion', 'T1553.001 - Subvert Trust Controls: Gatekeeper Bypass', 'Detects abuse of developer tools permissions to run unsigned code or bypass security policies, including suspicious use of kTCCServiceDeveloperTool permissions. This rule identifies when macOS security controls like Gatekeeper are being bypassed or when unsigned code is being executed through developer tool privileges.

Next Steps:
1. Identify the user account and process that triggered the developer tools bypass
2. Verify if the user has legitimate developer tool access requirements
3. Check if any unsigned applications were recently executed on the system
4. Review System Preferences > Security & Privacy > Privacy tab for recent developer tool permissions
5. Examine the process tree to understand what application requested these permissions
6. If unauthorized, revoke developer tool permissions and investigate for potential malware
7. Review other security policy changes or bypasses on the same system
8. Check for any recently installed applications that might have requested these permissions
', '["https://www.sentinelone.com/labs/bypassing-macos-tcc-user-privacy-protections-by-accident-and-design/","https://attack.mitre.org/techniques/T1553/001/"]', '(safe("log.subsystem", "") == "com.apple.TCC" && safe("log.message", "").contains("kTCCServiceDeveloperTool")) || (safe("log.process", "") == "tccd" && safe("log.message", "").contains("DeveloperTool")) || (safe("log.message", "").contains("security policy") && safe("log.message", "").contains("bypass")) || (safe("log.message", "").contains("unsigned") && (safe("log.message", "").contains("allowed") || safe("log.message", "").contains("executed"))) || (safe("log.message", "").contains("Gatekeeper") && safe("log.message", "").contains("disabled")) || (safe("log.message", "").contains("spctl") && safe("log.message", "").contains("developer-id"))', '2025-09-04 15:11:21.862221', true, false, 'origin', NULL, '[]');
INSERT INTO public.utm_correlation_rules VALUES (973, 'Directory Service Modifications Detection', 2, 3, 2, 'Persistence', 'T1136.001 - Create Account: Local Account', 'Detects modifications to macOS Directory Services including user and group changes, authentication modifications, and potential privilege escalation through directory service manipulation. This rule monitors for suspicious activities involving directory service processes that could indicate account creation, modification, or privilege escalation attempts.

Next Steps:
1. Verify the legitimacy of the directory service modifications by checking with system administrators
2. Investigate the user account and process that initiated the directory service changes
3. Review system logs for any related authentication events or privilege escalation attempts
4. Check for any unauthorized user accounts or group memberships that may have been created
5. Examine the timing and frequency of directory service modifications for patterns of abuse
6. Correlate with other security events such as login attempts or file access patterns
7. If unauthorized, disable affected accounts immediately and reset passwords for compromised accounts
', '["https://attack.mitre.org/techniques/T1136/001/","https://developer.apple.com/documentation/os/logging","https://support.apple.com/guide/directory-utility/welcome/mac"]', '(safe("log.process", "") in ["DirectoryService", "opendirectoryd", "dscl", "dseditgroup", "dsimport"] || safe("log.subsystem", "") == "com.apple.opendirectoryd" || safe("log.subsystem", "") == "com.apple.DirectoryServices") && (safe("log.message", "").contains("create") || safe("log.message", "").contains("modify") || safe("log.message", "").contains("delete") || safe("log.message", "").contains("passwd") || safe("log.message", "").contains("group") || safe("log.message", "").contains("admin") || safe("log.message", "").contains("sudoers") || safe("log.message", "").contains("AuthenticationAuthority") || safe("log.message", "").contains("GeneratedUID") && safe("log.messageType", "") != "debug"', '2025-09-04 15:11:22.364982', true, false, 'origin', '["origin.host","origin.user"]', '[]');
INSERT INTO public.utm_correlation_rules VALUES (113, 'AWS EC2 VM Export Failure', 3, 2, 2, 'Impair Defenses', 'Defense Evasion', 'Identifies an attempt to export an AWS EC2 instance. A virtual machine (VM) export may indicate an attempt to extract or exfiltrate information', '["https://attack.mitre.org/techniques/T1537/","https://attack.mitre.org/tactics/TA0010/","https://attack.mitre.org/tactics/TA0009/","https://attack.mitre.org/techniques/T1005/","https://docs.aws.amazon.com/vm-import/latest/userguide/vmexport.html#export-instance"]', 'safe("log.eventSource", "") == ''ec2.amazonaws.com'' && safe("log.eventName", "") == ''CreateInstanceExportTask''', '2025-09-03 12:27:16.503621', true, false, 'target', NULL, '[]');
INSERT INTO public.utm_correlation_rules VALUES (1001, 'NetFlow Collector Overload Attack', 1, 2, 3, 'Impact', 'Network Denial of Service', 'Detects potential NetFlow collector overload attacks by identifying excessive flow records from a single source or unusually high packet rates that could overwhelm the collector infrastructure. This type of attack can cause denial of service by flooding the NetFlow collector with malicious or excessive flow data.

Next Steps:
1. Immediately investigate the source IP address and determine if it''s a legitimate network device
2. Check NetFlow collector performance metrics and resource utilization
3. Review network traffic patterns to identify if this is part of a larger DDoS attack
4. Consider implementing rate limiting or filtering rules for the source IP
5. Verify collector configuration and capacity planning
6. Monitor for similar patterns from other source IPs that might indicate a coordinated attack
', '["https://attack.mitre.org/techniques/T1498/","https://www.cisco.com/c/en/us/support/docs/security/secure-network-analytics-flow-collector-4300/222009-troubleshoot-netflow-ipfix-telemetry-ing.html"]', 'safe("origin.ip", "") != "" && (safe("log.PacketCount", 0.0) > double(10000) || safe("log.ByteCount", 0.0) > double(10000000))', '2025-09-04 15:17:49.396878', true, false, 'origin', '["origin.ip","target.ip"]', '[{"indexPattern":"v11-log-netflow-*","with":[{"field":"origin.ip.keyword","operator":"filter_term","value":"{{.origin.ip}}"}],"or":null,"within":"now-1m","count":100}]');
INSERT INTO public.utm_correlation_rules VALUES (1002, 'Abnormal Connection Pattern Detection', 3, 2, 2, 'Command and Control', 'Command and Control', 'Detects unusual connection patterns including rapid connections to multiple hosts, unusual port combinations, or connections to rare ports that could indicate reconnaissance, lateral movement, or command and control activity. This rule triggers when a source IP makes connections to high ports (>1024) with small packet counts, potentially indicating scanning or automated communication.

Next Steps:
1. Investigate the source IP''s recent connection history and geolocation
2. Analyze the target ports and destinations to identify potential attack patterns
3. Check for additional network anomalies from the same source
4. Review endpoint activity on the source system for signs of compromise
5. Correlate with threat intelligence feeds for known C2 infrastructure
6. Consider blocking the source IP if malicious activity is confirmed
', '["https://www.cisco.com/en/US/technologies/tk648/tk362/technologies_white_paper09186a00800a3db9.html","https://attack.mitre.org/tactics/TA0011/"]', 'safe("origin.ip", "") != "" && safe("target.port", 0.0) > double(1024) && safe("target.port", 0.0) != double(3389) && safe("target.port", 0.0) != double(8080) && safe("target.port", 0.0) != double(8443) && safe("protocol", "") != "" && safe("log.packets", 0.0) < double(100)', '2025-09-04 15:17:50.152925', true, false, 'origin', '["origin.ip"]', '[{"indexPattern":"v11-log-*","with":[{"field":"origin.ip.keyword","operator":"filter_term","value":"{{.origin.ip}}"}],"or":null,"within":"now-5m","count":20}]');
INSERT INTO public.utm_correlation_rules VALUES (974, 'Endpoint Security Framework Bypass Attempt', 3, 3, 3, 'Defense Evasion', 'T1562.001 - Impair Defenses: Disable or Modify Tools', 'Detects attempts to bypass or tamper with the macOS Endpoint Security framework, which could indicate malicious activity trying to evade security monitoring. The Endpoint Security framework is a critical component for system security monitoring and its compromise can allow attackers to operate undetected.

Next Steps:
1. Investigate the affected system and identify the process attempting to bypass endpoint security
2. Check for suspicious process executions or file modifications around the time of the alert
3. Verify if any legitimate security tools were recently installed or updated
4. Review system logs for other indicators of compromise
5. Consider isolating the affected system if malicious activity is confirmed
6. Check for persistence mechanisms that might be attempting to disable security controls
', '["https://attack.mitre.org/techniques/T1562/001/","https://developer.apple.com/documentation/endpointsecurity"]', '(safe("log.subsystem", "") == "com.apple.endpointsecurity" || safe("log.process", "").contains("EndpointSecurity") || safe("log.message", "").contains("ES_EVENT_TYPE")) && (safe("log.message", "").contains("bypass" || safe("log.message", "").contains("failed authorization" || safe("log.message", "").contains("client disconnected" || safe("log.message", "").contains("authorization denied" || safe("log.message", "").contains("invalid client" || safe("log.message", "").contains("ES_RETURN_ERROR" || safe("log.eventType", "") == "error" || safe("log.message", "").contains("memory leak detected")', '2025-09-04 15:11:22.89899', true, false, 'origin', NULL, '[{"indexPattern":"v11-log-*","with":[{"field":"system.hostname.keyword","operator":"filter_term","value":"{{.system.hostname}}"}],"or":null,"within":"now-15m","count":2}]');
INSERT INTO public.utm_correlation_rules VALUES (975, 'FileVault Tampering Attempts', 3, 3, 2, 'Defense Evasion', 'T1562.001 - Impair Defenses: Disable or Modify Tools', 'Detects attempts to tamper with or disable FileVault encryption, which could indicate an attempt to bypass security controls or access encrypted data. This rule monitors FileVault subsystem logs and fdesetup process errors that may indicate unauthorized access attempts or configuration changes.

**Next Steps:**
1. Verify the legitimacy of the FileVault operation and the user account involved
2. Check if this activity was part of authorized system maintenance
3. Review system logs for any preceding suspicious activities from the same user
4. Examine the specific error messages or events that triggered this alert
5. Verify FileVault status and configuration integrity
6. Consider temporarily disabling the affected user account if unauthorized activity is suspected
', '["https://support.apple.com/guide/mac-help/protect-data-on-your-mac-with-filevault-mh11785/mac","https://attack.mitre.org/techniques/T1562/001/"]', '(safe("log.subsystem", "") == "com.apple.security.filevault" && (safe("log.message", "").contains("disable") || safe("log.message", "").contains("bypass") || safe("log.message", "").contains("unlock") || safe("log.message", "").contains("error") || safe("log.message", "").contains("failed")) || (safe("log.process", "") == "fdesetup" && safe("log.messageType", "") == "error") || (safe("log.message", "").contains("FileVault") && (safe("log.message", "").contains("tampering") || safe("log.message", "").contains("modification") || safe("log.message", "").contains("unauthorized"))', '2025-09-04 15:11:23.422289', true, false, 'origin', NULL, '[]');
INSERT INTO public.utm_correlation_rules VALUES (977, 'Gatekeeper Bypass Attempt Detected', 2, 3, 2, 'Defense Evasion', 'T1553.001 - Subvert Trust Controls: Gatekeeper Bypass', 'Detects attempts to bypass Gatekeeper security checks through database manipulation, quarantine attribute removal, or exploitation of assessment vulnerabilities. Gatekeeper is a macOS security feature that verifies downloaded applications before they run, and bypassing it can allow malicious software to execute without proper verification.

Next Steps:
1. Immediately examine the affected system for unauthorized applications or modifications
2. Check system logs for unusual file downloads or installations around the time of the bypass attempt
3. Verify the integrity of applications in /Applications and ~/Applications directories
4. Review quarantine database (/var/db/SystemPolicy) for unauthorized modifications
5. Check for persistence mechanisms that might have been installed by bypassing Gatekeeper
6. Scan the system for malware using updated antivirus signatures
7. Consider reimaging the system if compromise is confirmed
8. Review user accounts and privileges for unauthorized changes
9. Monitor network traffic for suspicious outbound connections
10. Document the incident and update security policies as needed
', '["https://book.hacktricks.wiki/en/macos-hardening/macos-security-and-privilege-escalation/macos-security-protections/macos-gatekeeper.html","https://redcanary.com/blog/threat-detection/gatekeeper/","https://attack.mitre.org/techniques/T1553/001/"]', '( safe("log.process", "") == "syspolicyd" && ( safe("log.message", "").matches(".*assessment.*bypass.*") || safe("log.message", "").matches(".*quarantine.*removed.*") || safe("log.message", "").matches(".*GKE.*override.*") ) ) || ( safe("log.message", "").matches(".*xattr.*-d.*com\\.apple\\.quarantine.*") && safe("log.eventType", "") == "logEvent" ) || ( safe("log.processImagePath", "").matches(".*/var/db/SystemPolicy.*") && safe("log.message", "").matches(".*(modify|write|delete).*") ) || ( safe("log.subsystem", "") == "com.apple.security.assessment" && safe("log.message", "").matches(".*(bypass|override|disable).*") ) || ( safe("log.process", "") == "spctl" && safe("log.message", "").matches(".*--disable.*") )', '2025-09-04 15:11:24.486072', true, false, 'origin', NULL, '[]');
INSERT INTO public.utm_correlation_rules VALUES (982, 'Location Services Unauthorized Access', 3, 2, 1, 'Collection', 'T1005 - Data from Local System', 'Detects unauthorized attempts to access location services or multiple location service permission requests that could indicate privacy violation attempts. This rule identifies when applications are denied access to location services or when unauthorized location access is attempted through the Transparency, Consent, and Control (TCC) framework.

Next Steps:
1. Review the application requesting location access and verify if it''s legitimate
2. Check if the user has previously granted or denied location access to this application
3. Examine other privacy-related permission requests from the same application
4. Verify the application''s digital signature and source
5. Monitor for additional TCC framework violations from the same process or user
6. Consider reviewing location services settings in System Preferences > Security & Privacy > Privacy > Location Services
', '["https://eclecticlight.co/2020/01/15/a-guide-to-catalinas-privacy-protection-2-controlling-privacy-settings/","https://attack.mitre.org/techniques/T1005/"]', '(safe("log.subsystem", "") == "com.apple.TCC" && safe("log.message", "").contains("location")) || (safe("log.process", "") == "tccd" && safe("log.message", "").contains("kTCCServiceLocation")) || (safe("log.message", "").contains("LocationServices") && safe("log.message", "").contains("denied")) || (safe("log.message", "").contains("CoreLocationAgent") && safe("log.message", "").contains("unauthorized"))', '2025-09-04 15:12:07.95122', true, false, 'origin', NULL, '[]');
INSERT INTO public.utm_correlation_rules VALUES (978, 'Homebrew Package Tampering Detection', 2, 3, 2, 'Initial Access', 'T1195.001 - Supply Chain Compromise: Compromise Software Dependencies and Development Tools', 'Detects potential Homebrew package tampering, malicious formula modifications, or suspicious package installation activities that could indicate supply chain attacks targeting macOS systems through compromised Homebrew packages.

Next Steps:
1. Immediately isolate the affected system to prevent further compromise
2. Verify the integrity of installed Homebrew packages using ''brew doctor'' and ''brew audit''
3. Check the modification history of Homebrew formulas in /usr/local/Homebrew/Library/Taps
4. Review network connections and DNS queries related to package downloads
5. Scan the system for indicators of compromise including unusual processes or network activity
6. Reinstall Homebrew and affected packages from trusted sources if tampering is confirmed
7. Review user activity logs for suspicious administrative actions
', '["https://www.securityweek.com/homebrew-macos-users-targeted-with-information-stealer-malware/","https://attack.mitre.org/techniques/T1195/001/"]', '(safe("log.process", "") == "brew" && (safe("log.message", "").contains("formula") && safe("log.message", "").contains("modified")) || (safe("log.message", "").contains("homebrew") && (safe("log.message", "").contains("curl") || safe("log.message", "").contains("wget")) || (safe("log.message", "").contains("/usr/local/Homebrew") && safe("log.message", "").contains("permission") || (safe("log.message", "").contains("brew") && safe("log.message", "").contains("checksum") || (safe("log.message", "").contains("Cellar") && (safe("log.message", "").contains("tamper") || safe("log.message", "").contains("integrity")) || (safe("log.process", "").contains("Terminal") && safe("log.message", "").contains("HOMEBREW_NO_INSECURE_REDIRECT")', '2025-09-04 15:12:05.715261', true, false, 'origin', NULL, '[]');
INSERT INTO public.utm_correlation_rules VALUES (979, 'Suspicious Kernel Extension Loading Detected', 3, 3, 2, 'Persistence, Privilege Escalation', 'T1547.006 - Boot or Logon Autostart Execution: Kernel Modules and Extensions', 'Detects suspicious or unauthorized kernel extension (kext) loading attempts that could indicate rootkit installation or system compromise. This rule monitors for kext loading activities that bypass normal security protections, involve unsigned or invalid extensions, or occur in sensitive system directories.

Next Steps:
1. Investigate the specific kernel extension being loaded and verify its legitimacy
2. Check if the extension is signed by a trusted developer
3. Review system logs for any related security violations or SIP bypasses
4. Examine the process that initiated the kext loading
5. Verify if the loading occurred during legitimate system maintenance
6. Consider quarantining the system if unauthorized rootkit activity is suspected
7. Review system integrity and scan for additional persistence mechanisms
', '["https://www.microsoft.com/en-us/security/blog/2025/01/13/analyzing-cve-2024-44243-a-macos-system-integrity-protection-bypass-through-kernel-extensions/","https://attack.mitre.org/techniques/T1547/006/"]', '( safe("log.process", "").matches(".*(kextload|kextutil|kextcache).*" && ( safe("log.message", "").matches(".*load.*") || safe("log.message", "").matches(".*install.*") ) && ( safe("log.processImagePath", "") != ".*/System/Library/.*" || safe("log.message", "").matches(".*unsigned.*") || safe("log.message", "").matches(".*invalid.*signature.*") ) ) || ( safe("log.subsystem", "") == "com.apple.kernel" && safe("log.message", "").matches(".*kext.*") && ( safe("log.message", "").matches(".*load.*failed.*") || safe("log.message", "").matches(".*authentication.*error.*") || safe("log.message", "").matches(".*rootless.*") ) ) || ( safe("log.process", "") == "kernel" && safe("log.message", "").matches(".*kext.*") && ( safe("log.message", "").matches(".*third.*party.*") || safe("log.message", "").matches(".*unsigned.*") || safe("log.message", "").matches(".*developer.*mode.*") ) ) || ( safe("log.message", "").matches(".*/System/Library/Extensions.*") && safe("log.message", "").matches(".*(modify|write|create).*") && safe("log.process", "") != "kextcache" ) || ( safe("log.process", "") == "eslogger" && safe("log.message", "").matches(".*kext.*bypass.*") )', '2025-09-04 15:12:06.233795', true, false, 'origin', NULL, '[]');
INSERT INTO public.utm_correlation_rules VALUES (1288, 'Windows: Remote File Download via MpCmdRun', 2, 3, 1, 'Command and Control', 'Ingress Tool Transfer', 'Identifies the Windows Defender configuration utility (MpCmdRun.exe) being used to download a remote file.', '["https://attack.mitre.org/tactics/TA0011/","https://attack.mitre.org/techniques/T1105/"]', 'safe("log.winlogEventDataProcessName", "").contains("MpCmdRun.exe") && safe("log.message", "").contains("-url") && safe("log.message", "").contains("-DownloadFile") && safe("log.message", "").contains("-path")', '2025-09-04 20:01:51.1799', true, false, 'origin', NULL, '[]');
INSERT INTO public.utm_correlation_rules VALUES (980, 'Keychain Access Violations Detection', 3, 2, 1, 'Credential Access', 'T1555.001 - Credentials from Password Stores: Keychain', 'Detects unauthorized or suspicious attempts to access macOS Keychain, including failed access attempts, unusual process access, and potential credential theft activities. This rule identifies security subsystem events related to keychain access failures, denials, or unauthorized attempts.

Next Steps:
1. Investigate the process attempting keychain access and verify if it''s legitimate
2. Check for any recent malware infections or suspicious processes on the affected host
3. Review user activity around the time of the violation
4. Examine keychain access logs for patterns of abuse
5. Consider resetting credentials if unauthorized access is confirmed
6. Monitor for additional credential access attempts from the same host or user
', '["https://attack.mitre.org/techniques/T1555/001/","https://support.apple.com/guide/keychain-access/mac-keychain-password-kyca1242/mac","https://jumpcloud.com/support/understand-mac-keychain-access"]', '(safe("log.subsystem", "") == "com.apple.security" || safe("log.subsystem", "") == "com.apple.securityd" || safe("log.process", "") == "securityd" || safe("log.process", "") == "security") && (safe("log.message", "").contains("keychain") || safe("log.message", "").contains("Keychain") && (safe("log.message", "").contains("error") || safe("log.message", "").contains("failed") || safe("log.message", "").contains("denied") || safe("log.message", "").contains("unauthorized") || safe("log.message", "").contains("-25308") || safe("log.message", "").contains("accountsd wants to use") && safe("log.messageType", "") in ["error", "fault"]', '2025-09-04 15:12:06.747904', true, false, 'origin', NULL, '[]');
INSERT INTO public.utm_correlation_rules VALUES (981, 'Launch Agent/Daemon Persistence Detection', 2, 3, 2, 'Persistence, Privilege Escalation', 'T1543.001 - Create or Modify System Process: Launch Agent', 'Detects suspicious creation or modification of Launch Agents and Launch Daemons which are commonly used for persistence on macOS systems. Monitors for new plist files being created in LaunchAgents or LaunchDaemons directories.

Next Steps:
1. Review the specific Launch Agent/Daemon plist file that was created or modified
2. Examine the contents of the plist file for suspicious commands or executables
3. Check if the plist file was created by a legitimate administrative process
4. Verify the digital signature and origin of any executables referenced in the plist
5. Review system logs around the time of creation for related suspicious activity
6. Check for other persistence mechanisms on the affected system
7. Consider isolating the system if malicious persistence is confirmed
', '["https://attack.mitre.org/techniques/T1543/001/","https://developer.apple.com/documentation/os/logging","https://www.crowdstrike.com/en-us/blog/how-to-leverage-apple-unified-log-for-incident-response/"]', '(safe("log.subsystem", "") == "com.apple.launchd" || safe("log.process", "") == "launchd") && (safe("log.message", "").contains("LaunchAgent") || safe("log.message", "").contains("LaunchDaemon")) && (safe("log.message", "").contains("loaded") || safe("log.message", "").contains("started") || safe("log.message", "").contains("created")) && (safe("log.message", "").contains("/Library/LaunchAgents") || safe("log.message", "").contains("/Library/LaunchDaemons") || safe("log.message", "").contains("/System/Library/LaunchAgents") || safe("log.message", "").contains("/System/Library/LaunchDaemons") || safe("log.message", "").contains("~/Library/LaunchAgents"))', '2025-09-04 15:12:07.230584', true, false, 'origin', NULL, '[]');
INSERT INTO public.utm_correlation_rules VALUES (983, 'MDM Profile Removal Detection', 2, 3, 2, 'Defense Evasion', 'T1562.001 - Impair Defenses: Disable or Modify Tools', 'Detects unauthorized removal or modification of MDM (Mobile Device Management) profiles on macOS systems, which could indicate attempts to bypass corporate security controls or remove device management. This activity may suggest an attacker or malicious insider attempting to evade corporate security policies and monitoring.

Next Steps:
1. Verify if the MDM profile removal was authorized through proper change management processes
2. Check if the user has legitimate administrative access to modify MDM profiles
3. Review recent user activity and authentication logs for the affected system
4. Confirm the current MDM enrollment status of the device
5. Investigate any concurrent suspicious activities on the same host
6. Contact the device user to verify if they initiated the profile removal
7. Re-enroll the device in MDM if the removal was unauthorized
', '["https://attack.mitre.org/techniques/T1562/001/","https://support.addigy.com/hc/en-us/articles/13833098867219-Troubleshooting-MDM-Connectivity-for-macOS","https://docs.omnissa.com/bundle/macOS-Device-ManagementVSaaS/page/ProfilesOverview.html"]', '(safe("log.process", "") in ["mdmclient", "profiles", "System Preferences", "System Settings"] ||
 safe("log.subsystem", "") == "com.apple.ManagedClient" ||
 safe("log.subsystem", "").contains("MDM") ||
 safe("log.message", "").contains("mdmclient") &&
(safe("log.message", "").contains("remove") ||
 safe("log.message", "").contains("delete") ||
 safe("log.message", "").contains("uninstall") ||
 safe("log.message", "").contains("profile") ||
 safe("log.message", "").contains("unenroll") ||
 safe("log.message", "").contains("MDM_Connect: Unable") ||
 safe("log.message", "").contains("enrollment") ||
 safe("log.message", "").contains("configuration profile") &&
(safe("log.messageType", "") in ["error", "fault", "default"] ||
 safe("log.message", "").contains("ERROR")
', '2025-09-04 15:12:08.780965', true, false, 'origin', NULL, '[]');
INSERT INTO public.utm_correlation_rules VALUES (1070, 'Certificate Management Security Issue', 3, 3, 2, 'Defense Evasion, Persistence, Privilege Escalation, Initial Access', 'T1078 - Valid Accounts', 'Detects certificate management issues in pfSense including expired certificates, failed certificate generation, or unauthorized certificate access attempts that could compromise secure communications.

Next Steps:
1. Review the specific certificate error in the logs
2. Check certificate expiration dates and renewal status
3. Verify certificate authority chain integrity
4. Investigate any unauthorized access attempts to certificate stores
5. Update or renew certificates as needed
6. Monitor for additional certificate-related anomalies
', '["https://docs.netgate.com/pfsense/en/latest/certificates/certificate.html","https://attack.mitre.org/techniques/T1078/"]', 'safe("raw", "").contains("cert") && (safe("raw", "").contains("expired") || safe("raw", "").contains("invalid") || safe("raw", "").contains("failed") || safe("raw", "").contains("denied") || safe("raw", "").contains("revoked") || safe("raw", "").contains("untrusted"))', '2025-09-04 15:34:17.28372', true, false, 'origin', '["log.syslogHost","origin.ip"]', '[]');
INSERT INTO public.utm_correlation_rules VALUES (989, 'Unauthorized Screen Recording Activity', 3, 1, 1, 'Collection', 'T1113 - Screen Capture', 'Detects potential unauthorized screen recording or screen capture activities that may be used for data exfiltration or surveillance. This rule identifies various screen capture mechanisms including system screencapture processes, TCC permission requests, and third-party applications attempting screen recording.

Next Steps:
1. Verify if the screen recording activity was authorized by checking with the user
2. Review the process that initiated the screen recording for legitimacy
3. Check for any suspicious file creation patterns (.mov, .mp4 files)
4. Examine TCC (Transparency, Consent, and Control) logs for permission grants
5. Monitor for any subsequent data transfer activities that might indicate exfiltration
6. Review installed applications for potential malware or unauthorized software
', '["https://macpaw.tech/research/is-mac-screen-captured/","https://attack.mitre.org/techniques/T1113/"]', '(safe("log.subsystem", "") == "com.apple.screencapture" && safe("log.category", "") == "recording") || (safe("log.process", "") == "screencapture" && safe("log.message", "").contains("Capturing video")) || (safe("log.process", "") == "screencaptureui" && safe("log.message", "").contains("video screenshot pressed")) || (safe("log.message", "").contains("CGSIsScreenWatcherPresent")) || (safe("log.message", "").contains("Setup recording filename") && safe("log.message", "").contains(".mov")) || (safe("log.subsystem", "") == "com.apple.TCC" && safe("log.message", "").contains("kTCCServiceScreenCapture")) || (safe("log.process", "") not in ["screencapture", "screencaptureui", "QuickTime Player", "Screenshot", "Zoom"] && safe("log.message", "").contains("screen recording")', '2025-09-04 15:12:47.807384', true, false, 'origin', NULL, '[]');
INSERT INTO public.utm_correlation_rules VALUES (984, 'Suspicious Microphone or Camera Access', 3, 1, 1, 'Collection', 'T1123 - Audio Capture', 'Detects unauthorized or suspicious access to microphone or camera devices that may indicate surveillance or data collection activities. This rule monitors TCC (Transparency, Consent, and Control) framework events and AVFoundation subsystem activities that could suggest malicious applications attempting to access sensitive hardware.

Next Steps:
1. Verify the legitimacy of the process accessing microphone/camera resources
2. Check if the application has proper permissions and user consent
3. Review recent application installations and updates
4. Examine the application''s code signing and developer identity
5. Monitor for any data exfiltration activities from the same process
6. Consider quarantining the suspicious application if unauthorized access is confirmed
7. Review TCC database entries for unauthorized permission grants
', '["https://www.rainforestqa.com/blog/macos-tcc-db-deep-dive","https://attack.mitre.org/techniques/T1123/"]', '(safe("log.subsystem", "") == "com.apple.TCC" && (safe("log.message", "").contains("kTCCServiceMicrophone") || safe("log.message", "").contains("kTCCServiceCamera")) || (safe("log.message", "").contains("Update Access Record:" && (safe("log.message", "").contains("Microphone") || safe("log.message", "").contains("Camera")) || (safe("log.process", "") == "tccd" && (safe("log.message", "").contains("AVCaptureDevice") || safe("log.message", "").contains("AudioDevice")) || (safe("log.message", "").contains("accessing microphone") && safe("log.process", "") not in ["FaceTime", "Zoom", "Skype", "Teams", "Slack", "Discord", "WhatsApp"]) || (safe("log.message", "").contains("accessing camera") && safe("log.process", "") not in ["FaceTime", "Zoom", "Skype", "Teams", "Photo Booth", "Discord", "WhatsApp"]) || (safe("log.subsystem", "") == "com.apple.avfoundation" && safe("log.message", "").contains("authorization status")', '2025-09-04 15:12:09.467857', true, false, 'origin', NULL, '[]');
INSERT INTO public.utm_correlation_rules VALUES (999, 'Excessive Bandwidth Utilization Spike', 1, 1, 3, 'Impact', 'T1496 - Resource Hijacking', 'Detects sudden spikes in bandwidth utilization that could indicate DDoS attacks, resource hijacking, or compromised systems being used for cryptocurrency mining or other bandwidth-intensive activities. This rule identifies flows with high byte counts (>50MB) occurring within short durations (<5 minutes).

Next Steps:
1. Investigate the source and destination IP addresses involved in the high bandwidth transfer
2. Check if the communication pattern is expected for business operations
3. Analyze the protocol and port information to understand the nature of the traffic
4. Review historical network traffic patterns for the affected hosts
5. Check for signs of malware or unauthorized applications on the source system
6. Consider implementing rate limiting or traffic shaping if the activity is malicious
7. Monitor for similar patterns from other internal hosts that might indicate lateral movement
', '["https://www.cisco.com/en/US/technologies/tk648/tk362/technologies_white_paper09186a00800a3db9.html","https://attack.mitre.org/techniques/T1496/"]', 'safe("origin.ip", "") != "" && safe("target.ip", "") != "" && safe("log.bytes", 0.0) > double(50000000) && safe("log.flowDuration", 0.0) < double(300)', '2025-09-04 15:17:47.932882', true, false, 'origin', '["origin.ip","target.ip"]', '[]');
INSERT INTO public.utm_correlation_rules VALUES (985, 'Suspicious Network Extension Activity', 3, 3, 2, 'Collection', 'T1185 - Man in the Browser', 'Detects potentially malicious network extension activities that could be used for traffic interception, data exfiltration, or man-in-the-middle attacks. Network extensions in macOS can be abused by malware to intercept network traffic, modify DNS responses, or establish unauthorized proxy connections.

Next Steps:
1. Identify the specific network extension causing the alerts
2. Verify if the extension is legitimate and properly signed
3. Check for unusual network traffic patterns from the affected system
4. Review installed applications and their network extension components
5. Examine system logs for related authentication or authorization failures
6. Consider removing unauthorized or suspicious network extensions
7. Monitor for data exfiltration attempts or unauthorized network connections
', '["https://attack.mitre.org/techniques/T1185/","https://developer.apple.com/documentation/networkextension"]', '(safe("log.subsystem", "") == "com.apple.networkextension" || safe("log.process", "").contains("NEFilterProvider") || safe("log.process", "").contains("NEAppProxyProvider") && (safe("log.message", "").contains("content filter") || safe("log.message", "").contains("packet tunnel") || safe("log.message", "").contains("proxy provider") || safe("log.message", "").contains("DNS proxy") || safe("log.eventType", "") == "error" || safe("log.message", "").contains("failed to validate") || safe("log.message", "").contains("unauthorized extension")', '2025-09-04 15:12:09.967859', true, false, 'origin', NULL, '[{"indexPattern":"v11-log-macos-*","with":[{"field":"origin.host.keyword","operator":"filter_term","value":"{{.origin.host}}"},{"field":"log.subsystem.keyword","operator":"filter_term","value":"com.apple.networkextension"}],"or":null,"within":"now-30m","count":5}]');
INSERT INTO public.utm_correlation_rules VALUES (986, 'Notarization Bypass Attempt Detected', 2, 3, 1, 'Defense Evasion', 'T1553.001 - Subvert Trust Controls: Gatekeeper Bypass', 'Detects attempts to bypass macOS notarization checks through various methods including quarantine attribute manipulation, AppleDouble file format abuse, or ZIP archive exploitation. This rule identifies suspicious activities that attempt to circumvent Apple''s security mechanisms designed to protect users from malicious software.

Next Steps:
1. Investigate the specific process and command that triggered this alert
2. Check if the user account has legitimate administrative privileges
3. Examine recent file downloads and modifications by the user
4. Review system logs for other suspicious activities by the same user
5. Verify if any unsigned applications were recently executed
6. Check for presence of malware or unwanted software on the system
7. Consider quarantining the affected system if malicious activity is confirmed
8. Review security policies regarding software installation and execution
', '["https://redcanary.com/threat-detection-report/techniques/gatekeeper-bypass/","https://attack.mitre.org/techniques/T1553/001/"]', '(safe("log.process", "") == "spctl" && safe("log.message", "").contains("assessment") || (safe("log.subsystem", "") == "com.apple.xprotect" && safe("log.message", "").contains("failed on rPathCmd") || (safe("log.message", "").contains("com.apple.quarantine") && safe("log.message", "").contains("remove") || (safe("log.process", "") == "xattr" && safe("log.message", "").contains("-d com.apple.quarantine") || (safe("log.message", "").contains("LSFileQuarantineEnabled") && safe("log.message", "").contains("false") || (safe("log.message", "").contains("ACL") && safe("log.message", "").contains("quarantine")', '2025-09-04 15:12:10.669792', true, false, 'origin', NULL, '[]');
INSERT INTO public.utm_correlation_rules VALUES (987, 'Privacy Preferences (TCC) Database Tampering', 3, 3, 1, 'Privilege Escalation, Defense Evasion', 'T1548 - Abuse Elevation Control Mechanism', 'Detects unauthorized modifications to the macOS TCC (Transparency, Consent, and Control) database which controls application privacy permissions. The TCC database manages access permissions for sensitive resources like camera, microphone, location services, and file system access. Unauthorized modifications to this database can allow malicious applications to bypass privacy controls and gain access to sensitive user data.

Next Steps:
1. Investigate the process that modified the TCC database and verify if it''s authorized
2. Check what specific permissions were modified in the TCC database
3. Review recent application installations and permission requests
4. Examine system logs for other suspicious activities around the same timeframe
5. Verify the integrity of system privacy settings and restore from backup if necessary
6. Consider implementing additional monitoring for TCC database access
', '["https://www.huntress.com/blog/full-transparency-controlling-apples-tcc","https://attack.mitre.org/techniques/T1548/"]', '(safe("log.message", "").contains("Update Access Record:") && safe("log.subsystem", "") == "com.apple.TCC") || (safe("log.process", "") == "sqlite3" && safe("log.message", "").contains("TCC.db") || (safe("log.process", "") == "tccutil" && safe("log.message", "").contains("reset") || (safe("log.message", "").contains("TCC") && safe("log.message", "").contains("INSERT") || (safe("log.message", "").contains("TCC") && safe("log.message", "").contains("UPDATE") || (safe("log.message", "").contains("TCC") && safe("log.message", "").contains("DELETE") || (safe("log.subsystem", "") == "com.apple.TCC" && safe("log.category", "") == "access" && safe("log.message", "").contains("modification")', '2025-09-04 15:12:11.201345', true, false, 'origin', NULL, '[]');
INSERT INTO public.utm_correlation_rules VALUES (990, 'Spotlight Index Manipulation', 2, 3, 2, 'Defense Evasion', 'T1070.004 - Indicator Removal on Host: File Deletion', 'Detects attempts to manipulate Spotlight search index which could be used to hide malicious files or activities from search results. This includes index corruption, deletion, reindexing, exclusion modifications, and privacy setting changes.

Next Steps:
1. Investigate the user account and system where the Spotlight manipulation occurred
2. Review recent file system activities and processes executed by the user
3. Check for suspicious files or directories that may have been hidden from Spotlight
4. Examine system logs for evidence of malware installation or unauthorized access
5. Verify if the Spotlight manipulation was part of legitimate system maintenance
6. Look for other defense evasion techniques used in conjunction with this activity
7. Consider restoring Spotlight index from backup if manipulation was malicious
', '["https://support.apple.com/guide/mac-help/search-with-spotlight-mchlp1008/mac","https://attack.mitre.org/techniques/T1070/004/"]', '(safe("log.subsystem", "") == "com.apple.spotlight" && (safe("log.message", "").contains("index corruption") || safe("log.message", "").contains("index deleted") || safe("log.message", "").contains("reindex") || safe("log.message", "").contains("exclusion") || safe("log.message", "").contains("privacy")) || (safe("log.process", "") == "mdutil" && (safe("log.message", "").contains("-E") || safe("log.message", "").contains("-i off") || safe("log.message", "").contains("disable") || safe("log.message", "").contains("erase")) || (safe("log.process", "") == "mds" && safe("log.messageType", "") == "error") || (safe("log.message", "").contains(".Spotlight-V100") && (safe("log.message", "").contains("delete") || safe("log.message", "").contains("modify") || safe("log.message", "").contains("access denied")))', '2025-09-04 15:12:48.301726', true, false, 'origin', NULL, '[]');
INSERT INTO public.utm_correlation_rules VALUES (991, 'Synthetic Click Event Detected', 3, 3, 1, 'Collection, Credential Access', 'T1056 - Input Capture', 'Detects synthetic (programmatic) mouse click events that may be used to bypass security prompts or automate malicious actions. These events can indicate attempts to circumvent user interaction requirements for malicious software execution or privilege escalation.

Next Steps:
1. Identify the source process generating synthetic click events
2. Examine the user context and permissions of the process
3. Check for recent software installations or script executions
4. Review system logs for accessibility permission changes
5. Investigate if legitimate automation tools are being used inappropriately
6. Monitor for subsequent privilege escalation or unauthorized access attempts
', '["https://www.jamf.com/blog/synthetic-reality/","https://attack.mitre.org/techniques/T1056/"]', '(safe("log.message", "").contains("osascript is not allowed assistive access") || (safe("log.process", "") == "tccd" && safe("log.message", "").contains("kTCCServiceAccessibility" && safe("log.message", "").contains("preflight_unknown")) || (safe("log.message", "").contains("CGEventCreateMouseEvent") || (safe("log.message", "").contains("CGEventPost") && safe("log.message", "").contains("mouse")) || (safe("log.message", "").contains("synthetic") && safe("log.message", "").contains("event")) || (safe("log.subsystem", "") == "com.apple.TCC" && safe("log.message", "").contains("PostEvent")) || (safe("log.message", "").contains("eventSourceUserData") && safe("log.process", "") != "screencaptureui")', '2025-09-04 15:12:48.830066', true, false, 'origin', NULL, '[]');
INSERT INTO public.utm_correlation_rules VALUES (992, 'System Integrity Protection (SIP) Bypass Attempt', 3, 3, 2, 'Defense Evasion', 'T1553.006 - Subvert Trust Controls: Code Signing Policy Modification', 'Detects attempts to bypass System Integrity Protection (SIP) through unauthorized modifications to protected locations or suspicious kernel extension loading with rootless entitlements. SIP is a critical security mechanism in macOS that protects system files and processes from modification, even by privileged users.

Next Steps:
1. Immediately isolate the affected macOS system to prevent further compromise
2. Check SIP status using ''csrutil status'' command to verify if it has been disabled
3. Review system logs for related process execution and file modifications
4. Examine running kernel extensions using ''kextstat'' command
5. Investigate the user account and process that attempted the SIP bypass
6. Check for persistence mechanisms and unauthorized modifications to system files
7. Review recent software installations and updates that might have triggered this alert
8. Consider reimaging the system if SIP has been successfully bypassed
', '["https://www.microsoft.com/en-us/security/blog/2025/01/13/analyzing-cve-2024-44243-a-macos-system-integrity-protection-bypass-through-kernel-extensions/","https://attack.mitre.org/techniques/T1553/006/"]', '( safe("log.process", "") == "storagekitd" && safe("log.message", "").matches(".*com\\.apple\\.rootless\\.install\\.heritable.*") ) || ( safe("log.processImagePath", "").matches(".*/System/Library/.*") && safe("log.message", "").matches(".*(csrutil|disable|rootless).*") && safe("log.eventType", "") == "logEvent" ) || ( safe("log.subsystem", "") == "com.apple.kernel" && safe("log.message", "").matches(".*(SIP|rootless).*bypass.*") ) || ( safe("log.process", "").matches(".*kext.*") && safe("log.message", "").matches(".*rootless.*") )', '2025-09-04 15:12:49.542706', true, false, 'origin', NULL, '[]');
INSERT INTO public.utm_correlation_rules VALUES (993, 'TCC Database Manipulation Detected', 3, 3, 2, 'Privilege Escalation, Defense Evasion', 'T1548 - Abuse Elevation Control Mechanism', 'Detects unauthorized attempts to manipulate the Transparency, Consent, and Control (TCC) database to bypass privacy protections and gain access to protected resources. This detection identifies various methods of TCC database manipulation including direct database modifications, unauthorized access attempts, and privilege escalation through TCC bypass techniques.

Next Steps:
1. Investigate the process attempting to modify the TCC database
2. Check if the modification was authorized and expected
3. Review system logs for any suspicious activity around the time of detection
4. Verify the integrity of the TCC database
5. Check for any unauthorized applications that may have gained elevated privileges
6. Review recent software installations or system changes
7. Consider reimaging the affected system if unauthorized TCC manipulation is confirmed
', '["https://interpressecurity.com/resources/report/return-of-the-macos-transparency-consent-and-control-tcc-database-manipulation/","https://www.sentinelone.com/labs/bypassing-macos-tcc-user-privacy-protections-by-accident-and-design/","https://attack.mitre.org/techniques/T1548/"]', '( safe("log.process", "") == "tccd" && ( safe("log.eventMessage", "").matches(".*unauthorized.*access.*") || safe("log.eventMessage", "").matches(".*bypass.*") || safe("log.eventMessage", "").matches(".*CVE-2020-9934.*") ) ) || ( safe("log.processImagePath", "").matches(".*/Library/Application Support/com\\.apple\\.TCC/TCC\\.db.*") && safe("log.eventMessage", "").matches(".*(write|modify|INSERT|UPDATE|DELETE).*") && safe("log.process", "") != "tccd" ) || ( safe("log.eventMessage", "").matches(".*TCC\\.db.*") && ( safe("log.eventMessage", "").matches(".*(sqlite3|INSERT INTO|UPDATE|DELETE FROM).*") || safe("log.eventMessage", "").matches(".*(kTCCServiceDeveloperTool|kTCCServiceScreenCapture|kTCCServiceAccessibility).*") ) ) || ( safe("log.subsystem", "") == "com.apple.TCC" && ( safe("log.eventMessage", "").matches(".*Full Disk Access.*") || safe("log.eventMessage", "").matches(".*Screen Recording.*") || safe("log.eventMessage", "").matches(".*Accessibility.*") ) && safe("log.eventMessage", "").matches(".*(grant|bypass|override).*") ) || ( safe("log.process", "").matches(".*") && safe("log.eventMessage", "").matches(".*com\\.apple\\.private\\.tcc\\.manager.*") && safe("log.process", "") != "tccd" )', '2025-09-04 15:12:50.771629', true, false, 'origin', NULL, '[]');
INSERT INTO public.utm_correlation_rules VALUES (1462, 'Windows Defender: ERROR: BAD ACTION', 1, 2, 3, 'Potentially Compromised System', 'User Execution', 'Detects the ''BAD ACTION'' error event in Windows Defender, which may indicate a failed action or response to a threat.', '["https://learn.microsoft.com/en-us/windows/security/threat-protection/windows-defender-antivirus/troubleshoot"]', 'safe("log.winlogEventDataLogName", "") == "Microsoft-Windows-Windows Defender/Operational" &&  safe("log.winlogEventDataErrorCode", "") == "0x80508016"', '2025-09-04 21:11:27.266117', true, false, 'target', NULL, '[]');
INSERT INTO public.utm_correlation_rules VALUES (994, 'Time Machine Tampering', 1, 3, 3, 'Impact', 'T1490 - Inhibit System Recovery', 'Detects attempts to tamper with Time Machine backups, which could indicate an attacker trying to prevent system recovery or destroy backup data. This includes deletion, corruption, disabling, or unauthorized modification of Time Machine backup processes and data.

Next Steps:
1. Verify the legitimacy of the Time Machine operation by checking if it was authorized by an administrator
2. Examine the user account and process that initiated the Time Machine changes
3. Check for signs of ransomware or malware that may be attempting to destroy backups
4. Review system logs for additional suspicious activities around the same timeframe
5. Verify Time Machine backup integrity and restore capabilities
6. Consider isolating the affected system if ransomware activity is suspected
', '["https://support.apple.com/guide/mac-help/back-up-your-mac-with-time-machine-mh35860/mac","https://attack.mitre.org/techniques/T1490/"]', '(safe("log.subsystem", "") == "com.apple.TimeMachine" && (safe("log.message", "").contains("delete") || safe("log.message", "").contains("corrupt") || safe("log.message", "").contains("failed") || safe("log.message", "").contains("error") || safe("log.message", "").contains("exclude")) || (safe("log.process", "") == "tmutil" && (safe("log.message", "").contains("disable") || safe("log.message", "").contains("delete") || safe("log.message", "").contains("removedestination")) || (safe("log.message", "").contains("Time Machine" && (safe("log.message", "").contains("tampering") || safe("log.message", "").contains("modification") || safe("log.message", "").contains("unauthorized") || safe("log.message", "").contains("backup deletion")))', '2025-09-04 15:12:51.333512', true, false, 'origin', NULL, '[]');
INSERT INTO public.utm_correlation_rules VALUES (995, 'XProtect Evasion or Tampering Detected', 3, 3, 2, 'Defense Evasion', 'T1562.001 - Impair Defenses: Disable or Modify Tools', 'Detects attempts to evade or tamper with XProtect malware detection including modification of XProtect files, databases, or YARA rules. XProtect is Apple''s built-in antimalware system, and attempts to bypass or disable it indicate potential malicious activity.

Next Steps:
1. Immediately investigate the affected system and user account for signs of compromise
2. Check for recently installed software or suspicious downloads that may have triggered the evasion attempt
3. Review system logs for other defense evasion activities around the same timeframe
4. Verify the integrity of XProtect files and configurations
5. Run a comprehensive malware scan using additional security tools
6. Consider isolating the affected system if malicious activity is confirmed
7. Review user privileges and access controls to prevent unauthorized system modifications
8. Document the incident and update security policies if necessary
', '["https://www.sentinelone.com/blog/macos-malware-researchers-how-to-bypass-xprotect-on-catalina/","https://attack.mitre.org/techniques/T1562/001/"]', '( safe("log.subsystem", "") == "com.apple.XProtectFramework" && ( safe("log.message", "").matches(".*bypass.*") || safe("log.message", "").matches(".*evasion.*") || safe("log.message", "").matches(".*disable.*") ) ) || ( safe("log.processImagePath", "").matches(".*/Library/Apple/System/Library/CoreServices/XProtect\\.bundle.*") && safe("log.message", "").matches(".*(modify|write|delete).*") ) || ( safe("log.message", "").matches(".*XProtect\\.(yara|meta\\.plist|bundle).*") && ( safe("log.message", "").matches(".*(modify|tamper|delete).*") || safe("log.process", "") != "XProtectService" ) ) || ( safe("log.process", "") == "MRT" && safe("log.message", "").matches(".*(kill|terminate|stop).*" ) || ( safe("log.message", "").matches(".*gk\\.db.*" && safe("log.message", "").matches(".*(modify|delete|truncate).*" ) || ( safe("log.subsystem", "") == "com.apple.MRT" && safe("log.message", "").matches(".*(bypass|disable|fail).*" )', '2025-09-04 15:12:51.841494', true, false, 'origin', NULL, '[]');
INSERT INTO public.utm_correlation_rules VALUES (996, 'T2 Security Chip Anomalous Activity', 3, 3, 2, 'Initial Access', 'T1200 - Hardware Additions', 'Detects suspicious activities related to the T2 security chip including potential bypass attempts, firmware modifications, or secure boot violations. The T2 chip is Apple''s security coprocessor that provides secure boot capabilities and hardware-level security features.

Next Steps:
1. Immediately check the affected system''s physical security and location
2. Verify system integrity by running Apple Diagnostics (hold D while booting)
3. Check for unauthorized physical access or tampering with the device
4. Review System Information > Hardware > Controller for T2 chip status
5. Examine Console.app logs for additional T2/bridgeOS entries around the incident time
6. Verify secure boot status in System Preferences > Startup Security Utility
7. Check for any recent firmware updates or modifications
8. Consider re-imaging the system if hardware tampering is suspected
9. Report to incident response team if physical security breach is confirmed
', '["https://attack.mitre.org/techniques/T1200/","https://support.apple.com/guide/security/secure-boot-secac71d5623/web"]', '(safe("log.subsystem", "").contains("com.apple.security") || safe("log.subsystem", "").contains("com.apple.sepos") || safe("log.process", "").contains("bridgeOS") || safe("log.process", "").contains("sepOS") || safe("log.message", "").contains("T2") || safe("log.message", "").contains("secure boot")) && (safe("log.message", "").contains("verification failed") || safe("log.message", "").contains("signature invalid") || safe("log.message", "").contains("firmware") || safe("log.message", "").contains("checkm8") || safe("log.message", "").contains("checkra1n") || safe("log.message", "").contains("ECID") || safe("log.message", "").contains("activation lock bypass") || safe("log.message", "").contains("SMC payload") || safe("log.eventType", "") == "error" || safe("log.message", "").contains("security policy violation")', '2025-09-04 15:14:51.757173', true, false, 'origin', NULL, '[]');
INSERT INTO public.utm_correlation_rules VALUES (997, 'Application Layer Attack Detection', 2, 3, 3, 'Initial Access', 'T1190 - Exploit Public-Facing Application', 'Detects potential application layer attacks including HTTP/HTTPS floods, slow attacks, and abnormal application protocol behavior that may indicate exploitation attempts or DDoS attacks. This rule identifies suspicious patterns in network flows such as high packet counts with low byte ratios, excessive connection rates, and abnormal application protocol behavior across common service ports.

Next Steps:
1. Investigate the source IP address for reputation and previous malicious activity
2. Analyze the specific application logs for the targeted service to identify attack vectors
3. Review network flow patterns to determine if this is part of a larger coordinated attack
4. Check for application-specific indicators of compromise (SQL injection patterns, web shell uploads, etc.)
5. Implement rate limiting or blocking for the attacking IP address if confirmed malicious
6. Review and strengthen application security controls based on the attack method identified
7. Monitor for lateral movement or privilege escalation attempts from the same source
', '["https://attack.mitre.org/techniques/T1190/","https://www.cisco.com/c/en/us/td/docs/security/asa/special/netflow/asa_netflow.html"]', '( (safe("target.port", 0.0) == double(80) || safe("target.port", 0.0) == double(443) || safe("target.port", 0.0) == double(8080) || safe("target.port", 0.0) == double(8443)) && ( safe("log.packets", 0.0) > double(10000) && safe("log.bytes", 0.0) < double(1048576) || safe("log.tcp_flags", "") == "SYN" && safe("log.flow_count", 0.0) > double(1000) || safe("log.duration", 0.0) > double(300) && safe("log.bytes", 0.0) < double(10240) ) ) || ( safe("target.port", 0.0) == double(21) && safe("log.commands", 0.0) > double(100) ) || ( safe("target.port", 0.0) == double(22) && safe("log.failed_attempts", 0.0) > double(10) ) || ( (safe("target.port", 0.0) == double(3306) || safe("target.port", 0.0) == double(5432) || safe("target.port", 0.0) == double(1433) || safe("target.port", 0.0) == double(1521)) && safe("log.bytes", 0.0) > double(104857600) ) || ( safe("log.http_requests_per_second", 0.0) > double(1000) || safe("log.connection_rate", 0.0) > double(500) )', '2025-09-04 15:17:46.782191', true, false, 'origin', '["adversary.ip","target.port"]', '[]');
INSERT INTO public.utm_correlation_rules VALUES (998, 'Asset Enumeration Attempts via NetFlow', 3, 1, 2, 'Discovery', 'Network Service Discovery', 'Detects potential asset enumeration attempts by identifying a single source IP scanning multiple destination IPs on the same port within a short time window, indicating network reconnaissance activity. This pattern suggests an attacker is systematically probing the network to discover active services and assets.

Next Steps:
1. Investigate the source IP address for additional suspicious activities
2. Check if the source IP is external or internal to determine attack vector
3. Review firewall logs for blocked connection attempts from the same source
4. Examine the specific ports being scanned to understand the attacker''s targets
5. Verify if any successful connections were established following the scanning
6. Check for privilege escalation attempts or lateral movement from compromised systems
7. Consider implementing additional network segmentation to limit scanning effectiveness
8. Review and update intrusion detection signatures for similar scanning patterns
', '["https://attack.mitre.org/techniques/T1046/","https://www.cisco.com/en/US/technologies/tk648/tk362/technologies_white_paper09186a00800a3db9.html"]', 'safe("origin.ip", "") != "" && safe("target.ip", "") != "" && safe("target.port", 0) > 0 && safe("protocol", "") != ""', '2025-09-04 15:17:47.500302', true, false, 'origin', '["origin.ip","target.port"]', '[{"indexPattern":"v11-log-netflow-*","with":[{"field":"origin.ip.keyword","operator":"filter_term","value":"{{.origin.ip}}"},{"field":"target.port","operator":"filter_term","value":"{{.target.port}}"}],"or":null,"within":"now-5m","count":20}]');
INSERT INTO public.utm_correlation_rules VALUES (1000, 'C2 Beaconing Behavior Detection', 3, 3, 2, 'Command and Control', 'T1071 - Application Layer Protocol', 'Detects potential command and control beaconing behavior based on periodic connections with consistent intervals and small data transfers. This rule identifies suspicious network patterns where an internal host makes repeated small connections to an external host, which may indicate C2 communication.

Next Steps:
1. Analyze the frequency and timing of connections between the source and destination
2. Investigate the destination IP for known malicious indicators or suspicious reputation
3. Examine the content of the communications if possible through packet capture
4. Check the source host for signs of compromise or malware
5. Review DNS queries made by the source host around the time of the connections
6. Correlate with other security events from the same source host
7. Consider isolating the source host if malicious activity is confirmed
', '["https://attack.mitre.org/techniques/T1071/","https://www.cisco.com/en/US/technologies/tk648/tk362/technologies_white_paper09186a00800a3db9.html"]', 'safe("origin.ip", "") != "" && safe("target.ip", "") != "" && safe("origin.bytesSent", 0.0) > double(0) && safe("origin.bytesSent", 0.0) < double(10000) && safe("origin.packagesSent", 0.0) < double(50) && (safe("target.port", 0.0) == double(443) || safe("target.port", 0.0) == double(80) || safe("target.port", 0.0) == double(8080) || safe("target.port", 0.0) == double(8443))', '2025-09-04 15:17:48.55019', true, false, 'origin', '["origin.ip","target.ip"]', '[{"indexPattern":"v11-log-netflow-*","with":[{"field":"origin.ip.keyword","operator":"filter_term","value":"{{.origin.ip}}"},{"field":"target.ip.keyword","operator":"filter_term","value":"{{.target.ip}}"},{"field":"dataType.keyword","operator":"filter_term","value":"netflow"}],"or":null,"within":"now-1h","count":20}]');
INSERT INTO public.utm_correlation_rules VALUES (1012, 'Port Scanning Activity Detection', 2, 1, 1, 'Discovery', 'T1046 - Network Service Scanning', 'Detects port scanning activities based on patterns of connections to multiple ports with minimal data transfer. This could indicate reconnaissance activities or vulnerability scanning attempts.

Next Steps:
1. Verify the scanning activity by examining the target ports and services
2. Check if the origin IP is known to be legitimate (security scanner, monitoring tool)
3. Analyze the scope of the scan - single target or multiple targets
4. Review firewall and intrusion detection logs for additional context
5. Investigate any successful connections or unusual response patterns
6. Consider blocking the origin IP if malicious activity is confirmed
', '["https://www.cisco.com/en/US/technologies/tk648/tk362/technologies_white_paper09186a00800a3db9.html","https://attack.mitre.org/techniques/T1046/"]', 'safe("origin.ip", "") != "" && safe("target.ip", "") != "" && safe("log.packets", 0.0) <= double(10) && safe("log.bytes", 0.0) < double(1000) && safe("target.port", 0.0) > 0 && safe("protocol", "") == "TCP"', '2025-09-04 15:18:24.696332', true, false, 'origin', '["origin.ip","target.ip"]', '[{"indexPattern":"v11-log-netflow-*","with":[{"field":"origin.ip.keyword","operator":"filter_term","value":"{{.origin.ip}}"},{"field":"target.ip.keyword","operator":"filter_term","value":"{{.target.ip}}"}],"or":null,"within":"now-2m","count":15}]');
INSERT INTO public.utm_correlation_rules VALUES (1295, 'Windows: Searching for Saved Credentials via VaultCmd', 3, 2, 1, 'Credential Access', 'Credentials from Password Stores', 'Windows Credential Manager allows you to create, view, or delete saved credentials for signing into websites, connected applications, and networks. An adversary may abuse this to list or dump credentials stored in the Credential Manager for saved usernames and passwords. This may also be performed in preparation of lateral movement.', '["https://attack.mitre.org/tactics/TA0006/","https://attack.mitre.org/techniques/T1555/"]', 'safe("log.winlogEventDataProcessName", "").contains("vaultcmd.exe") && safe("log.message", "").contains("/list")', '2025-09-04 20:05:56.541226', true, false, 'origin', NULL, '[]');
INSERT INTO public.utm_correlation_rules VALUES (1392, 'Windows: Suspicious Image Load (taskschd.dll) from MS Office', 1, 2, 3, 'Persistence', 'Scheduled Task/Job', 'Identifies a suspicious image load (taskschd.dll) from Microsoft Office processes. This behavior may indicate adversarial activity where a scheduled task is configured via Windows Component Object Model (COM). This technique can be used to configure persistence and evade monitoring by avoiding the usage of the traditional Windows binary (schtasks.exe) used to manage scheduled tasks.', '["https://attack.mitre.org/tactics/TA0003/","https://attack.mitre.org/techniques/T1053/"]', 'safe("log.eventDataProcessName", "").matches("(WINWORD.EXE|EXCEL.EXE|POWERPNT.EXE|MSPUB.EXE|MSACCESS.EXE)") && safe("log.message", "").contains("taskschd.dll")', '2025-09-04 20:46:18.406945', true, false, 'origin', NULL, '[]');
INSERT INTO public.utm_correlation_rules VALUES (1003, 'Data Exfiltration Detection', 3, 2, 1, 'Exfiltration', 'T1041 - Exfiltration Over C2 Channel', 'Detects potential data exfiltration based on unusually large outbound data transfers to external IP addresses. This rule identifies network flows where significant amounts of data (>10MB) are transferred from internal systems to external destinations in different countries, potentially indicating unauthorized data theft or exfiltration attempts.

Next Steps:
1. Verify the legitimacy of the large data transfer by checking if it corresponds to authorized business activities
2. Investigate the destination IP address for reputation and known threat indicators
3. Review the user and process responsible for initiating the connection
4. Check for any recently accessed sensitive files or databases on the source system
5. Examine network logs for any additional suspicious communications to the same destination
6. Consider implementing DLP policies if large data transfers to external destinations are not business justified
7. If confirmed malicious, isolate the affected system and conduct a full forensic investigation
', '["https://attack.mitre.org/techniques/T1041/","https://www.cisco.com/en/US/technologies/tk648/tk362/technologies_white_paper09186a00800a3db9.html"]', 'safe("origin.ip", "") != "" && safe("target.ip", "") != "" && safe("origin.bytesSent", 0.0) > double(10000000) && safe("origin.geolocation.country", "") != safe("target.geolocation.country", "") && safe("origin.port", 0.0) > double(1024)', '2025-09-04 15:17:50.938353', true, false, 'origin', '["origin.ip","target.ip"]', '[{"indexPattern":"v11-log-netflow-*","with":[{"field":"origin.ip.keyword","operator":"filter_term","value":"{{.origin.ip}}"},{"field":"dataType.keyword","operator":"filter_term","value":"netflow"}],"or":null,"within":"now-1h","count":10}]');
INSERT INTO public.utm_correlation_rules VALUES (1008, 'Memcached Amplification Attack Detection', 1, 1, 3, 'Impact', 'T1498 - Network Denial of Service', 'Detects potential Memcached amplification attacks by identifying high-volume UDP traffic on port 11211 typically used in reflection DDoS attacks. Memcached amplification attacks exploit misconfigured Memcached servers to amplify attack traffic by up to 51,000 times.

Next Steps:
1. Investigate the source IP addresses to determine if they are legitimate or compromised
2. Check if the Memcached servers are properly configured with authentication and firewalls
3. Monitor network traffic patterns for sustained high-volume UDP traffic
4. Consider blocking traffic to/from port 11211 if Memcached is not required
5. Review logs for other amplification attack indicators (DNS, NTP, SSDP)
6. Coordinate with network team to implement rate limiting or traffic filtering
', '["https://blog.cloudflare.com/memcrashed-major-amplification-attacks-from-port-11211/","https://attack.mitre.org/techniques/T1498/"]', '(safe("target.port", 0.0) == 11211 || safe("origin.port", 0.0) == 11211) && safe("protocol", "") == "17" && safe("origin.bytesSent", 0.0) > double(10000)', '2025-09-04 15:18:22.480742', true, false, 'origin', NULL, '[]');
INSERT INTO public.utm_correlation_rules VALUES (1004, 'DDoS Attack Pattern Detection', 1, 1, 3, 'Impact', 'T1498 - Network Denial of Service', 'Detects potential DDoS attack patterns based on high volume of network flows from multiple sources targeting a single destination within a short time window. This rule identifies suspicious traffic volumes that may indicate volumetric DDoS attacks such as UDP floods, TCP floods, or other amplification attacks.

Next Steps:
1. Verify the target IP address and check if it''s a critical service or server
2. Analyze the source IPs to determine if they are part of a botnet or coordinated attack
3. Review network traffic patterns and bandwidth utilization during the timeframe
4. Check firewall and DDoS mitigation system logs for related events
5. Implement rate limiting or blocking rules for attacking source IPs if confirmed malicious
6. Consider scaling up infrastructure or activating DDoS protection services if attack is ongoing
7. Document the attack pattern for future reference and threat intelligence
', '["https://attack.mitre.org/techniques/T1498/","https://www.cisco.com/en/US/technologies/tk648/tk362/technologies_white_paper09186a00800a3db9.html"]', 'safe("target.ip", "") != "" && safe("origin.ip", "") != "" && (safe("origin.bytesSent", 0.0) > double(1000000) || safe("origin.packagesSent", 0.0) > double(10000))', '2025-09-04 15:17:51.465267', true, false, 'origin', '["target.ip"]', '[{"indexPattern":"v11-log-netflow-*","with":[{"field":"target.ip.keyword","operator":"filter_term","value":"{{.target.ip}}"},{"field":"dataType.keyword","operator":"filter_term","value":"netflow"}],"or":null,"within":"now-5m","count":50}]');
INSERT INTO public.utm_correlation_rules VALUES (1005, 'DNS Query Anomaly Detection', 3, 2, 2, 'Command and Control', 'T1071.004 - DNS Tunneling', 'Detects anomalous DNS query patterns including DNS tunneling, DGA domains, excessive queries, cache poisoning attempts, and suspicious query types that may indicate malware communication or data exfiltration. This rule identifies suspicious DNS traffic patterns such as oversized queries/responses, excessive query volumes, unusual query types, TCP-based DNS queries, and unauthorized DNS servers.

Next Steps:
1. Investigate the source IP address for other suspicious network activity
2. Analyze DNS query logs for the specific domains being queried
3. Check if the queries contain encoded data or random-looking domain names
4. Verify if the DNS server being used is authorized for the network
5. Look for patterns of data exfiltration through DNS responses
6. Examine query timing patterns for potential C2 communication
7. Cross-reference with threat intelligence feeds for known malicious domains
8. Monitor for additional anomalous DNS behavior from the same source
9. Consider blocking the source IP if malicious activity is confirmed
10. Review network configuration to ensure proper DNS filtering is in place
', '["https://attack.mitre.org/techniques/T1071/004/","https://www.cisco.com/c/en/us/td/docs/net_mgmt/netflow_collection_engine/3-6/user/guide/format.html"]', '( (safe("target.port", 0.0) == double(53) || safe("origin.port", 0.0) == double(53)) && ( safe("log.bytes", 0.0) > double(512) && safe("protocol", "") == "17" || safe("log.query_count", 0.0) > double(1000) || safe("log.unique_domains", 0.0) > double(100) || safe("log.txt_queries", 0.0) > double(10) || safe("log.failed_queries", 0.0) > double(50) ) ) || ( safe("target.port", 0.0) == double(53) && safe("log.query_length", 0.0) > double(100) ) || ( safe("target.port", 0.0) == double(53) && safe("log.subdomain_depth", 0.0) > double(5) ) || ( (safe("target.port", 0.0) == double(53) || safe("origin.port", 0.0) == double(53)) && safe("protocol", "") == "6" ) || ( safe("target.port", 0.0) == double(53) && safe("log.non_standard_query_type", "false") == "true" ) || ( safe("target.port", 0.0) == double(53) && safe("log.response_size", 0.0) > double(4096) ) || ( safe("origin.port", 0.0) == double(53) && safe("origin.ip", "") != safe("log.authorized_dns_server", "") )', '2025-09-04 15:17:51.984107', true, false, 'origin', '["origin.ip","target.ip"]', '[]');
INSERT INTO public.utm_correlation_rules VALUES (1006, 'NetFlow Export Manipulation Attempt', 2, 3, 2, 'Defense Evasion', 'Indicator Removal', 'Detects potential NetFlow export manipulation attempts by identifying suspicious patterns such as flows with zero bytes/packets, abnormal protocol values, or flows targeting NetFlow collector ports. This could indicate an attacker attempting to manipulate network flow records to hide malicious activity or evade detection.

Next Steps:
1. Investigate the source IP address and verify if it''s a legitimate network device
2. Check NetFlow collector logs for any configuration changes or anomalies
3. Review network infrastructure for unauthorized access or configuration changes
4. Examine other network flows from the same source for additional suspicious patterns
5. Verify the integrity of NetFlow export configurations on network devices
6. Check for any recent network device firmware updates or configuration changes
', '["https://attack.mitre.org/techniques/T1070/","https://datatracker.ietf.org/doc/html/rfc7011"]', '(safe("log.ByteCount", 0.0) == double(0) && safe("log.PacketCount", 0.0) > double(0)) || (safe("log.ByteCount", 0.0) > double(0) && safe("log.PacketCount", 0.0) == double(0)) || safe("target.port", 0.0) in [2055, 4739, 6343, 9996] || safe("log.proto", 0.0) > double(255)', '2025-09-04 15:17:52.543691', true, false, 'origin', '["origin.ip"]', '[{"indexPattern":"v11-log-netflow-*","with":[{"field":"origin.ip.keyword","operator":"filter_term","value":"{{.origin.ip}}"}],"or":null,"within":"now-30m","count":5}]');
INSERT INTO public.utm_correlation_rules VALUES (1018, 'Tor Network Usage Detection', 3, 2, 1, 'Command and Control', 'T1090 - Proxy: Multi-hop Proxy', 'Detects potential Tor network usage based on connections to known Tor entry node ports (9001, 9030, 9050, 9051) and traffic patterns consistent with Tor usage. Tor is commonly used by attackers to anonymize their traffic and evade detection.

Next Steps:
1. Verify if Tor usage is authorized in your organization''s security policy
2. Investigate the source IP address and user context if available
3. Check for other suspicious activities from the same source
4. Consider blocking Tor traffic if not authorized for business use
5. Review firewall logs for additional Tor-related connections
6. Correlate with authentication logs to identify the user if possible
', '["https://attack.mitre.org/techniques/T1090/","https://www.cisco.com/en/US/technologies/tk648/tk362/technologies_white_paper09186a00800a3db9.html","https://www.torproject.org/"]', 'safe("origin.ip", "") != "" && safe("target.ip", "") != "" && (safe("target.port", 0.0) == 9001 || safe("target.port", 0.0) == 9030 || safe("target.port", 0.0) == 9050 || safe("target.port", 0.0) == 9051) && safe("protocol", "") == "6" && safe("log.bytes", 0.0) > double(512)', '2025-09-04 15:18:50.650161', true, false, 'origin', '["origin.ip"]', '[]');
INSERT INTO public.utm_correlation_rules VALUES (1007, 'Geographic Location Anomaly Detection', 3, 3, 1, 'Persistence, Initial Access', 'External Remote Services', 'Detects network connections from unusual geographic locations or countries with known threat activity. This could indicate unauthorized access, VPN abuse, or connections from compromised systems in unexpected locations. The rule triggers when connections are made from countries outside of trusted regions (US, CA, GB, AU) to sensitive services like SSH, RDP, SMB, SQL Server, or MySQL.

Next Steps:
1. Investigate the source IP address using threat intelligence feeds and OSINT sources
2. Verify if the connection is legitimate by checking with the system owner or user
3. Review authentication logs for the targeted service to identify successful logins
4. Check for any data exfiltration or lateral movement activities from the target system
5. Analyze the timing and frequency of connections from the suspicious geographic location
6. Consider implementing geographic access controls or VPN restrictions if unauthorized
7. Monitor for additional connections from the same country or IP range
8. Review firewall and IDS logs for other suspicious activities from the same source
', '["https://www.cisco.com/en/US/technologies/tk648/tk362/technologies_white_paper09186a00800a3db9.html","https://attack.mitre.org/techniques/T1133/"]', 'safe("origin.geolocation.countryCode", "") != "" && safe("origin.geolocation.countryCode", "") != "US" && safe("origin.geolocation.countryCode", "") != "CA" && safe("origin.geolocation.countryCode", "") != "GB" && safe("origin.geolocation.countryCode", "") != "AU" && (safe("target.port", 0.0) == 22 || safe("target.port", 0.0) == 3389 || safe("target.port", 0.0) == 445 || safe("target.port", 0.0) == 1433 || safe("target.port", 0.0) == 3306)', '2025-09-04 15:18:21.765362', true, false, 'origin', '["origin.ip","origin.geolocation.countryCode"]', '[]');
INSERT INTO public.utm_correlation_rules VALUES (1009, 'Network Reconnaissance Activity Detection', 3, 1, 1, 'Reconnaissance', 'Active Scanning', 'Detects potential network reconnaissance activities by identifying sources connecting to multiple unique destination IPs on various ports within a short time frame. This behavior is characteristic of network scanning tools and reconnaissance activities.

Next Steps:
1. Investigate the source IP for legitimacy - check if it belongs to authorized network scanners or security tools
2. Review the target IPs and ports being scanned to identify potential attack vectors
3. Analyze the timing and pattern of connections to determine scanning methodology
4. Check for any successful connections or responses from target systems
5. Review firewall and IDS logs for additional context around the scanning activity
6. If malicious, implement network blocks and notify relevant security teams
', '["https://attack.mitre.org/techniques/T1595/","https://attack.mitre.org/techniques/T1046/"]', 'safe("origin.ip", "") != "" && safe("target.ip", "") != "" && safe("log.packets", 0.0) < double(5)', '2025-09-04 15:18:23.028411', true, false, 'origin', '["origin.ip"]', '[{"indexPattern":"v11-log-netflow-*","with":[{"field":"origin.ip.keyword","operator":"filter_term","value":"{{.origin.ip}}"}],"or":null,"within":"now-10m","count":50}]');
INSERT INTO public.utm_correlation_rules VALUES (1010, 'NTP Amplification Attack Detection', 1, 1, 3, 'Impact', 'T1498.002 - Network Denial of Service: Reflection Amplification', 'Detects potential NTP amplification attacks by identifying unusual NTP traffic patterns with large response sizes or high packet counts to/from port 123. NTP amplification attacks exploit misconfigured NTP servers to amplify traffic directed at victims.

Next Steps:
1. Investigate the source IP addresses to determine if they are legitimate NTP servers
2. Check if the target systems are experiencing performance degradation or connectivity issues
3. Verify NTP server configurations and disable monlist command if enabled
4. Implement rate limiting for NTP traffic at network perimeters
5. Consider blocking or rate-limiting traffic from identified amplification sources
6. Monitor for additional amplification traffic patterns from the same sources
7. Review network capacity and implement DDoS mitigation if needed
', '["https://www.cisco.com/c/en/us/about/security-center/amplification-ddos.html","https://attack.mitre.org/techniques/T1498/002/","https://www.us-cert.gov/ncas/alerts/TA14-013A"]', '(safe("target.port", 0.0) == 123 || safe("origin.port", 0.0) == 123) && safe("protocol", "") == "17" && (safe("target.bytesReceived", 0.0) > double(1000) || safe("origin.bytesSent", 0.0) > double(1000) || safe("target.packagesReceived", 0.0) > double(10) || safe("origin.packagesSent", 0.0) > double(10))', '2025-09-04 15:18:23.535105', true, false, 'origin', '["origin.ip","target.ip"]', '[{"indexPattern":"v11-log-netflow-*","with":[{"field":"origin.ip.keyword","operator":"filter_term","value":"{{.origin.ip}}"},{"field":"target.port","operator":"filter_term","value":"123"}],"or":null,"within":"now-5m","count":50}]');
INSERT INTO public.utm_correlation_rules VALUES (1011, 'Peer-to-Peer Traffic Detection', 2, 2, 3, 'Command and Control', 'T1572 - Protocol Tunneling', 'Detects potential peer-to-peer traffic based on high port numbers and bidirectional data flows characteristic of P2P applications. P2P protocols often use high, non-standard port numbers and exhibit specific traffic patterns that can indicate unauthorized file sharing, cryptocurrency mining, or other P2P activities that may violate organizational policies or consume excessive bandwidth.

Next Steps:
1. Verify if the detected traffic is authorized P2P activity
2. Check the application or process generating the traffic
3. Analyze traffic patterns to determine if it''s legitimate business communication
4. Review network policies regarding P2P applications
5. Consider blocking P2P traffic if not business-justified
6. Monitor for potential data exfiltration or malware communication
', '["https://attack.mitre.org/techniques/T1572/","https://www.cisco.com/en/US/technologies/tk648/tk362/technologies_white_paper09186a00800a3db9.html"]', 'safe("origin.ip", "") != "" && safe("target.ip", "") != "" && safe("origin.port", 0.0) > 6000 && safe("target.port", 0.0) > 6000 && safe("origin.bytesSent", 0.0) > double(100000) && safe("protocol", "") == "6"', '2025-09-04 15:18:24.093976', true, false, 'origin', '["origin.ip"]', '[{"indexPattern":"v11-log-netflow-*","with":[{"field":"origin.ip.keyword","operator":"filter_term","value":"{{.origin.ip}}"},{"field":"dataType.keyword","operator":"filter_term","value":"netflow"}],"or":null,"within":"now-30m","count":15}]');
INSERT INTO public.utm_correlation_rules VALUES (1013, 'Protocol Distribution Anomaly Detection', 3, 3, 3, 'Discovery', 'T1046 - Network Service Discovery', 'Detects significant changes in protocol distribution patterns that may indicate network reconnaissance, protocol abuse, or the presence of malicious traffic attempting to blend with normal protocols. This rule identifies unusual protocol usage patterns including uncommon protocol types, large data transfers on non-standard protocols, and significant changes in protocol distribution ratios.

Next Steps:
1. Investigate the source IP address for other suspicious activities
2. Analyze the specific protocols being used and their typical usage patterns
3. Review network flow data for the time period to identify baseline deviations
4. Check for correlation with known attack indicators or threat intelligence
5. Examine payload content if available to determine the nature of the traffic
6. Consider implementing additional monitoring on the affected network segments
', '["https://attack.mitre.org/techniques/T1046/","https://www.cisco.com/en/US/technologies/tk648/tk362/technologies_white_paper09186a00800a3db9.html"]', '( safe("protocol", "") != "6" && safe("protocol", "") != "17" && safe("protocol", "") != "1" && safe("log.bytes", 0.0) > double(10485760) ) || ( safe("protocol", "") == "41" || safe("protocol", "") == "43" || safe("protocol", "") == "44" || safe("protocol", "") == "51" || safe("protocol", "") == "58" || safe("protocol", "") == "60" ) || ( safe("log.protocol_distribution_change", 0.0) > double(30) && safe("log.flow_count", 0.0) > double(1000) ) || ( safe("protocol", "") == "0" && safe("log.bytes", 0.0) > double(0) )', '2025-09-04 15:18:25.212416', true, false, 'origin', '["origin.ip","log.protocol"]', '[{"indexPattern":"v11-log-netflow-*","with":[{"field":"origin.ip.keyword","operator":"filter_term","value":"{{.origin.ip}}"},{"field":"log.protocol.keyword","operator":"filter_term","value":"{{.log.protocol}}"}],"or":null,"within":"now-4h","count":100}]');
INSERT INTO public.utm_correlation_rules VALUES (1014, 'Service Discovery Patterns in NetFlow', 2, 1, 1, 'Discovery', 'T1046 - Network Service Scanning', 'Detects service discovery patterns where a single source is probing multiple common service ports across different targets, indicating systematic service enumeration. This behavior is commonly observed during reconnaissance phases of attacks where adversaries scan for available services.

Next Steps:
1. Investigate the source IP address for legitimacy and ownership
2. Check if the scanning activity corresponds to authorized vulnerability assessments
3. Review firewall and IDS logs for additional suspicious activity from the same source
4. Examine target systems for any successful connections or exploitation attempts
5. Consider blocking the source IP if unauthorized scanning is confirmed
6. Monitor for privilege escalation or lateral movement attempts from compromised systems
', '["https://attack.mitre.org/techniques/T1046/","https://www.iana.org/assignments/ipfix/ipfix.xhtml"]', 'safe("origin.ip", "") != "" && safe("target.ip", "") != "" && safe("target.port", 0.0) in [21, 22, 23, 25, 80, 110, 139, 143, 443, 445, 1433, 1521, 3306, 3389, 5432, 5900, 8080, 8443, 9090]', '2025-09-04 15:18:25.75209', true, false, 'origin', '["origin.ip"]', '[{"indexPattern":"v11-log-netflow-*","with":[{"field":"origin.ip.keyword","operator":"filter_term","value":"{{.origin.ip}}"}],"or":null,"within":"now-10m","count":15}]');
INSERT INTO public.utm_correlation_rules VALUES (1015, 'SNMP Reflection Attack Detection', 2, 1, 3, 'Impact', 'Network Denial of Service', 'Detects potential SNMP reflection attacks by identifying suspicious SNMP traffic patterns on port 161 with high volume or packet counts. SNMP reflection attacks exploit misconfigured SNMP devices to amplify attack traffic.

Next Steps:
1. Verify the source IP is legitimate and not spoofed
2. Check if SNMP devices in your network are properly configured with community strings
3. Implement rate limiting on SNMP traffic
4. Block traffic from known reflection sources
5. Monitor for additional reflection attack patterns
6. Consider disabling SNMP on internet-facing devices if not required
', '["https://www.us-cert.gov/ncas/alerts/TA14-017A","https://attack.mitre.org/techniques/T1498/"]', '(safe("target.port", 0.0) == 161 || safe("origin.port", 0.0) == 161) && safe("protocol", "") == "17" && (safe("target.bytesSent", 0.0) > double(5000) || safe("origin.bytesSent", 0.0) > double(5000) || safe("target.packagesSent", 0.0) > double(20) || safe("origin.packagesSent", 0.0) > double(20))', '2025-09-04 15:18:26.327627', true, false, 'origin', '["origin.ip","target.ip"]', '[{"indexPattern":"v11-log-netflow-*","with":[{"field":"origin.ip.keyword","operator":"filter_term","value":"{{.origin.ip}}"},{"field":"target.port","operator":"filter_term","value":"161"}],"or":null,"within":"now-5m","count":50}]');
INSERT INTO public.utm_correlation_rules VALUES (1016, 'SSDP Amplification Attack Detection', 1, 1, 3, 'Impact', 'T1498 - Network Denial of Service', 'Detects potential SSDP (Simple Service Discovery Protocol) amplification attacks by identifying suspicious UDP traffic patterns on port 1900 used by Universal Plug and Play (UPnP) services. SSDP amplification attacks exploit the multicast nature of SSDP to amplify small requests into much larger responses, creating distributed denial-of-service conditions.

Next Steps:
1. Verify if the source IP is legitimate by checking internal asset inventory
2. Analyze packet sizes and response ratios to confirm amplification characteristics
3. Check for multiple simultaneous connections from the same source to different SSDP servers
4. Implement rate limiting or blocking for suspicious source IPs
5. Review network infrastructure for improperly configured UPnP devices
6. Consider disabling UPnP services if not required for business operations
', '["https://www.us-cert.gov/ncas/alerts/TA14-017A","https://attack.mitre.org/techniques/T1498/"]', '(safe("target.port", 0.0) == 1900 || safe("origin.port", 0.0) == 1900) && safe("protocol", "") == "17" && (safe("target.bytesSent", 0.0) > double(2000) || safe("origin.packagesSent", 0.0) > double(15))', '2025-09-04 15:18:26.867991', true, false, 'origin', '["origin.ip","target.ip"]', '[{"indexPattern":"v11-log-netflow-*","with":[{"field":"origin.ip.keyword","operator":"filter_term","value":"{{.origin.ip}}"},{"field":"target.port","operator":"filter_term","value":"1900"}],"or":null,"within":"now-5m","count":30}]');
INSERT INTO public.utm_correlation_rules VALUES (1017, 'NetFlow Template Tampering Detection', 2, 3, 3, 'Impact', 'T1565 - Data Stored Object Manipulation', 'Detects potential NetFlow template tampering by identifying flows with invalid or suspicious field combinations, abnormal timestamps, or flows that appear to be crafted to evade detection. This includes flows where FirstSwitched timestamp is greater than LastSwitched, identical input/output interfaces (excluding interface 0), or identical source and destination IP addresses.

**Next Steps:**
1. Verify the NetFlow exporter configuration and template definitions
2. Check for any unauthorized modifications to NetFlow collection infrastructure
3. Review network device logs for configuration changes or unauthorized access
4. Analyze the source IP for other suspicious network activities
5. Validate NetFlow data integrity by comparing with other network monitoring sources
6. Consider implementing NetFlow template validation and monitoring controls
', '["https://attack.mitre.org/techniques/T1565/","https://www.cisco.com/en/US/technologies/tk648/tk362/technologies_white_paper09186a00800a3db9.html"]', '(safe("log.FirstSwitched", "") != "" && safe("log.LastSwitched", "") != "" && safe("log.FirstSwitched", "") > safe("log.LastSwitched", "")) || (safe("log.InputInterface", "") == safe("log.OutputInterface", "") && safe("log.InputInterface", "") != "" && safe("log.InputInterface", "") != "0") || (safe("origin.ip", "") == safe("target.ip", "") && safe("origin.ip", "") != "")', '2025-09-04 15:18:49.918052', true, false, 'origin', '["origin.ip"]', '[{"indexPattern":"v11-log-netflow-*","with":[{"field":"origin.ip.keyword","operator":"filter_term","value":"{{.origin.ip}}"}],"or":null,"within":"now-15m","count":10}]');
INSERT INTO public.utm_correlation_rules VALUES (1021, 'VPN Tunnel Anomalies Detection', 3, 3, 2, 'Command and Control', 'T1572 - Protocol Tunneling', 'Detects anomalies in VPN tunnel traffic patterns including unusual data volumes, connection patterns, or protocol violations that may indicate compromised VPN credentials or tunnel exploitation. This rule monitors IPSec (ports 500/4500), OpenVPN (port 1194), PPTP (port 1723), ESP (protocol 50), and GRE (protocol 47) traffic for suspicious patterns.

**Next Steps:**
1. Investigate the source IP for previous VPN authentication events and verify legitimate user access
2. Check VPN server logs for any authentication anomalies or failed login attempts from the same IP
3. Analyze the data volume and connection patterns to determine if they match normal user behavior
4. Verify if the VPN credentials associated with this traffic are compromised by checking for concurrent logins from different locations
5. Review network traffic logs to identify any data exfiltration or lateral movement attempts
6. Consider temporarily disabling the affected VPN account pending investigation
', '["https://attack.mitre.org/techniques/T1572/","https://www.cisco.com/c/en/us/td/docs/security/asa/special/netflow/asa_netflow.html"]', '( (safe("origin.port", 0.0) == 500 || safe("origin.port", 0.0) == double(4500) || safe("target.port", 0.0) == 500 || safe("target.port", 0.0) == 4500 || safe("origin.port", 0.0) == 1194 || safe("target.port", 0.0) == 1194 || safe("origin.port", 0.0) == 1723 || safe("target.port", 0.0) == 1723) && ( safe("origin.bytesSent", 0.0) > double(104857600) || safe("origin.packagesSent", 0.0) > double(100000) || safe("log.duration", 0.0) < double(5) ) ) || ( safe("protocol", "") == "50" && safe("origin.bytesSent", 0.0) > double(52428800) ) || ( safe("protocol", "") == "47" && safe("log.flow_count", 0.0) > double(50) )', '2025-09-04 15:18:52.313099', true, false, 'origin', '["origin.ip","target.ip"]', '[{"indexPattern":"v11-log-netflow-*","with":[{"field":"origin.ip.keyword","operator":"filter_term","value":"{{.origin.ip}}"}],"or":null,"within":"now-1h","count":10}]');
INSERT INTO public.utm_correlation_rules VALUES (1031, 'High Availability Failover Event', 1, 2, 3, 'Impact', 'T1489 - Service Stop', 'Detects high availability failover events including unexpected failovers, HA state changes, and synchronization failures that could indicate system instability or attacks targeting firewall availability.

Next Steps:
1. Verify if the failover was planned maintenance or unexpected
2. Check the secondary firewall status and synchronization state
3. Review logs for any errors or attacks preceding the failover
4. Validate HA configuration and network connectivity between peers
5. Monitor for repeated failovers which may indicate ongoing issues
6. Check system resources and performance metrics on both firewalls
', '["https://docs.paloaltonetworks.com/pan-os/10-2/pan-os-admin/high-availability","https://attack.mitre.org/techniques/T1489/"]', '(safe("raw", "").contains("HA") || safe("raw", "").contains("high availability") || safe("raw", "").contains("failover") || safe("log.cat", "").contains("ha")) && (safe("raw", "").contains("state change") || safe("raw", "").contains("active") || safe("raw", "").contains("passive") || safe("raw", "").contains("sync fail"))', '2025-09-04 15:26:10.841166', true, false, 'origin', '["target.host"]', '[{"indexPattern":"v11-log-firewall-paloalto-*","with":[{"field":"target.host.keyword","operator":"filter_term","value":"{{.target.host}}"},{"field":"log.cat.keyword","operator":"filter_term","value":"ha"}],"or":null,"within":"now-10m","count":3}]');
INSERT INTO public.utm_correlation_rules VALUES (1032, 'Kubernetes Security Events', 3, 3, 3, 'Defense Evasion, Execution', 'T1610 - Deploy Container', 'Detects critical security events in Kubernetes environments including unauthorized API access, pod security policy violations, and suspicious cluster operations. This rule identifies blocked or denied access attempts to Kubernetes infrastructure components and security policy violations.

Next Steps:
1. Investigate the source IP address attempting unauthorized access
2. Review Kubernetes audit logs for additional suspicious activities from the same source
3. Check if the IP is part of legitimate administrative networks
4. Verify pod security policies and RBAC configurations are properly enforced
5. Review cluster network policies and access controls
6. Monitor for privilege escalation attempts within the cluster
7. Check for any successful authentication events from the same source before/after the denial
8. Validate that Kubernetes API server and kubelet endpoints are properly secured
9. Consider implementing additional network segmentation for Kubernetes management traffic
', '["https://www.paloaltonetworks.com/prisma/environments/kubernetes","https://attack.mitre.org/techniques/T1610/"]', '(
  safe("log.app", "").contains("kubernetes") ||
  safe("log.app", "").contains("k8s") ||
  safe("log.category", "").contains("kubernetes") ||
  safe("log.rule", "").contains("k8s") ||
  safe("target.port", 0.0) == double(6443) ||
  safe("target.port", 0.0) == double(10250) ||
  safe("target.port", 0.0) == double(10255)
) &&
(
  (
    safe("action", "") == "deny" ||
    safe("action", "") == "block" ||
    safe("action", "") == "deny" ||
    safe("action", "") == "block"
  ) ||
  (
    safe("log.category", "").contains("api") &&
    (
      safe("log.category", "").contains("unauthorized") ||
      safe("log.category", "").contains("forbidden")
    )
  ) ||
  (
    safe("log.rule", "").contains("pod-security") ||
    safe("log.rule", "").contains("rbac") ||
    safe("log.rule", "").contains("namespace")
  )
) &&
safe("origin.ip", "") != ""
', '2025-09-04 15:26:54.499198', true, false, 'origin', '["origin.ip","log.sessionId"]', '[]');
INSERT INTO public.utm_correlation_rules VALUES (1033, 'Privileged User Activity Anomalies', 3, 3, 2, 'Privilege Escalation, Defense Evasion', 'T1548 - Abuse Elevation Control Mechanism', 'Detects anomalous activity from privileged users including unusual administrative actions, access to sensitive resources, or configuration changes. This rule identifies potentially suspicious behavior from administrative accounts that could indicate compromised credentials or insider threats.

Next Steps:
1. Verify the legitimacy of the administrative action with the account owner
2. Review the specific configuration changes made and their business justification
3. Check for any unusual login patterns or source IPs for this user account
4. Examine system logs for any other suspicious activities from this user
5. If unauthorized, immediately disable the account and investigate potential compromise
6. Review access logs to determine scope of potential unauthorized access
', '["https://docs.paloaltonetworks.com/pan-os/10-2/pan-os-admin/monitoring/use-syslog-for-monitoring/syslog-field-descriptions","https://attack.mitre.org/techniques/T1548/"]', 'safe("log.pa_type", "") == "CONFIG" && 
safe("origin.user", "") != "" &&
(
  origin.user.contains("admin") || 
  origin.user.contains("root") || 
  origin.user.contains("administrator") ||
  safe("log.vsys", "") == "vsys1"
) &&
(
  safe("action", "") == "edit" || 
  safe("action", "") == "delete" || 
  safe("action", "") == "set" ||
  safe("action", "") == "edit" ||
  safe("action", "") == "delete" ||
  safe("action", "") == "set"
) &&
(
  safe("log.category", "").contains("critical") ||
  safe("log.severityLabel", "").contains("high") ||
  safe("log.severityLabel", "").contains("critical")
)
', '2025-09-04 15:26:55.21324', true, false, 'origin', '["origin.user","action"]', '[]');
INSERT INTO public.utm_correlation_rules VALUES (1386, 'Windows: Suspicious CertUtil Commands', 3, 2, 1, 'Defense Evasion', 'Deobfuscate/Decode Files or Information', 'Identifies suspicious commands being used with certutil.exe. CertUtil is a native Windows component which is part of Certificate Services. CertUtil is often abused by attackers to live off the land for stealthier command and control or data exfiltration.', '["https://attack.mitre.org/tactics/TA0005/","https://attack.mitre.org/techniques/T1140/"]', 'safe("log.message", "").matches("(decode|encode|urlcache|verifyctl|encodehex|decodehex|exportPFX)") && safe("log.eventDataProcessName", "").contains("certutil.exe")', '2025-09-04 20:45:19.301933', true, false, 'target', NULL, '[]');
INSERT INTO public.utm_correlation_rules VALUES (1413, 'Windows: Peripheral Device Discovery', 2, 1, 1, 'Discovery', 'Peripheral Device Discovery', 'Identifies use of the Windows file system utility (fsutil.exe) to gather information about attached peripheral devices and components connected to a computer system.', '["https://attack.mitre.org/tactics/TA0007/","https://attack.mitre.org/techniques/T1120/"]', 'safe("log.message", "").contains("fsinfo") && safe("log.message", "").contains("drives") && safe("log.winlogEventDataProcessName", "").contains("fsutil.exe")', '2025-09-04 20:57:06.216225', true, false, 'origin', NULL, '[]');
INSERT INTO public.utm_correlation_rules VALUES (1022, 'Application Dependency Violations', 2, 3, 2, 'Command and Control', 'T1071 - Application Layer Protocol', 'Detects when applications violate defined dependency rules, which could indicate policy bypass attempts or misconfigured applications. This may occur when an application attempts to run without its required dependencies being satisfied.

Next Steps:
1. Review the specific application and dependency that was violated
2. Check if the application is authorized to run in this environment
3. Verify if the dependency requirements are properly configured
4. Investigate if this represents an attempted policy bypass
5. Review firewall rules to ensure proper application control
6. Check for signs of unauthorized application usage or tunneling attempts
', '["https://docs.paloaltonetworks.com/pan-os/10-2/pan-os-admin/app-id/application-dependencies","https://attack.mitre.org/techniques/T1071/"]', 'safe("action", "") == "deny" &&
safe("log.category_of_app", "") != "" &&
(safe("log.panOSDescription", "").contains("dependency") ||
 safe("log.panOSThreatCategory", "").contains("dependency") ||
 safe("raw", "").contains("application-dependency"))
', '2025-09-04 15:24:01.54596', true, false, 'origin', '["origin.ip","target.ip"]', '[{"indexPattern":"v11-log-firewall-paloalto-*","with":[{"field":"origin.ip.keyword","operator":"filter_term","value":"{{.origin.ip}}"},{"field":"action.keyword","operator":"filter_term","value":"deny"}],"or":null,"within":"now-15m","count":5}]');
INSERT INTO public.utm_correlation_rules VALUES (1023, 'CASB Policy Violation Detection', 3, 3, 1, 'Defense Evasion, Persistence, Privilege Escalation, Initial Access', 'T1078.004 - Valid Accounts: Cloud Accounts', 'Detects Cloud Access Security Broker (CASB) policy violations including unauthorized data sharing, risky user behavior, and non-compliant cloud application usage. This rule identifies when users attempt to access unsanctioned applications or trigger policy violations that result in denied access.

Next Steps:
1. Review the specific policy that was violated and the application involved
2. Investigate the user''s recent cloud application usage patterns
3. Check if this is part of a pattern of policy violations by the same user
4. Verify if the user has legitimate business need for the blocked application
5. Consider additional user training on acceptable cloud application usage
6. Review and update CASB policies if necessary
', '["https://docs.paloaltonetworks.com/saas-security/data-security","https://attack.mitre.org/techniques/T1078/004/"]', '(safe("log.sanctioned_state_of_app", "") == "unsanctioned" || safe("log.category", "").contains("policy-violation") || safe("log.category", "").contains("data-exposure")) && safe("action", "") == "deny"', '2025-09-04 15:24:02.078561', true, false, 'origin', '["origin.user","log.app"]', '[{"indexPattern":"v11-log-firewall-paloalto-*","with":[{"field":"log.srcuser.keyword","operator":"filter_term","value":"{{.log.srcuser}}"},{"field":"action.keyword","operator":"filter_term","value":"deny"}],"or":null,"within":"now-1h","count":5}]');
INSERT INTO public.utm_correlation_rules VALUES (1024, 'Container Security Violations', 3, 3, 3, 'Privilege Escalation', 'T1611 - Escape to Host', 'Detects security violations in containerized environments including unauthorized container operations, privilege escalations, and runtime policy violations. This rule identifies when Palo Alto firewalls detect and block container-related security threats.

Next Steps:
1. Investigate the source IP and determine if it''s an authorized container host
2. Review the specific container application and rule that triggered the violation
3. Check container runtime logs for additional context about the security event
4. Verify container image integrity and scan for vulnerabilities
5. Review container orchestration platform (Kubernetes/Docker) logs for related events
6. Assess if this represents a container escape attempt or unauthorized container deployment
7. Update container security policies if this is a legitimate activity being blocked
8. Consider implementing additional container runtime protection measures
', '["https://www.paloaltonetworks.com/prisma/cloud/container-security","https://attack.mitre.org/techniques/T1611/"]', '(
  safe("log.app", "").contains("docker") ||
  safe("log.app", "").contains("kubernetes") ||
  safe("log.app", "").contains("container") ||
  safe("log.category", "").contains("container") ||
  safe("log.rule", "").contains("container")
) &&
(
  safe("action", "") == "deny" ||
  safe("action", "") == "block" ||
  safe("action", "") == "deny" ||
  safe("action", "") == "block" ||
  safe("log.category", "").contains("violation") ||
  safe("log.category", "").contains("breach")
) &&
(
  safe("log.severityLabel", "") != "" &&
  (safe("log.severityLabel", "") == "high" || safe("log.severityLabel", "") == "critical" || safe("log.severityLabel", "") == "medium")
)
', '2025-09-04 15:24:02.63516', true, false, 'origin', '["origin.ip","target.ip","log.rule"]', '[]');
INSERT INTO public.utm_correlation_rules VALUES (1025, 'Cortex XDR Integration Alerts', 3, 3, 2, 'Defense Evasion', 'T1070 - Indicator Removal on Host', 'Detects high-priority alerts from Cortex XDR integration including endpoint threats, behavioral anomalies, and advanced persistent threats. This rule identifies critical and high severity security events that require immediate attention from the security team.

Next Steps:
1. Review the specific threat details and IOCs in the Cortex XDR console
2. Investigate the affected endpoint for additional indicators of compromise
3. Check for lateral movement patterns from the source IP
4. Verify if the threat has been successfully contained or blocked
5. Escalate to incident response team if advanced persistent threat indicators are present
6. Document findings and update threat intelligence feeds
', '["https://docs-cortex.paloaltonetworks.com/r/Cortex-XDR/Cortex-XDR-Documentation/Log-formats","https://attack.mitre.org/techniques/T1070/"]', '(
  safe("log.pa_type", "") == "CORRELATION" || 
  safe("log.pa_type", "") == "THREAT" ||
  safe("log.category", "").contains("cortex") ||
  safe("log.app", "").contains("cortex-xdr")
) &&
(
  safe("log.severityLabel", "") == "critical" ||
  safe("log.severityLabel", "") == "high" ||
  safe("log.threatid", "") != ""
) &&
(
  safe("action", "") == "alert" ||
  safe("action", "") == "block" ||
  safe("action", "") == "alert" ||
  safe("action", "") == "block" ||
  safe("log.category", "").contains("malware") ||
  safe("log.category", "").contains("exploit") ||
  safe("log.category", "").contains("command-and-control")
)
', '2025-09-04 15:24:03.135863', true, false, 'origin', '["origin.ip","log.threatid"]', '[]');
INSERT INTO public.utm_correlation_rules VALUES (1026, 'DoS Protection Triggers', 1, 2, 3, 'Impact', 'T1498 - Network Denial of Service', 'Detects when Palo Alto firewall DoS protection is triggered, indicating potential denial of service attacks against protected resources. This rule identifies flood-type threats that are being dropped by the firewall''s DoS protection mechanisms.

Next Steps:
1. Investigate the source IP address for malicious activity patterns
2. Check if the attacking IP is from a known botnet or compromised host
3. Review network traffic patterns to determine attack vectors and scale
4. Verify firewall DoS protection settings are appropriately configured
5. Consider implementing rate limiting or blocking the source IP if confirmed malicious
6. Monitor for additional flood attacks from the same or related IP addresses
7. Check if the attack is part of a larger coordinated DDoS campaign
', '["https://docs.paloaltonetworks.com/pan-os/10-2/pan-os-admin/zone-protection-and-dos-protection","https://attack.mitre.org/techniques/T1498/"]', 'safe("log.type", "") == "THREAT" && safe("log.subtype", "") == "flood" && safe("log.action", "") == "drop" && safe("origin.ip", "") != ""', '2025-09-04 15:24:03.714471', true, false, 'origin', '["origin.ip","target.ip"]', '[{"indexPattern":"v11-log-firewall-paloalto-*","with":[{"field":"origin.ip.keyword","operator":"filter_term","value":"{{.origin.ip}}"}],"or":null,"within":"now-5m","count":100}]');
INSERT INTO public.utm_correlation_rules VALUES (1027, 'File Blocking Policy Violations', 2, 3, 1, 'Command and Control', 'T1105 - Ingress Tool Transfer', 'Detects when files are blocked by Palo Alto firewall file blocking policies, indicating potential attempts to transfer malicious or unauthorized files through the network. This rule triggers when the firewall identifies and blocks files that violate configured security policies, which could indicate malware transfer attempts, data exfiltration, or policy violations.

Next Steps:
1. Review the blocked file details including filename, file type, and source/destination
2. Investigate the origin IP address for any suspicious activity patterns
3. Check if this is a legitimate business file that needs policy adjustment
4. Examine the target destination to understand the intended file transfer
5. Review file blocking policies to ensure they are appropriately configured
6. Consider implementing additional monitoring for the source system
7. If malicious intent is suspected, initiate incident response procedures
', '["https://docs.paloaltonetworks.com/pan-os/10-2/pan-os-admin/monitoring/use-syslog-for-monitoring/syslog-field-descriptions/threat-log-fields","https://attack.mitre.org/techniques/T1105/"]', 'safe("log.subtype", "") == "file" && safe("log.action", "") == "block-file" && safe("origin.ip", "") != ""', '2025-09-04 15:24:04.294242', true, false, 'origin', '["origin.ip","origin.host"]', '[]');
INSERT INTO public.utm_correlation_rules VALUES (1028, 'GlobalProtect VPN Anomalies', 3, 2, 2, 'Defense Evasion, Persistence, Privilege Escalation, Initial Access', 'T1078 - Valid Accounts', 'Detects anomalous GlobalProtect VPN connection patterns including failed authentications, unusual connection times, or suspicious source locations. This rule triggers when there are multiple failed authentication attempts for the same user within a 15-minute window.

**Next Steps:**
1. Review the failed authentication attempts for the affected user account
2. Check the source IP addresses and geolocation of connection attempts
3. Verify if the user account credentials have been compromised
4. Review recent user activity and access patterns
5. Consider implementing additional authentication factors if not already in place
6. Check for any concurrent successful logins from different locations
', '["https://docs.paloaltonetworks.com/globalprotect/10-2/globalprotect-admin/monitoring/view-globalprotect-logs","https://attack.mitre.org/techniques/T1078/"]', 'safe("log.log.type", "") == "GLOBALPROTECT" && (safe("log.log.eventid", "") == "gateway-auth-fail" || safe("log.log.eventid", "") == "portal-auth-fail") && safe("origin.user", "") != ""', '2025-09-04 15:24:04.841391', true, false, 'origin', '["adversary.user","adversary.ip"]', '[{"indexPattern":"v11-log-firewall-paloalto-*","with":[{"field":"origin.user.keyword","operator":"filter_term","value":"{{.origin.user}}"},{"field":"log.log.type.keyword","operator":"filter_term","value":"GLOBALPROTECT"}],"or":null,"within":"now-15m","count":5}]');
INSERT INTO public.utm_correlation_rules VALUES (1029, 'Hardware Security Module Critical Events', 3, 3, 2, 'Initial Access', 'T1200 - Hardware Additions', 'Detects critical hardware security module (HSM) events including key generation failures, cryptographic errors, and HSM connectivity issues that could indicate tampering or system compromise. HSM events are critical for maintaining cryptographic integrity and should be investigated immediately.

Next Steps:
1. Verify HSM hardware status and connectivity
2. Check HSM audit logs for unauthorized access attempts
3. Review recent configuration changes to HSM settings
4. Validate certificate and key management operations
5. Contact HSM vendor support if hardware issues are suspected
6. Review backup and recovery procedures for cryptographic materials
', '["https://docs.paloaltonetworks.com/pan-os/10-2/pan-os-admin/certificate-management/hardware-security-module","https://attack.mitre.org/techniques/T1200/"]', '(safe("raw", "").contains("HSM") || safe("raw", "").contains("hardware security module") || safe("log.category", "").contains("crypto") || safe("log.category", "").contains("hsm")) && (safe("log.severity", "") == "critical" || safe("log.severity", "") == "high" || safe("raw", "").contains("fail") || safe("raw", "").contains("error"))', '2025-09-04 15:24:05.378351', true, false, 'origin', '["log.syslogHost","category"]', '[]');
INSERT INTO public.utm_correlation_rules VALUES (1030, 'IOC Match from Threat Intelligence Feed', 3, 3, 2, 'Defense Evasion', 'T1027 - Obfuscated Files or Information', 'Detects when network traffic matches known Indicators of Compromise (IOCs) from threat intelligence feeds. This includes malicious IPs, domains, URLs, or file hashes associated with known threat actors or campaigns. The Palo Alto firewall has identified and blocked traffic based on threat intelligence data.

Next Steps:
1. Review the specific IOC that triggered the alert and verify its legitimacy
2. Investigate the source IP address for additional suspicious activities
3. Check if the same IOC has been observed from other internal hosts
4. Examine the target destination for potential compromise indicators
5. Update threat intelligence feeds and firewall rules as necessary
6. Consider isolating affected hosts if compromise is confirmed
7. Document the incident and IOC details for threat hunting activities
', '["https://docs.paloaltonetworks.com/cortex/cortex-xsoar/threat-intelligence-management","https://attack.mitre.org/techniques/T1027/"]', '(safe("log.panOSThreatCategory", "").contains("malware") ||
 safe("log.panOSThreatCategory", "").contains("command-and-control") ||
 safe("log.panOSThreatCategory", "").contains("phishing") ||
 safe("log.panOSThreatCategory", "").contains("botnet") ||
 safe("log.panOSThreatID", "") != "0" ||
 safe("log.msg", "").contains("threat-intel") ||
 safe("log.msg", "").contains("ioc-match")) &&
safe("action", "").in(["block", "deny", "drop", "reset-both", "reset-client", "reset-server"])
', '2025-09-04 15:24:06.526812', true, false, 'origin', '["origin.ip","target.ip","log.panOSThreatID"]', '[]');
INSERT INTO public.utm_correlation_rules VALUES (1047, 'DNS Cache Poisoning Attempt', 3, 3, 2, 'Resource Development', 'T1584.002 - Acquire Infrastructure: DNS Server', 'Detects potential DNS cache poisoning attempts where multiple DNS responses are received from different sources for the same domain in a short time window, which could indicate an attacker trying to inject malicious DNS records.

Next Steps:
1. Verify the legitimacy of the DNS responses by checking the source IP addresses
2. Review DNS query logs to identify the original query that triggered these responses
3. Check if the responding IP addresses match known legitimate DNS servers
4. Examine the timing patterns of the responses to identify potential spoofing
5. Verify DNS server configurations and check for unauthorized DNS server additions
6. Monitor for subsequent DNS queries to verify if poisoned cache entries are being used
7. Consider implementing DNS security measures like DNSSEC if not already in place
', '["https://help.mikrotik.com/docs/spaces/ROS/pages/37748767/DNS","https://attack.mitre.org/techniques/T1584/002/"]', 'safe("log.topics", "") == "dns" && safe("target.port", 0.0) == 53 && safe("origin.ip", "") != "" && safe("log.chain", "").contains("response")', '2025-09-04 15:28:31.540527', true, false, 'origin', '["target.ip","origin.ip"]', '[{"indexPattern":"v11-log-mikrotik-fw-*","with":[{"field":"target.ip.keyword","operator":"filter_term","value":"{{.target.ip}}"},{"field":"log.topics.keyword","operator":"filter_term","value":"dns"}],"or":null,"within":"now-5m","count":10}]');
INSERT INTO public.utm_correlation_rules VALUES (1474, 'Windows Defender: ERROR: RESCAN REQUIRED', 1, 2, 3, 'Potentially Compromised System', 'User Execution', 'Detects the ''REMOVE NOT SUPPORTED'' error event in Windows Defender, which may indicate that a removal operation is not supported for a specific threat.', '["https://learn.microsoft.com/en-us/windows/security/threat-protection/windows-defender-antivirus/troubleshoot"]', 'safe("log.winlogEventDataLogName", "") == "Microsoft-Windows-Windows Defender/Operational" &&  safe("log.winlogEventDataErrorCode", "") == "0x80508029"', '2025-09-04 21:12:14.678506', true, false, 'target', NULL, '[]');
INSERT INTO public.utm_correlation_rules VALUES (1034, 'SaaS Security Alert Detection', 3, 3, 2, 'Discovery', 'T1526 - Cloud Service Discovery', 'Detects security alerts from Palo Alto SaaS Security platform including data exposure, unauthorized access, and policy violations in cloud applications. This rule identifies when SaaS applications generate security-related events that may indicate compromised accounts, data breaches, or policy violations.

Next Steps:
1. Review the specific SaaS application and user involved in the alert
2. Examine the nature of the security violation or threat detected
3. Check for additional suspicious activity from the same user or application
4. Verify if the activity aligns with normal business operations
5. Consider temporarily restricting access to the affected SaaS application if necessary
6. Coordinate with the application owner to understand the context
7. Review SaaS security policies and update if needed
', '["https://docs.paloaltonetworks.com/saas-security/saas-security-admin","https://attack.mitre.org/techniques/T1526/"]', 'safe("log.is_saas_of_app", "") == "yes" && (safe("log.category", "").contains("security") || safe("log.category", "").contains("threat") || safe("log.severity", "") == "high" || safe("log.panOSSeverity", "") == "high" || safe("log.subtype", "").contains("threat"))', '2025-09-04 15:26:55.752576', true, false, 'origin', '["log.app","origin.user"]', '[]');
INSERT INTO public.utm_correlation_rules VALUES (1039, 'MikroTik Address List Abuse', 3, 3, 3, 'Defense Evasion, Persistence, Privilege Escalation, Initial Access', 'T1078 - Valid Accounts', 'Detects suspicious activities related to MikroTik address lists including unauthorized modifications, excessive additions, or attempts to manipulate whitelist/blacklist entries which could indicate privilege escalation or security bypass attempts.

Next Steps:
1. Review the source IP and verify if it''s authorized to modify address lists
2. Check the specific address list modifications being performed
3. Correlate with user authentication logs to identify the user account
4. Verify if the changes align with approved network security policies
5. Check for any unauthorized access or compromised admin accounts
6. Review firewall logs for any unusual traffic patterns following the changes
', '["https://help.mikrotik.com/docs/spaces/ROS/pages/250708066/Firewall","https://attack.mitre.org/techniques/T1078/"]', '(safe("log.topics", "").contains("firewall") && 
 (safe("msg", "").contains("address-list add") ||
  safe("msg", "").contains("address-list remove") ||
  safe("msg", "").contains("address-list set") ||
  safe("msg", "").contains("src-address-list") ||
  safe("msg", "").contains("dst-address-list") &&
 (safe("log.action", "") in ["add", "remove", "set"] ||
  safe("msg", "").contains("whitelist") ||
  safe("msg", "").contains("blacklist") ||
  safe("msg", "").contains("trusted") ||
  safe("msg", "").contains("allowed") ||
  safe("msg", "").contains("banned")) ||
(safe("log.chain", "") in ["input", "forward"] && 
 safe("msg", "").contains("address-list") &&
 safe("log.action", "") == "accept" &&
 safe("origin.ip", "") != "" &&
 !(safe("origin.ip", "").startsWith("192.168.")) &&
 !(safe("origin.ip", "").startsWith("10.")) &&
 !(safe("origin.ip", "").startsWith("172.")))
', '2025-09-04 15:28:27.15273', true, false, 'origin', '["origin.ip","lastEvent.raw"]', '[{"indexPattern":"v11-log-mikrotik-*","with":[{"field":"origin.ip.keyword","operator":"filter_term","value":"{{.origin.ip}}"},{"field":"log.topics.keyword","operator":"filter_term","value":"firewall"}],"or":null,"within":"now-15m","count":10}]');
INSERT INTO public.utm_correlation_rules VALUES (1035, 'User Behavior Analytics Anomaly Detected', 3, 2, 1, 'Defense Evasion, Persistence, Privilege Escalation, Initial Access', 'T1078 - Valid Accounts', 'Detects anomalous user behavior patterns identified by Palo Alto''s User Behavior Analytics engine. This includes unusual access patterns, abnormal data transfers, or suspicious authentication activities that deviate from established baselines.

Next Steps:
1. Review the specific anomaly details in the Palo Alto firewall logs
2. Investigate the user''s recent activity patterns and compare with historical behavior
3. Check for any concurrent authentication failures or privilege escalation attempts
4. Verify if the user''s account credentials have been compromised
5. Review network traffic patterns from the user''s source IP address
6. Consider implementing additional monitoring for this user account
7. Contact the user to verify if the flagged activities are legitimate
', '["https://docs.paloaltonetworks.com/cortex/cortex-xdr/cortex-xdr-analytics-guide/analytics-concepts/user-behavior-analytics","https://attack.mitre.org/techniques/T1078/"]', '(safe("log.panOSThreatCategory", "").contains("anomaly") ||
 safe("log.panOSThreatCategory", "").contains("behavior") ||
 safe("log.msg", "").contains("user-behavior") ||
 safe("log.msg", "").contains("anomalous-activity")) &&
safe("origin.user", "") != "" &&
safe("log.panOSSeverity", "").in(["high", "critical", "medium"])
', '2025-09-04 15:26:56.288985', true, false, 'origin', '["adversary.user","log.panOSThreatCategory"]', '[{"indexPattern":"v11-log-firewall-paloalto-*","with":[{"field":"origin.user.keyword","operator":"filter_term","value":"{{.origin.user}}"}],"or":null,"within":"now-1h","count":3}]');
INSERT INTO public.utm_correlation_rules VALUES (1036, 'WildFire Malware Detection', 3, 3, 2, 'Execution', 'T1204.002 - User Execution: Malicious File', 'Detects when WildFire identifies malicious files or malware based on threat analysis. This rule triggers on files with malicious verdicts from WildFire''s advanced analysis engine, indicating potential malware execution or file-based threats.

Next Steps:
1. Immediately isolate the affected host to prevent lateral movement
2. Review the file hash and name from the WildFire report
3. Check if the file was executed or just downloaded
4. Investigate user activity around the time of detection
5. Scan other systems for the same file hash
6. Review email logs if the file came via email attachment
7. Update security policies to prevent similar threats
8. Consider forensic analysis of the affected system
', '["https://docs.paloaltonetworks.com/advanced-wildfire/administration/advanced-wildfire-overview","https://attack.mitre.org/techniques/T1204/002/"]', 'safe("log.pa_type", "") == "THREAT" && safe("log.pa_subtype", "") == "wildfire" && safe("log.severityLabel", "") in ["high", "critical"] && safe("action", "") in ["alert", "block", "deny"]', '2025-09-04 15:26:56.836211', true, false, 'origin', '["target.host","target.ip","safe(\"log.pa_threatid\", \"\")"]', '[]');
INSERT INTO public.utm_correlation_rules VALUES (1037, 'Zero-Day Exploit Prevention', 3, 3, 3, 'Execution', 'T1203 - Exploitation for Client Execution', 'Detects potential zero-day exploits blocked by Palo Alto''s threat prevention engine. This rule triggers on high-severity vulnerability attempts and unknown threat patterns that may indicate zero-day exploit attempts. The rule looks for THREAT type events with vulnerability or exploit subtypes that have high or critical severity, and either contain CVE references or are categorized as unknown threats.

Next Steps:
1. Investigate the source IP address and determine if it''s internal or external
2. Review the specific threat ID and vulnerability details in Palo Alto logs
3. Check if the exploit attempt was successful or blocked
4. Analyze network traffic patterns from the source IP for additional malicious activity
5. Update threat prevention signatures if a new zero-day is confirmed
6. Consider blocking the source IP if it shows persistent malicious behavior
7. Review and strengthen endpoint security on potentially targeted systems
', '["https://docs.paloaltonetworks.com/threat-prevention/administration/best-practices/best-practices-for-securing-your-network-from-layer-4-and-layer-7-evasions/evasion-signatures","https://attack.mitre.org/techniques/T1203/"]', 'safe("log.pa_type", "") == "THREAT" && safe("log.pa_subtype", "") in ["vulnerability", "exploit"] && safe("log.severityLabel", "") in ["high", "critical"] && (safe("log.pa_threatid", "") contains "CVE" || safe("log.category", "") == "unknown")', '2025-09-04 15:26:57.33987', true, false, 'origin', '["origin.ip","target.ip"]', '[{"indexPattern":"v11-log-firewall-paloalto-*","with":[{"field":"origin.ip.keyword","operator":"filter_term","value":"{{.origin.ip}}"},{"field":"log.pa_type.keyword","operator":"filter_term","value":"THREAT"}],"or":null,"within":"now-30m","count":2}]');
INSERT INTO public.utm_correlation_rules VALUES (1038, 'Zone Protection Alerts', 2, 3, 3, 'Initial Access', 'T1190 - Exploit Public-Facing Application', 'Detects zone protection profile violations on Palo Alto firewall, indicating potential network-based attacks or reconnaissance attempts. Zone protection profiles help defend against various packet-based attacks including floods, reconnaissance, and packet anomalies.

**Next Steps:**
1. Review the specific threat ID and category to understand the attack type
2. Investigate the source IP for additional malicious activity
3. Check if this is part of a coordinated attack from multiple sources
4. Verify zone protection profile settings are appropriate for the network segment
5. Consider blocking the source IP if confirmed malicious
6. Review firewall logs for any successful connections from the same source
', '["https://docs.paloaltonetworks.com/pan-os/10-2/pan-os-admin/zone-protection-and-dos-protection/zone-defense","https://attack.mitre.org/techniques/T1190/"]', 'safe("log.type", "") == "THREAT" && safe("log.threatid", "") != "" && safe("log.category", "") == "packet-based-attack" && safe("origin.ip", "") != ""', '2025-09-04 15:26:57.932112', true, false, 'origin', '["adversary.ip","log.threatid"]', '[]');
INSERT INTO public.utm_correlation_rules VALUES (1387, 'Windows: Suspicious Cmd Execution via WMI', 1, 2, 3, 'Execution', 'Windows Management Instrumentation', 'Identifies suspicious command execution (cmd) via Windows Management Instrumentation (WMI) on a remote host. This could be indicative of adversary lateral movement.', '["https://attack.mitre.org/tactics/TA0002/","https://attack.mitre.org/techniques/T1047/"]', 'safe("log.eventDataParentProcessName", "").contains("WmiPrvSE.exe") && safe("log.eventDataProcessName", "").contains("cmd.exe") && safe("log.message", "").contains("\\\\127.0.0.1\\") && safe("log.message", "").matches("(2>&1|1>)")', '2025-09-04 20:45:19.980489', true, false, 'origin', NULL, '[]');
INSERT INTO public.utm_correlation_rules VALUES (1061, 'MikroTik Scheduler Abuse Detection', 3, 3, 2, 'Execution, Persistence, Privilege Escalation', 'T1053 - Scheduled Task/Job', 'Detects potential abuse of MikroTik scheduler functionality which could be used for persistence or privilege escalation. Monitors for suspicious scheduler-related activities including creation, modification, or execution of scheduled tasks with system-level privileges.

Next Steps:
1. Review the specific scheduler task that was added, changed, or removed
2. Verify the legitimacy of the administrative action through change management records
3. Check if the scheduler modification was performed by authorized personnel
4. Examine the script content or commands associated with the scheduler task
5. Monitor for any subsequent suspicious activities from the same source IP
6. Review MikroTik device configuration changes for unauthorized modifications
', '["https://help.mikrotik.com/docs/display/ROS/Scheduler","https://attack.mitre.org/techniques/T1053/"]', 'safe("log.topics", "").contains("system") && safe("log.topics", "").contains("info") && (safe("log.restData", "").contains("scheduler") || safe("log.restData", "").contains("script")) && (safe("log.restData", "").contains("added") || safe("log.restData", "").contains("changed") || safe("log.restData", "").contains("removed"))', '2025-09-04 15:29:44.140242', true, false, 'origin', '["origin.ip"]', '[]');
INSERT INTO public.utm_correlation_rules VALUES (1040, 'MikroTik API Unauthorized Access Attempts', 3, 3, 2, 'Defense Evasion, Persistence, Privilege Escalation, Initial Access', 'T1078 - Valid Accounts', 'Detects unauthorized access attempts to MikroTik API service on ports 8728 (API) or 8729 (API-SSL). Multiple connection attempts from external sources may indicate reconnaissance or exploitation attempts against the API service.

Next Steps:
1. Verify the legitimacy of the source IP attempting API access
2. Check if the API access is from authorized management networks
3. Review MikroTik device logs for successful authentication attempts
4. Consider implementing IP restrictions for API access
5. Monitor for any configuration changes made through the API
6. If unauthorized, block the source IP and review API security settings
', '["https://help.mikrotik.com/docs/spaces/ROS/pages/2228226/API","https://attack.mitre.org/techniques/T1078/"]', '(safe("target.port", 0.0) == 8728 || safe("target.port", 0.0) == 8729 || safe("origin.port", 0.0) == 8728 || safe("origin.port", 0.0) == 8729) && safe("origin.ip", "") != "" && safe("protocol", "") == "tcp" && (safe("log.chain", "").contains("input") || safe("log.restData", "").contains("drop")))', '2025-09-04 15:28:27.660719', true, false, 'origin', '["origin.ip","target.port"]', '[{"indexPattern":"v11-log-firewall-mikrotik-*","with":[{"field":"origin.ip.keyword","operator":"filter_term","value":"{{.origin.ip}}"},{"field":"target.port","operator":"filter_term","value":"8728"}],"or":[{"indexPattern":"v11-log-firewall-mikrotik-*","with":[{"field":"origin.ip.keyword","operator":"filter_term","value":"{{.origin.ip}}"},{"field":"target.port","operator":"filter_term","value":"8729"}],"or":null,"within":"now-15m","count":20}],"within":"now-15m","count":20}]');
INSERT INTO public.utm_correlation_rules VALUES (1041, 'MikroTik Backup File Access', 3, 2, 1, 'Collection', 'T1560 - Archive Collected Data', 'Backup file access detected on MikroTik device, which could indicate unauthorized attempts to access or exfiltrate backup configurations. This activity may represent an attempt to steal sensitive configuration data or credentials stored in device backups.

Next Steps:
1. Verify if the backup operation was authorized and performed by legitimate administrators
2. Check the source IP address for suspicious activity or unauthorized access patterns
3. Review recent authentication logs for the device to identify the user who performed the backup
4. Examine the timing of backup operations - operations outside business hours may be suspicious
5. Validate that proper backup retention and security policies are in place
6. Consider implementing additional access controls for backup operations
', '["https://help.mikrotik.com/docs/spaces/ROS/pages/328094/Log","https://attack.mitre.org/techniques/T1560/"]', 'safe("log.topics", "").matches(".*system.*") && (safe("log.message", "").matches(".*backup.*create.*") || safe("log.message", "").matches(".*backup.*download.*") || safe("log.message", "").matches(".*backup.*restore.*") || safe("log.message", "").matches(".*\\.backup.*") && safe("origin.ip", "") != ""', '2025-09-04 15:28:28.17046', true, false, 'origin', '["adversary.ip"]', '[]');
INSERT INTO public.utm_correlation_rules VALUES (1042, 'MikroTik Bandwidth Limit Bypass Attempt', 1, 2, 3, 'Impact', 'T1496 - Resource Hijacking', 'Detects attempts to bypass bandwidth limitations on MikroTik devices through various techniques including packet fragmentation, protocol manipulation, or excessive packet sizes that may indicate attempts to circumvent QoS policies. This rule identifies suspicious traffic patterns that could indicate bandwidth limit evasion attempts.

Next Steps:
1. Verify the source IP and investigate if this is legitimate traffic
2. Review current QoS and bandwidth policies on the MikroTik device
3. Check for any recent configuration changes to firewall or mangle rules
4. Monitor the source for sustained high bandwidth usage patterns
5. Consider implementing stricter rate limiting or connection limits for the offending source
6. Review firewall logs for additional suspicious activity from the same source
', '["https://help.mikrotik.com/docs/spaces/ROS/pages/120324137/Firewall+and+QoS+Case+Studies","https://attack.mitre.org/techniques/T1496/"]', '(safe("log.len", 0.0) > double(1450) && safe("log.proto", "") == "tcp" && safe("origin.port", 0.0) > double(1024)) || (safe("log.topics", "") != "" && (safe("log.topics", "").contains("firewall") || safe("log.topics", "").contains("mangle")) && safe("log.message", "") != "" && (safe("log.message", "").contains("bandwidth exceeded") || safe("log.message", "").contains("rate limit") || safe("log.message", "").contains("max-limit") || safe("log.message", "").contains("burst-limit")) || (safe("log.chain", "") in ["forward", "output"] && safe("log.len", 0.0) == double(1500) && safe("log.proto", "") == "udp")', '2025-09-04 15:28:28.768899', true, false, 'origin', '["origin.ip"]', '[]');
INSERT INTO public.utm_correlation_rules VALUES (1043, 'Bridge Security Issue Detected', 3, 3, 3, 'Defense Evasion', 'T1599 - Network Boundary Bridging', 'Detects potential bridge security issues including MAC flooding, STP manipulation, or unauthorized bridge port activity that could indicate network segmentation bypass attempts or Layer 2 attacks against network infrastructure.

Next Steps:
1. Investigate the source MAC address and determine if it''s a legitimate device
2. Check bridge port configurations and verify authorized devices
3. Review network topology for potential segmentation bypass
4. Examine STP configuration and verify root bridge settings
5. Monitor for additional bridge-related anomalies from the same source
6. Consider implementing port security measures if unauthorized activity is confirmed
', '["https://help.mikrotik.com/docs/spaces/ROS/pages/328353/Securing+your+router","https://attack.mitre.org/techniques/T1599/"]', 'safe("log.topics", "") == "bridge" && (safe("log.chain", "").contains("loop") || safe("log.chain", "").contains("flood") || safe("log.action", "") == "drop" || safe("log.proto", "").contains("stp"))', '2025-09-04 15:28:29.313742', true, false, 'origin', '["origin.mac","log.chain"]', '[]');
INSERT INTO public.utm_correlation_rules VALUES (1044, 'MikroTik Configuration Export Activity', 3, 1, 1, 'Collection', 'T1602 - Data from Configuration Repository', 'Configuration export activity detected on MikroTik device, which could indicate unauthorized attempts to steal device configuration. This activity may be part of reconnaissance or data collection efforts by attackers seeking to understand network infrastructure and security controls.

Next Steps:
1. Verify if the configuration export was authorized and performed by legitimate administrators
2. Check the source IP address and determine if it''s from a trusted management network
3. Review recent authentication logs for the device to identify the user who performed the export
4. Examine the timing of the export activity - was it during business hours or maintenance windows?
5. Check for any subsequent suspicious activities from the same source IP
6. Verify the integrity of the exported configuration and ensure no sensitive information was compromised
7. Review firewall rules and access controls to prevent unauthorized configuration access
', '["https://help.mikrotik.com/docs/spaces/ROS/pages/328094/Log","https://attack.mitre.org/techniques/T1602/"]', 'safe("log.topics", "").matches(".*system.*info.*") && (safe("log.msg", "").matches(".*export.*config.*") || safe("log.msg", "").matches(".*configuration.*export.*") || safe("log.msg", "").matches(".*/export.*") || safe("log.restData", "").matches(".*export.*config.*")) && safe("origin.ip", "") != ""', '2025-09-04 15:28:29.910088', true, false, 'origin', '["origin.ip"]', '[]');
INSERT INTO public.utm_correlation_rules VALUES (1045, 'MikroTik Connection Limit Violation', 1, 2, 3, 'Impact', 'T1499 - Endpoint Denial of Service', 'Detects violations of connection limits on MikroTik devices, including attempts to exceed maximum concurrent connections, connection rate limits, or connection tracking table exhaustion which could indicate DoS attacks or resource exhaustion attempts.

Next Steps:
1. Review the source IP and determine if it''s legitimate traffic or an attack
2. Check MikroTik device performance metrics and connection table utilization
3. Examine network traffic patterns from the source IP for anomalies
4. Consider implementing rate limiting or blocking the source IP if malicious
5. Review firewall rules and connection limits configuration
6. Monitor for additional connection limit violations from the same or different sources
', '["https://help.mikrotik.com/docs/spaces/ROS/pages/130220087/Connection+tracking","https://attack.mitre.org/techniques/T1499/"]', '(safe("log.topics", "").contains("firewall") && safe("log.msg", "").contains_any(["connection limit", "conn-limit", "connection tracking", "conntrack full", "max connections", "connection overflow"])) || (safe("log.chain", "") == "input" && safe("log.action", "") == "drop" && safe("log.msg", "").contains_any(["new", "established"]) && safe("log.proto", "") == "tcp") || (safe("log.topics", "").contains("system") && safe("log.msg", "").contains_any(["connection table full", "tracking table overflow"]))', '2025-09-04 15:28:30.443256', true, false, 'origin', '["adversary.ip"]', '[]');
INSERT INTO public.utm_correlation_rules VALUES (1046, 'MikroTik DHCP Server Attack', 2, 3, 3, 'Credential Access, Collection', 'T1557 - Adversary-in-the-Middle', 'Detects potential DHCP server attacks including rogue DHCP server deployment, DHCP exhaustion attempts, or unauthorized DHCP configuration changes that could lead to man-in-the-middle attacks or network disruption. These attacks can compromise network integrity by intercepting traffic or causing denial of service.

Next Steps:
1. Verify if the source IP is an authorized DHCP server in your network
2. Check DHCP server logs for unusual lease patterns or exhaustion
3. Monitor for rogue DHCP responses from unauthorized devices
4. Review network topology for unauthorized devices offering DHCP services
5. Implement DHCP snooping and trusted port configurations
6. Check for DHCP lease depletion and unusual discovery patterns
', '["https://timigate.com/2018/05/enable-rogue-dhcp-detection-on-mikrotik-routeros.html","https://attack.mitre.org/techniques/T1557/"]', '(safe("log.topics", "").contains("dhcp") && (safe("log.restData", "").contains("deauth") || safe("log.restData", "").contains("no more free") || safe("log.restData", "").contains("offering") || safe("log.restData", "").contains("discover")) || (safe("log.topics", "").contains("system") && safe("log.restData", "").contains("dhcp") && (safe("log.restData", "").contains("server") || safe("log.restData", "").contains("pool")))', '2025-09-04 15:28:31.000079', true, false, 'origin', '["adversary.ip","target.ip"]', '[]');
INSERT INTO public.utm_correlation_rules VALUES (1049, 'MikroTik Firmware Vulnerability Exploitation Attempt', 3, 3, 3, 'Initial Access', 'T1190 - Exploit Public-Facing Application', 'Detects potential exploitation attempts targeting known MikroTik firmware vulnerabilities including buffer overflows, authentication bypasses, remote code execution attempts, or suspicious system calls that may indicate compromise. This rule monitors for exploitation patterns in MikroTik firewall logs targeting common vulnerability indicators and suspicious network activity on management ports.

Next Steps:
1. Immediately investigate the source IP address for malicious activity
2. Review MikroTik device logs for signs of successful compromise
3. Check if the targeted ports (8291, 8728, 8729, 80, 443) are properly secured
4. Verify current firmware version and apply security patches if available
5. Monitor for lateral movement from the compromised device
6. Consider blocking the source IP if confirmed malicious
7. Review authentication logs for successful admin access attempts
', '["https://cve.mitre.org/cgi-bin/cvekey.cgi?keyword=mikrotik","https://attack.mitre.org/techniques/T1190/"]', '(safe("log.topics", "") == "system" || safe("log.topics", "").contains("firewall") || safe("log.topics", "").contains("critical")) && (safe("log.message", "").lower().contains("buffer overflow") || safe("log.message", "").lower().contains("segmentation fault") || safe("log.message", "").lower().contains("stack overflow") || (safe("log.message", "").lower().contains("authentication") && safe("log.message", "").lower().contains("bypass")) || safe("log.message", "").lower().contains("invalid memory") || safe("log.message", "").lower().contains("code injection") || safe("log.message", "").lower().contains("command injection") || (safe("log.message", "").lower().contains("script") && safe("log.message", "").lower().contains("error")) || safe("log.message", "").lower().contains("/nova/bin/") || safe("log.message", "").lower().contains("jailbreak") || (safe("log.message", "").lower().contains("exploit") || safe("log.message", "").lower().contains("payload"))) || (safe("log.chain", "") != "" && (safe("log.chain", "").lower().contains("input") || safe("log.chain", "").lower().contains("forward")) && safe("log.srcPort", 0.0) > 0 && (safe("log.dstPort", 0.0) == 8291 || safe("log.dstPort", 0.0) == 8728 || safe("log.dstPort", 0.0) == 8729 || safe("log.dstPort", 0.0) == 80 || safe("log.dstPort", 0.0) == 443))', '2025-09-04 15:29:04.771157', true, false, 'origin', '["log.srcIp","log.dstPort"]', '[]');
INSERT INTO public.utm_correlation_rules VALUES (1050, 'MikroTik FTP Brute Force Attack', 3, 3, 2, 'Credential Access', 'T1110 - Brute Force', 'Multiple failed FTP login attempts detected on MikroTik device, indicating potential brute force attack against FTP service. This rule triggers when 5 or more failed FTP login attempts are detected from the same source IP within 15 minutes.

Next Steps:
1. Review FTP access logs for the source IP address
2. Check if the IP address is known or suspicious
3. Consider blocking the source IP if it''s malicious
4. Review FTP service configuration and security settings
5. Verify if any legitimate users are affected by account lockouts
6. Consider implementing stronger authentication mechanisms
', '["https://help.mikrotik.com/docs/spaces/ROS/pages/328094/Log","https://attack.mitre.org/techniques/T1110/"]', 'safe("log.topics", "").matches(".*system.*error.*") && safe("log.message", "").matches(".*login failure.*ftp.*") && safe("origin.ip", "") != ""', '2025-09-04 15:29:05.315874', true, false, 'origin', '["origin.ip"]', '[{"indexPattern":"v11-log-firewall-mikrotik-*","with":[{"field":"origin.ip.keyword","operator":"filter_term","value":"{{.origin.ip}}"},{"field":"log.message","operator":"filter_match","value":"login failure ftp"}],"or":null,"within":"now-15m","count":5}]');
INSERT INTO public.utm_correlation_rules VALUES (1475, 'Windows Defender: ERROR: BAD DB: SCAN ABORTED', 1, 2, 3, 'Potentially Compromised System', 'User Execution', 'Detects the ''SCAN ABORTED'' error event in Windows Defender, which may indicate that a removal operation is not supported for a specific threat.', '["https://learn.microsoft.com/en-us/windows/security/threat-protection/windows-defender-antivirus/troubleshoot"]', 'safe("log.winlogEventDataLogName", "") == "Microsoft-Windows-Windows Defender/Operational" &&  safe("log.winlogEventDataErrorCode", "") == "0x80508018"', '2025-09-04 21:12:15.034993', true, false, 'target', NULL, '[]');
INSERT INTO public.utm_correlation_rules VALUES (1060, 'MikroTik Routing Table Attack', 2, 3, 3, 'Resource Development', 'T1584 - Compromise Infrastructure: Domains', 'Detects potential routing table manipulation attacks including unauthorized route additions, deletions, or modifications that could redirect traffic through malicious paths or cause network disruption. Attackers may manipulate routing tables to intercept traffic, redirect communications, or create denial of service conditions.

Next Steps:
1. Investigate the source IP and verify if the routing changes were authorized
2. Review all recent routing table modifications and compare with change management records
3. Check for additional suspicious network configuration changes on the same device
4. Verify network traffic flows to ensure no traffic redirection has occurred
5. Review admin access logs to identify who made the routing changes
6. Consider implementing change control mechanisms for critical network infrastructure
', '["https://help.mikrotik.com/docs/spaces/ROS/pages/328094/Log","https://attack.mitre.org/techniques/T1584/"]', 'safe("log.topics", "").contains("system") && (safe("log.message", "").contains("route") || safe("log.message", "").contains("routing")) && (safe("log.message", "").contains("added") || safe("log.message", "").contains("changed") || safe("log.message", "").contains("removed") || safe("log.message", "").contains("table"))', '2025-09-04 15:29:43.568307', true, false, 'origin', '["origin.ip"]', '[]');
INSERT INTO public.utm_correlation_rules VALUES (1048, 'MikroTik Firewall Rule Bypass Attempt', 3, 3, 2, 'Defense Evasion', 'T1562.004 - Impair Defenses: Disable or Modify Tools', 'Detects attempts to bypass MikroTik firewall rules through various methods including Winbox port exploitation (CVE-2019-3924), unauthorized rule modifications, or suspicious connection patterns that indicate firewall evasion techniques. This rule identifies potential attackers attempting to circumvent network security controls by exploiting MikroTik RouterOS vulnerabilities or manipulating firewall configurations.

Next Steps:
1. Immediately review the source IP address and verify if it''s authorized to access the MikroTik device
2. Check MikroTik device logs for any unauthorized configuration changes or rule modifications
3. Verify if Winbox service (port 8291) should be accessible from the detected source IP
4. Review current firewall rules for any recent unauthorized changes or disabled rules
5. Check for signs of CVE-2019-3924 exploitation if Winbox access is detected
6. Monitor for additional suspicious network activity from the same source IP
7. Consider implementing additional access controls or updating RouterOS firmware if vulnerabilities are confirmed
8. Document the incident and implement network segmentation if breach is confirmed
', '["https://medium.com/tenable-techblog/mikrotik-firewall-nat-bypass-b8d46398bf24","https://attack.mitre.org/techniques/T1562/004/"]', '(safe("target.port", 0.0) == 8291 && safe("origin.ip", "") != "" && safe("log.chain", "").contains("input")) || (safe("log.topics", "").contains("firewall") && safe("log.restData", "").contains("rule") && (safe("log.message", "").contains("removed") || safe("log.message", "").contains("disabled"))) || (safe("log.message", "").contains("drop") && safe("target.port", 0.0) in [5678, 20561])', '2025-09-04 15:28:32.076167', true, false, 'origin', '["origin.ip","target.port"]', '[{"indexPattern":"v11-log-firewall-mikrotik-*","with":[{"field":"origin.ip.keyword","operator":"filter_term","value":"{{.origin.ip}}"}],"or":null,"within":"now-10m","count":5}]');
INSERT INTO public.utm_correlation_rules VALUES (1296, 'Windows: Multiple Vault Web Credentials Read', 2, 3, 2, 'Credential Access', 'Windows Credential Manager', 'Windows Credential Manager allows you to create, view, or delete saved credentials for signing into websites, connected applications, and networks. An adversary may abuse this to list or dump credentials stored in the Credential Manager for saved usernames and passwords. This may also be performed in preparation of lateral movement.', '["https://attack.mitre.org/tactics/TA0006/","https://attack.mitre.org/techniques/T1555/004/"]', 'safe("log.eventCode", 0.0) == double(5382) && safe("log.winlogEventDataSubjectLogonId", "") != "0x3e7" && safe("log.winlogEventDataSchemaFriendlyName", "").contains("Windows Web Password Credential") || safe("log.winlogEventDataResource", "").contains("http")', '2025-09-04 20:05:57.119601', true, false, 'origin', NULL, '[{"indexPattern":"v11-log-wineventlog-*","with":[{"field":"log.winlogEventDataProcessPid.keyword","operator":"filter_term","value":"{{.log.winlogEventDataProcessPid}}"},{"field":"log.eventCode","operator":"filter_term","value":"5382"},{"field":"log.winlogEventDataSubjectLogonId.keyword","operator":"filter_not_match","value":"0x3e7"}],"or":[{"indexPattern":"v11-log-wineventlog-*","with":[{"field":"log.winlogEventDataSchemaFriendlyName.keyword","operator":"filter_term","value":"Windows Web Password Credential"},{"field":"log.winlogEventDataResource.keyword","operator":"filter_term","value":"http"}],"or":null,"within":"now-60s","count":1}],"within":"now-60s","count":1}]');
INSERT INTO public.utm_correlation_rules VALUES (1297, 'Windows: A scheduled task was created', 2, 3, 2, 'Persistence', 'Scheduled Task', 'Indicates the creation of a scheduled task using Windows event logs. Adversaries can use these to establish persistence, move laterally, and/or escalate privileges.', '["https://attack.mitre.org/tactics/TA0003/","https://attack.mitre.org/techniques/T1053/005/"]', 'safe("action", "").contains("scheduled-task-created") && safe("log.winlogEventDataTaskName", "").matches("(\\\\OneDrive Standalone Update Task-S-1-5-21|\\\\Hewlett-Packard\\\\HP Web Products Detection|\\\\Hewlett-Packard\\\\HPDeviceCheck)") && !(safe("target.user", "").matches("\\$$"))', '2025-09-04 20:05:57.699998', true, false, 'origin', NULL, '[]');
INSERT INTO public.utm_correlation_rules VALUES (1298, 'Windows: Outbound Scheduled Task Activity via PowerShell', 2, 3, 2, 'Execution', 'Scheduled Task', 'Identifies the PowerShell process loading the Task Scheduler COM DLL followed by an outbound RPC network connection within a short time period. This may indicate lateral movement or remote discovery via scheduled tasks.', '["https://attack.mitre.org/tactics/TA0002/","https://attack.mitre.org/techniques/T1053/005/"]', 'safe("log.winlogEventDataProcessName", "") in [''powershell.exe'', ''pwsh.exe'', ''powershell_ise.exe''] && safe("log.message", "").matches("(powershell.exe|pwsh.exe|powershell_ise.exe)")', '2025-09-04 20:06:22.42722', true, false, 'origin', NULL, '[]');
INSERT INTO public.utm_correlation_rules VALUES (1388, 'Windows: Potential Credential Access via Renamed COM+ Services DLL', 3, 3, 2, 'Credential Access', 'OS Credential Dumping', 'Identifies suspicious renamed COMSVCS.DLL Image Load, which exports the MiniDump function that can be used to dump a process memory. This may indicate an attempt to dump LSASS memory while bypassing command-line based detection in preparation for credential access.', '["https://attack.mitre.org/tactics/TA0006/","https://attack.mitre.org/techniques/T1003/001/"]', 'safe("log.winlogEventCategory", "").contains("process") && safe("log.winlogEventProcessName", "").contains("rundll32.exe") && safe("log.winlogEventDataset", "").matches("(windows.sysmon_operational)") && safe("log.winlogEventId", "") == ''7'' && safe("log.winlogFileName", "") != ''COMSVCS.DLL'' && (safe("log.winlogFilePeOriginalFileName", "").matches("(COMSVCS.DLL)") || safe("log.winlogFilePeImphash", "").matches("(EADBCCBB324829ACB5F2BBE87E5549A8)"))', '2025-09-04 20:45:20.647582', true, false, 'origin', NULL, '[{"indexPattern":"v11-log-wineventlog-*","with":[{"field":"log.winlogProcessEntityId.keyword","operator":"filter_term","value":"{{.log.winlogProcessEntityId}}"},{"field":"log.winlogEventCategory.keyword","operator":"filter_term","value":"process"}],"or":null,"within":"now-5m","count":3}]');
INSERT INTO public.utm_correlation_rules VALUES (1300, 'Windows: A scheduled task was updated', 1, 3, 2, 'Persistence', 'Scheduled Task', 'Indicates the update of a scheduled task using Windows event logs. Adversaries can use these to establish persistence, by changing the configuration of a legit scheduled task. Some changes such as disabling or enabling a scheduled task are common and may may generate noise.', '["https://attack.mitre.org/tactics/TA0003/","https://attack.mitre.org/techniques/T1053/005/"]', 'safe("action", "").contains("scheduled-task-updated") && !safe("target.user", "").matches("(\\$$)") && safe("log.winlogEventDataTaskName", "").matches("(\\\\User_Feed_Synchronization-|\\\\OneDrive Reporting Task-S-1-5-21|\\\\Hewlett-Packard\\\\HP Web Products Detection|\\\\Hewlett-Packard\\\\HPDeviceCheck)")', '2025-09-05 22:55:01.756321', true, false, 'origin', NULL, '[]');
INSERT INTO public.utm_correlation_rules VALUES (1051, 'MikroTik Critical Hardware Monitoring Alert', 1, 2, 3, 'Impact', 'T1496 - Resource Hijacking', 'Detects critical hardware monitoring alerts on MikroTik devices including high temperature, voltage issues, fan failures, or other hardware problems that could lead to system instability or failure.

**Next Steps:**
1. Check the physical status of the MikroTik device immediately
2. Verify environmental conditions (temperature, power supply, ventilation)
3. Review hardware health logs and system diagnostics
4. Check for any recent configuration changes or firmware updates
5. Consider emergency hardware replacement if critical failure is detected
6. Monitor device performance and stability
7. Review maintenance schedules and hardware warranties
', '["https://wiki.mikrotik.com/wiki/Manual:System/Health","https://attack.mitre.org/techniques/T1496/"]', '(safe("log.topics", "") == "system" || safe("log.topics", "").contains("health") || safe("log.topics", "").contains("critical")) && (safe("log.message", "").lower().contains("temperature") && (safe("log.message", "").lower().contains("high") || safe("log.message", "").lower().contains("critical") || safe("log.message", "").lower().contains("warning"))) || (safe("log.message", "").lower().contains("voltage") && (safe("log.message", "").lower().contains("low") || safe("log.message", "").lower().contains("high") || safe("log.message", "").lower().contains("unstable"))) || (safe("log.message", "").lower().contains("fan") && (safe("log.message", "").lower().contains("fail") || safe("log.message", "").lower().contains("stop") || safe("log.message", "").lower().contains("error"))) || (safe("log.message", "").lower().contains("power") && safe("log.message", "").lower().contains("supply")) || safe("log.message", "").lower().contains("hardware error")', '2025-09-04 15:29:05.890116', true, false, 'origin', '["adversary.host"]', '[]');
INSERT INTO public.utm_correlation_rules VALUES (1052, 'Hotspot Authentication Bypass Attempt', 3, 3, 2, 'Defense Evasion, Persistence, Privilege Escalation, Initial Access', 'Authentication Bypass', 'Detects potential hotspot authentication bypass attempts where clients are accessing network resources without proper authentication or using spoofed MAC addresses. This rule identifies suspicious hotspot activity including bypass attempts and dropped authentication requests.

Next Steps:
1. Investigate the source MAC address and IP for previous authentication attempts
2. Check hotspot configuration for security misconfigurations
3. Review network access logs for unauthorized resource access
4. Verify if the MAC address is authorized in the hotspot user database
5. Consider implementing additional MAC address filtering if bypass attempts persist
6. Review hotspot authentication logs for patterns of abuse
', '["https://help.mikrotik.com/docs/spaces/ROS/pages/328353/Securing+your+router","https://attack.mitre.org/techniques/T1078/"]', '(safe("log.topics", "") == "hotspot" && safe("log.chain", "").contains("bypass")) || (safe("log.topics", "") == "hotspot" && safe("action", "") == "drop" && safe("origin.mac", "") != "")', '2025-09-04 15:29:06.618244', true, false, 'origin', '["origin.mac","origin.ip"]', '[]');
INSERT INTO public.utm_correlation_rules VALUES (1053, 'MikroTik Layer 7 Protocol Exploit Attempt', 3, 2, 3, 'Initial Access', 'T1190 - Exploit Public-Facing Application', 'Detects attempts to exploit Layer 7 protocol filtering on MikroTik devices through malformed packets, protocol confusion attacks, or attempts to bypass application-layer filtering which could lead to unauthorized access or service disruption.

Next Steps:
1. Immediately review the source IP address and determine if it''s from a trusted network
2. Examine the specific Layer 7 protocol being targeted and the nature of the malformed packets
3. Check MikroTik firewall logs for additional related events from the same source
4. Verify current Layer 7 protocol filter rules and their effectiveness
5. Consider implementing additional rate limiting or blocking for the source IP
6. Review application logs on the target port to identify any successful exploitation attempts
7. Update Layer 7 protocol signatures if new attack patterns are identified
8. Monitor for lateral movement attempts if exploitation was successful
', '["https://help.mikrotik.com/docs/spaces/ROS/pages/250708064/Common+Firewall+Matchers+and+Actions","https://attack.mitre.org/techniques/T1190/"]', '(safe("log.topics", "").contains("firewall") && safe("log.message", "") in ["layer7-protocol", "l7-proto", "content", "tls-host"] && (safe("log.action", "") == "drop" || safe("log.message", "") in ["invalid", "malformed", "protocol error", "unexpected"])) || (safe("log.chain", "") in ["forward", "input"] && safe("log.proto", "") in ["tcp", "udp"] && safe("log.dstPort", 0.0) in [80, 443, 8080, 8443] && (safe("log.len", 0.0) < double(20) || safe("log.len", 0.0) > double(9000))) || (safe("log.message", "") in ["http", "https", "ssl", "tls"] && safe("log.action", "") == "drop" && safe("log.message", "") in ["pattern", "regex", "match"])', '2025-09-04 15:29:07.206528', true, false, 'origin', '["origin.ip","target.port"]', '[]');
INSERT INTO public.utm_correlation_rules VALUES (1054, 'MikroTik License Violation or Tampering Detected', 1, 3, 2, 'Defense Evasion', 'T1027.002 - Obfuscated Files or Information: Software Packing', 'Detects potential license violations, tampering attempts, or unauthorized license modifications on MikroTik devices. This could indicate attempts to bypass licensing restrictions or use pirated software.

Next Steps:
1. Verify the license status of the affected MikroTik device
2. Check if the device is using a legitimate license key
3. Review system logs for any unauthorized configuration changes
4. Ensure the device firmware is from official MikroTik sources
5. Investigate if the device has been compromised or tampered with
6. Contact MikroTik support if license issues persist
', '["https://help.mikrotik.com/docs/spaces/ROS/pages/328149/RouterOS+license+keys","https://attack.mitre.org/techniques/T1027/002/"]', '(safe("log.topics", "") == "system" || safe("log.topics", "").contains("system")) && ((safe("log.message", "").lower().contains("license") && (safe("log.message", "").lower().contains("invalid") || safe("log.message", "").lower().contains("expired") || safe("log.message", "").lower().contains("violation") || safe("log.message", "").lower().contains("trial") || safe("log.message", "").lower().contains("software id") || safe("log.message", "").lower().contains("system id")))', '2025-09-04 15:29:07.750943', true, false, 'origin', '["origin.mac"]', '[]');
INSERT INTO public.utm_correlation_rules VALUES (1055, 'MikroTik NAT Rule Manipulation', 2, 3, 1, 'Defense Evasion, Persistence, Command and Control', 'T1205 - Traffic Signaling', 'Detects suspicious NAT rule modifications that could indicate attempts to redirect traffic, expose internal services, or create unauthorized port forwards. Monitors for NAT masquerade issues and connection tracking table manipulation.

Next Steps:
- Review the specific NAT rule changes in the MikroTik configuration
- Verify if the changes were authorized and documented
- Check for any unusual network traffic patterns following the NAT changes
- Examine the source IP and user account that made the configuration changes
- Monitor for additional suspicious administrative activities on the device
- Validate that critical internal services are not unexpectedly exposed
', '["https://help.mikrotik.com/docs/spaces/ROS/pages/3211299/NAT","https://attack.mitre.org/techniques/T1205/"]', 'safe("log.topics", "").contains("system") && safe("log.message", "").contains("nat") && (safe("log.message", "").contains("rule added") || safe("log.message", "").contains("rule changed") || safe("log.message", "").contains("rule removed") || safe("log.message", "").contains("masquerade"))', '2025-09-04 15:29:08.274124', true, false, 'origin', '["origin.ip","origin.host"]', '[{"indexPattern":"v11-log-mikrotik-*","with":[{"field":"origin.ip.keyword","operator":"filter_term","value":"{{.origin.ip}}"},{"field":"log.topics.keyword","operator":"filter_term","value":"system"}],"or":null,"within":"now-30m","count":3}]');
INSERT INTO public.utm_correlation_rules VALUES (1056, 'MikroTik Netinstall Attempts Detected', 2, 3, 3, 'Defense Evasion', 'T1601 - Modify System Image', 'Detects attempts to use Netinstall on MikroTik devices, which could indicate an attempt to bypass security controls or install malicious firmware. Netinstall re-formats the system drive and reinstalls RouterOS, potentially allowing attackers to gain persistent access or install backdoors.

Next Steps:
1. Immediately investigate the source IP address attempting Netinstall
2. Verify if this is authorized maintenance activity
3. Check device physical access logs and security camera footage
4. Review network traffic for suspicious communications to/from the device
5. If unauthorized, isolate the affected device and examine for signs of compromise
6. Verify firmware integrity and check for unauthorized modifications
7. Review authentication logs for any suspicious access attempts
8. Consider implementing additional physical security controls for critical network devices
', '["https://help.mikrotik.com/docs/spaces/ROS/pages/24805390/Netinstall","https://attack.mitre.org/techniques/T1601/"]', '(safe("log.topics", "") == "system" || safe("log.topics", "").contains("system")) && ((safe("log.message", "").lower().contains("netinstall")) || (safe("log.message", "").lower().contains("pxe boot")) || (safe("log.message", "").lower().contains("bootp")) || (safe("log.message", "").lower().contains("tftp") && safe("log.message", "").lower().contains("boot")))', '2025-09-04 15:29:09.034523', true, false, 'origin', '["origin.ip"]', '[{"indexPattern":"v11-log-firewall-mikrotik-*","with":[{"field":"origin.ip.keyword","operator":"filter_term","value":"{{.origin.ip}}"}],"or":null,"within":"now-30m","count":3}]');
INSERT INTO public.utm_correlation_rules VALUES (1057, 'MikroTik Queue Manipulation Attempt', 1, 3, 3, 'Impact', 'T1496 - Resource Hijacking', 'Detects attempts to manipulate MikroTik queue configurations which could lead to bandwidth theft, QoS bypass, or denial of service. This includes unauthorized modifications to queue tree, simple queues, or queue types that could impact network performance.

Next Steps:
1. Verify if the queue modification was authorized by checking change management records
2. Review the specific queue changes made and assess their impact on network performance
3. Check if the source IP has legitimate administrative access to the MikroTik device
4. Monitor for additional configuration changes from the same source
5. If unauthorized, immediately review and restore proper queue configurations
6. Consider implementing additional access controls for queue management
7. Check for signs of bandwidth abuse or QoS policy violations
8. Review logs for other suspicious administrative activities from the same source
', '["https://help.mikrotik.com/docs/display/ROS/Queues","https://attack.mitre.org/techniques/T1496/"]', 'safe("log.topics", "").contains("queue") && (safe("log.message", "").contains("queue tree add") || safe("log.message", "").contains("queue simple add") || safe("log.message", "").contains("queue tree set") || safe("log.message", "").contains("queue simple set") || safe("log.message", "").contains("queue tree remove") || safe("log.message", "").contains("queue simple remove") || safe("log.message", "").contains("queue type set")', '2025-09-04 15:29:09.556271', true, false, 'origin', '["origin.ip","origin.host"]', '[]');
INSERT INTO public.utm_correlation_rules VALUES (1058, 'MikroTik Resource Exhaustion Attack Detected', 1, 2, 3, 'Impact', 'T1499 - Endpoint Denial of Service', 'Detects potential resource exhaustion attacks or conditions on MikroTik devices including high CPU usage, memory exhaustion, connection table overflow, or disk space issues that could indicate DoS attacks or system compromise.

Next Steps:
1. Verify the MikroTik device status and resource utilization
2. Check for unusual traffic patterns or connection spikes
3. Review firewall logs for suspicious activity from the source IP
4. Monitor system performance metrics and resource consumption
5. Consider implementing rate limiting or access controls if attack is confirmed
6. Check for any configuration changes that might have triggered the condition
', '["https://wiki.mikrotik.com/wiki/Manual:System/Resource","https://attack.mitre.org/techniques/T1499/"]', '(safe("log.topics", "") == "system" || safe("log.topics", "").contains("resource") || safe("log.topics", "").contains("critical")) && ((safe("log.message", "").contains("cpu") && (safe("log.message", "").contains("100%") || safe("log.message", "").contains("high") || safe("log.message", "").contains("overload"))) || (safe("log.message", "").contains("memory") && (safe("log.message", "").contains("exhausted") || safe("log.message", "").contains("full") || safe("log.message", "").contains("low"))) || (safe("log.message", "").contains("connection") && (safe("log.message", "").contains("limit") || safe("log.message", "").contains("overflow") || safe("log.message", "").contains("table full"))) || (safe("log.message", "").contains("disk") && (safe("log.message", "").contains("full") || safe("log.message", "").contains("space"))) || safe("log.message", "").contains("out of memory") || safe("log.message", "").contains("resource limit")', '2025-09-04 15:29:10.104563', true, false, 'origin', '["origin.ip"]', '[]');
INSERT INTO public.utm_correlation_rules VALUES (1059, 'RouterOS Multiple Authentication Failures', 3, 3, 2, 'Credential Access', 'T1110.001 - Brute Force: Password Guessing', 'Detects multiple failed authentication attempts to RouterOS from the same source IP, which may indicate a brute force attack against the device. This rule monitors for login failures across all services including SSH, Telnet, Winbox, and web interface.

Next Steps:
1. Investigate the source IP address for legitimacy and geographic location
2. Check if the IP is from an expected network range or known administrator location
3. Review successful authentication attempts from the same IP before and after the failures
4. Examine other RouterOS logs for additional suspicious activities from this IP
5. Consider implementing IP blocking or rate limiting for the source IP
6. Verify RouterOS user accounts for any unauthorized changes or access
7. Check if default credentials are still in use on the device
', '["https://help.mikrotik.com/docs/spaces/ROS/pages/328094/Log","https://attack.mitre.org/techniques/T1110/001/"]', 'safe("log.topics", "").contains("system") && safe("log.topics", "").contains("error") && safe("log.topics", "").contains("critical") && safe("log.message", "").contains("login failure") && safe("origin.ip", "") != ""', '2025-09-04 15:29:43.042341', true, false, 'origin', '["origin.ip"]', '[{"indexPattern":"v11-log-firewall-mikrotik-*","with":[{"field":"origin.ip.keyword","operator":"filter_term","value":"{{.origin.ip}}"},{"field":"log.message","operator":"filter_match","value":"login failure"}],"or":null,"within":"now-10m","count":5}]');
INSERT INTO public.utm_correlation_rules VALUES (1125, 'CEF Device Vendor Anomalies', 3, 3, 2, 'Defense Evasion', 'Log Spoofing', 'Detects anomalies in CEF device vendor information including unknown vendors, sudden vendor changes, or mismatched vendor-product combinations that could indicate log spoofing or unauthorized log sources.

**Next Steps:**
1. Verify the legitimacy of the device vendor and product information
2. Check if the source IP is authorized to send logs from this vendor
3. Investigate any recent network changes or new device deployments
4. Review CEF parser configurations and field mappings
5. Correlate with authentication logs from the source system
6. If confirmed as suspicious, block the source IP and investigate for compromise
', '["https://docs.paloaltonetworks.com/resources/cef","https://attack.mitre.org/techniques/T1070/002/"]', '(safe("log.cef_device_vendor", "") != "" &&
 safe("log.previous_vendor", "") != "" &&
 safe("log.cef_device_vendor", "") != safe("log.previous_vendor", "") &&
 safe("origin.ip", "") == safe("log.previous_source_ip", "")) ||
(safe("log.cef_device_vendor", "") in ["test", "unknown", "demo", "example", "sample"] &&
 safe("log.cef_severity", 0) >= 5) ||
(safe("log.cef_device_vendor", "") == "Cisco" &&
 !safe("log.cef_device_product", "").contains("ASA") &&
 !safe("log.cef_device_product", "").contains("IOS") &&
 !safe("log.cef_device_product", "").contains("Firepower") &&
 !safe("log.cef_device_product", "").contains("ISE") &&
 !safe("log.cef_device_product", "").contains("AMP") &&
 !safe("log.cef_device_product", "").contains("Umbrella")) ||
(safe("log.cef_device_vendor", "") == "Palo Alto Networks" &&
 !safe("log.cef_device_product", "").contains("PAN-OS") &&
 !safe("log.cef_device_product", "").contains("Traps") &&
 !safe("log.cef_device_product", "").contains("Cortex") &&
 !safe("log.cef_device_product", "").contains("Prisma")) ||
(safe("log.cef_device_vendor", "").startsWith("<") ||
 safe("log.cef_device_vendor", "").startsWith(">") ||
 safe("log.cef_device_vendor", "").contains("&") ||
 safe("log.cef_device_vendor", "").contains("\"") ||
 safe("log.cef_device_vendor", "").contains("''") ||
 safe("log.cef_device_vendor", "").contains("\\") ||
 safe("log.cef_device_vendor", "").contains("//")) ||
(safe("log.cef_device_vendor", "").size() > 64 ||
 safe("log.cef_device_product", "").size() > 64)
', '2025-09-04 16:00:15.429353', true, false, 'origin', '["origin.ip","log.cef_device_vendor","log.cef_device_product"]', '[]');
INSERT INTO public.utm_correlation_rules VALUES (1062, 'MikroTik Suspicious Script Execution', 2, 3, 2, 'Execution', 'T1059 - Command and Scripting Interpreter', 'Suspicious script execution detected on MikroTik device, which could indicate unauthorized command execution or system compromise. This rule detects script-related activities that may indicate malicious automation or unauthorized system changes.

Next Steps:
1. Review the specific script commands executed and verify if they are authorized
2. Check the source IP address for any unauthorized access patterns
3. Examine system configuration changes that occurred during the timeframe
4. Verify administrative access logs for the affected device
5. Review scheduler entries for any unauthorized or suspicious automated tasks
6. Check for any privilege escalation attempts or configuration tampering
7. Correlate with network traffic to identify potential data exfiltration
', '["https://help.mikrotik.com/docs/spaces/ROS/pages/328094/Log","https://attack.mitre.org/techniques/T1059/"]', 'safe("log.topics", "").matches(".*script.*") && (safe("log.message", "").matches(".*script.*run.*") || safe("log.message", "").matches(".*script.*execute.*") || safe("log.message", "").matches(".*scheduler.*script.*") || safe("log.message", "").matches(".*system script.*")) && safe("origin.ip", "") != ""', '2025-09-04 15:29:44.672693', true, false, 'origin', '["origin.ip"]', '[]');
INSERT INTO public.utm_correlation_rules VALUES (1063, 'SSH Brute Force Attack on MikroTik Device', 3, 2, 2, 'Credential Access', 'T1110.001 - Brute Force: Password Guessing', 'Detects SSH brute force attempts against MikroTik devices. Monitors for multiple SSH connection attempts on port 22 from the same source IP within a short time window, which may indicate password guessing attacks.

Next Steps:
1. Verify the source IP address and check if it''s from a known legitimate administrator
2. Review SSH access logs on the MikroTik device for successful authentications
3. Check if the source IP has been involved in other suspicious activities
4. Consider implementing rate limiting or IP blocking for repeated failed attempts
5. Ensure SSH access is restricted to authorized management networks only
6. Review MikroTik firewall rules and consider disabling SSH access from untrusted networks
', '["https://help.mikrotik.com/docs/spaces/ROS/pages/132350014/SSH","https://attack.mitre.org/techniques/T1110/001/"]', 'safe("target.port", 0.0) == 22 && safe("protocol", "") == "tcp" && safe("origin.ip", "") != "" && (safe("log.chain", "").contains("input") || safe("log.action", "").contains("drop") || (safe("log.topics", "").contains("system") && safe("log.kvMessage", "").contains("ssh"))))', '2025-09-04 15:29:45.218462', true, false, 'origin', NULL, '[{"indexPattern":"v11-log-firewall-mikrotik-*","with":[{"field":"origin.ip.keyword","operator":"filter_term","value":"{{.origin.ip}}"},{"field":"target.port","operator":"filter_term","value":"22"},{"field":"protocol.keyword","operator":"filter_term","value":"tcp"}],"or":null,"within":"now-30s","count":10}]');
INSERT INTO public.utm_correlation_rules VALUES (1064, 'Telnet Access Violation on MikroTik Device', 3, 2, 1, 'Lateral Movement', 'T1021.001 - Remote Services: Telnet', 'Detects Telnet access attempts to MikroTik devices. Telnet is an insecure protocol that transmits credentials in clear text and should not be used for device management in production environments. Telnet connections may indicate unauthorized access attempts or security policy violations.

**Next Steps:**
1. Verify if the source IP is authorized for device management
2. Check if the connection was successful or blocked by firewall rules
3. Review MikroTik device logs for any configuration changes
4. Confirm whether Telnet service should be enabled on the device
5. Consider disabling Telnet and using SSH for secure remote access
6. Investigate any recent policy changes that might allow Telnet access
7. If unauthorized, block the source IP and review access controls
', '["https://help.mikrotik.com/docs/spaces/ROS/pages/328094/Log","https://attack.mitre.org/techniques/T1021/001/"]', 'safe("target.port", 0.0) == 23 && safe("protocol", "") == "tcp" && safe("origin.ip", "") != "" && (safe("log.chain", "").contains("input") || safe("log.action", "").contains("drop") || (safe("log.topics", "").contains("system") && safe("log.kvMessage", "").contains("telnet"))))', '2025-09-04 15:29:45.778433', true, false, 'origin', '["origin.ip","target.ip"]', '[]');
INSERT INTO public.utm_correlation_rules VALUES (1301, 'Windows: The ACL was set on accounts which are members of administrators groups', 1, 2, 3, 'Privilege Escalation', 'Discovery', 'This rule detects changes to the Access Control Lists (ACLs) of accounts that are members of administrator groups on the system.  Changes to t he ACLs on these highly privileged accounts can indicate potential privilege escalation attempts or unauthorized actions that could compromise system security.', '["https://attack.mitre.org/tactics/TA0004/","https://attack.mitre.org/techniques/T1069/"]', 'safe("log.eventCode", 0.0) == double(4780)', '2025-09-04 20:22:04.352429', true, false, 'origin', NULL, '[]');
INSERT INTO public.utm_correlation_rules VALUES (1065, 'VLAN Hopping Attempt Detected', 3, 3, 2, 'Defense Evasion', 'T1599.001 - Network Boundary Bridging: VLAN Hopping', 'Detects potential VLAN hopping attempts where an attacker tries to bypass network segmentation by sending packets with multiple VLAN tags or manipulating VLAN configurations. This rule identifies suspicious network traffic patterns that may indicate double-tagging attacks, switch spoofing, or other VLAN manipulation techniques commonly used to gain unauthorized access to network segments.

Next Steps:
1. Immediately isolate the suspected source IP and MAC address from the network
2. Review switch port configurations for the affected interfaces
3. Examine VLAN configurations for any unauthorized changes or misconfigurations
4. Check for spanning tree protocol violations or unusual network topology changes
5. Review firewall logs for any successful connections between VLANs that should be isolated
6. Verify that trunk ports are properly configured with allowed VLAN lists
7. Investigate if the source MAC address is legitimate or spoofed
8. Check for any recent changes to network infrastructure or VLAN policies
9. Monitor for additional attempts from the same source or related networks
10. Consider implementing 802.1Q-in-Q (QinQ) protection if not already in place
', '["https://help.mikrotik.com/docs/spaces/ROS/pages/88014957/VLAN","https://attack.mitre.org/techniques/T1599/001/"]', 'safe("log.chain", "") != "" && (safe("log.chain", "").contains("vlan") || safe("log.chain", "").contains("invalid") || safe("log.len", 0) > 1522 || safe("log.topics", "").contains("vlan"))', '2025-09-04 15:29:46.482281', true, false, 'origin', '["origin.ip","origin.mac"]', '[{"indexPattern":"v11-log-mikrotik-*","with":[{"field":"origin.ip.keyword","operator":"filter_term","value":"{{.origin.ip}}"}],"or":null,"within":"now-10m","count":5}]');
INSERT INTO public.utm_correlation_rules VALUES (1066, 'MikroTik Web Interface Brute Force Attack', 2, 2, 3, 'Credential Access', 'T1110.001 - Brute Force: Password Guessing', 'Multiple failed web interface login attempts detected on MikroTik device, indicating potential brute force attack against WebFig or management interface. This activity suggests an attacker is attempting to gain unauthorized access to the device''s management interface.

Next Steps:
1. Investigate the source IP address for legitimacy and check threat intelligence feeds
2. Review successful logins from the same IP address within the timeframe
3. Check if the target device has default or weak credentials configured
4. Verify if the web interface should be accessible from the source network
5. Consider implementing rate limiting or IP blocking on the device
6. Review network segmentation to ensure management interfaces are properly isolated
7. Check for any successful authentications following the failed attempts
8. Monitor for lateral movement attempts if credentials were compromised
', '["https://help.mikrotik.com/docs/spaces/ROS/pages/328094/Log","https://attack.mitre.org/techniques/T1110/001/"]', 'safe("log.topics", "").matches(".*system.*error.*") && safe("log.kvMessage", "").matches(".*login failure.*web.*") && safe("origin.ip", "") != ""', '2025-09-04 15:29:47.019471', true, false, 'origin', '["origin.ip"]', '[{"indexPattern":"v11-log-firewall-mikrotik-*","with":[{"field":"origin.ip.keyword","operator":"filter_term","value":"{{.origin.ip}}"},{"field":"log.kvMessage","operator":"filter_match","value":"login failure web"}],"or":null,"within":"now-30s","count":10}]');
INSERT INTO public.utm_correlation_rules VALUES (1067, 'Winbox Exploitation Attempts Detected', 3, 3, 2, 'Initial Access', 'T1190 - Exploit Public-Facing Application', 'Detects potential Winbox exploitation attempts including CVE-2018-14847 vulnerability exploitation. Monitors for suspicious Winbox connections on port 8291 or unusual authentication patterns that may indicate exploitation attempts.

Next Steps:
1. Investigate the source IP for additional suspicious activity
2. Check RouterOS version for known Winbox vulnerabilities 
3. Review authentication logs for failed/successful login attempts
4. Examine network traffic patterns to/from the affected device
5. Consider blocking the source IP if exploitation is confirmed
6. Update RouterOS firmware if vulnerable versions are detected
7. Review Winbox access policies and consider disabling if not needed
', '["https://help.mikrotik.com/docs/spaces/ROS/pages/328094/Log","https://attack.mitre.org/techniques/T1190/","https://www.cve.org/CVERecord?id=CVE-2018-14847"]', '(safe("target.port", 0.0) == 8291 || safe("origin.port", 0.0) == 8291) && safe("origin.ip", "") != "" && (safe("log.chain", "").contains("input") || safe("log.chain", "").contains("forward")) && safe("protocol", "") == "tcp"', '2025-09-04 15:29:47.590528', true, false, 'origin', '["origin.ip"]', '[{"indexPattern":"v11-log-firewall-mikrotik-*","with":[{"field":"origin.ip.keyword","operator":"filter_term","value":"{{.origin.ip}}"},{"field":"target.port","operator":"filter_term","value":"8291"}],"or":null,"within":"now-5m","count":10}]');
INSERT INTO public.utm_correlation_rules VALUES (1068, 'Wireless Security Breach Detected', 3, 3, 2, 'Discovery', 'Wireless Exploitation', 'Detects potential wireless security breaches including deauthentication attacks, unauthorized access point connections, or suspicious wireless client behavior on MikroTik wireless infrastructure. This rule identifies patterns indicative of wireless attacks such as excessive deauthentication frames, disassociation attacks, or dropped wireless connections.

Next Steps:
1. Verify the wireless client MAC address and check if it''s a known authorized device
2. Review wireless access point logs for authentication failures or connection patterns
3. Check for rogue access points in the vicinity using wireless scanning tools
4. Analyze the frequency and timing of wireless events to determine if it''s an automated attack
5. Investigate physical security around wireless access points
6. Review wireless security policies and ensure WPA3/WPA2 encryption is properly configured
7. Consider implementing MAC address filtering or 802.1X authentication if not already in place
8. Monitor for additional suspicious wireless activity from the same or related MAC addresses
', '["https://help.mikrotik.com/docs/spaces/ROS/pages/224559120/WiFi","https://attack.mitre.org/techniques/T1580/"]', 'safe("log.topics", "") == "wireless" && (safe("log.chain", "").contains("deauth") || safe("log.chain", "").contains("disassoc") || safe("log.chain", "").contains("drop") || safe("log.chain", "").contains("reject"))', '2025-09-04 15:29:47.938874', true, false, 'origin', NULL, '[]');
INSERT INTO public.utm_correlation_rules VALUES (1069, 'Captive Portal Authentication Bypass Attempts', 3, 2, 1, 'Credential Access', 'T1110 - Brute Force', 'Detects multiple failed authentication attempts or bypass attempts on the captive portal, which could indicate unauthorized access attempts to the network. This rule triggers when 5 or more failed captive portal authentication events occur from the same IP address within a 10-minute window.

Next Steps:
1. Investigate the source IP address for legitimacy and potential compromise
2. Review captive portal logs for patterns of authentication bypass attempts
3. Check if the IP address corresponds to a known legitimate user or device
4. Consider implementing rate limiting or blocking the source IP if malicious activity is confirmed
5. Review network access controls and captive portal configuration for potential vulnerabilities
6. Monitor for successful authentications from the same IP after failed attempts
', '["https://www.zenarmor.com/docs/network-security-tutorials/how-to-configure-captive-portal-on-pfsense","https://attack.mitre.org/techniques/T1110/"]', 'safe("log.eventType", "") == "logportalauth" && safe("raw", "").contains("FAILURE") && safe("origin.ip", "") != ""', '2025-09-04 15:34:16.672625', true, false, 'origin', '["origin.ip"]', '[{"indexPattern":"v11-log-firewall-pfsense-*","with":[{"field":"log.eventType.keyword","operator":"filter_term","value":"logportalauth"},{"field":"origin.ip.keyword","operator":"filter_term","value":"{{.origin.ip}}"}],"or":null,"within":"now-10m","count":5}]');
INSERT INTO public.utm_correlation_rules VALUES (1071, 'pfSense Configuration Backup Failure', 1, 3, 3, 'Impact', 'Data Destruction', 'Detects configuration backup failures in pfSense. Failed backups can prevent disaster recovery and may indicate storage issues, permission problems, or potential tampering with backup processes. Regular successful backups are critical for system recovery.

Next Steps:
1. Check pfSense system logs for detailed error messages about the backup failure
2. Verify available disk space on the backup destination
3. Confirm backup directory permissions and accessibility
4. Review backup schedule configuration and timing
5. Test manual backup functionality to isolate the issue
6. Check for any recent system changes that might affect backup processes
7. Verify network connectivity if backing up to remote locations
8. Consider implementing backup monitoring and alerting if not already in place
', '["https://docs.netgate.com/pfsense/en/latest/backup/index.html","https://attack.mitre.org/techniques/T1485/"]', '(safe("log.eventType", "") == "system" || safe("log.eventType", "") == "config") && (safe("raw", "").contains("backup failed") || safe("raw", "").contains("config write error") || safe("raw", "").contains("unable to save") || safe("raw", "").contains("backup error") || safe("raw", "").contains("configuration sync failed") || safe("raw", "").contains("xmlrpc sync error"))', '2025-09-04 15:34:17.959384', true, false, 'origin', '["log.syslogHost"]', '[]');
INSERT INTO public.utm_correlation_rules VALUES (1072, 'DHCP Pool Exhaustion Attack', 1, 1, 3, 'Impact', 'T1499.007 - Endpoint Denial of Service: DHCP Starvation', 'Detects rapid DHCP requests that could indicate DHCP starvation attacks attempting to exhaust the IP address pool and prevent legitimate clients from obtaining network access. This attack can cause denial of service by preventing new devices from joining the network.

Next Steps:
- Investigate the source IP addresses making excessive DHCP requests
- Check DHCP server logs for unusual lease patterns or exhaustion messages
- Review network topology for rogue devices or unauthorized DHCP clients
- Verify DHCP pool configuration and available IP ranges
- Consider implementing DHCP rate limiting or MAC address filtering
- Monitor for continued exhaustion attempts after mitigation
', '["https://docs.netgate.com/pfsense/en/latest/services/dhcp/index.html","https://attack.mitre.org/techniques/T1499/007/"]', 'safe("log.eventType", "") == "dhcpd" && (safe("raw", "").contains("DHCPDISCOVER") || safe("raw", "").contains("no free leases"))', '2025-09-04 15:34:18.661479', true, false, 'origin', '["log.syslogHost"]', '[{"indexPattern":"v11-log-firewall-pfsense-*","with":[{"field":"log.eventType.keyword","operator":"filter_term","value":"dhcpd"}],"or":null,"within":"now-2m","count":50}]');
INSERT INTO public.utm_correlation_rules VALUES (1073, 'DNS Resolver Cache Poisoning Attempt', 2, 3, 2, 'Credential Access, Collection', 'T1557 - Man-in-the-Middle', 'Detects potential DNS cache poisoning attempts on pfSense DNS resolver (Unbound) by monitoring for suspicious DNS responses with mismatched query IDs or unexpected responses from non-authoritative servers. This rule identifies anomalous DNS traffic patterns that may indicate an attacker attempting to poison DNS cache entries.

Next Steps:
1. Investigate the source IP address for other suspicious DNS activities
2. Verify DNS resolver configuration and check for unauthorized changes
3. Review DNS query logs for patterns of cache poisoning attempts
4. Check if legitimate DNS servers are responding with forged packets
5. Consider implementing DNS response validation and DNSSEC if not already enabled
6. Monitor for subsequent DNS queries to verify if cache poisoning was successful
', '["https://docs.netgate.com/pfsense/en/latest/services/dns/resolver.html","https://attack.mitre.org/techniques/T1557"]', 'safe("log.eventType", "") == "unbound" && (safe("raw", "").contains("FORGED") || safe("raw", "").contains("SERVFAIL"))', '2025-09-04 15:34:19.181567', true, false, 'origin', '["adversary.ip","log.query_name"]', '[{"indexPattern":"v11-log-firewall-pfsense-*","with":[{"field":"origin.ip.keyword","operator":"filter_term","value":"{{.origin.ip}}"}],"or":null,"within":"now-5m","count":10}]');
INSERT INTO public.utm_correlation_rules VALUES (1074, 'pfSense Firewall Rule Violations', 2, 3, 2, 'Discovery', 'T1046 - Network Service Discovery', 'Detects repeated attempts to violate firewall rules, indicating potential reconnaissance, policy bypass attempts, or misconfigured applications trying to access blocked resources. This rule triggers when the same source IP generates 20 or more blocked connection attempts within 15 minutes.

Next Steps:
1. Investigate the source IP address and its geolocation
2. Review the specific firewall rules being violated and target destinations
3. Check if this is legitimate traffic from misconfigured applications or potential reconnaissance
4. Analyze traffic patterns and timing to distinguish between automated scanning and application issues
5. Consider temporarily blocking the source IP if malicious activity is confirmed
6. Review firewall rule effectiveness and adjust if necessary
', '["https://docs.netgate.com/pfsense/en/latest/monitoring/logs/raw-filter-format.html","https://attack.mitre.org/techniques/T1046"]', 'safe("action", "") == "block" && safe("log.reason", "") == "match" && safe("origin.ip", "") != ""', '2025-09-04 15:34:19.953621', true, false, 'origin', '["origin.ip","target.ip"]', '[{"indexPattern":"v11-log-firewall-pfsense-*","with":[{"field":"origin.ip.keyword","operator":"filter_term","value":"{{.origin.ip}}"},{"field":"action.keyword","operator":"filter_term","value":"block"}],"or":null,"within":"now-15m","count":20}]');
INSERT INTO public.utm_correlation_rules VALUES (1075, 'High Availability CARP Failover Event', 1, 2, 3, 'Impact', 'T1489 - Service Stop', 'Detects critical CARP (Common Address Redundancy Protocol) events including unexpected failovers, split-brain conditions, or frequent state transitions that could indicate network issues or potential attacks on high availability infrastructure. CARP events may indicate hardware failures, network connectivity issues, or deliberate service disruption attempts.

Next Steps:
1. Verify the current CARP master/backup status on all cluster nodes
2. Check network connectivity between CARP cluster members
3. Review hardware status and resource utilization on affected nodes
4. Examine recent configuration changes that might have triggered the failover
5. Investigate for any suspicious network activity or potential DoS attacks
6. Validate that failover completed successfully and services are operational
7. Check firewall logs for any correlation with security events
8. Review CARP interface configurations for mismatches or errors
9. Monitor for recurring CARP state changes that might indicate instability
10. Document the incident and review HA procedures if manual intervention was required
', '["https://docs.netgate.com/pfsense/en/latest/monitoring/status/carp.html","https://attack.mitre.org/techniques/T1489/"]', 'safe("log.eventType", "") == "carp" && safe("raw", "").matches(".*vhid.*")', '2025-09-04 15:34:20.573243', true, false, 'origin', '["log.syslogHost","log.interface"]', '[{"indexPattern":"v11-log-firewall-pfsense-*","with":[{"field":"log.eventType.keyword","operator":"filter_term","value":"carp"}],"or":null,"within":"now-5m","count":3}]');
INSERT INTO public.utm_correlation_rules VALUES (1302, 'Windows: Changes to AdminSDHolder', 1, 2, 3, 'Privilege Escalation', 'Discovery', 'This rule detects changes to the AdminSDHolder object within the Active Directory.  The AdminSDHolder object is critical to maintaining the ACLs of highly privileged accounts and groups in the domain.  Any unexpected modification to this object could indicate a privilege escalation attempt or malicious action.', '["https://attack.mitre.org/tactics/TA0004/","https://attack.mitre.org/techniques/T1069/"]', 'safe("log.action","").matches(''Directory Service Changes'') && safe("log.eventCode", 0.0) == double(5136) && safe("log.eventDataObjectName","").matches(''AdminSDHolder'')', '2025-09-04 20:22:04.952446', true, false, 'origin', NULL, '[]');
INSERT INTO public.utm_correlation_rules VALUES (1076, 'Interface Queue Drops - Performance Degradation', 1, 1, 3, 'Impact', 'T1498 - Network Denial of Service', 'Detects excessive packet drops on pfSense interfaces due to queue saturation, which could indicate network congestion, DDoS attacks, or misconfigured traffic shaping policies affecting service availability.

Next Steps:
1. Check the interface status and utilization on the pfSense dashboard
2. Review traffic shaping policies and queue configurations for the affected interface
3. Analyze network traffic patterns to identify potential DDoS attacks or bandwidth abuse
4. Examine system resources (CPU, memory) to rule out hardware bottlenecks
5. Consider implementing or adjusting traffic limiters and Quality of Service (QoS) rules
6. Monitor for continued drops to determine if this is an ongoing issue
7. Check for any recent configuration changes that might have caused the problem
', '["https://docs.netgate.com/pfsense/en/latest/monitoring/status/interfaces.html","https://attack.mitre.org/techniques/T1498/"]', 'safe("log.eventType", "") == "kernel" && safe("log.realInterface", "") != "" && (safe("log.reason", "").contains("queue") || safe("log.reason", "").contains("congestion"))', '2025-09-04 15:34:21.142644', true, false, 'origin', '["log.realInterface"]', '[{"indexPattern":"v11-log-firewall-pfsense-*","with":[{"field":"log.realInterface.keyword","operator":"filter_term","value":"{{.log.realInterface}}"}],"or":null,"within":"now-15m","count":50}]');
INSERT INTO public.utm_correlation_rules VALUES (1077, 'pfSense LDAP Integration Issues', 3, 2, 3, 'Discovery', 'T1087 - Account Discovery', 'Detects LDAP integration issues in pfSense including connection failures, binding errors, query timeouts, or certificate problems. These issues can prevent proper authentication and may indicate configuration problems or potential LDAP injection attempts.

Next Steps:
1. Review pfSense LDAP configuration in System > User Manager > Authentication Servers
2. Check LDAP server connectivity and certificate validity
3. Verify LDAP bind credentials and search base DN
4. Review firewall rules between pfSense and LDAP server
5. Monitor for repeated failures that may indicate brute force attempts
6. Check LDAP server logs for corresponding authentication events
', '["https://docs.netgate.com/pfsense/en/latest/usermanager/ldap.html","https://attack.mitre.org/techniques/T1087/"]', '(safe("log.eventType", "") == "php-fpm" || safe("log.eventType", "") == "openvpn" || safe("log.eventType", "") == "webConfigurator") && (safe("log.reason", "").contains("LDAP") && (safe("log.reason", "").contains("bind failed") || safe("log.reason", "").contains("connect error") || safe("log.reason", "").contains("certificate verify failed") || safe("log.reason", "").contains("search failed") || safe("log.reason", "").contains("timeout") || safe("log.reason", "").contains("Can''t contact LDAP server")))', '2025-09-04 15:34:21.702539', true, false, 'origin', '["log.syslogHost","category"]', '[{"indexPattern":"v11-log-firewall-pfsense-*","with":[{"field":"log.syslogHost.keyword","operator":"filter_term","value":"{{.log.syslogHost}}"}],"or":null,"within":"now-30m","count":10}]');
INSERT INTO public.utm_correlation_rules VALUES (1078, 'pfSense Limiters and Queues Overflow', 1, 2, 3, 'Impact', 'T1499 - Endpoint Denial of Service: Resource Exhaustion', 'Detects when pfSense traffic limiters or queues experience overflow conditions, which could indicate network congestion, DoS attacks, or misconfigured traffic shaping rules. This can lead to service degradation or complete network outages.

**Next Steps:**
1. Check pfSense interface utilization and performance metrics
2. Review traffic shaping rules and limiter configurations for proper sizing
3. Analyze network traffic patterns to identify potential DoS attacks or abnormal usage
4. Verify bandwidth allocations match actual network capacity requirements
5. Monitor for repeated overflow events on the same interface
6. Check for misconfigurations in queue priorities and weights
7. Consider adjusting limiter thresholds based on actual traffic patterns
8. Investigate source IPs generating excessive traffic if attack is suspected
', '["https://docs.netgate.com/pfsense/en/latest/trafficshaper/limiters.html","https://attack.mitre.org/techniques/T1499/"]', 'safe("log.eventType", "") == "kernel" && (safe("log.reason", "").contains("queue overflow") || safe("log.reason", "").contains("limiter overflow") || safe("log.reason", "").contains("dummynet") && safe("log.reason", "").contains("overflow") || safe("log.reason", "").contains("unlinked queue") || safe("log.reason", "").contains("update_fs") && safe("log.reason", "").contains("still unlinked"))', '2025-09-04 15:34:22.258735', true, false, 'origin', '["log.syslogHost"]', '[{"indexPattern":"v11-log-firewall-pfsense-*","with":[{"field":"log.realInterface.keyword","operator":"filter_term","value":"{{.log.realInterface}}"}],"or":null,"within":"now-15m","count":10}]');
INSERT INTO public.utm_correlation_rules VALUES (1094, 'SonicWall Access Rule Violations', 3, 3, 2, 'Defense Evasion, Persistence, Privilege Escalation, Initial Access', 'T1078 - Valid Accounts', 'Detects repeated violations of firewall access rules which may indicate unauthorized access attempts, policy violations, or reconnaissance activities. This rule triggers when multiple deny/drop/block actions occur from the same source IP within a short time frame, suggesting potential malicious activity or policy enforcement issues.

Next Steps:
1. Investigate the source IP address for legitimacy and business purpose
2. Review the specific firewall rules being violated and their configuration
3. Check if the source IP is from an expected network segment or external location
4. Analyze the destination ports and services being accessed
5. Correlate with user authentication logs if applicable
6. Consider implementing additional monitoring or blocking for persistent violators
7. Review firewall policy configuration for potential misconfigurations
', '["https://www.sonicwall.com/techdocs/pdf/sonicos-6-5-4-log-events-reference-guide.pdf","https://attack.mitre.org/techniques/T1078/"]', 'safe("action", "") in ["deny", "drop", "block"] && safe("log.rule", "") != ""', '2025-09-04 15:38:11.994811', true, false, 'origin', NULL, '[{"indexPattern":"v11-log-firewall-sonicwall-*","with":[{"field":"origin.ip.keyword","operator":"filter_term","value":"{{.origin.ip}}"},{"field":"action.keyword","operator":"filter_term","value":"deny"}],"or":null,"within":"now-10m","count":20}]');
INSERT INTO public.utm_correlation_rules VALUES (1095, 'SonicWall Anti-Spyware Detection', 3, 2, 1, 'Discovery', 'T1082 - System Information Discovery', 'Detects when SonicWall Anti-Spyware service identifies and blocks spyware, adware, or other potentially unwanted programs (PUPs) that may be attempting to collect sensitive information or establish persistence on the network.

Next Steps:
- Review the detected spyware category and priority level
- Investigate the source IP address for other malicious activities
- Check if the blocked spyware represents a targeted attack or widespread infection
- Verify that Anti-Spyware policies are properly configured and up-to-date
- Consider quarantining the affected host if multiple spyware detections occur
- Review network traffic patterns from the source to identify potential data exfiltration
', '["https://www.sonicwall.com/techdocs/pdf/sonicos-6-5-4-log-events-reference-guide.pdf","https://attack.mitre.org/techniques/T1082/"]', '(safe("log.spycat", "") != "" ||
 safe("log.msg", "").contains("spyware") ||
 safe("log.msg", "").contains("Anti-Spyware") ||
 safe("log.eventName", "").contains("Anti-Spyware") ||
 safe("log.category", "").contains("Anti-Spyware") ||
 safe("log.spypri", "0") != "0") &&
(safe("action", "") in ["drop", "blocked"])
', '2025-09-04 15:38:12.48973', true, false, 'origin', NULL, '[]');
INSERT INTO public.utm_correlation_rules VALUES (1079, 'Load Balancer Pool Member Failures', 1, 2, 3, 'Impact', 'T1489 - Service Stop', 'Detects multiple load balancer pool member failures which could indicate service outages, misconfiguration, or targeted attacks against backend servers. This rule monitors pfSense relayd events for patterns indicating backend server failures or unavailability.

Next Steps:
1. Immediately check the status of affected backend servers and services
2. Verify network connectivity between the load balancer and backend servers
3. Review load balancer configuration for misconfigurations
4. Check server logs on affected backend systems for errors or resource issues
5. Investigate if failures correlate with increased traffic or potential DDoS attacks
6. Consider implementing backup pool members or failover mechanisms
7. Monitor for potential targeted attacks against specific backend infrastructure
', '["https://docs.netgate.com/pfsense/en/latest/loadbalancing/index.html","https://attack.mitre.org/techniques/T1489/"]', 'safe("log.eventType", "") == "relayd" && safe("raw", "").matches(".*(host|pool|down|failed|unreachable).*")', '2025-09-04 15:34:56.643704', true, false, 'origin', '["adversary.host"]', '[{"indexPattern":"v11-log-firewall-pfsense-*","with":[{"field":"log.eventType.keyword","operator":"filter_term","value":"relayd"}],"or":null,"within":"now-10m","count":3}]');
INSERT INTO public.utm_correlation_rules VALUES (1080, 'pfSense NAT Traversal Attempts', 3, 3, 1, 'Persistence, Initial Access', 'T1133 - External Remote Services', 'Detects suspicious patterns indicating attempts to traverse NAT rules or exploit NAT configurations in pfSense firewalls. This rule identifies inbound connections from high ports to sensitive services that may indicate NAT traversal attempts for unauthorized access or data exfiltration.

Next Steps:
1. Investigate the source IP address and geolocation for suspicious origins
2. Review NAT rules and port forwarding configurations for unauthorized changes
3. Examine the target services (SSH, RDP, SMB, SQL) for unauthorized access attempts
4. Check authentication logs for corresponding login attempts from the source IP
5. Analyze network traffic patterns for signs of lateral movement or data exfiltration
6. Verify if the connection attempts are from legitimate users or automated tools
7. Consider implementing additional access controls or IP restrictions if unauthorized access is confirmed
', '["https://docs.netgate.com/pfsense/en/latest/nat/index.html","https://attack.mitre.org/techniques/T1133/"]', 'safe("log.direction", "") == "in" && 
safe("action", "") == "pass" && 
safe("origin.port", 0) > 1024 && 
(safe("target.port", 0.0) == double(22) || safe("target.port", 0.0) == double(3389) || safe("target.port", 0.0) == double(445) || safe("target.port", 0.0) == double(1433) || safe("target.port", 0.0) == double(3306)) &&
safe("log.realInterface", "") != ""
', '2025-09-04 15:34:57.248049', true, false, 'origin', '["origin.ip","target.port"]', '[{"indexPattern":"v11-log-firewall-pfsense-*","with":[{"field":"origin.ip.keyword","operator":"filter_term","value":"{{.origin.ip}}"},{"field":"log.direction.keyword","operator":"filter_term","value":"in"}],"or":null,"within":"now-5m","count":10}]');
INSERT INTO public.utm_correlation_rules VALUES (1081, 'pfSense Package Vulnerability Alerts', 2, 3, 2, 'Defense Evasion', 'T1211 - Exploitation for Defense Evasion', 'Detects security alerts related to vulnerable packages installed on pfSense, including outdated versions, known CVEs, or package integrity issues. This rule identifies package management events that indicate security vulnerabilities requiring immediate attention.

Next Steps:
1. Review the specific vulnerability details and affected package version
2. Check if the vulnerability affects critical system functions
3. Verify if patches or updates are available for the affected package
4. Assess the risk level based on the package function and network exposure
5. Plan and execute package updates during approved maintenance windows
6. Monitor for any exploitation attempts targeting the identified vulnerability
7. Document the vulnerability remediation process for compliance purposes
', '["https://docs.netgate.com/pfsense/en/latest/packages/index.html","https://attack.mitre.org/techniques/T1211/"]', '(safe("log.eventType", "").matches("(?i)(pkg|package)") && 
 safe("raw", "").matches("(?i)(vulnerab|cve-|security|critical|exploit|outdated|upgrade.*required|integrity.*fail)")) ||
(safe("log.syslogHost", "") != "" && 
 safe("raw", "").matches("(?i)(package.*vulnerab|pkg.*security|update.*critical|patch.*required)"))
', '2025-09-04 15:34:57.807361', true, false, 'target', '["log.syslogHost","category"]', '[]');
INSERT INTO public.utm_correlation_rules VALUES (1082, 'Blocked Scans on Sensitive Ports', 2, 1, 1, 'Discovery', 'T1046 - Network Service Discovery', 'Detects suspicious patterns of blocked inbound connections to sensitive services. This rule identifies repeated, blocked attempts from a single source, which may indicate targeted scanning or automated tools probing for well-known services like SSH, RDP, SMB, or SQL.

Next Steps:
1. Investigate the source IP address and its reputation/geolocation for signs of malicious activity.
2. Review firewall rules to ensure that access to these services is correctly restricted.
3. If any traffic to these ports is expected, ensure it is from authorized IP ranges only.
4. Analyze network traffic patterns for other signs of scanning from the source IP.
5. Consider permanently blocking the source IP if malicious scanning is confirmed.
', '["https://docs.netgate.com/pfsense/en/latest/nat/index.html","https://attack.mitre.org/techniques/T1046/"]', 'safe("log.direction", "") == "in" && 
safe("action", "") == "block" && 
(safe("target.port", 0.0) == double(22) || safe("target.port", 0.0) == double(3389) || safe("target.port", 0.0) == double(445) || safe("target.port", 0.0) == double(1433) || safe("target.port", 0.0) == double(3306)) &&
safe("log.realInterface", "") != ""
', '2025-09-04 15:34:58.571601', true, false, 'origin', '["origin.ip","target.port"]', '[{"indexPattern":"v11-log-firewall-pfsense-*","with":[{"field":"origin.ip.keyword","operator":"filter_term","value":"{{.origin.ip}}"},{"field":"log.direction.keyword","operator":"filter_term","value":"in"}],"or":null,"within":"now-5m","count":10}]');
INSERT INTO public.utm_correlation_rules VALUES (1083, 'pfSense Proxy Server Violations', 3, 3, 2, 'Command and Control', 'T1090 - Proxy', 'Detects violations of proxy server policies in pfSense Squid proxy, including attempts to bypass proxy restrictions, access blocked sites, or use unauthorized protocols. These violations could indicate policy evasion or malicious activity.

Next Steps:
1. Review the blocked request details and destination URL
2. Investigate the source IP for patterns of proxy bypass attempts
3. Check if the user account has legitimate business need for the blocked access
4. Verify proxy configuration and policy settings are appropriate
5. Consider implementing additional controls if repeated violations occur
6. Review network logs for any successful bypass attempts from the same source
', '["https://docs.netgate.com/pfsense/en/latest/packages/cache-proxy/index.html","https://attack.mitre.org/techniques/T1090/"]', 'safe("log.eventType", "") == "squid" && (safe("action", "") == "TCP_DENIED" || safe("action", "") == "TCP_MISS_ABORTED" || (safe("action", "") == "TCP_TUNNEL" && safe("log.reason", "").contains("CONNECT")) || safe("log.reason", "").contains("403") || safe("log.reason", "").contains("407") || safe("log.reason", "").contains("blocked"))', '2025-09-04 15:34:59.065065', true, false, 'origin', '["origin.ip","target.ip"]', '[{"indexPattern":"v11-log-firewall-pfsense-*","with":[{"field":"origin.ip.keyword","operator":"filter_term","value":"{{.origin.ip}}"}],"or":null,"within":"now-30m","count":20}]');
INSERT INTO public.utm_correlation_rules VALUES (1084, 'pfSense RADIUS Authentication Failures', 3, 2, 2, 'Credential Access', 'T1110 - Brute Force', 'Detects multiple RADIUS authentication failures in pfSense, which could indicate brute force attacks, misconfigured credentials, or connectivity issues with the RADIUS server. Repeated failures may suggest an attempted security breach.

Next Steps:
1. Review the source IP address and verify if it''s from a trusted network
2. Check RADIUS server logs for corresponding authentication attempts
3. Validate user credentials and account status
4. Examine network connectivity between pfSense and RADIUS server
5. Consider implementing IP-based blocking or rate limiting
6. Review firewall rules and VPN access policies
7. If pattern continues, consider threat hunting for lateral movement attempts
', '["https://docs.netgate.com/pfsense/en/latest/usermanager/radius.html","https://attack.mitre.org/techniques/T1110/"]', '(safe("log.eventType", "") == "openvpn" || safe("log.eventType", "") == "radiusd" || safe("log.eventType", "") == "mpd") && (safe("log.reason", "").contains("RADIUS") && (safe("log.reason", "").contains("authentication failed") || safe("log.reason", "").contains("Operation timed out") || safe("log.reason", "").contains("No valid Radius responses") || safe("log.reason", "").contains("rad_init_send_request failed") || safe("log.reason", "").contains("Access-Reject")))', '2025-09-04 15:34:59.707324', true, false, 'origin', '["origin.ip","origin.user"]', '[{"indexPattern":"v11-log-firewall-pfsense-*","with":[{"field":"origin.ip.keyword","operator":"filter_term","value":"{{.origin.ip}}"}],"or":null,"within":"now-10m","count":5}]');
INSERT INTO public.utm_correlation_rules VALUES (1085, 'pfSense Snort/Suricata High-Priority IDS Alert', 3, 3, 3, 'Execution', 'T1203 - Exploitation for Client Execution', 'Detects multiple high-priority IDS alerts from Snort or Suricata indicating malicious activity, exploits, or known attack patterns. These alerts typically indicate active threats such as trojans, exploits, malware, backdoors, shellcode, or rootkits.

Next Steps:
1. Immediately investigate the source IP address and verify if it''s a legitimate system
2. Review the full alert details and classification to understand the specific threat detected
3. Check network logs for additional suspicious activity from the same source
4. Examine the target system for signs of compromise or successful exploitation
5. Consider blocking the source IP if confirmed malicious
6. Update IDS signatures and review firewall rules to prevent similar attacks
7. Correlate with threat intelligence feeds to identify known malicious indicators
', '["https://docs.netgate.com/pfsense/en/latest/packages/snort/alerts.html","https://docs.netgate.com/pfsense/en/latest/packages/snort/index.html","https://attack.mitre.org/techniques/T1203/"]', 'safe("log.eventType", "").matches("(?i)(snort|suricata)") && 
safe("raw", "").matches("(?i)(priority\\s*:\\s*1|classification\\s*:\\s*(trojan|exploit|shellcode|rootkit))")
', '2025-09-04 15:35:00.258433', true, false, 'origin', '["origin.ip","log.eventType"]', '[{"indexPattern":"v11-log-firewall-pfsense-*","with":[{"field":"origin.ip.keyword","operator":"filter_term","value":"{{.origin.ip}}"}],"or":null,"within":"now-10m","count":3}]');
INSERT INTO public.utm_correlation_rules VALUES (1086, 'pfSense Squid Cache Poisoning Attempt', 3, 3, 2, 'Impact', 'T1565 - Data Manipulation', 'Detects potential cache poisoning attempts against pfSense Squid proxy cache. This includes suspicious cache operations, DNS conflicts, malformed requests, or attempts to inject malicious content into the cache that could affect multiple users. Cache poisoning attacks can compromise the integrity of cached content and potentially serve malicious data to legitimate users.

**Next Steps:**
1. Investigate the source IP address for other malicious activities
2. Review Squid cache logs for additional suspicious patterns
3. Check DNS resolution logs for any conflicts or manipulations
4. Verify the legitimacy of PURGE requests and their sources
5. Consider implementing additional cache validation mechanisms
6. Review proxy configuration for security hardening opportunities
7. Monitor affected cached content for integrity
', '["https://docs.netgate.com/pfsense/en/latest/troubleshooting/squid.html","https://attack.mitre.org/techniques/T1565/"]', 'safe("log.eventType", "") == "squid" && (safe("log.reason", "").contains("409") || safe("log.reason", "").contains("DNS conflict") || safe("log.reason", "").contains("cache corruption") || safe("action", "") == "TCP_SWAPFAIL" || safe("action", "").contains("PURGE") && safe("origin.ip", "") != "127.0.0.1" || safe("log.reason", "").contains("swap.state") && safe("log.reason", "").contains("error"))', '2025-09-04 15:35:01.018212', true, false, 'origin', '["adversary.ip"]', '[{"indexPattern":"v11-log-firewall-pfsense-*","with":[{"field":"origin.ip.keyword","operator":"filter_term","value":"{{.origin.ip}}"}],"or":null,"within":"now-1h","count":5}]');
INSERT INTO public.utm_correlation_rules VALUES (1087, 'State Table Exhaustion Attack', 1, 1, 3, 'Impact', 'T1498 - Network Denial of Service', 'Detects potential state table exhaustion attacks on pfSense firewall by monitoring for rapid connection attempts, state table overflow warnings, or abnormal connection patterns that could lead to denial of service. State table exhaustion is a common DoS technique where attackers overwhelm the firewall''s connection tracking table, preventing legitimate connections from being established.

Next Steps:
1. Immediately check pfSense firewall state table utilization and limits
2. Review current active connections and identify suspicious high-volume sources
3. Analyze traffic patterns from the source IP to determine if this is malicious or legitimate traffic spike
4. Consider implementing rate limiting or blocking the source IP if confirmed malicious
5. Review and potentially increase state table limits if legitimate traffic is causing exhaustion
6. Monitor for similar attacks from other source IPs
7. Check firewall logs for additional indicators of coordinated attack patterns
8. Verify firewall performance metrics and resource utilization
', '["https://docs.netgate.com/pfsense/en/latest/firewall/troubleshooting-blocked-log-entries.html","https://attack.mitre.org/techniques/T1498/"]', '(safe("log.eventType", "").contains("pf") || safe("log.eventType", "").contains("kernel")) && (safe("log.reason", "").contains("state") && (safe("log.reason", "").contains("full") || safe("log.reason", "").contains("exhausted") || safe("log.reason", "").contains("limit")))', '2025-09-04 15:35:01.55345', true, false, 'origin', '["origin.ip"]', '[{"indexPattern":"v11-log-firewall-pfsense-*","with":[{"field":"origin.ip.keyword","operator":"filter_term","value":"{{.origin.ip}}"}],"or":null,"within":"now-5m","count":100}]');
INSERT INTO public.utm_correlation_rules VALUES (1303, 'Windows: Hiding files with attrib.exe', 1, 2, 3, 'Defense Evasion', 'Hide Artifacts', 'This correlation rule detects events where the attrib.exe tool is used to hide files on the system.  Cloaking files using this tool can be an indicator of suspicious or malicious activity,  as it could be used by malicious actors to evade detection and hide their presence on the system.', '["https://attack.mitre.org/tactics/TA0005/","https://attack.mitre.org/techniques/T1564/"]', 'safe("log.message","").matches(''(attrib +h|attrib.exe +h)'')', '2025-09-04 20:22:05.54359', true, false, 'origin', NULL, '[]');
INSERT INTO public.utm_correlation_rules VALUES (1418, 'Windows: PowerShell Share Enumeration Script', 3, 2, 1, 'Discovery', 'Network Share Discovery', 'Detects scripts that contain PowerShell functions, structures, or Windows API functions related to windows share enumeration activities. Attackers, mainly ransomware groups, commonly identify and inspect network shares, looking for critical information for encryption and/or exfiltration.', '["https://attack.mitre.org/tactics/TA0007/","https://attack.mitre.org/techniques/T1135/"]', 'safe("log.message", "").matches("(Invoke-ShareFinder|Invoke-ShareFinderThreaded|(shi1_netname(.+)shi1_remark)|shi1_remark(.+)shi1_netname|(NetShareEnum(.+)NetApiBufferFree)|(NetApiBufferFree(.+)NetShareEnum))")', '2025-09-04 20:58:46.622959', true, false, 'origin', NULL, '[]');
INSERT INTO public.utm_correlation_rules VALUES (1093, 'pfSense VPN Authentication Failures', 3, 2, 2, 'Credential Access', 'T1110 - Brute Force', 'Detects multiple VPN authentication failures from the same source IP address, indicating potential brute force attacks or credential stuffing attempts against VPN services on pfSense firewalls. This rule looks for authentication failures in OpenVPN and IPsec connections.

Next Steps:
1. Investigate the source IP address for reputation and geographic location
2. Review VPN user accounts for any successful logins from the same IP
3. Check for any successful authentications following the failed attempts
4. Consider blocking the source IP if confirmed malicious
5. Review VPN authentication policies and consider implementing account lockout mechanisms
6. Verify VPN service configurations and certificate validity
', '["https://docs.netgate.com/pfsense/en/latest/monitoring/logs/openvpn.html","https://docs.netgate.com/pfsense/en/latest/monitoring/logs/ipsec.html","https://attack.mitre.org/techniques/T1110/"]', 'safe("log.eventType", "").matches("(?i)(openvpn|ipsec|charon)") && 
safe("raw", "").matches("(?i)(authentication failed|auth fail|incorrect password|bad username|tls.*fail|eap.*fail|no trusted.*key|invalid.*certific)") &&
safe("origin.ip", "") != ""
', '2025-09-04 15:35:23.936351', true, false, 'origin', '["origin.ip","log.eventType"]', '[{"indexPattern":"v11-log-firewall-pfsense-*","with":[{"field":"log.eventType.keyword","operator":"filter_match","value":"*vpn*"},{"field":"origin.ip.keyword","operator":"filter_term","value":"{{.origin.ip}}"}],"or":null,"within":"now-30m","count":5}]');
INSERT INTO public.utm_correlation_rules VALUES (1088, 'pfSense Temperature Warning', 1, 2, 3, 'Impact', 'T1499 - Endpoint Denial of Service', 'Detects temperature warnings and thermal events in pfSense systems. High temperatures can cause system instability, hardware damage, and unexpected shutdowns. This may indicate cooling system failures, environmental issues, or hardware problems.

Next Steps:
1. Immediately check the physical environment around the pfSense device for proper ventilation and ambient temperature
2. Verify that all cooling fans are operational and spinning at appropriate speeds
3. Check for dust accumulation on heat sinks, fans, and air vents that may be blocking airflow
4. Monitor CPU and system temperatures using pfSense diagnostic tools or hardware monitoring
5. Review system logs for any hardware failure indicators or SMART disk errors
6. Consider relocating the device to a cooler environment or improving cooling infrastructure
7. If temperatures remain high, plan for immediate hardware replacement to prevent permanent damage
8. Document the incident and review preventive maintenance schedules for cooling systems
', '["https://docs.netgate.com/pfsense/en/latest/hardware/index.html","https://attack.mitre.org/techniques/T1499/"]', '(safe("log.eventType", "") == "kernel" || safe("log.eventType", "") == "system") && (safe("raw", "").contains("temperature") || safe("raw", "").contains("thermal") || safe("raw", "").contains("overheat") || safe("raw", "").contains("ACPI") && safe("raw", "").contains("temp") || safe("raw", "").contains("fan speed") || safe("raw", "").contains("cooling"))', '2025-09-04 15:35:02.124426', true, false, 'origin', '["log.syslogHost"]', '[{"indexPattern":"v11-log-firewall-pfsense-*","with":[{"field":"log.syslogHost.keyword","operator":"filter_term","value":"{{.log.syslogHost}}"}],"or":null,"within":"now-10m","count":3}]');
INSERT INTO public.utm_correlation_rules VALUES (1089, 'pfSense Time Synchronization Failure', 1, 3, 2, 'Defense Evasion', 'T1562 - Impair Defenses', 'Detects time synchronization failures in pfSense which could indicate NTP service issues, network connectivity problems, or potential time-based attack attempts. Accurate time is critical for log correlation, certificate validation, and security event analysis.

Next Steps:
1. Check pfSense NTP configuration and server availability
2. Verify network connectivity to configured NTP servers
3. Review system logs for additional network or hardware issues
4. Confirm firewall rules allow NTP traffic (UDP port 123)
5. Consider investigating potential time-based attacks if failures are suspicious
6. Update NTP server configuration if current servers are unreliable
', '["https://docs.netgate.com/pfsense/en/latest/troubleshooting/time-synchronization.html","https://attack.mitre.org/techniques/T1562/"]', 'safe("log.eventType", "") == "ntpd" && (safe("raw", "").contains("no reply") || safe("raw", "").contains("timeout") || safe("raw", "").contains("unreachable") || safe("raw", "").contains("synchronization lost") || safe("raw", "").contains("clock_step") || safe("raw", "").contains("frequency error"))', '2025-09-04 15:35:21.655845', true, false, 'origin', '["log.syslogHost"]', '[{"indexPattern":"v11-log-firewall-pfsense-*","with":[{"field":"log.syslogHost.keyword","operator":"filter_term","value":"{{.log.syslogHost}}"}],"or":null,"within":"now-30m","count":5}]');
INSERT INTO public.utm_correlation_rules VALUES (1090, 'Traffic Shaper Queue Overflow', 1, 1, 3, 'Impact', 'T1498 - Network Denial of Service', 'Detects abnormal traffic patterns that exceed traffic shaper limits, potentially indicating bandwidth exhaustion attacks or misconfigured traffic policies affecting service availability. This rule monitors kernel events for queue overflows, dropped packets, and bandwidth limit violations that could impact network performance.

Next Steps:
1. Review pfSense traffic shaper logs and queue statistics to identify which traffic classes are experiencing overflows
2. Check network utilization graphs and bandwidth consumption patterns during the alert timeframe
3. Analyze traffic patterns to distinguish between legitimate traffic spikes and potential DoS attacks
4. Review traffic shaper rules and bandwidth allocations for potential misconfigurations
5. Examine source IPs and protocols contributing to the bandwidth exhaustion
6. Consider implementing additional rate limiting or updating traffic shaper policies if necessary
7. Monitor for sustained patterns that might indicate ongoing attacks or infrastructure issues
', '["https://docs.netgate.com/pfsense/en/latest/trafficshaper/index.html","https://attack.mitre.org/techniques/T1498/"]', 'safe("log.eventType", "") == "kernel" && 
(safe("raw", "").contains("queue") || 
 safe("raw", "").contains("shaper") || 
 safe("raw", "").contains("bandwidth") || 
 safe("raw", "").contains("overflow") || 
 safe("raw", "").contains("dropped"))
', '2025-09-04 15:35:22.220904', true, false, 'origin', '["log.realInterface"]', '[{"indexPattern":"v11-log-firewall-pfsense-*","with":[{"field":"log.eventType.keyword","operator":"filter_term","value":"kernel"}],"or":null,"within":"now-5m","count":20}]');
INSERT INTO public.utm_correlation_rules VALUES (1091, 'pfSense Update Server Connectivity Issue', 1, 3, 2, 'Defense Evasion', 'T1562 - Impair Defenses', 'Detects connectivity issues with pfSense update servers which may prevent critical security updates from being installed. This could indicate network problems, DNS issues, or potential interference with update mechanisms.

Next Steps:
1. Verify network connectivity to pfSense update servers
2. Check DNS resolution for update server domains
3. Review firewall rules that might block update traffic
4. Examine proxy settings if configured
5. Check system date/time accuracy
6. Monitor for repeated failures that could indicate persistent issues
7. Validate SSL/TLS certificate trust chains for update servers
', '["https://docs.netgate.com/pfsense/en/latest/install/upgrade.html","https://attack.mitre.org/techniques/T1562/"]', '(safe("log.eventType", "") == "pkg" || safe("log.eventType", "") == "system") && (safe("raw", "").contains("update server") || safe("raw", "").contains("repository") || safe("raw", "").contains("pkg update") || safe("raw", "").contains("fetch failed") || safe("raw", "").contains("connection refused") || safe("raw", "").contains("unable to update") || safe("raw", "").contains("update check failed"))', '2025-09-04 15:35:22.833104', true, false, 'target', '["log.syslogHost"]', '[{"indexPattern":"v11-log-firewall-pfsense-*","with":[{"field":"log.syslogHost.keyword","operator":"filter_term","value":"{{.log.syslogHost}}"}],"or":null,"within":"now-1h","count":3}]');
INSERT INTO public.utm_correlation_rules VALUES (1092, 'pfSense UPS Power Event', 1, 2, 3, 'Impact', 'T1499 - Endpoint Denial of Service', 'Detects UPS power events in pfSense including power failures, battery switches, low battery warnings, and power restoration. These events are critical for maintaining system availability and preventing data loss during power disruptions.

Next Steps:
1. Verify the current power status of the UPS and connected systems
2. Check UPS battery health and capacity levels
3. Review UPS configuration and maintenance schedules
4. Monitor for any cascade power failures on dependent systems
5. Validate backup power procedures and emergency shutdown processes
6. Check system logs for any data corruption or service interruptions
7. Ensure backup systems are functioning properly during power events
', '["https://blog.victormendonca.com/2020/10/28/how-to-setup-ups-on-pfsense/","https://attack.mitre.org/techniques/T1499/"]', 'safe("log.eventType", "") == "apcupsd" && (safe("raw", "").contains("power failure") || safe("raw", "").contains("running on UPS batteries") || safe("raw", "").contains("battery power") || safe("raw", "").contains("low battery") || safe("raw", "").contains("power restored") || safe("raw", "").contains("mains returned") || safe("raw", "").contains("shutdown") || safe("raw", "").contains("battery exhausted"))', '2025-09-04 15:35:23.410193', true, false, 'origin', '["log.syslogHost"]', '[]');
INSERT INTO public.utm_correlation_rules VALUES (1307, 'Windows: Administrators group changed', 1, 2, 3, 'Defense Evasion, Privilege Escalation', 'Domain or Tenant Policy Modification', 'Adversaries may modify the configuration settings of a domain to evade defenses and/or escalate privileges in domain environments.  Domains provide a centralized means of managing how computer resources (ex: computers, user accounts) can act, and interact with each other, on a network.  The policy of the domain also includes configuration settings that may apply between domains in a multi-domain/forest environment.  Modifications to domain settings may include altering domain Group Policy Objects (GPOs) or changing trust settings for domains, including federation trusts.', '["https://attack.mitre.org/techniques/T1484"]', 'safe("log.eventCode", 0.0) == double(4799) && safe("log.winlogEventDataTargetUserSid","").contains(''S-1-5-32-544'')', '2025-09-04 20:22:07.211714', true, false, 'origin', NULL, '[]');
INSERT INTO public.utm_correlation_rules VALUES (1309, 'Windows: An attempt was made to set the Directory Services Restore Mode', 1, 2, 3, 'Collection', 'Data from Local System', 'This event generates on every attempt made to set the Directory Services Restore Mode. Is a function on Active Directory Domain Controllers to take the server offline for emergency maintenance,  particularly restoring backups of AD objects. It is accessed on Windows Server via the advanced startup menu,  similarly to safe mode.', '["https://attack.mitre.org/tactics/TA0009/","https://attack.mitre.org/techniques/T1005"]', 'safe("log.eventCode", 0.0) == double(4794)', '2025-09-04 20:22:07.891473', true, false, 'origin', NULL, '[]');
INSERT INTO public.utm_correlation_rules VALUES (1096, 'SonicWall Application Control Policy Violation', 2, 2, 1, 'Command and Control', 'T1071 - Application Layer Protocol', 'Detects when users attempt to access blocked applications or violate application control policies on SonicWall firewalls. This may indicate attempts to bypass security controls or use unauthorized software for data exfiltration, command and control communications, or policy circumvention.

Next Steps:
1. Review the blocked application details and user information
2. Verify if the application access attempt was legitimate business use
3. Check if the user has proper authorization for the application
4. Review application control policies for potential gaps
5. Investigate if this is part of a pattern of policy violations by the same user
6. Consider additional user training on acceptable use policies
7. Monitor for subsequent attempts from the same source
', '["https://www.sonicwall.com/techdocs/pdf/sonicos-6-5-4-log-events-reference-guide.pdf","https://attack.mitre.org/techniques/T1071/"]', '(safe("log.appcat", "") != "" ||
 safe("log.app", "") != "" ||
 safe("log.appName", "") != "" ||
 safe("log.msg", "").contains("App Control") ||
 safe("log.eventName", "").contains("Application") ||
 safe("log.category", "").contains("Application Control")) &&
(safe("action", "") in ["drop", "blocked"] ||
 safe("actionResult", "").contains("denied"))
', '2025-09-04 15:38:13.111425', true, false, 'origin', '["origin.ip","target.ip"]', '[]');
INSERT INTO public.utm_correlation_rules VALUES (1097, 'SonicWall Bandwidth Threshold Exceeded', 1, 1, 3, 'Network', 'Resource Consumption', 'Detects when bandwidth usage exceeds configured thresholds, which could indicate network abuse, data exfiltration, or denial of service attempts. This rule triggers when either received or transmitted bytes exceed 1GB in a single event.

Next Steps:
1. Check network utilization patterns and identify if traffic is legitimate
2. Investigate the source IP for suspicious activity or compromised systems
3. Review bandwidth policies and threshold configurations
4. Analyze traffic patterns to determine if this is a DoS attack or data exfiltration
5. Consider implementing additional bandwidth controls if abuse is confirmed
', '["https://www.sonicwall.com/techdocs/pdf/sonicos-6-5-4-log-events-reference-guide.pdf"]', '(safe("log.category", "") == "Bandwidth" || safe("log.msg", "").contains("bandwidth") || safe("log.msg", "").contains("threshold exceeded")) && (safe("origin.bytesReceived", 0.0) > 1000000000.0 || safe("origin.bytesSend", 0.0) > 1000000000.0)', '2025-09-04 15:38:13.732782', true, false, 'origin', NULL, '[]');
INSERT INTO public.utm_correlation_rules VALUES (1414, 'Windows: Persistence via BITS Job Notify Cmdline', 2, 3, 2, 'Persistence', 'BITS Jobs', 'An adversary can use the Background Intelligent Transfer Service (BITS) SetNotifyCmdLine method to execute a program that runs after a job finishes transferring data or after a job enters a specified state in order to persist on a system.', '["https://attack.mitre.org/tactics/TA0003/","https://attack.mitre.org/techniques/T1197/"]', 'safe("log.message", "").contains("BITS") && safe("log.eventDataParentProcessName", "").contains("svchost.exe") && !(safe("log.winlogEventDataProcessName", "").matches("(:\\Windows\\System32\\WerFaultSecure.exe|:\\Windows\\System32\\WerFault.exe|:\\Windows\\System32\\wermgr.exe|:\\WINDOWS\\system32\\directxdatabaseupdater.exe)"))', '2025-09-04 20:57:06.61835', true, false, 'origin', NULL, '[]');
INSERT INTO public.utm_correlation_rules VALUES (1308, 'Windows: An administrative group was removed', 1, 2, 3, 'Impact', 'Account Access Removal', 'When an alert is generated, it is essential to immediately investigate the removal of the administrator group.  Verify if the action was authorized and performed by legitimate administrators.  If the unauthorized deletion is confirmed, you should immediately restore the administrators group and assess any potential damage caused by this unwanted action.  Additionally, review and enforce security of the environment to prevent unauthorized changes to administrator group membership and limit access to administrator accounts to authorized users only.', '["https://attack.mitre.org/tactics/TA0040/","https://attack.mitre.org/techniques/T1531/"]', 'safe("log.eventCode", 0.0) in [double(4734), double(4730)] && (safe("log.winlogEventDataTargetUserSid","").endsWith(''-544'') || safe("log.winlogEventDataTargetUserSid","").endsWith(''-512'') || safe("log.winlogEventDataTargetUserSid","").endsWith(''-518'') || safe("log.winlogEventDataTargetUserSid","").endsWith(''-519'') || safe("log.winlogEventDataTargetUserSid","").endsWith(''-520'') || safe("log.winlogEventDataTargetUserSid","").endsWith(''-500'') || safe("log.winlogEventDataTargetUserSid","").endsWith(''-548'') || safe("log.winlogEventDataTargetUserSid","").endsWith(''-549''))', '2025-09-05 22:05:48.080815', true, false, 'origin', NULL, '[]');
INSERT INTO public.utm_correlation_rules VALUES (1098, 'SonicWall Botnet Activity Detected', 3, 3, 2, 'Command and Control', 'T1071 - Application Layer Protocol', 'Detects potential botnet command and control (C2) communication or infected host behavior identified by SonicWall''s botnet filter. This includes suspicious outbound connections, HTML infection chains, or known botnet signatures.

Next Steps:
1. Investigate the source IP for additional suspicious activity
2. Check network logs for other connections from the same host
3. Analyze DNS queries from the affected host
4. Review endpoint logs for signs of malware infection
5. Consider isolating the affected host if infection is confirmed
6. Update threat intelligence feeds and security signatures
7. Scan the host with updated antivirus/anti-malware tools
', '["https://www.sonicwall.com/support/knowledge-base/understanding-geo-ip-and-botnet-filter-diagnostics-options/200527122256150","https://attack.mitre.org/techniques/T1071/"]', '(safe("log.category", "") == "Botnet" || safe("log.msg", "").contains("botnet") || safe("log.msg", "").contains("infected") || safe("log.msg", "").contains("C&C") || safe("log.msg", "").contains("command and control") || safe("log.af_service", "") == "botnet") && (safe("action", "") in ["drop", "blocked"] || safe("log.msg", "").contains("blocked"))', '2025-09-04 15:38:14.398983', true, false, 'origin', NULL, '[{"indexPattern":"v11-log-firewall-sonicwall-*","with":[{"field":"origin.ip.keyword","operator":"filter_term","value":"{{.origin.ip}}"}],"or":null,"within":"now-2h","count":10}]');
INSERT INTO public.utm_correlation_rules VALUES (1099, 'SonicWall Capture ATP Malicious Verdict', 3, 3, 2, 'Execution', 'T1204 - User Execution', 'Detects when SonicWall Capture ATP (Advanced Threat Protection) identifies a file as malicious after sandbox analysis. This indicates an attempted malware delivery or execution that was blocked by the ATP service.

Next Steps:
1. Investigate the source IP address for additional malicious activity
2. Review the file hash and name for threat intelligence correlation
3. Check if the same file was delivered to other internal systems
4. Verify ATP policies are properly configured and up to date
5. Consider blocking the source IP at the perimeter if confirmed malicious
6. Document the incident and update threat intelligence feeds
', '["https://www.sonicwall.com/support/knowledge-base/capture-atp-overview/170503785055490","https://attack.mitre.org/techniques/T1204/"]', '(safe("log.msg", "").contains("Capture ATP") || safe("log.msg", "").contains("Gateway Anti-Virus") || safe("log.msg", "").contains("Sandbox") || safe("log.category", "") == "Anti-Virus" || safe("log.af_type", "") == "ATP") && (safe("log.msg", "").contains("malicious") || safe("log.msg", "").contains("blocked") || safe("log.msg", "").contains("threat detected") || safe("actionResult", "") == "malicious" || safe("action", "") == "blocked")', '2025-09-04 15:38:14.998599', true, false, 'origin', NULL, '[]');
INSERT INTO public.utm_correlation_rules VALUES (1100, 'SonicWall Capture Client Threat Detection', 3, 3, 2, 'Defense Evasion, Privilege Escalation', 'T1055 - Process Injection', 'Detects threats identified by SonicWall Capture Client including advanced malware, zero-day exploits, and sophisticated attack techniques. Capture Client provides advanced threat protection through sandboxing and behavioral analysis.

Next Steps:
1. Immediately isolate the affected host to prevent lateral movement
2. Review the specific threat details in SonicWall management console
3. Analyze the malware sample if available for attribution and IOCs
4. Check for any successful file downloads or executions on the host
5. Scan the host with updated antivirus signatures
6. Review network traffic for any data exfiltration attempts
7. Update security policies if new attack vectors are identified
', '["https://www.sonicwall.com/techdocs/pdf/sonicos-6-5-4-log-events-reference-guide.pdf","https://attack.mitre.org/techniques/T1055/"]', '(safe("log.msg", "").contains("Capture Client") || safe("log.app", "").contains("Capture") || safe("log.category", "").contains("Capture")) && (safe("log.ipscat", "") != "" || safe("log.ipspri", "") != "" || safe("log.dpi", "") != "" || safe("action", "") == "drop")', '2025-09-04 15:38:15.61437', true, false, 'origin', NULL, '[]');
INSERT INTO public.utm_correlation_rules VALUES (1310, 'Windows Defender: Antimalware engine encountered an error and failed', 1, 2, 3, 'Defense Evasion', 'Impair Defenses', 'This rule indicates that the Windows Defender antimalware engine has encountered an error and has failed to function.  This alert is crucial to identify issues in the antimalware engine that may affect the system''s ability to detect and protect against security threats.', '["https://attack.mitre.org/tactics/TA0005/","https://attack.mitre.org/techniques/T1562/"]', 'safe("log.eventCode", 0.0) == double(5008) && safe("log.eventProvider","") == ''SecurityCenter''', '2025-09-04 20:22:08.432447', true, false, 'origin', NULL, '[]');
INSERT INTO public.utm_correlation_rules VALUES (1419, 'Windows: PowerShell MiniDump Script', 3, 3, 2, 'Credential Access', 'PowerShell', 'This rule detects PowerShell scripts capable of dumping process memory using WindowsErrorReporting or Dbghelp.dll MiniDumpWriteDump. Attackers can use this tooling to dump LSASS and get access to credentials.', '["https://attack.mitre.org/tactics/TA0006/","https://attack.mitre.org/techniques/T1059/001/"]', 'safe("log.message", "").matches("(MiniDumpWriteDump|MiniDumpWithFullMemory|pmuDetirWpmuDiniM)")', '2025-09-04 20:58:47.020873', true, false, 'origin', NULL, '[]');
INSERT INTO public.utm_correlation_rules VALUES (1101, 'SonicWall Cloud App Security Threat Detection', 3, 2, 2, 'Discovery', 'T1526 - Cloud Service Discovery', 'Detects security events from SonicWall Cloud App Security including unauthorized cloud application access, suspicious OAuth activities, and cloud-based threats. This rule identifies when SonicWall''s cloud security features detect malicious or unauthorized activities in cloud applications.

**Next Steps:**
1. Review the specific cloud application and threat type identified
2. Investigate the user account involved for any signs of compromise
3. Check for any recent OAuth token grants or application permissions
4. Verify if the cloud application access was legitimate business use
5. Review firewall logs for related network activity from the same source
6. Consider implementing additional cloud access policies if needed
7. If confirmed malicious, revoke OAuth tokens and reset user credentials
', '["https://www.sonicwall.com/products/cloud-security/cloud-app-security","https://attack.mitre.org/techniques/T1526/"]', '(safe("log.app", "").contains("cloud") || safe("log.appName", "").contains("cloud") || safe("log.category", "").contains("cloud") || safe("log.eventName", "").contains("SaaS") || safe("log.eventName", "").contains("OAuth") || safe("log.msg", "").contains("cloud app")) && (safe("log.eventName", "").contains("threat") || safe("log.eventName", "").contains("unauthorized") || safe("log.eventName", "").contains("suspicious") || safe("log.eventName", "").contains("blocked") || safe("log.msg", "").contains("threat") || safe("log.msg", "").contains("unauthorized") || safe("actionResult", "") == "blocked" || safe("action", "") == "blocked" || safe("log.severity", "") == "high")', '2025-09-04 15:38:16.123324', true, false, 'origin', NULL, '[]');
INSERT INTO public.utm_correlation_rules VALUES (1415, 'Windows: Persistence via TelemetryController Scheduled Task Hijack', 2, 3, 2, 'Persistence', 'Scheduled Task', 'Detects the successful hijack of Microsoft Compatibility Appraiser scheduled task to establish persistence with an integrity level of system.', '["https://attack.mitre.org/tactics/TA0003/","https://attack.mitre.org/techniques/T1053/005/"]', 'safe("log.message", "").contains("-cv") && safe("log.eventDataParentProcessName", "").contains("CompatTelRunner.exe") && !(safe("log.winlogEventDataProcessName", "").matches("(conhost.exe|DeviceCensus.exe|CompatTelRunner.exe|DismHost.exe|rundll32.exe|powershell.exe)"))', '2025-09-04 20:57:07.253555', true, false, 'origin', NULL, '[]');
INSERT INTO public.utm_correlation_rules VALUES (1102, 'SonicWall Content Filter Block', 2, 2, 1, 'Command and Control', 'T1071.001 - Application Layer Protocol: Web Protocols', 'Detects when SonicWall Content Filter Service (CFS) blocks access to prohibited websites or content categories. This may indicate attempts to access malicious sites, inappropriate content, or policy violations. Content filtering blocks can reveal reconnaissance attempts, malware command and control communications, or data exfiltration attempts through web channels.

Next Steps:
1. Review the blocked URL/domain and content category to determine if it''s malicious or policy violation
2. Investigate the source IP for other suspicious network activity or policy violations
3. Check if the blocked content is related to known threat indicators or malware families
4. Verify if this represents a legitimate business need that requires policy adjustment
5. Monitor for repeated attempts from the same source which may indicate automated tools or persistence
6. Cross-reference with threat intelligence feeds to identify known bad domains
', '["https://www.sonicwall.com/techdocs/pdf/sonicos-6-5-4-log-events-reference-guide.pdf","https://attack.mitre.org/techniques/T1071/001/"]', '(safe("log.category", "").contains("Content Filter") || safe("log.msg", "").contains("CFS") || safe("log.msg", "").contains("Content Filter") || safe("log.eventName", "").contains("Content Filter") || safe("log.catid", "") != "" || safe("log.contentObject", "") != "") && (safe("action", "") in ["drop", "blocked"] || safe("actionResult", "").contains("blocked"))', '2025-09-04 15:38:16.668966', true, false, 'origin', NULL, '[]');
INSERT INTO public.utm_correlation_rules VALUES (1103, 'SonicWall DDoS Attack Detection and Mitigation', 1, 2, 3, 'Impact', 'T1498 - Network Denial of Service', 'Detects potential DDoS attacks based on high volume of connections, flood attacks, or specific DDoS mitigation events triggered by the SonicWall firewall. This rule identifies various indicators of denial of service attacks including flood patterns, connection thresholds, and explicit DDoS events.

Next Steps:
1. Verify the legitimacy of the source IP address and assess if it''s a known threat
2. Check network traffic patterns and bandwidth utilization during the timeframe
3. Review SonicWall logs for additional DDoS mitigation events and attack vectors
4. Implement rate limiting or blocking rules for the attacking IP addresses
5. Monitor network performance and availability of targeted services
6. Consider engaging with ISP or DDoS protection services if attack persists
7. Document the incident for threat intelligence and future prevention measures
', '["https://www.sonicwall.com/techdocs/pdf/sonicos-6-5-4-log-events-reference-guide.pdf","https://attack.mitre.org/techniques/T1498/"]', 'safe("log.category", "").contains("Flood") || safe("log.eventName", "").contains("DDoS") || safe("log.msg", "").contains("flood") || safe("log.msg", "").contains("syn attack") || safe("log.msg", "").contains("rate limit") || safe("log.msg", "").contains("excessive") || (safe("log.conns", "") != "" && int(safe("log.conns", 0.0)) > 1000.0) || safe("action", "") == "drop"', '2025-09-04 15:38:17.326637', true, false, 'origin', NULL, '[{"indexPattern":"v11-log-firewall-sonicwall-*","with":[{"field":"origin.ip.keyword","operator":"filter_term","value":"{{.origin.ip}}"}],"or":null,"within":"now-5m","count":100}]');
INSERT INTO public.utm_correlation_rules VALUES (1104, 'SonicWall DNS Filtering Alert', 2, 3, 1, 'Command and Control', 'T1071.004 - Application Layer Protocol: DNS', 'Detects DNS filtering events including blocked DNS queries, suspicious DNS behavior, or attempts to resolve malicious domains. This rule identifies when SonicWall firewall blocks DNS requests due to security policies, content filtering, or threat detection mechanisms.

Next Steps:
1. Review the blocked domain to determine if it''s malicious or incorrectly categorized
2. Investigate the source IP for other suspicious DNS queries or network activity
3. Check if the blocked domain is part of a known threat campaign or botnet C&C infrastructure
4. Verify DNS filtering policies are properly configured and up-to-date
5. Consider adding the domain to threat intelligence feeds if confirmed malicious
6. Monitor for DNS tunneling attempts or other covert channel communications
7. Review user activity from the source IP for potential compromise indicators
', '["https://www.sonicwall.com/techdocs/pdf/sonicos-6-5-4-log-events-reference-guide.pdf","https://attack.mitre.org/techniques/T1071/004/"]', '(safe("log.category", "") == "DNS" || safe("log.app", "") == "DNS" || safe("log.appName", "") == "DNS") && (safe("action", "") == "drop" || safe("log.msg", "").contains("dns filter") || safe("log.msg", "").contains("dns block"))', '2025-09-04 15:38:51.874008', true, false, 'origin', NULL, '[]');
INSERT INTO public.utm_correlation_rules VALUES (1110, 'SonicWall Geo-IP Filter Policy Violation', 2, 1, 1, 'Command and Control', 'T1090 - Proxy', 'Detects when traffic is blocked due to Geo-IP filtering policies on SonicWall firewalls. This could indicate attempts to access resources from restricted geographic locations or potential use of VPNs/proxies to bypass geographic restrictions.

**Next Steps:**
1. Verify the source IP address and geographic location
2. Check if the connection attempt is legitimate business traffic
3. Investigate if VPN/proxy tools are being used to circumvent geographic restrictions
4. Review user activity from the source IP for suspicious patterns
5. Consider if Geo-IP policy needs adjustment for legitimate business needs
6. Check for patterns of repeated attempts from blocked countries
', '["https://www.sonicwall.com/support/knowledge-base/how-can-i-configure-sonicwall-geo-ip-filter-using-firewall-access-rules/170505480197552","https://attack.mitre.org/techniques/T1090/"]', '(safe("log.category", "") == "Geo-IP" || safe("log.msg", "").contains("Geo-IP") || safe("log.msg", "").contains("geographic") || safe("log.msg", "").contains("country blocked") || safe("log.gcat", "") != "" || safe("log.af_service", "") == "geo-ip") && (safe("action", "") in ["blocked", "drop", "dropped"]) && (safe("origin.geolocation.country", "") != "" || safe("target.geolocation.country", "") != "")', '2025-09-04 15:38:55.542608', true, false, 'origin', NULL, '[]');
INSERT INTO public.utm_correlation_rules VALUES (1105, 'SonicWall DPI-SSL Inspection Security Alert', 3, 2, 1, 'Command and Control', 'T1573 - Encrypted Channel', 'Detects security issues identified during Deep Packet Inspection of SSL/TLS encrypted traffic. This includes certificate validation failures, suspicious encrypted payloads, malware in HTTPS traffic, or attempts to bypass SSL inspection. These events indicate potential threats using encrypted channels to hide malicious activity.

Next Steps:
1. Review the specific DPI-SSL alert details to understand the nature of the security issue
2. Examine the source IP address and verify if it''s a known internal or external system
3. Check the destination host/domain for reputation and legitimacy
4. Analyze certificate details if the alert involves certificate validation failures
5. Review recent network traffic patterns from the same source IP
6. Check for additional security alerts from the same source or destination
7. If malware is detected in HTTPS traffic, initiate incident response procedures
8. Consider blocking the source IP if confirmed malicious
9. Update SSL inspection policies if legitimate traffic is being incorrectly flagged
10. Document findings and update threat intelligence feeds if applicable
', '["https://www.sonicwall.com/support/knowledge-base/what-is-dpi-ssl/170505320011726","https://attack.mitre.org/techniques/T1573/"]', '(safe("log.category", "") == "DPI-SSL" || safe("log.msg", "").contains("DPI-SSL") || safe("log.msg", "").contains("SSL inspection") || safe("log.msg", "").contains("certificate") || safe("log.msg", "").contains("HTTPS") || safe("log.dpi", "") != "" || safe("protocol", "") == "https" || safe("log.app", "") == "ssl") && (safe("log.msg", "").contains("blocked") || safe("log.msg", "").contains("invalid") || safe("log.msg", "").contains("expired") || safe("log.msg", "").contains("untrusted") || safe("log.msg", "").contains("malicious") || safe("action", "") == "blocked" || safe("actionResult", "") == "failed")', '2025-09-04 15:38:52.389147', true, false, 'origin', NULL, '[]');
INSERT INTO public.utm_correlation_rules VALUES (1106, 'SonicWall Email Security Threat Detected', 3, 2, 1, 'Initial Access', 'T1566 - Phishing', 'Detects potential email security threats including malicious attachments, phishing attempts, or spam messages blocked by SonicWall email security features. This rule triggers when email-related security events are detected with suspicious content or blocked actions.

Next Steps:
1. Review the blocked email details including sender, recipient, and attachment information
2. Verify the email threat categorization and signature match
3. Check for similar threats from the same sender or domain
4. Consider updating email security policies if legitimate traffic is being blocked
5. Monitor for bypass attempts or similar threats from related sources
6. Document the incident and update threat intelligence feeds if applicable
', '["https://www.sonicwall.com/techdocs/pdf/sonicos-6-5-4-log-events-reference-guide.pdf","https://attack.mitre.org/techniques/T1566/"]', '(safe("log.category", "") == "Email Security" || safe("log.app", "") == "smtp" || safe("log.app", "") == "pop3" || safe("log.app", "") == "imap") && (safe("action", "") == "blocked" || safe("action", "") == "dropped" || safe("log.msg", "").contains("malicious") || safe("log.msg", "").contains("phishing") || safe("log.msg", "").contains("spam") || safe("log.spycat", "") != "" || safe("log.spypri", "") == "high")', '2025-09-04 15:38:53.091965', true, false, 'origin', NULL, '[]');
INSERT INTO public.utm_correlation_rules VALUES (1107, 'SonicWall Encrypted Threats Detection', 3, 3, 2, 'Command and Control', 'T1573 - Encrypted Channel', 'Detects threats hidden in encrypted traffic identified by SonicWall DPI-SSL (Deep Packet Inspection of SSL/TLS) including malware, exploits, and data exfiltration attempts over encrypted channels. This rule identifies when SonicWall''s advanced threat protection has detected malicious activity within encrypted communications.

Next Steps:
1. Review the specific threat type and category identified in the event details
2. Examine the source and destination IP addresses for indicators of compromise
3. Check the SSL/TLS certificate details and validation status
4. Investigate the application or service attempting the encrypted communication
5. Review network traffic patterns to identify potential data exfiltration
6. Consider temporarily blocking the source IP if malicious activity is confirmed
7. Update security policies to prevent similar encrypted threats
8. Document findings for threat intelligence and future prevention
', '["https://www.sonicwall.com/solutions/advanced-threats/encrypted-threats/","https://attack.mitre.org/techniques/T1573/"]', '(safe("log.eventName", "").contains("SSL") || safe("log.eventName", "").contains("TLS") || safe("log.eventName", "").contains("encrypted") || safe("log.eventName", "").contains("DPI-SSL") || safe("log.msg", "").contains("SSL") || safe("log.msg", "").contains("TLS") || safe("log.msg", "").contains("encrypted") || safe("protocol", "").contains("SSL") || safe("protocol", "").contains("TLS")) && (safe("log.eventName", "").contains("threat") || safe("log.eventName", "").contains("malware") || safe("log.eventName", "").contains("blocked") || safe("log.eventName", "").contains("violation") || safe("log.msg", "").contains("threat") || safe("log.msg", "").contains("malware") || safe("log.msg", "").contains("blocked") || safe("actionResult", "") == "blocked" || safe("action", "") == "blocked" || safe("log.ipscat", "") != "" || safe("log.spycat", "") != "")', '2025-09-04 15:38:53.661964', true, false, 'origin', NULL, '[]');
INSERT INTO public.utm_correlation_rules VALUES (1108, 'SonicWall Endpoint Security Alert', 3, 3, 2, 'Execution', 'T1204.002 - User Execution: Malicious File', 'Detects endpoint security alerts from SonicWall including malware detection, suspicious process activity, or endpoint compromise indicators. This rule triggers on various endpoint security events such as spyware detection, malware identification, threat blocking, or suspicious file activity.

Next Steps:
1. Immediately isolate the affected endpoint from the network if possible
2. Review the specific threat details in log.spycat and log.spypri fields
3. Check if the malicious file was successfully blocked or if remediation is needed
4. Examine the file hash and path details to understand the threat scope
5. Scan the affected system with updated antivirus/anti-malware tools
6. Review recent user activity on the affected endpoint
7. Check for lateral movement indicators from the compromised endpoint
8. Update endpoint protection signatures and policies if necessary
9. Document the incident and implement additional monitoring for the affected user/system
', '["https://www.sonicwall.com/techdocs/pdf/sonicos-6-5-4-log-events-reference-guide.pdf","https://attack.mitre.org/techniques/T1204/002/"]', '(safe("log.category", "").contains("Endpoint") || safe("log.msg", "").contains("endpoint")) && (safe("log.spycat", "") != "" || safe("log.spypri", "") != "" || safe("action", "") == "drop" || safe("log.msg", "").contains("malware") || safe("log.msg", "").contains("threat"))', '2025-09-04 15:38:54.240576', true, false, 'origin', NULL, '[]');
INSERT INTO public.utm_correlation_rules VALUES (1109, 'SonicWall Gateway Anti-Virus Detection', 3, 3, 2, 'Command and Control', 'T1105 - Ingress Tool Transfer', 'Detects when SonicWall Gateway Anti-Virus (GAV) identifies and blocks malicious content. This indicates potential malware attempting to enter the network through web traffic, email attachments, or file downloads. The Gateway Anti-Virus service scans HTTP, HTTPS, FTP, and SMTP traffic in real-time to detect and prevent malware from entering the network perimeter.

Next Steps:
1. Review the specific malware signature or threat name in the log details
2. Investigate the source IP address and geolocation for suspicious patterns
3. Check if the same source has attempted other malicious activities
4. Verify that the anti-virus definitions are up to date
5. Consider implementing additional network segmentation if internal hosts are affected
6. Review firewall policies to ensure proper traffic filtering
7. Escalate to incident response team if part of a coordinated attack campaign
', '["https://www.sonicwall.com/techdocs/pdf/sonicos-6-5-4-log-events-reference-guide.pdf","https://attack.mitre.org/techniques/T1105/"]', '(safe("log.gcat", "").contains("Gateway Anti-Virus") || safe("log.msg", "").contains("virus") || safe("log.msg", "").contains("malware") || safe("log.eventName", "").contains("Anti-Virus") || safe("log.category", "").contains("Anti-Virus")) && safe("action", "") == "blocked"', '2025-09-04 15:38:54.882633', true, false, 'origin', NULL, '[]');
INSERT INTO public.utm_correlation_rules VALUES (1111, 'SonicWall High Availability Failover Detection', 1, 2, 3, 'Impact', 'T1489 - Service Stop', 'Detects high availability failover events and cluster state changes in SonicWall firewalls which could indicate system issues, attacks on availability, or legitimate maintenance activities. HA failover events can signal hardware failures, network connectivity issues, or potential attacks targeting system availability.

Next Steps:
1. Verify if the failover was planned maintenance or an unexpected event
2. Check the health status of both primary and secondary firewall units
3. Review network connectivity between HA cluster members
4. Examine system logs for hardware errors or resource exhaustion
5. Validate that the secondary unit successfully assumed primary role
6. Monitor for any service disruptions during the failover process
7. If unplanned, investigate potential causes such as DoS attacks or hardware failures
', '["https://www.sonicwall.com/techdocs/pdf/sonicos-6-5-4-log-events-reference-guide.pdf","https://attack.mitre.org/techniques/T1489/"]', 'safe("log.category", "").contains("High Availability") || safe("log.eventName", "").contains("HA") || safe("log.msg", "").contains("failover") || safe("log.msg", "").contains("standby") || safe("log.msg", "").contains("primary") || safe("log.msg", "").contains("cluster") || safe("log.msg", "").contains("heartbeat") || safe("log.usestandbysa", "") != ""', '2025-09-04 15:38:56.18889', true, false, 'origin', NULL, '[]');
INSERT INTO public.utm_correlation_rules VALUES (1112, 'SonicWall Intrusion Prevention System Alert', 3, 3, 3, 'Initial Access', 'T1190 - Exploit Public-Facing Application', 'Detects when SonicWall IPS identifies and blocks intrusion attempts, including buffer overflows, SQL injection, cross-site scripting, and other network-based attacks targeting vulnerabilities. This rule triggers when the SonicWall firewall''s Intrusion Prevention System detects malicious traffic patterns or known attack signatures.

Next Steps:
1. Verify the blocked attack by reviewing the SonicWall logs for attack details and signatures matched
2. Check if the attack was successfully blocked or if any traffic bypassed the IPS
3. Investigate the source IP for additional malicious activity or patterns
4. Review target systems for any signs of compromise if the attack was not fully blocked
5. Update IPS signatures if new attack patterns are discovered
6. Consider implementing additional network segmentation if attacks are targeting critical systems
7. Review and update security policies if necessary to prevent similar attacks
', '["https://www.sonicwall.com/techdocs/pdf/sonicos-6-5-4-log-events-reference-guide.pdf","https://attack.mitre.org/techniques/T1190/"]', '(safe("log.ipscat", "") != "" || safe("log.msg", "").contains("IPS") || safe("log.eventName", "").contains("Intrusion") || safe("log.category", "").contains("Intrusion Prevention") || safe("log.ipspri", "0") != "0") && (safe("action", "") == "blocked" || safe("action", "") in ["block", "drop", "deny"])', '2025-09-04 15:38:56.795849', true, false, 'origin', NULL, '[]');
INSERT INTO public.utm_correlation_rules VALUES (1113, 'SonicWall License Expiration Warning', 1, 1, 3, 'Impact', 'T1489 - Service Stop', 'Detects license expiration warnings for SonicWall services including security subscriptions, support licenses, and feature licenses that may impact security protection capabilities. When licenses expire, critical security features like intrusion prevention, content filtering, and antivirus scanning may be disabled, leaving the network vulnerable to attacks.

**Next Steps:**
1. Check the specific license type and expiration date mentioned in the alert
2. Contact SonicWall support or licensing team to renew the expired or expiring license
3. Verify that all security services are still functioning properly
4. Review license management processes to prevent future expirations
5. Consider setting up automated license monitoring and renewal processes
6. Document the incident and update license tracking systems
', '["https://www.sonicguard.com/License-and-Subscription.asp","https://attack.mitre.org/techniques/T1489/"]', '(safe("log.eventName", "").contains("license") || safe("log.eventName", "").contains("subscription") || safe("log.eventName", "").contains("expir") || safe("log.msg", "").contains("license") || safe("log.msg", "").contains("subscription") || safe("log.msg", "").contains("expir") || safe("log.lic", "") != "") && (safe("log.eventName", "").contains("warning") || safe("log.eventName", "").contains("alert") || safe("log.eventName", "").contains("critical") || safe("log.eventName", "").contains("will expire") || safe("log.eventName", "").contains("has expired") || safe("log.msg", "").contains("warning") || safe("log.msg", "").contains("will expire") || safe("log.msg", "").contains("has expired") || safe("log.msg", "").contains("days remaining") || safe("severity", "") == "high")', '2025-09-04 15:38:57.409921', true, false, 'origin', '["origin.host","log.lic"]', '[]');
INSERT INTO public.utm_correlation_rules VALUES (1114, 'SonicWall NAT Policy Violations', 2, 3, 2, 'Command and Control', 'T1572 - Protocol Tunneling', 'Detects NAT policy violations or unusual NAT translations that could indicate attempts to bypass network segmentation or perform unauthorized network access. This rule identifies failed NAT operations, translation errors, or policy violations that may suggest malicious activity such as network reconnaissance, lateral movement attempts, or efforts to circumvent network security controls.

Next Steps:
1. Review the specific NAT policy that was violated and the source/destination addresses involved
2. Investigate the origin IP address for other suspicious network activities
3. Check if the violation represents a legitimate configuration issue or potential security threat
4. Examine network logs for patterns of similar violations from the same source
5. Validate NAT configuration and policies to ensure they align with security requirements
6. Consider implementing additional monitoring for the affected network segments
', '["https://www.sonicwall.com/techdocs/pdf/sonicos-6-5-4-log-events-reference-guide.pdf","https://attack.mitre.org/techniques/T1572/"]', '(safe("log.natSrc", "") != "" || safe("log.natDst", "") != "" || safe("log.natSrcV6", "") != "" || safe("log.natDstV6", "") != "") && (safe("log.msg", "").contains("NAT") || safe("log.msg", "").contains("translation") || safe("log.category", "").contains("NAT")) && (safe("action", "") == "deny" || safe("log.msg", "").contains("fail") || safe("log.msg", "").contains("error") || safe("log.msg", "").contains("violation"))', '2025-09-04 15:39:17.335208', true, false, 'origin', NULL, '[]');
INSERT INTO public.utm_correlation_rules VALUES (1115, 'SonicWall Real-Time Blacklist Detection', 3, 2, 2, 'Command and Control', 'T1071 - Application Layer Protocol', 'Detects connections to blacklisted IPs or domains in real-time, indicating potential malware communication or compromise. This rule triggers when SonicWall firewall blocks traffic based on threat intelligence feeds or blacklist databases.

Next Steps:
1. Investigate the source IP and determine if it''s a legitimate internal system
2. Check the destination IP/domain reputation using threat intelligence sources
3. Review recent activities on the affected system for signs of compromise
4. Examine network logs for additional communication attempts to suspicious destinations
5. Consider isolating the affected system if malware infection is suspected
6. Update endpoint security tools and run full system scans
7. Review firewall logs for patterns of blocked connections from the same source
', '["https://www.sonicwall.com/techdocs/pdf/sonicos-6-5-4-log-events-reference-guide.pdf","https://attack.mitre.org/techniques/T1071/"]', 'safe("action", "") in ["blocked", "drop", "deny"] && (safe("log.category", "") == "Blacklist" || safe("log.msg", "").contains("blacklist") || safe("log.gcat", "") == "Malicious")', '2025-09-04 15:39:17.904204', true, false, 'origin', NULL, '[]');
INSERT INTO public.utm_correlation_rules VALUES (1120, 'CEF Parsing Failures Detection', 1, 3, 2, 'Defense Evasion', 'T1070 - Indicator Removal on Host: Log Injection', 'Detects CEF parsing failures which may indicate malformed logs, log injection attempts, or configuration issues. Failed parsing can hide malicious activities or indicate system problems. CEF (Common Event Format) logs that fail to parse correctly could be signs of tampering, injection attacks, or misconfigured log sources.

Next Steps:
1. Review the original log message for malformation or suspicious content
2. Check if the log source is properly configured for CEF format
3. Investigate if there are patterns in parsing failures from specific sources
4. Verify log integrity and check for signs of tampering
5. Review recent changes to log collection infrastructure
6. Check for potential log injection or evasion attempts
', '["https://www.microfocus.com/documentation/arcsight/arcsight-smartconnectors-8.4/pdfdoc/cef-implementation-standard/cef-implementation-standard.pdf","https://attack.mitre.org/techniques/T1070/"]', '(safe("log.cef_version", "") == "" ||
 safe("log.cef_version", "") != "0") &&
safe("log.message", "").contains("CEF:") &&
(safe("log.parse_error", "") != "" ||
 safe("log.error", "").contains("CEF") ||
 "cef_parse_failure" in safe("log.tags", []) ||
 !safe("log.message", "").matches("^.*CEF:\\d+\\|[^|]+\\|[^|]+\\|[^|]+\\|[^|]+\\|[^|]+\\|[^|]+\\|.*$"))
', '2025-09-04 16:00:12.5349', true, false, 'origin', '["lastEvent.origin.ip","log.source"]', '[]');
INSERT INTO public.utm_correlation_rules VALUES (1116, 'SonicWave Wireless Security Threat Detection', 3, 2, 2, 'Wireless Security', 'T1465 - Rogue Access Point', 'Detects wireless security threats including rogue access points, association floods, and suspicious wireless activity detected by SonicWave access points. This rule identifies unauthorized wireless devices, attack patterns, and security violations in the wireless network infrastructure.

Next Steps:
1. Immediately investigate the source MAC address and IP associated with the wireless threat
2. Check SonicWave access point logs for additional context and attack patterns
3. Verify if the detected device is authorized on the wireless network
4. For rogue access points: Physically locate and remove unauthorized devices
5. Review wireless security policies and access point configurations
6. Check for signs of data exfiltration or unauthorized network access
7. Update wireless intrusion detection signatures if new attack patterns are identified
8. Consider implementing additional wireless monitoring and access controls
9. Document the incident and update security procedures if necessary
', '["https://www.sonicwall.com/support/knowledge-base/how-to-configure-rogue-access-point-detection-in-wireless-intrusion-detection-settings-ids/170505975277527/","https://attack.mitre.org/techniques/T1465/"]', '(safe("log.category", "") == "WLAN IDS" || safe("log.eventName", "").contains("wireless") || safe("log.eventName", "").contains("rogue") || safe("log.msg", "").contains("rogue") || safe("log.msg", "").contains("wireless")) && (safe("log.eventName", "").contains("attack") || safe("log.eventName", "").contains("flood") || safe("log.eventName", "").contains("unauthorized") || safe("log.msg", "").contains("attack") || safe("log.msg", "").contains("flood") || safe("log.msg", "").contains("unauthorized") || safe("log.result", "") == "blocked" || safe("action", "") == "blocked" || safe("severity", "") == "high")', '2025-09-04 15:39:18.431074', true, false, 'origin', NULL, '[]');
INSERT INTO public.utm_correlation_rules VALUES (1117, 'SonicWall VPN Tunnel Anomalies Detection', 3, 2, 3, 'Persistence, Initial Access', 'T1133 - External Remote Services', 'Detects anomalies in VPN tunnel connections including excessive connection attempts, unusual connection patterns, or VPN errors that may indicate attempted exploitation or unauthorized access attempts. This rule monitors for VPN-related events that contain error conditions, failures, timeouts, or disconnections which could signal malicious activity or reconnaissance.

Next Steps:
1. Review the specific VPN error messages and connection patterns from the source IP
2. Check if the source IP has legitimate business reasons to connect via VPN
3. Examine authentication logs for failed login attempts from the same source
4. Verify if the VPN policy being accessed is appropriate for the user/source
5. Consider implementing additional VPN access controls if patterns suggest abuse
6. Monitor for lateral movement attempts if VPN access was successful
', '["https://www.sonicwall.com/techdocs/pdf/sonicos-6-5-4-log-events-reference-guide.pdf","https://attack.mitre.org/techniques/T1133/"]', '(safe("log.vpnpolicy", "") != "" || safe("log.category", "").contains("VPN") || safe("log.eventName", "").contains("VPN") || safe("log.msg", "").contains("VPN")) && (safe("log.msg", "").contains("error") || safe("log.msg", "").contains("fail") || safe("log.msg", "").contains("timeout") || safe("log.msg", "").contains("disconnect") || safe("actionResult", "").contains("fail"))', '2025-09-04 15:39:18.920053', true, false, 'origin', NULL, '[{"indexPattern":"v11-log-firewall-sonicwall-*","with":[{"field":"origin.ip.keyword","operator":"filter_term","value":"{{.origin.ip}}"}],"or":null,"within":"now-15m","count":10}]');
INSERT INTO public.utm_correlation_rules VALUES (1118, 'SonicWall Zero-Day Threat Detection', 3, 3, 3, 'Initial Access', 'T1190 - Exploit Public-Facing Application', 'Detects zero-day threats and unknown malware identified by SonicWall Capture ATP service including sandbox detonations and RTDMI (Real-Time Deep Memory Inspection) alerts. This rule triggers when the SonicWall firewall identifies previously unknown threats through advanced analysis techniques.

Next Steps:
1. Immediately isolate the affected system from the network if possible
2. Review the full event details including file hashes, URLs, and source IPs
3. Check if the threat was successfully blocked or if additional containment is needed
4. Update threat intelligence feeds and IOCs based on the detected indicators
5. Perform forensic analysis on any systems that may have been compromised
6. Review firewall rules and security policies to ensure adequate protection
7. Document the incident and update incident response procedures if necessary
', '["https://www.sonicwall.com/support/knowledge-base/capture-advanced-threat-protection-feature-overview/170504863294345","https://attack.mitre.org/techniques/T1190/"]', '(safe("log.eventName", "").contains("ATP") || safe("log.eventName", "").contains("zero-day") || safe("log.eventName", "").contains("unknown") || safe("log.eventName", "").contains("sandbox") || safe("log.eventName", "").contains("RTDMI") || safe("log.msg", "").contains("ATP") || safe("log.msg", "").contains("zero-day") || safe("log.msg", "").contains("unknown malware") || safe("log.msg", "").contains("sandbox")) && (safe("log.eventName", "").contains("detected") || safe("log.eventName", "").contains("blocked") || safe("log.msg", "").contains("detected") || safe("log.msg", "").contains("blocked") || safe("actionResult", "") == "blocked" || safe("action", "") == "blocked" || safe("severity", "") == "high")', '2025-09-04 15:39:19.770026', true, false, 'origin', NULL, '[]');
INSERT INTO public.utm_correlation_rules VALUES (1119, 'CEF Suspicious Action Field Patterns', 3, 3, 2, 'Defense Evasion', 'T1562 - Impair Defenses', 'Detects suspicious patterns in CEF action fields (act/deviceAction) that may indicate security policy bypasses, malicious activities, or attempts to evade detection through action manipulation. This rule identifies potentially malicious actions such as bypassing security controls, disabling protective mechanisms, or unusual action field values that deviate from normal patterns.

Next Steps:
1. Review the specific action field value and context of the event
2. Investigate the source device/application generating the CEF event
3. Check if the action is part of legitimate administrative activity
4. Examine recent events from the same source for patterns of suspicious activity
5. Verify if security controls or monitoring systems have been compromised
6. Cross-reference with threat intelligence for known attack patterns
7. If confirmed malicious, implement containment measures and review security policies
', '["https://www.microfocus.com/documentation/arcsight/arcsight-smartconnectors-8.3/cef-implementation-standard/Content/CEF/Chapter%202%20ArcSight%20Extension.htm","https://attack.mitre.org/techniques/T1562/"]', 'safe("log.act", "") != "" &&
(
  safe("log.act", "").lowerAscii().contains("bypass") ||
  safe("log.act", "").lowerAscii().contains("override") ||
  safe("log.act", "").lowerAscii().contains("disable") ||
  safe("log.act", "").lowerAscii().contains("stop") ||
  safe("log.act", "").lowerAscii().contains("kill") ||
  safe("log.act", "").lowerAscii().contains("terminate") ||
  safe("log.act", "").lowerAscii().contains("delete") ||
  safe("log.act", "").lowerAscii().contains("remove") ||
  safe("log.act", "").lowerAscii().contains("erase") ||
  safe("log.act", "").lowerAscii().contains("destroy") ||
  (safe("log.act", "").lowerAscii() == "allowed" && safe("log.severity", "") matches "^(8|9|10)$") ||
  (safe("log.act", "").lowerAscii() == "blocked" && safe("log.severity", "") matches "^(0|1|2)$") ||
  safe("log.act", "").matches("^[0-9]+$") ||
  safe("log.act", "").length() > 50 ||
  safe("log.act", "").contains("${") ||
  safe("log.act", "").contains("$(") ||
  safe("log.act", "").contains("`")
)
', '2025-09-04 16:00:11.743444', true, false, 'origin', '["origin.ip","log.act"]', '[{"indexPattern":"v11-log-syslog-*","with":[{"field":"origin.ip.keyword","operator":"filter_term","value":"{{.origin.ip}}"},{"field":"log.act.keyword","operator":"filter_term","value":"{{.log.act}}"}],"or":null,"within":"now-2h","count":15}]');
INSERT INTO public.utm_correlation_rules VALUES (1463, 'Windows Defender: ERROR: BAD CONFIGURATION', 1, 2, 3, 'Potentially Compromised System', 'User Execution', 'Detects the ''BAD CONFIGURATION'' error event in Windows Defender, which may indicate a misconfiguration or issue with the security settings.', '["https://learn.microsoft.com/en-us/windows/security/threat-protection/windows-defender-antivirus/troubleshoot"]', 'safe("log.winlogEventDataLogName", "") == "Microsoft-Windows-Windows Defender/Operational" &&  safe("log.winlogEventDataErrorCode", "") == "0x80508020"', '2025-09-04 21:11:27.802007', true, false, 'target', NULL, '[]');
INSERT INTO public.utm_correlation_rules VALUES (1121, 'CEF Custom Field Abuse Detection', 3, 3, 2, 'Defense Evasion', 'Protocol Manipulation', 'Detects potential abuse of CEF custom fields (cn, cs, flexString) where attackers may hide malicious content or bypass security controls by using custom fields inappropriately. This includes detection of script injection attempts, encoded payloads, sensitive data exposure, and unusually large field values that may indicate data exfiltration or buffer overflow attempts.

Next Steps:
1. Review the specific CEF custom fields that triggered the alert (cs1-cs6, flexString1-flexString2, cn1-cn6)
2. Analyze the content of the flagged custom fields for malicious patterns
3. Check if the source device/application is properly configured and authorized to use these custom fields
4. Correlate with other security events from the same source IP or device
5. If script injection is detected, check for potential web application vulnerabilities
6. For encoded content, decode and analyze the payload for malicious intent
7. Review security device configurations to ensure proper field validation
8. Consider implementing additional input validation on systems generating CEF logs
', '["https://www.microfocus.com/documentation/arcsight/arcsight-smartconnectors-8.3/cef-implementation-standard/Content/CEF/Chapter%202%20ArcSight%20Extension.htm","https://attack.mitre.org/techniques/T1036/"]', '(
  (safe("log.cs1", "").contains("<script") || safe("log.cs2", "").contains("<script") ||
   safe("log.cs3", "").contains("<script") || safe("log.cs4", "").contains("<script") ||
   safe("log.cs5", "").contains("<script") || safe("log.cs6", "").contains("<script")) ||
  (safe("log.flexString1", "").contains("eval(") || safe("log.flexString2", "").contains("eval(")) ||
  (safe("log.cs1", "").matches(".*\\\\x[0-9a-fA-F]{2}.*") || safe("log.cs2", "").matches(".*\\\\x[0-9a-fA-F]{2}.*")) ||
  (safe("log.cn1Label", "").contains("password") || safe("log.cn2Label", "").contains("password") ||
   safe("log.cs1Label", "").contains("password") || safe("log.cs2Label", "").contains("password")) ||
  (safe("log.cs1", "").size() > 1000 || safe("log.cs2", "").size() > 1000 ||
   safe("log.flexString1", "").size() > 1000 || safe("log.flexString2", "").size() > 1000)
)
', '2025-09-04 16:00:13.120781', true, false, 'origin', '["origin.ip","log.deviceVendor"]', '[]');
INSERT INTO public.utm_correlation_rules VALUES (1122, 'CEF Delimiter Escaping Failures', 2, 3, 2, 'Defense Evasion', 'T1070.003 - Indicator Removal on Host: Clear Command History', 'Detects improper escaping of pipe delimiters in CEF (Common Event Format) messages which can lead to field injection, log parsing errors, or attempts to manipulate log analysis. CEF format requires pipe characters (|) to be escaped with backslashes (\\|) when they appear in field values. Unescaped pipes can cause parsing confusion, field boundary corruption, and potential log injection attacks.

**Next Steps:**
1. Review the source system generating malformed CEF messages
2. Check if this represents a legitimate configuration issue or potential attack attempt
3. Examine the raw log message for signs of intentional manipulation
4. Verify CEF parser configuration and update if necessary
5. Monitor for additional malformed messages from the same source
6. Consider implementing stricter input validation on log sources
7. Review access controls for systems generating CEF logs
', '["https://www.microfocus.com/documentation/arcsight/arcsight-smartconnectors-8.3/cef-implementation-standard/Content/CEF/Chapter%201%20What%20is%20CEF.htm","https://attack.mitre.org/techniques/T1070/003/"]', '(
  (safe("log.deviceVendor", "").contains("|") && !safe("log.deviceVendor", "").contains("\\|")) ||
  (safe("log.deviceProduct", "").contains("|") && !safe("log.deviceProduct", "").contains("\\|")) ||
  (safe("log.deviceVersion", "").contains("|") && !safe("log.deviceVersion", "").contains("\\|")) ||
  (safe("log.name", "").contains("|") && !safe("log.name", "").contains("\\|")) ||
  (safe("log.message", "").matches(".*[^\\\\]\\|.*\\|.*\\|.*\\|.*\\|.*\\|.*\\|.*") &&
   !safe("log.message", "").startsWith("CEF:")) ||
  (safe("log.cs1", "").contains("|") && !safe("log.cs1", "").contains("\\|")) ||
  (safe("log.cs2", "").contains("|") && !safe("log.cs2", "").contains("\\|")) ||
  (safe("log.message", "").matches(".*=.*\\|.*=.*") &&
   safe("log.message", "").matches(".*[^\\\\]=.*\\|.*"))
)
', '2025-09-04 16:00:13.692026', true, false, 'origin', '["lastEvent.origin.ip","log.deviceVendor","log.deviceProduct"]', '[]');
INSERT INTO public.utm_correlation_rules VALUES (1123, 'CEF Device Event Class ID Anomalies', 2, 3, 2, 'Defense Evasion', 'System Activity Monitoring', 'Detects unusual or suspicious device event class IDs in CEF logs that may indicate malicious activity, system compromise, or attempts to evade detection through log manipulation. This rule identifies CEF events with anomalous deviceEventClassId values including null/zero values, excessively long IDs, test/debug strings, or non-numeric formats that deviate from standard CEF specifications.

Next Steps:
1. Review the source device and validate if the deviceEventClassId is legitimate
2. Check if the device configuration has been tampered with or misconfigured
3. Correlate with other security events from the same source IP/device
4. Verify the integrity of log forwarding mechanisms and CEF parsers
5. If confirmed malicious, investigate for potential log evasion or system compromise
', '["https://www.microfocus.com/documentation/arcsight/arcsight-smartconnectors-8.4/pdfdoc/cef-implementation-standard/cef-implementation-standard.pdf","https://attack.mitre.org/techniques/T1070/"]', 'safe("log.deviceEventClassId", "") != "" &&
(
  safe("log.deviceEventClassId", "") == "0" ||
  safe("log.deviceEventClassId", "") == "999999" ||
  safe("log.deviceEventClassId", "").matches("^[A-Za-z]+$") ||
  safe("log.deviceEventClassId", "").contains("test") ||
  safe("log.deviceEventClassId", "").contains("debug") ||
  safe("log.deviceEventClassId", "").size() > 10
)
', '2025-09-04 16:00:14.269081', true, false, 'origin', '["lastEvent.origin.ip","log.deviceEventClassId"]', '[]');
INSERT INTO public.utm_correlation_rules VALUES (1124, 'CEF Device Product Inconsistencies', 2, 3, 1, 'Defense Evasion', 'T1036 - Masquerading', 'Detects inconsistencies in CEF device product fields that may indicate log tampering, spoofing attempts, or misconfigured logging infrastructure. This rule identifies when device vendor and product combinations don''t match expected patterns, or when generic placeholder values are used.

Next Steps:
1. Verify the authenticity of the source device by checking network connectivity and device configuration
2. Review log forwarding infrastructure for potential compromise or misconfiguration
3. Cross-reference device inventory to confirm legitimate vendor/product combinations
4. Investigate if the source IP has been generating consistent inconsistencies over time
5. Check for signs of log injection or manipulation attacks
6. Validate CEF format compliance and parsing accuracy
7. Review security controls on log collection and forwarding systems
8. Consider implementing device fingerprinting for log source validation
', '["https://www.microfocus.com/documentation/arcsight/arcsight-cef-23/","https://attack.mitre.org/techniques/T1036/"]', 'safe("log.deviceProduct", "") != "" &&
safe("log.deviceVendor", "") != "" &&
(
  (safe("log.deviceVendor", "") == "ArcSight" && !safe("log.deviceProduct", "").contains("Logger")) ||
  (safe("log.deviceVendor", "") == "Check Point" && !safe("log.deviceProduct", "").matches("(SmartDefense|Firewall|VPN)")) ||
  (safe("log.deviceVendor", "") == "Cisco" && !safe("log.deviceProduct", "").matches("(ASA|IDS|IPS|ISE)")) ||
  (safe("log.deviceProduct", "").contains("Unknown") || safe("log.deviceProduct", "").contains("N/A"))
)
', '2025-09-04 16:00:14.840364', true, false, 'origin', '["origin.ip","log.deviceVendor"]', '[{"indexPattern":"v11-log-syslog-*","with":[{"field":"origin.ip.keyword","operator":"filter_term","value":"{{.origin.ip}}"},{"field":"log.deviceVendor.keyword","operator":"filter_term","value":"{{.log.deviceVendor}}"}],"or":null,"within":"now-15m","count":10}]');
INSERT INTO public.utm_correlation_rules VALUES (1130, 'CEF File Hash Mismatch Detection', 3, 3, 2, 'Impact', 'T1565.001 - Data Manipulation: Stored Data Manipulation', 'Detects file hash mismatches in CEF logs which may indicate file tampering, malware infection, or unauthorized modifications to critical files. This rule monitors custom string fields (cs1-cs6) for hash values and their labels, as well as dedicated hash fields to identify discrepancies.

**Next Steps:**
1. Verify the affected file integrity by recalculating its hash
2. Check if the file modification was authorized and documented
3. Investigate the source and timing of the file change
4. Review system logs for unauthorized access or malware activity
5. Compare with known good file versions or backups
6. If malicious activity is confirmed, isolate the affected system and initiate incident response procedures
', '["https://attack.mitre.org/techniques/T1565/001/","https://www.microfocus.com/documentation/arcsight/arcsight-smartconnectors-8.4/pdfdoc/cef-implementation-standard/cef-implementation-standard.pdf"]', 'safe("log.dataType", "") == "cef" &&
(
  (safe("log.cs1Label", "") in ["hash", "fileHash", "md5", "sha1", "sha256"] && safe("log.cs1", "") != "" && safe("log.message", "").contains("mismatch")) ||
  (safe("log.cs2Label", "") in ["hash", "fileHash", "md5", "sha1", "sha256"] && safe("log.cs2", "") != "" && safe("log.message", "").contains("mismatch")) ||
  (safe("log.cs3Label", "") in ["hash", "fileHash", "md5", "sha1", "sha256"] && safe("log.cs3", "") != "" && safe("log.message", "").contains("mismatch")) ||
  (safe("log.cs4Label", "") in ["hash", "fileHash", "md5", "sha1", "sha256"] && safe("log.cs4", "") != "" && safe("log.message", "").contains("mismatch")) ||
  (safe("log.cs5Label", "") in ["hash", "fileHash", "md5", "sha1", "sha256"] && safe("log.cs5", "") != "" && safe("log.message", "").contains("mismatch")) ||
  (safe("log.cs6Label", "") in ["hash", "fileHash", "md5", "sha1", "sha256"] && safe("log.cs6", "") != "" && safe("log.message", "").contains("mismatch")) ||
  (safe("log.fileHash", "") != "" && safe("log.message", "").contains("mismatch")) ||
  (safe("log.oldFileHash", "") != "" && safe("log.fileHash", "") != "" && safe("log.oldFileHash", "") != safe("log.fileHash", "")) ||
  safe("log.message", "").contains("hash mismatch") ||
  safe("log.message", "").contains("checksum failure") ||
  safe("log.message", "").contains("integrity violation")
)
', '2025-09-04 16:00:47.080172', true, false, 'origin', '["adversary.host","log.fname"]', '[]');
INSERT INTO public.utm_correlation_rules VALUES (1126, 'CEF Device Version Changes', 1, 3, 2, 'Defense Evasion', 'T1562.001 - Impair Defenses: Disable or Modify Tools', 'Detects unexpected device version changes in CEF logs which may indicate log source tampering or unauthorized modifications. This rule identifies suspicious version strings that contain special characters, are unusually long, or contain test/debug indicators.

Next Steps:
1. Verify if the device version change was authorized through change management
2. Check the source device for signs of compromise or configuration tampering
3. Review other logs from the same device for additional suspicious activities
4. Validate the integrity of the log source and its configuration
5. If unauthorized, investigate potential security tool evasion attempts
', '["https://www.microfocus.com/documentation/arcsight/arcsight-cef-23/","https://attack.mitre.org/techniques/T1562/001/"]', 'safe("log.deviceVersion", "") != "" &&
safe("log.deviceProduct", "") != "" &&
safe("log.deviceVendor", "") != "" &&
(
  safe("log.deviceVersion", "").matches(".*[<>\"'';&|].*") ||
  safe("log.deviceVersion", "").length() > 50 ||
  safe("log.deviceVersion", "").contains("test") ||
  safe("log.deviceVersion", "").contains("debug")
)
', '2025-09-04 16:00:16.091669', true, false, 'origin', '["lastEvent.origin.ip","log.deviceProduct"]', '[{"indexPattern":"v11-log-syslog-*","with":[{"field":"origin.ip.keyword","operator":"filter_term","value":"{{.origin.ip}}"},{"field":"log.deviceProduct.keyword","operator":"filter_term","value":"{{.log.deviceProduct}}"}],"or":null,"within":"now-1h","count":3}]');
INSERT INTO public.utm_correlation_rules VALUES (1127, 'CEF Encoding Issues Detection', 2, 3, 2, 'Command and Control', 'T1132 - Data Encoding', 'Detects encoding issues in CEF (Common Event Format) messages that may indicate data corruption, attack attempts to bypass parsing, or misconfigured systems not properly encoding UTF-8 characters. This includes detection of invalid UTF-8 sequences, excessive URL encoding, malformed Unicode escapes, control characters in vendor/product fields, and invalid CEF version numbers.

Next Steps:
1. Examine the raw CEF message for encoding anomalies
2. Check the source system configuration for proper UTF-8 encoding
3. Verify if this is a legitimate system misconfiguration or potential evasion attempt
4. Review recent changes to the source system or network infrastructure
5. Correlate with other suspicious activities from the same source IP
6. Update parsing rules if legitimate encoding variations are identified
', '["https://www.microfocus.com/documentation/arcsight/arcsight-smartconnectors-8.4/pdfdoc/cef-implementation-standard/cef-implementation-standard.pdf","https://attack.mitre.org/techniques/T1132/"]', '(
  safe("log.message", "").contains("\\xc0") || safe("log.message", "").contains("\\xc1") ||
  safe("log.message", "").contains("\\xfe") || safe("log.message", "").contains("\\xff") ||
  safe("log.message", "").contains("\\x00") ||
  safe("log.name", "").matches(".*[\\x80-\\xff].*") ||
  safe("log.deviceProduct", "").matches(".*[\\x00-\\x1f].*") ||
  safe("log.deviceVendor", "").matches(".*[\\x00-\\x1f].*") ||
  (safe("log.message", "").contains("&#") && safe("log.message", "").matches(".*&#[0-9]{4,};.*")) ||
  safe("log.message", "").matches(".*(%[0-9a-fA-F]{2}){10,}.*") ||
  (safe("log.cef_version", "") != "0" && safe("log.cef_version", "") != "1") ||
  safe("log.message", "").matches(".*\\\\u[0-9a-fA-F]{4}.*\\\\u[0-9a-fA-F]{4}.*\\\\u[0-9a-fA-F]{4}.*")
)
', '2025-09-04 16:00:16.912567', true, false, 'origin', '["origin.ip","log.deviceProduct"]', '[]');
INSERT INTO public.utm_correlation_rules VALUES (1128, 'CEF Extension Field Violations', 3, 3, 1, 'Defense Evasion', 'T1070.002 - Indicator Removal on Host: Clear Linux or Mac System Logs', 'Detects violations in CEF extension fields including invalid key-value pairs, malformed extensions, or suspicious field names that could indicate log injection or tampering attempts. CEF extension fields should follow proper key=value format and contain only legitimate data.

Next Steps:
1. Review the source device and investigate if it has been compromised
2. Examine the malformed CEF extension fields for signs of injection attempts
3. Check for other anomalous logs from the same source device or IP address
4. Verify the integrity of the logging infrastructure and security controls
5. If script tags or injection patterns are found, investigate for web-based attacks
6. Consider isolating the source device if compromise is suspected
', '["https://www.secef.net/wp-content/uploads/sites/10/2017/04/CommonEventFormatv23.pdf","https://attack.mitre.org/techniques/T1070/002/"]', '(safe("log.cef_extensions", "") != "" &&
 !safe("log.cef_extensions", "").matches("^[a-zA-Z0-9_]+=[^=\\s]+(\\s+[a-zA-Z0-9_]+=[^=\\s]+)*$")) ||
safe("log.cef_extensions", "").contains("<script") ||
safe("log.cef_extensions", "").contains("javascript:") ||
safe("log.cef_extensions", "").contains("../") ||
safe("log.cef_extensions", "").matches(".*[\\x00-\\x1F].*") ||
(safe("log.extension_field_count", 0) > 100) ||
(safe("log.cef_extensions", "") != "" &&
 safe("log.cef_extensions", "").size() > 8192)
', '2025-09-04 16:00:17.677374', true, false, 'origin', '["origin.ip","dataSource"]', '[{"indexPattern":"v11-log-syslog-*","with":[{"field":"origin.ip.keyword","operator":"filter_term","value":"{{.origin.ip}}"},{"field":"log.cef_device_vendor.keyword","operator":"filter_term","value":"{{.safe(\"log.cef_device_vendor\", \"\")}}"}],"or":null,"within":"now-1h","count":3}]');
INSERT INTO public.utm_correlation_rules VALUES (1129, 'CEF Extension Key Violations', 3, 3, 1, 'Defense Evasion', 'T1036.004 - Masquerade Task or Service', 'Detects violations in CEF extension key naming conventions that may indicate malformed logs or evasion attempts. 
CEF (Common Event Format) has strict formatting requirements for extension keys, and violations could indicate 
malicious manipulation of log data to evade detection or analysis systems.

Next Steps:
1. Examine the raw CEF message to identify the specific formatting violation
2. Investigate the source device/application generating the malformed CEF logs
3. Check if the violation is due to configuration issues or potential tampering
4. Review other logs from the same source for additional anomalies
5. Verify the integrity of the logging infrastructure and data pipeline
6. Consider implementing stricter CEF validation at the collection point
7. Monitor for patterns of similar violations that might indicate systematic evasion attempts
', '["https://www.microfocus.com/documentation/arcsight/arcsight-cef-23/","https://attack.mitre.org/techniques/T1036/004/"]', 'safe("log.extensions", "") != "" &&
(
  safe("log.extensions", "").matches(".*[^a-zA-Z0-9=\\s]+=.*") ||
  safe("log.extensions", "").matches(".*=[^=]*=.*") ||
  safe("log.extensions", "").matches(".*\\s{2,}=.*") ||
  safe("log.extensions", "").contains("cs1Label=cs1Label") ||
  safe("log.extensions", "").contains("cn1Label=cn1Label") ||
  safe("log.extensions", "").matches(".*(cs[1-6]|cn[1-3]|cfp[1-4])=[^\\s]*\\s+(?!\\1Label=).*") ||
  safe("log.extensions", "").matches(".*Label=[^=]*Label=.*") ||
  safe("log.extensions", "").contains("deviceCustom") && !safe("log.extensions", "").contains("Label=") ||
  safe("log.extensions", "").matches(".*[A-Z]{10,}=.*") ||
  safe("log.extensions", "").contains("=\\x") ||
  safe("log.extensions", "").contains("=\\u")
)
', '2025-09-04 16:00:45.982896', true, false, 'origin', '["origin.ip","log.deviceProduct"]', '[]');
INSERT INTO public.utm_correlation_rules VALUES (1131, 'CEF Header Malformation Detection', 2, 3, 2, 'Impact', 'Protocol Anomaly', 'Detects malformed CEF (Common Event Format) headers that may indicate attacks attempting to bypass security monitoring, cause parsing failures, or hide malicious activity. This rule identifies various forms of CEF header malformation including incorrect format structure, invalid severity values, missing required fields, excessive field lengths, and malformed version indicators.

Next Steps:
1. Examine the source system generating the malformed CEF logs
2. Verify if the malformation is due to misconfiguration or potential attack
3. Check for patterns in the malformed data that might indicate injection attempts
4. Review the device vendor and product information for authenticity
5. Correlate with other security events from the same source IP or system
6. If intentional, review and update log parsing configurations
7. Consider implementing additional input validation on the source system
', '["https://www.microfocus.com/documentation/arcsight/arcsight-smartconnectors-8.4/pdfdoc/cef-implementation-standard/cef-implementation-standard.pdf","https://attack.mitre.org/techniques/T1499/"]', '(
  (!safe("log.message", "").startsWith("CEF:") && safe("log.dataType", "") == "cef") ||
  (safe("log.message", "").startsWith("CEF:") &&
   !safe("log.message", "").matches("^CEF:[0-9]\\|[^|]+\\|[^|]+\\|[^|]+\\|[^|]+\\|[^|]+\\|[0-9]{1,2}\\|.*")) ||
  (safe("log.severity", -1) > 10 || safe("log.severity", -1) < 0) ||
  (safe("log.cef_version", "") != "" && int(safe("log.cef_version", "0")) > 1) ||
  (safe("log.deviceVendor", "") == "" || safe("log.deviceProduct", "") == "" ||
   safe("log.deviceVersion", "") == "" || safe("log.name", "") == "") ||
  (safe("log.message", "").matches(".*CEF:[0-9]\\|{8,}.*")) ||
  (safe("log.message", "").contains("CEF:") &&
   safe("log.message", "").split("|").size() < 7) ||
  (safe("log.deviceEventClassId", "") == "" || safe("log.deviceEventClassId", "").size() > 1024) ||
  safe("log.message", "").matches(".*CEF:[^0-9].*")
)
', '2025-09-04 16:00:47.709105', true, false, 'origin', '["origin.ip","log.deviceVendor"]', '[]');
INSERT INTO public.utm_correlation_rules VALUES (1132, 'CEF Name Field Injection Attempts', 3, 3, 2, 'Defense Evasion, Privilege Escalation', 'T1055 - Process Injection', 'Detects potential injection attempts in CEF name fields that could be used for log poisoning or SIEM evasion. This rule identifies various injection patterns including newlines, pipes, CEF headers, script tags, URL encoding, HTML entities, and excessively long field values that may indicate malicious activity.

Next Steps:
1. Review the source IP address and user account associated with the injection attempt
2. Examine the full CEF log entry to understand the context and payload
3. Check for additional logs from the same source showing similar injection patterns
4. Verify if the source system has proper input validation and sanitization
5. Consider implementing additional logging controls or WAF rules if applicable
6. Assess if the injection attempt was successful and review any downstream systems that processed the log
', '["https://www.microfocus.com/documentation/arcsight/arcsight-cef-23/","https://attack.mitre.org/techniques/T1055/","https://owasp.org/www-community/attacks/Log_Injection"]', 'safe("log.name", "") != "" &&
(
  safe("log.name", "").contains("\n") ||
  safe("log.name", "").contains("\r") ||
  safe("log.name", "").contains("|") ||
  safe("log.name", "").matches(".*CEF:.*") ||
  safe("log.name", "").contains("<script") ||
  safe("log.name", "").contains("javascript:") ||
  safe("log.name", "").contains("onerror=") ||
  safe("log.name", "").contains("onclick=") ||
  safe("log.name", "").matches(".*\\\\u[0-9a-fA-F]{4}.*") ||
  safe("log.name", "").matches(".*%[0-9a-fA-F]{2}.*") ||
  safe("log.name", "").contains("&#") ||
  safe("log.name", "").contains("\\\\") ||
  safe("log.name", "").length() > 512
)
', '2025-09-04 16:00:48.942525', true, false, 'origin', '["origin.ip"]', '[]');
INSERT INTO public.utm_correlation_rules VALUES (1133, 'CEF Outcome Field Inconsistencies', 3, 3, 2, 'Defense Evasion', 'T1070.001 - Indicator Removal: Clear Windows Event Logs', 'Detects inconsistencies and anomalies in CEF outcome fields that may indicate log tampering, result manipulation, or attempts to hide malicious activities by modifying event outcomes. This rule identifies contradictory field combinations such as successful outcomes with blocking actions, failures with allowing actions, or unusual outcome values that deviate from standard CEF specifications.

Next Steps:
1. Immediately investigate the source device and vendor generating the inconsistent logs
2. Compare suspicious events with baseline behavior from the same device/vendor
3. Check for recent configuration changes or unauthorized access to logging infrastructure
4. Examine the raw log messages for signs of manual modification or corruption
5. Verify the integrity of log collection and forwarding mechanisms
6. Review user and administrative access to the source systems during the timeframe
7. Cross-reference with other security events from the same source IP or device
8. Consider isolating affected systems if widespread log tampering is suspected
', '["https://learn.microsoft.com/en-us/azure/sentinel/cef-name-mapping","https://attack.mitre.org/techniques/T1070/001/"]', '(
  (safe("log.outcome", "").lowerAscii() == "success" && safe("log.act", "").lowerAscii().contains("block")) ||
  (safe("log.outcome", "").lowerAscii() == "failure" && safe("log.act", "").lowerAscii().contains("allow")) ||
  (safe("log.outcome", "").lowerAscii() == "success" && safe("log.message", "").lowerAscii().contains("failed")) ||
  (safe("log.outcome", "").lowerAscii() == "failure" && safe("log.message", "").lowerAscii().contains("successful")) ||
  (safe("log.outcome", "").lowerAscii() == "success" && safe("log.severity", "") matches "^(8|9|10)$") ||
  (safe("log.outcome", "").lowerAscii() == "failure" && safe("log.severity", "") matches "^(0|1|2)$") ||
  (safe("log.outcome", "") != "" &&
   !(safe("log.outcome", "").lowerAscii() in ["success", "failure", "unknown", "partial", "pending"])) ||
  (safe("log.outcome", "").contains(" ") || safe("log.outcome", "").contains("\t")) ||
  (safe("log.outcome", "").length() > 20) ||
  (safe("log.outcome", "").matches("^[0-9]+$") && safe("log.outcome", "") != "0" && safe("log.outcome", "") != "1")
)
', '2025-09-04 16:00:49.674081', true, false, 'origin', '["origin.ip","log.outcome","log.deviceVendor"]', '[]');
INSERT INTO public.utm_correlation_rules VALUES (1151, 'RFC-5424 Nil Value Abuse', 2, 3, 1, 'Protocol Violation', 'Input Validation Bypass', 'Detects abuse of NILVALUE (-) in RFC-5424 structured data fields where actual values are expected, potentially indicating data obfuscation or protocol manipulation attempts. This rule identifies suspicious use of nil values in RFC-5424 syslog messages where structured data, hostname, application name, or message ID fields contain nil values in contexts where actual values would be expected.

Next Steps:
1. Review the source system generating these malformed RFC-5424 messages
2. Check if the nil values are legitimate for the specific application or if they indicate manipulation
3. Validate the syslog configuration on the sending system
4. Examine the message content to determine if it contains suspicious or obfuscated data
5. Consider implementing stricter syslog parsing rules to reject malformed messages
6. Monitor for patterns of nil value abuse from the same source IP or application
', '["https://datatracker.ietf.org/doc/html/rfc5424#section-6"]', '(safe("log.structured_data", "") == "-" && safe("log.app_name", "") != "-" && safe("log.msg_id", "") != "-") ||
(safe("log.hostname", "") == "-" && safe("origin.ip", "") != "") ||
(safe("log.app_name", "") == "-" && safe("log.process_id", "") != "-") ||
(safe("log.msg_id", "") == "-" && safe("log.structured_data", "").size() > 10)
', '2025-09-04 16:04:40.107168', true, false, 'origin', '["origin.ip"]', '[]');
INSERT INTO public.utm_correlation_rules VALUES (1321, 'Windows: Modification of the msPKIAccountCredentials', 2, 3, 3, 'Privilege Escalation', 'Exploitation for Privilege Escalation', 'Identify the modification of the msPKIAccountCredentials attribute in an Active Directory User Object. Attackers can abuse the credentials roaming feature to overwrite an arbitrary file for privilege escalation. ms-PKI-AccountCredentials contains binary large objects (BLOBs) of encrypted credential objects from the credential manager store, private keys, certificates, and certificate requests.', '["https://attack.mitre.org/tactics/TA0004/","https://attack.mitre.org/techniques/T1068/"]', 'safe("log.action", "").contains("Directory Service Changes") && safe("log.winlogEventId", "") == ''5136'' && safe("log.eventDataAttributeLDAPDisplayName", "").matches("(msPKIAccountCredentials)") && safe("log.eventDataOperationType", "").contains("%%14674") && safe("log.winlogEventDataSubjectUserSid", "") == "S-1-5-18"', '2025-09-04 20:23:14.793194', true, false, 'origin', NULL, '[]');
INSERT INTO public.utm_correlation_rules VALUES (1134, 'CEF Protocol Violations and Anomalies', 2, 3, 2, 'Exfiltration', 'T1048.003 - Exfiltration Over Alternative Protocol: Exfiltration Over Unencrypted/Obfuscated Non-C2 Protocol', 'Detects protocol violations and anomalies in CEF logs including mismatched ports for protocols, unusual protocol combinations, or invalid protocol usage that may indicate attack attempts, protocol tunneling, data exfiltration, or network misconfiguration.

Next Steps:
1. Verify the legitimacy of the detected protocol violation by checking if it''s expected behavior
2. Investigate the source IP for other suspicious activities or connections
3. Review network traffic patterns from the same source to identify potential data exfiltration
4. Check if the protocol violation is part of a known legitimate application or service
5. Examine firewall and network device logs for additional context
6. If malicious, implement network-level blocking and investigate the scope of compromise
7. Review network configuration to ensure proper protocol filtering is in place
', '["https://www.elastic.co/guide/en/beats/filebeat/current/exported-fields-cef.html","https://attack.mitre.org/techniques/T1048/003/"]', '(
  (safe("log.proto", "").lowerAscii() == "tcp" && safe("log.dpt", "") == "53") ||
  (safe("log.proto", "").lowerAscii() == "udp" && (safe("log.dpt", "") == "80" || safe("log.dpt", "") == "443")) ||
  (safe("log.proto", "").lowerAscii() == "icmp" && (safe("log.spt", "") != "" || safe("log.dpt", "") != "")) ||
  (safe("log.transportProtocol", "").lowerAscii() == "tcp" && safe("log.app", "").lowerAscii().contains("dns")) ||
  (safe("log.transportProtocol", "").lowerAscii() == "udp" && safe("log.app", "").lowerAscii().contains("ssh")) ||
  (safe("log.proto", "") != "" && !(safe("log.proto", "").lowerAscii() in ["tcp", "udp", "icmp", "gre", "esp", "ah"])) ||
  (safe("log.spt", "") == "0" || safe("log.dpt", "") == "0") ||
  (int(safe("log.spt", "0")) > 65535 || int(safe("log.dpt", "0")) > 65535)
)
', '2025-09-04 16:00:50.265727', true, false, 'origin', '["origin.ip","log.proto","log.dpt"]', '[{"indexPattern":"v11-log-syslog-*","with":[{"field":"origin.ip.keyword","operator":"filter_term","value":"{{.origin.ip}}"},{"field":"log.proto.keyword","operator":"filter_term","value":"{{.log.proto}}"}],"or":null,"within":"now-1h","count":20}]');
INSERT INTO public.utm_correlation_rules VALUES (1135, 'CEF Request/Response Violation Detection', 3, 3, 2, 'Initial Access', 'T1190 - Exploit Public-Facing Application', 'Detects request/response violations in CEF logs including oversized requests, malformed data, protocol violations, or suspicious response codes that may indicate attacks or application errors. This rule identifies various forms of web application attacks such as buffer overflow attempts, protocol violations, and application-level denial of service attacks.

Next Steps:
1. Investigate the source IP address for additional suspicious activity
2. Review the specific request content and headers for malicious patterns
3. Check application logs for related errors or crashes
4. Verify if the target application has known vulnerabilities
5. Analyze response codes and timing for potential DoS patterns
6. Review firewall and WAF logs for bypass attempts
7. Check for similar violations from the same source or targeting the same application
8. Consider blocking the source IP if confirmed malicious
9. Update application security controls and input validation
10. Review and tune request size limits and security policies
', '["https://attack.mitre.org/techniques/T1190/","https://docs.paloaltonetworks.com/strata-logging-service/log-reference/network-logs/network-url-log/network-url-cef-fields"]', 'safe("log.dataType", "") == "cef" &&
(
  (safe("log.severity", "") in ["8", "9", "10"] && safe("log.name", "").lower().contains("violation")) ||
  (safe("log.requestMethod", "") != "" && !(safe("log.requestMethod", "") in ["GET", "POST", "PUT", "DELETE", "PATCH", "HEAD", "OPTIONS"])) ||
  (safe("log.bytesIn", 0) > 10485760) ||
  (safe("log.bytesOut", 0) > 104857600) ||
  (safe("log.responseCode", "") in ["400", "413", "414", "431", "500", "502", "503", "504"]) ||
  (safe("log.message", "").lower().contains("request too large")) ||
  (safe("log.message", "").lower().contains("header too long")) ||
  (safe("log.message", "").lower().contains("malformed request")) ||
  (safe("log.message", "").lower().contains("protocol violation")) ||
  (safe("log.request", "") != "" && safe("log.request", "").size() > 8192) ||
  (safe("log.requestCookies", "") != "" && safe("log.requestCookies", "").size() > 4096)
)
', '2025-09-04 16:00:50.816717', true, false, 'origin', '["origin.ip","target.host"]', '[]');
INSERT INTO public.utm_correlation_rules VALUES (1136, 'CEF Severity Mismatches', 2, 3, 2, 'Defense Evasion', 'T1070 - Indicator Removal on Host: Log Manipulation', 'Detects mismatches between CEF severity levels and event content, which could indicate log tampering, misconfiguration, or attempts to downgrade the importance of security events. This rule identifies cases where high-severity events are marked with low severity values, low-severity events marked with high severity, invalid severity ranges, or significant severity changes.

Next Steps:
1. Review the specific CEF event and verify the severity level matches the event content
2. Check if there are patterns of severity mismatches from the same device or vendor
3. Investigate potential log tampering or system misconfiguration
4. Validate CEF device configuration and parsing rules
5. Cross-reference with other security events from the same timeframe
6. Consider implementing stricter CEF validation rules if systematic issues are found
7. Document any legitimate reasons for severity mismatches for future reference
', '["https://www.splunk.com/en_us/blog/learn/common-event-format-cef.html","https://attack.mitre.org/techniques/T1070/"]', '(safe("log.cef_severity", 0) <= 3 &&
 (safe("log.cef_name", "").contains("attack") || safe("log.cef_name", "").contains("breach") ||
  safe("log.cef_name", "").contains("critical") || safe("log.cef_name", "").contains("exploit") ||
  safe("log.cef_name", "").contains("malware") || safe("log.cef_name", "").contains("ransomware") ||
  safe("log.cef_extensions", "").contains("attack") || safe("log.cef_extensions", "").contains("exploit") ||
  safe("log.cef_extensions", "").contains("malware"))) ||
(safe("log.cef_severity", 0) >= 8 &&
 (safe("log.cef_name", "").contains("info") || safe("log.cef_name", "").contains("debug") ||
  safe("log.cef_name", "").contains("test") || safe("log.cef_name", "").contains("heartbeat") ||
  safe("log.cef_name", "").contains("keepalive") ||
  safe("log.cef_device_event_class_id", "").startsWith("info"))) ||
(safe("log.cef_severity", -1) < 0 || safe("log.cef_severity", -1) > 10) ||
(safe("log.previous_severity", -1) != -1 &&
 ((safe("log.cef_severity", 0) - safe("log.previous_severity", 0)) > 5 ||
  (safe("log.previous_severity", 0) - safe("log.cef_severity", 0)) > 5))
', '2025-09-04 16:00:51.413113', true, false, 'origin', '["log.cef_device_vendor","log.cef_device_product","log.cef_device_event_class_id"]', '[{"indexPattern":"v11-log-syslog-*","with":[{"field":"log.cef_device_vendor.keyword","operator":"filter_term","value":"{{.log.cef_device_vendor}}"},{"field":"log.cef_device_product.keyword","operator":"filter_term","value":"{{.log.cef_device_product}}"}],"or":null,"within":"now-2h","count":20}]');
INSERT INTO public.utm_correlation_rules VALUES (1137, 'CEF Field Mapping Errors', 1, 3, 1, 'Command and Control', 'Data Obfuscation', 'Detects CEF field mapping errors where required fields are missing or have incorrect values. This could indicate misconfigured log sources, tampering attempts, or data quality issues. Such errors can lead to incomplete security monitoring and potential blind spots in threat detection.

Next Steps:
1. Verify the CEF log source configuration and ensure proper field mapping
2. Check if the log source is sending malformed CEF messages
3. Review recent configuration changes to the log collection infrastructure
4. Validate that the CEF parser is correctly configured for the specific device type
5. Check for potential tampering or corruption in log transmission
6. Review device documentation for proper CEF field requirements
7. Consider implementing additional validation rules for critical log sources
', '["https://docs.nxlog.co/integrate/cef-logging.html","https://attack.mitre.org/techniques/T1001/"]', '(safe("log.cef_device_vendor", "") == "" && safe("log.cef_device_product", "") == "" && safe("log.message", "").contains("CEF:")) || (safe("log.cef_severity", -1) < 0 || safe("log.cef_severity", -1) > 10) || (safe("log.cef_device_event_class_id", "") == "" && safe("log.message", "").contains("|")) || (safe("log.field_mapping_error", false) == true || "field_mapping_error" in safe("log.tags", []))', '2025-09-04 16:03:11.231014', true, false, 'origin', '["log.source","log.cef_device_vendor"]', '[]');
INSERT INTO public.utm_correlation_rules VALUES (1138, 'CEF Message Truncation Detection', 2, 3, 2, 'Defense Evasion', 'T1070.001 - Indicator Removal: Clear Windows Event Logs', 'Detects truncated CEF messages that may indicate log tampering, transmission errors, or attempts to hide malicious activity by truncating log entries. Monitors for incomplete CEF headers or extensions.

Next Steps:
1. Investigate the source system generating truncated CEF messages
2. Check network connectivity and log transmission mechanisms between the source and collector
3. Review system resources (disk space, memory) on the logging infrastructure
4. Examine if truncation patterns correlate with specific timeframes or security events
5. Validate CEF message formatting and parsing configuration
6. Check for potential log tampering or evasion attempts
7. Review recent system changes or updates that might affect log generation
', '["https://attack.mitre.org/techniques/T1070/001/","https://www.elastic.co/guide/en/integrations/current/cef.html"]', 'safe("log.dataType", "") == "cef" &&
(
  (safe("log.raw", "") != "" && !safe("log.raw", "").contains("|") && safe("log.raw", "").size() > 0) ||
  (safe("log.raw", "") != "" && safe("log.raw", "").split("|").size() < 7) ||
  (safe("log.message", "") != "" && safe("log.message", "").endsWith("...")) ||
  (safe("log.message", "") != "" && safe("log.message", "").endsWith("[truncated]")) ||
  (safe("log.message", "") != "" && safe("log.message", "").contains("message too long")) ||
  (safe("log.deviceVendor", "") == "" && safe("log.deviceProduct", "") == "") ||
  (safe("log.raw", "") != "" && safe("log.raw", "").size() == 1024) ||
  (safe("log.raw", "") != "" && safe("log.raw", "").size() == 2048) ||
  (safe("log.raw", "") != "" && safe("log.raw", "").size() == 4096) ||
  (safe("log.extension", "") != "" && !safe("log.extension", "").contains("="))
)
', '2025-09-04 16:03:11.839243', true, false, 'origin', '["lastEvent.origin.host","log.deviceProduct"]', '[]');
INSERT INTO public.utm_correlation_rules VALUES (1139, 'CEF Signature ID Pattern Anomalies', 3, 3, 1, 'Defense Evasion', 'T1027 - Obfuscated Files or Information', 'Detects anomalous signature ID patterns in CEF logs that may indicate evasion attempts or log injection. This rule identifies suspicious signature IDs that contain obfuscation patterns, injection attempts, or unusual formatting that could be used to bypass security controls or manipulate log analysis.

Next Steps:
1. Examine the CEF log entry and verify the signature ID legitimacy
2. Check if the signature ID corresponds to a known security product or rule
3. Investigate the source device generating these anomalous signature IDs
4. Review other logs from the same source for additional suspicious patterns
5. Validate if this represents a legitimate security tool misconfiguration or potential evasion attempt
6. Consider updating CEF parsing rules if this represents a new legitimate signature format
', '["https://www.microfocus.com/documentation/arcsight/arcsight-cef-23/","https://attack.mitre.org/techniques/T1027/"]', 'safe("log.signatureId", "") != "" &&
(
  safe("log.signatureId", "").matches(".*[a-zA-Z].*[0-9].*[a-zA-Z].*") ||
  safe("log.signatureId", "").contains("${") ||
  safe("log.signatureId", "").contains("$(") ||
  safe("log.signatureId", "").contains("../") ||
  safe("log.signatureId", "").contains("\\x") ||
  safe("log.signatureId", "").length() > 100 ||
  safe("log.signatureId", "").matches(".*\\s{2,}.*") ||
  safe("log.signatureId", "").startsWith("-") ||
  safe("log.signatureId", "").contains("UNION") ||
  safe("log.signatureId", "").contains("SELECT")
)
', '2025-09-04 16:03:12.628798', true, false, 'origin', '["adversary.ip","log.signatureId"]', '[]');
INSERT INTO public.utm_correlation_rules VALUES (1140, 'CEF Source/Destination Address Mismatches', 3, 2, 1, 'Impact', 'T1499 - Endpoint Denial of Service: IP Spoofing', 'Detects suspicious patterns in CEF logs where source and destination addresses show anomalies such as identical IPs, private to private communication, or RFC1918 violations that may indicate IP spoofing, network misconfigurations, or potential attack attempts.

Next Steps:
1. Verify the legitimacy of the source and destination IP addresses
2. Check if this represents legitimate internal communication or a misconfiguration
3. Investigate the device vendor and product generating these logs
4. Review network topology to confirm if private-to-private communication is expected
5. Examine surrounding network events for signs of spoofing or reconnaissance
6. Validate firewall and routing rules to ensure proper network segmentation
7. Consider implementing additional network monitoring for the affected IP ranges
', '["https://learn.microsoft.com/en-us/azure/sentinel/cef-name-mapping","https://attack.mitre.org/techniques/T1499/"]', '(
  (safe("log.src", "") == safe("log.dst", "") && safe("log.src", "") != "" && safe("log.dst", "") != "") ||
  (safe("log.src", "").startsWith("127.") && safe("log.dst", "") != "127.0.0.1") ||
  (safe("log.src", "") == "0.0.0.0" || safe("log.dst", "") == "0.0.0.0") ||
  (safe("log.src", "").startsWith("169.254.") && !safe("log.dst", "").startsWith("169.254.")) ||
  (safe("log.src", "").matches("^(10\\.|172\\.(1[6-9]|2[0-9]|3[0-1])\\.|192\\.168\\.)") &&
   safe("log.dst", "").matches("^(10\\.|172\\.(1[6-9]|2[0-9]|3[0-1])\\.|192\\.168\\.)") &&
   safe("log.deviceVendor", "").lowerAscii() != "firewall" &&
   safe("log.deviceProduct", "").lowerAscii() != "vpn")
)
', '2025-09-04 16:03:13.209908', true, false, 'origin', '["adversary.ip","target.ip"]', '[]');
INSERT INTO public.utm_correlation_rules VALUES (1141, 'CEF Timestamp Inconsistencies', 2, 3, 2, 'Defense Evasion', 'T1070.006 - Indicator Removal on Host: Timestomp', 'Detects timestamp inconsistencies in CEF logs that may indicate log tampering, system time issues, or attempts to hide malicious activity by manipulating timestamps. This rule identifies events with timestamps that are significantly in the future, too far in the past, or have logical inconsistencies between start and end times.

Next Steps:
1. Verify the system time configuration on the source device generating the CEF logs
2. Check for any recent time synchronization issues or NTP configuration problems
3. Investigate if the device has been compromised and timestamps are being manipulated
4. Review other logs from the same device for similar timestamp anomalies
5. Correlate with any recent administrative changes to system time settings
6. Examine the specific CEF fields (rt, start, end, deviceCustomDate1/2) for patterns
7. Check if the timestamp inconsistencies coincide with suspicious activity on the device
8. Validate log integrity and check for signs of log tampering or deletion
', '["https://www.microfocus.com/documentation/arcsight/arcsight-smartconnectors-8.3/cef-implementation-standard/Content/CEF/Chapter%202%20ArcSight%20Extension.htm","https://attack.mitre.org/techniques/T1070/006/"]', '(
  (safe("log.rt", 0) > 0 && safe("log.rt", 0) > timestamp() + 86400000) ||
  (safe("log.start", 0) > 0 && safe("log.start", 0) > timestamp() + 86400000) ||
  (safe("log.end", 0) > 0 && safe("log.end", 0) > timestamp() + 86400000) ||
  (safe("log.rt", 0) > 0 && safe("log.rt", 0) < timestamp() - 31536000000) ||
  (safe("log.deviceCustomDate1", 0) > 0 &&
   (safe("log.deviceCustomDate1", 0) > timestamp() + 86400000 ||
    safe("log.deviceCustomDate1", 0) < timestamp() - 31536000000)) ||
  (safe("log.deviceCustomDate2", 0) > 0 &&
   (safe("log.deviceCustomDate2", 0) > timestamp() + 86400000 ||
    safe("log.deviceCustomDate2", 0) < timestamp() - 31536000000)) ||
  (safe("log.start", 0) > 0 && safe("log.end", 0) > 0 &&
   safe("log.start", 0) > safe("log.end", 0)) ||
  (safe("log.rt", 0) > 0 && safe("log.start", 0) > 0 &&
   safe("log.rt", 0) < safe("log.start", 0)) ||
  (timestamp() - safe("log.rt", 0) > 604800000 && safe("log.rt", 0) > 0) ||
  (safe("log.message", "").matches(".*rt=[0-9]{10}\\s.*") &&
   safe("log.message", "").matches(".*rt=[0-9]{10}[0-9]{4,}.*"))
)
', '2025-09-04 16:03:13.930613', true, false, 'origin', '["origin.ip","log.deviceProduct"]', '[]');
INSERT INTO public.utm_correlation_rules VALUES (1314, 'Windows audit log was cleared', 1, 2, 3, 'Potentially Malicious Activity', 'Account Manipulation: SSH Authorized Keys', 'Adversaries may modify the SSH authorized_keys file to maintain persistence on a victim host.', '["https://attack.mitre.org/techniques/T1098/004/"]', 'safe("log.eventCode", 0.0) == double(1102)', '2025-09-04 20:22:42.691175', true, false, 'origin', NULL, '[]');
INSERT INTO public.utm_correlation_rules VALUES (1142, 'CEF User Agent Anomaly Detection', 2, 2, 1, 'Command and Control', 'T1071.001 - Application Layer Protocol: Web Protocols', 'Detects anomalous user agent strings in CEF logs that may indicate malicious scripts, bots, vulnerability scanners, or attempts to bypass security controls through user agent spoofing. This rule identifies known attack tools, template injection attempts, and unusually short or long user agent strings.

Next Steps:
1. Investigate the source IP address for additional suspicious activities
2. Review the specific URLs and resources accessed by this user agent
3. Check for other security events from the same IP address in recent timeframes
4. Analyze the request patterns to determine if automated scanning is occurring
5. Consider blocking the source IP if confirmed malicious
6. Review web application logs for potential exploitation attempts
7. Validate if the user agent represents legitimate automation tools
', '["https://attack.mitre.org/techniques/T1071/001/","https://learn.microsoft.com/en-us/azure/sentinel/cef-name-mapping"]', 'safe("log.dataType", "") == "cef" &&
safe("log.requestClientApplication", "") != "" &&
(
  safe("log.requestClientApplication", "").lower().contains("sqlmap") ||
  safe("log.requestClientApplication", "").lower().contains("nikto") ||
  safe("log.requestClientApplication", "").lower().contains("havij") ||
  safe("log.requestClientApplication", "").lower().contains("acunetix") ||
  safe("log.requestClientApplication", "").lower().contains("nessus") ||
  safe("log.requestClientApplication", "").lower().contains("metasploit") ||
  safe("log.requestClientApplication", "").lower().contains("python-requests") ||
  safe("log.requestClientApplication", "").lower().contains("curl/") ||
  safe("log.requestClientApplication", "").lower().contains("wget/") ||
  safe("log.requestClientApplication", "").contains("${") ||
  safe("log.requestClientApplication", "").contains("{{") ||
  safe("log.requestClientApplication", "").size() > 500 ||
  safe("log.requestClientApplication", "").size() < 10
)
', '2025-09-04 16:03:14.460146', true, false, 'origin', '["origin.ip","log.requestClientApplication"]', '[{"indexPattern":"v11-log-syslog-*","with":[{"field":"origin.ip.keyword","operator":"filter_term","value":"{{.origin.ip}}"}],"or":null,"within":"now-1h","count":10}]');
INSERT INTO public.utm_correlation_rules VALUES (1143, 'CEF Version Incompatibility Detection', 1, 2, 3, 'Defense Evasion', 'T1562.006 - Impair Defenses: Indicator Blocking', 'Detects CEF version incompatibilities or malformed CEF headers that may cause parsing errors, data loss, or indicate attempts to evade logging systems by using invalid CEF formats. This rule identifies CEF events with unsupported versions, malformed headers, invalid pipe separators, or missing required fields.

Next Steps:
1. Verify the CEF format specification compliance of the generating device
2. Check if the device firmware/software is up to date
3. Review log parsing configurations and update CEF parsers if needed
4. Investigate if malformed CEF events are intentional evasion attempts
5. Validate that critical security events are not being lost due to parsing failures
6. Contact vendor support if the device is generating non-standard CEF formats
7. Consider implementing backup parsing mechanisms for critical security devices
8. Monitor for patterns of CEF format violations that might indicate compromise
', '["https://attack.mitre.org/techniques/T1562/006/","https://stackoverflow.com/questions/45450507/in-common-event-format-cef-how-is-the-field-version-used-in-a-real-life-applic"]', 'safe("log.dataType", "") == "cef" &&
(
  (safe("log.cefVersion", "") != "" && !(safe("log.cefVersion", "") in ["0", "1"])) ||
  (safe("log.raw", "") != "" && !safe("log.raw", "").startsWith("CEF:")) ||
  (safe("log.raw", "") != "" && safe("log.raw", "").contains("CEF:") && !safe("log.raw", "").startsWith("CEF:0") && !safe("log.raw", "").startsWith("CEF:1")) ||
  (safe("log.deviceVendor", "") != "" && safe("log.deviceVendor", "").contains("|")) ||
  (safe("log.deviceProduct", "") != "" && safe("log.deviceProduct", "").contains("|")) ||
  (safe("log.deviceVersion", "") != "" && safe("log.deviceVersion", "").contains("|")) ||
  (safe("log.severity", "") != "" && (int(safe("log.severity", "0")) < 0 || int(safe("log.severity", "0")) > 10)) ||
  (safe("log.raw", "") != "" && safe("log.raw", "").contains("||")) ||
  (safe("log.deviceEventClassId", "") == "" && safe("log.name", "") == "")
)
', '2025-09-04 16:03:15.039912', true, false, 'origin', '["origin.host","dataSource"]', '[]');
INSERT INTO public.utm_correlation_rules VALUES (1144, 'RFC-5424 App Name Injection Detection', 2, 3, 2, 'Execution', 'T1059 - Command and Scripting Interpreter', 'Detects potential injection attempts in RFC-5424 syslog app-name field, including command injection patterns, path traversal attempts, and suspicious characters that could indicate log injection or manipulation. The app-name field should contain only legitimate application identifiers and not shell metacharacters or encoded content.

**Next Steps:**
- Investigate the source system generating logs with suspicious app-name values
- Check for corresponding security events or system compromise indicators on the originating host
- Review recent configuration changes or software installations on the affected system
- Validate if the app-name patterns represent legitimate application behavior or potential injection attempts
- Consider blocking or monitoring traffic from the source IP if malicious activity is confirmed
', '["https://datatracker.ietf.org/doc/html/rfc5424","https://attack.mitre.org/techniques/T1059/"]', 'safe("log.app_name", "") != "" &&
(
  safe("log.app_name", "").matches(".*[;|&`$()<>].*") ||
  safe("log.app_name", "").matches(".*\\.\\./.*") ||
  safe("log.app_name", "").matches(".*\\\\x[0-9a-fA-F]{2}.*") ||
  safe("log.app_name", "").matches(".*%[0-9a-fA-F]{2}.*") ||
  safe("log.app_name", "").matches(".*(bash|sh|cmd|powershell|eval|exec).*") ||
  safe("log.app_name", "").length() > 48 ||
  safe("log.app_name", "").matches(".*[\\r\\n\\t].*")
)
', '2025-09-04 16:04:36.205355', true, false, 'origin', '["log.app_name","origin.ip"]', '[]');
INSERT INTO public.utm_correlation_rules VALUES (1145, 'RFC-5424 BOM Handling Error Detection', 2, 3, 3, 'Impact', 'T1565 - Data Manipulation', 'Detects improper Byte Order Mark (BOM) usage in RFC-5424 messages which could indicate parser exploitation attempts or data corruption. This rule identifies various BOM-related anomalies including duplicate BOMs, malformed BOM sequences, and inconsistent BOM usage that may indicate tampering or exploitation attempts.

Next Steps:
1. Examine the raw log message for BOM anomalies and encoding issues
2. Verify the originating system''s syslog configuration and encoding settings
3. Check for patterns of BOM manipulation from the same source IP
4. Investigate potential parser exploitation attempts or data integrity issues
5. Review network logs for suspicious activity from the source
6. Validate the RFC-5424 compliance of the source system
', '["https://datatracker.ietf.org/doc/html/rfc5424#section-6.4","https://attack.mitre.org/techniques/T1565/"]', 'safe("log.raw_message", "") != "" && (
  safe("log.raw_message", "").startsWith("\xef\xbb\xbf\xef\xbb\xbf") ||
  safe("log.raw_message", "").contains("BOM''") ||
  safe("log.raw_message", "").contains("''BOM") ||
  (safe("log.raw_message", "").startsWith("\xef\xbb\xbf") && !safe("log.message", "").startsWith("BOM")) ||
  safe("log.raw_message", "").matches(".*\\xef\\xbb\\xbf[^B][^O][^M].*") ||
  safe("log.raw_message", "").matches(".*[^'']BOM[^''].*") ||
  safe("log.raw_message", "").contains("\xfe\xff") ||
  safe("log.raw_message", "").contains("\xff\xfe") ||
  safe("log.raw_message", "").contains("\x00\x00\xfe\xff") ||
  safe("log.raw_message", "").contains("\xff\xfe\x00\x00") ||
  (safe("log.message", "").startsWith("BOM") && !safe("log.raw_message", "").startsWith("\xef\xbb\xbf"))
)
', '2025-09-04 16:04:36.927073', true, false, 'origin', '["origin.ip","log.message"]', '[]');
INSERT INTO public.utm_correlation_rules VALUES (1146, 'RFC-5424 Facility and Severity Mismatches', 2, 3, 1, 'Defense Evasion', 'T1036 - Masquerading', 'Detects unusual combinations of facility and severity values in RFC-5424 syslog messages that may indicate log manipulation, system compromise, or misconfiguration. Suspicious patterns include kernel messages with debug severity, security messages with inconsistent severity levels, or emergency messages from inappropriate facilities.

**Next Steps:**
1. Verify the authenticity of the log source and examine the originating system
2. Check for signs of log tampering or injection attacks
3. Review system configuration and validate syslog daemon settings
4. Investigate concurrent events from the same source for additional anomalies
5. Cross-reference with known system maintenance activities or configuration changes
', '["https://datatracker.ietf.org/doc/html/rfc5424#section-6.2.1","https://attack.mitre.org/techniques/T1036/"]', '(safe("log.facility", -1) == 0 && safe("log.severity", -1) == 7) ||
(safe("log.facility", -1) == 4 && safe("log.severity", -1) > 5) ||
(safe("log.facility", -1) == 10 && safe("log.severity", -1) > 5) ||
(safe("log.facility", -1) == 13 && safe("log.severity", -1) == 7) ||
(safe("log.facility", -1) == 14 && safe("log.severity", -1) > 3) ||
(safe("log.severity", -1) == 0 && safe("log.facility", -1) > 15)
', '2025-09-04 16:04:37.492709', true, false, 'origin', '["origin.host","log.facility","log.severity"]', '[]');
INSERT INTO public.utm_correlation_rules VALUES (1147, 'RFC-5424 Hostname Spoofing Detection', 3, 3, 2, 'Defense Evasion', 'T1036 - Masquerading', 'Detects potential hostname spoofing attempts in RFC-5424 syslog messages where the hostname field doesn''t match the source IP or contains suspicious patterns like localhost references from external sources. This can indicate an attacker attempting to masquerade as a trusted host or bypass security controls.

Next Steps:
1. Verify the legitimacy of the source IP and hostname combination
2. Check if the source IP is authorized to use the claimed hostname
3. Investigate recent network activity from the source IP
4. Review DNS records for the claimed hostname
5. Check for other spoofing attempts from the same source
6. Consider blocking the source IP if confirmed malicious
7. Review and update hostname validation policies if necessary
', '["https://datatracker.ietf.org/doc/html/rfc5424","https://attack.mitre.org/techniques/T1036/"]', 'safe("log.hostname", "") != "" &&
safe("origin.ip", "") != "" &&
(
  (safe("log.hostname", "") == "localhost" && !safe("origin.ip", "").matches("^(127\\.0\\.0\\.1|::1)$")) ||
  (safe("log.hostname", "").matches("^(127\\.0\\.0\\.1|localhost|::1)$") && !safe("origin.ip", "").matches("^(127\\.0\\.0\\.1|::1|10\\.|172\\.(1[6-9]|2[0-9]|3[01])\\.|192\\.168\\.)")) ||
  (safe("log.hostname", "").matches("^(10\\.|172\\.(1[6-9]|2[0-9]|3[01])\\.|192\\.168\\.)") && !safe("origin.ip", "").matches("^(10\\.|172\\.(1[6-9]|2[0-9]|3[01])\\.|192\\.168\\.)"))
)
', '2025-09-04 16:04:37.942597', true, false, 'origin', '["origin.ip","log.hostname"]', '[{"indexPattern":"v11-log-syslog-*","with":[{"field":"origin.ip.keyword","operator":"filter_term","value":"{{.origin.ip}}"}],"or":null,"within":"now-15m","count":10}]');
INSERT INTO public.utm_correlation_rules VALUES (1148, 'RFC-5424 Suspicious Message ID Pattern Detection', 3, 3, 1, 'Defense Evasion', 'T1562.002 - Impair Defenses: Disable or Modify Tools', 'Detects suspicious patterns in RFC-5424 message ID fields that could indicate log injection, evasion attempts, or forged messages including overly long IDs, special characters, or patterns commonly used in attacks. This may indicate an attacker attempting to manipulate logging mechanisms to evade detection or inject malicious content into log streams.

Next Steps:
1. Examine the source system generating these suspicious message IDs
2. Review the full syslog message content for additional indicators of compromise
3. Check if the application generating these logs has been compromised
4. Analyze network traffic from the source IP for signs of malicious activity
5. Validate the legitimacy of the application name and message ID patterns
6. Consider implementing stricter message ID validation on logging infrastructure
', '["https://datatracker.ietf.org/doc/html/rfc5424","https://attack.mitre.org/techniques/T1562/002/"]', 'safe("log.msgid", "") != "" &&
safe("log.msgid", "") != "-" &&
(
  (safe("log.msgid", "").matches(".*(DROP|PASS|BLOCK|ALLOW|ACCEPT|REJECT).*") && safe("log.msgid", "").matches(".*[;|&`$()<>].*")) ||
  safe("log.msgid", "").length() > 32 ||
  safe("log.msgid", "").matches(".*\\s+.*") ||
  safe("log.msgid", "").matches(".*[\\x00-\\x1F\\x7F].*") ||
  safe("log.msgid", "").matches(".*(script|eval|exec|system|cmd).*") ||
  safe("log.msgid", "").matches("^[0-9a-fA-F]{32,}$") ||
  safe("log.msgid", "").matches(".*\\.\\./.*")
)
', '2025-09-04 16:04:38.552782', true, false, 'origin', '["origin.ip","log.app_name"]', '[{"indexPattern":"v11-log-syslog-*","with":[{"field":"origin.ip.keyword","operator":"filter_term","value":"{{.origin.ip}}"},{"field":"log.app_name.keyword","operator":"filter_term","value":"{{.log.app_name}}"}],"or":null,"within":"now-10m","count":5}]');
INSERT INTO public.utm_correlation_rules VALUES (1149, 'RFC-5424 Message Length Violation Detection', 1, 2, 3, 'Impact', 'T1499.001 - Endpoint Denial of Service: OS Exhaustion Flood', 'Detects RFC-5424 messages that violate length constraints, potentially causing buffer overflows, truncation, or denial of service. This rule identifies oversized messages, malformed headers, and other protocol violations that could indicate an attack or misconfiguration.

Next Steps:
1. Review the source IP and investigate if this is a legitimate system experiencing configuration issues
2. Check for patterns indicating coordinated attempts from multiple sources
3. Examine the specific field violations to determine if this is a targeted attack or system malfunction
4. Consider implementing rate limiting or blocking the source if malicious activity is confirmed
5. Review syslog infrastructure capacity and filtering rules to prevent resource exhaustion
', '["https://datatracker.ietf.org/doc/html/rfc5424#section-6.1","https://attack.mitre.org/techniques/T1499/001/"]', '(safe("log.raw_message_length", 0) > 1024 && safe("log.transport", "") == "UDP") ||
(safe("log.raw_message_length", 0) > 8192) ||
(safe("log.priority", -1) < 0 || safe("log.priority", 0) > 191) ||
(safe("log.hostname", "").length() > 255) ||
(safe("log.app_name", "").length() > 48) ||
(safe("log.proc_id", "").length() > 128) ||
(safe("log.msg_id", "").length() > 32) ||
(safe("log.structured_data", "") != "-" && safe("log.structured_data", "").length() > 2048) ||
(safe("log.timestamp", "").length() > 0 && safe("log.timestamp", "").length() != 32 && safe("log.timestamp", "").length() != 25) ||
(safe("log.version", "").length() > 0 && safe("log.version", "") != "1") ||
(safe("log.message", "").length() == 0 && safe("log.structured_data", "-") == "-") ||
safe("log.raw_message", "").matches("^<\\d{1,3}>\\d{1,2}\\s+.{2049,}")
', '2025-09-04 16:04:39.129016', true, false, 'origin', '["origin.ip","origin.host"]', '[]');
INSERT INTO public.utm_correlation_rules VALUES (1150, 'RFC-5424 Meta SD-ID Violations', 2, 3, 1, 'Metadata Manipulation', 'System Information Spoofing', 'Detects violations in the meta SD-ID structured data element, including invalid sequence IDs, system uptime values, or language codes that may indicate log tampering or system impersonation. The meta SD-ID element is used to convey meta-information about the syslog message itself and violations could indicate attempts to manipulate logging metadata.

Next Steps:
1. Verify the authenticity of the syslog source and validate system configuration
2. Check for signs of log tampering or injection attacks on the originating system
3. Review system uptime and sequence ID patterns for anomalies
4. Investigate if language codes or other metadata fields have been artificially modified
5. Correlate with network security events to identify potential log spoofing attempts
6. Validate the integrity of the logging infrastructure and examine for unauthorized access
', '["https://datatracker.ietf.org/doc/html/rfc5424#section-7.1.3"]', 'safe("log.sd_id", "") == "meta" && (
  (safe("log.sequenceId", "") != "" &&
   (int(safe("log.sequenceId", "0")) < int(safe("log.prev_sequenceId", "1")) ||
    int(safe("log.sequenceId", "0")) > int(safe("log.prev_sequenceId", "0")) + 1000)) ||
  (safe("log.sysUpTime", "") != "" &&
   (int(safe("log.sysUpTime", "0")) < 0 ||
    int(safe("log.sysUpTime", "0")) > 315360000)) ||
  (safe("log.language", "") != "" &&
   (!safe("log.language", "").matches("^[a-z]{2,3}(-[A-Z]{2})?$") ||
    safe("log.language", "") in ["xx", "zz", "test", "null", "undefined"])) ||
  safe("log.structured_data", "").matches("\\[meta[^\\]]*\\].*\\[meta[^\\]]*\\]") ||
  safe("log.structured_data", "").matches("\\[meta[^\\]]*sequenceId=\"[^0-9\"]+\"") ||
  safe("log.structured_data", "").matches("\\[meta[^\\]]*sysUpTime=\"-[0-9]+\"")
)
', '2025-09-04 16:04:39.593966', true, false, 'origin', '["origin.ip","origin.host"]', '[]');
INSERT INTO public.utm_correlation_rules VALUES (1476, 'Windows Defender: ERROR: THREAT NOT FOUND', 1, 2, 3, 'Potentially Compromised System', 'User Execution', 'Detects the ''THREAT NOT FOUND'' error event in Windows Defender, which may indicate that a removal operation is not supported for a specific threat.', '["https://learn.microsoft.com/en-us/windows/security/threat-protection/windows-defender-antivirus/troubleshoot"]', 'safe("log.winlogEventDataLogName", "") == "Microsoft-Windows-Windows Defender/Operational" &&  safe("log.winlogEventDataErrorCode", "") == "0x80508023"', '2025-09-04 21:12:15.697583', true, false, 'target', NULL, '[]');
INSERT INTO public.utm_correlation_rules VALUES (1152, 'RFC-5424 Language Tag Violations', 3, 3, 2, 'Defense Evasion', 'T1036.005 - Match Legitimate Name or Location', 'Detects violations in RFC-5424 language tag formatting within structured data. Language tags must follow RFC-5646 format (e.g., en-US, fr-CA). Invalid language tags may indicate message crafting tools, protocol implementation errors, or attempts to bypass content filtering systems that rely on language detection.

This rule triggers when syslog messages contain structured data with malformed language tags that violate RFC-5646 standards, including invalid characters, incorrect length, control characters, or double hyphens.

Next Steps:
1. Examine the source system generating the malformed language tags
2. Check if this is a legitimate application with poor RFC compliance or a potential security tool
3. Review recent changes to logging configurations or applications on the source system
4. Investigate if multiple violations are coming from the same source IP to identify systematic issues
5. Validate the application''s syslog implementation against RFC-5424 standards
6. Consider implementing input validation on syslog receivers to prevent malformed messages
', '["https://datatracker.ietf.org/doc/html/rfc5424#section-6.2.5","https://datatracker.ietf.org/doc/html/rfc5646","https://attack.mitre.org/techniques/T1036/005/"]', 'safe("log.structured_data", "").contains("language=") &&
(safe("log.structured_data", "").matches(".*language=\"[^a-zA-Z\\-].*\".*") ||
 safe("log.structured_data", "").matches(".*language=\"[a-zA-Z]{3,}.*\".*") ||
 safe("log.structured_data", "").matches(".*language=\".*[\\x00-\\x1F\\x7F].*\".*") ||
 safe("log.structured_data", "").matches(".*language=\".*--.*\".*") ||
 !safe("log.structured_data", "").matches(".*language=\"[a-z]{2,3}(-[A-Z]{2})?(-[a-zA-Z]{1,8})*\".*"))
', '2025-09-04 16:05:46.502257', true, false, 'origin', '["origin.ip","log.app_name"]', '[{"indexPattern":"v11-log-syslog-*","with":[{"field":"origin.ip.keyword","operator":"filter_term","value":"{{.origin.ip}}"}],"or":null,"within":"now-30m","count":20}]');
INSERT INTO public.utm_correlation_rules VALUES (1153, 'Origin SD-ID Tampering Detection', 3, 3, 1, 'Impact', 'T1565.002 - Stored Data Manipulation', 'Detects attempts to tamper with origin SD-ID in RFC-5424 structured data elements. Origin SD-ID contains critical source identification data including IP addresses and enterprise numbers. Tampering with these fields can be used to hide the true source of messages or impersonate legitimate systems.', '["https://datatracker.ietf.org/doc/html/rfc5424#section-6.3","https://datatracker.ietf.org/doc/html/rfc5848","https://attack.mitre.org/techniques/T1565/002/"]', '(safe("log.structured_data", "").contains("origin") &&
 safe("log.structured_data", "").contains("@")) &&
(safe("log.origin_ip", "") != safe("origin.ip", "") ||
 (safe("log.structured_data", "").matches(".*origin.*ip=\"([0-9]{1,3}\\.){3}[0-9]{1,3}\".*") &&
  !safe("log.structured_data", "").matches(".*origin.*ip=\"(10\\.|172\\.(1[6-9]|2[0-9]|3[01])\\.|192\\.168\\.|127\\.).*\"")) ||
 safe("log.structured_data", "").matches(".*origin\\[[^\\]]*@[0-9]+\\].*origin\\[[^\\]]*@[0-9]+\\].*"))
', '2025-09-04 16:05:47.033482', true, false, 'origin', '["origin.ip","log.hostname"]', '[{"indexPattern":"v11-log-syslog-*","with":[{"field":"origin.ip.keyword","operator":"filter_term","value":"{{.origin.ip}}"}],"or":null,"within":"now-5m","count":10}]');
INSERT INTO public.utm_correlation_rules VALUES (1154, 'RFC-5424 Parameter Name Injection Detection', 2, 3, 1, 'Execution', 'T1059 - Command and Scripting Interpreter', 'Detects attempts to inject malicious content through RFC-5424 structured data parameter names, which could lead to log injection attacks or command execution. This rule identifies suspicious characters and patterns in structured data that may indicate injection attempts including command separators, variable expansion syntax, and path traversal sequences.

Next Steps:
1. Review the structured data content for the detected injection patterns
2. Analyze the source system and application generating the malicious logs
3. Check if the injection attempt was successful by examining system logs
4. Implement input validation and sanitization on the log source
5. Consider blocking the source IP if this represents an active attack
6. Review other recent logs from the same source for additional injection attempts
', '["https://datatracker.ietf.org/doc/html/rfc5424#section-6.3","https://attack.mitre.org/techniques/T1059/"]', 'safe("log.structured_data", "") != "" && (
  safe("log.structured_data", "").contains("'';") ||
  safe("log.structured_data", "").contains("\";") ||
  safe("log.structured_data", "").contains("$(") ||
  safe("log.structured_data", "").contains("${") ||
  safe("log.structured_data", "").contains("`") ||
  safe("log.structured_data", "").contains("&&") ||
  safe("log.structured_data", "").contains("||") ||
  safe("log.structured_data", "").contains("|") ||
  safe("log.structured_data", "").contains("../") ||
  safe("log.structured_data", "").contains("..\\") ||
  safe("log.structured_data", "").matches(".*\\[\\w+\\s+(\\w+=[^\\]]*[;<>&|`$]+[^\\]]*)\\].*")
)
', '2025-09-04 16:05:47.623798', true, false, 'origin', '["origin.ip","origin.host"]', '[]');
INSERT INTO public.utm_correlation_rules VALUES (1155, 'RFC-5424 Parameter Value Overflow Detection', 2, 3, 3, 'Impact', 'T1499 - Endpoint Denial of Service', 'Detects attempts to overflow RFC-5424 structured data parameter values which could cause denial of service or memory corruption. This rule identifies syslog messages with excessively long parameter values, structured data fields, or message components that exceed RFC-5424 recommended limits.

Next Steps:
1. Investigate the source IP address and determine if it''s a known legitimate system
2. Check if the overflow attempts are part of a coordinated attack pattern
3. Review system logs for any application crashes or performance degradation
4. Verify syslog daemon configuration and buffer limits
5. Consider implementing rate limiting or input validation on the syslog server
6. Block the source IP if malicious activity is confirmed
', '["https://datatracker.ietf.org/doc/html/rfc5424#section-6.3.3","https://attack.mitre.org/techniques/T1499/"]', '(safe("log.structured_data", "") != "" && safe("log.structured_data", "").length() > 2048) ||
(safe("log.structured_data", "") != "" && (
  safe("log.structured_data", "").matches(".*\\[\\w+\\s+\\w+=\"[^\"]{1024,}\"\\].*") ||
  safe("log.structured_data", "").matches(".*\\[\\w+\\s+\\w+=''[^'']{1024,}''\\].*") ||
  safe("log.structured_data", "").matches(".*\\[\\w+\\s+[^\\]]{2048,}\\].*")
)) ||
(safe("log.message_length", 0) > 8192) ||
(safe("log.app_name", "").length() > 48) ||
(safe("log.proc_id", "").length() > 128) ||
(safe("log.msg_id", "").length() > 32)
', '2025-09-04 16:05:48.859945', true, false, 'origin', '["origin.ip","origin.host"]', '[{"indexPattern":"v11-log-syslog-*","with":[{"field":"origin.ip.keyword","operator":"filter_term","value":"{{.origin.ip}}"}],"or":null,"within":"now-5m","count":5}]');
INSERT INTO public.utm_correlation_rules VALUES (1156, 'RFC-5424 Priority Calculation Errors', 2, 3, 2, 'Discovery', 'T1082 - System Information Discovery', 'Detects incorrect priority calculations in RFC-5424 syslog messages. Priority should be facility * 8 + severity, with valid ranges for facility (0-23) and severity (0-7). Invalid calculations may indicate log forgery, system compromise, or malicious log injection attempts.

Next Steps:
1. Verify the source system and application generating the malformed syslog messages
2. Check for signs of log tampering or injection attacks
3. Review system configuration and syslog daemon settings
4. Investigate if the source system has been compromised
5. Validate network traffic to ensure logs are not being intercepted and modified
6. Consider implementing log integrity checks and digital signatures
', '["https://datatracker.ietf.org/doc/html/rfc5424#section-6.2.1","https://attack.mitre.org/techniques/T1082/"]', 'safe("log.priority", -1) >= 0 &&
safe("log.facility", -1) >= 0 &&
safe("log.severity", -1) >= 0 &&
(safe("log.priority", 0) != (safe("log.facility", 0) * 8 + safe("log.severity", 0)) ||
 safe("log.facility", 0) > 23 ||
 safe("log.facility", 0) < 0 ||
 safe("log.severity", 0) > 7 ||
 safe("log.severity", 0) < 0 ||
 safe("log.priority", 0) > 191)
', '2025-09-04 16:05:49.605803', true, false, 'origin', '["origin.ip","log.appName"]', '[]');
INSERT INTO public.utm_correlation_rules VALUES (1157, 'RFC-5424 Private Enterprise Number Abuse', 3, 2, 1, 'Identity Spoofing', 'Vendor Impersonation', 'Detects suspicious use of Private Enterprise Numbers (PEN) in RFC-5424 structured data elements. This includes mismatched enterprise IDs, use of well-known vendor PENs by unexpected sources, invalid PEN formats, or attempts to impersonate legitimate vendors through enterprise number manipulation.

Next Steps:
1. Investigate the source device and verify its legitimacy
2. Check if the enterprise ID matches the expected vendor for the device
3. Review recent configuration changes on the logging device
4. Validate the structured data format against RFC-5424 specifications
5. Correlate with other authentication or configuration change events
6. If confirmed malicious, block the source IP and review all logs from this source
7. Contact the vendor if legitimate enterprise numbers are being misused
', '["https://datatracker.ietf.org/doc/html/rfc5424#section-7.2.2","https://www.iana.org/assignments/enterprise-numbers/enterprise-numbers"]', 'safe("log.structured_data", "") != "" && safe("log.structured_data", "") != "-" && (
  (safe("log.sd_id", "").matches("@\\d+") && safe("log.enterpriseId", "") != "" &&
   safe("log.enterpriseId", "") != safe("log.sd_id", "").substring(safe("log.sd_id", "").indexOf("@") + 1)) ||
  (safe("log.sd_id", "").matches("@(9|11|25|311|674|1213|2620|2636|8072|25623|32473|41514)") &&
   !(safe("log.device_vendor", "") in ["Cisco", "HP", "Palo Alto", "Juniper", "Microsoft", "VMware", "Fortinet"])) ||
  safe("log.sd_id", "").matches("@0+[1-9]") ||
  safe("log.sd_id", "").matches("@[0-9]{8,}") ||
  safe("log.enterpriseId", "").matches("^0+$") ||
  safe("log.structured_data", "").matches("\\[[^@]+@[^0-9]")
)
', '2025-09-04 16:05:50.229383', true, false, 'origin', '["origin.ip","log.enterpriseId"]', '[{"indexPattern":"v11-log-syslog-*","with":[{"field":"origin.ip.keyword","operator":"filter_term","value":"{{.origin.ip}}"},{"field":"log.enterpriseId.keyword","operator":"filter_term","value":"{{.log.enterpriseId}}"}],"or":null,"within":"now-2h","count":3}]');
INSERT INTO public.utm_correlation_rules VALUES (1158, 'RFC-5424 Process ID Anomaly Detection', 2, 3, 1, 'Defense Evasion, Privilege Escalation', 'T1055 - Process Injection', 'Detects anomalous process IDs in RFC-5424 syslog messages including negative PIDs, excessively large PIDs, non-numeric values, or rapid PID changes from the same application that could indicate log manipulation or forged messages.

Next Steps:
1. Investigate the source system generating the anomalous process IDs
2. Check if the application or system is compromised or misconfigured
3. Verify if legitimate processes are causing the anomaly or if it''s an attack indicator
4. Review other logs from the same source for additional suspicious activities
5. Consider isolating the affected system if process injection is suspected
', '["https://datatracker.ietf.org/doc/html/rfc5424","https://attack.mitre.org/techniques/T1055/"]', 'safe("log.procid", "") != "" &&
safe("log.procid", "") != "-" &&
(
  safe("log.procid", "").matches(".*[^0-9].*") ||
  (safe("log.procid", "").matches("^[0-9]+$") && int(safe("log.procid", "0")) > 4194304) ||
  (safe("log.procid", "").matches("^[0-9]+$") && int(safe("log.procid", "0")) == 0) ||
  safe("log.procid", "").length() > 128 ||
  safe("log.procid", "").matches("^0+[0-9]+$")
)
', '2025-09-04 16:05:50.884635', true, false, 'origin', '["origin.ip","log.app_name"]', '[{"indexPattern":"v11-log-syslog-*","with":[{"field":"log.app_name.keyword","operator":"filter_term","value":"{{.log.app_name}}"},{"field":"origin.ip.keyword","operator":"filter_term","value":"{{.origin.ip}}"}],"or":null,"within":"now-1m","count":5}]');
INSERT INTO public.utm_correlation_rules VALUES (1159, 'RFC-5424 Protocol Compliance Failures', 1, 3, 2, 'Impact', 'T1499.001 - OS Exhaustion Flood', 'Detects various RFC-5424 protocol compliance failures including invalid priority values, malformed headers, incorrect version numbers, and structural violations. These failures may indicate custom logging implementations, parsing attacks, or attempts to exploit syslog collectors through malformed messages.

**Next Steps:**
1. Investigate the source IP and system generating the malformed syslog messages
2. Check if the source device has legitimate syslog configuration issues or requires updates
3. Verify if this is an isolated incident or part of a pattern from the same source
4. Review network logs for any other anomalous traffic from the source
5. Consider blocking or rate-limiting the source if malicious intent is suspected
6. Update syslog collector configuration to handle non-compliant messages appropriately
7. Notify the system administrator responsible for the source device
8. Document the incident and apply appropriate remediation measures
', '["https://datatracker.ietf.org/doc/html/rfc5424#section-6","https://datatracker.ietf.org/doc/html/rfc5424#section-9","https://attack.mitre.org/techniques/T1499/001/"]', 'safe("log.syslog_version", 0) != 1 ||
safe("log.priority", 999) > 191 ||
safe("log.priority", 999) < 0 ||
(safe("log.facility", 999) > 23 || safe("log.facility", -1) < 0) ||
(safe("log.severity", 999) > 7 || safe("log.severity", -1) < 0) ||
(safe("log.timestamp", "") != "" &&
 !safe("log.timestamp", "").matches("^[0-9]{4}-[0-9]{2}-[0-9]{2}T[0-9]{2}:[0-9]{2}:[0-9]{2}(\\.[0-9]+)?(Z|[+-][0-9]{2}:[0-9]{2})$")) ||
(safe("log.hostname", "").contains(" ") ||
 safe("log.hostname", "").contains("\t") ||
 safe("log.hostname", "") == "" ||
 safe("log.hostname", "").size() > 255) ||
(safe("log.app_name", "") != "-" &&
 (safe("log.app_name", "").contains(" ") ||
  safe("log.app_name", "").size() > 48)) ||
(safe("log.proc_id", "") != "-" &&
 (safe("log.proc_id", "").contains(" ") ||
  safe("log.proc_id", "").size() > 128))
', '2025-09-04 16:05:51.631889', true, false, 'origin', '["origin.ip","log.syslog_version"]', '[]');
INSERT INTO public.utm_correlation_rules VALUES (1160, 'RFC-5424 SD-ID Registry Violations', 3, 3, 1, 'Protocol Violation', 'T1562.001 - Impair Defenses: Disable or Modify Tools', 'Detects use of unregistered SD-IDs without @ sign or manipulation of IANA-registered SD-IDs like timeQuality, origin, or meta, which may indicate attempts to bypass security controls or inject malicious structured data. RFC-5424 requires that private SD-IDs use the @ sign format (e.g., example@1234) while reserved IANA SD-IDs must follow strict formatting rules.

**Next Steps:**
1. Review the structured data content and validate the SD-ID format
2. Check if the SD-ID is properly registered or follows private enterprise format
3. Investigate the source system for potential configuration issues or malicious activity
4. Verify that timeQuality, origin, and meta SD-IDs contain valid parameters
5. Consider implementing stricter syslog parsing rules to reject malformed messages
6. Monitor for patterns indicating systematic abuse of structured data formats
', '["https://datatracker.ietf.org/doc/html/rfc5424#section-7","https://www.iana.org/assignments/syslog-structured-data-id-values/syslog-structured-data-id-values.xhtml"]', 'safe("log.structured_data", "") != "" && safe("log.structured_data", "") != "-" && (
  (safe("log.sd_id", "").matches("^[a-zA-Z0-9_.-]+$") && !safe("log.sd_id", "").contains("@") && !(safe("log.sd_id", "") in ["timeQuality", "origin", "meta"])) ||
  (safe("log.sd_id", "") == "timeQuality" && (safe("log.tzKnown", "") != "" && !(safe("log.tzKnown", "") in ["0", "1"])) || (safe("log.isSynced", "") != "" && !(safe("log.isSynced", "") in ["0", "1"]))) ||
  safe("log.sd_id", "").matches("^(timeQuality|origin|meta)[0-9]+$") ||
  safe("log.structured_data", "").matches("\\[(timeQuality|origin|meta)\\s") ||
  safe("log.structured_data", "").matches("\\[[^@\\]]+[@=\\]\\s\"]")
)
', '2025-09-04 16:05:52.401517', true, false, 'origin', '["origin.ip","log.sd_id"]', '[{"indexPattern":"v11-log-syslog-*","with":[{"field":"origin.ip.keyword","operator":"filter_term","value":"{{.origin.ip}}"},{"field":"log.sd_id.keyword","operator":"filter_term","value":"{{.log.sd_id}}"}],"or":null,"within":"now-1h","count":5}]');
INSERT INTO public.utm_correlation_rules VALUES (1315, 'Windows: Possible Brute Force Attack', 2, 2, 3, 'Credential Access', 'Brute Force', 'This rule is triggered when a pattern of repeated and rapid login attempts from the same IP address or source is detected. These login attempts may target specific user accounts or services in an attempt to crack passwords through automated brute force. The purpose of this rule is to identify possible malicious unauthorized access attempts and prevent a brute force attack against the system.', '["https://attack.mitre.org/tactics/TA0006/","https://attack.mitre.org/techniques/T1110/"]', 'safe("log.eventCode", 0.0) == double(4625)', '2025-09-04 20:22:43.25202', true, false, 'origin', '["origin.host","origin.user"]', '[{"indexPattern":"v11-log-wineventlog-*","with":[{"field":"log.eventCode","operator":"filter_term","value":"{{.log.eventCode}}"},{"field":"target.user.keyword","operator":"filter_term","value":"{{.target.user}}"}],"or":null,"within":"now-5m","count":5}]');
INSERT INTO public.utm_correlation_rules VALUES (1161, 'Syslog Sequence ID Gap Detection', 3, 3, 3, 'Defense Evasion', 'T1070.002 - Clear Linux or Mac System Logs', 'Detects gaps in RFC-5424 syslog sequence IDs which may indicate message loss, deletion, or tampering. The sequenceId parameter must increment by 1 for each message from the same source. Gaps suggest either network issues, deliberate message deletion, or an attacker attempting to hide their activities.

Next Steps:
1. Investigate the source system (hostname/IP) for any network connectivity issues or system problems
2. Check if there are any maintenance windows or scheduled downtime that could explain the gap
3. Review system logs on the source device for any evidence of log tampering or deletion
4. Examine the missing sequence numbers to determine the scope of potential data loss
5. Correlate with other security events from the same source around the time of the gap
6. Verify syslog daemon configuration and storage capacity on the source system
7. If tampering is suspected, perform forensic analysis of the source system
8. Consider implementing additional log integrity monitoring mechanisms
', '["https://datatracker.ietf.org/doc/html/rfc5424#section-7.3.1","https://datatracker.ietf.org/doc/html/rfc5848#section-4.2.2","https://attack.mitre.org/techniques/T1070/002/"]', 'safe("log.sequence_id", 0) > 0 &&
safe("log.previous_sequence_id", 0) > 0 &&
(safe("log.sequence_id", 0) - safe("log.previous_sequence_id", 0) > 1 ||
 (safe("log.sequence_id", 0.0) == double(1) && safe("log.previous_sequence_id", 0) < 2147483647) ||
 safe("log.sequence_id", 0) < safe("log.previous_sequence_id", 0))
', '2025-09-04 16:05:52.975277', true, false, 'origin', '["origin.ip","log.hostname","log.app_name"]', '[{"indexPattern":"v11-log-syslog-*","with":[{"field":"origin.ip.keyword","operator":"filter_term","value":"{{.origin.ip}}"},{"field":"log.hostname.keyword","operator":"filter_term","value":"{{.log.hostname}}"}],"or":null,"within":"now-1h","count":5}]');
INSERT INTO public.utm_correlation_rules VALUES (1162, 'RFC-5424 Standardized SD-IDs Abuse', 3, 3, 2, 'Protocol Manipulation', 'Reserved Identifier Abuse', 'Detects misuse of standardized SD-IDs (timeQuality, origin, meta) with invalid parameters or values that violate RFC specifications. This rule identifies attempts to abuse RFC-5424 reserved structured data identifiers by using invalid parameter values, malformed data formats, or injection attempts through SD-ID parameters.

Next Steps:
1. Examine the complete syslog message and structured data parameters
2. Verify if the source system legitimately uses these SD-IDs
3. Check for patterns of abuse from the same source IP
4. Review system configuration to ensure proper syslog formatting
5. Investigate potential log injection or protocol manipulation attempts
6. Consider blocking or filtering malformed messages from the source
', '["https://datatracker.ietf.org/doc/html/rfc5424#section-7.1","https://www.iana.org/assignments/syslog-structured-data-id-values"]', 'safe("log.structured_data", "") != "" && safe("log.structured_data", "") != "-" && (
  (safe("log.sd_id", "") == "timeQuality" &&
   ((safe("log.syncAccuracy", "") != "" && !safe("log.syncAccuracy", "").matches("^[0-9]+$")) ||
   (safe("log.isSynced", "") == "1" && safe("log.syncAccuracy", "") == "") ||
   (safe("log.tzKnown", "") != "" && !(safe("log.tzKnown", "") in ["0", "1"])) || (safe("log.isSynced", "") != "" && !(safe("log.isSynced", "") in ["0", "1"])))) ||
  (safe("log.sd_id", "") == "origin" &&
   ((safe("log.ip", "") != "" && !safe("log.ip", "").matches("^([0-9]{1,3}\\.){3}[0-9]{1,3}$") &&
    !safe("log.ip", "").matches("^([0-9a-fA-F]{1,4}:){7}[0-9a-fA-F]{1,4}$")) ||
   (safe("log.enterpriseId", "") != "" && !safe("log.enterpriseId", "").matches("^[0-9]+$")) ||
   safe("log.software", "").matches("[<>\"''\\\\]") ||
   safe("log.swVersion", "").matches("[<>\"''\\\\]"))) ||
  (safe("log.sd_id", "") == "meta" &&
   ((safe("log.sequenceId", "") != "" && !safe("log.sequenceId", "").matches("^[0-9]+$")) ||
   (safe("log.sysUpTime", "") != "" && !safe("log.sysUpTime", "").matches("^[0-9]+$")) ||
   (safe("log.language", "") != "" && !safe("log.language", "").matches("^[a-zA-Z]{2,3}(-[a-zA-Z]{2,3})?$"))))
)
', '2025-09-04 16:06:11.701872', true, false, 'origin', '["origin.ip","log.sd_id"]', '[]');
INSERT INTO public.utm_correlation_rules VALUES (1163, 'RFC-5424 Structured Data ID Violation Detection', 2, 3, 1, 'Impact', 'T1565.001 - Data Manipulation: Stored Data Manipulation', 'Detects violations in RFC-5424 structured data ID fields including invalid IANA enterprise numbers, malformed SD-IDs, injection attempts, or suspicious patterns that could indicate log manipulation or forged structured data elements. This rule identifies potential attempts to manipulate syslog structured data for evasion, injection attacks, or log forgery.

Next Steps:
1. Examine the source system generating the malformed structured data
2. Review the complete syslog message context and structured data content
3. Verify if the violation represents a legitimate configuration issue or malicious activity
4. Check for patterns of similar violations from the same source over time
5. Validate the IANA enterprise number against official registrations if present
6. Investigate any unusual characters or encoding in the structured data fields
7. Review system logs for signs of compromise or unauthorized access
8. Consider implementing additional syslog parsing validation rules
', '["https://datatracker.ietf.org/doc/html/rfc5424#section-6.3","https://attack.mitre.org/techniques/T1565/001/"]', 'safe("log.structured_data", "") != "" &&
safe("log.structured_data", "") != "-" &&
(
  safe("log.structured_data", "").matches(".*\\[(?![a-zA-Z0-9@._-]+\\s).*\\].*") ||
  safe("log.structured_data", "").matches(".*\\[@[0-9]+(?!\\.[a-zA-Z0-9._-]+).*\\].*") ||
  safe("log.structured_data", "").matches(".*\\[@0+\\s.*\\].*") ||
  safe("log.structured_data", "").matches(".*\\[[^\\]]*[;|&`$()<>][^\\]]*\\].*") ||
  safe("log.structured_data", "").matches(".*\\[[^\\]]{129,}\\].*") ||
  safe("log.structured_data", "").matches(".*\\[@[0-9]{10,}.*\\].*") ||
  safe("log.structured_data", "").matches(".*\\[[^\\]]*\\\\x[0-9a-fA-F]{2}[^\\]]*\\].*") ||
  safe("log.structured_data", "").matches(".*\\[[^\\]]*[\\r\\n\\t][^\\]]*\\].*")
)
', '2025-09-04 16:06:12.45617', true, false, 'origin', '["origin.ip"]', '[]');
INSERT INTO public.utm_correlation_rules VALUES (1164, 'RFC-5424 Structured Data Format Violations', 2, 3, 1, 'Impact', 'T1565 - Data Manipulation', 'Detects violations in RFC-5424 structured data format, which may indicate log tampering, parsing evasion attempts, or misconfigured systems. Structured data must follow specific syntax rules including proper SD-ELEMENT formatting with square brackets and no empty elements.

Next Steps:
1. Examine the source system generating malformed structured data
2. Check for signs of log tampering or injection attempts
3. Verify system configuration and log parsing rules
4. Review recent changes to logging infrastructure
5. Correlate with other suspicious activities from the same source
', '["https://datatracker.ietf.org/doc/html/rfc5424#section-6.3","https://attack.mitre.org/techniques/T1565/"]', 'safe("log.structuredData", "") != "" &&
safe("log.structuredData", "") != "-" &&
(!safe("log.structuredData", "").startsWith("[") ||
 !safe("log.structuredData", "").endsWith("]") ||
 safe("log.structuredData", "").contains("[]") ||
 !safe("log.structuredData", "").matches("^(\\[[^\\]]+\\])+$"))
', '2025-09-04 16:06:13.784869', true, false, 'origin', '["origin.ip","origin.host"]', '[]');
INSERT INTO public.utm_correlation_rules VALUES (1165, 'RFC-5424 Timestamp Format Violations', 1, 3, 2, 'Defense Evasion', 'T1070.006 - Indicator Removal on Host: Timestomping', 'Detects violations in RFC-5424 timestamp format. Timestamps must follow ISO 8601 format with proper timezone information. Invalid timestamps may indicate log tampering, time manipulation attacks, or attempts to evade time-based correlation.

Next Steps:
1. Verify the log source and check if it''s experiencing time synchronization issues
2. Examine the source system''s NTP configuration and clock settings
3. Review other logs from the same source for additional timestamp anomalies
4. Check for signs of log tampering or manipulation on the source system
5. Validate the log processing pipeline for any parsing or formatting issues
6. Consider implementing additional time validation controls on log sources
', '["https://datatracker.ietf.org/doc/html/rfc5424#section-6.2.3","https://attack.mitre.org/techniques/T1070/006/"]', 'safe("log.timestamp", "") != "" &&
safe("log.timestamp", "") != "-" &&
(!safe("log.timestamp", "").matches("^\\d{4}-\\d{2}-\\d{2}T\\d{2}:\\d{2}:\\d{2}(\\.\\d+)?(Z|[+-]\\d{2}:\\d{2})$") ||
 safe("log.timestamp", "").contains("1970-01-01") ||
 safe("log.timestamp", "").contains("0000-00-00") ||
 int(safe("log.timestamp", "0").substring(0, 4)) < 2000 ||
 int(safe("log.timestamp", "0").substring(0, 4)) > 2050)
', '2025-09-04 16:06:14.499748', true, false, 'origin', '["origin.host","dataSource"]', '[]');
INSERT INTO public.utm_correlation_rules VALUES (1166, 'Syslog Message Truncation Detection', 2, 3, 2, 'Exfiltration', 'T1029 - Scheduled Transfer', 'Detects RFC-5424 syslog messages that appear to be truncated, which may indicate buffer overflow attempts, network issues, or deliberate data hiding. Messages should not exceed 2048 octets for reliable delivery. Truncation can prevent proper signature validation and hide malicious content at the end of messages.

Next Steps:
1. Verify the source system configuration and syslog implementation
2. Check for network MTU issues or fragmentation problems
3. Examine the complete message content before truncation if available
4. Review other messages from the same source for patterns
5. Investigate if truncation is hiding malicious payloads or signatures
6. Consider implementing message size limits and proper error handling
', '["https://datatracker.ietf.org/doc/html/rfc5424#section-6.1","https://datatracker.ietf.org/doc/html/rfc5848#section-5.3.2","https://attack.mitre.org/techniques/T1029/"]', '(safe("log.message_length", 0) >= 2048 ||
 safe("log.message", "").endsWith("...") ||
 safe("log.message", "").endsWith("[truncated]") ||
 safe("log.message", "").endsWith("[TRUNCATED]") ||
 (safe("log.structured_data", "") != "" &&
  !safe("log.structured_data", "").matches(".*\\]$")) ||
 (safe("log.structured_data", "").contains("[") &&
  !safe("log.structured_data", "").contains("]")) ||
 safe("log.message", "").contains("\x00"))
', '2025-09-04 16:06:15.261793', true, false, 'origin', '["origin.ip","origin.host"]', '[]');
INSERT INTO public.utm_correlation_rules VALUES (1167, 'RFC-5424 UTF-8 Encoding Violation Detection', 3, 3, 2, 'Defense Evasion', 'T1027 - Obfuscation: Indicator Removal on Host', 'Detects invalid UTF-8 encoding in RFC-5424 syslog messages which could indicate evasion attempts, malformed log injection, or attempts to bypass log parsing mechanisms. Invalid UTF-8 sequences may be used by attackers to obfuscate malicious content or exploit parsing vulnerabilities.

Next Steps:
1. Examine the raw log message for suspicious patterns or content
2. Investigate the source system and application generating these messages
3. Check for signs of log injection or tampering attempts
4. Review recent changes to logging configurations or applications
5. Verify if the encoding issues are legitimate (e.g., legacy systems) or malicious
6. Monitor for additional suspicious activity from the same source
', '["https://datatracker.ietf.org/doc/html/rfc5424#section-6.4","https://attack.mitre.org/techniques/T1027/"]', 'safe("log.message", "") != "" && (
  safe("log.message", "").contains("\xc0\x80") ||
  safe("log.message", "").contains("\xe0\x80\x80") ||
  safe("log.message", "").contains("\xf0\x80\x80\x80") ||
  safe("log.message", "").contains("\xf8") ||
  safe("log.message", "").contains("\xfc") ||
  safe("log.message", "").contains("\xfe") ||
  safe("log.message", "").contains("\xff") ||
  safe("log.message", "").matches(".*[\\xc0-\\xc1][\\x80-\\xbf].*") ||
  safe("log.message", "").matches(".*[\\xe0][\\x80-\\x9f][\\x80-\\xbf].*") ||
  safe("log.message", "").matches(".*[\\xf0][\\x80-\\x8f][\\x80-\\xbf]{2}.*") ||
  safe("log.message", "").matches(".*[\\xf4][\\x90-\\xbf][\\x80-\\xbf]{2}.*") ||
  safe("log.message", "").matches(".*[\\x80-\\xbf].*") ||
  safe("log.message", "").matches(".*[\\xc2-\\xdf]([^\\x80-\\xbf]|$)") ||
  safe("log.message", "").matches(".*[\\xe0-\\xef]([^\\x80-\\xbf]{2}|[\\x80-\\xbf][^\\x80-\\xbf]|[\\x80-\\xbf]$|$)") ||
  safe("log.message", "").matches(".*[\\xf0-\\xf4]([^\\x80-\\xbf]{3}|[\\x80-\\xbf]{1,2}[^\\x80-\\xbf]|[\\x80-\\xbf]{1,2}$|$)")
)
', '2025-09-04 16:06:15.842816', true, false, 'origin', '["origin.ip","origin.host"]', '[]');
INSERT INTO public.utm_correlation_rules VALUES (1168, 'RFC-5424 Version Field Anomalies', 1, 3, 1, 'Command and Control', 'T1001.003 - Data Obfuscation: Protocol Impersonation', 'Detects anomalies in the RFC-5424 version field. The version field must be "1" for RFC-5424 compliant messages. Non-standard versions may indicate log forgery, protocol confusion attacks, or misconfigured systems attempting to bypass security controls.

Next Steps:
1. Investigate the source system and verify its syslog configuration
2. Check if the system is attempting to send RFC-3164 format messages to an RFC-5424 parser
3. Review recent changes to logging infrastructure or applications
4. Examine other log messages from the same source for consistency
5. Validate that the anomalous version field is not part of a legitimate system upgrade or migration
6. Consider implementing stricter syslog parsing rules to reject malformed messages
', '["https://datatracker.ietf.org/doc/html/rfc5424#section-6.2.2","https://attack.mitre.org/techniques/T1001/003/"]', 'safe("log.version", "") != "" &&
safe("log.version", "") != "1"
', '2025-09-04 16:06:16.558502', true, false, 'origin', '["origin.ip","log.version"]', '[]');
INSERT INTO public.utm_correlation_rules VALUES (1169, 'RFC-5425 TLS Alert Protocol Abuse', 3, 3, 3, 'Impact', 'Alert Protocol Manipulation', 'Detects suspicious patterns in TLS alert messages that may indicate protocol abuse, DoS attempts, or exploitation attempts in RFC-5425 syslog communications. This rule identifies fatal TLS alerts, excessive alert counts, specific suspicious alert codes, and known malicious alert descriptions that could indicate an attack against the secure syslog infrastructure.

Next Steps:
1. Investigate the source IP address generating the TLS alerts
2. Review TLS handshake logs for the affected connection
3. Check if the alerts are part of a coordinated attack pattern
4. Verify the legitimacy of the syslog client attempting to connect
5. Examine network traffic for signs of protocol manipulation or DoS attempts
6. Review TLS certificate validity and configuration
7. Consider temporarily blocking the source IP if malicious activity is confirmed
8. Update TLS configuration if protocol vulnerabilities are discovered
', '["https://datatracker.ietf.org/doc/html/rfc5425","https://attack.mitre.org/techniques/T1499/"]', '(safe("log.tls_alert_level", "") == "fatal" || safe("log.tls_alert_count", 0) > 10 || safe("log.tls_alert_code", 0) in [10, 21, 22, 50, 51, 60, 70, 71, 80, 86, 90, 100, 110, 111, 112, 113, 114, 115] || safe("log.message", "").matches(".*unexpected.*alert.*") || safe("log.tls_alert_description", "") in ["unexpected_message", "decompression_failure", "decrypt_error", "export_restriction", "protocol_version", "insufficient_security", "internal_error", "decode_error", "unsupported_extension", "certificate_unobtainable", "unrecognized_name", "bad_certificate_status_response", "bad_certificate_hash_value"]) && safe("log.protocol", "") == "syslog-tls"', '2025-09-04 16:06:46.868354', true, false, 'origin', '["adversary.ip","log.tls_alert_code"]', '[{"indexPattern":"v11-log-syslog-*","with":[{"field":"origin.ip.keyword","operator":"filter_term","value":"{{.origin.ip}}"},{"field":"log.tls_alert_level.keyword","operator":"filter_term","value":"fatal"}],"or":null,"within":"now-10m","count":5}]');
INSERT INTO public.utm_correlation_rules VALUES (1170, 'ALPN/NPN Protocol Negotiation Issues', 2, 2, 3, 'Impact', 'Protocol Downgrade Attack', 'Detects issues with Application-Layer Protocol Negotiation (ALPN) or Next Protocol Negotiation (NPN) including unsupported protocols, protocol mismatches, or attempts to use deprecated NPN. These issues can indicate protocol downgrade attacks, man-in-the-middle attempts, or misconfigured systems that could lead to security vulnerabilities.

Next Steps:
- Investigate the source IP for additional suspicious TLS handshake patterns
- Review network traffic logs for evidence of protocol manipulation
- Check if the client and server configurations support secure protocol negotiation
- Verify certificate validity and TLS version being negotiated
- Monitor for repeated failures from the same source indicating potential attack attempts
', '["https://datatracker.ietf.org/doc/html/rfc7301","https://attack.mitre.org/techniques/T1499/"]', '(safe("log.tls_alpn_error", "") != "" || safe("log.tls_npn_used", "") == "" || (safe("log.tls_alpn_offered", "") != "" && safe("log.tls_alpn_selected", "") == "" && safe("log.tls_handshake_completed", "") == "") || (safe("log.tls_alpn_selected", "") != "" && !safe("log.tls_alpn_offered", "").contains(safe("log.tls_alpn_selected", ""))))', '2025-09-04 16:06:47.460323', true, false, 'origin', '["origin.ip","target.ip"]', '[{"indexPattern":"v11-log-syslog-*","with":[{"field":"origin.ip.keyword","operator":"filter_term","value":"{{.origin.ip}}"},{"field":"log.event_type.keyword","operator":"filter_term","value":"tls_handshake"}],"or":null,"within":"now-10m","count":5}]');
INSERT INTO public.utm_correlation_rules VALUES (1428, 'Windows: Symbolic Link to Shadow Copy Created', 1, 3, 2, 'Credential Access', 'OS Credential Dumping', 'This event generates when the computer''s audit policy changes. If this action was not planned, investigate the reason for the change', '["https://attack.mitre.org/tactics/TA0006/","https://attack.mitre.org/techniques/T1003/"]', 'safe("log.winlogEventDataProcessName", "").matches("(cmd.exe|powershell.exe|pwsh.exe|powershell_ise.exe)") && safe("log.winlogEventDataParentProcessName", "").matches("(mklink.exe|SymbolicLink)") && safe("log.message", "").matches("(HarddiskVolumeShadowCopy)")', '2025-09-04 20:59:26.854578', true, false, 'origin', NULL, '[]');
INSERT INTO public.utm_correlation_rules VALUES (1171, 'RFC-5425 Application Data Injection Attack', 3, 3, 2, 'Defense Evasion, Privilege Escalation', 'Data Injection', 'Detects potential application data injection attacks in TLS-secured syslog communications, including plaintext injection and message manipulation attempts. This rule identifies suspicious syslog frames with anomalous lengths, unencrypted application data, control characters in messages, and other indicators of injection attacks.

Next Steps:
1. Investigate the source IP address for other suspicious activities
2. Review TLS certificate chain and encryption status for the connection
3. Examine the content of the syslog messages for malicious payloads
4. Check for additional injection attempts from the same source
5. Verify syslog server configuration and security controls
6. Analyze network traffic patterns for signs of ongoing attacks
', '["https://datatracker.ietf.org/doc/html/rfc5425","https://attack.mitre.org/techniques/T1055/"]', '(safe("log.syslog_frame_length", 0) > 8192 || safe("log.syslog_msg_length", 0) != safe("log.actual_msg_length", 0) || safe("log.message", "").matches(".*[\\x00-\\x08\\x0B\\x0C\\x0E-\\x1F].*") || (safe("log.tls_content_type", "") == "application_data" && safe("log.tls_encrypted", false) == false) || safe("log.syslog_frame_error", "").matches(".*length.*mismatch.*") || safe("log.message", "").matches(".*injection.*detect.*") || safe("log.syslog_msg", "").matches(".*<script.*>.*</script>.*") || safe("log.structured_data", "").matches(".*[\\x00-\\x1F\\x7F].*") || safe("log.tls_error", "").matches(".*plaintext.*inject.*") || safe("log.syslog_priority", 0) > 191) && safe("log.protocol", "") == "syslog-tls"', '2025-09-04 16:06:47.954422', true, false, 'origin', '["origin.ip"]', '[{"indexPattern":"v11-log-syslog-*","with":[{"field":"origin.ip.keyword","operator":"filter_term","value":"{{.origin.ip}}"},{"field":"log.syslog_frame_length","operator":"filter_term","value":">8192"}],"or":null,"within":"now-5m","count":5}]');
INSERT INTO public.utm_correlation_rules VALUES (1172, 'BEAST Attack Patterns', 3, 3, 1, 'Defense Evasion', 'BEAST Attack (CVE-2011-3389)', 'Detects potential BEAST (Browser Exploit Against SSL/TLS) attack patterns targeting CBC mode vulnerabilities in TLS 1.0 through chosen plaintext attacks. This rule identifies suspicious TLS configurations and patterns that may indicate BEAST attack attempts.

Next Steps:
1. Investigate the source IP and verify if it''s legitimate traffic
2. Check TLS configuration on affected servers and upgrade to TLS 1.1 or higher
3. Review cipher suite configurations to disable CBC mode ciphers
4. Monitor for additional cryptographic attacks from the same source
5. Implement proper TLS hardening and consider using AEAD ciphers
', '["https://www.acunetix.com/blog/articles/tls-vulnerabilities-attacks-final-part/","https://attack.mitre.org/techniques/T1600/","https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2011-3389"]', 'safe("log.tls_version", "") == "1.0" &&
(safe("log.cipher_suite", "").contains("CBC") ||
 safe("log.cipher", "").contains("_CBC_")) &&
(safe("log.iv_reuse", false) == true ||
 safe("log.predictable_iv", false) == true ||
 safe("log.message", "").contains("IV prediction") ||
 safe("log.chosen_plaintext_indicator", false) == true ||
 (safe("log.request_pattern", "") != "" && safe("log.request_similarity", 0) > 0.9))
', '2025-09-04 16:06:49.270179', true, false, 'origin', '["origin.ip","origin.host"]', '[]');
INSERT INTO public.utm_correlation_rules VALUES (1173, 'Certificate Pinning Violations', 3, 3, 2, 'Defense Evasion', 'T1553.004 - Subvert Trust Controls: Install Root Certificate', 'Detects violations of certificate pinning policies indicating potential man-in-the-middle attacks or certificate substitution attempts. Certificate pinning violations occur when the presented certificate''s public key or certificate chain doesn''t match the expected pinned values, suggesting possible certificate tampering or MITM attacks.

Next Steps:
1. Verify the legitimacy of the certificate being presented
2. Check for any recent certificate renewals or changes
3. Investigate network traffic for signs of man-in-the-middle attacks
4. Review certificate chain and validate issuer authenticity
5. Check for any unauthorized certificate installations on client systems
6. Monitor for additional certificate-related anomalies from the same source
7. Consider temporary blocking of the affected connection until verification
', '["https://docs.digicert.com/en/certcentral/certificate-tools/discovery-user-guide/tls-ssl-endpoint-vulnerabilities.html","https://attack.mitre.org/techniques/T1553/004/"]', '(safe("log.certificate_validation", "") == "failed" ||
 safe("log.pin_validation_failed", false) == true ||
 safe("log.certificate_pinning_error", false) == true) &&
((safe("log.expected_pin", "") != "" && safe("log.actual_pin", "") != "" &&
 safe("log.expected_pin", "") != safe("log.actual_pin", "")) ||
 (safe("log.message", "").contains("certificate pin") && safe("log.message", "").contains("mismatch")) ||
 (safe("log.message", "").contains("HPKP") && safe("log.message", "").contains("violation")) ||
 safe("log.certificate_chain_modified", false) == true)
', '2025-09-04 16:06:49.900989', true, false, 'origin', '["origin.ip","target.host"]', '[]');
INSERT INTO public.utm_correlation_rules VALUES (1174, 'Certificate Validation Error Detection', 2, 3, 1, 'Defense Evasion', 'T1553.004 - Subvert Trust Controls: Install Root Certificate', 'Detects certificate validation errors in RFC-5425 syslog transport including expired certificates, untrusted CAs, and subject name mismatches which could indicate security threats or man-in-the-middle attacks.

Next Steps:
1. Investigate the source IP address for any signs of malicious activity
2. Verify if the certificate error is legitimate (expired cert) or suspicious (unknown CA, self-signed)
3. Check network traffic patterns around the time of the error
4. Review certificate chain and validate against known trusted CAs
5. Consider potential man-in-the-middle attacks if multiple certificate errors occur
6. Update certificate stores if legitimate certificates are being flagged
', '["https://datatracker.ietf.org/doc/html/rfc5425","https://attack.mitre.org/techniques/T1553/004/"]', '(safe("log.message", "").contains("certificate verify failed") ||
 safe("log.message", "").contains("certificate verification failed") ||
 safe("log.message", "").contains("unknown ca") ||
 safe("log.message", "").contains("certificate expired") ||
 safe("log.message", "").contains("certificate not yet valid") ||
 safe("log.message", "").contains("self signed certificate") ||
 safe("log.message", "").contains("Certificate subject does not match") ||
 safe("log.message", "").contains("unable to verify the first certificate") ||
 safe("log.message", "").contains("unable to get local issuer certificate")) &&
safe("log.app_name", "").contains("syslog")
', '2025-09-04 16:06:50.47794', true, false, 'origin', '["origin.ip","target.ip"]', '[]');
INSERT INTO public.utm_correlation_rules VALUES (1316, 'Windows: Multiple Logon Failure Followed by Logon Success', 2, 2, 3, 'Credential Access', 'Brute Force', 'This rule is triggered when a sequence of multiple failed login attempts followed immediately by a successful login from the same IP address or source is detected. This unusual sequence of events may indicate a possible unauthorized access attempt using a brute force or password guessing technique. The purpose of this rule is to identify suspicious patterns of login activity and alert you to potential unauthorized access attempts.', '["https://attack.mitre.org/tactics/TA0006/","https://attack.mitre.org/techniques/T1110/"]', 'safe("log.eventCode", 0.0) == double(4624)', '2025-09-04 20:22:43.464001', true, false, 'origin', NULL, '[{"indexPattern":"v11-log-wineventlog-*","with":[{"field":"log.eventCode","operator":"filter_term","value":"4625"},{"field":"target.user.keyword","operator":"filter_term","value":"{{.target.user}}"}],"or":null,"within":"now-5m","count":5}]');
INSERT INTO public.utm_correlation_rules VALUES (1175, 'Cipher Suite Downgrade Attack Detection', 3, 3, 1, 'Defense Evasion', 'T1562.010 - Impair Defenses: Downgrade Attack', 'Detects attempts to downgrade TLS cipher suites in RFC-5425 syslog connections which could enable cryptographic attacks and data interception. This rule identifies various cipher downgrade indicators including weak cipher usage, protocol version downgrades, and cipher negotiation failures that may indicate an active downgrade attack.

Next Steps:
1. Verify the legitimacy of the TLS cipher downgrade event
2. Check if the source IP has a history of cipher downgrade attempts
3. Investigate the target system''s TLS configuration and security policies
4. Review network traffic for signs of man-in-the-middle attacks
5. Examine certificate validity and chain of trust
6. Consider implementing stronger cipher suite policies to prevent downgrades
7. Monitor for subsequent suspicious activities from the same source
', '["https://datatracker.ietf.org/doc/html/rfc5425","https://attack.mitre.org/techniques/T1562/010/"]', '(safe("log.message", "").contains("no shared cipher") ||
 safe("log.message", "").contains("cipher mismatch") ||
 safe("log.message", "").contains("weak cipher") ||
 safe("log.message", "").contains("insecure cipher") ||
 safe("log.message", "").contains("export cipher") ||
 safe("log.message", "").contains("NULL cipher") ||
 safe("log.message", "").contains("anonymous cipher") ||
 safe("log.structured_data", "").contains("tls_version=TLSv1.0") ||
 safe("log.structured_data", "").contains("tls_version=SSLv3") ||
 safe("log.message", "").matches(".*cipher.*[0-9]{1,2}\\s*bit.*")) &&
(safe("log.facility", 100) == 16 || safe("log.app_name", "").contains("syslog"))
', '2025-09-04 16:06:50.993612', true, false, 'origin', '["origin.ip","target.port"]', '[]');
INSERT INTO public.utm_correlation_rules VALUES (1176, 'RFC-5425 TLS Close Notify Anomalies', 2, 2, 3, 'Impact', 'T1499.001 - Network Denial of Service: Direct Network Flood', 'Detects anomalous patterns in TLS close_notify alerts that may indicate truncation attacks, premature connection termination, or DoS attempts in RFC-5425 syslog communications. This rule identifies suspicious TLS connection closures including unexpected fatal alerts, excessive close notifications, truncation attack patterns, and improper connection termination procedures.

Next Steps:
1. Verify the legitimacy of the source IP and connection patterns
2. Check for correlation with other network anomalies or security events
3. Analyze TLS handshake logs for signs of manipulation or attacks
4. Review syslog service configuration and network infrastructure
5. Consider implementing rate limiting or blocking the source if malicious activity is confirmed
6. Examine certificate validity and TLS configuration settings
', '["https://datatracker.ietf.org/doc/html/rfc5425","https://attack.mitre.org/techniques/T1499/001/"]', '(safe("log.tls_alert_code", 0.0) == double(0) && safe("log.tls_alert_level", "") == "fatal" ||
 safe("log.tls_close_notify_count", 0) > 10 ||
 safe("log.message", "").matches(".*close.*notify.*without.*data.*") ||
 safe("log.tls_error", "").matches(".*unexpected.*close.*") ||
 (safe("log.tls_alert_description", "") == "close_notify" && safe("log.bytes_sent", 0) < 100) ||
 (safe("log.connection_duration", 0) < 1000 && safe("log.tls_alert_description", "") == "close_notify") ||
 safe("log.tls_error", "").matches(".*truncat.*attack.*") ||
 safe("log.message", "").matches(".*premature.*terminat.*") ||
 safe("log.tls_bidirectional_close", false) == false ||
 safe("log.tls_close_without_alert", false) == true) &&
safe("log.protocol", "") == "syslog-tls"
', '2025-09-04 16:06:51.632743', true, false, 'origin', '["origin.ip","target.port"]', '[]');
INSERT INTO public.utm_correlation_rules VALUES (1177, 'RFC-5425 Compression-Based Attacks', 3, 2, 3, 'Defense Evasion', 'T1027 - Obfuscated Files or Information', 'Detects potential compression-based attacks like CRIME or BREACH on RFC-5425 TLS syslog streams. These attacks can leak information through compression ratios or cause resource exhaustion through compression bombs.

**Next Steps:**
1. Examine the specific compression metrics and algorithms being used
2. Verify if compression ratios are abnormally high indicating potential compression bombs
3. Check for patterns of compression level changes that might indicate probing attacks
4. Review TLS session details for signs of side-channel exploitation
5. Correlate with network traffic patterns to identify potential data exfiltration attempts
6. Analyze source IP reputation and geolocation for suspicious origins
7. Consider temporarily disabling compression on affected syslog streams if attacks are confirmed
8. Review syslog server configuration for proper compression settings and limits
', '["https://datatracker.ietf.org/doc/html/rfc5425","https://attack.mitre.org/techniques/T1027/","https://en.wikipedia.org/wiki/CRIME","https://en.wikipedia.org/wiki/BREACH"]', 'safe("log.protocol", "") == "rfc-5425" && (
  (safe("log.compression_enabled", false) == true && safe("log.tls_enabled", false) == true) ||
  safe("log.compression_ratio", 0.0) > 100.0 ||
  safe("log.compression_bomb_detected", false) == true ||
  safe("log.decompression_error", false) == true ||
  (safe("log.compressed_size", 0) > 0 && safe("log.uncompressed_size", 0) / safe("log.compressed_size", 1) > 1000) ||
  safe("log.compression_algorithm", "") == "deprecated" ||
  safe("log.compression_level_changed", false) == true
)
', '2025-09-04 16:06:52.207628', true, false, 'origin', '["origin.ip","target.ip","log.compression_algorithm"]', '[{"indexPattern":"v11-log-syslog-*","with":[{"field":"origin.ip.keyword","operator":"filter_term","value":"{{.origin.ip}}"},{"field":"log.compression_enabled","operator":"filter_term","value":"true"}],"or":null,"within":"now-2h","count":20}]');
INSERT INTO public.utm_correlation_rules VALUES (1178, 'CRIME Attack Detection', 3, 3, 1, 'Credential Access, Discovery', 'T1040 - Network Sniffing: CRIME Attack (CVE-2012-4929)', 'Detects potential CRIME (Compression Ratio Info-leak Made Easy) attack attempts exploiting TLS compression to extract sensitive information like session cookies. CRIME attacks leverage compression side-channel vulnerabilities to decrypt HTTPS traffic by analyzing compression ratios.

Next Steps:
1. Verify TLS compression is disabled on affected servers
2. Analyze network traffic patterns for repeated requests with varying cookie data
3. Check for compression ratio anomalies in SSL/TLS connections
4. Review server configurations to ensure SPDY and TLS compression are disabled
5. Monitor for additional compression-based attacks from the same source IP
6. Implement HTTP Strict Transport Security (HSTS) if not already configured
', '["https://www.freecodecamp.org/news/attacks-on-ssl-tls-and-how-to-protect-your-system/","https://attack.mitre.org/techniques/T1040/","https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2012-4929"]', '(safe("log.tls_compression", false) == true ||
 safe("log.compression_enabled", false) == true ||
 (safe("log.compression_method", "") != "" && safe("log.compression_method", "") != "null")) &&
(safe("log.request_size_variance", 0) > 100 ||
 safe("log.compression_ratio_anomaly", false) == true ||
 (safe("log.message", "").contains("compression") && safe("log.message", "").contains("ratio")) ||
 (safe("log.repeated_requests", 0) > 50 && safe("log.request_pattern", "").contains("cookie")))
', '2025-09-04 16:06:52.804172', true, false, 'origin', '["origin.ip","target.host"]', '[{"indexPattern":"v11-log-syslog-*","with":[{"field":"origin.ip.keyword","operator":"filter_term","value":"{{.origin.ip}}"},{"field":"target.host.keyword","operator":"filter_term","value":"{{.target.host}}"}],"or":null,"within":"now-30m","count":20}]');
INSERT INTO public.utm_correlation_rules VALUES (1449, 'Windows: A user account was deleted', 1, 3, 2, 'Persistence', 'Account Manipulation', 'Adversaries can manipulate accounts to maintain access to victim systems. These actions could also include account activity designed to subvert policies such as performing iterative password updates to bypass policies password lifetime and preserve the life of compromised credentials.', '["https://attack.mitre.org/tactics/TA0003/","https://attack.mitre.org/techniques/T1098/"]', 'safe("log.eventCode", 0.0) == double(4726)', '2025-09-04 21:01:37.047865', true, false, 'origin', NULL, '[]');
INSERT INTO public.utm_correlation_rules VALUES (1179, 'RFC-5425 Frame Length Violations', 2, 3, 3, 'Impact', 'Message Framing Attack', 'Detects violations in RFC-5425 syslog frame length that could indicate message tampering, buffer overflow attempts, or protocol exploitation. Frame length violations may cause message truncation or parsing errors and can be indicative of attempts to bypass syslog parsing mechanisms or cause denial of service.

Next Steps:
1. Examine the source IP for patterns of malicious activity
2. Check if frame length violations correlate with other protocol anomalies
3. Review syslog receiver logs for parsing errors or crashes
4. Validate legitimate syslog sources are properly configured
5. Consider implementing rate limiting for sources generating frame violations
6. Analyze message content for signs of injection attacks or malformed data
', '["https://datatracker.ietf.org/doc/html/rfc5425#section-4.3","https://attack.mitre.org/techniques/T1499/"]', 'safe("log.protocol", "") == "rfc-5425" && (
  safe("log.frame_length", 0) > 8192 ||
  safe("log.frame_length", 0) < 1 ||
  safe("log.actual_length", 0) != safe("log.frame_length", 0) ||
  (safe("log.frame_length", 0) > 2048 && safe("log.strict_mode", false) == true)
)
', '2025-09-04 16:07:24.159142', true, false, 'origin', '["origin.ip","target.ip"]', '[{"indexPattern":"v11-log-syslog-*","with":[{"field":"origin.ip.keyword","operator":"filter_term","value":"{{.origin.ip}}"}],"or":null,"within":"now-15m","count":10}]');
INSERT INTO public.utm_correlation_rules VALUES (1180, 'RFC-5425 TLS Handshake Protocol Violations', 3, 3, 2, 'Initial Access', 'Handshake Manipulation', 'Detects violations and anomalies in TLS handshake protocol that may indicate MITM attacks, downgrade attacks, or handshake manipulation in RFC-5425 syslog communications. This rule identifies various handshake failures, weak cipher suites, protocol downgrades, and suspicious TLS parameters.

Next Steps:
1. Investigate the source IP address and verify if it''s a legitimate syslog sender
2. Check for certificate validation issues and verify the authenticity of TLS certificates
3. Analyze network traffic for signs of man-in-the-middle attacks or SSL/TLS interception
4. Review TLS configuration on both client and server sides for weak cipher suites or deprecated protocols
5. Check for temporal patterns indicating systematic downgrade attacks
6. Validate syslog server TLS configuration and ensure strong security policies are enforced
7. Consider implementing certificate pinning or additional certificate validation measures
8. Monitor for repeated handshake failures from the same source that might indicate reconnaissance or attack attempts
', '["https://datatracker.ietf.org/doc/html/rfc5425","https://attack.mitre.org/techniques/T1190/"]', '(safe("log.tls_alert_code", 0.0) == double(40) || safe("log.tls_alert_description", "") == "handshake_failure" || safe("log.tls_handshake_type", "") in ["invalid", "unknown"] || safe("log.message", "").matches(".*handshake.*fail.*") || safe("log.tls_error", "").matches(".*illegal.*parameter.*") || safe("log.tls_version", "") in ["SSLv2", "SSLv3", "TLS1.0"] || safe("log.tls_random_bytes", "").matches(".*444F574E475244.*") || safe("log.tls_cipher_suite", "").matches(".*(NULL|EXPORT|DES|RC4|MD5).*") || safe("log.certificate_fingerprint", "") == "" || safe("log.tls_error", "").matches(".*renegotiation.*") || safe("log.message", "").matches(".*downgrade.*detect.*")) && safe("log.protocol", "") == "syslog-tls"', '2025-09-04 16:07:24.679677', true, false, 'origin', '["origin.ip","target.ip","log.tls_version"]', '[]');
INSERT INTO public.utm_correlation_rules VALUES (1181, 'Heartbleed Vulnerability Detection', 3, 3, 2, 'Initial Access', 'Heartbleed Attack (CVE-2014-0160)', 'Detects potential Heartbleed vulnerability exploitation attempts through TLS heartbeat extension abuse. This vulnerability allows attackers to read memory contents including private keys, passwords, and sensitive data from vulnerable OpenSSL implementations.

Next Steps:
1. Immediately isolate the affected system from the network to prevent further exploitation
2. Verify if the system is running a vulnerable OpenSSL version (1.0.1 through 1.0.1f)
3. Check server logs for suspicious TLS heartbeat requests with oversized payloads
4. Review network traffic for potential data exfiltration following the exploit attempt
5. Regenerate and replace all SSL certificates and private keys on affected systems
6. Force password resets for users who may have been accessing the affected service
7. Apply security patches to update OpenSSL to version 1.0.1g or later
8. Conduct a thorough security assessment to determine if sensitive data was compromised
9. Monitor for follow-up attacks that may leverage any stolen credentials or certificates
10. Consider implementing network segmentation to limit exposure of critical systems
', '["https://heartbleed.com/","https://attack.mitre.org/techniques/T1190/","https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2014-0160"]', '(safe("log.tls_version", "") in ["1.0", "1.1", "1.2"]) &&
safe("log.tls_extension", "").contains("heartbeat") &&
(safe("log.heartbeat_length", 0) > 16384 ||
 safe("log.payload_size", 0) > safe("log.declared_length", 0) ||
 (safe("log.message", "").contains("heartbeat") && safe("log.message", "").contains("malformed")))
', '2025-09-04 16:07:25.227859', true, false, 'origin', '["origin.ip","target.ip"]', '[]');
INSERT INTO public.utm_correlation_rules VALUES (1182, 'Weak Key Exchange Detection', 3, 3, 1, 'Defense Evasion', 'T1600 - Weaken Encryption: Reduce Key Space', 'Detects weak or vulnerable key exchange methods including export-grade ciphers, weak DH parameters, or attempts to use deprecated key exchange algorithms. This indicates potential cryptographic weaknesses that could be exploited by attackers to decrypt or intercept communications.

Next Steps:
1. Review the specific cipher suite and key exchange algorithm used
2. Check if the weak cryptography is intentional or misconfigured
3. Verify the TLS/SSL configuration on the affected systems
4. Update cryptographic protocols to use stronger algorithms
5. Monitor for any successful connections using weak cryptography
6. Review network traffic for potential man-in-the-middle attacks
', '["https://datatracker.ietf.org/doc/html/rfc5425","https://attack.mitre.org/techniques/T1600/"]', 'safe("log.tls_cipher_suite", "").contains("EXPORT") ||
safe("log.tls_cipher_suite", "").contains("NULL") ||
safe("log.tls_cipher_suite", "").contains("anon") ||
safe("log.tls_kex_algorithm", "").contains("RSA") ||
(safe("log.tls_dh_param_size", 0) > 0 &&
 safe("log.tls_dh_param_size", 0) < 2048) ||
(safe("log.tls_kex_algorithm", "").contains("DHE_") &&
 safe("log.tls_dh_param_size", 0) < 1024)
', '2025-09-04 16:07:25.80275', true, false, 'origin', '["origin.ip","target.ip"]', '[]');
INSERT INTO public.utm_correlation_rules VALUES (1183, 'RFC-5425 Message Counting Errors', 3, 3, 2, 'Defense Evasion', 'Message Manipulation', 'Detects discrepancies in message counting that could indicate message
loss, injection, or replay attacks in RFC-5425 syslog streams. This may suggest
an attacker is dropping or injecting messages to evade detection or manipulate
log integrity.

Next Steps:
1. Verify the integrity of the syslog stream and check for missing messages
2. Investigate the source IP for signs of compromise or malicious activity
3. Review network connectivity between the sender and receiver for interruptions
4. Check for potential man-in-the-middle attacks or network interference
5. Validate syslog server configuration and message handling processes
6. Correlate with other security events from the same source during the timeframe
', '["https://datatracker.ietf.org/doc/html/rfc5425#section-4.3","https://attack.mitre.org/techniques/T1562/006/"]', 'safe("log.protocol", "") == "rfc-5425" && (
  safe("log.message_count_mismatch", false) == true ||
  (safe("log.expected_sequence", 0) != 0 && safe("log.actual_sequence", 0) != 0 && safe("log.expected_sequence", 0) != safe("log.actual_sequence", 0)) ||
  (safe("log.message_gap", 0) > 0 && safe("log.message_gap", 0) != safe("log.expected_gap", 0)) ||
  safe("log.duplicate_sequence", false) == true ||
  safe("log.out_of_order", false) == true
)
', '2025-09-04 16:07:26.333384', true, false, 'origin', '["origin.ip","log.stream_id"]', '[{"indexPattern":"v11-log-syslog-*","with":[{"field":"origin.ip.keyword","operator":"filter_term","value":"{{.origin.ip}}"},{"field":"target.port","operator":"filter_term","value":6514}],"or":null,"within":"now-30m","count":5}]');
INSERT INTO public.utm_correlation_rules VALUES (1184, 'RFC-5425 Octet Counting Mismatches', 2, 3, 3, 'Impact', 'T1565.002 - Data Manipulation: Transmitted Data Manipulation', 'Detects mismatches in octet counting for RFC-5425 framed messages, which could indicate message tampering, injection attacks, or attempts to bypass message boundaries. This is critical for maintaining message integrity in syslog transmission.

Next Steps:
1. Investigate the source IP address for other protocol violations or suspicious activities
2. Check if the octet count mismatches are consistent or sporadic to determine if this is an attack or configuration issue
3. Examine the actual message content to identify potential injection attempts or malformed data
4. Review firewall and network device logs for any connection anomalies from the source
5. Verify syslog server configuration and network transport settings
6. Consider implementing message authentication mechanisms if not already in place
7. If attacks are confirmed, block the source IP and review security policies
', '["https://datatracker.ietf.org/doc/html/rfc5425#section-4.3.1","https://datatracker.ietf.org/doc/html/rfc6587#section-3.4.1","https://attack.mitre.org/techniques/T1565/002/"]', 'safe("log.protocol", "") == "rfc-5425" &&
safe("log.framing", "") == "octet-counting" && (
  (safe("log.declared_octets", 0) > 0 && safe("log.actual_octets", 0) > 0 && safe("log.declared_octets", 0) != safe("log.actual_octets", 0)) ||
  safe("log.octet_count_error", false) == true ||
  (safe("log.declared_octets", 0) > 0 && safe("log.declared_octets", 0) < safe("log.min_message_size", 480)) ||
  safe("log.octet_overflow", false) == true ||
  safe("log.negative_octet_count", false) == true
)
', '2025-09-04 16:07:26.883804', true, false, 'origin', '["origin.ip","target.ip","log.connection_id"]', '[{"indexPattern":"v11-log-syslog-*","with":[{"field":"origin.ip.keyword","operator":"filter_term","value":"{{.origin.ip}}"},{"field":"log.framing.keyword","operator":"filter_term","value":"octet-counting"}],"or":null,"within":"now-10m","count":3}]');
INSERT INTO public.utm_correlation_rules VALUES (1185, 'POODLE Attack Indicators', 3, 3, 2, 'Impact', 'POODLE Attack (CVE-2014-3566)', 'Detects potential POODLE (Padding Oracle On Downgraded Legacy Encryption) attack indicators through forced SSL 3.0 downgrade attempts and CBC padding exploitation. This attack exploits vulnerabilities in SSL 3.0 protocol where attackers can decrypt HTTPS connections by forcing downgrades and exploiting CBC cipher padding vulnerabilities.

Next Steps:
1. Immediately verify if SSL 3.0 is enabled on the target system and disable it if found
2. Check if the connection attempts are legitimate or suspicious based on source IP reputation
3. Review TLS/SSL configuration to ensure only TLS 1.2+ protocols are allowed
4. Investigate any successful connections from the same source IP within the time window
5. Consider implementing additional monitoring for protocol downgrade attempts
6. Update affected systems to support only secure TLS versions
7. Review firewall and IDS logs for additional indicators of attack
', '["https://www.cisa.gov/news-events/alerts/2014/10/17/ssl-30-protocol-vulnerability-and-poodle-attack","https://attack.mitre.org/techniques/T1499/","https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2014-3566"]', '(safe("log.ssl_version", "") == "3.0" || safe("log.tls_version", "") == "SSLv3") &&
(safe("log.cipher_suite", "").contains("CBC") || safe("log.cipher", "").contains("_CBC_")) &&
(safe("log.downgrade_attempt", false) == true ||
 safe("log.message", "").contains("protocol downgrade") ||
 (safe("log.handshake_failure", false) == true && safe("log.retry_count", 0) > 2))
', '2025-09-04 16:07:27.434978', true, false, 'origin', '["origin.ip","target.ip","target.port"]', '[{"indexPattern":"v11-log-syslog-*","with":[{"field":"origin.ip.keyword","operator":"filter_term","value":"{{.origin.ip}}"},{"field":"target.ip.keyword","operator":"filter_term","value":"{{.target.ip}}"}],"or":null,"within":"now-10m","count":5}]');
INSERT INTO public.utm_correlation_rules VALUES (1186, 'PRF Vulnerability Detection', 3, 3, 2, 'Credential Access, Discovery', 'Pseudo-Random Function Attack', 'Detects potential vulnerabilities in the Pseudo-Random Function (PRF) implementation including weak PRF algorithms, PRF computation errors, or attempts to exploit known PRF weaknesses. This rule identifies TLS connections using deprecated MD5-based PRF algorithms, PRF computation errors, missing extended master secret extensions, and key derivation failures that could indicate cryptographic attacks or implementation weaknesses.

Next Steps:
1. Investigate the source IP address for additional suspicious TLS/SSL activity
2. Review TLS/SSL configuration on affected systems to ensure strong cryptographic algorithms
3. Check for signs of man-in-the-middle attacks or downgrade attempts
4. Verify certificate validity and ensure proper PKI implementation
5. Update TLS implementations to use modern, secure PRF algorithms (SHA-256 or better)
6. Enable extended master secret extension support where possible
7. Monitor for patterns of cryptographic protocol exploitation
', '["https://datatracker.ietf.org/doc/html/rfc5246","https://attack.mitre.org/techniques/T1040/"]', 'safe("log.tls_prf_algorithm", "").contains("MD5") ||
safe("log.tls_prf_error", "") != "" ||
(safe("log.tls_version", "") == "TLS1.0" &&
 safe("log.tls_prf_algorithm", "") != "TLS_PRF_SHA256") ||
safe("log.tls_master_secret_error", "") != "" ||
safe("log.tls_key_derivation_error", "") != "" ||
(safe("log.tls_extended_master_secret", "false") == "false" &&
 safe("log.tls_version", "").contains("TLS1.2"))
', '2025-09-04 16:07:27.937469', true, false, 'origin', '["origin.ip","log.tls_prf_algorithm"]', '[{"indexPattern":"v11-log-syslog-*","with":[{"field":"origin.ip.keyword","operator":"filter_term","value":"{{.origin.ip}}"},{"field":"log.event_type.keyword","operator":"filter_term","value":"tls_error"}],"or":null,"within":"now-30m","count":5}]');
INSERT INTO public.utm_correlation_rules VALUES (1187, 'RFC-5425 TLS Record Layer Attack Detection', 3, 3, 3, 'Command and Control', 'T1573 - Encrypted Channel', 'Detects potential attacks against the TLS record layer in RFC-5425 syslog communications, including MAC verification failures, record size violations, and encryption anomalies. These attacks may indicate attempts to compromise secure syslog transmission or intercept sensitive log data.

Next Steps:
1. Verify the source IP and destination of the TLS connection
2. Check for other TLS-related errors from the same source
3. Review firewall and network logs for suspicious activity
4. Validate TLS certificate chain and configuration
5. Consider implementing additional network monitoring
6. If confirmed malicious, block the source IP and investigate potential data compromise
', '["https://datatracker.ietf.org/doc/html/rfc5425","https://attack.mitre.org/techniques/T1573/"]', '(safe("log.tls_alert_code", 0.0) == double(20) ||
 safe("log.tls_alert_description", "") == "bad_record_mac" ||
 safe("log.tls_error", "").matches(".*record.*mac.*fail.*") ||
 safe("log.tls_record_size", 0) > 16384 ||
 safe("log.message", "").matches(".*TLSCiphertext.*length.*exceed.*") ||
 safe("log.tls_record_type", "") == "invalid" ||
 safe("log.tls_error", "").matches(".*decrypt.*error.*record.*")) &&
safe("log.protocol", "") == "syslog-tls"
', '2025-09-04 16:07:28.249032', true, false, 'origin', '["origin.ip","target.ip"]', '[{"indexPattern":"v11-log-syslog-*","with":[{"field":"origin.ip.keyword","operator":"filter_term","value":"{{.origin.ip}}"},{"field":"log.protocol.keyword","operator":"filter_term","value":"syslog-tls"}],"or":null,"within":"now-5m","count":3}]');
INSERT INTO public.utm_correlation_rules VALUES (1317, 'Windows: Clearing Windows Console History', 1, 2, 3, 'Defense Evasion', 'Clear Command History', 'Identifies when a user attempts to clear console history. An adversary may clear the command history of a compromised account to conceal the actions undertaken during an intrusion.', '["https://attack.mitre.org/tactics/TA0005/","https://attack.mitre.org/techniques/T1070/003/"]', 'safe("log.message", "").matches(''(Clear-History|(Remove-Item|rm)(.+)(ConsoleHost_history.txt|\\(Get-PSReadlineOption\\)\\.HistorySavePath)|(ConsoleHost_history.txt|\\(Get-PSReadlineOption\\)\\.HistorySavePath)(.+)(Remove-Item|rm)|Set-PSReadlineOption(.+)SaveNothing|SaveNothing(.+)PSReadlineOption)'') && safe("log.winlogProviderName", "") == ''PowerShell''', '2025-09-04 20:22:44.073182', true, false, 'origin', NULL, '[]');
INSERT INTO public.utm_correlation_rules VALUES (1188, 'TLS Renegotiation Vulnerability Exploitation', 3, 3, 2, 'Credential Access, Collection', 'T1557 - Adversary-in-the-Middle', 'Detects attempts to exploit TLS renegotiation vulnerabilities in RFC-5425 syslog connections. These vulnerabilities could allow attackers to inject malicious content into encrypted sessions through man-in-the-middle attacks, potentially compromising the integrity of log data transmission and enabling unauthorized access to sensitive information.

Next Steps:
1. Immediately investigate the source IP address for suspicious activity
2. Review TLS configuration on affected syslog servers to ensure secure renegotiation is properly configured
3. Check for any unauthorized changes to syslog server configurations
4. Examine network traffic patterns between the source and destination for anomalies
5. Verify the authenticity of certificates being used in the connection
6. Consider implementing additional network monitoring on the affected connection path
7. Review recent system and application logs for signs of compromise
8. If confirmed malicious, consider blocking the source IP and updating firewall rules
9. Update TLS configurations to disable insecure renegotiation and implement RFC 5746 secure renegotiation
10. Notify security team and document the incident for threat intelligence purposes
', '["https://datatracker.ietf.org/doc/html/rfc5425","https://datatracker.ietf.org/doc/html/rfc5746","https://attack.mitre.org/techniques/T1557/"]', '(safe("log.message", "").contains("renegotiation") &&
 (safe("log.message", "").contains("failed") ||
  safe("log.message", "").contains("denied") ||
  safe("log.message", "").contains("not allowed") ||
  safe("log.message", "").contains("disabled"))) ||
safe("log.message", "").contains("insecure renegotiation") ||
safe("log.message", "").contains("unsafe legacy renegotiation") ||
safe("log.message", "").contains("client initiated renegotiation") ||
safe("log.message", "").contains("no renegotiation indication") ||
safe("log.message", "").contains("renegotiation attack") ||
(safe("log.message", "").contains("SSL") && safe("log.message", "").contains("renegotiate"))
', '2025-09-04 16:07:28.760803', true, false, 'origin', '["origin.ip","target.ip","log.connection_id"]', '[]');
INSERT INTO public.utm_correlation_rules VALUES (1189, 'TLS Session Resumption Attack Detection', 2, 3, 1, 'Lateral Movement', 'Session Hijacking', 'Detects potential TLS session resumption attacks in RFC-5425 syslog connections where attackers attempt to reuse or hijack existing TLS sessions. This rule identifies suspicious session resumption failures, mismatched session IDs, expired tickets, and other anomalies that may indicate an active session hijacking attempt.

Next Steps:
1. Investigate the source IP address for any known malicious activity or unusual geographic location
2. Review TLS certificate validity and check for certificate-based attacks
3. Examine network logs for any unusual connection patterns or traffic volume from the source
4. Verify the legitimacy of the syslog client attempting session resumption
5. Check for concurrent sessions from the same source that might indicate session cloning
6. Review firewall and IDS logs for additional suspicious network activity
7. Consider temporarily blocking the source IP if attack indicators are confirmed
8. Update TLS configuration to enforce stronger session management policies
', '["https://datatracker.ietf.org/doc/html/rfc5425","https://attack.mitre.org/techniques/T1563/"]', '(safe("log.message", "").contains("session resumption failed") || safe("log.message", "").contains("session id mismatch") || safe("log.message", "").contains("session ticket expired") || safe("log.message", "").contains("session cache") || safe("log.message", "").contains("resumption handshake failed") || safe("log.message", "").contains("session not found") || safe("log.message", "").contains("invalid session ticket") || safe("log.message", "").contains("session reuse")) && safe("log.severity", 10) <= 4 && (safe("log.structured_data", "").contains("tls") || safe("log.app_name", "").contains("syslog"))', '2025-09-04 16:07:47.746817', true, false, 'origin', '["origin.ip","lastEvent.host"]', '[{"indexPattern":"v11-log-syslog-*","with":[{"field":"origin.ip.keyword","operator":"filter_term","value":"{{.origin.ip}}"},{"field":"log.hostname.keyword","operator":"filter_term","value":"{{.safe(\"log.hostname\", \"\")}}"}],"or":null,"within":"now-30m","count":10}]');
INSERT INTO public.utm_correlation_rules VALUES (1190, 'TLS Session Ticket Abuse Detection', 3, 3, 2, 'Defense Evasion, Lateral Movement', 'T1550 - Use Alternate Authentication Material', 'Detects potential abuse of TLS session tickets including reuse across different zones, expired ticket usage, or rapid session resumption attempts that may indicate session hijacking or authentication bypass attempts.

Next Steps:
1. Verify the legitimacy of the TLS session ticket usage patterns
2. Check if the source IP is authorized to access the target zones
3. Analyze the frequency and timing of session resumptions from the same source
4. Investigate any associated authentication events or zone transfer activities
5. Review TLS configuration and session ticket lifetime policies
6. Consider implementing stricter session ticket validation and zone-based access controls
', '["https://datatracker.ietf.org/doc/html/rfc5077","https://attack.mitre.org/techniques/T1550/"]', '(safe("log.tls_session_resumed", "false") == "true" && safe("log.tls_session_ticket_age", 0) > 86400) || (safe("log.tls_session_resumed", "false") == "true" && safe("log.tls_session_ticket_zone", "") != "" && safe("log.tls_current_zone", "") != "" && safe("log.tls_session_ticket_zone", "") != safe("log.tls_current_zone", "")) || (safe("log.tls_session_ticket_error", "") != "")', '2025-09-04 16:07:48.234689', true, false, 'origin', '["origin.ip","log.tls_session_id"]', '[{"indexPattern":"v11-log-syslog-*","with":[{"field":"origin.ip.keyword","operator":"filter_term","value":"{{.origin.ip}}"},{"field":"log.tls_session_resumed.keyword","operator":"filter_term","value":"true"}],"or":null,"within":"now-1m","count":10}]');
INSERT INTO public.utm_correlation_rules VALUES (1191, 'SNI Spoofing Attempts Detected', 3, 3, 2, 'Command and Control', 'Server Name Indication Spoofing', 'Detects potential SNI (Server Name Indication) spoofing attempts where the SNI field does not match the certificate common name or where multiple different SNI values are used from the same source in a short time period. This technique is commonly used in man-in-the-middle attacks and SSL/TLS interception to bypass security controls.

Next Steps:
- Investigate the source IP address for other suspicious network activity
- Verify the legitimacy of the TLS certificates involved
- Check if the destination servers are legitimate or potentially compromised
- Review network traffic patterns from the source IP for additional indicators of compromise
- Consider blocking the source IP if malicious activity is confirmed
', '["https://datatracker.ietf.org/doc/html/rfc5425","https://attack.mitre.org/techniques/T1090/"]', 'safe("log.tls_sni", "") != "" &&
safe("log.tls_cert_cn", "") != "" &&
safe("log.tls_sni", "") != safe("log.tls_cert_cn", "") &&
!safe("log.tls_cert_san", "").contains(safe("log.tls_sni", ""))
', '2025-09-04 16:07:48.712945', true, false, 'origin', '["origin.ip","log.tls_sni"]', '[{"indexPattern":"v11-log-syslog-*","with":[{"field":"origin.ip.keyword","operator":"filter_term","value":"{{.origin.ip}}"},{"field":"log.tls_sni.keyword","operator":"must_not_term","value":"{{.log.tls_sni}}"}],"or":null,"within":"now-5m","count":3}]');
INSERT INTO public.utm_correlation_rules VALUES (1477, 'Windows: File system full', 1, 2, 3, 'Potentially Malicious Activity', 'File and Directory Permissions', 'Detects events indicating that the file system is full, which may lead to system instability or data loss.', '["https://learn.microsoft.com/en-us/windows/security/threat-protection/windows-defender-antivirus/troubleshoot"]', 'safe("log.winlogEventDataLogName", "") == "File Replication Service" && safe("log.eventCode", 0.0) == double(13570)', '2025-09-04 21:12:16.274385', true, false, 'target', NULL, '[]');
INSERT INTO public.utm_correlation_rules VALUES (1192, 'TLS Handshake Failure Detection', 3, 3, 2, 'Initial Access', 'Protocol Impersonation', 'Detects TLS handshake failures in RFC-5425 syslog transport which may indicate certificate issues, protocol mismatches, or potential man-in-the-middle attacks.

Next Steps:
1. Verify the certificate configuration on both client and server sides
2. Check for expired or invalid certificates in the certificate chain
3. Review TLS protocol version compatibility between client and server
4. Examine network logs for signs of intercepted connections or proxy interference
5. Validate that the origin IP is authorized to connect to the syslog server
6. Check for recent configuration changes to TLS settings or cipher suites
7. Monitor for patterns indicating automated scanning or brute force attempts
8. Consider implementing certificate pinning if not already in place
', '["https://datatracker.ietf.org/doc/html/rfc5425","https://attack.mitre.org/techniques/T1190/"]', '(safe("log.message", "").contains("handshake failure") ||
 safe("log.message", "").contains("handshake failed") ||
 safe("log.message", "").contains("SSL handshake error") ||
 safe("log.message", "").contains("TLS handshake error") ||
 safe("log.message", "").contains("ssl3_get_server_hello") ||
 safe("log.message", "").contains("ssl3_get_client_hello")) &&
(safe("log.severity", 10) <= 3 || safe("log.priority", 10) <= 3)
', '2025-09-04 16:07:49.328042', true, false, 'origin', '["origin.ip","lastEvent.target.ip"]', '[{"indexPattern":"v11-log-syslog-*","with":[{"field":"origin.ip.keyword","operator":"filter_term","value":"{{.origin.ip}}"}],"or":null,"within":"now-5m","count":3}]');
INSERT INTO public.utm_correlation_rules VALUES (1193, 'RFC-5425 TLS Version Downgrade Attacks', 3, 3, 1, 'Credential Access, Collection', 'T1557 - Adversary-in-the-Middle', 'Detects attempts to downgrade TLS version in RFC-5425 syslog connections, which could allow attackers to exploit vulnerabilities in older TLS versions or perform man-in-the-middle attacks on syslog traffic.

Next Steps:
1. Verify if the source IP is authorized to establish syslog connections
2. Check if the downgrade was initiated by a legitimate network device or security appliance
3. Review network traffic patterns from the source IP for other suspicious activities
4. Examine firewall and IDS logs for related TLS manipulation attempts
5. Ensure all syslog clients and servers are configured to use TLS 1.2 or higher
6. Consider blocking the source IP if the activity is confirmed as malicious
', '["https://datatracker.ietf.org/doc/html/rfc5425#section-5","https://attack.mitre.org/techniques/T1557/","https://attack.mitre.org/techniques/T1040/"]', 'safe("log.protocol", "") == "rfc-5425" && (
  (safe("log.tls_version", "") in ["TLSv1.0", "TLSv1.1"]) ||
  (safe("log.tls_version_offered", "") != "" && safe("log.tls_version_negotiated", "") != "" && safe("log.tls_version_negotiated", "") < safe("log.tls_version_offered", "")) ||
  safe("log.tls_downgrade_detected", false) == true ||
  safe("log.ssl_fallback", false) == true ||
  (safe("log.cipher_strength", "") == "weak" && safe("target.port", 0.0) == double(6514))
)
', '2025-09-04 16:07:49.865566', true, false, 'origin', '["adversary.ip","target.ip"]', '[{"indexPattern":"v11-log-syslog-*","with":[{"field":"origin.ip.keyword","operator":"filter_term","value":"{{.origin.ip}}"},{"field":"target.port","operator":"filter_term","value":"6514"}],"or":null,"within":"now-1h","count":2}]');
INSERT INTO public.utm_correlation_rules VALUES (1194, 'TCP ACK Flooding Attack Detection', 1, 1, 3, 'Impact', 'T1498: Network Denial of Service', 'Detects TCP ACK flooding attacks where attackers send massive amounts of ACK packets to overwhelm target systems, consume bandwidth, or exhaust connection state tables. These attacks exploit the TCP protocol by sending ACK packets without a proper TCP handshake, causing resource exhaustion on the target.

Next Steps:
1. Identify the source IP address(es) generating the ACK flood
2. Check if the source IP is spoofed or legitimate
3. Implement rate limiting or ACL rules to block the attacking IP(s)
4. Monitor target system resources (CPU, memory, connection tables)
5. Consider implementing SYN cookies or connection rate limiting
6. Review firewall logs for patterns of similar attacks
7. Contact upstream ISP if attack volume is significant
', '["https://datatracker.ietf.org/doc/html/rfc793#section-3.4","https://attack.mitre.org/techniques/T1498/"]', 'safe("log.tcp_flags", "") == "ACK" &&
safe("log.syn_flag", false) == false &&
safe("log.fin_flag", false) == false &&
safe("log.rst_flag", false) == false &&
safe("log.tcp_len", 0.0) == double(0) &&
(safe("log.tcp_ack_number", 0.0) == double(0) ||
 safe("log.tcp_stream_invalid", false) == true)
', '2025-09-04 16:08:16.61492', true, false, 'origin', '["adversary.ip"]', '[{"indexPattern":"v11-log-syslog-*","with":[{"field":"origin.ip.keyword","operator":"filter_term","value":"{{.origin.ip}}"},{"field":"log.tcp_flags.keyword","operator":"filter_term","value":"ACK"},{"field":"log.tcp_len","operator":"filter_term","value":"0"}],"or":null,"within":"now-1m","count":50}]');
INSERT INTO public.utm_correlation_rules VALUES (1195, 'TCP Buffer Overflow Attempt Detection', 3, 3, 3, 'Defense Evasion, Privilege Escalation', 'T1055.001 - Process Injection: Dynamic-link Library Injection', 'Detects potential buffer overflow attempts in TCP syslog streams including oversized messages, malformed length fields, and attempts to exploit fixed-size buffers in syslog receivers.

Next Steps:
1. Immediately isolate the source IP address to prevent further exploitation attempts
2. Review all syslog messages from the source IP in the last 24 hours for reconnaissance activity
3. Check if the target syslog receiver has crashed or is showing signs of compromise
4. Examine system logs on the syslog receiver for signs of code execution or privilege escalation
5. Verify that the syslog receiver is patched against known buffer overflow vulnerabilities
6. Consider implementing rate limiting and message size validation at the network level
7. Collect packet captures of the malicious traffic for forensic analysis
', '["https://datatracker.ietf.org/doc/html/rfc6587","https://attack.mitre.org/techniques/T1055/001/"]', '(safe("log.message_length", 0) > 8192 &&
 safe("log.payload_size", 0) > 8192) ||
(safe("log.segment_data_length", 0) > safe("log.declared_length", 0) &&
 safe("log.declared_length", 0) > 0) ||
safe("log.octet_count", 0) > 65535 ||
safe("log.payload", "").matches("\\x90{50,}|\\x00{100,}") ||
(safe("log.delimiter_missing", false) == true &&
 safe("log.payload_size", 0) > 4096)
', '2025-09-04 16:08:17.36197', true, false, 'origin', '["adversary.ip","target.ip"]', '[{"indexPattern":"v11-log-syslog-*","with":[{"field":"origin.ip.keyword","operator":"filter_term","value":"{{.origin.ip}}"},{"field":"target.ip.keyword","operator":"filter_term","value":"{{.target.ip}}"}],"or":null,"within":"now-5m","count":10}]');
INSERT INTO public.utm_correlation_rules VALUES (1196, 'TCP Congestion Control Abuse', 1, 2, 3, 'Impact', 'T1499 - Endpoint Denial of Service', 'Detects TCP congestion control abuse where attackers exploit congestion control mechanisms to generate non-responsive traffic, cause denial of service, or suppress legitimate traffic. Monitors for ECN violations, optimistic ACKing, and malicious burst patterns.

Next Steps:
1. Identify the source IP and determine if it belongs to a legitimate service or user
2. Check if the target system is experiencing performance degradation or service interruption
3. Review packet capture data to analyze TCP behavior patterns and confirm congestion control manipulation
4. Consider implementing rate limiting or blocking the source IP if malicious activity is confirmed
5. Monitor for similar patterns from other source IPs that may indicate a coordinated attack
6. Document the incident and update firewall rules or IDS signatures to prevent future attacks
', '["https://www.researchgate.net/publication/2384706_TCP_Congestion_Control_with_a_Misbehaving_Receiver","https://attack.mitre.org/techniques/T1499/"]', '(safe("log.tcp_ecn_flags", "") != "" && safe("log.tcp_ecn_cwr", false) == true && safe("log.tcp_ecn_ece", false) == false) ||
(safe("log.tcp_ack_rate", 0) > 1000 && safe("log.tcp_data_rate", 0) < 100) ||
safe("log.tcp_retransmission_rate", 0) > 0.3 ||
(safe("log.tcp_congestion_window", 0) > 0 && safe("log.tcp_congestion_window_delta", 0) > 65535) ||
(safe("log.tcp_duplicate_acks", 0) > 50 && safe("log.tcp_segment_lost", 0.0) == double(0))
', '2025-09-04 16:08:17.906014', true, false, 'origin', '["adversary.ip","target.ip","target.port"]', '[{"indexPattern":"v11-log-syslog-*","with":[{"field":"origin.ip.keyword","operator":"filter_term","value":"{{.origin.ip}}"},{"field":"target.ip.keyword","operator":"filter_term","value":"{{.target.ip}}"}],"or":null,"within":"now-3m","count":25}]');
INSERT INTO public.utm_correlation_rules VALUES (1197, 'TCP Connection Hijacking Detection', 3, 3, 2, 'Lateral Movement', 'T1563.001 - Remote Service Session Hijacking: SSH Hijacking', 'Detects potential TCP connection hijacking attempts through sequence number prediction, unexpected RST packets, or mid-stream IP address changes that could indicate session takeover.

Next Steps:
1. Immediately isolate the affected systems to prevent further compromise
2. Review network traffic logs for the source IP to identify scope of attack
3. Check for any unauthorized access or data exfiltration from affected sessions
4. Analyze packet captures to confirm sequence number anomalies
5. Review authentication logs for any suspicious activity around the same timeframe
6. Update firewall rules to block the attacker''s IP address
7. Consider implementing TCP sequence number randomization if not already enabled
8. Document all findings for incident response and potential law enforcement involvement
', '["https://datatracker.ietf.org/doc/html/rfc6587","https://attack.mitre.org/techniques/T1563/001/"]', '(safe("log.tcp_seq_anomaly", false) == true &&
 safe("log.tcp_flags", "").matches("PSH|ACK")) ||
(safe("log.tcp_unexpected_rst", false) == true &&
 safe("log.tcp_established_conn", false) == true) ||
safe("log.tcp_mid_stream_syn", false) == true ||
(safe("log.tcp_seq_jump", 0) > 1000000 &&
 !safe("log.tcp_flags", "").matches("SYN"))
', '2025-09-04 16:08:18.4018', true, false, 'origin', '["adversary.ip","target.ip","log.tcp_stream"]', '[{"indexPattern":"v11-log-syslog-*","with":[{"field":"log.tcp_stream.keyword","operator":"filter_term","value":"{{.log.tcp_stream}}"}],"or":null,"within":"now-10m","count":5}]');
INSERT INTO public.utm_correlation_rules VALUES (1198, 'TCP Connection State Attack Detection', 2, 3, 3, 'Impact', 'Connection State Manipulation', 'Detects anomalous TCP connection state transitions that may indicate connection hijacking, state exhaustion attacks, or protocol manipulation attempts. This rule monitors for invalid TCP states combined with suspicious flag combinations that are commonly associated with TCP/IP stack attacks.

Next Steps:
1. Investigate the source IP address for other suspicious activity or connection attempts
2. Check if the target service is experiencing performance issues or unavailability
3. Review firewall logs for any blocked connection attempts from the same source
4. Analyze packet captures if available to understand the exact nature of the malformed TCP packets
5. Consider implementing rate limiting or blocking the source IP if the activity is confirmed malicious
6. Document the incident and update network security policies as needed
', '["https://datatracker.ietf.org/doc/html/rfc6587","https://attack.mitre.org/techniques/T1499/"]', 'safe("log.tcp_state", "") in ["INVALID", "UNESTABLISHED", "TIME_WAIT_REUSE"] &&
safe("log.syn_flag", false) == true &&
safe("log.ack_flag", false) == false
', '2025-09-04 16:08:18.932052', true, false, 'origin', '["adversary.ip","target.port"]', '[{"indexPattern":"v11-log-syslog-*","with":[{"field":"origin.ip.keyword","operator":"filter_term","value":"{{.origin.ip}}"},{"field":"log.tcp_state.keyword","operator":"filter_term","value":"INVALID"}],"or":null,"within":"now-5m","count":10}]');
INSERT INTO public.utm_correlation_rules VALUES (1199, 'FIN/ACK TCP Flag Anomalies', 2, 2, 3, 'Discovery', 'T1046 - Network Service Scanning', 'Detects anomalous FIN and ACK flag patterns used in stealth scanning and ACK flood attacks. Includes detection of FIN scans where attackers send FIN packets to identify open ports and ACK floods used for DoS attacks.

Next Steps:
1. Verify if the source IP is internal or external - external sources are more suspicious
2. Check if the target ports are critical services (databases, web servers, etc.)
3. Review firewall logs for any connection attempts from the same source IP
4. Look for other scanning patterns from the same source (SYN scans, NULL scans)
5. If confirmed malicious, block the source IP at the firewall level
6. Document the incident and check if this is part of a larger reconnaissance campaign
', '["https://www.elastiflow.com/blog/posts/detecting-tcp-flag-based-attacks-with-elastiflow","https://attack.mitre.org/techniques/T1046/"]', '(safe("log.tcp_flags", "").contains("FIN") &&
 safe("log.connection_state", "") != "established" &&
 safe("log.port_scan_indicator", false) == true) ||
(safe("log.tcp_flags", "") == "ACK" &&
 safe("log.ack_without_syn", false) == true &&
 safe("log.ack_count", 0) > 100 &&
 safe("log.time_window", 0) <= 10)
', '2025-09-04 16:08:19.579107', true, false, 'origin', '["adversary.ip","log.tcp_flags"]', '[{"indexPattern":"v11-log-syslog-*","with":[{"field":"origin.ip.keyword","operator":"filter_term","value":"{{.origin.ip}}"},{"field":"log.tcp_flags.keyword","operator":"filter_term","value":"{{.log.tcp_flags}}"}],"or":null,"within":"now-10m","count":50}]');
INSERT INTO public.utm_correlation_rules VALUES (1320, 'Windows: Potential Credential Access via Trusted Developer Utility', 2, 2, 3, 'Credential Access', 'Brute Force', 'An instance of MSBuild, the Microsoft Build Engine, loaded DLLs (dynamically linked libraries) responsible for Windows credential management. This technique is sometimes used for credential dumping.', '["https://attack.mitre.org/tactics/TA0006/","https://attack.mitre.org/techniques/T1003/"]', 'safe("log.winlogEventDataProcessName", "").matches(''(MSBuild.exe|msbuild.exe)'') && safe("log.message", "").matches(''(vaultcli.dll|SAMLib.DLL)'')', '2025-09-04 20:22:45.711694', true, false, 'origin', NULL, '[{"indexPattern":"v11-log-wineventlog-*","with":[{"field":"log.eventDataProcessId.keyword","operator":"filter_term","value":"{{.log.eventDataProcessId}}"}],"or":null,"within":"now-1m","count":1}]');
INSERT INTO public.utm_correlation_rules VALUES (1450, 'Windows: A user account was disabled', 1, 3, 2, 'Persistence', 'Account Manipulation', 'Adversaries can manipulate accounts to maintain access to victim systems. These actions could also include account activity designed to subvert policies such as performing iterative password updates to bypass policies password lifetime and preserve the life of compromised credentials.', '["https://attack.mitre.org/tactics/TA0003/","https://attack.mitre.org/techniques/T1098/"]', 'safe("log.eventCode", 0.0) == double(4725)', '2025-09-04 21:01:37.584178', true, false, 'origin', NULL, '[]');
INSERT INTO public.utm_correlation_rules VALUES (1200, 'RFC-6587 Frame Length Manipulation', 2, 3, 3, 'Impact', 'T1499.002 - Endpoint Denial of Service: Service Exhaustion Flood', 'Detects attempts to manipulate frame length fields in octet-counting method to cause buffer overflows, message truncation, or parser confusion by providing extremely large or negative length values.

Next Steps:
- Review the source IP address for any previous suspicious activity
- Check if the declared frame lengths match expected syslog message sizes
- Analyze network traffic from the source IP for other protocol manipulation attempts
- Verify if the syslog receiver experienced any performance issues or crashes
- Consider blocking the source IP if malicious intent is confirmed
- Review syslog parser configurations for proper input validation
', '["https://datatracker.ietf.org/doc/html/rfc6587#section-3.4.1","https://attack.mitre.org/techniques/T1499/002/","https://cwe.mitre.org/data/definitions/130.html"]', 'safe("log.transport", "") == "tcp" &&
safe("log.framing", "") == "octet-counting" &&
(
  safe("log.declared_length", 0) > 8192 ||
  safe("log.declared_length", 0) < 0 ||
  safe("log.length_overflow", false) == true ||
  (safe("log.declared_length", 0) > 0 && safe("log.actual_length", 0) > 0 && safe("log.actual_length", 0) > safe("log.max_message_size", 2048))
)
', '2025-09-04 16:08:20.118641', true, false, 'origin', '["adversary.ip","target.port"]', '[{"indexPattern":"v11-log-syslog-*","with":[{"field":"origin.ip.keyword","operator":"filter_term","value":"{{.origin.ip}}"},{"field":"target.port","operator":"filter_term","value":"{{.target.port}}"}],"or":null,"within":"now-10m","count":5}]');
INSERT INTO public.utm_correlation_rules VALUES (1201, 'TCP Keep-Alive Anomaly Detection', 1, 2, 3, 'Impact', 'T1499.001 - Endpoint Denial of Service: OS Exhaustion Flood', 'Detects abnormal TCP keep-alive behavior including excessive keep-alive probes, unusually short intervals, or keep-alive flooding that may indicate connection persistence attacks or resource exhaustion attempts.

Next Steps:
1. Review the source IP address (origin.ip) for suspicious activity patterns
2. Check if the keep-alive intervals are significantly shorter than normal (typically 7200 seconds)
3. Analyze the volume of keep-alive packets from the source to identify potential flooding
4. Verify if this is legitimate monitoring traffic or a persistence mechanism
5. Check for other anomalous network behavior from the same source
6. Consider blocking the source IP if malicious intent is confirmed
7. Review firewall and network device configurations for proper keep-alive timeout settings
', '["https://datatracker.ietf.org/doc/html/rfc1122#section-4.2.3.6","https://attack.mitre.org/techniques/T1499/001/"]', 'safe("log.tcp_keep_alive", false) == true &&
(safe("log.keep_alive_interval", 0) < 60 ||
 safe("log.keep_alive_count", 0) > 20 ||
 (safe("log.tcp_flags", "") == "ACK" && safe("log.tcp_len", 0.0) == double(0)))
', '2025-09-04 16:08:20.673104', true, false, 'origin', '["adversary.ip","target.ip"]', '[{"indexPattern":"v11-log-syslog-*","with":[{"field":"origin.ip.keyword","operator":"filter_term","value":"{{.origin.ip}}"},{"field":"target.ip.keyword","operator":"filter_term","value":"{{.target.ip}}"},{"field":"log.tcp_keep_alive","operator":"filter_term","value":"true"}],"or":null,"within":"now-10m","count":50}]');
INSERT INTO public.utm_correlation_rules VALUES (1202, 'RFC-6587 Message Delimiter Injection', 2, 3, 2, 'Defense Evasion', 'Log Injection', 'Detects attempts to inject message delimiters (LF characters or octet count sequences) within syslog messages to manipulate message boundaries and potentially hide malicious activity or corrupt log parsing.

Next Steps:
1. Review the source IP address and determine if it''s an authorized syslog sender
2. Examine the raw log message content for signs of delimiter injection patterns
3. Check if the syslog server configuration properly validates message boundaries
4. Look for other suspicious activities from the same source IP in recent logs
5. Consider implementing stricter input validation on the syslog receiver
6. If confirmed malicious, block the source IP and investigate potential log tampering
', '["https://datatracker.ietf.org/doc/html/rfc6587#section-3.4","https://attack.mitre.org/techniques/T1027/","https://owasp.org/www-community/attacks/Log_Injection"]', 'safe("log.transport", "") == "tcp" &&
(
  (safe("log.message", "").contains("\n") && safe("log.framing", "") == "octet-counting") ||
  safe("log.embedded_delimiter", false) == true ||
  safe("log.message", "").matches(".*\\d+\\s<\\d+>.*") ||
  safe("log.delimiter_count", 0) > 1
)
', '2025-09-04 16:08:21.270813', true, false, 'origin', '["adversary.ip","log.app_name"]', '[{"indexPattern":"v11-log-syslog-*","with":[{"field":"origin.ip.keyword","operator":"filter_term","value":"{{.origin.ip}}"},{"field":"log.app_name.keyword","operator":"filter_term","value":"{{.log.app_name}}"}],"or":null,"within":"now-1h","count":3}]');
INSERT INTO public.utm_correlation_rules VALUES (1203, 'TCP MSS Manipulation Attack', 1, 2, 3, 'Impact', 'T1499 - Endpoint Denial of Service', 'Detects TCP MSS manipulation attacks where attackers send crafted packets with abnormally low MSS values to trigger excessive resource consumption. This can force systems to segment responses into multiple tiny TCP segments, drastically increasing bandwidth usage and consuming CPU resources.

Next Steps:
1. Identify the source IP address initiating the MSS manipulation attempts
2. Check if the source IP is associated with known malicious activity
3. Review system performance metrics for signs of resource exhaustion
4. Analyze packet captures to confirm the MSS values and TCP options
5. Consider implementing rate limiting or blocking the source IP if attack persists
6. Update firewall rules to filter packets with abnormally low MSS values
7. Monitor for similar attacks from other source IPs
', '["https://access.redhat.com/security/vulnerabilities/tcpsack","https://attack.mitre.org/techniques/T1499/"]', 'safe("log.tcp_mss", 0) > 0 && safe("log.tcp_mss", 0) < 48 &&
(safe("log.tcp_flags", "").contains("SYN") || safe("log.tcp_options", "").contains("mss"))
', '2025-09-04 16:08:21.873965', true, false, 'origin', '["adversary.ip"]', '[{"indexPattern":"v11-log-syslog-*","with":[{"field":"origin.ip.keyword","operator":"filter_term","value":"{{.origin.ip}}"}],"or":null,"within":"now-5m","count":10}]');
INSERT INTO public.utm_correlation_rules VALUES (1401, 'Windows: Suspicious MS Outlook Child Process', 1, 3, 2, 'Initial Access', 'Spearphishing Attachment', 'Identifies suspicious child processes of Microsoft Outlook. These child processes are often associated with spear phishing activity.', '["https://attack.mitre.org/tactics/TA0001/","https://attack.mitre.org/techniques/T1566/001/"]', 'safe("log.winlogEventDataProcessName", "") in ["Microsoft.Workflow.Compiler.exe", "arp.exe", "atbroker.exe", "bginfo.exe", "bitsadmin.exe", "cdb.exe", "certutil.exe", "cmd.exe", "cmstp.exe", "cscript.exe", "csi.exe", "dnx.exe", "dsget.exe", "dsquery.exe", "forfiles.exe", "fsi.exe", "ftp.exe", "gpresult.exe", "hostname.exe", "ieexec.exe", "iexpress.exe", "installutil.exe", "ipconfig.exe", "mshta.exe", "msxsl.exe", "nbtstat.exe", "net.exe", "net1.exe", "netsh.exe", "netstat.exe", "nltest.exe", "odbcconf.exe", "ping.exe", "powershell.exe", "pwsh.exe", "qprocess.exe", "quser.exe", "qwinsta.exe", "rcsi.exe", "reg.exe", "regasm.exe", "regsvcs.exe", "regsvr32.exe", "sc.exe", "schtasks.exe", "systeminfo.exe", "tasklist.exe", "tracert.exe", "whoami.exe", "wmic.exe", "wscript.exe", "xwizard.exe"] && safe("log.winlogEventDataParentProcessName", "").contains("outlook.exe")', '2025-09-04 20:46:23.196923', true, false, 'origin', NULL, '[]');
INSERT INTO public.utm_correlation_rules VALUES (1204, 'RFC-6587 Non-Transparent Framing Issues', 1, 3, 3, 'Impact', 'Data Manipulation', 'Detects issues with non-transparent framing method including improper line feed termination, mixed framing methods, or missing delimiters that could lead to message boundary confusion. These issues can result in log parsing failures, message corruption, or potential denial of service conditions.

Next Steps:
1. Identify the source system sending malformed syslog messages by checking the origin IP address
2. Review the syslog configuration on the sending system to ensure proper RFC-6587 compliance
3. Check if the issue is consistent or intermittent by reviewing historical logs from the same source
4. Verify the syslog daemon or application version on the source system for known bugs
5. Consider implementing strict syslog parsing rules or upgrading the syslog infrastructure
6. Monitor for any data loss or corruption resulting from the framing issues
7. Document the issue and coordinate with system administrators to remediate the configuration
', '["https://datatracker.ietf.org/doc/html/rfc6587#section-3.4.2","https://attack.mitre.org/techniques/T1499/"]', 'safe("log.transport", "") == "tcp" &&
safe("log.framing", "") == "non-transparent" &&
(
  safe("log.missing_lf", false) == true ||
  safe("log.mixed_framing", false) == true ||
  safe("log.incomplete_frame", false) == true ||
  (safe("log.message", "") != "" && !safe("log.message", "").endsWith("\n"))
)
', '2025-09-04 16:08:50.471467', true, false, 'origin', '["adversary.ip","log.facility"]', '[]');
INSERT INTO public.utm_correlation_rules VALUES (1407, 'Windows: PowerShell Script with Token Impersonation Capabilities', 3, 3, 2, 'Privilege Escalation', 'Token Impersonation/Theft', 'Detects scripts that contain PowerShell functions, structures, or Windows API functions related to token impersonation/theft. Attackers may duplicate then impersonate another user''s token to escalate privileges and bypass access controls.', '["https://attack.mitre.org/tactics/TA0004/","https://attack.mitre.org/techniques/T1134/001/"]', 'safe("log.message", "") in [''Invoke-TokenManipulation'', ''ImpersonateNamedPipeClient'', ''NtImpersonateThread''] && safe("log.message", "").matches("(UpdateProcThreadAttribute(.+)STARTUPINFOEX|STARTUPINFOEX(.+)UpdateProcThreadAttribute)") && safe("log.message", "").matches("(AdjustTokenPrivileges(.+)SeDebugPrivilege|SeDebugPrivilege(.+)AdjustTokenPrivileges)") && safe("log.message", "").matches("((SetThreadToken|ImpersonateLoggedOnUser|CreateProcessWithTokenW|CreatePRocessAsUserW|CreateProcessAsUserA)(.+)(DuplicateToken|DuplicateTokenEx)|(DuplicateToken|DuplicateTokenEx)(.+)(SetThreadToken|ImpersonateLoggedOnUser|CreateProcessWithTokenW|CreatePRocessAsUserW|CreateProcessAsUserA))")', '2025-09-04 20:52:53.255979', true, false, 'origin', NULL, '[]');
INSERT INTO public.utm_correlation_rules VALUES (1205, 'RFC-6587 Octet Counting Violations', 1, 3, 2, 'Command and Control', 'T1095 - Non-Application Layer Protocol', 'Detects violations of RFC-6587 octet counting format where the declared message length does not match the actual message size, indicating potential message injection, corruption attempts, or protocol manipulation attacks.

Next Steps:
1. Verify if the source IP is a legitimate syslog sender in your environment
2. Check for any recent changes to syslog configuration on the source system
3. Review the raw syslog messages for signs of injection or tampering
4. Examine network logs for unusual traffic patterns from the source IP
5. If unauthorized, block the source IP at the firewall level
6. Check if other systems are receiving similar malformed messages
7. Update syslog server configuration to enforce strict RFC-6587 compliance
8. Monitor for any data corruption or loss in affected log streams
', '["https://datatracker.ietf.org/doc/html/rfc6587","https://attack.mitre.org/techniques/T1095/"]', 'safe("log.transport", "") == "tcp" &&
safe("log.framing", "") == "octet-counting" &&
safe("log.declared_length", 0) > 0 &&
safe("log.actual_length", 0) > 0 &&
safe("log.declared_length", 0) != safe("log.actual_length", 0)
', '2025-09-04 16:08:51.209947', true, false, 'origin', '["adversary.ip","log.facility"]', '[{"indexPattern":"v11-log-syslog-*","with":[{"field":"origin.ip.keyword","operator":"filter_term","value":"{{.origin.ip}}"}],"or":null,"within":"now-15m","count":10}]');
INSERT INTO public.utm_correlation_rules VALUES (1408, 'Windows: Possible addition of new item to Windows startup registry', 2, 3, 1, 'Potentially Compromised System', 'Boot or Logon Autostart Execution: Registry Run Keys / Startup Folder', 'Adversaries may achieve persistence by adding a program to a startup folder or referencing it with a Registry run key.  Adding an entry to the run keys in the Registry or startup folder will cause the program referenced to be executed when a user logs in.  These programs will be executed under the context of the user and will have the account''s associated permissions level.', '["https://attack.mitre.org/techniques/T1547/001/"]', 'safe("log.message", "").matches("SOFTWARE\\\\Microsoft\\\\Windows\\\\CurrentVersion\\\\Run")', '2025-09-06 00:12:08.981364', true, false, 'origin', NULL, '[]');
INSERT INTO public.utm_correlation_rules VALUES (1406, 'Windows: PowerShell Suspicious Discovery Related Windows API Functions', 2, 1, 3, 'Discovery', 'Permission Groups Discovery', 'This rule detects the use of discovery-related Windows API functions in PowerShell Scripts. Attackers can use these functions to perform various situational awareness related activities, like enumerating users, shares, sessions, domain trusts, groups, etc.', '["https://attack.mitre.org/tactics/TA0007/","https://attack.mitre.org/techniques/T1069/"]', 'safe("log.message", "") in [''NetShareEnum'', ''NetWkstaUserEnum'', ''NetSessionEnum'', ''NetLocalGroupEnum'', ''NetLocalGroupGetMembers'', ''DsGetSiteName'', ''DsEnumerateDomainTrusts'', ''WTSEnumerateSessionsEx'', ''WTSQuerySessionInformation'', ''LsaGetLogonSessionData'', ''QueryServiceObjectSecurity'']', '2025-09-06 00:08:03.019653', true, false, 'origin', NULL, '[]');
INSERT INTO public.utm_correlation_rules VALUES (1207, 'TCP Resource Exhaustion Attack Detection', 1, 2, 3, 'Impact', 'T1499 - Endpoint Denial of Service: Resource Exhaustion', 'Detects patterns indicative of resource exhaustion attacks against TCP syslog collectors including connection flooding, slow loris attacks, and memory exhaustion through large message queues.

Next Steps:
1. Identify the source IP address conducting the resource exhaustion attack
2. Check if the source IP is legitimate or part of your infrastructure
3. Review connection logs and patterns from the identified source
4. Implement rate limiting or blocking rules for the malicious source
5. Monitor system resources (CPU, memory, connection pools) on the syslog collector
6. Consider implementing TCP connection limits and timeouts
7. Review syslog collector configuration for proper resource limits
8. Check for other targets being attacked by the same source IP
', '["https://datatracker.ietf.org/doc/html/rfc6587","https://attack.mitre.org/techniques/T1499/"]', '(safe("log.tcp_connection_rate", 0) > 100 &&
 safe("log.tcp_connection_duration", 0) < 1000) ||
safe("log.tcp_half_open_connections", 0) > 1000 ||
(safe("log.tcp_slow_send_rate", false) == true &&
 safe("log.tcp_bytes_per_second", 0) < 10 &&
 safe("log.tcp_connection_duration", 0) > 300000) ||
(safe("log.syslog_queue_size", 0) > 10000 &&
 safe("log.syslog_message_rate", 0) > 1000) ||
safe("log.tcp_zero_window_probes", 0) > 50
', '2025-09-04 16:08:52.291721', true, false, 'origin', '["adversary.ip","target.host"]', '[{"indexPattern":"v11-log-syslog-*","with":[{"field":"origin.ip.keyword","operator":"filter_term","value":"{{.origin.ip}}"}],"or":null,"within":"now-30m","count":100}]');
INSERT INTO public.utm_correlation_rules VALUES (1208, 'Suspicious TCP Retransmission Patterns', 2, 3, 3, 'Impact', 'T1499 - Endpoint Denial of Service', 'Detects abnormal TCP retransmission patterns that may indicate network manipulation, man-in-the-middle attacks, or attempts to exhaust resources through forced retransmissions. This rule monitors for excessive TCP retransmissions, fast retransmits with duplicate ACKs, and spurious retransmissions that could indicate network attacks or severe network issues.

Next Steps:
1. Investigate the source IP address for any known malicious activity or reputation issues
2. Check if the target system is experiencing performance degradation or service disruptions
3. Review network device logs between source and target for any routing or switching anomalies
4. Analyze packet captures to determine if retransmissions are legitimate or artificially induced
5. Check for other indicators of DoS/DDoS attacks from the same source
6. Verify if multiple targets are experiencing similar retransmission patterns from the same source
7. Consider temporarily blocking the source IP if malicious intent is confirmed
', '["https://datatracker.ietf.org/doc/html/rfc6587","https://attack.mitre.org/techniques/T1499/"]', '(safe("log.tcp_retransmission", false) == true &&
 safe("log.tcp_retransmission_count", 0) > 10) ||
(safe("log.tcp_fast_retransmit", false) == true &&
 safe("log.tcp_duplicate_ack_count", 0) > 3) ||
safe("log.tcp_spurious_retransmission", false) == true
', '2025-09-04 16:08:52.867633', true, false, 'origin', '["adversary.ip","target.ip"]', '[{"indexPattern":"v11-log-syslog-*","with":[{"field":"origin.ip.keyword","operator":"filter_term","value":"{{.origin.ip}}"},{"field":"target.ip.keyword","operator":"filter_term","value":"{{.target.ip}}"}],"or":null,"within":"now-5m","count":50}]');
INSERT INTO public.utm_correlation_rules VALUES (1209, 'RST Injection Attack', 1, 2, 3, 'Impact', 'T1498 - Network Denial of Service', 'Detects potential RST injection attacks where an attacker sends forged TCP RST packets to disrupt established connections between devices. This can cause denial of service by forcing connection terminations.

Next Steps:
1. Identify the source IP address sending the excessive RST packets
2. Check if the source IP is legitimate or potentially spoofed
3. Analyze network traffic patterns to determine if this is part of a larger attack
4. Review firewall logs for any blocked connection attempts from the same source
5. Consider implementing rate limiting or blocking the source IP if malicious
6. Monitor for any service disruptions or user complaints about dropped connections
7. Document the incident and update security controls as needed
', '["https://www.wallarm.com/what/what-is-syn-spoofing-or-tcp-reset-attack","https://attack.mitre.org/techniques/T1498/"]', 'safe("log.tcp_flags", "").contains("RST") &&
safe("log.rst_count", 0) > 50 &&
safe("log.time_window", 0) <= 60
', '2025-09-04 16:08:53.398038', true, false, 'origin', '["adversary.ip"]', '[{"indexPattern":"v11-log-syslog-*","with":[{"field":"origin.ip.keyword","operator":"filter_term","value":"{{.origin.ip}}"},{"field":"log.tcp_flags.keyword","operator":"filter_term","value":"RST"}],"or":null,"within":"now-5m","count":100}]');
INSERT INTO public.utm_correlation_rules VALUES (1210, 'TCP SACK Exploitation (SACK Panic)', 1, 1, 3, 'Impact', 'T1499.001 - Endpoint Denial of Service: OS Exhaustion Flood', 'Detects potential SACK Panic (CVE-2019-11477) exploitation attempts where attackers send crafted sequences of TCP SACK packets combined with low Maximum Segment Size (MSS) values to fragment the TCP retransmission queue, potentially causing CPU exhaustion and kernel panics.

Next Steps:
- Immediately investigate the source IP address for other malicious activity
- Check if the target system experienced any performance issues or crashes during the time of the alert
- Review kernel logs for panic messages or TCP stack errors using: dmesg | grep -i "tcp\|sack\|panic"
- Verify that TCP SACK is disabled or that kernel patches for CVE-2019-11477 are applied
- Check current TCP SACK status with: cat /proc/sys/net/ipv4/tcp_sack
- Consider blocking the source IP if the activity is confirmed malicious
- Apply firewall rules to drop TCP SYN packets with MSS values below 500 bytes
- Monitor network traffic for additional low-MSS TCP connections from the same source
- Review system performance metrics during the attack timeframe
- Document all affected systems and notify the security team for further analysis
- Consider implementing TCP SYN flood protection mechanisms
', '["https://access.redhat.com/security/vulnerabilities/tcpsack","https://nvd.nist.gov/vuln/detail/CVE-2019-11477","https://attack.mitre.org/techniques/T1499/001/"]', 'safe("log.message", "").contains("sack") &&
(safe("log.message", "").contains("mss") || safe("log.message", "").contains("MSS")) &&
(safe("log.message", "").contains("panic") || safe("log.message", "").contains("kernel") || safe("log.message", "").contains("tcp"))
', '2025-09-04 16:08:54.166715', true, false, 'origin', '["origin.ip","target.ip"]', '[]');
INSERT INTO public.utm_correlation_rules VALUES (1211, 'TCP Sequence Number Prediction Attack Detection', 3, 3, 2, 'Credential Access, Collection', 'T1557 - Adversary-in-the-Middle: TCP Session Hijacking', 'Detects attempts to predict TCP sequence numbers which could indicate session hijacking, blind TCP reset attacks, or data injection attempts through sequence number guessing. This rule identifies patterns where TCP sequence numbers are significantly out of order, unexpected, or associated with invalid RST packets.

Next Steps:
1. Investigate the source IP address for additional malicious activity
2. Check for other sessions from the same source that may be affected
3. Verify if the target system experienced any connection disruptions
4. Review network logs for signs of session hijacking or man-in-the-middle attacks
5. Consider blocking the source IP if confirmed malicious
6. Monitor for follow-up attacks from related IP addresses
', '["https://datatracker.ietf.org/doc/html/rfc793#section-3.3","https://attack.mitre.org/techniques/T1557/"]', '(safe("log.tcp_seq_gap", 0) > 0 &&
 safe("log.tcp_analysis_flags", "").matches("out.*of.*order|retransmission")) ||
(safe("log.tcp_seq_number", 0) > 0 &&
 safe("log.tcp_expected_seq", 0) > 0 &&
 abs(safe("log.tcp_seq_number", 0) - safe("log.tcp_expected_seq", 0)) > 1000000) ||
(safe("log.tcp_flags", "") == "RST" &&
 safe("log.tcp_seq_valid", true) == false)
', '2025-09-04 16:08:54.67177', true, false, 'origin', '["origin.ip","target.ip","target.port"]', '[{"indexPattern":"v11-log-syslog-*","with":[{"field":"origin.ip.keyword","operator":"filter_term","value":"{{.origin.ip}}"},{"field":"target.ip.keyword","operator":"filter_term","value":"{{.target.ip}}"},{"field":"target.port.keyword","operator":"filter_term","value":"{{.target.port}}"}],"or":null,"within":"now-5m","count":15}]');
INSERT INTO public.utm_correlation_rules VALUES (1212, 'TCP Stream Reassembly Attack Detection', 2, 3, 3, 'Impact', 'Stream Fragmentation Attack', 'Detects attacks targeting TCP stream reassembly mechanisms including overlapping segments, out-of-order fragments designed to evade IDS/IPS, and reassembly buffer exhaustion attempts.

Next Steps:
- Investigate the source IP address for other suspicious activities
- Check if the source IP is known malicious in threat intelligence feeds
- Review firewall/IDS logs for additional attack patterns from the same source
- Examine destination port to identify targeted service
- Consider blocking the source IP if attacks persist
- Analyze packet captures to understand the specific evasion technique being used
- Check system performance metrics for signs of resource exhaustion
', '["https://attack.mitre.org/techniques/T1499/002/","https://datatracker.ietf.org/doc/html/rfc6587","https://www.ciscopress.com/articles/article.asp?p=24685&seqNum=4"]', '(safe("log.tcp_overlap_conflict", false) == true &&
 safe("log.tcp_overlap_bytes", 0) > 100) ||
(safe("log.tcp_out_of_order_count", 0) > 20 &&
 safe("log.tcp_segment_size", 0) < 100) ||
(safe("log.tcp_reassembly_gap", false) == true &&
 safe("log.tcp_reassembly_gap_size", 0) > 1000) ||
(safe("log.tcp_fragment_overlap", false) == true &&
 safe("log.tcp_fragment_count", 0) > 50)
', '2025-09-04 16:08:55.254088', true, false, 'origin', '["origin.ip","target.ip","target.port"]', '[{"indexPattern":"v11-log-syslog-*","with":[{"field":"origin.ip.keyword","operator":"filter_term","value":"{{.origin.ip}}"},{"field":"target.port.keyword","operator":"filter_term","value":"{{.target.port}}"}],"or":null,"within":"now-15m","count":10}]');
INSERT INTO public.utm_correlation_rules VALUES (1213, 'SYN Flooding Attack Pattern', 1, 1, 3, 'Impact', 'Resource Exhaustion', 'Detects SYN flood attack patterns where an attacker sends high volumes of SYN packets to overwhelm the target server and exhaust resources by creating half-open connections. This rule monitors for suspicious patterns in syslog messages that indicate potential SYN flooding activity.

Next Steps:
- Investigate the source IP address (origin.ip) for reputation and geolocation
- Check if the source IP is spoofed or part of a botnet
- Review firewall logs for additional connection attempts from the same source
- Analyze network traffic patterns for the affected destination port
- Consider implementing rate limiting or SYN cookies on the affected service
- Block the source IP at the firewall level if confirmed malicious
- Monitor for similar attacks from different source IPs
- Document the incident and update security policies as needed
', '["https://www.cloudflare.com/learning/ddos/syn-flood-ddos-attack/","https://attack.mitre.org/techniques/T1499/"]', '(safe("log.message", "").contains("SYN") && safe("log.message", "").contains("flood")) ||
(safe("log.protocol", "") == "TCP" &&
 safe("log.action", "").contains("drop") &&
 safe("log.message", "").contains("rate limit"))
', '2025-09-04 16:08:55.779077', true, false, 'origin', '["origin.ip","target.port"]', '[{"indexPattern":"v11-log-syslog-*","with":[{"field":"origin.ip.keyword","operator":"filter_term","value":"{{.origin.ip}}"},{"field":"log.protocol.keyword","operator":"filter_term","value":"TCP"}],"or":null,"within":"now-1m","count":50}]');
INSERT INTO public.utm_correlation_rules VALUES (1214, 'RFC-6587 TCP Stream Corruption', 1, 3, 3, 'Impact', 'T1565.002 - Data Manipulation: Transmitted Data Manipulation', 'Detects TCP stream corruption in syslog transmission including out-of-order messages, partial frames, invalid UTF-8 sequences, or connection state inconsistencies that may indicate man-in-the-middle attacks or intentional disruption of syslog data integrity.

Next Steps:
1. Investigate the source and destination IP addresses involved in the corrupted stream
2. Check network infrastructure between source and destination for potential issues
3. Analyze network traffic patterns for signs of man-in-the-middle attacks
4. Verify syslog server and client configurations for proper TCP handling
5. Review firewall and network device logs for connection anomalies
6. Check for potential network attacks targeting syslog infrastructure
7. Validate data integrity of other concurrent syslog streams from the same source
8. Consider implementing additional network monitoring on the affected network segment
', '["https://datatracker.ietf.org/doc/html/rfc6587#section-4.3","https://attack.mitre.org/techniques/T1565/002/","https://capec.mitre.org/data/definitions/540.html"]', 'safe("log.transport", "") == "tcp" &&
(
  safe("log.tcp_corruption", false) == true ||
  safe("log.invalid_utf8", false) == true ||
  safe("log.partial_frame", false) == true ||
  safe("log.out_of_order", false) == true ||
  safe("log.connection_reset", false) == true ||
  (safe("log.sequence_gap", 0) > 0 && safe("log.sequence_gap", 0) > 100)
)
', '2025-09-04 16:09:14.888566', true, false, 'origin', '["adversary.ip","target.ip"]', '[{"indexPattern":"v11-log-syslog-*","with":[{"field":"origin.ip.keyword","operator":"filter_term","value":"{{.origin.ip}}"},{"field":"target.ip.keyword","operator":"filter_term","value":"{{.target.ip}}"}],"or":null,"within":"now-5m","count":3}]');
INSERT INTO public.utm_correlation_rules VALUES (1215, 'TCP Timestamp Manipulation Attack', 2, 3, 2, 'Credential Access, Collection', 'T1557 - Adversary-in-the-Middle: Session Hijacking', 'Detects TCP timestamp attacks where attackers manipulate timestamp values to bypass sequence number protections, potentially enabling session hijacking or replay attacks. Monitors for timestamp anomalies such as non-monotonic values, large jumps, zero timestamps with ACK flags, or echo timestamps greater than current timestamps.

Next Steps:
1. Analyze the TCP connection details and verify if the timestamp anomalies are legitimate
2. Check for other suspicious network activity from the same source IP
3. Review network logs for signs of session hijacking or man-in-the-middle attacks
4. Investigate if any sensitive data was accessed during the suspicious connection
5. Consider implementing additional network monitoring for the affected endpoints
', '["https://datatracker.ietf.org/doc/html/rfc7323#section-7","https://attack.mitre.org/techniques/T1557/"]', 'safe("log.tcp_options", "").contains("timestamp") &&
(
  safe("log.tcp_timestamp_delta", 0) < -1000 ||
  safe("log.tcp_timestamp_delta", 0) > 86400000 ||
  (safe("log.tcp_timestamp", 0.0) == double(0) && safe("log.tcp_flags", "").contains("ACK")) ||
  (safe("log.tcp_timestamp_echo", 0) > 0 && safe("log.tcp_timestamp", 0) > 0 && safe("log.tcp_timestamp_echo", 0) > safe("log.tcp_timestamp", 0))
)
', '2025-09-04 16:09:15.421012', true, false, 'origin', '["origin.ip","target.ip","target.port"]', '[{"indexPattern":"v11-log-syslog-*","with":[{"field":"origin.ip.keyword","operator":"filter_term","value":"{{.origin.ip}}"},{"field":"target.ip.keyword","operator":"filter_term","value":"{{.target.ip}}"}],"or":null,"within":"now-10m","count":5}]');
INSERT INTO public.utm_correlation_rules VALUES (1216, 'TCP Urgent Pointer Abuse', 3, 3, 2, 'Defense Evasion, Persistence, Command and Control', 'Protocol Exploitation', 'Detects abuse of the TCP urgent pointer mechanism which can be used for data exfiltration, covert channels, or to bypass security controls. Monitors for unusual urgent flag patterns and suspicious urgent pointer values. The URG flag is rarely used in modern networks, making its presence potentially suspicious.

Next Steps:
- Investigate the source IP address for any other suspicious activities or known malicious indicators
- Check if the destination IP is internal or external, and whether it''s a known command and control server
- Analyze the actual payload data to determine if malicious content is being transmitted via the urgent mechanism
- Review firewall and IDS logs for any attempts to bypass security controls around the same time
- Examine historical network traffic from the same source to establish baseline behavior
- Consider blocking the source IP if malicious activity is confirmed
- Update firewall rules to properly inspect and handle URG flags if not already configured
', '["https://datatracker.ietf.org/doc/html/rfc6587","https://attack.mitre.org/techniques/T1205/001/"]', 'safe("log.tcp_flags", "").contains("URG") && (safe("log.urgent_pointer", 0) > 65000 || safe("log.urgent_pointer", 0.0) == double(0) || safe("log.urgent_flag_frequency", 0) > 10) && safe("log.payload_size", 0) < 100', '2025-09-04 16:09:16.006799', true, false, 'origin', '["origin.ip","target.ip","log.urgent_pointer"]', '[]');
INSERT INTO public.utm_correlation_rules VALUES (1217, 'TCP Window Scaling Attack', 1, 2, 3, 'Impact', 'T1499 - Endpoint Denial of Service', 'Detects TCP window scaling attacks where attackers manipulate window size values to throttle or block data flow, causing denial of service. Monitors for discrepancies in window scale values and abnormal window sizes.

Next Steps:
1. Verify the source IP reputation using threat intelligence databases
2. Check if the affected service is experiencing performance degradation or timeouts
3. Review network traffic patterns from the source IP for other suspicious activities
4. Analyze packet captures to confirm window manipulation patterns
5. Consider implementing rate limiting or blocking the source IP if malicious activity is confirmed
6. Monitor for similar patterns from other sources that might indicate a coordinated attack
', '["https://www.linkedin.com/advice/0/how-can-tcp-traffic-analysis-help-identify-mitigate-iscyf","https://attack.mitre.org/techniques/T1499/"]', '(safe("log.tcp_window_scale", 0) > 14) ||
(safe("log.tcp_window_size", 0.0) == double(0) && safe("log.tcp_flags", "").contains("ACK")) ||
safe("log.tcp_window_size", 0) > 1073741824 ||
(safe("log.tcp_flags", "").contains("SYN") && safe("log.tcp_window_scale", 0) != safe("log.tcp_window_scale_reply", 0) && safe("log.tcp_window_scale", 0) > 0 && safe("log.tcp_window_scale_reply", 0) > 0)
', '2025-09-04 16:09:16.543051', true, false, 'origin', '["origin.ip","target.ip","target.port"]', '[{"indexPattern":"v11-log-syslog-*","with":[{"field":"origin.ip.keyword","operator":"filter_term","value":"{{.origin.ip}}"},{"field":"target.port.keyword","operator":"filter_term","value":"{{.target.port}}"}],"or":null,"within":"now-5m","count":10}]');
INSERT INTO public.utm_correlation_rules VALUES (1322, 'Windows Defender Exclusions Added via PowerShell', 2, 2, 3, 'Defense Evasion', 'Impair Defenses', 'Identifies modifications to the Windows Defender configuration settings using PowerShell to add exclusions at the folder directory or process level.', '["https://attack.mitre.org/tactics/TA0005/","https://attack.mitre.org/techniques/T1562/"]', 'safe("log.message", "").matches(''(-Exclusion(.+)(Add-MpPreference|Set-MpPreference)|(Add-MpPreference|Set-MpPreference)(.+)-Exclusion)'') && safe("log.winlogEventDataProcessName", "").matches(''(powershell.exe|pwsh.exe|powershell_ise.exe)'')', '2025-09-04 20:23:15.412067', true, false, 'origin', NULL, '[]');
INSERT INTO public.utm_correlation_rules VALUES (1323, 'Windows: Delete Volume USN Journal with Fsutil', 1, 2, 3, 'Defense Evasion', 'File Deletion', 'Identifies use of the fsutil.exe to delete the volume USNJRNL. This technique is used by attackers to eliminate evidence of files created during post-exploitation activities.', '["https://attack.mitre.org/tactics/TA0005/","https://attack.mitre.org/techniques/T1070/004/"]', 'safe("log.message", "").matches(''(deletejournal(.+)usn|usn(.+)deletejournal)'') && safe("log.winlogEventDataProcessName", "").matches(''fsutil.exe'')', '2025-09-04 20:23:15.831409', true, false, 'origin', NULL, '[]');
INSERT INTO public.utm_correlation_rules VALUES (1218, 'TCP Window Size Attack Detection', 1, 3, 3, 'Impact', 'T1498.001 - Network Denial of Service: Direct Network Flood', 'Detects TCP window size manipulation attacks including zero window probes, window scaling attacks, and Silly Window Syndrome that can lead to performance degradation or denial of service. These attacks exploit TCP flow control mechanisms to disrupt normal network communication.

Next Steps:
1. Investigate the source IP for additional suspicious network activity
2. Check target services for performance degradation or service disruption
3. Analyze packet captures to confirm attack patterns and methodology
4. Review firewall logs for blocking recommendations
5. Consider rate limiting or blocking the source IP if confirmed malicious
6. Document the attack vector and update network security policies
', '["https://datatracker.ietf.org/doc/html/rfc793#section-3.2","https://attack.mitre.org/techniques/T1498/001/"]', '(safe("log.tcp_window_size", -1) == 0 &&
 !safe("log.tcp_flags", "").matches("SYN|FIN|RST")) ||
safe("log.tcp_window_scale", 0) > 14 ||
(safe("log.tcp_window_size", 0) > 0 && safe("log.tcp_window_size", 0) < 100 &&
 safe("log.tcp_segment_len", 0) > 0)
', '2025-09-04 16:09:17.087098', true, false, 'origin', '["origin.ip","target.port"]', '[{"indexPattern":"v11-log-syslog-*","with":[{"field":"origin.ip.keyword","operator":"filter_term","value":"{{.origin.ip}}"},{"field":"target.port.keyword","operator":"filter_term","value":"{{.target.port}}"}],"or":null,"within":"now-15m","count":20}]');
INSERT INTO public.utm_correlation_rules VALUES (1221, 'Certificate Validation Failure Detection', 2, 3, 1, 'Defense Evasion', 'T1553.004 - Subvert Trust Controls: Install Root Certificate', 'Detects certificate validation failures, expired certificates, or certificate tampering attempts that could indicate man-in-the-middle attacks or authentication bypass attempts on VMware ESXi hosts.

Next Steps:
1. Verify the certificate chain and validity on the affected ESXi host
2. Check for any recent certificate changes or updates
3. Investigate potential man-in-the-middle attacks or network interference
4. Review ESXi host time synchronization and certificate expiration dates
5. Check for unauthorized certificate modifications or installations
6. Monitor for additional certificate-related errors from the same host
', '["https://docs.vmware.com/en/VMware-vSphere/8.0/vsphere-security/GUID-F35D7005-58EB-48AC-99D5-B9942EB2A8EF.html","https://attack.mitre.org/techniques/T1553/004/"]', 'safe("log.message", "") != "" &&
(log.message.lower().contains("certificate") ||
 log.message.lower().contains("ssl") ||
 log.message.lower().contains("tls") ||
 log.message.lower().contains("rui.crt")) &&
(log.message.lower().contains("failed") ||
 log.message.lower().contains("invalid") ||
 log.message.lower().contains("expired") ||
 log.message.lower().contains("mismatch") ||
 log.message.lower().contains("untrusted") ||
 log.message.lower().contains("error") ||
 log.message.lower().contains("validation") ||
 log.message.lower().contains("verify"))
', '2025-09-04 18:59:21.429815', true, false, 'origin', '["origin.hostname"]', '[]');
INSERT INTO public.utm_correlation_rules VALUES (1222, 'CPU/Memory Reservation Abuse Detection', 1, 3, 3, 'Impact', 'System Resource Modifications', 'Detects unauthorized or excessive CPU/memory reservation modifications that could lead to resource starvation for other VMs or indicate privilege abuse. This rule identifies suspicious resource allocation changes that may be part of a denial of service attack or unauthorized privilege escalation.

Next Steps:
1. Verify the legitimacy of the resource allocation changes
2. Check if the changes were authorized by system administrators
3. Review the affected VM''s resource usage patterns
4. Investigate any concurrent privilege escalation attempts
5. Examine system logs for other suspicious administrative activities
6. Validate current resource reservations against organizational policies
', '["https://docs.vmware.com/en/VMware-vSphere/8.0/vsphere-resource-management/GUID-98BD5A8A-260A-494F-BAAE-74781F5C4B87.html","https://attack.mitre.org/techniques/T1489/"]', 'safe("log.process", "") == "hostd" &&
safe("log.message", "") != "" &&
(safe("log.message", "").contains("reservation") || safe("log.message", "").contains("resource allocation")) &&
(safe("log.message", "").contains("changed") || safe("log.message", "").contains("modified") || safe("log.message", "").contains("exceeded") || safe("log.message", "").contains("limit"))
', '2025-09-04 18:59:22.472436', true, false, 'origin', '["origin.hostname","log.eventInfo"]', '[{"indexPattern":"v11-log-vmware-esxi-*","with":[{"field":"origin.hostname.keyword","operator":"filter_term","value":"{{.origin.hostname}}"},{"field":"log.message","operator":"filter_match","value":"reservation"}],"or":null,"within":"now-30m","count":3}]');
INSERT INTO public.utm_correlation_rules VALUES (1223, 'Distributed Switch Security Policy Modification', 2, 3, 2, 'Defense Evasion', 'T1599 - Network Boundary Bridging', 'Detects unauthorized changes to distributed switch security policies including promiscuous mode, MAC address changes, or forged transmits settings which could indicate attempts to bypass network security controls.

Next Steps:
1. Verify the legitimacy of the security policy change with the VMware administrator
2. Check the user account that made the change and validate it has appropriate permissions
3. Review vCenter audit logs for other suspicious administrative activities
4. Examine network traffic patterns for signs of lateral movement or data exfiltration
5. Verify that the change aligns with documented change management procedures
6. Consider reverting the security policy change if unauthorized
7. Monitor for any abnormal network behavior on affected VLANs
', '["https://docs.vmware.com/en/VMware-vSphere/7.0/com.vmware.vsphere.security.doc/GUID-E9A41435-4081-47D9-9B34-48CABE7BF60C.html","https://attack.mitre.org/techniques/T1599/"]', '(
  (safe("log.message", "").matches("(?i)promiscuous.*mode.*change") ||
   safe("log.message", "").matches("(?i)promiscuous.*accept") ||
   safe("log.message", "").matches("(?i)forged.*transmit.*change") ||
   safe("log.message", "").matches("(?i)forged.*transmit.*accept") ||
   safe("log.message", "").matches("(?i)mac.*address.*change.*policy") ||
   safe("log.message", "").matches("(?i)security.*policy.*modified") ||
   safe("log.message", "").matches("(?i)vds.*security.*setting")) &&
  (safe("log.process", "").matches("(?i)hostd") ||
   safe("log.process", "").matches("(?i)vpxd") ||
   safe("log.process", "").matches("(?i)vmkernel"))
)
', '2025-09-04 18:59:23.051221', true, false, 'origin', '["origin.hostname"]', '[]');
INSERT INTO public.utm_correlation_rules VALUES (1464, 'Windows Defender: ERROR: BAD DATABASE', 1, 2, 3, 'Potentially Compromised System', 'User Execution', 'Detects the ''BAD DATABASE'' error event in Windows Defender, which may indicate a database corruption or issue.', '["https://learn.microsoft.com/en-us/windows/security/threat-protection/windows-defender-antivirus/troubleshoot"]', 'safe("log.winlogEventDataLogName", "") == "Microsoft-Windows-Windows Defender/Operational" &&  safe("log.winlogEventDataErrorCode", "") == "0x80508002"', '2025-09-04 21:11:28.440796', true, false, 'target', NULL, '[]');
INSERT INTO public.utm_correlation_rules VALUES (117, 'AWS CloudWatch Log Stream Deletion', 3, 2, 2, 'Data Destruction', 'Defense Evasion', 'Identifies the deletion of an AWS CloudWatch log stream, which permanently deletes all associated archived log events with the stream', '["https://attack.mitre.org/tactics/TA0040/","https://attack.mitre.org/techniques/T1485/","https://attack.mitre.org/tactics/TA0005/","https://attack.mitre.org/techniques/T1562/","https://awscli.amazonaws.com/v2/documentation/api/latest/reference/logs/delete-log-stream.html","https://docs.aws.amazon.com/AmazonCloudWatchLogs/latest/APIReference/API_DeleteLogStream.html"]', 'safe("log.eventSource", "") == "logs.amazonaws.com" && safe("log.eventName", "") == "DeleteLogStream"', '2025-09-03 12:27:55.374304', true, false, 'origin', NULL, '[]');
INSERT INTO public.utm_correlation_rules VALUES (1224, 'DRS (Distributed Resource Scheduler) Manipulation Detection', 2, 3, 3, 'Defense Evasion', 'T1562.001 - Impair Defenses: Disable or Modify Tools', 'Detects unauthorized or suspicious manipulation of DRS (Distributed Resource Scheduler) settings, abnormal resource allocation changes, or attempts to bypass DRS policies that could lead to resource exhaustion or performance degradation. This includes disabling DRS, overriding DRS recommendations, modifying resource pools, or violating affinity/anti-affinity rules.

Next Steps:
1. Review the specific DRS configuration changes made and identify the user/administrator responsible
2. Verify if the changes were authorized through proper change management processes
3. Check for any performance impacts on the virtualization infrastructure
4. Examine recent vCenter Server access logs for suspicious administrative activity
5. Validate current DRS cluster configuration against baseline settings
6. Review resource pool allocations and VM placement for abnormalities
7. Check for any related security events or privilege escalation attempts
8. If unauthorized, restore DRS settings from backup and investigate potential compromise
', '["https://docs.vmware.com/en/VMware-vSphere/7.0/com.vmware.vsphere.resmgmt.doc/GUID-8ACF3502-5314-469F-8CC9-4A9BD5925BC2.html","https://docs.vmware.com/en/VMware-vSphere/7.0/com.vmware.vsphere.monitoring.doc/GUID-9272E3B2-6A7F-427B-994C-B15FF8CADC25.html","https://attack.mitre.org/techniques/T1562/001/"]', '(safe("log.message", "").matches("(?i)DRS") && safe("log.message", "").matches("(?i)(disable|override|bypass|manipulat|tamper)")) ||
(safe("log.message", "").matches("(?i)(resource.*pool|cluster)") && safe("log.message", "").matches("(?i)(modify|change|alter)") && safe("log.message", "").matches("(?i)(unauthorized|denied|failed)")) ||
(safe("log.message", "").matches("(?i)distributed.*resource.*scheduler") && safe("log.message", "").matches("(?i)(error|violation|conflict|anomaly)")) ||
(safe("log.eventInfo", "").matches("(?i)(ClusterReconfigured|DrsVmPoweredOn)") && safe("log.message", "").matches("(?i)(unauthorized|suspicious|abnormal)")) ||
(safe("log.message", "").matches("(?i)(affinity|anti-affinity)") && safe("log.message", "").matches("(?i)(rule|policy)") && safe("log.message", "").matches("(?i)(violat|breach|bypass)"))
', '2025-09-04 18:59:23.564172', true, false, 'origin', '["origin.hostname"]', '[]');
INSERT INTO public.utm_correlation_rules VALUES (1225, 'ESXi Host Compromise Indicators', 3, 3, 3, 'Execution', 'T1059 - Command and Scripting Interpreter', 'Detects indicators of ESXi host compromise including ransomware preparation activities, suspicious file operations on virtual machines, logging tampering, and abnormal system changes. Monitors for encryption tools, VM power operations, and file system modifications.

Next Steps:
1. Immediately isolate the affected ESXi host from the network to prevent lateral movement
2. Review all virtual machines on the host for signs of encryption or corruption
3. Check VM snapshots and backups to determine if they have been deleted or tampered with
4. Examine ESXi logs for unauthorized administrative access or configuration changes
5. Verify the integrity of the ESXi management interface and SSH access logs
6. Review network traffic from the ESXi host for unusual outbound connections
7. Check for presence of ransomware files or encryption tools on the host filesystem
8. Validate ESXi user accounts and permissions for unauthorized modifications
9. Assess the impact on running VMs and determine if immediate shutdown is necessary
10. Contact incident response team and consider engaging VMware support for forensic analysis
', '["https://www.forescout.com/blog/vmware-esxi-servers-a-major-attack-vector-for-ransomware/","https://cloud.google.com/blog/topics/threat-intelligence/vmware-esxi-zero-day-bypass","https://attack.mitre.org/techniques/T1059/"]', 'safe("log.message", "").contains("encrypt.sh") ||
safe("log.message", "").contains("encrypt") ||
safe("log.message", "").contains(".vmdk") ||
safe("log.message", "").contains(".vswp") ||
safe("log.message", "").contains("esxcli vm process list") ||
safe("log.message", "").contains("esxcli vm process kill") ||
safe("log.message", "").contains("Device I/O error") ||
safe("log.message", "").contains("Medium Error Detected") ||
safe("log.message", "").contains("Uncorrectable error in data") ||
safe("log.message", "").contains("Disk error detected") ||
safe("log.message", "").contains("Unable to read partition table") ||
safe("log.message", "").contains("logging service disabled") ||
safe("log.message", "").contains("log events removed") ||
(safe("log.process", "") == "vmkernel" && safe("log.message", "").contains("SCSI sense")) ||
(safe("log.eventInfo", "").contains("ransom") || safe("log.eventInfo", "").contains("encrypt")) &&
safe("origin.hostname", "") != ""
', '2025-09-04 18:59:24.642361', true, false, 'origin', '["origin.hostname"]', '[]');
INSERT INTO public.utm_correlation_rules VALUES (3, 'Bootkit/UEFI Threat Detection', 3, 3, 3, 'Defense Evasion, Persistence', 'T1542.001 - Boot or Logon Autostart Execution: System Firmware', 'Detects bootkit or UEFI-level threats that attempt to persist at the firmware level and compromise the boot process. These threats can survive system reinstalls and bypass traditional security measures by infecting the system firmware.

Next Steps:
- Isolate the affected system immediately to prevent spread
- Review system boot logs and firmware settings for modifications
- Check for other malware detections on the same host in the past 24-48 hours
- Verify system integrity using offline scanning tools
- Consider reimaging the system and updating firmware/UEFI
- Enable Secure Boot if not already enabled
- Review user activity and recently installed software on the affected system
- Document the infection for incident response reporting
- Check if other systems with similar hardware/firmware versions are affected
', '["https://attack.mitre.org/techniques/T1542/001/","https://www.bitdefender.com/business/support/en/77209-135324-event-types.html"]', 'safe("log.eventType", "") == "av" && safe("log.severity", 0) >= 8 && ( (safe("log.requested", "").contains("boot") || safe("log.requested", "").contains("uefi") || safe("log.requested", "").contains("rootkit") || safe("log.requested", "").contains("firmware")) || (safe("log.restData", "").contains("boot") || safe("log.restData", "").contains("uefi") || safe("log.restData", "").contains("rootkit") || safe("log.restData", "").contains("firmware") || safe("log.restData", "").contains("\\EFI\\") || safe("log.restData", "").contains("/EFI/") || safe("log.restData", "").contains("\\boot\\") || safe("log.restData", "").contains("/boot/")) )', '2025-09-03 11:53:37.97551', true, false, 'origin', '["log.hostId"]', '[]');
INSERT INTO public.utm_correlation_rules VALUES (1226, 'Guest Introspection Bypass Attempt', 3, 3, 2, 'Defense Evasion', 'T1211 - Exploitation for Defense Evasion', 'Detects potential exploitation of CVE-2023-20867 or similar guest introspection bypass vulnerabilities by monitoring for anomalous vpxuser authentication attempts and Guest Operations without proper authentication.

Next Steps:
1. Immediately verify the integrity of the affected ESXi host
2. Check for unauthorized VIB installations or modifications
3. Review guest VM operations and authentication logs
4. Inspect network connections from the affected host for lateral movement
5. Verify all ESXi patches are current, especially for CVE-2023-20867
6. Consider isolating the host until investigation is complete
7. Review vCenter logs for related administrative actions
8. Check for persistence mechanisms or backdoors installed
', '["https://attack.mitre.org/techniques/T1211/","https://cloud.google.com/blog/topics/threat-intelligence/vmware-esxi-zero-day-bypass","https://www.vmware.com/security/advisories/VMSA-2023-0013.html"]', '(safe("log.message", "").contains("vpxuser") && safe("log.message", "").contains("failed")) ||
(safe("log.message", "").contains("GuestOps") && !safe("log.message", "").contains("authentication")) ||
(safe("log.message", "").contains("Guest Introspection") && safe("severity", "") == "error") ||
(safe("log.message", "").contains("esxupdate") && safe("log.message", "").contains("VIB installation")) ||
(safe("log.process", "").contains("mux") && safe("log.message", "").contains("bypass"))
', '2025-09-04 18:59:25.76678', true, false, 'origin', '["origin.hostname"]', '[{"indexPattern":"v11-log-vmware-esxi-*","with":[{"field":"origin.hostname.keyword","operator":"filter_term","value":"{{.origin.hostname}}"},{"field":"log.message","operator":"filter_match","value":"GuestOps"}],"or":null,"within":"now-30m","count":3}]');
INSERT INTO public.utm_correlation_rules VALUES (1227, 'VMware ESXi HA Failover Anomalies', 1, 2, 3, 'Impact', 'T1489 - Service Stop', 'Detects anomalous High Availability failover events in VMware ESXi clusters that may indicate system instability, misconfiguration, or potential attacks targeting cluster availability. Monitors for rapid state transitions and unexpected failover patterns.

Next Steps:
1. Review the vCenter Server logs to correlate failover events with cluster health status
2. Check ESXi host hardware health and network connectivity issues
3. Examine cluster resource utilization and admission control policies
4. Verify HA configuration and heartbeat datastore accessibility
5. Investigate any recent infrastructure changes or maintenance activities
6. Monitor for patterns of repeated failovers that may indicate targeted attacks on cluster availability
', '["https://kb.vmware.com/s/article/2036544","https://kb.vmware.com/s/article/2036555","https://attack.mitre.org/techniques/T1489/"]', '(safe("log.message", "").contains("FDM state") ||
 safe("log.message", "").contains("host changed state: Dead") ||
 safe("log.message", "").contains("failover start event") ||
 safe("log.message", "").contains("VmRestartedByHAEvent") ||
 safe("log.message", "").contains("detected a possible host failure") ||
 safe("log.message", "").contains("VMware Tools heartbeat failure")) &&
safe("origin.hostname", "") != ""
', '2025-09-04 18:59:26.403133', true, false, 'origin', '["origin.hostname"]', '[]');
INSERT INTO public.utm_correlation_rules VALUES (115, 'AWS CloudTrail Log Updated', 3, 2, 2, 'Data Manipulation', 'Impact', 'Identifies an update to an AWS log trail setting that specifies the delivery of log files', '["https://attack.mitre.org/tactics/TA0040/","https://attack.mitre.org/techniques/T1565/","https://attack.mitre.org/tactics/TA0009/","https://attack.mitre.org/techniques/T1530/","https://docs.aws.amazon.com/awscloudtrail/latest/APIReference/API_UpdateTrail.html","https://awscli.amazonaws.com/v2/documentation/api/latest/reference/cloudtrail/update-trail.html"]', 'safe("log.eventSource", "") == "cloudtrail.amazonaws.com" && safe("log.eventName", "") == "UpdateTrail"', '2025-09-03 12:27:17.892384', true, false, 'origin', NULL, '[]');
INSERT INTO public.utm_correlation_rules VALUES (1, 'Antivirus Service Stopped or Disabled', 2, 3, 3, 'Defense Evasion', 'T1562.001 - Impair Defenses: Disable or Modify Tools', 'Detects when the Bitdefender antivirus service or critical security modules are stopped, disabled, or experiencing failures. This is a critical security event that could indicate malicious tampering or system issues.

Next Steps:
- Verify if the service was intentionally stopped by authorized personnel
- Check system logs for any errors or crashes that may have caused the service to stop
- Look for signs of malware or unauthorized access attempts around the time of the event
- Review recent system changes or updates that might have affected the antivirus service
- If tampering is suspected, isolate the affected system and perform a forensic analysis
- Restart the Bitdefender service and ensure all modules are functioning properly
- Monitor for recurring issues that might indicate persistent threats
', '["https://www.bitdefender.com/business/support/en/77212-237089-event-types.html","https://attack.mitre.org/techniques/T1562/001/"]', '(safe("log.eventType", "") == "modules" || safe("log.eventType", "") == "Product ModulesStatus" || safe("log.eventType", "") == "registration") && (safe("log.severity", "") in ["high", "5"] || safe("log.product", "").contains("disabled") || safe("log.product", "").contains("stopped") || safe("log.eventType", "").contains("module") && safe("log.product", "").contains("stopped") || safe("log.eventType", "").contains("module") && safe("log.product", "").contains("disabled") || safe("log.eventType", "").contains("av") && safe("log.product", "").contains("failure"))', '2025-09-03 11:53:35.777353', true, false, 'origin', '["log.hostId","log.eventType"]', '[]');
INSERT INTO public.utm_correlation_rules VALUES (2, 'Advanced Persistent Threat (APT) Detection', 3, 3, 2, 'Command and Control', 'TA0011 - Application Layer Protocol', 'Detects indicators of Advanced Persistent Threats including targeted attacks, sophisticated malware, and persistent threats detected by Bitdefender GravityZone''s HyperDetect module.

Next Steps:
- Investigate the affected endpoint to determine the scope of compromise
- Review process execution history and network connections from the affected system
- Check for lateral movement by examining authentication logs from the same source IP
- Isolate the affected system if active threat is confirmed
- Collect forensic artifacts including memory dumps and event logs
- Search for similar malware indicators across the environment
- Review user account activities for signs of credential compromise
- Contact security operations center if threat actors match known APT groups
', '["https://www.bitdefender.com/business/support/en/77212-237089-event-types.html","https://attack.mitre.org/tactics/TA0011/"]', 'safe("log.product", "") == "Bitdefender GravityZone" && safe("log.severity", 0) >= 8 && ( safe("log.eventType", "").lower().contains("apt") || safe("log.eventType", "").lower().contains("targeted") || safe("log.eventType", "").lower().contains("advanced") || safe("log.eventType", "").lower().contains("persistent") || safe("log.eventType", "").lower().contains("hyperdetect") || safe("log.eventType", "").lower().contains("targeted attack") || safe("log.eventType", "").lower().contains("advanced persistent") || safe("log.eventType", "").lower().contains("lazarus") || safe("log.eventType", "").lower().contains("equation") || safe("log.eventType", "").lower().contains("sofacy") || safe("log.eventType", "").lower().contains("cozy bear") || safe("log.eventType", "").lower().contains("fancy bear") || safe("log.eventType", "").lower().contains("panda") || safe("log.eventType", "").lower().contains("kitten") || safe("log.eventType", "").lower().contains("carbanak") || safe("log.eventType", "").lower().contains("fin7") || safe("log.eventType", "").lower().contains("fileless") || safe("log.signatureID", "") == "hyperdetect" ) && safe("log.hostId", "") != ""', '2025-09-03 11:53:37.399616', true, false, 'origin', '["log.hostId","log.eventType"]', '[]');
INSERT INTO public.utm_correlation_rules VALUES (1228, 'VMware ESXi Hypervisor Escape Attempt Detection', 3, 3, 3, 'Privilege Escalation', 'T1611 - Escape to Host', 'Detects potential hypervisor escape attempts through suspicious VMX process activity, abnormal privilege escalation, or unauthorized access to host resources from guest VMs. This rule identifies various indicators of compromise including CVE-2024-37085 exploitation, VMCI backdoor attempts, and unauthorized vpxuser activities.

Next Steps:
1. Immediately isolate the affected ESXi host from the network to prevent lateral movement
2. Review VMX process logs and system calls for evidence of escape attempts
3. Check for unauthorized changes to virtual machine configurations
4. Examine guest VM activities and processes for signs of compromise
5. Verify integrity of hypervisor files and configurations
6. Review security patches and ensure latest ESXi updates are applied
7. Analyze network traffic for data exfiltration or command and control communications
8. Consider forensic imaging of affected virtual machines before remediation
', '["https://attack.mitre.org/techniques/T1611/","https://www.usenix.org/system/files/woot19-paper_zhao.pdf","https://docs.vmware.com/en/VMware-vSphere/8.0/vsphere-security/GUID-F35D7005-58EB-48AC-99D5-B9942EB2A8EF.html"]', '(safe("log.message", "").matches("(?i)(vmx|vmware-vmx)") && safe("log.message", "").matches("(?i)(escape|breakout|privilege|escalat|host access|unauthorized)")) ||
(safe("log.process", "").matches("(?i)vmx") && safe("severity", "") == "error") ||
(safe("log.message", "").matches("(?i)vpxuser") && safe("log.message", "").matches("(?i)(failed|denied|unauthorized)")) ||
(safe("log.message", "").matches("(?i)CVE-2024-37085")) ||
(safe("log.message", "").matches("(?i)VMCI") && safe("log.message", "").matches("(?i)(backdoor|socket|unauthorized)"))
', '2025-09-04 18:59:27.618562', true, false, 'origin', '["origin.hostname"]', '[]');
INSERT INTO public.utm_correlation_rules VALUES (1229, 'iSCSI/NFS Storage Attack Detection', 2, 3, 3, 'Impact', 'T1485 - Data Destruction', 'Detects attacks against iSCSI or NFS storage including authentication failures, SCSI reservation conflicts, unauthorized mount attempts, or suspicious storage network traffic patterns. These attacks can lead to data destruction, service disruption, or unauthorized access to storage resources.

Next Steps:
1. Examine the specific storage error message and affected datastore/LUN
2. Review storage authentication and authorization logs for the affected ESXi host
3. Check network connectivity and configuration for storage networks
4. Verify storage array logs for corresponding errors or unauthorized access attempts
5. Review ESXi host configuration for storage adapter and path status
6. If authentication failures detected, investigate for potential credential compromise
7. Monitor for additional storage-related alerts from the same host or storage array
', '["https://docs.vmware.com/en/VMware-vSphere/8.0/vsphere-security/GUID-F35D7005-58EB-48AC-99D5-B9942EB2A8EF.html","https://attack.mitre.org/techniques/T1485/"]', '(
  (safe("log.message", "").matches("(?i)scsi.*reservation.*conflict") ||
   safe("log.message", "").matches("(?i)iscsi.*auth.*fail") ||
   safe("log.message", "").matches("(?i)iscsi.*login.*reject") ||
   safe("log.message", "").matches("(?i)iscsi.*session.*drop") ||
   safe("log.message", "").matches("(?i)nfs.*mount.*denied") ||
   safe("log.message", "").matches("(?i)nfs.*permission.*denied") ||
   safe("log.message", "").matches("(?i)storage.*path.*fail") ||
   safe("log.message", "").matches("(?i)datastore.*not.*accessible") ||
   safe("log.message", "").matches("(?i)lun.*not.*found") ||
   safe("log.message", "").matches("(?i)storage.*adapter.*error") ||
   safe("log.message", "").matches("(?i)failed.*to.*send.*packet.*dropped")) &&
  safe("log.process", "") == "vmkernel"
) ||
(safe("log.eventInfo", "").matches("(?i)storage.*security.*alert"))
', '2025-09-04 18:59:28.197666', true, false, 'origin', '["origin.hostname","category"]', '[]');
INSERT INTO public.utm_correlation_rules VALUES (1230, 'License Compliance Violation Detection', 1, 3, 3, 'License Violation', 'License Violation', 'Detects license compliance violations, expired licenses, or attempts to bypass licensing restrictions which could indicate unauthorized system usage or tampering. License violations can lead to service interruptions and compliance issues.

Next Steps:
- Check the host license status in vCenter Server or via ESXi CLI using ''vim-cmd vimsvc/license --show''
- Verify if evaluation period has expired (60 days from installation)
- Review vpxd logs at /var/log/vmware/vpxd/ for detailed licensing events
- Check hostd logs at /var/log/hostd.log for license-related messages
- Verify if features being used exceed current license level or entitlements
- Monitor for VMs that cannot be powered on due to license restrictions
- Check for unauthorized attempts to modify license configuration files
- Review license assignment in vCenter Server License Manager
- Validate license server connectivity if using network licensing
- Document any license violations for compliance reporting
', '["https://docs.vmware.com/en/VMware-vSphere/8.0/vsphere-vcenter-server-installation/GUID-8C9D2587-E9FC-4276-B4BC-48F620A3048B.html","https://docs.vmware.com/en/VMware-vSphere/6.5/com.vmware.vsphere.troubleshooting.doc/GUID-252F28AD-AD5E-4559-BD98-3EA7B9360782.html","https://core.vmware.com/esxi-log-message-formats"]', 'safe("log.message", "") != "" &&
(safe("log.message", "").lower().contains("license") || safe("log.message", "").lower().contains("evaluation")) &&
(safe("log.message", "").lower().contains("expired") ||
 safe("log.message", "").lower().contains("invalid") ||
 safe("log.message", "").lower().contains("violation") ||
 safe("log.message", "").lower().contains("exceeded") ||
 safe("log.message", "").lower().contains("compliance") ||
 safe("log.message", "").lower().contains("unauthorized") ||
 safe("log.message", "").lower().contains("insufficient") ||
 safe("log.message", "").lower().contains("failed") ||
 safe("log.message", "").lower().contains("cannot") ||
 safe("log.message", "").lower().contains("evaluation mode") ||
 safe("log.message", "").lower().contains("disconnect") ||
 safe("log.message", "").lower().contains("restrict"))
', '2025-09-04 18:59:29.131817', true, false, 'origin', '["origin.hostname"]', '[]');
INSERT INTO public.utm_correlation_rules VALUES (1325, 'Windows: PowerShell Keylogging Script', 3, 2, 2, 'Collection', 'Keylogging', 'Detects the use of Win32 API Functions that can be used to capture user keystrokes in PowerShell scripts. Attackers use this technique to capture user input, looking for credentials and/or other valuable data.', '["https://attack.mitre.org/tactics/TA0009/","https://attack.mitre.org/techniques/T1056/","https://attack.mitre.org/techniques/T1056/001/"]', 'safe("log.message", "").matches(''(GetAsyncKeyState|NtUserGetAsyncKeyState|GetKeyboardState|Get-Keystrokes|SetWindowsHookA|SetWindowsHookW|SetWindowsHookEx|SetWindowsHookExA|NtUserSetWindowsHookEx|GetForegroundWindow|GetWindowTextA|GetWindowTextW|WM_KEYBOARD_LL)'') && safe("log.winlogEventDataProcessName", "").matches(''(wbadmin.exe|WBADMIN.EXE)'')', '2025-09-04 20:23:16.439161', true, false, 'origin', NULL, '[]');
INSERT INTO public.utm_correlation_rules VALUES (1326, 'Windows: Kerberos Pre-authentication Disabled for User', 2, 2, 3, 'Credential Access', 'AS-REP Roasting', 'Identifies the modification of an accounts Kerberos pre-authentication options. An adversary with GenericWrite/GenericAll rights over the account can maliciously modify these settings to perform offline password cracking attacks such as AS-REP roasting', '["https://attack.mitre.org/tactics/TA0006/","https://attack.mitre.org/techniques/T1558/","https://attack.mitre.org/techniques/T1558/004/"]', 'safe("log.message", "").matches("(('')?[Dd]on('')?t [Rr]equire [Pp]reauth('')?(\\s)?(-)?(\\s)?[Ee]nabled)") && safe("log.eventCode", 0.0) == double(4738)', '2025-09-04 20:23:16.951249', true, false, 'origin', NULL, '[]');
INSERT INTO public.utm_correlation_rules VALUES (1327, 'Windows: Disable Windows Firewall Rules via Netsh', 2, 2, 3, 'Defense Evasion', 'Disable or Modify System Firewall', 'Identifies the modification of an accounts Kerberos pre-authentication options. An adversary with GenericWrite/GenericAll rights over the account can maliciously modify these settings to perform offline password cracking attacks such as AS-REP roasting', '["https://attack.mitre.org/tactics/TA0005/","https://attack.mitre.org/techniques/T1562/004/"]', 'safe("log.message", "").matches(''(disable(.+)firewall(.+)set|disable(.+)set(.+)firewall|firewall(.+)disable(.+)set|firewall(.+)set(.+)disable|set(.+)disable(.+)firewall|set(.+)firewall(.+)disable|state(.+)advfirewall(.+)off|state(.+)off(.+)advfirewall|advfirewall(.+)state(.+)off|advfirewall(.+)off(.+)state|off(.+)state(.+)advfirewall|off(.+)advfirewall(.+)state)'') && safe("log.winlogEventDataProcessName", "").matches(''netsh.exe'')', '2025-09-04 20:23:17.453122', true, false, 'origin', NULL, '[]');
INSERT INTO public.utm_correlation_rules VALUES (1328, 'Windows: Disabling Windows Defender Security Settings via PowerShell', 3, 3, 3, 'Defense Evasion', 'Disable or Modify Tools', 'Identifies use of the Set-MpPreference PowerShell command to disable or weaken certain Windows Defender settings.', '["https://attack.mitre.org/tactics/TA0005/","https://attack.mitre.org/techniques/T1562/001/"]', 'safe("log.message", "").matches("(Set-MpPreference)") && safe("log.message", "").matches("(-Disable|Disabled|NeverSend|-Exclusion)") && safe("log.winlogEventDataProcessName", "").matches("(powershell.exe|pwsh.dll|powershell_ise.exe)")', '2025-09-04 20:23:17.812321', true, false, 'origin', NULL, '[]');
INSERT INTO public.utm_correlation_rules VALUES (1417, 'Windows: Persistence via WMI Event Subscription', 2, 3, 2, 'Persistence', 'Windows Management Instrumentation Event Subscription', 'An adversary can use Windows Management Instrumentation (WMI) to install event filters, providers, consumers, and bindings that execute code when a defined event occurs. Adversaries may use the capabilities of WMI to subscribe to an event and execute arbitrary code when that event occurs, providing persistence on a system.', '["https://attack.mitre.org/tactics/TA0003/","https://attack.mitre.org/techniques/T1546/003/"]', 'safe("log.message", "").contains("create") && safe("log.message", "").matches("(ActiveScriptEventConsumer|CommandLineEventConsumer)") && safe("log.winlogEventDataProcessName", "").contains("wmic.exe")', '2025-09-04 20:57:08.25663', true, false, 'origin', NULL, '[]');
INSERT INTO public.utm_correlation_rules VALUES (1431, 'Windows: The value for the parameter to the browser service was illegal', 1, 3, 2, 'Potentially Malicious Activity', 'Exploitation for Client Execution', 'Adversaries may exploit software vulnerabilities in client applications to execute code.  Vulnerabilities can exist in software due to unsecure coding practices that can lead to unanticipated behavior.  Adversaries can take advantage of certain vulnerabilities through targeted exploitation for the purpose of arbitrary code execution.  Oftentimes the most valuable exploits to an offensive toolkit are those that can be used to obtain code execution  on a remote system because they can be used to gain access to that system.  Users will expect to see files related to the applications they commonly used to do work,  so they are a useful target for exploit research and development because of their high utility', '["https://attack.mitre.org/techniques/T1203/"]', 'safe("log.winlogEventDataProviderName", "") == "Browser" && safe("log.eventId", 0.0) == double(8023)', '2025-09-04 21:00:50.457146', true, false, 'origin', NULL, '[]');
INSERT INTO public.utm_correlation_rules VALUES (1465, 'Windows Defender: ERROR: BAD DB: CONTENT', 1, 2, 3, 'Potentially Compromised System', 'User Execution', 'Detects the ''BAD DB: CONTENT'' error event in Windows Defender, which may indicate a content-related issue.', '["https://learn.microsoft.com/en-us/windows/security/threat-protection/windows-defender-antivirus/troubleshoot"]', 'safe("log.logName", "") == "Microsoft-Windows-Windows Defender/Operational" && safe("log.eventDataErrorCode", "") == "0x8050A004"', '2025-09-04 21:11:28.867477', true, false, 'target', NULL, '[]');
INSERT INTO public.utm_correlation_rules VALUES (1421, 'Windows: Suspicious PDF Reader Child Process', 1, 1, 2, 'Execution', 'User Execution', 'Identifies suspicious child processes of PDF reader applications. These child processes are often launched via exploitation of PDF applications or social engineering.', '["https://attack.mitre.org/tactics/TA0002/","https://attack.mitre.org/techniques/T1204/"]', 'safe("log.winlogEventDataParentProcessName", "") in ["AcroRd32.exe", "Acrobat.exe", "FoxitPhantomPDF.exe", "FoxitReader.exe"] && safe("log.winlogEventDataProcessName", "") in ["arp.exe", "dsquery.exe", "dsget.exe", "gpresult.exe", "hostname.exe", "ipconfig.exe", "nbtstat.exe", "net.exe", "net1.exe", "netsh.exe", "netstat.exe", "nltest.exe", "ping.exe", "qprocess.exe", "quser.exe", "qwinsta.exe", "reg.exe", "sc.exe", "systeminfo.exe", "tasklist.exe", "tracert.exe", "whoami.exe", "bginfo.exe", "cdb.exe", "cmstp.exe", "csi.exe", "dnx.exe", "fsi.exe", "ieexec.exe", "iexpress.exe", "installutil.exe", "Microsoft.Workflow.Compiler.exe", "msbuild.exe", "mshta.exe", "msxsl.exe", "odbcconf.exe", "rcsi.exe", "regsvr32.exe", "xwizard.exe", "atbroker.exe", "forfiles.exe", "schtasks.exe", "regasm.exe", "regsvcs.exe", "cmd.exe", "cscript.exe", "powershell.exe", "pwsh.exe", "wmic.exe", "wscript.exe", "bitsadmin.exe", "certutil.exe", "ftp.exe"]', '2025-09-04 20:59:23.305021', true, false, 'origin', NULL, '[]');
INSERT INTO public.utm_correlation_rules VALUES (1429, 'Windows: System Shells via Services', 1, 3, 2, 'Persistence', 'Windows Service', 'Windows services typically run as SYSTEM and can be used as a privilege escalation opportunity. Malware or penetration testers may run a shell as a service to gain SYSTEM permissions.', '["https://attack.mitre.org/tactics/TA0003/","https://attack.mitre.org/techniques/T1543/003/"]', 'safe("log.winlogEventDataProcessName", "").matches("(cmd.exe|powershell.exe|pwsh.exe|powershell_ise.exe)") &&
 safe("log.winlogEventDataParentProcessName", "").contains("services.exe") &&
 !(safe("log.message", "").matches("(NVDisplay.ContainerLocalSystem)"))
', '2025-09-06 00:41:49.738847', true, false, 'origin', NULL, '[]');
INSERT INTO public.utm_correlation_rules VALUES (1430, 'Windows: The system stopped responding, crashed or lost power unexpectedly', 2, 2, 2, 'Potentially Malicious Activity', 'Service Stop', 'Adversaries may stop or disable services on a system to render those services unavailable to legitimate users.  Stopping critical services or processes can inhibit or stop response to an incident  or aid in the adversarys overall objectives to cause damage to the environment', '["https://attack.mitre.org/techniques/T1489/"]', 'safe("log.winlogEventDataLogName", "") == "System" && safe("log.winlogEventDataLevel", "") in ["Critical","critical"] && safe("log.eventCode", 0.0) == double(6008)', '2025-09-06 00:46:37.003616', true, false, 'origin', NULL, '[{"indexPattern":"v11-log-wineventlog-*","with":[{"field":"log.eventCode","operator":"filter_term","value":"6008"},{"field":"log.winlogEventDataProviderName.keyword","operator":"filter_term","value":"Microsoft-Windows-Kernel-Power"}],"or":[],"within":"now-60s","count":1}]');
INSERT INTO public.utm_correlation_rules VALUES (1423, 'Windows: Suspicious Process Access via Direct System Call', 1, 3, 2, 'Defense Evasion', 'Process Injection', 'Identifies suspicious process access events from an unknown memory region. Endpoint security solutions usually hook userland Windows APIs in order to decide if the code that is being executed is malicious or not. It''s possible to bypass hooked functions by writing malicious functions that call syscalls directly.', '["https://attack.mitre.org/tactics/TA0005/","https://attack.mitre.org/techniques/T1055/"]', 'safe("log.eventCode", 0.0) == double(10) && !(safe("log.winlogEventDataCallTrace", "").matches("(:\\WINDOWS\\SYSTEM32\\ntdll.dll|:\\WINDOWS\\SysWOW64\\ntdll.dll|:\\Windows\\System32\\wow64cpu.dll|:\\WINDOWS\\System32\\wow64win.dll|:\\Windows\\System32\\win32u.dll)")) &&
!(safe("log.winlogEventDataTargetImage","").matches("(:\\WINDOWS\\system32\\lsass.exe|:\\Program Files (x86)\\Malwarebytes Anti-Exploit\\mbae-svc.exe|:\\Program Files\\Cisco\\AMP\\(.+)\\sfc.exe|:\\Program Files (x86)\\Microsoft\\EdgeWebView\\Application\\(.+)\\msedgewebview2.exe|:\\Program Files\\Adobe\\Acrobat DC\\Acrobat\\(.+)\\AcroCEF.exe)")) &&
!(safe("log.winlogEventDataProcessName","").matches("(:\\Program Files\\Adobe\\Acrobat DC\\Acrobat\\Acrobat.exe|:\\Program Files (x86)\\World of Warcraft\\_classic_\\WowClassic.exe)"))
', '2025-09-04 20:59:24.275438', true, false, 'origin', NULL, '[]');
INSERT INTO public.utm_correlation_rules VALUES (1456, 'Windows: Volume Shadow Copy Service: COM+ database corrupted, writers will not receive events', 1, 2, 3, 'Persistence', 'Create or Modify System Process: Windows Service', 'Adversaries may create or modify Windows services to repeatedly execute malicious payloads as part of persistence.  When Windows boots up, it starts programs or applications called services that perform background system functions.  Windows service configuration information, including the file path to the service is executable or recovery programs/commands, is stored in the Windows Registry.', '["https://attack.mitre.org/techniques/T1543/003/"]', 'safe("log.eventDataProviderName", "") == ''VSS'' && safe("log.winlogEventId", "") in [''20'', ''21'']', '2025-09-04 21:02:17.710749', true, false, 'origin', NULL, '[]');
INSERT INTO public.utm_correlation_rules VALUES (1426, 'Windows: Suspicious Execution via Scheduled Task', 1, 3, 2, 'Persistence', 'Scheduled Task', 'Identifies execution of a suspicious program via scheduled tasks by looking at process lineage and command line usage.', '["https://attack.mitre.org/tactics/TA0003/","https://attack.mitre.org/techniques/T1053/005/"]', 'safe("log.winlogEventDataEventType", "") == "start" && safe("log.winlogEventDataProcessParentName", "").contains("svchost.exe") && safe("log.winlogEventDataProcessParentArgs", "").contains("Schedule") &&
safe("log.winlogEventDataOriginalFileName", "").matches("(cscript.exe|wscript.exe|PowerShell.EXE|Cmd.Exe|MSHTA.EXE|RUNDLL32.EXE|REGSVR32.EXE|MSBuild.exe|InstallUtil.exe|RegAsm.exe|RegSvcs.exe|msxsl.exe|CONTROL.EXE|EXPLORER.EXE|Microsoft.Workflow.Compiler.exe|msiexec.exe)") &&
safe("log.winlogEventDataProcessArgs", "").matches("(C:\\\\Users\\\\|C:\\\\ProgramData\\\\|C:\\\\Windows\\\\Temp\\\\|C:\\\\Windows\\\\Tasks\\\\|C:\\\\PerfLogs\\\\|C:\\\\Intel\\\\|C:\\\\Windows\\\\Debug\\\\|C:\\\\HP\\\\)") &&
!safe("log.winlogEventDataProcessName", "").matches("(cmd.exe|cscript.exe|powershell.exe|msiexec.exe)") && 
!safe("log.winlogEventDataProcessArgs", "").matches("(:\\\\(.+).bat|:\\\\Windows\\\\system32\\\\calluxxprovider.vbs|-File|-PSConsoleFile)") &&
!safe("log.winlogEventDataUserId", "").matches("(S-1-5-18)") && !safe("log.winlogEventDataWorkingDirectory", "").matches("(:\\\\Windows\\\\System32\\\\)")
', '2025-09-04 20:59:25.801189', true, false, 'origin', NULL, '[]');
INSERT INTO public.utm_correlation_rules VALUES (1427, 'Windows: Zoom Child Process', 1, 3, 2, 'Defense Evasion', 'Masquerading', 'A suspicious Zoom child process was detected, which may indicate an attempt to run unnoticed. Verify process details such as command line, network connections, file writes and associated file signature details as well.', '["https://attack.mitre.org/tactics/TA0005/","https://attack.mitre.org/techniques/T1036/"]', 'safe("log.winlogEventDataParentProcessName", "").contains("zoom.exe") && safe("log.winlogEventDataProcessName", "").matches("(cmd.exe|powershell.exe|pwsh.exe|powershell_ise.exe)")', '2025-09-04 20:59:26.315144', true, false, 'origin', NULL, '[]');
INSERT INTO public.utm_correlation_rules VALUES (1433, 'Windows: UAC Bypass Attempt with IEditionUpgradeManager Elevated COM Interface', 1, 3, 2, 'Privilege Escalation', 'Abuse Elevation Control Mechanism: Bypass User Account Control', 'Identifies attempts to bypass User Account Control (UAC) by abusing an elevated COM Interface to launch a rogue Windows ClipUp program. Attackers may attempt to bypass UAC to stealthily execute code with elevated permissions.', '["https://attack.mitre.org/tactics/TA0004/","https://attack.mitre.org/techniques/T1548/002/"]', 'safe("log.eventDataProcessName", "").contains("Clipup.exe") && !safe("log.message", "").matches("(C:\\Windows\\System32\\ClipUp.exe)") && safe("log.eventDataParentProcessName", "").contains("dllhost.exe") && safe("log.message", "").matches("(/Processid:{BD54C901-076B-434E-B6C7-17C531F4AB41)")', '2025-09-04 21:00:51.500412', true, false, 'origin', NULL, '[]');
INSERT INTO public.utm_correlation_rules VALUES (1425, 'Windows: Suspicious RDP ActiveX Client Loaded', 1, 3, 2, 'Lateral Movement', 'Remote Services', 'Identifies suspicious Image Loading of the Remote Desktop Services ActiveX Client (mstscax), this may indicate the presence of RDP lateral movement capability.', '["https://attack.mitre.org/tactics/TA0008/","https://attack.mitre.org/techniques/T1021/"]', '!(safe("log.winlogEventDataProcessName", "").matches("(C:\\\\Windows\\\\System32\\\\mstsc\\.exe|C:\\\\Windows\\\\SysWOW64\\\\mstsc\\.exe)")) &&
      safe("log.winlogEventDataProcessName", "").matches("(C:\\\\Windows\\\\|C:\\\\Users\\\\Public\\\\|C:\\\\Users\\\\Default\\\\|C:\\\\Intel\\\\|C:\\\\PerfLogs\\\\|C:\\\\ProgramData\\\\|\\\\Device\\\\Mup\\\\|\\\\\\\\)") &&
      safe("log.message", "").contains("mstscax.dll")', '2025-09-06 00:36:20.812022', true, false, 'target', NULL, '[]');
INSERT INTO public.utm_correlation_rules VALUES (1434, 'Windows: UAC Bypass Attempt via Elevated COM Internet Explorer Add-On Installer', 1, 3, 2, 'Privilege Escalation', 'Abuse Elevation Control Mechanism: Bypass User Account Control', 'Identifies User Account Control (UAC) bypass attempts by abusing an elevated COM Interface to launch a malicious program. Attackers may attempt to bypass UAC to stealthily execute code with elevated permissions.', '["https://attack.mitre.org/tactics/TA0004/","https://attack.mitre.org/techniques/T1548/002/"]', 'safe("log.message", "").matches("(C:\\(.+)\\AppData\\(.+)\\Temp\\IDC(.+).tmp\\(.+).exe)") && safe("log.processParentName", "").contains("ieinstall.exe") && safe("log.message", "").matches("(-Embedding)")', '2025-09-04 21:00:52.015755', true, false, 'origin', NULL, '[]');
INSERT INTO public.utm_correlation_rules VALUES (1435, 'Windows: UAC Bypass via ICMLuaUtil Elevated COM Interface', 1, 3, 2, 'Privilege Escalation', 'Abuse Elevation Control Mechanism: Bypass User Account Control', 'Identifies User Account Control (UAC) bypass attempts via the ICMLuaUtil Elevated COM interface. Attackers may attempt to bypass UAC to stealthily execute code with elevated permissions', '["https://attack.mitre.org/tactics/TA0004/","https://attack.mitre.org/techniques/T1548/002/"]', 'safe("log.eventDataProcessName", "").contains("dllhost.exe") && !safe("log.message", "").contains("WerFault.exe") && safe("log.message", "").matches("(/Processid:\\{3E5FC7F9-9A51-4367-9063-A120244FBEC7\\}|/Processid:\\{D2E7041B-2927-42FB-8E9F-7CE93B6DC937\\})")', '2025-09-04 21:00:52.54772', true, false, 'origin', NULL, '[]');
INSERT INTO public.utm_correlation_rules VALUES (1436, 'Windows: UAC Bypass Attempt via Privileged IFileOperation COM Interface', 1, 3, 2, 'Privilege Escalation', 'Abuse Elevation Control Mechanism: Bypass User Account Control', 'Identifies attempts to bypass User Account Control (UAC) via DLL side-loading. Attackers may attempt to bypass UAC to stealthily execute code with elevated permissions.', '["https://attack.mitre.org/tactics/TA0004/","https://attack.mitre.org/technique s/T1548/002/"]', 'safe("log.eventDataFileName", "").matches("(wow64log.dll|comctl32.dll|DismCore.dll|OskSupport.dll|duser.dll|Accessibility.ni.dll)") && safe("log.eventDataProcessName", "").contains("dllhost.exe") && !safe("log.eventDataFileName", "").matches("(C:\\Windows\\SoftwareDistribution\\|C:\\Windows\\WinSxS\\)")', '2025-09-04 21:00:53.068129', true, false, 'origin', NULL, '[]');
INSERT INTO public.utm_correlation_rules VALUES (1437, 'Windows: Bypass UAC via Event Viewer', 1, 3, 2, 'Privilege Escalation', 'Abuse Elevation Control Mechanism: Bypass User Account Control', 'Identifies User Account Control (UAC) bypass via eventvwr.exe. Attackers bypass UAC to stealthily execute code with elevated permissions.', '["https://attack.mitre.org/tactics/TA0004/","https://attack.mitre.org/techniques/T1548/002/"]', 'safe("log.eventDataParentProcessName", "").contains("eventvwr.exe") && !safe("log.eventDataProcessName", "").matches("(:\\Windows\\SysWOW64\\mmc.exe|:\\Windows\\System32\\mmc.exe|:\\Windows\\SysWOW64\\WerFault.exe|:\\Windows\\System32\\WerFault.exe)")', '2025-09-04 21:00:53.585166', true, false, 'origin', NULL, '[]');
INSERT INTO public.utm_correlation_rules VALUES (1438, 'Windows: UAC Bypass via Windows Firewall Snap-In Hijack', 1, 3, 2, 'Privilege Escalation', 'Abuse Elevation Control Mechanism: Bypass User Account Control', 'Identifies attempts to bypass User Account Control (UAC) by hijacking the Microsoft Management Console (MMC) Windows Firewall snap-in. Attackers bypass UAC to stealthily execute code with elevated permissions.', '["https://attack.mitre.org/tactics/TA0004/","https://attack.mitre.org/techniques/T1548/002/"]', 'safe("log.eventDataProcessName", "").contains("mmc.exe") && !safe("log.message", "").contains("WerFault.exe") && safe("log.message", "").contains("WF.msc")', '2025-09-04 21:00:54.103631', true, false, 'origin', NULL, '[]');
INSERT INTO public.utm_correlation_rules VALUES (1439, 'Windows: Suspicious .NET Reflection via PowerShell', 3, 2, 1, 'Defense Evasion', 'Process Injection', 'Detects the use of Reflection.Assembly to load PEs and DLLs in memory in PowerShell scripts. Attackers use this method to load executables and DLLs without writing to the disk, bypassing security solutions.', '["https://attack.mitre.org/tactics/TA0005/","https://attack.mitre.org/techniques/T1055/"]', 'safe("log.message", "").matches("(\\[Reflection.Assembly\\]::Load)")', '2025-09-04 21:00:56.605639', true, false, 'origin', NULL, '[]');
INSERT INTO public.utm_correlation_rules VALUES (1440, 'Windows: PowerShell Suspicious Payload Encoded and Compressed', 2, 3, 1, 'Defense Evasion', 'Obfuscated Files or Information', 'Identifies the use of .NET functionality for decompression and base64 decoding combined in PowerShell scripts, which malware and security tools heavily use to deobfuscate payloads and load them directly in memory to bypass defenses.', '["https://attack.mitre.org/tactics/TA0005/","https://attack.mitre.org/techniques/T1027/"]', 'safe("log.message", "").matches("(FromBase64String)") && safe("log.message", "").matches("(System.IO.Compression.DeflateStream|System.IO.Compression.GzipStream|IO.Compression.DeflateStream|IO.Compression.GzipStream)")', '2025-09-04 21:00:57.024952', true, false, 'origin', NULL, '[]');
INSERT INTO public.utm_correlation_rules VALUES (1479, 'Windows Service Installed via an Unusual Client', 3, 3, 2, 'Privilege Escalation', 'Windows Service', 'Identifies the creation of a Windows service by an unusual client process. Services may be created with administrator privileges but are executed under SYSTEM privileges, so an adversary may also use a service to escalate privileges from administrator to SYSTEM.', '["https://attack.mitre.org/tactics/TA0004/","https://attack.mitre.org/techniques/T1543/003/"]', 'safe("action", "") == "service-installed" && safe("clientProcessId", "") == "0" && safe("parentProcessId", "") == "0"', '2025-09-04 21:12:37.273553', true, false, 'origin', NULL, '[]');
INSERT INTO public.utm_correlation_rules VALUES (1480, 'Windows: Wireless Credential Dumping using Netsh Command', 3, 3, 2, 'Credential Access', 'OS Credential Dumping', 'Identifies attempts to dump Wireless saved access keys in clear text using the Windows built-in utility Netsh.', '["https://attack.mitre.org/tactics/TA0006/","https://attack.mitre.org/techniques/T1003/"]', 'safe("log.message", "").contains("wlan") && safe("log.message", "").matches("(key(.+)clear)") && safe("log.winlogEventDataProcessName", "").contains("netsh.exe")', '2025-09-04 21:12:37.82278', true, false, 'origin', NULL, '[]');
INSERT INTO public.utm_correlation_rules VALUES (1504, 'Windows: Possible ransomware attack detected. Unusual DNS Requests.', 2, 2, 3, 'Ransomware', 'Impact: Data Encrypted for Impact', 'Ransomware, is a type of malware that prevents users from accessing their system or  personal files and requires payment of a ransom in order to gain access to them again. Identifies  ransomware attempts. Unusual DNS requests have been detected, potentially indicating ransomware activity.', '["https://attack.mitre.org/tactics/TA0040/"]', 'safe("log.eventDataQueryName", "").matches("(\\.(onion|top|xyz|cc)$)")', '2025-09-04 21:17:13.68444', true, false, 'origin', NULL, '[]');
INSERT INTO public.utm_correlation_rules VALUES (1445, 'Windows: Unusual Network Connection via DllHost or via RunDLL32', 2, 3, 2, 'Defense Evasion', 'System Binary Proxy Execution', 'Identifies unusual instances of dllhost.exe making outbound network connections. This may indicate adversarial Command and Control activity. Identifies unusual instances of rundll32.exe making outbound network connections. This may indicate adversarial Command and Control activity.', '["https://attack.mitre.org/tactics/TA0005/","https://attack.mitre.org/techniques/T1218/"]', 'safe("log.eventDataProcessName", "").matches("(dllhost.exe|rundll32.exe)") && safe("log.origin.ips", "").matches("((10.0.0.0/8,127.0.0.0/8,169.254.0.0/16,172.16.0.0/12,192.0.0.0/24,192.0.0.0/29,192.0.0.8/32,192.0.0.9/32,192.0.0.10/32,192.0.0.170/32,192.0.0.171/32,192.0.2.0/24,192.31.196.0/24,192.52.193.0/24,192.168.0.0/16,192.88.99.0/24,224.0.0.0/4,100.64.0.0/10,192.175.48.0/24,198.18.0.0/15,198.51.100.0/24,203.0.113.0/24,240.0.0.0/4,::1,FE80::/10,FF00::/8)")', '2025-09-04 21:01:34.94437', true, false, 'target', NULL, '[]');
INSERT INTO public.utm_correlation_rules VALUES (1446, 'Windows: Unusual Print Spooler Child Process', 1, 3, 2, 'Privilege Escalation', 'Exploitation for Privilege Escalation', 'Detects unusual Print Spooler service (spoolsv.exe) child processes. This may indicate an attempt to exploit privilege escalation vulnerabilities related to the Printing Service on Windows.', '["https://attack.mitre.org/tactics/TA0004/","https://attack.mitre.org/techniques/T1068/"]', 'safe("log.eventDataParentProcessName", "").contains("spoolsv.exe") && !safe("log.eventDataProcessName", "").matches("(splwow64.exe|PDFCreator.exe|acrodist.exe|spoolsv.exe|msiexec.exe|route.exe|WerFault.exe|net.exe|cmd.exe|powershell.exe|netsh.exe|regsvr32.exe)") && !safe("log.message", "").matches("(\\WINDOWS\\system32\\spool\\DRIVERS|stop|start|.spl|\\program files(.+)route add|add portopening|rule name|PrintConfig.dll)") && safe("log.logName", "") == ''System''', '2025-09-04 21:01:35.493758', true, false, 'origin', NULL, '[]');
INSERT INTO public.utm_correlation_rules VALUES (1447, 'Windows: Unusual Process Network Connection', 3, 3, 2, 'Defense Evasion', 'Trusted Developer Utilities Proxy Execution', 'Identifies network activity from unexpected system applications. This may indicate adversarial activity as these applications are often leveraged by adversaries to execute code and evade detection.', '["https://attack.mitre.org/tactics/TA0005/","https://attack.mitre.org/techniques/T1127/"]', 'safe("log.eventDataProcessName", "").matches("(Microsoft.Workflow.Compiler.exe|bginfo.exe|cdb.exe|cmstp.exe|csi.exe|dnx.exe|fsi.exe|ieexec.exe|iexpress.exe|odbcconf.exe|rcsi.exe|xwizard.exe)")', '2025-09-04 21:01:36.027342', true, false, 'origin', NULL, '[{"indexPattern":"v11-log-wineventlog-*","with":[{"field":"log.winlogEventDataProcessID.keyword","operator":"filter_term","value":"{{.log.winlogEventDataProcessID}}"}],"or":null,"within":"now-5m","count":3}]');
INSERT INTO public.utm_correlation_rules VALUES (349, 'Firewall license expiration detected in Sophos Central', 2, 2, 2, 'Expiration', 'Obtain Capabilities', 'Your Central Firewall Reporting license has expired.', '["https://support.sophos.com/support/s/article/KB-000037006?language=en_US"]', 'safe("log.type", "") in [''Event::Firewall::ReportingGracePeriodStart'', ''Event::Firewall::ReportingXgsLicenseExpired'', ''Event::Firewall::ReportingGracePeriodExtension'']', '2025-09-03 15:00:17.82542', true, false, 'origin', NULL, '[]');
INSERT INTO public.utm_correlation_rules VALUES (1483, 'Windows: Probable replay attack', 1, 3, 2, 'Impact', 'Replay attack', 'This event generates on domain controllers when KRB_AP_ERR_REPEAT Kerberos response was sent to the client.  Domain controllers cache information from recently received tickets. If the server name, client name, time,  and microsecond fields from the Authenticator match recently seen entries in the cache, it will return KRB_AP_ERR_REPEAT.  You can read more about this in RFC-1510. One potential cause for this is a misconfigured network device between the  client and server that could send the same packet(s) repeatedly.', '["https://attack.mitre.org/tactics/TA0040","https://docs.microsoft.com/en-us/windows/security/threat-protection/auditing/event-4649"]', 'safe("log.eventCode", 0.0) in [double(4961), double(4649)]', '2025-09-05 22:32:29.534424', true, false, 'origin', NULL, '[]');
INSERT INTO public.utm_correlation_rules VALUES (253, 'Possible Consent Grant Attack via Azure-Registered Application', 1, 2, 3, 'Phishing', 'Credential Access', 'Detects when a user grants permissions to an Azure-registered application or when an administrator grants tenant-wide permissions to an application. An adversary may create an Azure-registered application that requests access to data such as contact information, email, or documents.', '["https://attack.mitre.org/techniques/T1566/"]', 'safe("log.operationName.localizedValue", "").contains("Consent to application") && safe("log.statusValue", "").contains("Succeeded") && (safe("log.resourceProviderNameValue", "").contains("azure.activitylogs") || safe("log.resourceProviderNameValue", "").contains("azure.auditlogs"))', '2025-09-05 14:16:11.467718', true, false, 'target', NULL, '[]');
INSERT INTO public.utm_correlation_rules VALUES (129, 'AWS RDS Security Group Creation', 3, 2, 2, 'Create Account', 'Persistence', 'Identifies the creation of an Amazon Relational Database Service (RDS) Security Group', '["https://attack.mitre.org/tactics/TA0003/","https://attack.mitre.org/techniques/T1136/","https://docs.aws.amazon.com/AmazonRDS/latest/APIReference/API_CreateDBSecurityGroup.html"]', 'safe("log.eventSource", "") == "rds.amazonaws.com" && safe("log.eventName", "") == "CreateDBSecurityGroup"', '2025-09-03 12:39:13.575225', true, false, 'origin', NULL, '[]');
INSERT INTO public.utm_correlation_rules VALUES (1219, 'High level Suricata alert', 3, 3, 3, 'High level Suricata alert category', 'Network Intrusion Detection', 'Suricata has detected a high severity alert. This indicates potential malicious activity targeting the network infrastructure, such as exploitation attempts, malware communication, or suspicious network behavior.', '["https://suricata.readthedocs.io/en/latest/"]', 'safe("log.eventType", "") == "alert" && safe("severity", "") == "high"', '2025-09-05 23:20:01.223803', true, false, 'origin', NULL, '[]');
INSERT INTO public.utm_correlation_rules VALUES (1424, 'Windows: Suspicious Process Execution via Renamed PsExec Executable', 1, 3, 2, 'Execution', 'System Services', 'Identifies suspicious psexec activity which is executing from the psexec service that has been renamed, possibly to vade detection.', '["https://attack.mitre.org/tactics/TA0002/","https://attack.mitre.org/techniques/T1569/"]', 'safe("log.winlogEventDataEventType", "") == "start" && safe("log.winlogEventDataProcessName", "").contains("PSEXESVC.exe") || safe("log.winlogEventDataOriginalFileName", "").contains("psexesvc.exe")', '2025-09-04 20:59:24.777522', true, false, 'target', NULL, '[]');

