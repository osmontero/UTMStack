<div class="card h-100 d-flex flex-column agent-sidebar">
  <div class="card-header p-2">
    <label class="card-title d-flex align-items-center">
      <i class="icon-terminal mr-2 fs-4 text-blue-800"></i>
      Agents
    </label>
  </div>

  <div class="card-body d-flex flex-column p-0 flex-grow-1">
    <div class="p-2">
      <app-utm-search-input
        (searchFor)="searchAgent($event)"
        [searching]="searching"
        placeholder="Search agent ...">
      </app-utm-search-input>
    </div>

    <div class="text-muted small px-3 mb-2">
      Select an agent to start the interactive console
    </div>

    <div class="d-flex px-2 flex-column h-100">
      <div
        infiniteScroll
        (scrolled)="onScroll()"
        [fromRoot]="true"
        [infiniteScrollDistance]="1"
        [infiniteScrollThrottle]="80"
        [scrollWindow]="false"
        class="px-1 pb-0 mb-1 overflow-auto flex-grow-1">

        <div *ngFor="let agent of agentSidebarService.agents$ | async; trackBy: trackByFn"
          class="card agent-card px-3 py-2 mb-2 shadow-sm cursor-pointer" (click)="agentDetail(agent)">
          <div class="d-flex justify-content-between align-items-center">

            <!-- Hostname + Plataforma + IP -->
            <div class="d-flex flex-column overflow-hidden">
              <div class="d-flex align-items-center gap-1 text-truncate">
                <i [ngClass]="platformIcon(agent.platform)" class="text-muted fs-6" aria-hidden="true"></i>
                <span class="fw-medium text-dark text-truncate">{{ agent.hostname || 'Unnamed' }}</span>
              </div>
              <small class="text-muted text-truncate">{{ agent.ip || 'â€”' }}</small>
            </div>

            <!-- Status -->
            <div class="text-end d-flex flex-column align-items-end justify-content-center">
      <span class="badge status-badge"
            [ngClass]="agent.status === AgentStatusEnum.ONLINE ? 'bg-success' : 'bg-secondary'">
        {{ agent.status }}
      </span>
            </div>

          </div>
        </div>

      </div>

      <app-utm-spinner
        *ngIf="agentSidebarService.loading$ | async"
        class="position-absolute top-50 right-35"
        [loading]="true"
        label="Loading agents...">
      </app-utm-spinner>
    </div>
  </div>
</div>
